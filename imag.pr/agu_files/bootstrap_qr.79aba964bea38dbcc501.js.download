/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9209],{63509:(e,t,r)=>{var n={"./f00.png":31213,"./f01.png":8750,"./f02.png":48738,"./f03.png":15494,"./f04.png":15885,"./f05.png":5851,"./f06.png":68540,"./f07.png":30293,"./f08.png":91131,"./f09.png":27879,"./f10.png":8610,"./f11.png":32641,"./f12.png":98479,"./f13.png":25670,"./f14.png":759,"./f15.png":52264,"./f16.png":86035,"./f17.png":94878,"./f18.png":67514,"./f19.png":23533,"./f20.png":86319,"./f21.png":65664,"./f22.png":10191,"./f23.png":48850,"./f24.png":92553,"./f25.png":53453,"./f26.png":78691,"./f27.png":17430,"./f28.png":40610,"./f29.png":78643,"./f30.png":73434,"./f31.png":54981,"./f32.png":86488,"./f33.png":28881,"./f34.png":71199,"./f35.png":97836,"./f36.png":77985,"./f37.png":73570,"./f38.png":42949,"./f39.png":21404,"./f40.png":21792,"./f41.png":86197,"./f42.png":79685,"./f43.png":39346,"./f44.png":89128,"./f45.png":86904,"./f46.png":86906,"./f47.png":63265,"./f48.png":7029,"./f49.png":39871,"./f50.png":58360,"./f51.png":35277,"./f52.png":63418,"./f53.png":58235,"./f54.png":132,"./f55.png":33417,"./f56.png":50407,"./f57.png":29423,"./f58.png":32176,"./f59.png":50874,"./f60.png":21578,"./f61.png":22129,"./f62.png":33819,"./f63.png":97359,"./f64.png":39887,"./f65.png":38275,"./f66.png":71673,"./f67.png":21264,"./f68.png":96007,"./f69.png":59163,"./f70.png":91732,"./f71.png":3913,"./f72.png":92293,"./f73.png":51577,"./f74.png":26347,"./f75.png":70345,"./f76.png":60318,"./f77.png":86426,"./f78.png":62002,"./f79.png":49889,"./f80.png":24324,"./f81.png":59354,"./f82.png":74992,"./f83.png":80502,"./f84.png":74260,"./f85.png":64108,"./f86.png":71042,"./f87.png":95563,"./f88.png":64594,"./f89.png":68005,"./f90.png":16888,"./f91.png":52943,"./f92.png":24613,"./f93.png":94922,"./f94.png":18725,"./f95.png":82950,"./f96.png":7251,"./f97.png":17978,"./f98.png":86273,"./f99.png":31666,"./favicon-error.png":10331,"./favicon-error2.png":72174,"./favicon.png":68431};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=63509},76554:(e,t,r)=>{var n={"./f00.png":95203,"./f01.png":66574,"./f02.png":19833,"./f03.png":39974,"./f04.png":86727,"./f05.png":78808,"./f06.png":71258,"./f07.png":64497,"./f08.png":66114,"./f09.png":12430,"./f10.png":29809,"./f11.png":41191,"./f12.png":87642,"./f13.png":26841,"./f14.png":7967,"./f15.png":38817,"./f16.png":65587,"./f17.png":38297,"./f18.png":61665,"./f19.png":16962,"./f20.png":42387,"./f21.png":74420,"./f22.png":84319,"./f23.png":43302,"./f24.png":34444,"./f25.png":14231,"./f26.png":15842,"./f27.png":25925,"./f28.png":10149,"./f29.png":90154,"./f30.png":701,"./f31.png":27707,"./f32.png":95169,"./f33.png":77763,"./f34.png":98593,"./f35.png":16569,"./f36.png":35807,"./f37.png":82439,"./f38.png":41360,"./f39.png":93127,"./f40.png":62369,"./f41.png":55876,"./f42.png":31990,"./f43.png":36009,"./f44.png":24580,"./f45.png":61400,"./f46.png":78354,"./f47.png":27020,"./f48.png":27961,"./f49.png":8725,"./f50.png":25129,"./f51.png":33690,"./f52.png":15722,"./f53.png":94416,"./f54.png":59965,"./f55.png":97937,"./f56.png":91425,"./f57.png":40564,"./f58.png":35705,"./f59.png":1474,"./f60.png":5285,"./f61.png":60792,"./f62.png":1219,"./f63.png":66899,"./f64.png":14772,"./f65.png":61160,"./f66.png":26671,"./f67.png":18327,"./f68.png":8659,"./f69.png":80157,"./f70.png":14440,"./f71.png":90805,"./f72.png":39619,"./f73.png":30472,"./f74.png":60325,"./f75.png":59019,"./f76.png":69536,"./f77.png":71717,"./f78.png":35033,"./f79.png":62003,"./f80.png":65263,"./f81.png":39681,"./f82.png":61422,"./f83.png":50966,"./f84.png":60408,"./f85.png":69738,"./f86.png":87724,"./f87.png":93370,"./f88.png":63963,"./f89.png":13976,"./f90.png":26034,"./f91.png":41727,"./f92.png":54257,"./f93.png":61109,"./f94.png":2801,"./f95.png":11318,"./f96.png":25889,"./f97.png":30341,"./f98.png":51222,"./f99.png":53279,"./favicon-error.png":81740,"./favicon-error2.png":5079,"./favicon.png":49420};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=76554},23098:module=>{var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);function ba(e){eval.call(null,e)}for(l in e.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},"undefined"!=typeof arguments&&(e.arguments=arguments),"undefined"!=typeof console?(e.print||(e.print=function(e){console.log(e)}),e.printErr||(e.printErr=function(e){console.log(e)})):e.print||(e.print=function(){}),void 0===e.setWindowTitle&&(e.setWindowTitle=function(e){document.title=e}),!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[],aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(e){ca=e},Ua:function(){return ca},na:function(){return m},X:function(e){m=e},Aa:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===e[e.length-1]?n.H:"i"===e[0]?(assert(0==(e=parseInt(e.substr(1)))%8),e/8):0}},Ta:function(e){return Math.max(n.Aa(e),n.H)},dd:16,Bd:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},od:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?n.Ta(e):0),n.H):Math.min(t,8):8},J:function(t,r,n){return n&&n.length?(n.splice||(n=Array.prototype.slice.call(n)),n.splice(0,0,r),e["dynCall_"+t].apply(null,n)):e["dynCall_"+t].call(null,r)},U:[],Ma:function(e){for(var t=0;t<n.U.length;t++)if(!n.U[t])return n.U[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(e){n.U[(e-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(e,t){assert(t),n.ha[t]||(n.ha[t]={});var r=n.ha[t];return r[e]||(r[e]=function(){return n.J(t,e,arguments)}),r[e]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(e){var t=m;return m=(m=m+e|0)+15&-16,t},Ia:function(e){var t=p;return p=(p=p+e|0)+15&-16,t},P:function(e){var t=v;return(e=(v=(v=v+e|0)+15&-16)>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),e=!0),e?(v=t,0):t},ea:function(e,t){return Math.ceil(e/(t||16))*(t||16)},xd:function(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca,ha,ia,buffer;function assert(e,t){e||z("Assertion failed: "+t)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(e){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}function ma(e,t,r){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":D[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":F[e>>2]=t;break;case"i64":fa=[t>>>0,(da=t,1<=+na(da)?0<da?(0|oa(+pa(da/4294967296),4294967295))>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[e>>2]=fa[0],F[e+4>>2]=fa[1];break;case"float":ra[e>>2]=t;break;case"double":sa[e>>3]=t;break;default:z("invalid type for setValue: "+r)}}function ta(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return D[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return F[e>>2];case"float":return ra[e>>2];case"double":return sa[e>>3];default:z("invalid type for setValue: "+t)}return null}function G(e,t,r,i){var a,o;"number"==typeof e?(a=!0,o=e):(a=!1,o=e.length);var s,l,c="string"==typeof t?t:null;if(r=4==r?i:[ua,n.W,n.Ia,n.P][void 0===r?2:r](Math.max(o,c?1:t.length)),a){for(i=r,assert(0==(3&r)),e=r+(-4&o);i<e;i+=4)F[i>>2]=0;for(e=r+o;i<e;)D[i++>>0]=0;return r}if("i8"===c)return e.subarray||e.slice?H.set(e,r):H.set(new Uint8Array(e),r),r;for(i=0;i<o;){var d=e[i];"function"==typeof d&&(d=n.sd(d)),0===(a=c||t[i])?i++:("i64"==a&&(a="i32"),ma(r+i,d,a),l!==a&&(s=n.Aa(a),l=a),i+=s)}return r}function la(t,r){if(0===r||!t)return"";for(var n,i=0,a=0;(i|=n=H[t+a>>0],0!=n||r)&&(a++,!r||a!=r););if(r||(r=a),n="",128>i){for(;0<r;)i=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(r,1024))),n=n?n+i:i,t+=1024,r-=1024;return n}return e.UTF8ToString(t)}function za(e,t){for(var r,n,i,a,o,s="";;){if(!(r=e[t++]))return s;128&r?(n=63&e[t++],192==(224&r)?s+=String.fromCharCode((31&r)<<6|n):(i=63&e[t++],224==(240&r)?r=(15&r)<<12|n<<6|i:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|n<<12|i<<6|a:(o=63&e[t++],248==(252&r)?r=(3&r)<<24|n<<18|i<<12|a<<6|o:r=(1&r)<<30|n<<24|i<<18|a<<12|o<<6|63&e[t++])),65536>r?s+=String.fromCharCode(r):(r-=65536,s+=String.fromCharCode(55296|r>>10,56320|1023&r)))):s+=String.fromCharCode(r)}}function Aa(e,t,r,n){if(!(0<n))return 0;var i=r;n=r+n-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(2097151>=o){if(r+3>=n)break;t[r++]=240|o>>18}else{if(67108863>=o){if(r+4>=n)break;t[r++]=248|o>>24}else{if(r+5>=n)break;t[r++]=252|o>>30,t[r++]=128|o>>24&63}t[r++]=128|o>>18&63}t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}return t[r]=0,r-i}function Ba(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),127>=n?++t:t=2047>=n?t+2:65535>=n?t+3:2097151>=n?t+4:67108863>=n?t+5:t+6}return t}function Ca(t){var r=!!e.___cxa_demangle;if(r)try{var i=ua(t.length);ka(t.substr(1),i);var a=ua(4),o=e.___cxa_demangle(i,0,0,a);if(0===ta(a,"i32")&&o)return la(o)}catch(e){}finally{i&&Da(i),a&&Da(a),o&&Da(o)}var s=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},c=[],d=!0;i=t;try{if("Object._main"==t||"_main"==t)return"main()";if("number"==typeof t&&(t=la(t)),"_"!==t[0]||"_"!==t[1]||"Z"!==t[2])return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}i=function e(r,n,i){n=n||1/0;var a,o="",u=[];if("N"===t[s]){for(s++,"K"===t[s]&&s++,a=[];"E"!==t[s];)if("S"===t[s]){s++;var p=t.indexOf("_",s);a.push(c[t.substring(s,p)||0]||"?"),s=p+1}else if("C"===t[s])a.push(a[a.length-1]),s+=2;else{var f=(p=parseInt(t.substr(s))).toString().length;if(!p||!f){s--;break}var _=t.substr(s+f,p);a.push(_),c.push(_),s+=f+p}if(s++,a=a.join("::"),0==--n)return r?[a]:a}else("K"===t[s]||d&&"L"===t[s])&&s++,(p=parseInt(t.substr(s)))&&(f=p.toString().length,a=t.substr(s+f,p),s+=f+p);d=!1,"I"===t[s]?(s++,p=e(!0),o+=(f=e(!0,1,!0))[0]+" "+a+"<"+p.join(", ")+">"):o=a;e:for(;s<t.length&&0<n--;)if(a=t[s++],a in l)u.push(l[a]);else switch(a){case"P":u.push(e(!0,1,!0)[0]+"*");break;case"R":u.push(e(!0,1,!0)[0]+"&");break;case"L":s++,p=t.indexOf("E",s)-s,u.push(t.substr(s,p)),s+=p+2;break;case"A":if(p=parseInt(t.substr(s)),s+=p.toString().length,"_"!==t[s])throw"?";s++,u.push(e(!0,1,!0)[0]+" ["+p+"]");break;case"E":break e;default:o+="?"+a;break e}return i||1!==u.length||"void"!==u[0]||(u=[]),r?(o&&u.push(o+"?"),u):o+"("+u.join(", ")+")"}()}catch(e){i+="?"}return 0<=i.indexOf("?")&&!r&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),i}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,(function(e){var t=Ca(e);return e===t?e:e+" ["+t+"]"}))}function Fa(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function Ga(){var e=v;return 0<e%4096&&(e+=4096-e%4096),e}(function(){function a(e){return{arguments:(e=e.toString().match(d).slice(1))[0],body:e[1],returnValue:e[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(e){var t=n.W(e.length);return ja(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&ka(e,t=n.W(1+(e.length<<2))),t}},c={string:b.stringToC,array:b.arrayToC};ia=function(e,t,r,i,a){e=ga(e);var o=[],s=0;if(i)for(var l=0;l<i.length;l++){var d=c[r[l]];d?(0===s&&(s=n.na()),o[l]=d(i[l])):o[l]=i[l]}if(r=e.apply(null,o),"string"===t&&(r=la(r)),0!==s){if(a&&a.async)return void EmterpreterAsync.hd.push((function(){n.X(s)}));n.X(s)}return r};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every((function(e){return"number"===e}));var u="string"!==c;if(u&&b)return h;var q=d.map((function(e,t){return"$"+t}));c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a((function(){return h})).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a((function(){return la})).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha,e.setValue=ma,e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4,e.allocate=G,e.getMemory=function(e){return va?void 0!==wa&&!wa.C||!xa?n.P(e):ua(e):n.Ia(e)},e.Pointer_stringify=la,e.AsciiToString=function(e){for(var t="";;){var r=D[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}},e.stringToAscii=function(e,t){return ya(e,t,!1)},e.UTF8ArrayToString=za,e.UTF8ToString=function(e){return za(H,e)},e.stringToUTF8Array=Aa,e.stringToUTF8=function(e,t,r){return Aa(e,H,t,r)},e.lengthBytesUTF8=Ba,e.UTF16ToString=function(e){for(var t=0,r="";;){var n=E[e+2*t>>1];if(0==n)return r;++t,r+=String.fromCharCode(n)}},e.stringToUTF16=function(e,t,r){if(void 0===r&&(r=2147483647),2>r)return 0;var n=t;r=(r-=2)<2*e.length?r/2:e.length;for(var i=0;i<r;++i)E[t>>1]=e.charCodeAt(i),t+=2;return E[t>>1]=0,t-n},e.lengthBytesUTF16=function(e){return 2*e.length},e.UTF32ToString=function(e){for(var t=0,r="";;){var n=F[e+4*t>>2];if(0==n)return r;++t,65536<=n?(n-=65536,r+=String.fromCharCode(55296|n>>10,56320|1023&n)):r+=String.fromCharCode(n)}},e.stringToUTF32=function(e,t,r){if(void 0===r&&(r=2147483647),4>r)return 0;var n=t;r=n+r-4;for(var i=0;i<e.length;++i){if(55296<=(a=e.charCodeAt(i))&&57343>=a)var a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i);if(F[t>>2]=a,(t+=4)+4>r)break}return F[t>>2]=0,t-n},e.lengthBytesUTF32=function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&++r,t+=4}return t},e.stackTrace=function(){return Ea()};for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;function Oa(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var r=t.Qa;"number"==typeof r?void 0===t.T?n.J("v",r):n.J("vi",r,[t.T]):r(void 0===t.T?null:t.T)}}}I!==w&&(w=I),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(e){Pa.unshift(e)}function Ua(e){Sa.unshift(e)}function Va(e,t,r){return e=Aa(e,r=Array(0<r?r:Ba(e)+1),0,r.length),t&&(r.length=e),r}function ka(e,t,r){for(e=Va(e,r),r=0;r<e.length;)D[t+r>>0]=e[r],r+=1}function ja(e,t){for(var r=0;r<e.length;r++)D[t++>>0]=e[r]}function ya(e,t,r){for(var n=0;n<e.length;++n)D[t++>>0]=e.charCodeAt(n);r||(D[t>>0]=0)}e.addOnPreRun=Ta,e.addOnInit=function(e){Qa.unshift(e)},e.addOnPreMain=function(e){Ra.unshift(e)},e.addOnExit=function(e){K.unshift(e)},e.addOnPostRun=Ua,e.intArrayFromString=Va,e.intArrayToString=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];255<n&&(n&=255),t.push(String.fromCharCode(n))}return t.join("")},e.writeStringToMemory=ka,e.writeArrayToMemory=ja,e.writeAsciiToMemory=ya,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;32>t;t++)if(e&1<<31-t)return t;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.addRunDependency=Ya,e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);function eb(e,t){K.push((function(){n.J("vi",e,[t])})),eb.level=K.length}assert(0==$a%8),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db,e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(e,t){for(var r=0,n=e.length-1;0<=n;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function N(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function kb(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function lb(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function mb(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){if("string"!=typeof(t=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var nb=[];function ob(e,t){nb[e]={input:[],output:[],L:t},pb(e,qb)}var qb={open:function(e){var t=nb[e.g.rdev];if(!t)throw new O(M.ba);e.tty=t,e.seekable=!1},close:function(e){e.tty.L.flush(e.tty)},flush:function(e){e.tty.L.flush(e.tty)},read:function(e,t,r,n){if(!e.tty||!e.tty.L.Ba)throw new O(M.sa);for(var i=0,a=0;a<n;a++){var o;try{o=e.tty.L.Ba(e.tty)}catch(e){throw new O(M.F)}if(void 0===o&&0===i)throw new O(M.oa);if(null==o)break;i++,t[r+a]=o}return i&&(e.g.timestamp=Date.now()),i},write:function(e,t,r,n){if(!e.tty||!e.tty.L.ja)throw new O(M.sa);for(var i=0;i<n;i++)try{e.tty.L.ja(e.tty,t[r+i])}catch(e){throw new O(M.F)}return n&&(e.g.timestamp=Date.now()),i}},rb={Ba:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\n")),!t)return null;e.input=Va(t,!0)}return e.input.shift()},ja:function(t,r){null===r||10===r?(e.print(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,r){null===r||10===r?(e.printErr(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),16384==(61440&(r=ub(e,t,r,n)).mode)?(r.k=P.q.dir.g,r.n=P.q.dir.stream,r.e={}):32768==(61440&r.mode)?(r.k=P.q.file.g,r.n=P.q.file.stream,r.o=0,r.e=null):40960==(61440&r.mode)?(r.k=P.q.link.g,r.n=P.q.link.stream):8192==(61440&r.mode)&&(r.k=P.q.va.g,r.n=P.q.va.stream),r.timestamp=Date.now(),e&&(e.e[t]=r),r},Sa:function(e){if(e.e&&e.e.subarray){for(var t=[],r=0;r<e.o;++r)t.push(e.e[r]);return t}return e.e},qd:function(e){return e.e?e.e.subarray?e.e.subarray(0,e.o):new Uint8Array(e.e):new Uint8Array},ya:function(e,t){if(e.e&&e.e.subarray&&t>e.e.length&&(e.e=P.Sa(e),e.o=e.e.length),!e.e||e.e.subarray){var r=e.e?e.e.buffer.byteLength:0;r>=t||(t=Math.max(t,r*(1048576>r?2:1.125)|0),0!=r&&(t=Math.max(t,256)),r=e.e,e.e=new Uint8Array(t),0<e.o&&e.e.set(r.subarray(0,e.o),0))}else for(!e.e&&0<t&&(e.e=[]);e.e.length<t;)e.e.push(0)},ab:function(e,t){if(e.o!=t)if(0==t)e.e=null,e.o=0;else{if(!e.e||e.e.subarray){var r=e.e;e.e=new Uint8Array(new ArrayBuffer(t)),r&&e.e.set(r.subarray(0,Math.min(t,e.o)))}else if(e.e||(e.e=[]),e.e.length>t)e.e.length=t;else for(;e.e.length<t;)e.e.push(0);e.o=t}},k:{D:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.o:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Pa=4096,t.blocks=Math.ceil(t.size/t.Pa),t},p:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&P.ab(e,t.size)},lookup:function(){throw vb[M.B]},V:function(e,t,r,n){return P.createNode(e,t,r,n)},rename:function(e,t,r){if(16384==(61440&e.mode)){var n;try{n=wb(t,r)}catch(e){}if(n)for(var i in n.e)throw new O(M.ra)}delete e.parent.e[e.name],e.name=r,t.e[r]=e,e.parent=t},unlink:function(e,t){delete e.e[t]},rmdir:function(e,t){var r,n=wb(e,t);for(r in n.e)throw new O(M.ra);delete e.e[t]},readdir:function(e){var t,r=[".",".."];for(t in e.e)e.e.hasOwnProperty(t)&&r.push(t);return r},symlink:function(e,t,r){return(e=P.createNode(e,t,41471,0)).link=r,e},readlink:function(e){if(40960!=(61440&e.mode))throw new O(M.u);return e.link}},n:{read:function(e,t,r,n,i){var a=e.g.e;if(i>=e.g.o)return 0;if(assert(0<=(e=Math.min(e.g.o-i,n))),8<e&&a.subarray)t.set(a.subarray(i,i+e),r);else for(n=0;n<e;n++)t[r+n]=a[i+n];return e},write:function(e,t,r,n,i,a){if(!n)return 0;if((e=e.g).timestamp=Date.now(),t.subarray&&(!e.e||e.e.subarray)){if(a)return e.e=t.subarray(r,r+n),e.o=n;if(0===e.o&&0===i)return e.e=new Uint8Array(t.subarray(r,r+n)),e.o=n;if(i+n<=e.o)return e.e.set(t.subarray(r,r+n),i),n}if(P.ya(e,i+n),e.e.subarray&&t.subarray)e.e.set(t.subarray(r,r+n),i);else for(a=0;a<n;a++)e.e[i+a]=t[r+a];return e.o=Math.max(e.o,i+n),n},I:function(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.g.mode)&&(t+=e.g.o),0>t)throw new O(M.u);return t},ta:function(e,t,r){P.ya(e.g,t+r),e.g.o=Math.max(e.g.o,t+r)},Ea:function(e,t,r,n,i,a,o){if(32768!=(61440&e.g.mode))throw new O(M.ba);if(r=e.g.e,2&o||r.buffer!==t&&r.buffer!==t.buffer){if((0<i||i+n<e.g.o)&&(r=r.subarray?r.subarray(i,i+n):Array.prototype.slice.call(r,i,i+n)),e=!0,!(n=ua(n)))throw new O(M.Ka);t.set(r,n)}else e=!1,n=r.byteOffset;return{Cd:n,gd:e}},Ga:function(e,t,r,n,i){if(32768!=(61440&e.g.mode))throw new O(M.ba);return 2&i||P.n.write(e,t,0,n,r,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(e,t){if(t=t||{},!(e=mb("/",e)))return{path:"",g:null};var r,n={za:!0,ka:0};for(r in n)void 0===t[r]&&(t[r]=n[r]);if(8<t.ka)throw new O(M.aa);n=jb(e.split("/").filter((function(e){return!!e})),!1);var i=xb;r="/";for(var a=0;a<n.length;a++){var o=a===n.length-1;if(o&&t.parent)break;if(i=wb(i,n[a]),r=N(r+"/"+n[a]),i.R&&(!o||o&&t.za)&&(i=i.R.root),!o||t.ga)for(o=0;40960==(61440&i.mode);)if(i=Db(r),i=T(r=mb(kb(r),i),{ka:t.ka}).g,40<o++)throw new O(M.aa)}return{path:r,g:i}}function U(e){for(var t;;){if(e===e.parent)return e=e.A.Fa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function Eb(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%R.length}function Fb(e){var t=Eb(e.parent.id,e.name);e.K=R[t],R[t]=e}function wb(e,t){var r;if(r=(r=Gb(e,"x"))?r:e.k.lookup?0:M.Y)throw new O(r,e);for(r=R[Eb(e.id,t)];r;r=r.K){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.k.lookup(e,t)}function ub(e,t,r,n){return Hb||((Hb=function(e,t,r,n){e||(e=this),this.parent=e,this.A=e.A,this.R=null,this.id=Ab++,this.name=t,this.mode=r,this.k={},this.n={},this.rdev=n}).prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384==(61440&this.mode)}},Ca:{get:function(){return 8192==(61440&this.mode)}}})),Fb(e=new Hb(e,t,r,n)),e}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(e,t){return Cb||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:M.Y}function Jb(e,t){try{return wb(e,t),M.pa}catch(e){}return Gb(e,"wx")}function Kb(){for(var e=0;e<=4096;e++)if(!zb[e])return e;throw new O(M.Ja)}function Lb(e){Mb||((Mb=function(){}).prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(e){this.g=e}},vd:{get:function(){return 1!=(2097155&this.flags)}},wd:{get:function(){return 0!=(2097155&this.flags)}},ud:{get:function(){return 1024&this.flags}}}));var t,r=new Mb;for(t in e)r[t]=e[t];return e=r,r=Kb(),e.fd=r,zb[r]=e}var tb={open:function(e){e.n=yb[e.g.rdev].n,e.n.open&&e.n.open(e)},I:function(){throw new O(M.da)}},Zb;function pb(e,t){yb[e]={n:t}}function Nb(e,t){var r,n="/"===t,i=!t;if(n&&xb)throw new O(M.$);if(!n&&!i){if(t=(r=T(t,{za:!1})).path,(r=r.g).R)throw new O(M.$);if(16384!=(61440&r.mode))throw new O(M.qa)}i={type:e,Ad:{},Fa:t,Ya:[]};var a=e.A(i);a.A=i,i.root=a,n?xb=a:r&&(r.R=i,r.A&&r.A.Ya.push(i))}function Ob(e,t,r){var n=T(e,{parent:!0}).g;if(!(e=lb(e))||"."===e||".."===e)throw new O(M.u);var i=Jb(n,e);if(i)throw new O(i);if(!n.k.V)throw new O(M.G);return n.k.V(n,e,t,r)}function Pb(e,t){return t=4095&(void 0!==t?t:438),Ob(e,t|=32768,0)}function V(e,t){return t=1023&(void 0!==t?t:511),Ob(e,t|=16384,0)}function Qb(e,t,r){return void 0===r&&(r=t,t=438),Ob(e,8192|t,r)}function Rb(e,t){if(!mb(e))throw new O(M.B);var r=T(t,{parent:!0}).g;if(!r)throw new O(M.B);var n=lb(t),i=Jb(r,n);if(i)throw new O(i);if(!r.k.symlink)throw new O(M.G);return r.k.symlink(r,n,e)}function Db(e){if(!(e=T(e).g))throw new O(M.B);if(!e.k.readlink)throw new O(M.u);return mb(U(e.parent),e.k.readlink(e))}function Sb(e,t){var r;if(!(r="string"==typeof e?T(e,{ga:!0}).g:e).k.p)throw new O(M.G);r.k.p(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})}function Tb(t,r){var n,i,a;if(""===t)throw new O(M.B);if("string"==typeof r){if(void 0===(i=Ib[r]))throw Error("Unknown file open mode: "+r)}else i=r;if(n=64&(r=i)?4095&(void 0===n?438:n)|32768:0,"object"==typeof t)a=t;else{t=N(t);try{a=T(t,{ga:!(131072&r)}).g}catch(e){}}if(i=!1,64&r)if(a){if(128&r)throw new O(M.pa)}else a=Ob(t,n,0),i=!0;if(!a)throw new O(M.B);if(8192==(61440&a.mode)&&(r&=-513),65536&r&&16384!=(61440&a.mode))throw new O(M.qa);if(!i&&(a?40960==(61440&a.mode)?n=M.aa:16384==(61440&a.mode)&&(0!=(2097155&r)||512&r)?n=M.N:(n=["r","w","rw"][3&r],512&r&&(n+="w"),n=Gb(a,n)):n=M.B,n))throw new O(n);if(512&r){var o;if(!(o="string"==typeof(n=a)?T(n,{ga:!0}).g:n).k.p)throw new O(M.G);if(16384==(61440&o.mode))throw new O(M.N);if(32768!=(61440&o.mode))throw new O(M.u);if(n=Gb(o,"w"))throw new O(n);o.k.p(o,{size:0,timestamp:Date.now()})}r&=-641,(a=Lb({g:a,path:U(a),flags:r,seekable:!0,position:0,n:a.n,eb:[],error:!1})).n.open&&a.n.open(a),!e.logReadFiles||1&r||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(o=0,1!=(2097155&r)&&(o|=1),0!=(2097155&r)&&(o|=2),S.onOpenFile(t,o))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return a}function Vb(e){e.ia&&(e.ia=null);try{e.n.close&&e.n.close(e)}catch(e){throw e}finally{zb[e.fd]=null}}function Wb(e,t,r){if(!e.seekable||!e.n.I)throw new O(M.da);e.position=e.n.I(e,t,r),e.eb=[]}function Xb(e,t,r,n,i,a){if(0>n||0>i)throw new O(M.u);if(0==(2097155&e.flags))throw new O(M.Z);if(16384==(61440&e.g.mode))throw new O(M.N);if(!e.n.write)throw new O(M.u);1024&e.flags&&Wb(e,0,2);var o=!0;if(void 0===i)i=e.position,o=!1;else if(!e.seekable)throw new O(M.da);t=e.n.write(e,t,r,n,i,a),o||(e.position+=t);try{e.path&&S.onWriteToFile&&S.onWriteToFile(e.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+path+"') threw an exception: "+e.message)}return t}function Yb(){O||((O=function(e,t){this.g=t,this.bb=function(e){for(var t in this.Q=e,M)if(M[t]===e){this.code=t;break}},this.bb(e),this.message=hb[e]}).prototype=Error(),O.prototype.constructor=O,[M.B].forEach((function(e){vb[e]=new O(e),vb[e].stack="<generic error, no stack>"})))}function $b(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r}function ac(e,t,r,n){return Pb(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))}function bc(e,t,r,n,i,a){if(i=Pb(e=t?N(("string"==typeof e?e:U(e))+"/"+t):e,n=$b(n,i)),r){if("string"==typeof r){e=Array(r.length),t=0;for(var o=r.length;t<o;++t)e[t]=r.charCodeAt(t);r=e}Sb(i,146|n),Xb(e=Tb(i,"w"),r,0,r.length,0,a),Vb(e),Sb(i,n)}return i}function W(e,t,r,n){e=N(("string"==typeof e?e:U(e))+"/"+t),t=$b(!!r,!!n),W.Da||(W.Da=64);var i=W.Da++<<8|0;return pb(i,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,i){for(var a=0,o=0;o<i;o++){var s;try{s=r()}catch(e){throw new O(M.F)}if(void 0===s&&0===a)throw new O(M.oa);if(null==s)break;a++,t[n+o]=s}return a&&(e.g.timestamp=Date.now()),a},write:function(e,t,r,i){for(var a=0;a<i;a++)try{n(t[r+a])}catch(e){throw new O(M.F)}return i&&(e.g.timestamp=Date.now()),a}}),Qb(e,t,i)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var r=!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!e.read)throw Error("Cannot load without read() or XMLHttpRequest.");try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(e){r=!1}return r||ib(M.F),r}var dc={},Hb,Mb,Ub,ec=0;function X(){return F[(ec+=4)-4>>2]}function fc(){var e;if(e=X(),!(e=zb[e]))throw new O(M.Z);return e}function wa(e){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var t=v;return 0==e||wa.Ra(e)?t:4294967295}function hc(e,t){if(ic=e,jc=t,!kc)return 1;if(0==e)Y=function(){setTimeout(lc,t)},mc="timeout";else if(1==e)Y=function(){nc(lc)},mc="rAF";else if(2==e){if(!window.setImmediate){var r=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),r.shift()())}),!0),window.setImmediate=function(e){r.push(e),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,i,a,o){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=a;var s=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),i=rc.shift();if(i.Qa(i.T),sc){var o=sc,l=0==o%1?o-1:Math.floor(o);sc=i.ld?l:(8*o+(l+.5))/9}console.log('main loop blocker "'+i.name+'" took '+(Date.now()-r)+" ms"),tc(),setTimeout(lc,0)}else s<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc((function(){void 0!==a?n.J("vi",t,[a]):n.J("v",t)})),s<qc||("object"==typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},o||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),i)throw"SimulateInfiniteLoop"}e._memcpy=gc;var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=sc,n=wc.nd;r?r<n?e.setStatus(t+" ("+(n-r)+"/"+n+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{t()}catch(t){if(t instanceof xc)return;throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(e){Dc=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,e.Ha||void 0!==Fc||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,i,a){var o=null;if(Dc)try{(o=new Blob([t],{type:Gc(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(e){n.M("Blob constructor present but fails: "+e+"; falling back to blob builder")}o||((o=new Ec).append(new Uint8Array(t).buffer),o=o.getBlob());var s=Fc.createObjectURL(o),l=new Image;l.onload=function(){assert(l.complete,"Image "+r+" could not be decoded");var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=n,Fc.revokeObjectURL(s),i&&i(t)},l.onerror=function(){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,r,n,i){function a(i){s||(s=!0,e.preloadedAudios[r]=i,n&&n(t))}function o(){s||(s=!0,e.preloadedAudios[r]=new Audio,i&&i())}var s=!1;if(!Dc)return o();try{var l=new Blob([t],{type:Gc(r)})}catch(e){return o()}l=Fc.createObjectURL(l);var c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(){if(!s){console.log("warning: browser could not fully decode audio "+r+", trying slower base64 approach");for(var e="",n=0,i=0,o=0;o<t.length;o++)for(n=n<<8|t[o],i+=8;6<=i;){var l=n>>i-6&63;i=i-6,e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==i?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&n)<<4],e+="=="):4==i&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&n)<<2],e+="="),c.src="data:audio/x-"+r.substr(-3)+";base64,"+e,a(c)}},c.src=l,Hc((function(){a(c)}))}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",(function(e){!zc&&r.la&&(r.la(),e.preventDefault())}),!1))}}function Ic(t,r,n,i){if(r&&e.fa&&t==e.canvas)return e.fa;var a,o;if(r){if(o={antialias:!1,alpha:!1},i)for(var s in i)o[s]=i[s];(o=GL.createContext(t,o))&&(a=GL.getContext(o).cd),t.style.backgroundColor="black"}else a=t.getContext("2d");return a?(n&&(r||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=a,r&&GL.yd(o),e.Dd=r,Ac.forEach((function(e){e()})),Bc()),a):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,r,n){function i(){yc=!1;var t=a.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(a.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},a.ua=a.ua.bind(document),Kc&&a.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(a)}void 0===(Kc=t)&&(Kc=!0),void 0===(Lc=r)&&(Lc=!1),void 0===(Qc=n)&&(Qc=null);var a=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.C=o.requestFullScreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n?o.C({Ed:n}):o.C()}var Rc=0;function Sc(e){var t=Date.now();if(0===Rc)Rc=t+1e3/60;else for(;t+2>=Rc;)Rc+=1e3/60;t=Math.max(Rc-t,0),setTimeout(e,t)}function nc(e){"undefined"==typeof window?Sc(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(e))}function Hc(t){e.noExitRuntime=!0,setTimeout((function(){A||t()}),1e4)}function Gc(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function Tc(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)}function Uc(e,t,r){Tc(e,(function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),Za()}),(function(){if(!r)throw'Loading data file "'+e+'" failed.';r()})),Ya()}var Vc=[],Cc,Dc,Ec,Fc,Qc;function Wc(){var t=e.canvas;Vc.forEach((function(e){e(t.width,t.height)}))}function Nc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=8388608|e}Wc()}function Oc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=-8388609&e}Wc()}function Pc(t,r,n){r&&n?(t.fb=r,t.Va=n):(r=t.fb,n=t.Va);var i=r,a=n;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(i/a<e.forcedAspectRatio?i=Math.round(a*e.forcedAspectRatio):a=Math.round(i/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/i,screen.height/a);i=Math.round(i*o),a=Math.round(a*o)}Lc?(t.width!=i&&(t.width=i),t.height!=a&&(t.height=a),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=n&&(t.height=n),void 0!==t.style&&(i!=r||a!=n?(t.style.setProperty("width",i+"px","important"),t.style.setProperty("height",a+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),function(){var e;if(V("/dev"),pb(259,{read:function(){return 0},write:function(e,t,r,n){return n}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536),"undefined"!=typeof crypto){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}else e=function(){return 256*Math.random()|0};W("/dev","random",e),W("/dev","urandom",e),V("/dev/shm"),V("/dev/shm/tmp")}(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var e=ub("/proc/self","fd",16895,73);return e.k={lookup:function(e,t){var r=zb[+t];if(!r)throw new O(M.Z);var n={parent:null,A:{Fa:"fake"},k:{readlink:function(){return r.path}}};return n.parent=n}},e}},"/proc/self/fd"),Qa.unshift((function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(0===t.fd,"invalid handle for stdin ("+t.fd+")"),assert(1===(t=Tb("/dev/stdout","w")).fd,"invalid handle for stdout ("+t.fd+")"),assert(2===(t=Tb("/dev/stderr","w")).fd,"invalid handle for stderr ("+t.fd+")")}})),Ra.push((function(){Cb=!1})),K.push((function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var r=zb[t];r&&Vb(r)}})),e.FS_createFolder=function(e,t,r,n){return V(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))},e.FS_createPath=function(e,t){e="string"==typeof e?e:U(e);for(var r=t.split("/").reverse();r.length;){var n=r.pop();if(n){var i=N(e+"/"+n);try{V(i)}catch(e){}e=i}}return i},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,r,n,i,a,o,s,l,c,d){function u(n){function u(e){d&&d(),l||bc(t,r,e,i,a,c),o&&o(),Za()}var f=!1;e.preloadPlugins.forEach((function(e){!f&&e.canHandle(p)&&(e.handle(n,p,u,(function(){s&&s(),Za()})),f=!0)})),f||u(n)}Bc();var p=r?mb(N(t+"/"+r)):t;Ya(),"string"==typeof n?Uc(n,(function(e){u(e)}),s):u(n)},e.FS_createLazyFile=function(e,t,r,n,i){if("undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";r={Ca:!1,url:r};var a=ac(e,t,n,i);r.e?a.e=r.e:r.url&&(a.e=null,a.url=r.url),Object.defineProperty(a,"usedBytes",{get:function(){return this.e.length}});var o={};return Object.keys(a.n).forEach((function(e){var t=a.n[e];o[e]=function(){if(!cc(a))throw new O(M.F);return t.apply(null,arguments)}})),o.read=function(e,t,r,n,i){if(!cc(a))throw new O(M.F);if(i>=(e=e.g.e).length)return 0;if(assert(0<=(n=Math.min(e.length-i,n))),e.slice)for(var o=0;o<n;o++)t[r+o]=e[i+o];else for(o=0;o<n;o++)t[r+o]=e.get(i+o);return n},a.n=o,a},e.FS_createLink=function(e,t,r){return Rb(r,e=N(("string"==typeof e?e:U(e))+"/"+t))},e.FS_createDevice=W,e.FS_unlink=function(e){var t,r=T(e,{parent:!0}).g,n=lb(e),i=wb(r,n);e:{try{t=wb(r,n)}catch(e){t=e.Q;break e}var a=Gb(r,"wx");t=a||(16384==(61440&t.mode)?M.N:0)}if(t)throw t===M.N&&(t=M.G),new O(t);if(!r.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(e)}catch(t){console.log("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}if(r.k.unlink(r,n),r=Eb(i.parent.id,i.name),R[r]===i)R[r]=i.K;else for(r=R[r];r;){if(r.K===i){r.K=i.K;break}r=r.K}try{S.onDeletePath&&S.onDeletePath(e)}catch(t){console.log("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},Qa.unshift((function(){})),K.push((function(){})),e.requestFullScreen=function(e,t,r){Mc(e,t,r)},e.requestAnimationFrame=function(e){nc(e)},e.setCanvasSize=function(t,r,n){Pc(e.canvas,t,r),n||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var e=ic,t=jc,r=kc;kc=null,oc(r,0,!1,pc,!0),hc(e,t),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(e,t,r,n){return Ic(e,t,r,n)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert,invoke_ii:function(t,r){try{return e.dynCall_ii(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_iiii:function(t,r,n,i){try{return e.dynCall_iiii(t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_vi:function(t,r){try{e.dynCall_vi(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(e,t){ec=t;try{return Vb(fc()),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(e){var t=Date.now()/1e3|0;return e&&(F[e>>2]=t),t},___setErrNo:ib,_emscripten_memcpy_big:function(e,t,r){return H.set(H.subarray(t,t+r),e),e},___syscall54:function(e,t){ec=t;try{var r=fc(),n=X();switch(n){case 21505:case 21506:return r.tty?0:-M.O;case 21519:if(!r.tty)return-M.O;var i=X();return F[i>>2]=0;case 21520:return r.tty?-M.u:-M.O;case 21531:if(i=X(),!r.n.Wa)throw new O(M.O);return r.n.Wa(r,n,i);default:z("bad ioctl syscall "+n)}}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},___unlock:function(){},___syscall140:function(e,t){ec=t;try{var r=fc(),n=X(),i=X(),a=X(),o=X();return assert(0===n),Wb(r,i,o),F[a>>2]=r.position,r.ia&&0===i&&0===o&&(r.ia=null),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_pthread_cleanup_push:eb,_sysconf:function(e){switch(e){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(e,t){ec=t;try{var r,n=fc(),i=X();e:{for(var a=X(),o=0,s=0;s<a;s++){var l=Xb(n,D,F[i+8*s>>2],F[i+(8*s+4)>>2],void 0);if(0>l){r=-1;break e}o+=l}r=o}return r}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(e,t,r){var n=new e.Int8Array(r),i=(new e.Int16Array(r),new e.Int32Array(r)),a=new e.Uint8Array(r),o=(new e.Uint16Array(r),new e.Uint32Array(r),new e.Float32Array(r),new e.Float64Array(r),0|t.STACKTOP),s=(t.STACK_MAX,t.tempDoublePtr,t.ABORT,t.cttz_i8,0),l=(e.NaN,e.Infinity,0),c=(e.Math.floor,e.Math.abs,e.Math.sqrt,e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil,e.Math.imul),d=(e.Math.min,e.Math.clz32,t.abort),u=(t.assert,t.invoke_ii,t.invoke_iiii,t.invoke_vi,t._pthread_cleanup_pop),p=t.___lock,f=(t._emscripten_set_main_loop,t._pthread_self),_=t.___syscall6,h=(t._emscripten_set_main_loop_timing,t._abort),g=t._sbrk,m=t._time,y=(t.___setErrNo,t._emscripten_memcpy_big),E=t.___syscall54,S=t.___unlock,v=t.___syscall140,T=t._pthread_cleanup_push,C=t._sysconf,A=t.___syscall146;function b(e,t,r){e|=0;var n,a=0,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0;n=o,o=o+160|0,P(a=n,t|=0,r|=0),t=0|i[(r=a+144|0)>>2],s=0|i[r+4>>2],d=0|i[(c=r=a+64|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|s,18,0),p=l,f=0|G(0|d,0|u,0|t,0|s),s=0|G(0|f,0|l,0|c,0|p),i[(p=r)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+136|0)>>2],r=0|i[p+4>>2],f=0|i[(c=p=a+56|0)>>2],t=0|i[c+4>>2],c=0|B(0|s,0|r,18,0),u=l,d=0|G(0|f,0|t,0|s,0|r),r=0|G(0|d,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+128|0)>>2],p=0|i[u+4>>2],d=0|i[(c=u=a+48|0)>>2],s=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,f=0|G(0|d,0|s,0|r,0|p),p=0|G(0|f,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,p=0|i[(t=a+120|0)>>2],u=0|i[t+4>>2],f=0|i[(c=t=a+40|0)>>2],r=0|i[c+4>>2],c=0|B(0|p,0|u,18,0),s=l,d=0|G(0|f,0|r,0|p,0|u),u=0|G(0|d,0|l,0|c,0|s),i[(s=t)>>2]=u,i[s+4>>2]=l,u=0|i[(s=a+112|0)>>2],t=0|i[s+4>>2],d=0|i[(c=s=a+32|0)>>2],p=0|i[c+4>>2],c=0|B(0|u,0|t,18,0),r=l,f=0|G(0|d,0|p,0|u,0|t),t=0|G(0|f,0|l,0|c,0|r),i[(r=s)>>2]=t,i[r+4>>2]=l,t=0|i[(r=a+104|0)>>2],s=0|i[r+4>>2],f=0|i[(c=r=a+24|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|s,18,0),p=l,d=0|G(0|f,0|u,0|t,0|s),s=0|G(0|d,0|l,0|c,0|p),i[(p=r)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+96|0)>>2],r=0|i[p+4>>2],d=0|i[(c=p=a+16|0)>>2],t=0|i[c+4>>2],c=0|B(0|s,0|r,18,0),u=l,f=0|G(0|d,0|t,0|s,0|r),r=0|G(0|f,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+88|0)>>2],p=0|i[u+4>>2],f=0|i[(c=u=a+8|0)>>2],s=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,d=0|G(0|f,0|s,0|r,0|p),p=0|G(0|d,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,c=0|i[(p=t=a+80|0)>>2],d=0|i[p+4>>2],r=0|i[(p=a)>>2],s=0|i[p+4>>2],p=0|B(0|c,0|d,18,0),f=l,_=0|G(0|r,0|s,0|c,0|d),d=0|G(0|_,0|l,0|p,0|f),f=l,i[(p=a)>>2]=d,i[p+4>>2]=f,i[(p=t)>>2]=0,i[p+4>>2]=0,p=f,f=d,d=0;do{r=0|k(0|f,0|p,0|(s=0|x(0|(c=0|L(0|(_=0|G(p>>31>>>6|0,0,0|f,0|p)),0|l,26)),0|(_=l),26)),0|l),i[(s=a+(d<<3)|0)>>2]=r,i[s+4>>2]=l,m=0|k(0|(h=0|G(0|c,0|_,0|i[(r=s=a+((1|d)<<3)|0)>>2],0|i[r+4>>2])),0|(r=l),0|(g=0|x(0|(c=0|L(0|(_=0|G(r>>31>>>7|0,0,0|h,0|r)),0|l,25)),0|(_=l),25)),0|l),i[(g=s)>>2]=m,i[g+4>>2]=l,f=0|G(0|c,0|_,0|i[(m=g=a+((d=d+2|0)<<3)|0)>>2],0|i[m+4>>2]),p=l,i[(m=g)>>2]=f,i[m+4>>2]=p}while(d>>>0<10);p=0|i[(d=t)>>2],f=0|i[d+4>>2],m=0|i[(d=a)>>2],g=0|i[d+4>>2],d=0|B(0|p,0|f,18,0),_=l,c=0|G(0|m,0|g,0|p,0|f),f=0|G(0|c,0|l,0|d,0|_),_=l,i[(d=t)>>2]=0,i[d+4>>2]=0,p=0|k(0|f,0|_,0|(c=0|x(0|(t=0|L(0|(d=0|G(_>>31>>>6|0,0,0|f,0|_)),0|l,26)),0|(d=l),26)),0|l),i[(c=a)>>2]=p,i[c+4>>2]=l,p=0|G(0|t,0|d,0|i[(c=u)>>2],0|i[c+4>>2]),i[(c=u)>>2]=p,i[c+4>>2]=l,c=e,e=a,a=c+80|0;do{i[c>>2]=i[e>>2],c=c+4|0,e=e+4|0}while((0|c)<(0|a));o=n}function P(e,t,r){e|=0,r|=0;var n=0,a=0,o=0,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0;n=0|L(0,0|i[(t|=0)>>2],32),a=l,s=0|B(0|(o=0|L(0,0|i[r>>2],32)),0|l,0|n,0|a),i[(a=e)>>2]=s,i[a+4>>2]=l,a=0|L(0,0|i[t>>2],32),s=l,c=0|B(0|(o=0|L(0,0|i[(n=r+8|0)>>2],32)),0|l,0|a,0|s),s=l,o=0|L(0,0|i[(a=t+8|0)>>2],32),d=l,d=0|G(0|(p=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|o,0|d)),0|l,0|c,0|s),i[(s=e+8|0)>>2]=d,i[s+4>>2]=l,s=0|L(0,0|i[a>>2],31),d=l,p=0|B(0|(c=0|L(0,0|i[n>>2],32)),0|l,0|s,0|d),d=l,s=0|L(0,0|i[t>>2],32),c=l,c=0|G(0|(f=0|B(0|(u=0|L(0,0|i[(o=r+16|0)>>2],32)),0|l,0|s,0|c)),0|l,0|p,0|d),d=l,f=0|L(0,0|i[(p=t+16|0)>>2],32),s=l,s=0|G(0|c,0|d,0|(_=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|f,0|s)),0|l),i[(_=e+16|0)>>2]=s,i[_+4>>2]=l,_=0|L(0,0|i[a>>2],32),s=l,c=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|_,0|s),s=l,_=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|(u=0|B(0|(f=0|L(0,0|i[n>>2],32)),0|l,0|_,0|d)),0|l,0|c,0|s),s=l,c=0|L(0,0|i[t>>2],32),u=l,u=0|G(0|d,0|s,0|(h=0|B(0|(f=0|L(0,0|i[(_=r+24|0)>>2],32)),0|l,0|c,0|u)),0|l),h=l,d=0|L(0,0|i[(s=t+24|0)>>2],32),c=l,c=0|G(0|u,0|h,0|(g=0|B(0|(f=0|L(0,0|i[r>>2],32)),0|l,0|d,0|c)),0|l),i[(g=e+24|0)>>2]=c,i[g+4>>2]=l,g=0|L(0,0|i[p>>2],32),c=l,u=0|B(0|(h=0|L(0,0|i[o>>2],32)),0|l,0|g,0|c),c=l,g=0|L(0,0|i[a>>2],32),h=l,f=0|B(0|(d=0|L(0,0|i[_>>2],32)),0|l,0|g,0|h),h=l,g=0|L(0,0|i[s>>2],32),d=l,d=0|G(0|(y=0|B(0|(m=0|L(0,0|i[n>>2],32)),0|l,0|g,0|d)),0|l,0|f,0|h),d=0|G(0|(h=0|x(0|d,0|l,1)),0|l,0|u,0|c),c=l,u=0|L(0,0|i[t>>2],32),h=l,h=0|G(0|d,0|c,0|(g=0|B(0|(y=0|L(0,0|i[(f=r+32|0)>>2],32)),0|l,0|u,0|h)),0|l),g=l,d=0|L(0,0|i[(c=t+32|0)>>2],32),u=l,u=0|G(0|h,0|g,0|(m=0|B(0|(y=0|L(0,0|i[r>>2],32)),0|l,0|d,0|u)),0|l),i[(m=e+32|0)>>2]=u,i[m+4>>2]=l,m=0|L(0,0|i[p>>2],32),u=l,h=0|B(0|(g=0|L(0,0|i[_>>2],32)),0|l,0|m,0|u),u=l,m=0|L(0,0|i[s>>2],32),g=l,g=0|G(0|(y=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|m,0|g)),0|l,0|h,0|u),u=l,h=0|L(0,0|i[a>>2],32),y=l,y=0|G(0|g,0|u,0|(d=0|B(0|(m=0|L(0,0|i[f>>2],32)),0|l,0|h,0|y)),0|l),d=l,u=0|L(0,0|i[c>>2],32),g=l,g=0|G(0|y,0|d,0|(m=0|B(0|(h=0|L(0,0|i[n>>2],32)),0|l,0|u,0|g)),0|l),m=l,d=0|L(0,0|i[t>>2],32),y=l,y=0|G(0|g,0|m,0|(E=0|B(0|(h=0|L(0,0|i[(u=r+40|0)>>2],32)),0|l,0|d,0|y)),0|l),E=l,g=0|L(0,0|i[(m=t+40|0)>>2],32),d=l,d=0|G(0|y,0|E,0|(S=0|B(0|(h=0|L(0,0|i[r>>2],32)),0|l,0|g,0|d)),0|l),i[(S=e+40|0)>>2]=d,i[S+4>>2]=l,S=0|L(0,0|i[s>>2],32),d=l,y=0|B(0|(E=0|L(0,0|i[_>>2],32)),0|l,0|S,0|d),d=l,S=0|L(0,0|i[a>>2],32),E=l,E=0|G(0|(h=0|B(0|(g=0|L(0,0|i[u>>2],32)),0|l,0|S,0|E)),0|l,0|y,0|d),d=l,y=0|L(0,0|i[m>>2],32),h=l,g=0|x(0|(h=0|G(0|E,0|d,0|(g=0|B(0|(S=0|L(0,0|i[n>>2],32)),0|l,0|y,0|h)),0|l)),0|l,1),h=l,d=0|L(0,0|i[p>>2],32),E=l,E=0|G(0|g,0|h,0|(S=0|B(0|(y=0|L(0,0|i[f>>2],32)),0|l,0|d,0|E)),0|l),S=l,h=0|L(0,0|i[c>>2],32),g=l,g=0|G(0|E,0|S,0|(y=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|h,0|g)),0|l),y=l,S=0|L(0,0|i[t>>2],32),E=l,E=0|G(0|g,0|y,0|(v=0|B(0|(d=0|L(0,0|i[(h=r+48|0)>>2],32)),0|l,0|S,0|E)),0|l),v=l,g=0|L(0,0|i[(y=t+48|0)>>2],32),S=l,S=0|G(0|E,0|v,0|(T=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|g,0|S)),0|l),i[(T=e+48|0)>>2]=S,i[T+4>>2]=l,T=0|L(0,0|i[s>>2],32),S=l,E=0|B(0|(v=0|L(0,0|i[f>>2],32)),0|l,0|T,0|S),S=l,T=0|L(0,0|i[c>>2],32),v=l,v=0|G(0|(d=0|B(0|(g=0|L(0,0|i[_>>2],32)),0|l,0|T,0|v)),0|l,0|E,0|S),S=l,E=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|v,0|S,0|(g=0|B(0|(T=0|L(0,0|i[u>>2],32)),0|l,0|E,0|d)),0|l),g=l,S=0|L(0,0|i[m>>2],32),v=l,v=0|G(0|d,0|g,0|(T=0|B(0|(E=0|L(0,0|i[o>>2],32)),0|l,0|S,0|v)),0|l),T=l,g=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|v,0|T,0|(E=0|B(0|(S=0|L(0,0|i[h>>2],32)),0|l,0|g,0|d)),0|l),E=l,T=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|d,0|E,0|(S=0|B(0|(g=0|L(0,0|i[n>>2],32)),0|l,0|T,0|v)),0|l),S=l,E=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|v,0|S,0|(C=0|B(0|(g=0|L(0,0|i[(T=r+56|0)>>2],32)),0|l,0|E,0|d)),0|l),C=l,v=0|L(0,0|i[(S=t+56|0)>>2],32),E=l,E=0|G(0|d,0|C,0|(A=0|B(0|(g=0|L(0,0|i[r>>2],32)),0|l,0|v,0|E)),0|l),i[(A=e+56|0)>>2]=E,i[A+4>>2]=l,A=0|L(0,0|i[c>>2],32),E=l,d=0|B(0|(C=0|L(0,0|i[f>>2],32)),0|l,0|A,0|E),E=l,A=0|L(0,0|i[s>>2],32),C=l,g=0|B(0|(v=0|L(0,0|i[u>>2],32)),0|l,0|A,0|C),C=l,A=0|L(0,0|i[m>>2],32),v=l,v=0|G(0|(P=0|B(0|(b=0|L(0,0|i[_>>2],32)),0|l,0|A,0|v)),0|l,0|g,0|C),C=l,g=0|L(0,0|i[a>>2],32),P=l,P=0|G(0|v,0|C,0|(b=0|B(0|(A=0|L(0,0|i[T>>2],32)),0|l,0|g,0|P)),0|l),b=l,C=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|P,0|b,0|(A=0|B(0|(g=0|L(0,0|i[n>>2],32)),0|l,0|C,0|v)),0|l),v=0|G(0|(A=0|x(0|v,0|l,1)),0|l,0|d,0|E),E=l,d=0|L(0,0|i[p>>2],32),A=l,A=0|G(0|v,0|E,0|(P=0|B(0|(b=0|L(0,0|i[h>>2],32)),0|l,0|d,0|A)),0|l),P=l,E=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|A,0|P,0|(b=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|E,0|v)),0|l),b=l,P=0|L(0,0|i[t>>2],32),A=l,A=0|G(0|v,0|b,0|(C=0|B(0|(d=0|L(0,0|i[(E=r+64|0)>>2],32)),0|l,0|P,0|A)),0|l),C=l,v=0|L(0,0|i[(b=t+64|0)>>2],32),P=l,P=0|G(0|A,0|C,0|(g=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|v,0|P)),0|l),i[(g=e+64|0)>>2]=P,i[g+4>>2]=l,g=0|L(0,0|i[c>>2],32),P=l,A=0|B(0|(C=0|L(0,0|i[u>>2],32)),0|l,0|g,0|P),P=l,g=0|L(0,0|i[m>>2],32),C=l,C=0|G(0|(d=0|B(0|(v=0|L(0,0|i[f>>2],32)),0|l,0|g,0|C)),0|l,0|A,0|P),P=l,A=0|L(0,0|i[s>>2],32),d=l,d=0|G(0|C,0|P,0|(v=0|B(0|(g=0|L(0,0|i[h>>2],32)),0|l,0|A,0|d)),0|l),v=l,P=0|L(0,0|i[y>>2],32),C=l,C=0|G(0|d,0|v,0|(g=0|B(0|(A=0|L(0,0|i[_>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|C,0|g,0|(A=0|B(0|(P=0|L(0,0|i[T>>2],32)),0|l,0|v,0|d)),0|l),A=l,g=0|L(0,0|i[S>>2],32),C=l,C=0|G(0|d,0|A,0|(P=0|B(0|(v=0|L(0,0|i[o>>2],32)),0|l,0|g,0|C)),0|l),P=l,A=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|C,0|P,0|(v=0|B(0|(g=0|L(0,0|i[E>>2],32)),0|l,0|A,0|d)),0|l),v=l,P=0|L(0,0|i[b>>2],32),C=l,C=0|G(0|d,0|v,0|(g=0|B(0|(A=0|L(0,0|i[n>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|C,0|g,0|(M=0|B(0|(A=0|L(0,0|i[(P=r+72|0)>>2],32)),0|l,0|v,0|d)),0|l),M=l,t=0|L(0,0|i[(g=t+72|0)>>2],32),C=l,C=0|G(0|d,0|M,0|(r=0|B(0|(v=0|L(0,0|i[r>>2],32)),0|l,0|t,0|C)),0|l),i[(r=e+72|0)>>2]=C,i[r+4>>2]=l,r=0|L(0,0|i[m>>2],32),C=l,d=0|B(0|(M=0|L(0,0|i[u>>2],32)),0|l,0|r,0|C),C=l,r=0|L(0,0|i[s>>2],32),M=l,M=0|G(0|(v=0|B(0|(t=0|L(0,0|i[T>>2],32)),0|l,0|r,0|M)),0|l,0|d,0|C),C=l,d=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|M,0|C,0|(t=0|B(0|(r=0|L(0,0|i[_>>2],32)),0|l,0|d,0|v)),0|l),t=l,C=0|L(0,0|i[a>>2],32),a=l,a=0|G(0|v,0|t,0|(d=0|B(0|(M=0|L(0,0|i[P>>2],32)),0|l,0|C,0|a)),0|l),d=l,t=0|L(0,0|i[g>>2],32),v=l,n=0|x(0|(v=0|G(0|a,0|d,0|(n=0|B(0|(C=0|L(0,0|i[n>>2],32)),0|l,0|t,0|v)),0|l)),0|l,1),v=l,d=0|L(0,0|i[c>>2],32),a=l,a=0|G(0|n,0|v,0|(C=0|B(0|(t=0|L(0,0|i[h>>2],32)),0|l,0|d,0|a)),0|l),C=l,v=0|L(0,0|i[y>>2],32),n=l,n=0|G(0|a,0|C,0|(t=0|B(0|(d=0|L(0,0|i[f>>2],32)),0|l,0|v,0|n)),0|l),t=l,C=0|L(0,0|i[p>>2],32),a=l,a=0|G(0|n,0|t,0|(d=0|B(0|(v=0|L(0,0|i[E>>2],32)),0|l,0|C,0|a)),0|l),d=l,t=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|a,0|d,0|(v=0|B(0|(C=0|L(0,0|i[o>>2],32)),0|l,0|t,0|n)),0|l),i[(v=e+80|0)>>2]=n,i[v+4>>2]=l,v=0|L(0,0|i[m>>2],32),n=l,a=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|v,0|n),n=l,v=0|L(0,0|i[y>>2],32),d=l,d=0|G(0|(C=0|B(0|(t=0|L(0,0|i[u>>2],32)),0|l,0|v,0|d)),0|l,0|a,0|n),n=l,a=0|L(0,0|i[c>>2],32),C=l,C=0|G(0|d,0|n,0|(t=0|B(0|(v=0|L(0,0|i[T>>2],32)),0|l,0|a,0|C)),0|l),t=l,n=0|L(0,0|i[S>>2],32),d=l,d=0|G(0|C,0|t,0|(v=0|B(0|(a=0|L(0,0|i[f>>2],32)),0|l,0|n,0|d)),0|l),v=l,t=0|L(0,0|i[s>>2],32),C=l,C=0|G(0|d,0|v,0|(a=0|B(0|(n=0|L(0,0|i[E>>2],32)),0|l,0|t,0|C)),0|l),a=l,v=0|L(0,0|i[b>>2],32),d=l,d=0|G(0|C,0|a,0|(n=0|B(0|(t=0|L(0,0|i[_>>2],32)),0|l,0|v,0|d)),0|l),n=l,a=0|L(0,0|i[p>>2],32),p=l,p=0|G(0|d,0|n,0|(v=0|B(0|(C=0|L(0,0|i[P>>2],32)),0|l,0|a,0|p)),0|l),v=l,n=0|L(0,0|i[g>>2],32),d=l,d=0|G(0|p,0|v,0|(o=0|B(0|(a=0|L(0,0|i[o>>2],32)),0|l,0|n,0|d)),0|l),i[(o=e+88|0)>>2]=d,i[o+4>>2]=l,o=0|L(0,0|i[y>>2],32),d=l,p=0|B(0|(v=0|L(0,0|i[h>>2],32)),0|l,0|o,0|d),d=l,o=0|L(0,0|i[m>>2],32),v=l,a=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|o,0|v),v=l,o=0|L(0,0|i[S>>2],32),n=l,n=0|G(0|(t=0|B(0|(C=0|L(0,0|i[u>>2],32)),0|l,0|o,0|n)),0|l,0|a,0|v),v=l,a=0|L(0,0|i[s>>2],32),s=l,s=0|G(0|n,0|v,0|(o=0|B(0|(t=0|L(0,0|i[P>>2],32)),0|l,0|a,0|s)),0|l),o=l,v=0|L(0,0|i[g>>2],32),n=l,n=0|G(0|s,0|o,0|(_=0|B(0|(a=0|L(0,0|i[_>>2],32)),0|l,0|v,0|n)),0|l),n=0|G(0|(_=0|x(0|n,0|l,1)),0|l,0|p,0|d),d=l,p=0|L(0,0|i[c>>2],32),_=l,_=0|G(0|n,0|d,0|(s=0|B(0|(o=0|L(0,0|i[E>>2],32)),0|l,0|p,0|_)),0|l),s=l,d=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|_,0|s,0|(o=0|B(0|(p=0|L(0,0|i[f>>2],32)),0|l,0|d,0|n)),0|l),i[(o=e+96|0)>>2]=n,i[o+4>>2]=l,o=0|L(0,0|i[y>>2],32),n=l,_=0|B(0|(s=0|L(0,0|i[T>>2],32)),0|l,0|o,0|n),n=l,o=0|L(0,0|i[S>>2],32),s=l,s=0|G(0|(p=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|o,0|s)),0|l,0|_,0|n),n=l,_=0|L(0,0|i[m>>2],32),p=l,p=0|G(0|s,0|n,0|(d=0|B(0|(o=0|L(0,0|i[E>>2],32)),0|l,0|_,0|p)),0|l),d=l,n=0|L(0,0|i[b>>2],32),s=l,s=0|G(0|p,0|d,0|(o=0|B(0|(_=0|L(0,0|i[u>>2],32)),0|l,0|n,0|s)),0|l),o=l,d=0|L(0,0|i[c>>2],32),c=l,c=0|G(0|s,0|o,0|(n=0|B(0|(p=0|L(0,0|i[P>>2],32)),0|l,0|d,0|c)),0|l),n=l,o=0|L(0,0|i[g>>2],32),s=l,s=0|G(0|c,0|n,0|(f=0|B(0|(d=0|L(0,0|i[f>>2],32)),0|l,0|o,0|s)),0|l),i[(f=e+104|0)>>2]=s,i[f+4>>2]=l,f=0|L(0,0|i[S>>2],32),s=l,c=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|f,0|s),s=l,f=0|L(0,0|i[m>>2],32),m=l,m=0|G(0|(o=0|B(0|(n=0|L(0,0|i[P>>2],32)),0|l,0|f,0|m)),0|l,0|c,0|s),s=l,c=0|L(0,0|i[g>>2],32),o=l,u=0|x(0|(o=0|G(0|m,0|s,0|(u=0|B(0|(f=0|L(0,0|i[u>>2],32)),0|l,0|c,0|o)),0|l)),0|l,1),o=l,s=0|L(0,0|i[y>>2],32),m=l,m=0|G(0|u,0|o,0|(f=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|s,0|m)),0|l),f=l,o=0|L(0,0|i[b>>2],32),u=l,u=0|G(0|m,0|f,0|(c=0|B(0|(s=0|L(0,0|i[h>>2],32)),0|l,0|o,0|u)),0|l),i[(c=e+112|0)>>2]=u,i[c+4>>2]=l,c=0|L(0,0|i[S>>2],32),u=l,m=0|B(0|(f=0|L(0,0|i[E>>2],32)),0|l,0|c,0|u),u=l,c=0|L(0,0|i[b>>2],32),f=l,f=0|G(0|(s=0|B(0|(o=0|L(0,0|i[T>>2],32)),0|l,0|c,0|f)),0|l,0|m,0|u),u=l,m=0|L(0,0|i[y>>2],32),y=l,y=0|G(0|f,0|u,0|(c=0|B(0|(s=0|L(0,0|i[P>>2],32)),0|l,0|m,0|y)),0|l),c=l,u=0|L(0,0|i[g>>2],32),f=l,f=0|G(0|y,0|c,0|(h=0|B(0|(m=0|L(0,0|i[h>>2],32)),0|l,0|u,0|f)),0|l),i[(h=e+120|0)>>2]=f,i[h+4>>2]=l,h=0|L(0,0|i[b>>2],32),f=l,y=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|h,0|f),f=l,h=0|L(0,0|i[S>>2],32),S=l,u=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|h,0|S),S=l,h=0|L(0,0|i[g>>2],32),c=l,c=0|G(0|(T=0|B(0|(m=0|L(0,0|i[T>>2],32)),0|l,0|h,0|c)),0|l,0|u,0|S),c=0|G(0|(S=0|x(0|c,0|l,1)),0|l,0|y,0|f),i[(f=e+128|0)>>2]=c,i[f+4>>2]=l,f=0|L(0,0|i[b>>2],32),b=l,y=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|f,0|b),b=l,f=0|L(0,0|i[g>>2],32),c=l,c=0|G(0|(E=0|B(0|(S=0|L(0,0|i[E>>2],32)),0|l,0|f,0|c)),0|l,0|y,0|b),i[(b=e+136|0)>>2]=c,i[b+4>>2]=l,b=0|L(0,0|i[g>>2],31),g=l,P=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|b,0|g),i[(g=e+144|0)>>2]=P,i[g+4>>2]=l}function M(e,t){e|=0;var r,n,a,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,U=0,F=0,K=0,j=0,Y=0,W=0,H=0,V=0,$=0,z=0,q=0;r=o,o=o+160|0,s=r,u=0|B(0|(n=0|L(0,0|(c=0|i[(t|=0)>>2]),32)),0|(d=l),0|n,0|d),i[(p=s)>>2]=u,i[p+4>>2]=l,p=0|L(0,0|c,31),c=l,g=0|B(0|(_=0|L(0,0|(f=0|i[(u=t+8|0)>>2]),32)),0|(h=l),0|p,0|c),i[(m=a=s+8|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|_,0|h,0|_,0|h),g=l,g=0|x(0|(T=0|G(0|(v=0|B(0|(E=0|L(0,0|i[(y=t+16|0)>>2],32)),0|(S=l),0|n,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=T=s+16|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|E,0|S,0|_,0|h),g=l,g=0|x(0|(P=0|G(0|(b=0|B(0|(C=0|L(0,0|i[(v=t+24|0)>>2],32)),0|(A=l),0|n,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=P=s+24|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|E,0|S,0|E,0|S),g=l,b=0|G(0|(M=0|B(0|C,0|A,0|(b=0|L(0,0|f,30)),0|l)),0|l,0|m,0|g),c=0|G(0|b,0|(g=l),0|(I=0|B(0|(M=0|L(0,0|i[(m=t+32|0)>>2],32)),0|(O=l),0|p,0|c)),0|l),i[(g=I=s+32|0)>>2]=c,i[g+4>>2]=l,g=0|B(0|C,0|A,0|E,0|S),c=l,p=0|G(0|(b=0|B(0|M,0|O,0|_,0|h)),0|l,0|g,0|c),R=0|x(0|(D=0|G(0|p,0|(c=l),0|(R=0|B(0|(b=0|L(0,0|i[(g=t+40|0)>>2],32)),0|(w=l),0|n,0|d)),0|l)),0|l,1),i[(c=D=s+40|0)>>2]=R,i[c+4>>2]=l,c=0|B(0|C,0|A,0|C,0|A),R=l,N=0|G(0|(p=0|B(0|M,0|O,0|E,0|S)),0|l,0|c,0|R),K=0|G(0|N,0|(R=l),0|(F=0|B(0|(p=0|L(0,0|i[(c=t+48|0)>>2],32)),0|(U=l),0|n,0|d)),0|l),f=0|x(0|(R=0|G(0|K,0|(F=l),0|(f=0|B(0|b,0|w,0|(R=0|L(0,0|f,31)),0|l)),0|l)),0|l,1),i[(F=R=s+48|0)>>2]=f,i[F+4>>2]=l,F=0|B(0|M,0|O,0|C,0|A),f=l,N=0|G(0|(K=0|B(0|b,0|w,0|E,0|S)),0|l,0|F,0|f),K=0|G(0|N,0|(f=l),0|(F=0|B(0|p,0|U,0|_,0|h)),0|l),Y=0|x(0|(W=0|G(0|K,0|(F=l),0|(Y=0|B(0|(N=0|L(0,0|i[(f=t+56|0)>>2],32)),0|(j=l),0|n,0|d)),0|l)),0|l,1),i[(F=W=s+56|0)>>2]=Y,i[F+4>>2]=l,F=0|B(0|M,0|O,0|M,0|O),Y=l,K=0|B(0|p,0|U,0|E,0|S),H=l,d=0|G(0|(q=0|B(0|($=0|L(0,0|i[(V=t+64|0)>>2],32)),0|(z=l),0|n,0|d)),0|l,0|K,0|H),H=l,K=0|B(0|N,0|j,0|_,0|h),h=l,q=0|G(0|(_=0|B(0|b,0|w,0|C,0|A)),0|l,0|K,0|h),q=0|G(0|d,0|H,0|(h=0|x(0|q,0|l,1)),0|l),q=0|G(0|(h=0|x(0|q,0|l,1)),0|l,0|F,0|Y),i[(F=Y=s+64|0)>>2]=q,i[F+4>>2]=l,F=0|B(0|b,0|w,0|M,0|O),q=l,A=0|G(0|(h=0|B(0|p,0|U,0|C,0|A)),0|l,0|F,0|q),S=0|G(0|A,0|(q=l),0|(F=0|B(0|N,0|j,0|E,0|S)),0|l),E=0|G(0|S,0|(F=l),0|(A=0|B(0|$,0|z,0|(q=0|L(0,0|i[u>>2],32)),0|(u=l))),0|l),A=l,F=0|L(0,0|i[t>>2],32),S=l,H=0|x(0|(S=0|G(0|E,0|A,0|(H=0|B(0|(t=0|L(0,0|(h=0|i[t+72>>2]),32)),0|(C=l),0|F,0|S)),0|l)),0|l,1),i[(S=s+72|0)>>2]=H,i[S+4>>2]=l,S=0|B(0|b,0|w,0|b,0|w),H=l,O=0|G(0|(A=0|B(0|p,0|U,0|M,0|O)),0|l,0|S,0|H),M=0|G(0|O,0|(H=l),0|(A=0|B(0|$,0|z,0|(S=0|L(0,0|i[y>>2],32)),0|(y=l))),0|l),A=l,O=0|B(0|N,0|j,0|(H=0|L(0,0|i[v>>2],32)),0|(v=l)),E=l,E=0|x(0|(u=0|G(0|(F=0|B(0|t,0|C,0|q,0|u)),0|l,0|O,0|E)),0|l,1),E=0|x(0|(u=0|G(0|M,0|A,0|E,0|l)),0|l,1),i[(A=u=s+80|0)>>2]=E,i[A+4>>2]=l,A=0|B(0|p,0|U,0|b,0|w),w=l,M=0|G(0|(E=0|B(0|N,0|j,0|(b=0|L(0,0|i[m>>2],32)),0|(m=l))),0|l,0|A,0|w),E=0|G(0|M,0|(w=l),0|(A=0|B(0|$,0|z,0|H,0|v)),0|l),A=0|x(0|(y=0|G(0|E,0|(A=l),0|(w=0|B(0|t,0|C,0|S,0|y)),0|l)),0|(w=l),1),E=l,i[(S=s+88|0)>>2]=A,i[S+4>>2]=E,S=0|B(0|p,0|U,0|p,0|U),U=l,p=0|B(0|$,0|z,0|b,0|m),M=l,q=0|B(0|N,0|j,0|(g=0|L(0,0|(O=0|i[g>>2]),32)),0|(F=l)),d=l,v=0|G(0|(K=0|B(0|t,0|C,0|H,0|v)),0|l,0|q,0|d),v=0|G(0|(d=0|x(0|v,0|l,1)),0|l,0|p,0|M),v=0|G(0|(M=0|x(0|v,0|l,1)),0|l,0|S,0|U),U=l,i[(S=s+96|0)>>2]=v,i[S+4>>2]=U,M=0|B(0|N,0|j,0|(S=0|L(0,0|i[c>>2],32)),0|(c=l)),j=l,F=0|G(0|(N=0|B(0|$,0|z,0|g,0|F)),0|l,0|M,0|j),j=0|x(0|(m=0|G(0|F,0|(j=l),0|(M=0|B(0|t,0|C,0|b,0|m)),0|l)),0|(M=l),1),F=l,i[(b=s+104|0)>>2]=j,i[b+4>>2]=F,g=0|B(0|(f=0|L(0,0|(b=0|i[f>>2]),32)),0|(N=l),0|f,0|N),p=l,z=0|G(0|(d=0|B(0|$,0|z,0|S,0|c)),0|l,0|g,0|p),p=0|x(0|(g=0|G(0|z,0|(p=l),0|(O=0|B(0|t,0|C,0|(g=0|L(0,0|O,31)),0|l)),0|l)),0|(O=l),1),z=l,i[(d=s+112|0)>>2]=p,i[d+4>>2]=z,q=0|B(0|(V=0|L(0,0|(d=0|i[V>>2]),32)),0|($=l),0|f,0|N),N=l,q=0|x(0|(c=0|G(0|(f=0|B(0|t,0|C,0|S,0|c)),0|l,0|q,0|N)),0|(N=l),1),f=l,i[(S=s+120|0)>>2]=q,i[S+4>>2]=f,S=0|B(0|V,0|$,0|V,0|$),$=l,V=0|G(0|(b=0|B(0|t,0|C,0|(V=0|L(0,0|b,30)),0|l)),0|l,0|S,0|$),$=l,i[(S=s+128|0)>>2]=V,i[S+4>>2]=$,d=0|B(0|t,0|C,0|(S=0|L(0,0|d,31)),0|l),S=l,i[(b=s+136|0)>>2]=d,i[b+4>>2]=S,h=0|B(0|(b=0|L(0,0|h,31)),0|l,0|t,0|C),C=l,i[(t=s+144|0)>>2]=h,i[t+4>>2]=C,b=0|i[(t=Y)>>2],K=0|i[t+4>>2],t=0|B(0|h,0|C,18,0),H=l,_=0|G(0|h,0|C,0|b,0|K),K=0|G(0|_,0|l,0|t,0|H),i[(H=Y)>>2]=K,i[H+4>>2]=l,K=0|i[(H=W)>>2],Y=0|i[H+4>>2],H=0|B(0|d,0|S,18,0),t=l,_=0|G(0|K,0|Y,0|d,0|S),S=0|G(0|_,0|l,0|H,0|t),i[(t=W)>>2]=S,i[t+4>>2]=l,S=0|i[(t=R)>>2],W=0|i[t+4>>2],t=0|B(0|V,0|$,18,0),H=l,_=0|G(0|S,0|W,0|V,0|$),$=0|G(0|_,0|l,0|t,0|H),i[(H=R)>>2]=$,i[H+4>>2]=l,$=0|i[(H=D)>>2],R=0|i[H+4>>2],H=0|B(0|c,0|N,36,0),N=l,c=0|G(0|$,0|R,0|q,0|f),f=0|G(0|c,0|l,0|H,0|N),i[(N=D)>>2]=f,i[N+4>>2]=l,f=0|i[(N=I)>>2],D=0|i[N+4>>2],N=0|B(0|g,0|O,36,0),O=l,g=0|G(0|f,0|D,0|p,0|z),z=0|G(0|g,0|l,0|N,0|O),i[(O=I)>>2]=z,i[O+4>>2]=l,z=0|i[(O=P)>>2],I=0|i[O+4>>2],O=0|B(0|m,0|M,36,0),M=l,m=0|G(0|z,0|I,0|j,0|F),F=0|G(0|m,0|l,0|O,0|M),i[(M=P)>>2]=F,i[M+4>>2]=l,F=0|i[(M=T)>>2],P=0|i[M+4>>2],M=0|B(0|v,0|U,18,0),O=l,m=0|G(0|F,0|P,0|v,0|U),U=0|G(0|m,0|l,0|M,0|O),i[(O=T)>>2]=U,i[O+4>>2]=l,U=0|i[(O=a)>>2],T=0|i[O+4>>2],O=0|B(0|y,0|w,36,0),w=l,y=0|G(0|U,0|T,0|A,0|E),E=0|G(0|y,0|l,0|O,0|w),i[(w=a)>>2]=E,i[w+4>>2]=l,E=0|i[(w=u)>>2],O=0|i[w+4>>2],y=0|i[(w=s)>>2],A=0|i[w+4>>2],w=0|B(0|E,0|O,18,0),T=l,U=0|G(0|y,0|A,0|E,0|O),O=0|G(0|U,0|l,0|w,0|T),T=l,i[(w=s)>>2]=O,i[w+4>>2]=T,i[(w=u)>>2]=0,i[w+4>>2]=0,w=T,T=O,O=0;do{y=0|k(0|T,0|w,0|(A=0|x(0|(E=0|L(0|(U=0|G(w>>31>>>6|0,0,0|T,0|w)),0|l,26)),0|(U=l),26)),0|l),i[(A=s+(O<<3)|0)>>2]=y,i[A+4>>2]=l,v=0|k(0|(M=0|G(0|E,0|U,0|i[(y=A=s+((1|O)<<3)|0)>>2],0|i[y+4>>2])),0|(y=l),0|(m=0|x(0|(E=0|L(0|(U=0|G(y>>31>>>7|0,0,0|M,0|y)),0|l,25)),0|(U=l),25)),0|l),i[(m=A)>>2]=v,i[m+4>>2]=l,T=0|G(0|E,0|U,0|i[(v=m=s+((O=O+2|0)<<3)|0)>>2],0|i[v+4>>2]),w=l,i[(v=m)>>2]=T,i[v+4>>2]=w}while(O>>>0<10);w=0|i[(O=u)>>2],T=0|i[O+4>>2],v=0|i[(O=s)>>2],m=0|i[O+4>>2],O=0|B(0|w,0|T,18,0),U=l,E=0|G(0|v,0|m,0|w,0|T),T=0|G(0|E,0|l,0|O,0|U),U=l,i[(O=u)>>2]=0,i[O+4>>2]=0,w=0|k(0|T,0|U,0|(E=0|x(0|(u=0|L(0|(O=0|G(U>>31>>>6|0,0,0|T,0|U)),0|l,26)),0|(O=l),26)),0|l),i[(E=s)>>2]=w,i[E+4>>2]=l,w=0|G(0|u,0|O,0|i[(E=a)>>2],0|i[E+4>>2]),i[(E=a)>>2]=w,i[E+4>>2]=l,E=e,e=s,s=E+80|0;do{i[E>>2]=i[e>>2],E=E+4|0,e=e+4|0}while((0|E)<(0|s));o=r}function O(){return 0|(0|i[2]?0|i[60+(0|f())>>2]:56)}function I(e){var t=0;return(e|=0)>>>0>4294963200?(i[(0|O())>>2]=0-e,t=-1):t=e,0|t}function w(e){return 0,0}function R(e){0}function D(e,t,r){t|=0,r|=0;var n,a,s,l,c,d=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,C=0,b=0,P=0,M=0,O=0;for(n=o,o=o+48|0,a=n+16|0,s=n,d=n+32|0,p=0|i[(l=(e|=0)+28|0)>>2],i[d>>2]=p,f=(0|i[(c=e+20|0)>>2])-p|0,i[d+4>>2]=f,i[d+8>>2]=t,i[d+12>>2]=r,t=e+60|0,p=e+44|0,_=d,d=2,h=f+r|0;;){if(0|i[2]?(T(1,0|e),i[s>>2]=i[t>>2],i[s+4>>2]=_,i[s+8>>2]=d,f=0|I(0|A(146,0|s)),u(0),g=f):(i[a>>2]=i[t>>2],i[a+4>>2]=_,i[a+8>>2]=d,g=0|I(0|A(146,0|a))),(0|h)==(0|g)){m=6;break}if((0|g)<0){y=_,E=d,m=8;break}f=h-g|0,g>>>0<=(S=0|i[_+4>>2])>>>0?2==(0|d)?(i[l>>2]=(0|i[l>>2])+g,v=S,C=g,b=_,P=2):(v=S,C=g,b=_,P=d):(M=0|i[p>>2],i[l>>2]=M,i[c>>2]=M,v=0|i[_+12>>2],C=g-S|0,b=_+8|0,P=d+-1|0),i[b>>2]=(0|i[b>>2])+C,i[b+4>>2]=v-C,_=b,d=P,h=f}return 6==(0|m)?(h=0|i[p>>2],i[e+16>>2]=h+(0|i[e+48>>2]),p=h,i[l>>2]=p,i[c>>2]=p,O=r):8==(0|m)&&(i[e+16>>2]=0,i[l>>2]=0,i[c>>2]=0,i[e>>2]=32|i[e>>2],O=2==(0|E)?0:r-(0|i[y+4>>2])|0),o=n,0|O}function N(e){var t,r,n=0,a=0,o=0,s=0,l=0;return r=(e|=0)+28|0,(0|i[(t=e+20|0)>>2])>>>0>(0|i[r>>2])>>>0&&(j[3&i[e+36>>2]](e,0,0),0==(0|i[t>>2]))?n=-1:((o=0|i[(a=e+4|0)>>2])>>>0<(l=0|i[(s=e+8|0)>>2])>>>0&&j[3&i[e+40>>2]](e,o-l|0,1),i[e+16>>2]=0,i[r>>2]=0,i[t>>2]=0,i[s>>2]=0,i[a>>2]=0,n=0),0|n}function L(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=(0|t)<0?-1:0,t>>r-32|0)}function k(e,t,r,n){return(t|=0)-(n|=0)>>>0,0|(l=t-n-((r|=0)>>>0>(e|=0)>>>0|0)>>>0,e-r>>>0|0)}function G(e,t,r,n){var i;return 0|(l=(t|=0)+(n|=0)+((i=(e|=0)+(r|=0)>>>0)>>>0<e>>>0|0)>>>0,0|i)}function U(e,t,r){t|=0;var a,o=0,s=0,l=0;if(a=(e|=0)+(r|=0)|0,(0|r)>=20){if(s=(t&=255)|t<<8|t<<16|t<<24,l=-4&a,o=3&e)for(o=e+4-o|0;(0|e)<(0|o);)n[e>>0]=t,e=e+1|0;for(;(0|e)<(0|l);)i[e>>2]=s,e=e+4|0}for(;(0|e)<(0|a);)n[e>>0]=t,e=e+1|0;return e-r|0}function F(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=0,t>>>r-32|0)}function x(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t<<r|(e&(1<<r)-1<<32-r)>>>32-r,e<<r):(l=e<<r-32,0)}function B(e,t,r,n){t|=0,n|=0;var i,a;return r=0|function(e,t){var r,n,i,a=0;return e=((n=0|c(a=65535&(t|=0),r=65535&(e|=0)))>>>16)+(0|c(a,i=e>>>16))|0,t=0|c(a=t>>>16,r),0|(l=(e>>>16)+(0|c(a,i))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&n|0)}(i=e|=0,e=r|=0),a=l,0|(l=(0|c(t,e))+(0|c(n,i))+a|0&a,0|r)}var K=[function(e){return 0,d(0),0},function(e){var t,r;return e|=0,t=o,o=o+16|0,i[(r=t)>>2]=i[e+60>>2],e=0|I(0|_(6,0|r)),o=t,0|e}],j=[function(e,t,r){return 0,0,0,d(1),0},function(e,t,r){t|=0,r|=0;var a,s=0;return a=o,o=o+80|0,s=a,i[(e|=0)+36>>2]=3,0==(64&i[e>>2]|0)&&(i[s>>2]=i[e+60>>2],i[s+4>>2]=21505,i[s+8>>2]=a+12,0!=(0|E(54,0|s)))&&(n[e+75>>0]=-1),s=0|D(e,t,r),o=a,0|s},function(e,t,r){e|=0,t|=0,r|=0;var n,a,s,l=0;return n=o,o=o+32|0,s=n+20|0,i[(a=n)>>2]=i[e+60>>2],i[a+4>>2]=0,i[a+8>>2]=t,i[a+12>>2]=s,i[a+16>>2]=r,(0|I(0|v(140,0|a)))<0?(i[s>>2]=-1,l=-1):l=0|i[s>>2],o=n,0|l},D],Y=[function(e){d(2)},function(e){0|i[(e|=0)+68>>2]||R()}];return{_curve25519_donna:function(e,t,r){e|=0,r|=0;var s,d,u,p,f,_,h,g,m,y,E,S,v,T,C,A,O,I,w,R,D,N,K,j,Y,W,H,V,$,z,q,J,Q,X,Z,ee,te,re,ne,ie,ae,oe,se,le,ce,de,ue,pe,fe,_e,he,ge,me,ye,Ee,Se,ve,Te,Ce,Ae=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,je=0,Ye=0,We=0,He=0,Ve=0,$e=0,ze=0,qe=0,Je=0,Qe=0,Xe=0,Ze=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,dt=0,ut=0,pt=0,ft=0,_t=0,ht=0,gt=0,mt=0,yt=0,Et=0,St=0,vt=0,Tt=0,Ct=0,At=0,bt=0,Pt=0,Mt=0,Ot=0,It=0,wt=0,Rt=0,Dt=0,Nt=0,Lt=0,kt=0,Gt=0,Ut=0,Ft=0,xt=0,Bt=0,Kt=0,jt=0,Yt=0,Wt=0,Ht=0,Vt=0,$t=0,zt=0,qt=0,Jt=0,Qt=0,Xt=0,Zt=0,er=0,tr=0,rr=0,nr=0,ir=0,ar=0,or=0,sr=0,lr=0,cr=0,dr=0,ur=0,pr=0,fr=0,_r=0,hr=0,gr=0,mr=0,yr=0,Er=0,Sr=0,vr=0,Tr=0,Cr=0,Ar=0,br=0,Pr=0,Mr=0,Or=0,Ir=0,wr=0,Rr=0,Dr=0,Nr=0;s=o,o=o+2640|0,Ae=s+2456|0,be=s+2304|0,Pe=s+2152|0,Me=s+2e3|0,Oe=s+1848|0,Ie=s+1696|0,we=s+1544|0,Re=s+1392|0,De=s+1240|0,Ne=s+1088|0,Le=s+936|0,ke=s+784|0,Ge=s+632|0,Ue=s+480|0,Fe=s+328|0,d=s+248|0,xe=s+168|0,Be=s+80|0,Ke=s,Ye=t|=0,t=(je=u=s+2608|0)+32|0;do{n[je>>0]=0|n[Ye>>0],je=je+1|0,Ye=Ye+1|0}while((0|je)<(0|t));n[u>>0]=248&(0|a[u>>0]),n[(We=u+31|0)>>0]=63&(0|a[We>>0])|64,We=0|a[r>>0],He=0|x(0|a[r+1>>0],0,8),Ve=l,$e=0|x(0|a[r+2>>0],0,16),ze=Ve|l,qe=0|x(0|(Ve=0|a[r+3>>0]),0,24),i[(Je=d)>>2]=He|We|$e|50331648&qe,i[Je+4>>2]=ze,ze=0|x(0|a[r+4>>0],0,8),Je=l,qe=0|x(0|a[r+5>>0],0,16),$e=Je|l,He=0|F(ze|Ve|qe|(We=0|x(0|(Je=0|a[r+6>>0]),0,24))|0,$e|l|0,2),i[($e=d+8|0)>>2]=33554431&He,i[$e+4>>2]=0,$e=0|x(0|a[r+7>>0],0,8),He=l,We=0|x(0|a[r+8>>0],0,16),qe=He|l,ze=0|F($e|Je|We|(Ve=0|x(0|(He=0|a[r+9>>0]),0,24))|0,qe|l|0,3),i[(qe=d+16|0)>>2]=67108863&ze,i[qe+4>>2]=0,qe=0|x(0|a[r+10>>0],0,8),ze=l,Ve=0|x(0|a[r+11>>0],0,16),We=ze|l,$e=0|F(qe|He|Ve|(Je=0|x(0|(ze=0|a[r+12>>0]),0,24))|0,We|l|0,5),i[(We=d+24|0)>>2]=33554431&$e,i[We+4>>2]=0,We=0|x(0|a[r+13>>0],0,8),$e=l,Je=0|x(0|a[r+14>>0],0,16),Ve=$e|l,He=0|F(We|ze|Je|($e=0|x(0|a[r+15>>0],0,24))|0,Ve|l|0,6),i[(Ve=d+32|0)>>2]=67108863&He,i[Ve+4>>2]=0,Ve=0|a[r+16>>0],He=0|x(0|a[r+17>>0],0,8),$e=l,Je=0|x(0|a[r+18>>0],0,16),ze=$e|l,We=0|x(0|($e=0|a[r+19>>0]),0,24),i[(qe=d+40|0)>>2]=He|Ve|Je|16777216&We,i[qe+4>>2]=ze,ze=0|x(0|a[r+20>>0],0,8),qe=l,We=0|x(0|a[r+21>>0],0,16),Je=qe|l,He=0|F(ze|$e|We|(Ve=0|x(0|(qe=0|a[r+22>>0]),0,24))|0,Je|l|0,1),i[(Je=d+48|0)>>2]=67108863&He,i[Je+4>>2]=0,Je=0|x(0|a[r+23>>0],0,8),He=l,Ve=0|x(0|a[r+24>>0],0,16),We=He|l,ze=0|F(Je|qe|Ve|($e=0|x(0|(He=0|a[r+25>>0]),0,24))|0,We|l|0,3),i[(We=d+56|0)>>2]=33554431&ze,i[We+4>>2]=0,We=0|x(0|a[r+26>>0],0,8),ze=l,$e=0|x(0|a[r+27>>0],0,16),Ve=ze|l,Je=0|F(We|He|$e|(qe=0|x(0|(ze=0|a[r+28>>0]),0,24))|0,Ve|l|0,4),i[(Ve=d+64|0)>>2]=67108863&Je,i[Ve+4>>2]=0,Ve=0|x(0|a[r+29>>0],0,8),Je=l,qe=0|x(0|a[r+30>>0],0,16),$e=Je|l,r=0|F(Ve|ze|qe|(Je=0|x(0|a[r+31>>0],0,24))|0,$e|l|0,6),i[($e=d+72|0)>>2]=33554431&r,i[$e+4>>2]=0,U(0|De,0,152),i[($e=De)>>2]=1,i[$e+4>>2]=0,U(0|Ne,0,152),i[($e=Ne)>>2]=1,i[$e+4>>2]=0,U(0|Le,0,152),U(0|ke,0,152),U(0|Ge,0,152),i[($e=Ge)>>2]=1,i[$e+4>>2]=0,U(0|Ue,0,152),U(0|Fe,0,152),i[($e=Fe)>>2]=1,i[$e+4>>2]=0,t=(je=Re+80|0)+72|0;do{i[je>>2]=0,je=je+4|0}while((0|je)<(0|t));Ye=d,t=(je=Re)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));for($e=Me+144|0,r=Me+64|0,Je=Me+136|0,qe=Me+56|0,ze=Me+128|0,Ve=Me+48|0,He=Me+120|0,We=Me+40|0,p=Me+112|0,f=Me+32|0,_=Me+104|0,h=Me+24|0,g=Me+96|0,m=Me+16|0,y=Me+88|0,E=Me+8|0,S=Me+80|0,v=Oe+144|0,T=Oe+64|0,C=Oe+136|0,A=Oe+56|0,O=Oe+128|0,I=Oe+48|0,w=Oe+120|0,R=Oe+40|0,D=Oe+112|0,N=Oe+32|0,K=Oe+104|0,j=Oe+24|0,Y=Oe+96|0,W=Oe+16|0,H=Oe+88|0,V=Oe+8|0,$=Oe+80|0,z=Me+72|0,q=Oe+72|0,J=be+8|0,Q=Pe+8|0,X=be+16|0,Z=Pe+16|0,ee=be+24|0,te=Pe+24|0,re=be+32|0,ne=Pe+32|0,ie=be+40|0,ae=Pe+40|0,oe=be+48|0,se=Pe+48|0,le=be+56|0,ce=Pe+56|0,de=be+64|0,ue=Pe+64|0,pe=be+72|0,fe=Pe+72|0,_e=Ae+80|0,he=Ae+8|0,ge=Ae+16|0,me=Ae+24|0,ye=Ae+32|0,Ee=Ae+40|0,Se=Ae+48|0,ve=Ae+56|0,Te=Ae+64|0,Ce=Ae+72|0,Qe=0,Xe=Re,Ze=ke,ke=De,et=Ge,Ge=Ne,tt=Ue,Ue=Le,Le=Fe;;){for(Fe=0|n[u+(31-Qe)>>0],rt=0,nt=Xe,it=Ze,at=ke,ot=et,st=Ge,lt=tt,ct=Ue,dt=Le;;){pt=0|k(0,0,(ut=255&Fe)>>>7|0,0),ft=l,_t=0;do{mt=0|i[(gt=ht=st+(_t<<3)|0)>>2],yt=0|i[gt+4>>2],St=0|i[(Et=gt=nt+(_t<<3)|0)>>2],Tt=((vt=0|i[Et+4>>2])^yt)&ft,yt=0|L(0,(Et=(St^mt)&pt)^mt|0,32),i[(mt=ht)>>2]=yt,i[mt+4>>2]=l,mt=0|L(0,Et^St|0,32),i[(St=gt)>>2]=mt,i[St+4>>2]=l,_t=_t+1|0}while(10!=(0|_t));Ct=0;do{mt=0|i[(St=_t=ct+(Ct<<3)|0)>>2],gt=0|i[St+4>>2],yt=0|i[(Et=St=at+(Ct<<3)|0)>>2],vt=((ht=0|i[Et+4>>2])^gt)&ft,gt=0|L(0,(Et=(yt^mt)&pt)^mt|0,32),i[(mt=_t)>>2]=gt,i[mt+4>>2]=l,mt=0|L(0,Et^yt|0,32),i[(yt=St)>>2]=mt,i[yt+4>>2]=l,Ct=Ct+1|0}while(10!=(0|Ct));mt=0|i[(yt=st)>>2],St=0|i[yt+4>>2],gt=0|i[(Et=yt=st+8|0)>>2],_t=0|i[Et+4>>2],vt=0|i[(ht=Et=st+16|0)>>2],Tt=0|i[ht+4>>2],bt=0|i[(At=ht=st+24|0)>>2],Pt=0|i[At+4>>2],Ot=0|i[(Mt=At=st+32|0)>>2],It=0|i[Mt+4>>2],Rt=0|i[(wt=Mt=st+40|0)>>2],Dt=0|i[wt+4>>2],Lt=0|i[(Nt=wt=st+48|0)>>2],kt=0|i[Nt+4>>2],Ut=0|i[(Gt=Nt=st+56|0)>>2],Ft=0|i[Gt+4>>2],Bt=0|i[(xt=Gt=st+64|0)>>2],Kt=0|i[xt+4>>2],Yt=0|i[(jt=xt=st+72|0)>>2],Wt=0|i[jt+4>>2],jt=0|G(0|(Ht=0|i[(jt=ct)>>2]),0|(Vt=0|i[jt+4>>2]),0|mt,0|St),i[($t=st)>>2]=jt,i[$t+4>>2]=l,jt=0|G(0|(zt=0|i[(jt=$t=ct+8|0)>>2]),0|(qt=0|i[jt+4>>2]),0|gt,0|_t),i[(Jt=yt)>>2]=jt,i[Jt+4>>2]=l,jt=0|G(0|(yt=0|i[(jt=Jt=ct+16|0)>>2]),0|(Qt=0|i[jt+4>>2]),0|vt,0|Tt),i[(Xt=Et)>>2]=jt,i[Xt+4>>2]=l,jt=0|G(0|(Et=0|i[(jt=Xt=ct+24|0)>>2]),0|(Zt=0|i[jt+4>>2]),0|bt,0|Pt),i[(er=ht)>>2]=jt,i[er+4>>2]=l,jt=0|G(0|(ht=0|i[(jt=er=ct+32|0)>>2]),0|(tr=0|i[jt+4>>2]),0|Ot,0|It),i[(rr=At)>>2]=jt,i[rr+4>>2]=l,jt=0|G(0|(At=0|i[(jt=rr=ct+40|0)>>2]),0|(nr=0|i[jt+4>>2]),0|Rt,0|Dt),i[(ir=Mt)>>2]=jt,i[ir+4>>2]=l,jt=0|G(0|(Mt=0|i[(jt=ir=ct+48|0)>>2]),0|(ar=0|i[jt+4>>2]),0|Lt,0|kt),i[(or=wt)>>2]=jt,i[or+4>>2]=l,jt=0|G(0|(wt=0|i[(jt=or=ct+56|0)>>2]),0|(sr=0|i[jt+4>>2]),0|Ut,0|Ft),i[(lr=Nt)>>2]=jt,i[lr+4>>2]=l,jt=0|G(0|(Nt=0|i[(jt=lr=ct+64|0)>>2]),0|(cr=0|i[jt+4>>2]),0|Bt,0|Kt),i[(dr=Gt)>>2]=jt,i[dr+4>>2]=l,jt=0|G(0|(Gt=0|i[(jt=dr=ct+72|0)>>2]),0|(ur=0|i[jt+4>>2]),0|Yt,0|Wt),i[(pr=xt)>>2]=jt,i[pr+4>>2]=l,pr=0|k(0|mt,0|St,0|Ht,0|Vt),i[(Vt=ct)>>2]=pr,i[Vt+4>>2]=l,Vt=0|k(0|gt,0|_t,0|zt,0|qt),i[(qt=$t)>>2]=Vt,i[qt+4>>2]=l,qt=0|k(0|vt,0|Tt,0|yt,0|Qt),i[(Qt=Jt)>>2]=qt,i[Qt+4>>2]=l,Qt=0|k(0|bt,0|Pt,0|Et,0|Zt),i[(Zt=Xt)>>2]=Qt,i[Zt+4>>2]=l,Zt=0|k(0|Ot,0|It,0|ht,0|tr),i[(tr=er)>>2]=Zt,i[tr+4>>2]=l,tr=0|k(0|Rt,0|Dt,0|At,0|nr),i[(nr=rr)>>2]=tr,i[nr+4>>2]=l,nr=0|k(0|Lt,0|kt,0|Mt,0|ar),i[(ar=ir)>>2]=nr,i[ar+4>>2]=l,ar=0|k(0|Ut,0|Ft,0|wt,0|sr),i[(sr=or)>>2]=ar,i[sr+4>>2]=l,sr=0|k(0|Bt,0|Kt,0|Nt,0|cr),i[(cr=lr)>>2]=sr,i[cr+4>>2]=l,cr=0|k(0|Yt,0|Wt,0|Gt,0|ur),i[(ur=dr)>>2]=cr,i[ur+4>>2]=l,cr=0|i[(ur=nt)>>2],dr=0|i[ur+4>>2],Wt=0|i[(Gt=ur=nt+8|0)>>2],Yt=0|i[Gt+4>>2],lr=0|i[(sr=Gt=nt+16|0)>>2],Nt=0|i[sr+4>>2],Bt=0|i[(Kt=sr=nt+24|0)>>2],ar=0|i[Kt+4>>2],wt=0|i[(or=Kt=nt+32|0)>>2],Ft=0|i[or+4>>2],nr=0|i[(Ut=or=nt+40|0)>>2],ir=0|i[Ut+4>>2],kt=0|i[(Mt=Ut=nt+48|0)>>2],Lt=0|i[Mt+4>>2],rr=0|i[(tr=Mt=nt+56|0)>>2],At=0|i[tr+4>>2],Rt=0|i[(Dt=tr=nt+64|0)>>2],Zt=0|i[Dt+4>>2],ht=0|i[(er=Dt=nt+72|0)>>2],It=0|i[er+4>>2],er=0|G(0|(Ot=0|i[(er=at)>>2]),0|(Qt=0|i[er+4>>2]),0|cr,0|dr),i[(Xt=nt)>>2]=er,i[Xt+4>>2]=l,er=0|G(0|(Et=0|i[(er=Xt=at+8|0)>>2]),0|(Pt=0|i[er+4>>2]),0|Wt,0|Yt),i[(bt=ur)>>2]=er,i[bt+4>>2]=l,er=0|G(0|(ur=0|i[(er=bt=at+16|0)>>2]),0|(qt=0|i[er+4>>2]),0|lr,0|Nt),i[(Jt=Gt)>>2]=er,i[Jt+4>>2]=l,er=0|G(0|(Gt=0|i[(er=Jt=at+24|0)>>2]),0|(yt=0|i[er+4>>2]),0|Bt,0|ar),i[(Tt=sr)>>2]=er,i[Tt+4>>2]=l,er=0|G(0|(sr=0|i[(er=Tt=at+32|0)>>2]),0|(vt=0|i[er+4>>2]),0|wt,0|Ft),i[(Vt=Kt)>>2]=er,i[Vt+4>>2]=l,er=0|G(0|(Kt=0|i[(er=Vt=at+40|0)>>2]),0|($t=0|i[er+4>>2]),0|nr,0|ir),i[(zt=or)>>2]=er,i[zt+4>>2]=l,er=0|G(0|(or=0|i[(er=zt=at+48|0)>>2]),0|(_t=0|i[er+4>>2]),0|kt,0|Lt),i[(gt=Ut)>>2]=er,i[gt+4>>2]=l,er=0|G(0|(Ut=0|i[(er=gt=at+56|0)>>2]),0|(pr=0|i[er+4>>2]),0|rr,0|At),i[(Ht=Mt)>>2]=er,i[Ht+4>>2]=l,er=0|G(0|(Mt=0|i[(er=Ht=at+64|0)>>2]),0|(St=0|i[er+4>>2]),0|Rt,0|Zt),i[(mt=tr)>>2]=er,i[mt+4>>2]=l,er=0|G(0|(tr=0|i[(er=mt=at+72|0)>>2]),0|(jt=0|i[er+4>>2]),0|ht,0|It),i[(xt=Dt)>>2]=er,i[xt+4>>2]=l,xt=0|k(0|cr,0|dr,0|Ot,0|Qt),i[(Qt=at)>>2]=xt,i[Qt+4>>2]=l,Qt=0|k(0|Wt,0|Yt,0|Et,0|Pt),i[(Pt=Xt)>>2]=Qt,i[Pt+4>>2]=l,Pt=0|k(0|lr,0|Nt,0|ur,0|qt),i[(qt=bt)>>2]=Pt,i[qt+4>>2]=l,qt=0|k(0|Bt,0|ar,0|Gt,0|yt),i[(yt=Jt)>>2]=qt,i[yt+4>>2]=l,yt=0|k(0|wt,0|Ft,0|sr,0|vt),i[(vt=Tt)>>2]=yt,i[vt+4>>2]=l,vt=0|k(0|nr,0|ir,0|Kt,0|$t),i[($t=Vt)>>2]=vt,i[$t+4>>2]=l,$t=0|k(0|kt,0|Lt,0|or,0|_t),i[(_t=zt)>>2]=$t,i[_t+4>>2]=l,_t=0|k(0|rr,0|At,0|Ut,0|pr),i[(pr=gt)>>2]=_t,i[pr+4>>2]=l,pr=0|k(0|Rt,0|Zt,0|Mt,0|St),i[(St=Ht)>>2]=pr,i[St+4>>2]=l,St=0|k(0|ht,0|It,0|tr,0|jt),i[(jt=mt)>>2]=St,i[jt+4>>2]=l,P(Me,nt,ct),P(Oe,st,at),St=0|i[(jt=$e)>>2],mt=0|i[jt+4>>2],tr=0|i[(jt=r)>>2],It=0|i[jt+4>>2],jt=0|B(0|St,0|mt,18,0),ht=l,pr=0|G(0|tr,0|It,0|St,0|mt),mt=0|G(0|pr,0|l,0|jt,0|ht),i[(ht=r)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=Je)>>2],jt=0|i[ht+4>>2],pr=0|i[(ht=qe)>>2],St=0|i[ht+4>>2],ht=0|B(0|mt,0|jt,18,0),It=l,tr=0|G(0|pr,0|St,0|mt,0|jt),jt=0|G(0|tr,0|l,0|ht,0|It),i[(It=qe)>>2]=jt,i[It+4>>2]=l,jt=0|i[(It=ze)>>2],ht=0|i[It+4>>2],tr=0|i[(It=Ve)>>2],mt=0|i[It+4>>2],It=0|B(0|jt,0|ht,18,0),St=l,pr=0|G(0|tr,0|mt,0|jt,0|ht),ht=0|G(0|pr,0|l,0|It,0|St),i[(St=Ve)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=He)>>2],It=0|i[St+4>>2],pr=0|i[(St=We)>>2],jt=0|i[St+4>>2],St=0|B(0|ht,0|It,18,0),mt=l,tr=0|G(0|pr,0|jt,0|ht,0|It),It=0|G(0|tr,0|l,0|St,0|mt),i[(mt=We)>>2]=It,i[mt+4>>2]=l,It=0|i[(mt=p)>>2],St=0|i[mt+4>>2],tr=0|i[(mt=f)>>2],ht=0|i[mt+4>>2],mt=0|B(0|It,0|St,18,0),jt=l,pr=0|G(0|tr,0|ht,0|It,0|St),St=0|G(0|pr,0|l,0|mt,0|jt),i[(jt=f)>>2]=St,i[jt+4>>2]=l,St=0|i[(jt=_)>>2],mt=0|i[jt+4>>2],pr=0|i[(jt=h)>>2],It=0|i[jt+4>>2],jt=0|B(0|St,0|mt,18,0),ht=l,tr=0|G(0|pr,0|It,0|St,0|mt),mt=0|G(0|tr,0|l,0|jt,0|ht),i[(ht=h)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=g)>>2],jt=0|i[ht+4>>2],tr=0|i[(ht=m)>>2],St=0|i[ht+4>>2],ht=0|B(0|mt,0|jt,18,0),It=l,pr=0|G(0|tr,0|St,0|mt,0|jt),jt=0|G(0|pr,0|l,0|ht,0|It),i[(It=m)>>2]=jt,i[It+4>>2]=l,jt=0|i[(It=y)>>2],ht=0|i[It+4>>2],pr=0|i[(It=E)>>2],mt=0|i[It+4>>2],It=0|B(0|jt,0|ht,18,0),St=l,tr=0|G(0|pr,0|mt,0|jt,0|ht),ht=0|G(0|tr,0|l,0|It,0|St),i[(St=E)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=S)>>2],It=0|i[St+4>>2],tr=0|i[(St=Me)>>2],jt=0|i[St+4>>2],St=0|B(0|ht,0|It,18,0),mt=l,pr=0|G(0|tr,0|jt,0|ht,0|It),It=0|G(0|pr,0|l,0|St,0|mt),mt=l,i[(St=Me)>>2]=It,i[St+4>>2]=mt,i[(St=S)>>2]=0,i[St+4>>2]=0,St=mt,mt=It,It=0;do{tr=0|k(0|mt,0|St,0|(jt=0|x(0|(ht=0|L(0|(pr=0|G(St>>31>>>6|0,0,0|mt,0|St)),0|l,26)),0|(pr=l),26)),0|l),i[(jt=Me+(It<<3)|0)>>2]=tr,i[jt+4>>2]=l,Zt=0|k(0|(Ht=0|G(0|ht,0|pr,0|i[(tr=jt=Me+((1|It)<<3)|0)>>2],0|i[tr+4>>2])),0|(tr=l),0|(Mt=0|x(0|(ht=0|L(0|(pr=0|G(tr>>31>>>7|0,0,0|Ht,0|tr)),0|l,25)),0|(pr=l),25)),0|l),i[(Mt=jt)>>2]=Zt,i[Mt+4>>2]=l,mt=0|G(0|ht,0|pr,0|i[(Zt=Mt=Me+((It=It+2|0)<<3)|0)>>2],0|i[Zt+4>>2]),St=l,i[(Zt=Mt)>>2]=mt,i[Zt+4>>2]=St}while(It>>>0<10);St=0|i[(It=S)>>2],mt=0|i[It+4>>2],Zt=0|i[(It=Me)>>2],Mt=0|i[It+4>>2],It=0|B(0|St,0|mt,18,0),pr=l,ht=0|G(0|Zt,0|Mt,0|St,0|mt),mt=0|G(0|ht,0|l,0|It,0|pr),pr=l,i[(It=S)>>2]=0,i[It+4>>2]=0,Mt=0|k(0|mt,0|pr,0|(St=0|x(0|(ht=0|L(0|(It=0|G(pr>>31>>>6|0,0,0|mt,0|pr)),0|l,26)),0|(It=l),26)),0|l),St=l,i[(pr=Me)>>2]=Mt,i[pr+4>>2]=St,mt=0|G(0|ht,0|It,0|i[(pr=E)>>2],0|i[pr+4>>2]),pr=l,i[(It=E)>>2]=mt,i[It+4>>2]=pr,ht=0|i[(It=v)>>2],Zt=0|i[It+4>>2],jt=0|i[(It=T)>>2],tr=0|i[It+4>>2],It=0|B(0|ht,0|Zt,18,0),Ht=l,Rt=0|G(0|jt,0|tr,0|ht,0|Zt),Zt=0|G(0|Rt,0|l,0|It,0|Ht),i[(Ht=T)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=C)>>2],It=0|i[Ht+4>>2],Rt=0|i[(Ht=A)>>2],ht=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,jt=0|G(0|Rt,0|ht,0|Zt,0|It),It=0|G(0|jt,0|l,0|Ht,0|tr),i[(tr=A)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=O)>>2],Ht=0|i[tr+4>>2],jt=0|i[(tr=I)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),ht=l,Rt=0|G(0|jt,0|Zt,0|It,0|Ht),Ht=0|G(0|Rt,0|l,0|tr,0|ht),i[(ht=I)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=w)>>2],tr=0|i[ht+4>>2],Rt=0|i[(ht=R)>>2],It=0|i[ht+4>>2],ht=0|B(0|Ht,0|tr,18,0),Zt=l,jt=0|G(0|Rt,0|It,0|Ht,0|tr),tr=0|G(0|jt,0|l,0|ht,0|Zt),i[(Zt=R)>>2]=tr,i[Zt+4>>2]=l,tr=0|i[(Zt=D)>>2],ht=0|i[Zt+4>>2],jt=0|i[(Zt=N)>>2],Ht=0|i[Zt+4>>2],Zt=0|B(0|tr,0|ht,18,0),It=l,Rt=0|G(0|jt,0|Ht,0|tr,0|ht),ht=0|G(0|Rt,0|l,0|Zt,0|It),i[(It=N)>>2]=ht,i[It+4>>2]=l,ht=0|i[(It=K)>>2],Zt=0|i[It+4>>2],Rt=0|i[(It=j)>>2],tr=0|i[It+4>>2],It=0|B(0|ht,0|Zt,18,0),Ht=l,jt=0|G(0|Rt,0|tr,0|ht,0|Zt),Zt=0|G(0|jt,0|l,0|It,0|Ht),i[(Ht=j)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=Y)>>2],It=0|i[Ht+4>>2],jt=0|i[(Ht=W)>>2],ht=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,Rt=0|G(0|jt,0|ht,0|Zt,0|It),It=0|G(0|Rt,0|l,0|Ht,0|tr),i[(tr=W)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=H)>>2],Ht=0|i[tr+4>>2],Rt=0|i[(tr=V)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),ht=l,jt=0|G(0|Rt,0|Zt,0|It,0|Ht),Ht=0|G(0|jt,0|l,0|tr,0|ht),i[(ht=V)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=$)>>2],tr=0|i[ht+4>>2],jt=0|i[(ht=Oe)>>2],It=0|i[ht+4>>2],ht=0|B(0|Ht,0|tr,18,0),Zt=l,Rt=0|G(0|jt,0|It,0|Ht,0|tr),tr=0|G(0|Rt,0|l,0|ht,0|Zt),Zt=l,i[(ht=Oe)>>2]=tr,i[ht+4>>2]=Zt,i[(ht=$)>>2]=0,i[ht+4>>2]=0,ht=Zt,Zt=tr,tr=0;do{jt=0|k(0|Zt,0|ht,0|(It=0|x(0|(Ht=0|L(0|(Rt=0|G(ht>>31>>>6|0,0,0|Zt,0|ht)),0|l,26)),0|(Rt=l),26)),0|l),i[(It=Oe+(tr<<3)|0)>>2]=jt,i[It+4>>2]=l,Ut=0|k(0|(_t=0|G(0|Ht,0|Rt,0|i[(jt=It=Oe+((1|tr)<<3)|0)>>2],0|i[jt+4>>2])),0|(jt=l),0|(gt=0|x(0|(Ht=0|L(0|(Rt=0|G(jt>>31>>>7|0,0,0|_t,0|jt)),0|l,25)),0|(Rt=l),25)),0|l),i[(gt=It)>>2]=Ut,i[gt+4>>2]=l,Zt=0|G(0|Ht,0|Rt,0|i[(Ut=gt=Oe+((tr=tr+2|0)<<3)|0)>>2],0|i[Ut+4>>2]),ht=l,i[(Ut=gt)>>2]=Zt,i[Ut+4>>2]=ht}while(tr>>>0<10);ht=0|i[(tr=$)>>2],Zt=0|i[tr+4>>2],Ut=0|i[(tr=Oe)>>2],gt=0|i[tr+4>>2],tr=0|B(0|ht,0|Zt,18,0),Rt=l,Ht=0|G(0|Ut,0|gt,0|ht,0|Zt),Zt=0|G(0|Ht,0|l,0|tr,0|Rt),Rt=l,i[(tr=$)>>2]=0,i[tr+4>>2]=0,gt=0|k(0|Zt,0|Rt,0|(ht=0|x(0|(Ht=0|L(0|(tr=0|G(Rt>>31>>>6|0,0,0|Zt,0|Rt)),0|l,26)),0|(tr=l),26)),0|l),ht=l,Zt=0|G(0|Ht,0|tr,0|i[(Rt=V)>>2],0|i[Rt+4>>2]),Rt=l,Ht=0|i[(tr=m)>>2],Ut=0|i[tr+4>>2],It=0|i[(tr=h)>>2],jt=0|i[tr+4>>2],_t=0|i[(tr=f)>>2],At=0|i[tr+4>>2],rr=0|i[(tr=We)>>2],$t=0|i[tr+4>>2],zt=0|i[(tr=Ve)>>2],or=0|i[tr+4>>2],Lt=0|i[(tr=qe)>>2],kt=0|i[tr+4>>2],vt=0|i[(tr=r)>>2],Vt=0|i[tr+4>>2],Kt=0|i[(tr=z)>>2],ir=0|i[tr+4>>2],tr=0|G(0|gt,0|ht,0|Mt,0|St),i[(nr=Me)>>2]=tr,i[nr+4>>2]=l,nr=0|G(0|Zt,0|Rt,0|mt,0|pr),i[(tr=E)>>2]=nr,i[tr+4>>2]=l,tr=0|G(0|(nr=0|i[(tr=W)>>2]),0|(yt=0|i[tr+4>>2]),0|Ht,0|Ut),i[(Tt=m)>>2]=tr,i[Tt+4>>2]=l,Tt=0|G(0|(tr=0|i[(Tt=j)>>2]),0|(sr=0|i[Tt+4>>2]),0|It,0|jt),i[(Ft=h)>>2]=Tt,i[Ft+4>>2]=l,Ft=0|G(0|(Tt=0|i[(Ft=N)>>2]),0|(wt=0|i[Ft+4>>2]),0|_t,0|At),i[(qt=f)>>2]=Ft,i[qt+4>>2]=l,qt=0|G(0|(Ft=0|i[(qt=R)>>2]),0|(Jt=0|i[qt+4>>2]),0|rr,0|$t),i[(Gt=We)>>2]=qt,i[Gt+4>>2]=l,Gt=0|G(0|(qt=0|i[(Gt=I)>>2]),0|(ar=0|i[Gt+4>>2]),0|zt,0|or),i[(Bt=Ve)>>2]=Gt,i[Bt+4>>2]=l,Bt=0|G(0|(Gt=0|i[(Bt=A)>>2]),0|(Pt=0|i[Bt+4>>2]),0|Lt,0|kt),i[(bt=qe)>>2]=Bt,i[bt+4>>2]=l,bt=0|G(0|(Bt=0|i[(bt=T)>>2]),0|(ur=0|i[bt+4>>2]),0|vt,0|Vt),i[(Nt=r)>>2]=bt,i[Nt+4>>2]=l,Nt=0|G(0|(bt=0|i[(Nt=q)>>2]),0|(lr=0|i[Nt+4>>2]),0|Kt,0|ir),i[(Qt=z)>>2]=Nt,i[Qt+4>>2]=l,Qt=0|k(0|Mt,0|St,0|gt,0|ht),i[(ht=Oe)>>2]=Qt,i[ht+4>>2]=l,ht=0|k(0|mt,0|pr,0|Zt,0|Rt),i[(Rt=V)>>2]=ht,i[Rt+4>>2]=l,Rt=0|k(0|Ht,0|Ut,0|nr,0|yt),i[(yt=W)>>2]=Rt,i[yt+4>>2]=l,yt=0|k(0|It,0|jt,0|tr,0|sr),i[(sr=j)>>2]=yt,i[sr+4>>2]=l,sr=0|k(0|_t,0|At,0|Tt,0|wt),i[(wt=N)>>2]=sr,i[wt+4>>2]=l,wt=0|k(0|rr,0|$t,0|Ft,0|Jt),i[(Jt=R)>>2]=wt,i[Jt+4>>2]=l,Jt=0|k(0|zt,0|or,0|qt,0|ar),i[(ar=I)>>2]=Jt,i[ar+4>>2]=l,ar=0|k(0|Lt,0|kt,0|Gt,0|Pt),i[(Pt=A)>>2]=ar,i[Pt+4>>2]=l,Pt=0|k(0|vt,0|Vt,0|Bt,0|ur),i[(ur=T)>>2]=Pt,i[ur+4>>2]=l,ur=0|k(0|Kt,0|ir,0|bt,0|lr),i[(lr=q)>>2]=ur,i[lr+4>>2]=l,M(we,Me),M(Ie,Oe),P(Oe,Ie,d),ur=0|i[(lr=v)>>2],bt=0|i[lr+4>>2],ir=0|i[(lr=T)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,Bt=0|G(0|ir,0|Kt,0|ur,0|bt),bt=0|G(0|Bt,0|l,0|lr,0|Pt),i[(Pt=T)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=C)>>2],lr=0|i[Pt+4>>2],Bt=0|i[(Pt=A)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,ir=0|G(0|Bt,0|ur,0|bt,0|lr),lr=0|G(0|ir,0|l,0|Pt,0|Kt),i[(Kt=A)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=O)>>2],Pt=0|i[Kt+4>>2],ir=0|i[(Kt=I)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,Bt=0|G(0|ir,0|bt,0|lr,0|Pt),Pt=0|G(0|Bt,0|l,0|Kt,0|ur),i[(ur=I)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=w)>>2],Kt=0|i[ur+4>>2],Bt=0|i[(ur=R)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,ir=0|G(0|Bt,0|lr,0|Pt,0|Kt),Kt=0|G(0|ir,0|l,0|ur,0|bt),i[(bt=R)>>2]=Kt,i[bt+4>>2]=l,Kt=0|i[(bt=D)>>2],ur=0|i[bt+4>>2],ir=0|i[(bt=N)>>2],Pt=0|i[bt+4>>2],bt=0|B(0|Kt,0|ur,18,0),lr=l,Bt=0|G(0|ir,0|Pt,0|Kt,0|ur),ur=0|G(0|Bt,0|l,0|bt,0|lr),i[(lr=N)>>2]=ur,i[lr+4>>2]=l,ur=0|i[(lr=K)>>2],bt=0|i[lr+4>>2],Bt=0|i[(lr=j)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,ir=0|G(0|Bt,0|Kt,0|ur,0|bt),bt=0|G(0|ir,0|l,0|lr,0|Pt),i[(Pt=j)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=Y)>>2],lr=0|i[Pt+4>>2],ir=0|i[(Pt=W)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,Bt=0|G(0|ir,0|ur,0|bt,0|lr),lr=0|G(0|Bt,0|l,0|Pt,0|Kt),i[(Kt=W)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=H)>>2],Pt=0|i[Kt+4>>2],Bt=0|i[(Kt=V)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,ir=0|G(0|Bt,0|bt,0|lr,0|Pt),Pt=0|G(0|ir,0|l,0|Kt,0|ur),i[(ur=V)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=$)>>2],Kt=0|i[ur+4>>2],ir=0|i[(ur=Oe)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,Bt=0|G(0|ir,0|lr,0|Pt,0|Kt),Kt=0|G(0|Bt,0|l,0|ur,0|bt),bt=l,i[(ur=Oe)>>2]=Kt,i[ur+4>>2]=bt,i[(ur=$)>>2]=0,i[ur+4>>2]=0,ur=bt,bt=Kt,Kt=0;do{ir=0|k(0|bt,0|ur,0|(lr=0|x(0|(Pt=0|L(0|(Bt=0|G(ur>>31>>>6|0,0,0|bt,0|ur)),0|l,26)),0|(Bt=l),26)),0|l),i[(lr=Oe+(Kt<<3)|0)>>2]=ir,i[lr+4>>2]=l,ar=0|k(0|(Vt=0|G(0|Pt,0|Bt,0|i[(ir=lr=Oe+((1|Kt)<<3)|0)>>2],0|i[ir+4>>2])),0|(ir=l),0|(vt=0|x(0|(Pt=0|L(0|(Bt=0|G(ir>>31>>>7|0,0,0|Vt,0|ir)),0|l,25)),0|(Bt=l),25)),0|l),i[(vt=lr)>>2]=ar,i[vt+4>>2]=l,bt=0|G(0|Pt,0|Bt,0|i[(ar=vt=Oe+((Kt=Kt+2|0)<<3)|0)>>2],0|i[ar+4>>2]),ur=l,i[(ar=vt)>>2]=bt,i[ar+4>>2]=ur}while(Kt>>>0<10);ur=0|i[(Kt=$)>>2],bt=0|i[Kt+4>>2],pr=0|i[(Kt=Oe)>>2],mt=0|i[Kt+4>>2],Kt=0|B(0|ur,0|bt,18,0),St=l,Mt=0|G(0|pr,0|mt,0|ur,0|bt),bt=0|G(0|Mt,0|l,0|Kt,0|St),St=l,i[(Kt=$)>>2]=0,i[Kt+4>>2]=0,mt=0|k(0|bt,0|St,0|(ur=0|x(0|(Mt=0|L(0|(Kt=0|G(St>>31>>>6|0,0,0|bt,0|St)),0|l,26)),0|(Kt=l),26)),0|l),i[(ur=Oe)>>2]=mt,i[ur+4>>2]=l,mt=0|G(0|Mt,0|Kt,0|i[(ur=V)>>2],0|i[ur+4>>2]),i[(ur=V)>>2]=mt,i[ur+4>>2]=l,Ye=we,t=(je=it)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));Ye=Oe,t=(je=ot)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));M(be,st),M(Pe,ct),P(lt,be,Pe),mt=0|i[(ur=lt+144|0)>>2],Kt=0|i[ur+4>>2],St=0|i[(Mt=ur=lt+64|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|mt,0|Kt,18,0),pr=l,ar=0|G(0|St,0|bt,0|mt,0|Kt),Kt=0|G(0|ar,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+136|0)>>2],ur=0|i[pr+4>>2],ar=0|i[(Mt=pr=lt+56|0)>>2],mt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,St=0|G(0|ar,0|mt,0|Kt,0|ur),ur=0|G(0|St,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+128|0)>>2],pr=0|i[bt+4>>2],St=0|i[(Mt=bt=lt+48|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),mt=l,ar=0|G(0|St,0|Kt,0|ur,0|pr),pr=0|G(0|ar,0|l,0|Mt,0|mt),i[(mt=bt)>>2]=pr,i[mt+4>>2]=l,pr=0|i[(mt=lt+120|0)>>2],bt=0|i[mt+4>>2],ar=0|i[(Mt=mt=lt+40|0)>>2],ur=0|i[Mt+4>>2],Mt=0|B(0|pr,0|bt,18,0),Kt=l,St=0|G(0|ar,0|ur,0|pr,0|bt),bt=0|G(0|St,0|l,0|Mt,0|Kt),i[(Kt=mt)>>2]=bt,i[Kt+4>>2]=l,bt=0|i[(Kt=lt+112|0)>>2],mt=0|i[Kt+4>>2],St=0|i[(Mt=Kt=lt+32|0)>>2],pr=0|i[Mt+4>>2],Mt=0|B(0|bt,0|mt,18,0),ur=l,ar=0|G(0|St,0|pr,0|bt,0|mt),mt=0|G(0|ar,0|l,0|Mt,0|ur),i[(ur=Kt)>>2]=mt,i[ur+4>>2]=l,mt=0|i[(ur=lt+104|0)>>2],Kt=0|i[ur+4>>2],ar=0|i[(Mt=ur=lt+24|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|mt,0|Kt,18,0),pr=l,St=0|G(0|ar,0|bt,0|mt,0|Kt),Kt=0|G(0|St,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+96|0)>>2],ur=0|i[pr+4>>2],St=0|i[(Mt=pr=lt+16|0)>>2],mt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,ar=0|G(0|St,0|mt,0|Kt,0|ur),ur=0|G(0|ar,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+88|0)>>2],pr=0|i[bt+4>>2],ar=0|i[(Mt=bt=lt+8|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),mt=l,St=0|G(0|ar,0|Kt,0|ur,0|pr),pr=0|G(0|St,0|l,0|Mt,0|mt),i[(mt=bt)>>2]=pr,i[mt+4>>2]=l,Mt=0|i[(pr=mt=lt+80|0)>>2],St=0|i[pr+4>>2],ur=0|i[(pr=lt)>>2],Kt=0|i[pr+4>>2],pr=0|B(0|Mt,0|St,18,0),ar=l,vt=0|G(0|ur,0|Kt,0|Mt,0|St),St=0|G(0|vt,0|l,0|pr,0|ar),ar=l,i[(pr=lt)>>2]=St,i[pr+4>>2]=ar,i[(pr=mt)>>2]=0,i[pr+4>>2]=0,pr=ar,ar=St,St=0;do{ur=0|k(0|ar,0|pr,0|(Kt=0|x(0|(Mt=0|L(0|(vt=0|G(pr>>31>>>6|0,0,0|ar,0|pr)),0|l,26)),0|(vt=l),26)),0|l),i[(Kt=lt+(St<<3)|0)>>2]=ur,i[Kt+4>>2]=l,lr=0|k(0|(Bt=0|G(0|Mt,0|vt,0|i[(ur=Kt=lt+((1|St)<<3)|0)>>2],0|i[ur+4>>2])),0|(ur=l),0|(Pt=0|x(0|(Mt=0|L(0|(vt=0|G(ur>>31>>>7|0,0,0|Bt,0|ur)),0|l,25)),0|(vt=l),25)),0|l),i[(Pt=Kt)>>2]=lr,i[Pt+4>>2]=l,ar=0|G(0|Mt,0|vt,0|i[(lr=Pt=lt+((St=St+2|0)<<3)|0)>>2],0|i[lr+4>>2]),pr=l,i[(lr=Pt)>>2]=ar,i[lr+4>>2]=pr}while(St>>>0<10);pr=0|i[(St=mt)>>2],ar=0|i[St+4>>2],lr=0|i[(St=lt)>>2],Pt=0|i[St+4>>2],St=0|B(0|pr,0|ar,18,0),vt=l,Mt=0|G(0|lr,0|Pt,0|pr,0|ar),ar=0|G(0|Mt,0|l,0|St,0|vt),vt=l,i[(St=mt)>>2]=0,i[St+4>>2]=0,Pt=0|k(0|ar,0|vt,0|(pr=0|x(0|(Mt=0|L(0|(St=0|G(vt>>31>>>6|0,0,0|ar,0|vt)),0|l,26)),0|(St=l),26)),0|l),i[(pr=lt)>>2]=Pt,i[pr+4>>2]=l,Pt=0|G(0|Mt,0|St,0|i[(pr=bt)>>2],0|i[pr+4>>2]),i[(pr=bt)>>2]=Pt,i[pr+4>>2]=l,Mt=0|k(0|(Pt=0|i[(pr=be)>>2]),0|(St=0|i[pr+4>>2]),0|i[(pr=Pe)>>2],0|i[pr+4>>2]),pr=l,i[(vt=Pe)>>2]=Mt,i[vt+4>>2]=pr,Kt=0|k(0|(ar=0|i[(vt=J)>>2]),0|(lr=0|i[vt+4>>2]),0|i[(vt=Q)>>2],0|i[vt+4>>2]),vt=l,i[(ur=Q)>>2]=Kt,i[ur+4>>2]=vt,Vt=0|k(0|(Bt=0|i[(ur=X)>>2]),0|(ir=0|i[ur+4>>2]),0|i[(ur=Z)>>2],0|i[ur+4>>2]),ur=l,i[(Gt=Z)>>2]=Vt,i[Gt+4>>2]=ur,Jt=0|k(0|(kt=0|i[(Gt=ee)>>2]),0|(Lt=0|i[Gt+4>>2]),0|i[(Gt=te)>>2],0|i[Gt+4>>2]),Gt=l,i[(qt=te)>>2]=Jt,i[qt+4>>2]=Gt,wt=0|k(0|(or=0|i[(qt=re)>>2]),0|(zt=0|i[qt+4>>2]),0|i[(qt=ne)>>2],0|i[qt+4>>2]),qt=l,i[(Ft=ne)>>2]=wt,i[Ft+4>>2]=qt,sr=0|k(0|($t=0|i[(Ft=ie)>>2]),0|(rr=0|i[Ft+4>>2]),0|i[(Ft=ae)>>2],0|i[Ft+4>>2]),Ft=l,i[(Tt=ae)>>2]=sr,i[Tt+4>>2]=Ft,yt=0|k(0|(At=0|i[(Tt=oe)>>2]),0|(_t=0|i[Tt+4>>2]),0|i[(Tt=se)>>2],0|i[Tt+4>>2]),Tt=l,i[(tr=se)>>2]=yt,i[tr+4>>2]=Tt,Rt=0|k(0|(jt=0|i[(tr=le)>>2]),0|(It=0|i[tr+4>>2]),0|i[(tr=ce)>>2],0|i[tr+4>>2]),tr=l,i[(nr=ce)>>2]=Rt,i[nr+4>>2]=tr,ht=0|k(0|(Ut=0|i[(nr=de)>>2]),0|(Ht=0|i[nr+4>>2]),0|i[(nr=ue)>>2],0|i[nr+4>>2]),nr=l,i[(Zt=ue)>>2]=ht,i[Zt+4>>2]=nr,Nt=0|k(0|(Qt=0|i[(Zt=pe)>>2]),0|(gt=0|i[Zt+4>>2]),0|i[(Zt=fe)>>2],0|i[Zt+4>>2]),Zt=l,i[(Xt=fe)>>2]=Nt,i[Xt+4>>2]=Zt,t=(je=_e)+72|0;do{i[je>>2]=0,je=je+4|0}while((0|je)<(0|t));bt=0|B(0|Mt,0|pr,121665,0),mt=l,i[(Xt=Ae)>>2]=bt,i[Xt+4>>2]=mt,Xt=0|B(0|Kt,0|vt,121665,0),i[(Et=he)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|Vt,0|ur,121665,0),i[(Xt=ge)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Jt,0|Gt,121665,0),i[(Et=me)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|wt,0|qt,121665,0),i[(Xt=ye)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|sr,0|Ft,121665,0),i[(Et=Ee)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|yt,0|Tt,121665,0),i[(Xt=Se)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Rt,0|tr,121665,0),i[(Et=ve)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|ht,0|nr,121665,0),i[(Xt=Te)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Nt,0|Zt,121665,0),i[(Et=Ce)>>2]=Xt,i[Et+4>>2]=l,i[(Et=_e)>>2]=0,i[Et+4>>2]=0,Et=mt,mt=bt,bt=0;do{xt=0|k(0|mt,0|Et,0|(Wt=0|x(0|(Yt=0|L(0|(Xt=0|G(Et>>31>>>6|0,0,0|mt,0|Et)),0|l,26)),0|(Xt=l),26)),0|l),i[(Wt=Ae+(bt<<3)|0)>>2]=xt,i[Wt+4>>2]=l,cr=0|k(0|(Ot=0|G(0|Yt,0|Xt,0|i[(xt=Wt=Ae+((1|bt)<<3)|0)>>2],0|i[xt+4>>2])),0|(xt=l),0|(dr=0|x(0|(Yt=0|L(0|(Xt=0|G(xt>>31>>>7|0,0,0|Ot,0|xt)),0|l,25)),0|(Xt=l),25)),0|l),i[(dr=Wt)>>2]=cr,i[dr+4>>2]=l,mt=0|G(0|Yt,0|Xt,0|i[(cr=dr=Ae+((bt=bt+2|0)<<3)|0)>>2],0|i[cr+4>>2]),Et=l,i[(cr=dr)>>2]=mt,i[cr+4>>2]=Et}while(bt>>>0<10);Et=0|i[(bt=_e)>>2],mt=0|i[bt+4>>2],Zt=0|i[(bt=Ae)>>2],Nt=0|i[bt+4>>2],bt=0|B(0|Et,0|mt,18,0),nr=l,ht=0|G(0|Zt,0|Nt,0|Et,0|mt),mt=0|G(0|ht,0|l,0|bt,0|nr),nr=l,i[(bt=_e)>>2]=0,i[bt+4>>2]=0,Et=0|x(0|(ht=0|L(0|(bt=0|G(nr>>31>>>6|0,0,0|mt,0|nr)),0|l,26)),0|(bt=l),26),Nt=l,tr=0|i[(Zt=he)>>2],Rt=0|i[Zt+4>>2],nr=0|k(0|(Zt=0|G(0|mt,0|nr,0|Pt,0|St)),0|l,0|Et,0|Nt),i[(Nt=Ae)>>2]=nr,i[Nt+4>>2]=l,Nt=0|G(0|tr,0|Rt,0|ar,0|lr),Rt=0|G(0|Nt,0|l,0|ht,0|bt),i[(bt=he)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ge)>>2],0|i[bt+4>>2],0|Bt,0|ir),i[(bt=ge)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=me)>>2],0|i[bt+4>>2],0|kt,0|Lt),i[(bt=me)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ye)>>2],0|i[bt+4>>2],0|or,0|zt),i[(bt=ye)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ee)>>2],0|i[bt+4>>2],0|$t,0|rr),i[(bt=Ee)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Se)>>2],0|i[bt+4>>2],0|At,0|_t),i[(bt=Se)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ve)>>2],0|i[bt+4>>2],0|jt,0|It),i[(bt=ve)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Te)>>2],0|i[bt+4>>2],0|Ut,0|Ht),i[(bt=Te)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ce)>>2],0|i[bt+4>>2],0|Qt,0|gt),i[(bt=Ce)>>2]=Rt,i[bt+4>>2]=l,P(dt,Pe,Ae),Rt=0|i[(bt=dt+144|0)>>2],ht=0|i[bt+4>>2],tr=0|i[(Nt=bt=dt+64|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|ht,18,0),Et=l,Zt=0|G(0|tr,0|nr,0|Rt,0|ht),ht=0|G(0|Zt,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=dt+136|0)>>2],bt=0|i[Et+4>>2],Zt=0|i[(Nt=Et=dt+56|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|ht,0|bt,18,0),nr=l,tr=0|G(0|Zt,0|Rt,0|ht,0|bt),bt=0|G(0|tr,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+128|0)>>2],Et=0|i[nr+4>>2],tr=0|i[(Nt=nr=dt+48|0)>>2],ht=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,Zt=0|G(0|tr,0|ht,0|bt,0|Et),Et=0|G(0|Zt,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Et=0|i[(Rt=dt+120|0)>>2],nr=0|i[Rt+4>>2],Zt=0|i[(Nt=Rt=dt+40|0)>>2],bt=0|i[Nt+4>>2],Nt=0|B(0|Et,0|nr,18,0),ht=l,tr=0|G(0|Zt,0|bt,0|Et,0|nr),nr=0|G(0|tr,0|l,0|Nt,0|ht),i[(ht=Rt)>>2]=nr,i[ht+4>>2]=l,nr=0|i[(ht=dt+112|0)>>2],Rt=0|i[ht+4>>2],tr=0|i[(Nt=ht=dt+32|0)>>2],Et=0|i[Nt+4>>2],Nt=0|B(0|nr,0|Rt,18,0),bt=l,Zt=0|G(0|tr,0|Et,0|nr,0|Rt),Rt=0|G(0|Zt,0|l,0|Nt,0|bt),i[(bt=ht)>>2]=Rt,i[bt+4>>2]=l,Rt=0|i[(bt=dt+104|0)>>2],ht=0|i[bt+4>>2],Zt=0|i[(Nt=bt=dt+24|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|ht,18,0),Et=l,tr=0|G(0|Zt,0|nr,0|Rt,0|ht),ht=0|G(0|tr,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=dt+96|0)>>2],bt=0|i[Et+4>>2],tr=0|i[(Nt=Et=dt+16|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|ht,0|bt,18,0),nr=l,Zt=0|G(0|tr,0|Rt,0|ht,0|bt),bt=0|G(0|Zt,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+88|0)>>2],Et=0|i[nr+4>>2],Zt=0|i[(Nt=nr=dt+8|0)>>2],ht=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,tr=0|G(0|Zt,0|ht,0|bt,0|Et),Et=0|G(0|tr,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Nt=0|i[(Et=Rt=dt+80|0)>>2],tr=0|i[Et+4>>2],bt=0|i[(Et=dt)>>2],ht=0|i[Et+4>>2],Et=0|B(0|Nt,0|tr,18,0),Zt=l,mt=0|G(0|bt,0|ht,0|Nt,0|tr),tr=0|G(0|mt,0|l,0|Et,0|Zt),Zt=l,i[(Et=dt)>>2]=tr,i[Et+4>>2]=Zt,i[(Et=Rt)>>2]=0,i[Et+4>>2]=0,Et=Zt,Zt=tr,tr=0;do{bt=0|k(0|Zt,0|Et,0|(ht=0|x(0|(Nt=0|L(0|(mt=0|G(Et>>31>>>6|0,0,0|Zt,0|Et)),0|l,26)),0|(mt=l),26)),0|l),i[(ht=dt+(tr<<3)|0)>>2]=bt,i[ht+4>>2]=l,Ft=0|k(0|(Tt=0|G(0|Nt,0|mt,0|i[(bt=ht=dt+((1|tr)<<3)|0)>>2],0|i[bt+4>>2])),0|(bt=l),0|(yt=0|x(0|(Nt=0|L(0|(mt=0|G(bt>>31>>>7|0,0,0|Tt,0|bt)),0|l,25)),0|(mt=l),25)),0|l),i[(yt=ht)>>2]=Ft,i[yt+4>>2]=l,Zt=0|G(0|Nt,0|mt,0|i[(Ft=yt=dt+((tr=tr+2|0)<<3)|0)>>2],0|i[Ft+4>>2]),Et=l,i[(Ft=yt)>>2]=Zt,i[Ft+4>>2]=Et}while(tr>>>0<10);Et=0|i[(tr=Rt)>>2],Zt=0|i[tr+4>>2],gt=0|i[(tr=dt)>>2],Qt=0|i[tr+4>>2],tr=0|B(0|Et,0|Zt,18,0),Ht=l,Ut=0|G(0|gt,0|Qt,0|Et,0|Zt),Zt=0|G(0|Ut,0|l,0|tr,0|Ht),Ht=l,i[(tr=Rt)>>2]=0,i[tr+4>>2]=0,Qt=0|k(0|Zt,0|Ht,0|(Et=0|x(0|(Ut=0|L(0|(tr=0|G(Ht>>31>>>6|0,0,0|Zt,0|Ht)),0|l,26)),0|(tr=l),26)),0|l),i[(Et=dt)>>2]=Qt,i[Et+4>>2]=l,Qt=0|G(0|Ut,0|tr,0|i[(Et=nr)>>2],0|i[Et+4>>2]),i[(Et=nr)>>2]=Qt,i[Et+4>>2]=l,Et=0;do{Ut=0|i[(tr=Qt=lt+(Et<<3)|0)>>2],Ht=0|i[tr+4>>2],gt=0|i[(Zt=tr=it+(Et<<3)|0)>>2],jt=((It=0|i[Zt+4>>2])^Ht)&ft,Ht=0|L(0,(Zt=(gt^Ut)&pt)^Ut|0,32),i[(Ut=Qt)>>2]=Ht,i[Ut+4>>2]=l,Ut=0|L(0,Zt^gt|0,32),i[(gt=tr)>>2]=Ut,i[gt+4>>2]=l,Et=Et+1|0}while(10!=(0|Et));fr=0;do{Rt=0|i[(nr=Et=dt+(fr<<3)|0)>>2],gt=0|i[nr+4>>2],tr=0|i[(Ut=nr=ot+(fr<<3)|0)>>2],Ht=((Zt=0|i[Ut+4>>2])^gt)&ft,gt=0|L(0,(Ut=(tr^Rt)&pt)^Rt|0,32),i[(Rt=Et)>>2]=gt,i[Rt+4>>2]=l,Rt=0|L(0,Ut^tr|0,32),i[(tr=nr)>>2]=Rt,i[tr+4>>2]=l,fr=fr+1|0}while(10!=(0|fr));if(8==(0|(rt=rt+1|0))){_r=nt,hr=it,gr=at,mr=ot,yr=st,Er=lt,Sr=ct,vr=dt;break}ft=dt,pt=lt,tr=ot,Rt=it,Fe=ut<<1&255,dt=ct,ct=ft,lt=st,st=pt,ot=at,at=tr,it=nt,nt=Rt}if(32==(0|(nt=Qe+1|0))){Tr=Er,Cr=vr;break}Qe=nt,Xe=hr,Ze=_r,ke=mr,et=gr,Ge=Er,tt=yr,Ue=vr,Le=Sr}Ye=Tr,t=(je=xe)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));Ye=Cr,t=(je=Be)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));M(Ae,Be),M(Ne,Ae),M(De,Ne),b(be,De,Be),b(Pe,be,Ae),M(De,Pe),b(Me,De,be),M(De,Me),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(Oe,De,Me),M(De,Oe),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ie,Ne,Oe),M(De,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(De,Ne,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(we,De,Oe),M(De,we),M(Ne,De),Oe=2;do{M(De,Ne),M(Ne,De),Oe=Oe+2|0}while((0|Oe)<50);b(Re,Ne,we),M(Ne,Re),M(De,Ne),Oe=2;do{M(Ne,De),M(De,Ne),Oe=Oe+2|0}while((0|Oe)<100);b(Ne,De,Re),M(De,Ne),M(Ne,De),Re=2;do{M(De,Ne),M(Ne,De),Re=Re+2|0}while((0|Re)<50);for(b(De,Ne,we),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ke,Ne,Pe),b(Be,xe,Ke),Ke=0|i[Be>>2],i[Ae>>2]=Ke,i[(xe=Ae+4|0)>>2]=i[Be+8>>2],i[(Pe=Ae+8|0)>>2]=i[Be+16>>2],i[(Ne=Ae+12|0)>>2]=i[Be+24>>2],i[(De=Ae+16|0)>>2]=i[Be+32>>2],i[(we=Ae+20|0)>>2]=i[Be+40>>2],i[(Re=Ae+24|0)>>2]=i[Be+48>>2],i[(Oe=Ae+28|0)>>2]=i[Be+56>>2],i[(Ie=Ae+32|0)>>2]=i[Be+64>>2],i[(Me=Ae+36|0)>>2]=i[Be+72>>2],Be=Ke,Ke=0;be=Ae+(Ke<<2)|0,Ye=Be>>31&Be,1&Ke?(t=Ye>>25,i[be>>2]=(0|c(t,-33554432))+Be,Tr=(0|i[(Ye=Ae+((be=Ke+1|0)<<2)|0)>>2])+t|0,i[Ye>>2]=Tr,Ar=Tr,br=be):(je=Ye>>26,i[be>>2]=(0|c(je,-67108864))+Be,Tr=(0|i[(Cr=Ae+((t=Ke+1|0)<<2)|0)>>2])+je|0,i[Cr>>2]=Tr,Ar=Tr,br=t),9!=(0|br);)Be=Ar,Ke=br;for(Ke=((br=0|i[Me>>2])>>31&br)>>25,i[Me>>2]=(0|c(Ke,-33554432))+br,br=(19*Ke|0)+(0|i[Ae>>2])|0,i[Ae>>2]=br,Ke=br,br=0;Ar=Ae+(br<<2)|0,Be=Ke>>31&Ke,1&br?(t=Be>>25,i[Ar>>2]=(0|c(t,-33554432))+Ke,Tr=(0|i[(Be=Ae+((Ar=br+1|0)<<2)|0)>>2])+t|0,i[Be>>2]=Tr,Pr=Ar,Mr=Tr):(be=Be>>26,i[Ar>>2]=(0|c(be,-67108864))+Ke,t=(0|i[(Ye=Ae+((Tr=br+1|0)<<2)|0)>>2])+be|0,i[Ye>>2]=t,Pr=Tr,Mr=t),9!=(0|Pr);)Ke=Mr,br=Pr;for(br=((Pr=0|i[Me>>2])>>31&Pr)>>25,i[Me>>2]=(0|c(br,-33554432))+Pr,Pr=(19*br|0)+(0|i[Ae>>2])|0,Mr=(0|c(br=(Pr>>31&Pr)>>26,-67108864))+Pr|0,i[Ae>>2]=Mr,i[xe>>2]=br+(0|i[xe>>2]),br=Mr,Mr=0;Pr=Ae+(Mr<<2)|0,1&Mr?(i[Pr>>2]=33554431&br,Ke=(0|i[(Ar=Ae+((Pr=Mr+1|0)<<2)|0)>>2])+(br>>25)|0,i[Ar>>2]=Ke,Or=Pr,Ir=Ke):(i[Pr>>2]=67108863&br,Ar=(0|i[(Tr=Ae+((Ke=Mr+1|0)<<2)|0)>>2])+(br>>26)|0,i[Tr>>2]=Ar,Or=Ke,Ir=Ar),9!=(0|Or);)br=Ir,Mr=Or;for(Or=0|i[Me>>2],i[Me>>2]=33554431&Or,Mr=(19*(Or>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Mr,Or=Mr,Mr=0;Ir=Ae+(Mr<<2)|0,1&Mr?(i[Ir>>2]=33554431&Or,br=(0|i[(Pr=Ae+((Ir=Mr+1|0)<<2)|0)>>2])+(Or>>25)|0,i[Pr>>2]=br,wr=Ir,Rr=br):(i[Ir>>2]=67108863&Or,Pr=(0|i[(Ke=Ae+((br=Mr+1|0)<<2)|0)>>2])+(Or>>26)|0,i[Ke>>2]=Pr,wr=br,Rr=Pr),9!=(0|wr);)Or=Rr,Mr=wr;for(Mr=33554431&(wr=0|i[Me>>2]),i[Me>>2]=Mr,Rr=(19*(wr>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Rr,wr=1,Or=~(Rr+-67108845>>31);;){if(br=0|i[Ae+(wr<<2)>>2],Dr=1&wr?(br=(Pr=(br=(Pr=br<<16&(-33554432^br))<<8&Pr)<<4&br)<<2&Pr)<<1&br:(Pr=(Ir=(Pr=(Ir=br<<16&(-67108864^br))<<8&Ir)<<4&Pr)<<2&Ir)<<1&Pr,br=Dr>>31&Or,10==(0|(wr=wr+1|0))){Nr=br;break}Or=br}return Or=Rr-(67108845&Nr)|0,i[Ae>>2]=Or,Ae=67108863&Nr,Rr=33554431&Nr,Dr=(wr=(0|i[xe>>2])-Rr|0)<<2,Pr=(br=(0|i[Pe>>2])-Ae|0)<<3,Ke=(Ir=(0|i[Ne>>2])-Rr|0)<<5,Nr=(Ar=(0|i[De>>2])-Nr|0)<<6,Tr=(0|i[we>>2])-Rr|0,i[we>>2]=Tr,Be=(we=(0|i[Re>>2])-Ae|0)<<1,Ye=(t=(0|i[Oe>>2])-Rr|0)<<3,be=(0|i[Ie>>2])-Ae<<4,i[xe>>2]=Dr,i[Pe>>2]=Pr,i[Ne>>2]=Ke,i[De>>2]=Nr,i[Re>>2]=Be,i[Oe>>2]=Ye,i[Ie>>2]=be,i[Me>>2]=Mr-Rr<<6,n[e>>0]=Or,n[e+1>>0]=Or>>>8,n[e+2>>0]=Or>>>16,n[e+3>>0]=Dr|Or>>>24,n[e+4>>0]=wr>>>6,n[e+5>>0]=wr>>>14,n[e+6>>0]=Pr|wr>>>22,n[e+7>>0]=br>>>5,n[e+8>>0]=br>>>13,n[e+9>>0]=Ke|br>>>21,n[e+10>>0]=Ir>>>3,n[e+11>>0]=Ir>>>11,n[e+12>>0]=Nr|Ir>>>19,n[e+13>>0]=Ar>>>2,n[e+14>>0]=Ar>>>10,n[e+15>>0]=Ar>>>18,n[e+16>>0]=Tr,n[e+17>>0]=Tr>>>8,n[e+18>>0]=Tr>>>16,n[e+19>>0]=Tr>>>24|Be,n[e+20>>0]=we>>>7,n[e+21>>0]=we>>>15,n[e+22>>0]=we>>>23|Ye,n[e+23>>0]=t>>>5,n[e+24>>0]=t>>>13,Ye=0|i[Ie>>2],n[e+25>>0]=t>>>21|Ye,n[e+26>>0]=Ye>>>8,n[e+27>>0]=Ye>>>16,t=0|i[Me>>2],n[e+28>>0]=Ye>>>24|t,n[e+29>>0]=t>>>8,n[e+30>>0]=t>>>16,n[e+31>>0]=t>>>24,o=s,0},_free:function(e){var t,r,n=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,_=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0;if(e|=0){(n=e+-8|0)>>>0<(a=0|i[47])>>>0&&h(),1==(0|(e=3&(t=0|i[e+-4>>2])))&&h(),r=n+(o=-8&t)|0;do{if(1&t)p=n,f=o;else{if(s=0|i[n>>2],!e)return;if(c=s+o|0,(l=n+(0-s)|0)>>>0<a>>>0&&h(),(0|l)==(0|i[48])){if(3!=(3&(u=0|i[(d=r+4|0)>>2])|0)){p=l,f=c;break}return i[45]=c,i[d>>2]=-2&u,i[l+4>>2]=1|c,void(i[l+c>>2]=c)}if(u=s>>>3,s>>>0<256){if(s=0|i[l+8>>2],d=0|i[l+12>>2],(0|s)!=(0|(_=212+(u<<1<<2)|0))&&(s>>>0<a>>>0&&h(),(0|i[s+12>>2])!=(0|l)&&h()),(0|d)==(0|s)){i[43]=i[43]&~(1<<u),p=l,f=c;break}(0|d)!=(0|_)?(d>>>0<a>>>0&&h(),(0|i[(_=d+8|0)>>2])==(0|l)?g=_:h()):g=d+8|0,i[s+12>>2]=d,i[g>>2]=s,p=l,f=c;break}s=0|i[l+24>>2],d=0|i[l+12>>2];do{if((0|d)==(0|l)){if(m=0|i[(u=(_=l+16|0)+4|0)>>2])S=m,v=u;else{if(!(y=0|i[_>>2])){E=0;break}S=y,v=_}for(;;)if(m=0|i[(u=S+20|0)>>2])S=m,v=u;else{if(!(m=0|i[(u=S+16|0)>>2])){T=S,C=v;break}S=m,v=u}if(!(C>>>0<a>>>0)){i[C>>2]=0,E=T;break}h()}else{if((u=0|i[l+8>>2])>>>0<a>>>0&&h(),(0|i[(m=u+12|0)>>2])!=(0|l)&&h(),(0|i[(_=d+8|0)>>2])==(0|l)){i[m>>2]=d,i[_>>2]=u,E=d;break}h()}}while(0);if(s){if(d=0|i[l+28>>2],(0|l)==(0|i[(u=476+(d<<2)|0)>>2])){if(i[u>>2]=E,!E){i[44]=i[44]&~(1<<d),p=l,f=c;break}}else if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(d=s+16|0)>>2])==(0|l)?i[d>>2]=E:i[s+20>>2]=E,!E){p=l,f=c;break}E>>>0<(d=0|i[47])>>>0&&h(),i[E+24>>2]=s,_=0|i[(u=l+16|0)>>2];do{if(_){if(!(_>>>0<d>>>0)){i[E+16>>2]=_,i[_+24>>2]=E;break}h()}}while(0);if(_=0|i[u+4>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[E+20>>2]=_,i[_+24>>2]=E,p=l,f=c;break}h()}else p=l,f=c}else p=l,f=c}}while(0);if(p>>>0>=r>>>0&&h(),1&(n=0|i[(o=r+4|0)>>2])||h(),2&n)i[o>>2]=-2&n,i[p+4>>2]=1|f,i[p+f>>2]=f,w=f;else{if((0|r)==(0|i[49])){if(E=(0|i[46])+f|0,i[46]=E,i[49]=p,i[p+4>>2]=1|E,(0|p)!=(0|i[48]))return;return i[48]=0,void(i[45]=0)}if((0|r)==(0|i[48]))return E=(0|i[45])+f|0,i[45]=E,i[48]=p,i[p+4>>2]=1|E,void(i[p+E>>2]=E);E=(-8&n)+f|0,a=n>>>3;do{if(n>>>0>=256){T=0|i[r+24>>2],C=0|i[r+12>>2];do{if((0|C)==(0|r)){if(g=0|i[(S=(v=r+16|0)+4|0)>>2])b=g,P=S;else{if(!(e=0|i[v>>2])){A=0;break}b=e,P=v}for(;;)if(g=0|i[(S=b+20|0)>>2])b=g,P=S;else{if(!(g=0|i[(S=b+16|0)>>2])){M=b,O=P;break}b=g,P=S}if(!(O>>>0<(0|i[47])>>>0)){i[O>>2]=0,A=M;break}h()}else{if((S=0|i[r+8>>2])>>>0<(0|i[47])>>>0&&h(),(0|i[(g=S+12|0)>>2])!=(0|r)&&h(),(0|i[(v=C+8|0)>>2])==(0|r)){i[g>>2]=C,i[v>>2]=S,A=C;break}h()}}while(0);if(T){if(C=0|i[r+28>>2],(0|r)==(0|i[(c=476+(C<<2)|0)>>2])){if(i[c>>2]=A,!A){i[44]=i[44]&~(1<<C);break}}else if(T>>>0<(0|i[47])>>>0&&h(),(0|i[(C=T+16|0)>>2])==(0|r)?i[C>>2]=A:i[T+20>>2]=A,!A)break;A>>>0<(C=0|i[47])>>>0&&h(),i[A+24>>2]=T,l=0|i[(c=r+16|0)>>2];do{if(l){if(!(l>>>0<C>>>0)){i[A+16>>2]=l,i[l+24>>2]=A;break}h()}}while(0);if(l=0|i[c+4>>2]){if(!(l>>>0<(0|i[47])>>>0)){i[A+20>>2]=l,i[l+24>>2]=A;break}h()}}}else{if(l=0|i[r+8>>2],C=0|i[r+12>>2],(0|l)!=(0|(T=212+(a<<1<<2)|0))&&(l>>>0<(0|i[47])>>>0&&h(),(0|i[l+12>>2])!=(0|r)&&h()),(0|C)==(0|l)){i[43]=i[43]&~(1<<a);break}(0|C)!=(0|T)?(C>>>0<(0|i[47])>>>0&&h(),(0|i[(T=C+8|0)>>2])==(0|r)?I=T:h()):I=C+8|0,i[l+12>>2]=C,i[I>>2]=l}}while(0);if(i[p+4>>2]=1|E,i[p+E>>2]=E,(0|p)==(0|i[48]))return void(i[45]=E);w=E}if(f=w>>>3,w>>>0<256)return n=212+(f<<1<<2)|0,(o=0|i[43])&(E=1<<f)?(I=0|i[(f=n+8|0)>>2])>>>0<(0|i[47])>>>0?h():(R=f,D=I):(i[43]=o|E,R=n+8|0,D=n),i[R>>2]=p,i[D+12>>2]=p,i[p+8>>2]=D,void(i[p+12>>2]=n);N=(n=w>>>8)?w>>>0>16777215?31:w>>>((o=14-((n=((R=n<<(D=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|D|(R=((E=R<<n)+245760|0)>>>16&2))+(E<<R>>>15)|0)+7|0)&1|o<<1:0,o=476+(N<<2)|0,i[p+28>>2]=N,i[p+20>>2]=0,i[p+16>>2]=0,R=0|i[44],E=1<<N;do{if(R&E){for(D=w<<(31==(0|N)?0:25-(N>>>1)|0),n=0|i[o>>2];;){if((-8&i[n+4>>2]|0)==(0|w)){L=n,k=130;break}if(!(f=0|i[(I=n+16+(D>>>31<<2)|0)>>2])){G=I,U=n,k=127;break}D<<=1,n=f}if(127==(0|k)){if(!(G>>>0<(0|i[47])>>>0)){i[G>>2]=p,i[p+24>>2]=U,i[p+12>>2]=p,i[p+8>>2]=p;break}h()}else if(130==(0|k)){if((D=0|i[(n=L+8|0)>>2])>>>0>=(c=0|i[47])>>>0&L>>>0>=c>>>0){i[D+12>>2]=p,i[n>>2]=p,i[p+8>>2]=D,i[p+12>>2]=L,i[p+24>>2]=0;break}h()}}else i[44]=R|E,i[o>>2]=p,i[p+24>>2]=o,i[p+12>>2]=p,i[p+8>>2]=p}while(0);if(p=(0|i[51])-1|0,i[51]=p,!p){for(F=628;p=0|i[F>>2];)F=p+8|0;i[51]=-1}}},_i64Add:G,_bitshift64Ashr:L,_i64Subtract:k,_memset:U,_malloc:function(e){e|=0;var t=0,r=0,n=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,_=0,y=0,E=0,S=0,v=0,T=0,A=0,b=0,P=0,M=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0,x=0,B=0,K=0,j=0,Y=0,W=0,H=0,V=0,$=0,z=0,q=0,J=0,Q=0,X=0,Z=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,de=0,ue=0,pe=0,fe=0,_e=0,he=0,ge=0,me=0,ye=0,Ee=0,Se=0,ve=0,Te=0,Ce=0,Ae=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,je=0;do{if(e>>>0<245){if(r=(t=e>>>0<11?16:e+11&-8)>>>3,3&(a=(n=0|i[43])>>>r)){c=0|i[(l=(s=212+((o=(1&a^1)+r|0)<<1<<2)|0)+8|0)>>2],u=0|i[(d=c+8|0)>>2];do{if((0|s)!=(0|u)){if(u>>>0<(0|i[47])>>>0&&h(),(0|i[(p=u+12|0)>>2])==(0|c)){i[p>>2]=s,i[l>>2]=u;break}h()}else i[43]=n&~(1<<o)}while(0);return u=o<<3,i[c+4>>2]=3|u,i[(l=c+u+4|0)>>2]=1|i[l>>2],0|d}if(t>>>0>(l=0|i[45])>>>0){if(a){f=0|i[(y=(_=212+((E=((u=(p=(u=((s=a<<r&((u=2<<r)|0-u))&0-s)-1|0)>>>(s=u>>>12&16))>>>5&8)|s|(p=(f=p>>>u)>>>2&4)|(f=(_=f>>>p)>>>1&2)|(_=(y=_>>>f)>>>1&1))+(y>>>_)|0)<<1<<2)|0)+8|0)>>2],s=0|i[(p=f+8|0)>>2];do{if((0|_)!=(0|s)){if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(u=s+12|0)>>2])==(0|f)){i[u>>2]=_,i[y>>2]=s,S=0|i[45];break}h()}else i[43]=n&~(1<<E),S=l}while(0);return l=(E<<3)-t|0,i[f+4>>2]=3|t,i[(n=f+t|0)+4>>2]=1|l,i[n+l>>2]=l,S&&(s=0|i[48],_=212+((y=S>>>3)<<1<<2)|0,(r=0|i[43])&(a=1<<y)?(d=0|i[(y=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(v=y,T=d):(i[43]=r|a,v=_+8|0,T=_),i[v>>2]=s,i[T+12>>2]=s,i[s+8>>2]=T,i[s+12>>2]=_),i[45]=l,i[48]=n,0|p}if(n=0|i[44]){for(d=0|i[476+(((l=(_=(l=(n&0-n)-1|0)>>>(n=l>>>12&16))>>>5&8)|n|(_=(s=_>>>l)>>>2&4)|(s=(a=s>>>_)>>>1&2)|(a=(r=a>>>s)>>>1&1))+(r>>>a)<<2)>>2],a=(-8&i[d+4>>2])-t|0,r=d,s=d;;){if(d=0|i[r+16>>2])P=d;else{if(!(_=0|i[r+20>>2])){A=a,b=s;break}P=_}a=(_=(d=(-8&i[P+4>>2])-t|0)>>>0<a>>>0)?d:a,r=P,s=_?P:s}b>>>0<(s=0|i[47])>>>0&&h(),b>>>0>=(r=b+t|0)>>>0&&h(),a=0|i[b+24>>2],p=0|i[b+12>>2];do{if((0|p)==(0|b)){if(E=0|i[(f=b+20|0)>>2])I=E,w=f;else{if(!(d=0|i[(_=b+16|0)>>2])){M=0;break}I=d,w=_}for(;;)if(E=0|i[(f=I+20|0)>>2])I=E,w=f;else{if(!(E=0|i[(f=I+16|0)>>2])){R=I,D=w;break}I=E,w=f}if(!(D>>>0<s>>>0)){i[D>>2]=0,M=R;break}h()}else{if((f=0|i[b+8>>2])>>>0<s>>>0&&h(),(0|i[(E=f+12|0)>>2])!=(0|b)&&h(),(0|i[(_=p+8|0)>>2])==(0|b)){i[E>>2]=p,i[_>>2]=f,M=p;break}h()}}while(0);do{if(a){if(p=0|i[b+28>>2],(0|b)==(0|i[(s=476+(p<<2)|0)>>2])){if(i[s>>2]=M,!M){i[44]=i[44]&~(1<<p);break}}else if(a>>>0<(0|i[47])>>>0&&h(),(0|i[(p=a+16|0)>>2])==(0|b)?i[p>>2]=M:i[a+20>>2]=M,!M)break;M>>>0<(p=0|i[47])>>>0&&h(),i[M+24>>2]=a,s=0|i[b+16>>2];do{if(s){if(!(s>>>0<p>>>0)){i[M+16>>2]=s,i[s+24>>2]=M;break}h()}}while(0);if(s=0|i[b+20>>2]){if(!(s>>>0<(0|i[47])>>>0)){i[M+20>>2]=s,i[s+24>>2]=M;break}h()}}}while(0);return A>>>0<16?(a=A+t|0,i[b+4>>2]=3|a,i[(s=b+a+4|0)>>2]=1|i[s>>2]):(i[b+4>>2]=3|t,i[r+4>>2]=1|A,i[r+A>>2]=A,(s=0|i[45])&&(a=0|i[48],s=212+((p=s>>>3)<<1<<2)|0,(f=0|i[43])&(_=1<<p)?(E=0|i[(p=s+8|0)>>2])>>>0<(0|i[47])>>>0?h():(N=p,L=E):(i[43]=f|_,N=s+8|0,L=s),i[N>>2]=a,i[L+12>>2]=a,i[a+8>>2]=L,i[a+12>>2]=s),i[45]=A,i[48]=r),0|(b+8|0)}k=t}else k=t}else if(e>>>0<=4294967231)if(a=-8&(s=e+11|0),_=0|i[44]){f=0-a|0,G=(E=s>>>8)?a>>>0>16777215?31:a>>>((n=14-((E=((p=E<<(s=(E+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(p=((d=p<<E)+245760|0)>>>16&2))+(d<<p>>>15)|0)+7|0)&1|n<<1:0,n=0|i[476+(G<<2)>>2];e:do{if(n)for(p=f,d=0,s=a<<(31==(0|G)?0:25-(G>>>1)|0),E=n,l=0;;){if((c=(y=-8&i[E+4>>2])-a|0)>>>0<p>>>0){if((0|y)==(0|a)){K=c,j=E,Y=E,B=90;break e}W=c,H=E}else W=p,H=l;if(y=0==(0|(c=0|i[E+20>>2]))|(0|c)==(0|(E=0|i[E+16+(s>>>31<<2)>>2]))?d:c,c=0==(0|E)){U=W,F=y,x=H,B=86;break}p=W,d=y,s<<=1&c^1,l=H}else U=f,F=0,x=0,B=86}while(0);if(86==(0|B)){if(0==(0|F)&0==(0|x)){if(!(f=_&((n=2<<G)|0-n))){k=a;break}V=0|i[476+(((n=(t=(n=(f&0-f)-1|0)>>>(f=n>>>12&16))>>>5&8)|f|(t=(r=t>>>n)>>>2&4)|(r=(l=r>>>t)>>>1&2)|(l=(s=l>>>r)>>>1&1))+(s>>>l)<<2)>>2]}else V=F;V?(K=U,j=V,Y=x,B=90):($=U,z=x)}if(90==(0|B))for(;;)if(B=0,r=(s=(l=(-8&i[j+4>>2])-a|0)>>>0<K>>>0)?l:K,l=s?j:Y,s=0|i[j+16>>2])K=r,j=s,Y=l,B=90;else{if(!(j=0|i[j+20>>2])){$=r,z=l;break}K=r,Y=l,B=90}if(0!=(0|z)&&$>>>0<((0|i[45])-a|0)>>>0){z>>>0<(_=0|i[47])>>>0&&h(),z>>>0>=(l=z+a|0)>>>0&&h(),r=0|i[z+24>>2],s=0|i[z+12>>2];do{if((0|s)==(0|z)){if(f=0|i[(t=z+20|0)>>2])J=f,Q=t;else{if(!(d=0|i[(n=z+16|0)>>2])){q=0;break}J=d,Q=n}for(;;)if(f=0|i[(t=J+20|0)>>2])J=f,Q=t;else{if(!(f=0|i[(t=J+16|0)>>2])){X=J,Z=Q;break}J=f,Q=t}if(!(Z>>>0<_>>>0)){i[Z>>2]=0,q=X;break}h()}else{if((t=0|i[z+8>>2])>>>0<_>>>0&&h(),(0|i[(f=t+12|0)>>2])!=(0|z)&&h(),(0|i[(n=s+8|0)>>2])==(0|z)){i[f>>2]=s,i[n>>2]=t,q=s;break}h()}}while(0);do{if(r){if(s=0|i[z+28>>2],(0|z)==(0|i[(_=476+(s<<2)|0)>>2])){if(i[_>>2]=q,!q){i[44]=i[44]&~(1<<s);break}}else if(r>>>0<(0|i[47])>>>0&&h(),(0|i[(s=r+16|0)>>2])==(0|z)?i[s>>2]=q:i[r+20>>2]=q,!q)break;q>>>0<(s=0|i[47])>>>0&&h(),i[q+24>>2]=r,_=0|i[z+16>>2];do{if(_){if(!(_>>>0<s>>>0)){i[q+16>>2]=_,i[_+24>>2]=q;break}h()}}while(0);if(_=0|i[z+20>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[q+20>>2]=_,i[_+24>>2]=q;break}h()}}}while(0);do{if($>>>0>=16){if(i[z+4>>2]=3|a,i[l+4>>2]=1|$,i[l+$>>2]=$,r=$>>>3,$>>>0<256){_=212+(r<<1<<2)|0,(s=0|i[43])&(t=1<<r)?(n=0|i[(r=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(ee=r,te=n):(i[43]=s|t,ee=_+8|0,te=_),i[ee>>2]=l,i[te+12>>2]=l,i[l+8>>2]=te,i[l+12>>2]=_;break}if(re=(_=$>>>8)?$>>>0>16777215?31:$>>>((r=14-((_=((s=_<<(t=(_+1048320|0)>>>16&8))+520192|0)>>>16&4)|t|(s=((n=s<<_)+245760|0)>>>16&2))+(n<<s>>>15)|0)+7|0)&1|r<<1:0,r=476+(re<<2)|0,i[l+28>>2]=re,i[(s=l+16|0)+4>>2]=0,i[s>>2]=0,!((s=0|i[44])&(n=1<<re))){i[44]=s|n,i[r>>2]=l,i[l+24>>2]=r,i[l+12>>2]=l,i[l+8>>2]=l;break}for(n=$<<(31==(0|re)?0:25-(re>>>1)|0),s=0|i[r>>2];;){if((-8&i[s+4>>2]|0)==(0|$)){ne=s,B=148;break}if(!(t=0|i[(r=s+16+(n>>>31<<2)|0)>>2])){ie=r,ae=s,B=145;break}n<<=1,s=t}if(145==(0|B)){if(!(ie>>>0<(0|i[47])>>>0)){i[ie>>2]=l,i[l+24>>2]=ae,i[l+12>>2]=l,i[l+8>>2]=l;break}h()}else if(148==(0|B)){if((n=0|i[(s=ne+8|0)>>2])>>>0>=(t=0|i[47])>>>0&ne>>>0>=t>>>0){i[n+12>>2]=l,i[s>>2]=l,i[l+8>>2]=n,i[l+12>>2]=ne,i[l+24>>2]=0;break}h()}}else n=$+a|0,i[z+4>>2]=3|n,i[(s=z+n+4|0)>>2]=1|i[s>>2]}while(0);return 0|(z+8|0)}k=a}else k=a;else k=-1}while(0);if((z=0|i[45])>>>0>=k>>>0)return $=z-k|0,ne=0|i[48],$>>>0>15?(ae=ne+k|0,i[48]=ae,i[45]=$,i[ae+4>>2]=1|$,i[ae+$>>2]=$,i[ne+4>>2]=3|k):(i[45]=0,i[48]=0,i[ne+4>>2]=3|z,i[($=ne+z+4|0)>>2]=1|i[$>>2]),0|(ne+8|0);if((ne=0|i[46])>>>0>k>>>0)return $=ne-k|0,i[46]=$,z=(ne=0|i[49])+k|0,i[49]=z,i[z+4>>2]=1|$,i[ne+4>>2]=3|k,0|(ne+8|0);do{if(!(0|i[161])){if(!((ne=0|C(30))+-1&ne)){i[163]=ne,i[162]=ne,i[164]=-1,i[165]=-1,i[166]=0,i[154]=0,i[161]=-16&(0|m(0))^1431655768;break}h()}}while(0);if(ne=k+48|0,($=(ae=($=0|i[163])+(z=k+47|0)|0)&(ie=0-$|0))>>>0<=k>>>0)return 0|0;if(0!=(0|(re=0|i[153]))&&(ee=(te=0|i[151])+$|0)>>>0<=te>>>0|ee>>>0>re>>>0)return 0|0;e:do{if(4&i[154])B=190;else{re=0|i[49];t:do{if(re){for(ee=620;;){if((te=0|i[ee>>2])>>>0<=re>>>0&&(te+(0|i[(q=ee+4|0)>>2])|0)>>>0>re>>>0){oe=ee,se=q;break}if(!(ee=0|i[ee+8>>2])){B=173;break t}}if((ee=ae-(0|i[46])&ie)>>>0<2147483647)if((0|(q=0|g(0|ee)))==((0|i[oe>>2])+(0|i[se>>2])|0)){if(-1!=(0|q)){le=q,ce=ee,B=193;break e}}else de=q,ue=ee,B=183}else B=173}while(0);do{if(173==(0|B)&&-1!=(0|(re=0|g(0)))&&(a=re,pe=(q=(ee=0|i[162])+-1|0)&a?$-a+(q+a&0-ee)|0:$,a=(ee=0|i[151])+pe|0,pe>>>0>k>>>0&pe>>>0<2147483647)){if(0!=(0|(q=0|i[153]))&&a>>>0<=ee>>>0|a>>>0>q>>>0)break;if((0|(q=0|g(0|pe)))==(0|re)){le=re,ce=pe,B=193;break e}de=q,ue=pe,B=183}}while(0);t:do{if(183==(0|B)){q=0-ue|0;do{if(ne>>>0>ue>>>0&ue>>>0<2147483647&-1!=(0|de)&&(a=z-ue+(re=0|i[163])&0-re)>>>0<2147483647){if(-1==(0|g(0|a))){g(0|q);break t}fe=a+ue|0;break}fe=ue}while(0);if(-1!=(0|de)){le=de,ce=fe,B=193;break e}}}while(0);i[154]=4|i[154],B=190}}while(0);if(190==(0|B)&&$>>>0<2147483647&&(fe=0|g(0|$))>>>0<($=0|g(0))>>>0&-1!=(0|fe)&-1!=(0|$)&&(de=$-fe|0)>>>0>(k+40|0)>>>0&&(le=fe,ce=de,B=193),193==(0|B)){de=(0|i[151])+ce|0,i[151]=de,de>>>0>(0|i[152])>>>0&&(i[152]=de),de=0|i[49];do{if(de){fe=620;do{if((0|le)==(($=0|i[fe>>2])+(z=0|i[(ue=fe+4|0)>>2])|0)){_e=$,he=ue,ge=z,me=fe,B=203;break}fe=0|i[fe+8>>2]}while(0!=(0|fe));if(203==(0|B)&&0==(8&i[me+12>>2]|0)&&de>>>0<le>>>0&de>>>0>=_e>>>0){i[he>>2]=ge+ce,fe=de+(z=0==(7&(fe=de+8|0)|0)?0:0-fe&7)|0,ue=ce-z+(0|i[46])|0,i[49]=fe,i[46]=ue,i[fe+4>>2]=1|ue,i[fe+ue+4>>2]=40,i[50]=i[165];break}for(le>>>0<(ue=0|i[47])>>>0?(i[47]=le,ye=le):ye=ue,ue=le+ce|0,fe=620;;){if((0|i[fe>>2])==(0|ue)){Ee=fe,Se=fe,B=211;break}if(!(fe=0|i[fe+8>>2])){ve=620;break}}if(211==(0|B)){if(!(8&i[Se+12>>2])){i[Ee>>2]=le,i[(fe=Se+4|0)>>2]=(0|i[fe>>2])+ce,z=le+(0==(7&(fe=le+8|0)|0)?0:0-fe&7)|0,$=ue+(0==(7&(fe=ue+8|0)|0)?0:0-fe&7)|0,fe=z+k|0,ne=$-z-k|0,i[z+4>>2]=3|k;do{if((0|$)!=(0|de)){if((0|$)==(0|i[48])){pe=(0|i[45])+ne|0,i[45]=pe,i[48]=fe,i[fe+4>>2]=1|pe,i[fe+pe>>2]=pe;break}if(1==(3&(pe=0|i[$+4>>2])|0)){se=-8&pe,oe=pe>>>3;e:do{if(pe>>>0>=256){ie=0|i[$+24>>2],ae=0|i[$+12>>2];do{if((0|ae)==(0|$)){if(re=0|i[(a=(q=$+16|0)+4|0)>>2])Ce=re,Ae=a;else{if(!(ee=0|i[q>>2])){Te=0;break}Ce=ee,Ae=q}for(;;)if(re=0|i[(a=Ce+20|0)>>2])Ce=re,Ae=a;else{if(!(re=0|i[(a=Ce+16|0)>>2])){be=Ce,Pe=Ae;break}Ce=re,Ae=a}if(!(Pe>>>0<ye>>>0)){i[Pe>>2]=0,Te=be;break}h()}else{if((a=0|i[$+8>>2])>>>0<ye>>>0&&h(),(0|i[(re=a+12|0)>>2])!=(0|$)&&h(),(0|i[(q=ae+8|0)>>2])==(0|$)){i[re>>2]=ae,i[q>>2]=a,Te=ae;break}h()}}while(0);if(!ie)break;a=476+((ae=0|i[$+28>>2])<<2)|0;do{if((0|$)==(0|i[a>>2])){if(i[a>>2]=Te,Te)break;i[44]=i[44]&~(1<<ae);break e}if(ie>>>0<(0|i[47])>>>0&&h(),(0|i[(q=ie+16|0)>>2])==(0|$)?i[q>>2]=Te:i[ie+20>>2]=Te,!Te)break e}while(0);Te>>>0<(ae=0|i[47])>>>0&&h(),i[Te+24>>2]=ie,q=0|i[(a=$+16|0)>>2];do{if(q){if(!(q>>>0<ae>>>0)){i[Te+16>>2]=q,i[q+24>>2]=Te;break}h()}}while(0);if(!(q=0|i[a+4>>2]))break;if(!(q>>>0<(0|i[47])>>>0)){i[Te+20>>2]=q,i[q+24>>2]=Te;break}h()}else{q=0|i[$+8>>2],ae=0|i[$+12>>2],ie=212+(oe<<1<<2)|0;do{if((0|q)!=(0|ie)){if(q>>>0<ye>>>0&&h(),(0|i[q+12>>2])==(0|$))break;h()}}while(0);if((0|ae)==(0|q)){i[43]=i[43]&~(1<<oe);break}do{if((0|ae)==(0|ie))Me=ae+8|0;else{if(ae>>>0<ye>>>0&&h(),(0|i[(a=ae+8|0)>>2])==(0|$)){Me=a;break}h()}}while(0);i[q+12>>2]=ae,i[Me>>2]=q}}while(0);Oe=$+se|0,Ie=se+ne|0}else Oe=$,Ie=ne;if(i[(oe=Oe+4|0)>>2]=-2&i[oe>>2],i[fe+4>>2]=1|Ie,i[fe+Ie>>2]=Ie,oe=Ie>>>3,Ie>>>0<256){pe=212+(oe<<1<<2)|0,ie=0|i[43],a=1<<oe;do{if(ie&a){if((re=0|i[(oe=pe+8|0)>>2])>>>0>=(0|i[47])>>>0){we=oe,Re=re;break}h()}else i[43]=ie|a,we=pe+8|0,Re=pe}while(0);i[we>>2]=fe,i[Re+12>>2]=fe,i[fe+8>>2]=Re,i[fe+12>>2]=pe;break}a=Ie>>>8;do{if(a){if(Ie>>>0>16777215){De=31;break}De=Ie>>>((ee=14-((re=((se=a<<(ie=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|ie|(se=((oe=se<<re)+245760|0)>>>16&2))+(oe<<se>>>15)|0)+7|0)&1|ee<<1}else De=0}while(0);if(a=476+(De<<2)|0,i[fe+28>>2]=De,i[(pe=fe+16|0)+4>>2]=0,i[pe>>2]=0,!((pe=0|i[44])&(ee=1<<De))){i[44]=pe|ee,i[a>>2]=fe,i[fe+24>>2]=a,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}for(ee=Ie<<(31==(0|De)?0:25-(De>>>1)|0),pe=0|i[a>>2];;){if((-8&i[pe+4>>2]|0)==(0|Ie)){Ne=pe,B=281;break}if(!(se=0|i[(a=pe+16+(ee>>>31<<2)|0)>>2])){Le=a,ke=pe,B=278;break}ee<<=1,pe=se}if(278==(0|B)){if(!(Le>>>0<(0|i[47])>>>0)){i[Le>>2]=fe,i[fe+24>>2]=ke,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}h()}else if(281==(0|B)){if((ee=0|i[(pe=Ne+8|0)>>2])>>>0>=(se=0|i[47])>>>0&Ne>>>0>=se>>>0){i[ee+12>>2]=fe,i[pe>>2]=fe,i[fe+8>>2]=ee,i[fe+12>>2]=Ne,i[fe+24>>2]=0;break}h()}}else ee=(0|i[46])+ne|0,i[46]=ee,i[49]=fe,i[fe+4>>2]=1|ee}while(0);return 0|(z+8|0)}ve=620}for(;;){if((fe=0|i[ve>>2])>>>0<=de>>>0&&(ne=fe+(0|i[ve+4>>2])|0)>>>0>de>>>0){Ge=ne;break}ve=0|i[ve+8>>2]}fe=(z=(fe=(z=Ge+-47|0)+(0==(7&(ne=z+8|0)|0)?0:0-ne&7)|0)>>>0<(ne=de+16|0)>>>0?de:fe)+8|0,$=le+(ue=0==(7&($=le+8|0)|0)?0:0-$&7)|0,ee=ce+-40-ue|0,i[49]=$,i[46]=ee,i[$+4>>2]=1|ee,i[$+ee+4>>2]=40,i[50]=i[165],i[(ee=z+4|0)>>2]=27,i[fe>>2]=i[155],i[fe+4>>2]=i[156],i[fe+8>>2]=i[157],i[fe+12>>2]=i[158],i[155]=le,i[156]=ce,i[158]=0,i[157]=fe,fe=z+24|0;do{i[(fe=fe+4|0)>>2]=7}while((fe+4|0)>>>0<Ge>>>0);if((0|z)!=(0|de)){if(fe=z-de|0,i[ee>>2]=-2&i[ee>>2],i[de+4>>2]=1|fe,i[z>>2]=fe,$=fe>>>3,fe>>>0<256){ue=212+($<<1<<2)|0,(pe=0|i[43])&(se=1<<$)?(a=0|i[($=ue+8|0)>>2])>>>0<(0|i[47])>>>0?h():(Ue=$,Fe=a):(i[43]=pe|se,Ue=ue+8|0,Fe=ue),i[Ue>>2]=de,i[Fe+12>>2]=de,i[de+8>>2]=Fe,i[de+12>>2]=ue;break}if(xe=(ue=fe>>>8)?fe>>>0>16777215?31:fe>>>(($=14-((ue=((pe=ue<<(se=(ue+1048320|0)>>>16&8))+520192|0)>>>16&4)|se|(pe=((a=pe<<ue)+245760|0)>>>16&2))+(a<<pe>>>15)|0)+7|0)&1|$<<1:0,$=476+(xe<<2)|0,i[de+28>>2]=xe,i[de+20>>2]=0,i[ne>>2]=0,!((pe=0|i[44])&(a=1<<xe))){i[44]=pe|a,i[$>>2]=de,i[de+24>>2]=$,i[de+12>>2]=de,i[de+8>>2]=de;break}for(a=fe<<(31==(0|xe)?0:25-(xe>>>1)|0),pe=0|i[$>>2];;){if((-8&i[pe+4>>2]|0)==(0|fe)){Be=pe,B=307;break}if(!(se=0|i[($=pe+16+(a>>>31<<2)|0)>>2])){Ke=$,je=pe,B=304;break}a<<=1,pe=se}if(304==(0|B)){if(!(Ke>>>0<(0|i[47])>>>0)){i[Ke>>2]=de,i[de+24>>2]=je,i[de+12>>2]=de,i[de+8>>2]=de;break}h()}else if(307==(0|B)){if((a=0|i[(pe=Be+8|0)>>2])>>>0>=(fe=0|i[47])>>>0&Be>>>0>=fe>>>0){i[a+12>>2]=de,i[pe>>2]=de,i[de+8>>2]=a,i[de+12>>2]=Be,i[de+24>>2]=0;break}h()}}}else{0==(0|(a=0|i[47]))|le>>>0<a>>>0&&(i[47]=le),i[155]=le,i[156]=ce,i[158]=0,i[52]=i[161],i[51]=-1,a=0;do{i[(pe=212+(a<<1<<2)|0)+12>>2]=pe,i[pe+8>>2]=pe,a=a+1|0}while(32!=(0|a));a=le+(pe=0==(7&(a=le+8|0)|0)?0:0-a&7)|0,fe=ce+-40-pe|0,i[49]=a,i[46]=fe,i[a+4>>2]=1|fe,i[a+fe+4>>2]=40,i[50]=i[165]}}while(0);if((ce=0|i[46])>>>0>k>>>0)return le=ce-k|0,i[46]=le,de=(ce=0|i[49])+k|0,i[49]=de,i[de+4>>2]=1|le,i[ce+4>>2]=3|k,0|(ce+8|0)}return i[(0|O())>>2]=12,0|0},_memcpy:function(e,t,r){var a;if(e|=0,t|=0,(0|(r|=0))>=4096)return 0|y(0|e,0|t,0|r);if(a=0|e,(3&e)==(3&t)){for(;3&e;){if(!r)return 0|a;n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0}for(;(0|r)>=4;)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0,r=r-4|0}for(;(0|r)>0;)n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0;return 0|a},_bitshift64Lshr:F,_fflush:function e(t){t|=0;var r=0,n=0,a=0,o=0,s=0,l=0,c=0;do{if(t){if((0|i[t+76>>2])<=-1){r=0|N(t);break}n=0==(0|w()),a=0|N(t),n||R(),r=a}else{if(o=0|i[13]?0|e(0|i[13]):0,p(36),a=0|i[8])for(n=a,a=o;;){if(l=(0|i[n+76>>2])>-1?0|w():0,c=(0|i[n+20>>2])>>>0>(0|i[n+28>>2])>>>0?0|N(n)|a:a,l&&R(),!(n=0|i[n+56>>2])){s=c;break}a=c}else s=o;S(36),r=s}}while(0);return 0|r},___errno_location:O,_bitshift64Shl:x,runPostSets:function(){},stackAlloc:function(e){var t;return t=o,o=(o=o+(e|=0)|0)+15&-16,0|t},stackSave:function(){return 0|o},stackRestore:function(e){o=e|=0},establishStackSpace:function(e,t){o=e|=0,t|=0},setThrew:function(e,t){e|=0,t|=0,s||(s=e,t)},setTempRet0:function(e){l=e|=0},getTempRet0:function(){return 0|l},dynCall_ii:function(e,t){return t|=0,0|K[1&(e|=0)](0|t)},dynCall_iiii:function(e,t,r,n){return t|=0,r|=0,n|=0,0|j[3&(e|=0)](0|t,0|r,0|n)},dynCall_vi:function(e,t){t|=0,Y[1&(e|=0)](0|t)}}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;function xc(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0,xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};function $c(t){function r(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,null===Yc&&(Yc=Date.now()),!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),r()}),1)):r())}}function ad(t,r){if(!r||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.callMain=e.jd=function(t){function r(){for(var e=0;3>e;e++)i.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==Pa.length,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var n=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];r();for(var a=0;a<n-1;a+=1)i.push(G(Va(t[a]),"i8",0)),r();i.push(0),i=G(i,"i32",0);try{ad(e._main(n,i,0),!0)}catch(t){if(!(t instanceof xc)){if("SimulateInfiniteLoop"!=t)throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t;e.noExitRuntime=!0}}},e.run=e.run=$c,e.exit=e.exit=ad;var cd=[];function z(t){void 0!==t?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var r="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach((function(e){r=e(r,t)})),r}if(e.abort=e.abort=z,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e},94114:()=>{
/*! modernizr 3.11.8 (Custom Build) | MIT *
 * https://modernizr.com/download/?-adownload-cssanimations-csstransitions-exiforientation-serviceworker-webp-domprefixes-hasevent-prefixed-prefixes-setclasses-testallprops-testprop !*/
!function(e,t,r,n){function i(e,t){return typeof e===t}function a(e){var t=v.className,r=E._config.classPrefix||"";if(T&&(t=t.baseVal),E._config.enableJSClass){var n=new RegExp("(^|\\s)"+r+"no-js(\\s|$)");t=t.replace(n,"$1"+r+"js$2")}E._config.enableClasses&&(e.length>0&&(t+=" "+r+e.join(" "+r)),T?v.className.baseVal=t:v.className=t)}function o(){return"function"!=typeof r.createElement?r.createElement(arguments[0]):T?r.createElementNS.call(r,"http://www.w3.org/2000/svg",arguments[0]):r.createElement.apply(r,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function l(e,t,n,i){var a,s,l,c,d="modernizr",u=o("div"),p=function(){var e=r.body;return e||((e=o(T?"svg":"body")).fake=!0),e}();if(parseInt(n,10))for(;n--;)(l=o("div")).id=i?i[n]:d+(n+1),u.appendChild(l);return(a=o("style")).type="text/css",a.id="s"+d,(p.fake?p:u).appendChild(a),p.appendChild(u),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(r.createTextNode(e)),u.id=d,p.fake&&(p.style.background="",p.style.overflow="hidden",c=v.style.overflow,v.style.overflow="hidden",v.appendChild(p)),s=t(u,e),p.fake&&p.parentNode?(p.parentNode.removeChild(p),v.style.overflow=c,v.offsetHeight):u.parentNode.removeChild(u),!!s}function c(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()})).replace(/^ms-/,"-ms-")}function d(e,r){var i=e.length;if("CSS"in t&&"supports"in t.CSS){for(;i--;)if(t.CSS.supports(c(e[i]),r))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];i--;)a.push("("+c(e[i])+":"+r+")");return l("@supports ("+(a=a.join(" or "))+") { #modernizr { position: absolute; } }",(function(e){return"absolute"===function(e,r,n){var i;if("getComputedStyle"in t){i=getComputedStyle.call(t,e,r);var a=t.console;null!==i?n&&(i=i.getPropertyValue(n)):a&&a[a.error?"error":"log"].call(a,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}else i=!r&&e.currentStyle&&e.currentStyle[n];return i}(e,null,"position")}))}return n}function u(e){return e.replace(/([a-z])-([a-z])/g,(function(e,t,r){return t+r.toUpperCase()})).replace(/^-/,"")}function p(e,t,r,a){function l(){p&&(delete I.style,delete I.modElem)}if(a=!i(a,"undefined")&&a,!i(r,"undefined")){var c=d(e,r);if(!i(c,"undefined"))return c}for(var p,f,_,h,g,m=["modernizr","tspan","samp"];!I.style&&m.length;)p=!0,I.modElem=o(m.shift()),I.style=I.modElem.style;for(_=e.length,f=0;f<_;f++)if(h=e[f],g=I.style[h],s(h,"-")&&(h=u(h)),I.style[h]!==n){if(a||i(r,"undefined"))return l(),"pfx"!==t||h;try{I.style[h]=r}catch(e){}if(I.style[h]!==g)return l(),"pfx"!==t||h}return l(),!1}function f(e,t){return function(){return e.apply(t,arguments)}}function _(e,t,r,n,a){var o=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+M.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?p(s,t,n,a):function(e,t,r){var n;for(var a in e)if(e[a]in t)return!1===r?e[a]:i(n=t[e[a]],"function")?f(n,r||t):n;return!1}(s=(e+" "+A.join(o+" ")+o).split(" "),t,r)}function h(e,t,r){return _(e,n,n,t,r)}function g(e,t){if("object"==typeof e)for(var r in e)w(e,r)&&g(r,e[r]);else{var n=(e=e.toLowerCase()).split("."),i=E[n[0]];if(2===n.length&&(i=i[n[1]]),void 0!==i)return E;t="function"==typeof t?t():t,1===n.length?E[n[0]]=t:(!E[n[0]]||E[n[0]]instanceof Boolean||(E[n[0]]=new Boolean(E[n[0]])),E[n[0]][n[1]]=t),a([(t&&!1!==t?"":"no-")+n.join("-")]),E._trigger(e,t)}return E}var m=[],y={_version:"3.11.8",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var r=this;setTimeout((function(){t(r[e])}),0)},addTest:function(e,t,r){m.push({name:e,fn:t,options:r})},addAsyncTest:function(e){m.push({name:null,fn:e})}},E=function(){};E.prototype=y,E=new E;var S=[],v=r.documentElement,T="svg"===v.nodeName.toLowerCase(),C="Moz O ms Webkit",A=y._config.usePrefixes?C.toLowerCase().split(" "):[];y._domPrefixes=A;var b=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];y._prefixes=b;var P=function(){var e=!("onblur"in v);return function(t,r){var i;return!!t&&(r&&"string"!=typeof r||(r=o(r||"div")),!(i=(t="on"+t)in r)&&e&&(r.setAttribute||(r=o("div")),r.setAttribute(t,""),i="function"==typeof r[t],r[t]!==n&&(r[t]=n),r.removeAttribute(t)),i)}}();y.hasEvent=P;var M=y._config.usePrefixes?C.split(" "):[];y._cssomPrefixes=M;var O={elem:o("modernizr")};E._q.push((function(){delete O.elem}));var I={style:O.elem.style};E._q.unshift((function(){delete I.style})),y.testAllProps=_;var w,R=function(e){var r,i=b.length,a=t.CSSRule;if(void 0===a)return n;if(!e)return!1;if((r=(e=e.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in a)return"@"+e;for(var o=0;o<i;o++){var s=b[o];if(s.toUpperCase()+"_"+r in a)return"@-"+s.toLowerCase()+"-"+e}return!1};y.atRule=R,y.prefixed=function(e,t,r){return 0===e.indexOf("@")?R(e):(-1!==e.indexOf("-")&&(e=u(e)),t?_(e,t,r):_(e,"pfx"))},y.testAllProps=h,y.testProp=function(e,t,r){return p([e],n,t,r)},function(){var e={}.hasOwnProperty;w=i(e,"undefined")||i(e.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(t,r){return e.call(t,r)}}(),y._l={},y.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),E.hasOwnProperty(e)&&setTimeout((function(){E._trigger(e,E[e])}),0)},y._trigger=function(e,t){if(this._l[e]){var r=this._l[e];setTimeout((function(){var e;for(e=0;e<r.length;e++)(0,r[e])(t)}),0),delete this._l[e]}},E._q.push((function(){y.addTest=g})),E.addAsyncTest((function(){function e(e,t,r){function n(t){var n=!(!t||"load"!==t.type)&&1===i.width;g(e,"webp"===e&&n?new Boolean(n):n),r&&r(t)}var i=new Image;i.onerror=n,i.onload=n,i.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],r=t.shift();e(r.name,r.uri,(function(r){if(r&&"load"===r.type)for(var n=0;n<t.length;n++)e(t[n].name,t[n].uri)}))})),E.addTest("serviceworker","serviceWorker"in navigator),E.addAsyncTest((function(){var e=new Image;e.onerror=function(){g("exiforientation",!1)},e.onload=function(){g("exiforientation",2!==e.width)},e.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAASUkqAAgAAAABABIBAwABAAAABgASAAAAAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/iiiigD/2Q=="})),E.addTest("adownload",!t.externalHost&&"download"in o("a")),E.addTest("cssanimations",h("animationName","a",!0)),E.addTest("csstransitions",h("transition","all",!0)),function(){var e,t,r,n,a,o;for(var s in m)if(m.hasOwnProperty(s)){if(e=[],(t=m[s]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(r=0;r<t.options.aliases.length;r++)e.push(t.options.aliases[r].toLowerCase());for(n=i(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)1===(o=e[a].split(".")).length?E[o[0]]=n:(E[o[0]]&&(!E[o[0]]||E[o[0]]instanceof Boolean)||(E[o[0]]=new Boolean(E[o[0]])),E[o[0]][o[1]]=n),S.push((n?"":"no-")+o.join("-"))}}(),a(S),delete y.addTest,delete y.addAsyncTest;for(var D=0;D<E._q.length;D++)E._q[D]();e.Modernizr=E}(window,window,document)},37360:e=>{var t;!function(){function e(e){if(this.mode=n.MODE_8BIT_BYTE,this.data=e,this.parsedData=[],e instanceof ArrayBuffer)this.parsedData=new Int8Array(e);else{for(var t=0,r=this.data.length;t<r;t++){var i=[],a=this.data.charCodeAt(t);a>65536?(i[0]=240|(1835008&a)>>>18,i[1]=128|(258048&a)>>>12,i[2]=128|(4032&a)>>>6,i[3]=128|63&a):a>2048?(i[0]=224|(61440&a)>>>12,i[1]=128|(4032&a)>>>6,i[2]=128|63&a):a>128?(i[0]=192|(1984&a)>>>6,i[1]=128|63&a):i[0]=a,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}function r(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,r=this.parsedData.length;t<r;t++)e.put(this.parsedData[t],8)}},r.prototype={addData:function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=r.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var n=-1;n<=7;n++)t+n<=-1||this.moduleCount<=t+n||(this.modules[e+r][t+n]=0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var e=0,t=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=f.getLostPoint(this);(0==r||e>n)&&(e=n,t=r)}return t},createMovieClip:function(e,t,r){var n=e.createEmptyMovieClip(t,r);this.make();for(var i=0;i<this.modules.length;i++)for(var a=1*i,o=0;o<this.modules[i].length;o++){var s=1*o;this.modules[i][o]&&(n.beginFill(0,100),n.moveTo(s,a),n.lineTo(s+1,a),n.lineTo(s+1,a+1),n.lineTo(s,a+1),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var n=e[t],i=e[r];if(null==this.modules[n][i])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)this.modules[n+a][i+o]=-2==a||2==a||-2==o||2==o||0==a&&0==o}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!e&&1==(t>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!e&&1==(t>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(e,t){for(var r=this.errorCorrectLevel<<3|t,n=f.getBCHTypeInfo(r),i=0;i<15;i++){var a=!e&&1==(n>>i&1);i<6?this.modules[i][8]=a:i<8?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(i=0;i<15;i++){a=!e&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=a:i<9?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var r=-1,n=this.moduleCount-1,i=7,a=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var s=0;s<2;s++)if(null==this.modules[n][o-s]){var l=!1;a<e.length&&(l=1==(e[a]>>>i&1)),f.getMask(t,n,o-s)&&(l=!l),this.modules[n][o-s]=l,-1==--i&&(a++,i=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}}},r.PAD0=236,r.PAD1=17,r.createData=function(e,t,n){for(var i=m.getRSBlocks(e,t),a=new y,o=0;o<n.length;o++){var s=n[o];a.put(s.mode,4),a.put(s.getLength(),f.getLengthInBits(s.mode,e)),s.write(a)}var l=0;for(o=0;o<i.length;o++)l+=i[o].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l||(a.put(r.PAD0,8),a.getLengthInBits()>=8*l));)a.put(r.PAD1,8);return r.createBytes(a,i)},r.createBytes=function(e,t){for(var r=0,n=0,i=0,a=new Array(t.length),o=new Array(t.length),s=0;s<t.length;s++){var l=t[s].dataCount,c=t[s].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),a[s]=new Array(l);for(var d=0;d<a[s].length;d++)a[s][d]=255&e.buffer[d+r];r+=l;var u=f.getErrorCorrectPolynomial(c),p=new g(a[s],u.getLength()-1).mod(u);o[s]=new Array(u.getLength()-1);for(d=0;d<o[s].length;d++){var _=d+p.getLength()-o[s].length;o[s][d]=_>=0?p.get(_):0}}var h=0;for(d=0;d<t.length;d++)h+=t[d].totalCount;var m=new Array(h),y=0;for(d=0;d<n;d++)for(s=0;s<t.length;s++)d<a[s].length&&(m[y++]=a[s][d]);for(d=0;d<i;d++)for(s=0;s<t.length;s++)d<o[s].length&&(m[y++]=o[s][d]);return m};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},a=0,o=1,s=2,l=3,c=4,d=5,u=6,p=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;f.getBCHDigit(t)-f.getBCHDigit(f.G15)>=0;)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;f.getBCHDigit(t)-f.getBCHDigit(f.G18)>=0;)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case a:return(t+r)%2==0;case o:return t%2==0;case s:return r%3==0;case l:return(t+r)%3==0;case c:return(Math.floor(t/2)+Math.floor(r/3))%2==0;case d:return t*r%2+t*r%3==0;case u:return(t*r%2+t*r%3)%2==0;case p:return(t*r%3+(t+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new g([1],0),r=0;r<e;r++)t=t.multiply(new g([1,_.gexp(r)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,n=0;n<t;n++)for(var i=0;i<t;i++){for(var a=0,o=e.isDark(n,i),s=-1;s<=1;s++)if(!(n+s<0||t<=n+s))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==s&&0==l||o==e.isDark(n+s,i+l)&&a++;a>5&&(r+=3+a-5)}for(n=0;n<t-1;n++)for(i=0;i<t-1;i++){var c=0;e.isDark(n,i)&&c++,e.isDark(n+1,i)&&c++,e.isDark(n,i+1)&&c++,e.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(r+=3)}for(n=0;n<t;n++)for(i=0;i<t-6;i++)e.isDark(n,i)&&!e.isDark(n,i+1)&&e.isDark(n,i+2)&&e.isDark(n,i+3)&&e.isDark(n,i+4)&&!e.isDark(n,i+5)&&e.isDark(n,i+6)&&(r+=40);for(i=0;i<t;i++)for(n=0;n<t-6;n++)e.isDark(n,i)&&!e.isDark(n+1,i)&&e.isDark(n+2,i)&&e.isDark(n+3,i)&&e.isDark(n+4,i)&&!e.isDark(n+5,i)&&e.isDark(n+6,i)&&(r+=40);var d=0;for(i=0;i<t;i++)for(n=0;n<t;n++)e.isDark(n,i)&&d++;return r+=10*(Math.abs(100*d/t/t-50)/5)}},_={glog:function(e){if(e<1)throw new Error("glog("+e+")");return _.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return _.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;h<8;h++)_.EXP_TABLE[h]=1<<h;for(h=8;h<256;h++)_.EXP_TABLE[h]=_.EXP_TABLE[h-4]^_.EXP_TABLE[h-5]^_.EXP_TABLE[h-6]^_.EXP_TABLE[h-8];for(h=0;h<255;h++)_.LOG_TABLE[_.EXP_TABLE[h]]=h;function g(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var n=0;n<e.length-r;n++)this.num[n]=e[n+r]}function m(e,t){this.totalCount=e,this.dataCount=t}function y(){this.buffer=[],this.length=0}g.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<e.getLength();n++)t[r+n]^=_.gexp(_.glog(this.get(r))+_.glog(e.get(n)));return new g(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=_.glog(this.get(0))-_.glog(e.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<e.getLength();n++)r[n]^=_.gexp(_.glog(e.get(n))+t);return new g(r,0).mod(e)}},m.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],m.getRSBlocks=function(e,t){var r=m.getRsBlockTable(e,t);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=r.length/3,i=[],a=0;a<n;a++)for(var o=r[3*a+0],s=r[3*a+1],l=r[3*a+2],c=0;c<o;c++)i.push(new m(s,l));return i},m.getRsBlockTable=function(e,t){switch(t){case i.L:return m.RS_BLOCK_TABLE[4*(e-1)+0];case i.M:return m.RS_BLOCK_TABLE[4*(e-1)+1];case i.Q:return m.RS_BLOCK_TABLE[4*(e-1)+2];case i.H:return m.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},y.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var E=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],S=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};function v(e,t){for(var r=1,n=e instanceof ArrayBuffer?e.byteLength:function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),a=0,o=E.length;a<=o;a++){var s=0;switch(t){case i.L:s=E[a][0];break;case i.M:s=E[a][1];break;case i.Q:s=E[a][2];break;case i.H:s=E[a][3]}if(n<=s)break;r++}if(r>E.length)throw new Error("Too long data");return r}S.prototype.draw=function(e){var t=this._oContext,r=this._htOption,n=e.getModuleCount(),i=r.width/n,a=r.height/n,o=Math.round(i),s=Math.round(a);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=e.isDark(l,c),u=c*i,p=l*a;t.strokeStyle=d?r.colorDark:r.colorLight,t.lineWidth=1,t.fillStyle=d?r.colorDark:r.colorLight,t.fillRect(u,p,i,a),t.strokeRect(Math.floor(u)+.5,Math.floor(p)+.5,o,s),t.strokeRect(Math.ceil(u)-.5,Math.ceil(p)-.5,o,s)}this._bIsPainted=!0},S.prototype.isPainted=function(){return this._bIsPainted},S.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},S.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},(t=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof t&&(t={text:t}),t)for(var r in t)this._htOption[r]=t[r];"string"==typeof e&&(e=document.getElementById(e)),this._el=e,this._oQRCode=null,this._oDrawing=new S(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new r(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode)},t.prototype.clear=function(){this._oDrawing.clear()},t.CorrectLevel=i}(),e.exports=t},6906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSheet=t.StyleXSheet=void 0;var n,i=(n=r(41143))&&n.__esModule?n:{default:n};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o="__fb-light-mode",s="__fb-dark-mode";function l(e,t){const r=[];r.push("".concat(e," {"));for(const e in t){const n=t[e];r.push("  --".concat(e,": ").concat(n,";"))}return r.push("}"),r.join("\n")}const c=/var\(--(.*?)\)/g;class d{constructor(e){var t;a(this,"rootTheme",void 0),a(this,"rootDarkTheme",void 0),a(this,"supportsVariables",void 0),a(this,"rules",void 0),a(this,"injected",void 0),a(this,"tag",void 0),a(this,"ruleForPriority",void 0),this.tag=null,this.injected=!1,this.ruleForPriority=new Map,this.rules=[],this.rootTheme=e.rootTheme,this.rootDarkTheme=e.rootDarkTheme,this.supportsVariables=null!==(t=e.supportsVariables)&&void 0!==t?t:null!=r.g.CSS&&null!=r.g.CSS.supports&&r.g.CSS.supports("--fake-var:0")}getVariableMatch(){return c}isHeadless(){var e,t;return null==this.tag||null==(null===(e=r.g)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.body)}getTag(){const{tag:e}=this;return(0,i.default)(null!=e,"expected tag"),e}getCSS(){return this.rules.join("\n")}getRulePosition(e){return this.rules.indexOf(e)}getRuleCount(){return this.rules.length}inject(){var e;this.injected||(this.injected=!0,null!=(null===(e=r.g.document)||void 0===e?void 0:e.body)?(this.tag=function(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-styled","true"),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}(),this.injectTheme()):this.injectTheme())}injectTheme(){null!=this.rootTheme&&this.insert(l(":root, .".concat(o),this.rootTheme),0),null!=this.rootDarkTheme&&this.insert(l(".".concat(s,":root, .").concat(s),this.rootDarkTheme),0)}__injectCustomThemeForTesting(e,t){null!=t&&this.insert(l(e,t),0)}delete(e){const t=this.rules.indexOf(e);if((0,i.default)(t>=0,"Couldn't find the index for rule %s",e),this.rules.splice(t,1),this.isHeadless())return;const r=this.getTag().sheet;(0,i.default)(r,"expected sheet"),r.deleteRule(t)}normalizeRule(e){const{rootTheme:t}=this;return this.supportsVariables||null==t?e:e.replace(c,((e,r)=>t[r]))}getInsertPositionForPriority(e){const t=this.ruleForPriority.get(e);if(null!=t)return this.rules.indexOf(t)+1;const r=Array.from(this.ruleForPriority.keys()).sort(((e,t)=>t-e)).filter((t=>t>e?1:0));if(0===r.length)return this.getRuleCount();const n=r.pop();return this.rules.indexOf(this.ruleForPriority.get(n))}insert(e,t,r){if(!1===this.injected&&this.inject(),null!=r)return this.insert(u(e,"html:not([dir='rtl'])"),t),void this.insert(u(r,"html[dir='rtl']"),t);const n=e;if(this.rules.includes(n))return;const i=this.normalizeRule(n),a=this.getInsertPositionForPriority(t);if(this.rules.splice(a,0,i),this.ruleForPriority.set(t,i),this.isHeadless())return;const o=this.getTag().sheet;if(null!=o)try{o.insertRule(i,a)}catch(e){}}}function u(e,t){if(!e.startsWith("@"))return"".concat(t," ").concat(e);const r=e.indexOf("{"),n=e.slice(0,r+1),i=e.slice(r+1);return"".concat(n).concat(t," ").concat(i)}t.StyleXSheet=d,a(d,"LIGHT_MODE_CLASS_NAME",o),a(d,"DARK_MODE_CLASS_NAME",s);const p=new d({supportsVariables:!0,rootTheme:{},rootDarkTheme:{}});t.styleSheet=p},56720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(6906);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){for(var t=e.reverse(),r={};t.length;){var n=t.pop();if(Array.isArray(n))for(var i=n.length-1;i>=0;i--)t.push(n[i]);else{var a=n;if(null!=a&&"object"==typeof a)for(var o in a){var s=a[o];if("string"==typeof s)r[o]=s;else if("object"==typeof s){var l;r[o]=null!==(l=r[o])&&void 0!==l?l:{},Object.assign(r[o],s)}}}}return r}function l(...e){var t=s(e),r="";for(var n in t)if(Boolean(t[n]))if("string"==typeof t[n])r+=r?" "+t[n]:t[n];else if("object"==typeof t[n]){var i=t[n];for(var a in i){var o=i[a];r+=r?" "+o:o}}return r}l.compose=function(...e){return s(e)},l.create=function(e){throw new Error("stylex.create should never be called. It should be compiled away.")},l.keyframes=e=>{throw new Error("stylex.keyframes should never be called")},l.inject=(e,t,r=null)=>{n.styleSheet.insert(e,t,r)},l.dedupe=(...e)=>l(...e),l.absoluteFill={bottom:0,boxSizing:"border-box",end:0,position:"absolute",start:0,top:0},l.absoluteCenter={boxSizing:"border-box",left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"},l.blockBase={borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"block",flexGrow:1,flexShrink:1,margin:0,padding:0,position:"relative",zIndex:0},l.inlineBase=a(a({},l.blockBase),{},{display:"inline"}),l.buttonBase={appearance:"none",backgroundColor:"transparent",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",margin:0,padding:0,position:"relative",textAlign:"inherit",zIndex:0},l.flexBase={alignItems:"stretch",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,justifyContent:"space-between",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",zIndex:0},l.flexInlineBase=a(a({},l.flexBase),{},{display:"inline-flex"}),l.linkBase={backgroundColor:"transparent",backgroundImage:"none",boxSizing:"border-box",color:"inherit",cursor:"pointer",position:"relative",textDecoration:"none",zIndex:0},l.listBase={boxSizing:"border-box",listStyle:"none",marginBottom:0,marginTop:0,paddingStart:0},l.visuallyHidden={clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",width:1};var c=l;t.default=c},29127:(e,t,r)=>{var n={"./af.json":[88789,8288],"./ar.json":[58854,8801],"./az.json":[48758,1967],"./bg.json":[60624,1234],"./bn.json":[93511,677],"./ca.json":[98922,4451],"./cs.json":[40097,3539],"./da.json":[36117,9626],"./de.json":[3313,88],"./el.json":[24689,3004],"./en.json":[90084,7494],"./es.json":[96598,4739],"./et.json":[57633,9599],"./fa.json":[41076,4853],"./fi.json":[51701,9789],"./fil.json":[46387,3565],"./fr.json":[12785,7334],"./gu.json":[50387,1244],"./he.json":[62603,2422],"./hi.json":[27605,8606],"./hr.json":[54047,3853],"./hu.json":[92922,1389],"./id.json":[75608,4132],"./it.json":[54800,5881],"./ja.json":[66189,5608],"./kk.json":[47681,4260],"./kn.json":[78930,6700],"./ko.json":[28076,7020],"./lt.json":[37885,4169],"./lv.json":[22798,7938],"./mk.json":[79265,1592],"./ml.json":[7208,4794],"./mr.json":[30163,2771],"./ms.json":[13390,9911],"./nb.json":[49057,4046],"./nl.json":[23129,7055],"./pa.json":[66384,6032],"./pl.json":[75495,9566],"./pt.json":[8897,1992],"./ro.json":[64267,8945],"./ru.json":[34813,887],"./sk.json":[75785,7163],"./sl.json":[65608,7626],"./sq.json":[55915,6098],"./sr.json":[95742,2967],"./sv.json":[81244,4768],"./sw.json":[78923,6606],"./ta.json":[17574,3721],"./te.json":[96564,4771],"./th.json":[38728,5955],"./tr.json":[38704,8962],"./uk.json":[95304,5282],"./ur.json":[27814,2619],"./uz.json":[18192,7654],"./vi.json":[22521,5315],"./zh-CN.json":[59978,4680],"./zh-HK.json":[17133,7920],"./zh-TW.json":[37439,3421]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r.t(i,3)))}i.keys=()=>Object.keys(n),i.id=29127,e.exports=i},26299:(e,t,r)=>{var n={"./af":[50164,6365],"./af.js":[50164,6365],"./ar":[89511,8054],"./ar-XB":[12326,9995],"./ar-XB.js":[12326,9995],"./ar.js":[89511,8054],"./az":[4345,7072],"./az.js":[4345,7072],"./bg":[74774,7102],"./bg.js":[74774,7102],"./bn":[74342,8700],"./bn.js":[74342,8700],"./ca":[654,5632],"./ca.js":[654,5632],"./cs":[64654,165],"./cs.js":[64654,165],"./da":[3435,1628],"./da.js":[3435,1628],"./de":[55170,7216],"./de.js":[55170,7216],"./el":[31977,1204],"./el.js":[31977,1204],"./en":[77407,6933],"./en.js":[77407,6933],"./es":[82834,673],"./es.js":[82834,673],"./et":[65644,792],"./et.js":[65644,792],"./fa":[32949,9999],"./fa.js":[32949,9999],"./fi":[70971,9613],"./fi.js":[70971,9613],"./fil":[94399,907],"./fil.js":[94399,907],"./fr":[61945,6293],"./fr.js":[61945,6293],"./gu":[96432,6038],"./gu.js":[96432,6038],"./he":[44756,5729],"./he.js":[44756,5729],"./hi":[27135,3722],"./hi.js":[27135,3722],"./hr":[66762,5708],"./hr.js":[66762,5708],"./hu":[10728,2556],"./hu.js":[10728,2556],"./id":[18626,5128],"./id.js":[18626,5128],"./it":[47959,2830],"./it.js":[47959,2830],"./ja":[34101,5182],"./ja.js":[34101,5182],"./kk":[85821,9719],"./kk.js":[85821,9719],"./kn":[37038,155],"./kn.js":[37038,155],"./ko":[68736,820],"./ko.js":[68736,820],"./lt":[78935,1529],"./lt.js":[78935,1529],"./lv":[23480,4708],"./lv.js":[23480,4708],"./mk":[32209,6651],"./mk.js":[32209,6651],"./ml":[27102,6655],"./ml.js":[27102,6655],"./mr":[23268,1248],"./mr.js":[23268,1248],"./ms":[84545,5443],"./ms.js":[84545,5443],"./nb":[15070,7749],"./nb.js":[15070,7749],"./nl":[64606,9750],"./nl.js":[64606,9750],"./pa":[31818,9815],"./pa.js":[31818,9815],"./pl":[98120,8628],"./pl.js":[98120,8628],"./pt":[93710,6953],"./pt-BR":[70626,2091],"./pt-BR.js":[70626,2091],"./pt.js":[93710,6953],"./ro":[49526,7162],"./ro.js":[49526,7162],"./ru":[38976,8292],"./ru.js":[38976,8292],"./sk":[24928,1770],"./sk.js":[24928,1770],"./sl":[65516,4259],"./sl.js":[65516,4259],"./sq":[25177,9737],"./sq.js":[25177,9737],"./sr":[24165,6331],"./sr.js":[24165,6331],"./sv":[23012,2944],"./sv.js":[23012,2944],"./sw":[56916,3998],"./sw.js":[56916,3998],"./ta":[11227,2739],"./ta.js":[11227,2739],"./te":[24939,5650],"./te.js":[24939,5650],"./th":[34086,2135],"./th.js":[34086,2135],"./tr":[38953,248],"./tr.js":[38953,248],"./uk":[54945,906],"./uk.js":[54945,906],"./ur":[67882,4361],"./ur.js":[67882,4361],"./uz":[37754,4873],"./uz.js":[37754,4873],"./vi":[79973,8598],"./vi.js":[79973,8598],"./zh-CN":[98537,6483],"./zh-CN.js":[98537,6483],"./zh-HK":[72511,1081],"./zh-HK.js":[72511,1081],"./zh-TW":[70468,7542],"./zh-TW.js":[70468,7542]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=26299,e.exports=i},19922:(e,t,r)=>{var n={"./af":[36249,3748],"./af.js":[36249,3748],"./ar":[96951,1473],"./ar-DZ":[31883,6884],"./ar-DZ.js":[31883,6884],"./ar-KW":[85371,6282],"./ar-KW.js":[85371,6282],"./ar-LY":[25108,5671],"./ar-LY.js":[25108,5671],"./ar-MA":[22992,2966],"./ar-MA.js":[22992,2966],"./ar-SA":[14344,9646],"./ar-SA.js":[14344,9646],"./ar-TN":[60476,9289],"./ar-TN.js":[60476,9289],"./ar-XB":[61547,3934],"./ar-XB.js":[61547,3934],"./ar.js":[96951,1473],"./az":[58317,5740],"./az.js":[58317,5740],"./bn":[79307,7728],"./bn.js":[79307,7728],"./ca":[72669,9817],"./ca.js":[72669,9817],"./cs":[4388,2023],"./cs.js":[4388,2023],"./da":[82098,7315],"./da.js":[82098,7315],"./de":[96264,5862],"./de.js":[96264,5862],"./el":[57882,1055],"./el.js":[57882,1055],"./en-AU":[82248,8678],"./en-AU.js":[82248,8678],"./en-CA":[18526,4616],"./en-CA.js":[18526,4616],"./en-GB":[87123,9227],"./en-GB.js":[87123,9227],"./en-IE":[40296,2979],"./en-IE.js":[40296,2979],"./en-NZ":[66060,3892],"./en-NZ.js":[66060,3892],"./es":[71689,1791],"./es-DO":[68592,2394],"./es-DO.js":[68592,2394],"./es.js":[71689,1791],"./et":[73429,4473],"./et.js":[73429,4473],"./fa":[6940,7662],"./fa.js":[6940,7662],"./fi":[63191,7386],"./fi.js":[63191,7386],"./fr":[81189,2445],"./fr-CA":[7908,9765],"./fr-CA.js":[7908,9765],"./fr-CH":[9925,8799],"./fr-CH.js":[9925,8799],"./fr.js":[81189,2445],"./gu":[62021,4468],"./gu.js":[62021,4468],"./he":[55897,5027],"./he.js":[55897,5027],"./hi":[55467,6709],"./hi.js":[55467,6709],"./hr":[23077,1381],"./hr.js":[23077,1381],"./hu":[85678,4339],"./hu.js":[85678,4339],"./id":[37827,6511],"./id.js":[37827,6511],"./it":[22365,5247],"./it.js":[22365,5247],"./kk":[65897,7074],"./kk.js":[65897,7074],"./kn":[23124,6568],"./kn.js":[23124,6568],"./ko":[77096,4818],"./ko.js":[77096,4818],"./lt":[66191,6920],"./lt.js":[66191,6920],"./mk":[4942,9545],"./mk.js":[4942,9545],"./ml":[28472,3113],"./ml.js":[28472,3113],"./mr":[84561,3422],"./mr.js":[84561,3422],"./ms":[95938,7739],"./ms-MY":[65012,1520],"./ms-MY.js":[65012,1520],"./ms.js":[95938,7739],"./nb":[98457,5959],"./nb.js":[98457,5959],"./nl":[68623,319],"./nl.js":[68623,319],"./pa-IN":[30837,8132],"./pa-IN.js":[30837,8132],"./pl":[40938,4980],"./pl.js":[40938,4980],"./pt":[80432,9116],"./pt-BR":[40725,6547],"./pt-BR.js":[40725,6547],"./pt.js":[80432,9116],"./ro":[46828,3569],"./ro.js":[46828,3569],"./ru":[84381,2957],"./ru.js":[84381,2957],"./sk":[31453,5965],"./sk.js":[31453,5965],"./sl":[96918,3501],"./sl.js":[96918,3501],"./sq":[46987,6496],"./sq.js":[46987,6496],"./sr":[7467,5170],"./sr-CYRL":[5879,5790],"./sr-CYRL.js":[5879,5790],"./sr.js":[7467,5170],"./sv":[38312,1069],"./sv.js":[38312,1069],"./sw":[47638,2017],"./sw.js":[47638,2017],"./ta":[50995,8634],"./ta.js":[50995,8634],"./te":[70008,3370],"./te.js":[70008,3370],"./th":[8448,951],"./th.js":[8448,951],"./tr":[47120,9313],"./tr.js":[47120,9313],"./uk":[75997,9682],"./uk.js":[75997,9682],"./ur":[98563,6163],"./ur.js":[98563,6163],"./uz":[16183,3017],"./uz-LATN":[75,8117],"./uz-LATN.js":[75,8117],"./uz.js":[16183,3017],"./zh-CN":[83718,3047],"./zh-CN.js":[83718,3047],"./zh-TW":[57924,5125],"./zh-TW.js":[57924,5125]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=19922,e.exports=i},47466:e=>{"use strict";e.exports=JSON.parse('{"application/":{"applixware":"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{"capability":"cdmia","container":"cdmic","domain":"cdmid","object":"cdmio","queue":"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","ecmascript":"ecma","emma+xml":"emma","epub+zip":"epub","exi":"exi","font-":{"tdpfr":"pfr","woff":"woff"},"gml+xml":"gml","gpx+xml":"gpx","gxf":"gxf","hyperstudio":"stk","inkml+xml":["ink","inkml"],"ipfix":"ipfix","java-":{"archive":"jar","vm":"class","serialized-object":"ser"},"javascript":"js","json":"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{"binhex40":"hqx","compactpro":"cpt"},"mads+xml":"mads","marc":"mrc","marcxml+xml":"mrcx","mathematica":["ma","nb","mb"],"mathml+xml":"mathml","mbox":"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods","mp21":["m21","mp21"],"mp4":"mp4s","msword":["doc","dot"],"mxf":"mxf","oda":"oda","ogg":"ogx","omdoc+xml":"omdoc","onenote":["onetoc","onetoc2","onetmp","onepkg"],"oxps":"oxps","pdf":"pdf","pgp-":{"encrypted":"pgp","signature":["asc","sig"]},"pkcs10":"p10","pkcs7-":{"mime":["p7m","p7c"],"signature":"p7s"},"pkcs8":"p8","pkix-":{"cert":"cer","crl":"crl","pkipath":"pkipath","attr-cert":"ac"},"pkixcmp":"pki","pls+xml":"pls","postscript":["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{"ghostbusters":"gbr","manifest":"mft","roa":"roa"},"rsd+xml":"rsd","rss+xml":"rss","rtf":"rtf","sbml+xml":"sbml","scvp-":{"cv-":{"request":"scq","response":"scs"},"vp-":{"request":"spq","response":"spp"}},"sdp":"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{"query":"rq","results+xml":"srx"},"srgs":"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{"acucobol":"acu","acucorp":["atc","acutc"],"adobe.":{"fxp":["fxp","fxpl"],"xdp+xml":"xdp","xfdf":"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg","mpegurl":"m3u8"},"audiograph":"aep","bmi":"bmi","businessobjects":"rep","chemdraw+xml":"cdxml","cinderella":"cdy","claymore":"cla","commonspace":"csp","cosmocaller":"cmc","crick.":{"clicker":"clkx","clicker.":{"keyboard":"clkk","palette":"clkp","template":"clkt","wordbank":"clkw"}},"curl.":{"car":"car","pcurl":"pcurl"},"dart":"dart","dece.":{"data":["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],"unspecified":["uvx","uvvx"],"zip":["uvz","uvvz"]},"dna":"dna","dpgraph":"dpg","dreamfactory":"dfac","dvb.":{"ait":"ait","service":"svc"},"dynageo":"geo","enliven":"nml","epson.":{"esf":"esf","msf":"msf","quickanime":"qam","salt":"slt","ssf":"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{"album":"ez2","package":"ez3"},"fdf":"fdf","fdsn.":{"mseed":"mseed","seed":["seed","dataless"]},"flographit":"gph","framemaker":["fm","frame","maker","book"],"frogans.":{"fnc":"fnc","ltf":"ltf"},"fujitsu.":{"oasys":"oas","oasys2":"oa2","oasys3":"oa3","oasysgp":"fg5","oasysprs":"bh2"},"fujixerox.":{"ddd":"ddd","docuworks":"xdw","docuworks.binder":"xbd"},"fuzzysheet":"fzs","geogebra.":{"file":"ggb","tool":"ggt"},"geonext":"gxt","geoplan":"g2w","geospace":"g3w","gmx":"gmx","grafeq":["gqf","gqs"],"groove-":{"account":"gac","help":"ghf","injector":"grv","tool-":{"message":"gtm","template":"tpl"},"vcard":"vcg","identity-message":"gim"},"hal+xml":"hal","hbci":"hbci","hp-":{"hpgl":"hpgl","hpid":"hpid","hps":"hps","jlyt":"jlt","pcl":"pcl","pclxl":"pclxl"},"ibm.":{"minipay":"mpy","modcap":["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},"iccprofile":["icc","icm"],"igloader":"igl","immervision-":{"ivp":"ivp","ivu":"ivu"},"intergeo":"i2g","intu.":{"qbo":"qbo","qfx":"qfx"},"jam":"jam","jisp":"jisp","kahootz":["ktz","ktr"],"kde.":{"karbon":"karbon","kchart":"chrt","kformula":"kfo","kivio":"flw","kontour":"kon","kpresenter":["kpr","kpt"],"kspread":"ksp","kword":["kwd","kwt"]},"kenameaapp":"htke","kidspiration":"kia","kinar":["kne","knp"],"koan":["skp","skd","skt","skm"],"lotus-":{"approach":"apr","freelance":"pre","notes":"nsf","organizer":"org","screencam":"scm","wordpro":"lwp","1-2-3":"123"},"mcd":"mcd","medcalcdata":"mc1","mfer":"mwf","mfmp":"mfm","micrografx.":{"flo":"flo","igx":"igx"},"mif":"mif","mobius.":{"daf":"daf","dis":"dis","mbk":"mbk","mqy":"mqy","msl":"msl","plc":"plc","txf":"txf"},"mophun.":{"application":"mpn","certificate":"mpc"},"ms-":{"artgalry":"cil","excel":["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},"fontobject":"eot","htmlhelp":"chm","ims":"ims","lrm":"lrm","outlook":"msg","officetheme":"thmx","pki.":{"seccat":"cat","stl":"stl"},"powerpoint":["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},"project":["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},"works":["wps","wks","wcm","wdb"],"wpl":"wpl","xpsdocument":"xps","cab-compressed":"cab"},"mseq":"mseq","musician":"mus","mynfc":"taglet","nitf":["ntf","nitf"],"noblenet-":{"directory":"nnd","sealer":"nns","web":"nnw"},"nokia.":{"radio-":{"preset":"rpst","presets":"rpss"},"n-gage.":{"data":"ngdat","symbian.install":"n-gage"}},"novadigm.":{"edm":"edm","edx":"edx","ext":"ext"},"osgi.":{"dp":"dp","subsystem":"esa"},"palm":["pdb","pqa","oprc"],"pawaafile":"paw","pg.":{"format":"str","osasli":"ei6"},"picsel":"efif","pocketlearn":"plf","powerbuilder6":"pbd","recordare.":{"musicxml":"mxl","musicxml+xml":"musicxml"},"rn-":{"realmedia":"rm","realmedia-vbr":"rmvb"},"seemail":"see","sema":"sema","semd":"semd","semf":"semf","smaf":"mmf","spotfire.":{"dxp":"dxp","sfs":"sfs"},"stardivision.":{"calc":"sdc","draw":"sda","impress":"sdd","math":"smf","writer":["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip","stepchart":"sm"},"svd":"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},"trueapp":"tra","ufdl":["ufd","ufdl"],"umajin":"umj","unity":"unityweb","uoml+xml":"uoml","vcx":"vcx","visio":["vsd","vst","vss","vsw"],"visionary":"vis","vsf":"vsf","Webd.":{"wbxml":"wbxml","wmlc":"wmlc","wmlscriptc":"wmlsc"},"webturbo":"wtb","wordperfect":"wpd","wqd":"wqd","xara":"xar","xfdl":"xfdl","yamaha.":{"hv-":{"dic":"hvd","script":"hvs","voice":"hvp"},"openscoreformat":"osf","smaf-":{"audio":"saf","phrase":"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},"zul":["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{"aso":"aso","imp":"imp"},"ahead.space":"ahead","airzip.filesecure.":{"azf":"azf","azs":"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{"config":"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml","kmz":"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{"chart":"odc","database":"odb","formula":"odf","graphics":"odg","image":"odi","presentation":"odp","spreadsheet":"ods","text":"odt","text-":{"master":"odm","template":"ott","web":"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{"presentation":"pptx","slide":"sldx","slideshow":"ppsx","template":"potx"},"spreadsheetml.":{"sheet":"xlsx","template":"xltx"},"wordprocessingml.":{"document":"docx","template":"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{"formdata":"ifm","formtemplate":"itp","interchange":"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{"calc":"sxc","draw":"sxd","impress":"sxi","math":"sxm","writer":"sxw","writer.":{"global":"sxg","template":"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{"large":"plb","small":"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{"desktop":"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml","widget":"wgt","winhlp":"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{"abiword":"abw","authorware-":{"bin":["aab","x32","u32","vox"],"map":"aam","seg":"aas"},"bcpio":"bcpio","bittorrent":"torrent","blorb":["blb","blorb"],"bzip":"bz","bzip2":["bz2","boz"],"cbr":["cbr","cba","cbt","cbz","cb7"],"cdlink":"vcd","chat":"chat","conference":"nsc","cpio":"cpio","csh":"csh","director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"doom":"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res","dvi":"dvi","envoy":"evy","eva":"eva","font-":{"bdf":"bdf","ghostscript":"gsf","otf":"otf","pcf":"pcf","snf":"snf","ttf":["ttf","ttc"],"type1":["pfa","pfb","pfm","afm"],"linux-psf":"psf"},"freearc":"arc","futuresplash":"spl","glulx":"ulx","gnumeric":"gnumeric","gtar":"gtar","hdf":"hdf","latex":"latex","mie":"mie","ms-":{"application":"application","shortcut":"lnk","wmd":"wmd","wmz":"wmz","xbap":"xbap"},"msaccess":"mdb","msbinder":"obd","mscardfile":"crd","msclip":"clp","msdownload":["exe","dll","com","bat","msi"],"msmediaview":["mvb","m13","m14"],"msmetafile":["wmf","wmz","emf","emz"],"msmoney":"mny","mspublisher":"pub","msschedule":"scd","msterminal":"trm","mswrite":"wri","netcdf":["nc","cdf"],"nzb":"nzb","pkcs12":["p12","pfx"],"pkcs7-":{"certificates":["p7b","spc"],"certreqresp":"p7r"},"sh":"sh","shar":"shar","sql":"sql","stuffit":"sit","stuffitx":"sitx","subrip":"srt","sv4cpio":"sv4cpio","sv4crc":"sv4crc","tads":"gam","tar":"tar","tcl":"tcl","tex":"tex","texinfo":["texinfo","texi"],"tgif":"obj","ustar":"ustar","xfig":"fig","xliff+xml":"xlf","xpinstall":"xpi","xz":"xz","zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],"xml":["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],"yang":"yang","yin+xml":"yin","zip":"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{"adpcm":"adp","basic":["au","snd"],"midi":["mid","midi","kar","rmi"],"mp4":["m4a","mp4a"],"mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"ogg":["oga","ogg","spx"],"s3m":"s3m","silk":"sil","vnd.":{"dra":"dra","dts":"dts","nuera.":{"ecelp4800":"ecelp4800","ecelp7470":"ecelp7470","ecelp9600":"ecelp9600"},"rip":"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},"webm":"weba","x-":{"aac":"aac","aiff":["aif","aiff","aifc"],"caf":"caf","flac":"flac","matroska":"mka","mpegurl":"m3u","ms-":{"wax":"wax","wma":"wma"},"pn-":{"realaudio":["ram","ra"],"realaudio-plugin":"rmp"},"wav":"wav"},"xm":"xm"},"image/":{"bmp":"bmp","cgm":"cgm","g3fax":"g3","gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"ktx":"ktx","png":"png","sgi":"sgi","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"vnd.":{"djvu":["djvu","djv"],"dwg":"dwg","dxf":"dxf","fastbidsheet":"fbs","fpx":"fpx","fst":"fst","ms-":{"modi":"mdi","photo":"wdp"},"xiff":"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{"mmr":"mmr","rlc":"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},"webp":"webp","x-":{"3ds":"3ds","cmx":"cmx","freehand":["fh","fhc","fh4","fh5","fh7"],"icon":"ico","pcx":"pcx","pict":["pic","pct"],"portable-":{"anymap":"pnm","bitmap":"pbm","graymap":"pgm","pixmap":"ppm"},"rgb":"rgb","tga":"tga","xbitmap":"xbm","xpixmap":"xpm","xwindowdump":"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{"iges":["igs","iges"],"mesh":["msh","mesh","silo"],"vnd.":{"collada+xml":"dae","dwf":"dwf","gdl":"gdl","gtw":"gtw","mts":"mts","vtu":"vtu"},"vrml":["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{"calendar":["ics","ifb"],"css":"css","csv":"csv","html":["html","htm"],"n3":"n3","plain":["txt","text","conf","def","list","log","in"],"richtext":"rtx","sgml":["sgml","sgm"],"troff":["t","tr","roff","man","me","ms"],"turtle":"ttl","vcard":"vcard","vnd.":{"curl":"curl","curl.":{"dcurl":"dcurl","mcurl":"mcurl","scurl":"scurl"},"fly":"fly","graphviz":"gv","in3d.":{"3dml":"3dml","spot":"spot"},"wap.":{"wml":"wml","wmlscript":"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{"asm":["s","asm"],"c":["c","cc","cxx","cpp","h","hh","dic"],"fortran":["f","for","f77","f90"],"nfo":"nfo","opml":"opml","pascal":["p","pas"],"setext":"etx","sfv":"sfv","uuencode":"uu","vcalendar":"vcs","vcard":"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"mp4":["mp4","mp4v","mpg4"],"mpeg":["mpeg","mpg","mpe","m1v","m2v"],"ogg":"ogv","quicktime":["qt","mov"],"vnd.":{"dece.":{"hd":["uvh","uvvh"],"mobile":["uvm","uvvm"],"pd":["uvp","uvvp"],"sd":["uvs","uvvs"],"video":["uvv","uvvv"]},"fvt":"fvt","mpegurl":["mxu","m4u"],"vivo":"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},"webm":"webm","x-":{"f4v":"f4v","fli":"fli","flv":"flv","m4v":"m4v","matroska":["mkv","mk3d","mks"],"mng":"mng","ms-":{"asf":["asf","asx"],"vob":"vob","wm":"wm","wmv":"wmv","wmx":"wmx","wvx":"wvx"},"msvideo":"avi","smv":"smv","sgi-movie":"movie"}},"chemical/x-":{"cdx":"cdx","cif":"cif","cmdf":"cmdf","cml":"cml","csml":"csml","xyz":"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}')},62129:e=>{"use strict";e.exports=JSON.parse('{"prefixHash":"ca4d318e0a1519cffe6030ba0fbd2bf1"}')},35613:e=>{"use strict";e.exports=JSON.parse('{"":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')},43756:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n=[["","Open the product context menu","Turn off send as sticker","Turn on send as sticker","__count__ @ message","Changing __count__ label","The label could not be updated","__count__ label changed","Couldn't block __participant__","__participant__ blocked","Blocking __participant__","Couldn't delete broadcast list.","Broadcast list deleted","Deleting broadcast list","Couldn't archive chat.","Chat archived","Archiving chat","Couldn't clear chat.","Chat cleared","Clearing chat","Couldn't delete chat.","Chat deleted","Deleting chat","Couldn't mark chat as read.","Couldn't mark chat as unread.","Marked as read","Marked as unread","Marking as read","Marking as unread","Couldn't mute chat.","Chat muted","Muting chat","Couldn't pin chat","You can only pin up to 3 chats.","Chat pinned","Pinning chat","Couldn't unarchive chat.","Chat unarchived","Unarchiving chat","Unmute","Couldn't unmute chat.","Chat unmuted","Unmuting chat","Couldn't unpin chat","Chat unpinned","Unpinning chat","Deleting label: __labelName__","Couldn't create group.","Please enter a shorter subject.","Can't add more than __max__ participants","Created group","Creating group","Couldn't delete group.","Group deleted","Deleting group","Couldn't exit group.","Exited group","Exiting group","Couldn't remove group icon.","Group icon removed","Removing group icon","Group icon set","Couldn't set group icon.","Setting group icon","Couldn't mute group.","Group muted","Muting group","Couldn't rename group.","Group renamed to __subject__","Renaming group","Group subject can't be empty","Couldn't unmute group.","Group unmuted","Unmuting group","Stop sharing live location with __name__?","Stop sharing live location with __name__?","Marking as not spam","Couldn't mark as not spam","Marked as not spam","Couldn't delete message because the message may have expired","Couldn't delete message","__count__ message deleted","Deleting message","Couldn't star message because the message may have expired","Couldn't star message","__count__ message starred","Starring message","Couldn't unstar all messages","Couldn't unstar message because the message may have expired","Couldn't unstar message","__count__ message unstarred","All messages unstarred","Unstarring message","Unstarring all messages","Failed to add label: __labelName__","Label: __labelName__ added successfully","Couldn't add __participantNames__.","You added __participantNames__.","Adding __participantNames__.","Removing __participantNames__ as an admin failed.","You can't dismiss __participant__ as admin because they created this group.","__participantNames__ is no longer a group admin.","Removing __participantNames__ as a group admin.","They are no longer in this group.","You can't add this participant because they left the group recently.","Couldn't make __participantNames__ an admin.","__participantNames__ is now a group admin.","Making __participantNames__ a group admin.","Couldn't remove __participantNames__.","You can't remove __participant__ because they created this group.","You removed __participantNames__.","Removing __participantNames__.","Couldn't remove profile photo.","Profile photo removed","Removing profile photo","Profile photo set","Couldn't set profile photo.","Setting profile photo","Your name can't be empty","Your name changed","Couldn't change your name.","Changing your name","Reporting spam","Couldn't report spam","Reported spam","About can't be empty","About changed","Couldn't change About.","Changing About","Try again.","Couldn't unblock __participant__","__participant__ unblocked","Unblocking __participant__","Undo","Add a caption","Blocked contacts will no longer be able to call you or send you messages","Add blocked contact","Add to a group","Add group icon","Add profile photo","Drag the image to adjust","Only __admins__ can send messages","Archive chat","No archived chats","Archived chats","Document","__count__ Page","Contact","__number__ audio file you tried adding has no content.","Your browser doesnt support audio playback.","__number__ audio you tried adding is larger than the __maxSize__ limit.","Using __deviceName__ as your __deviceType__ for your WhatsApp calls",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This official business account changed its name to "__businessName__". Click for more info.','WhatsApp has verified that this official business account changed its name and now uses the name "__businessName__".',"__businessName__ used other companies to store and manage this message.","__businessName__ used Facebook and other companies to store and manage this message.","This message was delivered directly from __businessName__.","This message was delivered directly to __businessName__.","__businessName__ used Facebook to store and manage this message.",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This chat is now with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','This chat is no longer with the official business account of "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the official business account of "__businessName__".',"Block","Block __contact__? Blocked contacts will no longer be able to call you or send you messages.","List of contacts that you have blocked","No blocked contacts yet","Blocked contacts","WhatsApp secures messages while they're being delivered to and from the companies that store and manage this chat for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__.","__businessName__ is registered as a business account.","__businessName__ is registered as an official business account.","__businessName__ is registered as an official business account. The business is saved as a different name in your contacts.","This chat is with the official business account of __businessName__.","This chat is with the official business account of __businessName__. The business is saved as a different name in your contacts.","__businessName__ is now registered as a business account, instead of an official business account.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook or other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ no longer uses other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ is now registered as a business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account. Click to learn more.","__businessName__ now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__, but it's saved as a different name in your contacts. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account. This business uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","__businessName__ now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","This chat is with the official business account of __businessName__. Click to learn more.","__businessName__ now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as a business account.","__businessName__ now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. Click to learn more.","__businessName__ is no longer an official business account. This business now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as an official business account. Click to learn more.","Broadcast list deleted","Browser not supported","__closed__, opens at __time__","End Time","Start Time","__open__ 24 hours","__openTime__ - __closeTime__ and __additionalOpenTime__ - __additionalCloseTime__","__open__ by appointment only","__open__ until __time__","__open__ until __time__, __additionalOpenTime__ - __additionalCloseTime__","This verified business is not in your contact list.","__streetAddress__, __city__","__streetAddress__, __city__ __zipCode__","Confirmed as __businessName__","End Time","This name will be visible to your WhatsApp customers and can be edited from the app on your mobile device.","Something went wrong","An error occurred while saving.  Please try again.","__verified__ as __businessName__","Use Here","__count__ message couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.","__count__ message couldn't be forwarded because the file is missing.","__count__ message couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.","Can't Load WhatsApp","Qty __quantity__","Received cart","__updated__ Item Updated","By using this feature, you're using a __fb_product_link__ and agree that the __fb_commerce_link__ and __wa_commerce_policy_link__ apply.","If you feel this is not correct, you can __request_review_link__.","We reviewed this item again and found it didn't follow product or service guidelines. __learn_more_link__.","This item wasn't approved because it doesn't follow our product or service guidelines. __learn_more_link__.","This item is being reviewed. If its been approved, your customers will be able to see it on your profile. __learn_more_link__.","This item is being reviewed. You hid it, so customers wont see it in your catalog when its approved. __learn_more_link__.","Turn this on to let customers add items to a cart when shopping in your catalog. Turning this off won't affect carts you've already received. __learn_more_link__","View __catalogOwnerName__'s Catalog on WhatsApp","__productName__ from __catalogOwnerName__ on WhatsApp.","View all","Change group icon","__name__ changed their phone number. You're currently chatting with their new number.","__name__ changed their phone number to a new number.","__name__ changed their phone number to a new number. Click to message the new number.","Change profile photo","Charge your phone to keep using WhatsApp","Archived","You are not an admin","Search for messages within __chatName__.","No Internet connection","Clear messages","click here for group info","click here for contact info","Update WhatsApp","Click to reload QR code","Click to save, ESC to cancel","Click to update WhatsApp","Close chat","__count__ item","This collection wasn't approved because its name violates __collections_rejected_policy_adult__","This collection wasn't approved because its name violates __collections_rejected_policy_alcohol__","This collection wasn't approved because its name violates __collections_rejected_policy_animals__","This collection wasn't approved because its name violates __collections_rejected_policy_body_parts_fluids__","This collection wasn't approved because its name violates __collections_rejected_policy_community_standards__","This collection wasn't approved because its name violates __collections_rejected_policy_digital_services_products__","This collection wasn't approved because its name violates __collections_rejected_policy_discrimination__","This collection wasn't approved because its name violates __collections_rejected_policy_drugs__","This collection wasn't approved because its name violates __collections_rejected_policy_gambling__","This collection wasn't approved because its name violates __collections_rejected_policy_hazardous_goods_and_materials__","This collection wasn't approved because its name violates __collections_rejected_policy_healthcare__","This collection wasn't approved because its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__","This collection wasn't approved because its name violates __collections_rejected_policy_illegal_products__","This collection wasn't approved because its name violates __collections_rejected_policy_misleading__","You can __rename_collection_link__ or __request_another_review_link__.","This collection wasn't approved because its name violates __collections_rejected_policy_other_violation__","This collection wasn't approved because its name violates __collections_rejected_policy_overtly_sexualized_positioning__","This collection wasn't approved because its name violates __collections_rejected_policy_real_fake_currency__","This collection wasn't approved because its name violates __collections_rejected_policy_stolen_goods__","This collection wasn't approved because its name violates __collections_rejected_policy_supplements__","This collection wasn't approved because its name violates __collections_rejected_policy_thrid_party_infringements__","This collection wasn't approved because its name violates __collections_rejected_policy_tobacco__","This collection wasn't approved because its name violates __collections_rejected_policy_unauthorized_media__","This collection wasn't approved because its name violates __collections_rejected_policy_weapons__","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_adult__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_alcohol__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_animals__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_body_parts_fluids__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_community_standards__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_digital_services_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_discrimination__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_drugs__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_gambling__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_hazardous_goods_and_materials__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_healthcare__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_illegal_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_misleading__.","You can __rename_collection_link__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_other_violation__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_overtly_sexualized_positioning__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_real_fake_currency__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_stolen_goods__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_supplements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_thrid_party_infringements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_tobacco__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_unauthorized_media__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_weapons__.","","Add __participant__ to __subject__ group?","Add __participants__ to __subject__ group?","You are closing WhatsApp.","Some messages cant be forwarded, do you want to forward rest of the messages?","Can't forward all messages","Forward to __chat__?","Log out?","Make __participant__ an admin for __subject__ group?","Remove __participant__ from __subject__ group?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Unblock __chat__ and forward messages?","Unblock __contact__","Unmute this chat?","Unmute this group?","Connecting","Connecting to WhatsApp","Connecting","Block __contact__","__number__ group in common","About and phone number","Unblock __contact__","Loading About","View contact","__number__ contact that you tried to add has no content.","The contact that you tried to add is larger than the __maxSize__ limit.","Older messages may be available","Use WhatsApp on your phone to search messages from before __date__.","Use WhatsApp on your phone to see the complete chat history.","Search for messages with __chatName__.","WhatsApp message","Default","Delete chat","Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete this label?","Delete message","Delete message?","Tell us about your issue","Please Update WhatsApp","New version available","Desktop Settings","Update","To continue using WhatsApp, click Update and install the latest version.","Couldn't Update Automatically","Downloading an update to WhatsApp. This may take several minutes. WhatsApp will automatically update and restart when the download finishes.","Updating WhatsApp","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","Dismiss","Docs","__count__ Doc","__name__ downloaded.","__number__ document you tried adding has no content.","__number__ document you tried adding is larger than the __maxSize__ limit.","End-to-end encrypted","Edit","Add text to your image","Turn on desktop notifications","& ","  ",", ","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","__name__ turned off disappearing messages.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","__name__ turned off disappearing messages. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","Turning on this setting will make new messages disappear from this chat after 7 days. Recipients can still save these messages elsewhere.","Turning on this setting will make new messages disappear from this chat after a selected amount of time. Recipients can still save these messages elsewhere.","All new messages will disappear from this chat __number__ day after they're sent.","All new messages will disappear from this chat __number__ hour after they're sent.","All new messages will disappear from this chat __number__ minute after they're sent.","All new messages will disappear from this chat __number__ second after they're sent.","Anyone in this chat can change this setting.","Group admins control who can change this setting.","This message will disappear from this chat __number__ day after they're sent.","This message will disappear from this chat __number__ hour after they're sent.","This message will disappear from this chat __number__ minute after they're sent.","This message will disappear from this chat __number__ second after they're sent.","Off","On","__number__ day","__number__ hour","__number__ minute","__number__ second","Wait until the message finishes sending and displays a checkmark before forwarding.","Wait until this message is fully delivered before forwarding.","Unable to forward unsent message.","Cant Forward","__number__ file you tried adding has no content.","__count__ file failed to be downloaded because it's no longer on your phone.","__number__ file could not be added.","__number__ file you tried adding is not supported.","__number__ file you tried adding is larger than the __maxSize__ limit.","B","GB","kB","MB","Forward","You can only share with up to __count__ chat","Forwarded many times. You can only share with up to __count__ chat.","Forward message","Forward message to","Forwarded __count__ time","Found a contact card for this number. View contact card?","Older results may be available","Microsoft Edge","Google Chrome","Mozilla Firefox","Opera","Safari (macOS 11+ Only)","Custom GIF animations are currently not supported. Please use provided GIF selection feature.","Incoming calls off. Click to restore.","Alerts and sounds off. Click to restore.","Notifications enabled","You were added by someone who's not in your contacts","Group deleted","Cancel","Checking invite link","__count__ contact","Join group","Anyone with WhatsApp can follow this link to join this group. Only share it with people you trust.","__count__ participant","You can't view this group's invite link because you're not an admin.","This invite link doesn't match any WhatsApp groups.","Are you sure you want to reset the invite link for __groupName__? If you reset the link, no one will be able to use it to join this group.","Resetting the invite link for __groupName__.","Send link to","Joining group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Joining group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't join group","Viewing and revoking group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Viewing and revoking group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't view group invite details",'"__A__"','__A__"__B__" & "__C__"','"__A__," __B__','"__A__" & "__B__"',"Group muted","Type contact name","__count__ other","View all (__more__)","__count__ more","Group Subject","__number__ invited","Couldn't add __participant__. You can invite them privately to join this group.","Reset invite for __participant__? If you reset the invite, __participant__ won't be able to use it to join this group.","To take photos, WhatsApp needs access to your computer's camera. Click __chrome_media_error__ in the URL bar and choose Always allow web.whatsapp.com to access your camera.","To take photos, WhatsApp needs access to your computers camera. Click __firefox_lock__ in the URL bar and set Use the Camera to Allow.","To take photos, WhatsApp needs access to your computers camera. Click __opera_media__ in the URL bar and click Clear This Setting and Reload.","You cant take a photo because it looks like your computer doesnt have a camera. Try connecting one or if you have one connected, try restarting your browser.","Camera Not Found","Allow camera","To record Voice Messages, WhatsApp needs access to your microphone. Click __chrome_media_error__ in the URL bar and choose Always allow web.whatsapp.com to access your microphone.","To record Voice Messages, WhatsApp needs access to your computers microphone. Click __firefox_lock__ in the URL bar and set Use the Microphone to Allow.","To record Voice Messages, WhatsApp needs access to your computers microphone. Click __opera_media__ in the URL bar and click Clear This Setting and Reload.","You cant record a Voice Message because it looks like your computer doesnt have a microphone. Try connecting one or if you have one connected, try restarting your browser.","Microphone Not Found","Allow microphone","Help","Message from __author__","__unreadCount__ New Message","You'll be logged out after several minutes of inactivity","__number__ image you tried adding has no content.","__number__ image you tried adding is larger than the __maxSize__ limit.","Check your phone to answer","WhatsApp group video call from __name__","WhatsApp group voice call from __name__","WhatsApp video call from __name__","WhatsApp voice call from __name__","WhatsApp connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.","With this update, your phone wont need to stay online to use WhatsApp on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","With this update, your phone wont need to stay online to use WhatsApp Business on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","WhatsApp is available for Mac. __get_it_here__.","Make calls from desktop with WhatsApp for Mac. __get_it_here__.","WhatsApp is available for Windows. __get_it_here__.","Make calls from desktop with WhatsApp for Windows. __get_it_here__.","Keep your phone connected","Expires at __time__","Expires in __number__ day","__count__ item","Price __currencySymbol__ (Optional)","Search in __labelName__...","Learn more","Links","__count__ Link","Accurate to __accuracy__ M","__count__ people","Last updated __date__ at __time__","Last updated today at __time__","Last updated __date__ at __time__","Last updated yesterday at __time__","Live until __time__","__hours__h left","__hours__h __minutes__m left","__minutes__m left","__sharers__ is sharing live location","__name__ is sharing live location","__count__ person is sharing live location","You are sharing live location","You and __name__ are sharing live location","You and __count__ other person are sharing live location","__name__ stopped sharing","Updated __hours__h ago","Updated __hours__h __minutes__m ago","Updated __minutes__m ago","load earlier messages","load recent messages","Loading","loading messages","Log in","Menu __android_menu_icon__","Need help to get started?","Settings __iphone_settings_icon__","Tap __android_menu__ or __iphone_settings__ and select __whatsapp_web_menu_item__","Tap on __login_step_3_md_link_device__","WhatsApp Web","More than 1GB storage usage detected. Please be aware that remaining storage is low.","Low storage warning","Make sure your computer has an active Internet connection.","Manage","Mark as read","Mark as unread","Downloading messages: __progress__%","This version will expire today at __time__. Update to use WhatsApp Web without keeping your phone online.","This version will expire today at __time__. Update to use WhatsApp Desktop without keeping your phone online.","Media","Add a caption","This file was changed from original.","Blocked","Help","Keep me signed in","Log out","Make group admin","Notifications","Profile","Profile","Remove","Settings","Attach","Menu","This audio is too large. You can send audio up to __maxSize__.","Message __author__","This document is too large. You can send documents up to __maxSize__.","This file is too large. You can send files up to __maxSize__.","This image is too large. You can send images up to __maxSize__.","Message info","Delivered","Delivered to","Played","Played by","Read","Read by","__count__ remaining","Couldn't find message","The message youre pasting is too long. Try shortening it or sending it in multiple parts.","Message Too Long","This video is too large. You can send videos up to __maxSize__.","Cant play this Voice Message because it's no longer on your phone.","Voice Message Unavailable","Cant download this document because it's no longer on your phone.","Document Unavailable","Cant view this GIF because it's no longer on your phone.","GIF Unavailable","Media Message Unavailable","Cant view this photo because it's no longer on your phone.","Photo Unavailable","Cant play this video because it's no longer on your phone.","Video Unavailable","Phone number shared via url is invalid.","Send message to","__contactName__ and __count__ other contact","__count__ contact","You can only send up to __count__ contact","Mute __name__ for","__A__, __B__","__A__, and __B__","__A__, __B__","__A__ and __B__","Archive Chat","WhatsApp needed to restart because of a problem.","Problem Detected","Delete Chat","Delete Group","Exit Group","Log Out","Mark as Read","Mark as Unread","Chat","Help","Terms and Privacy Policy","Next Chat","Previous Chat","Window","Bring All to Front","Minimize","Zoom","Mute","New Chat","New Group","Profile and About","Unarchive Chat","Cancel Mute","This video is unavailable. Please try again.","New chat","New group","Next","No contacts","No Docs","No groups","No Links","No Media","No result found for '__labelName__'","No starred messages","Not spam","Notifications","__number__ of __totalNumber__","+__number__","OK, got it","Start WhatsApp at Login","Desktop Alerts","Show Previews","Display message text in desktop alerts","Sounds","Order Detail","Your Order","__subtotal__ (estimated)","Qty __quantity__","__total__ (estimated total)","Already blocked","Order #__order__","Update now to use WhatsApp Web on other devices without keeping your phone online.","WhatsApp is open on another computer or browser. Click Use Here to use WhatsApp in this window.","Pin chat","Waiting for this message. This may take a while.","Previous","__count__ contact excluded","__count__ Product","This photo is too small. Please select a photo with height and width of at least __size__ pixel.","Couldn't send this Voice Message.","","This is not your username or pin. This name will be visible to your WhatsApp contacts.","__pinEmoji__ __address__","Group  __groupName__","All","Reconnect","Remove","Remove this group's icon?",'Remove label "__labelName__" from __count__ item',"Remove photo","Remove your profile photo?","Report __contactInfo__","Report spam","Click to resend","Retry Now","Retrying","Retrying in __duration__","Retrying in __number__ second","Save","Scan Database Usage","Search","Search contacts","Search Emoji","Search GIFs via __service__","Search groups","Search Messages","No chats, contacts or messages found","No contacts found","No groups found","No messages found","No results found for '__keyword__'","Search or start new chat","Looking for chats, contacts or messages","Looking for messages","Learn which chats are end to end encrypted","Show security notifications","See __count__ archived chat","__count__ selected","Photo set to send as sticker","Send contact","Send contacts","send","Feedback/Question about WhatsApp","Email address","Confirm email address","Please enter a valid email address","The email addresses do not match","Subject","Feedback sent","Please enter a subject.","Contact us","__count__ Screenshot Maximum","Please add more to your description","To verify, send a message to __name__ and try again.","The sender is not in your contact list","Settings","__days__d","__hours__h","__minutes__m","__seconds__s","Some of your messages are still sending.","Star message","No starred messages","Starred messages","Created by __name__","Subject","This group is no longer available. Please contact __support__ for help.","__count__ suspicious link","Take photo","You'll be able to use WhatsApp again in __duration__","You're temporarily banned from WhatsApp because you sent too many messages to people who dont have __phone__ in their address books.","You're temporarily banned from WhatsApp because you created too many groups with people who dont have __phone__ in their address books.","__time__ left","Maximum number of files uploaded. __number__ file has been ignored.","Trying to reach phone","Turn off all desktop notifications for:","Unarchive chat","Unblock","Unblock __contact__?","Unblock Contact","Unpin chat","__count__ @ message not synced","__count__ unread message","Unstar","Unstar all messages?","Unstar message","Until __date__ at __time__","Until today at __time__","Until tomorrow at __time__","Until __day__ at __time__","Untitled","Download Microsoft Edge","Update Google Chrome","Update Mozilla Firefox","Update Safari","WhatsApp is out of date. Updating now","Updating","Your phone will no longer need to stay online to use WhatsApp on web, desktop or other devices. __learn_more__","Your phone will no longer need to stay online to use WhatsApp Business on web, desktop or other devices. __learn_more__","Upload photo","__participants__ joined using your invite","You invited __participants__","Version __version__","__number__ video you tried adding has no content.","Your browser doesnt support video playback.","__number__ video you tried adding is larger than the __maxSize__ limit.","View Contact Card","This view once photo has expired. Please ask __name__ to re-send it.","This view once video has expired. Please ask __name__ to re-send it.","View photo","Viewed by __count__","Stop screen sharing","Start screen sharing","You can turn on your camera after __callee__ answers","Your call will end in a few seconds because your microphone and sound output device were disconnected.","Your call will end in a few seconds because your microphone was disconnected.","__name__'s camera and mic are off","__name__'s camera is off","__name__'s mic is muted","__name__ is requesting to switch to a video call","Your call will end in a few seconds because your sound output device was disconnected.","You can turn off your camera after __callee__ answers","Please contact us with the make and model of your camera. ","Call cannot be placed for more than __count__ participant","You can only call up to __count__ contact","__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.","__count__ others","__callee__ is in a country where WhatsApp Calling is unavailable","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is unable to receive WhatsApp calls at this time.","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is not registered on WhatsApp","Couldn't place call: __callee__ is unable to receive WhatsApp video calls at this time.","WhatsApp will use your computer's camera for video calls and taking photos. You can always change this later in your computer's settings.","WhatsApp will use your computer's microphone for calls and voice messages. You can always change this later in your computer's settings.","__contactName__ - WhatsApp voice call","__contactName__ - WhatsApp video call","Chat wallpaper set","Set Chat Wallpaper","Your security code with __contactName__ changed because there was a login on a new device of theirs.","Your security code with __contactName__ changed because you logged into a new device.","Your security code with __contactName__ changed because there was a login on a new device of yours.","Your security code with __contactName__ changed because there was a login on this device.",'WhatsApp has verified that this is the official business account of "__businessName__".',"WhatsApp has verified that this is the official business account of __businessName__. This account is saved with a different name in your contacts.","Your security code could not be verified with __contactName__. Click to learn more.","Verify your security code with __contactName__ because there was an error with their list of linked devices.","You can't send messages to this group because you're no longer a participant.","Can't send a message to blocked contact __contact__.","Your security code with __contactName__ changed because there was a login or logout from one or more of their devices.","Your security code with __contactName__ changed because there was a login or logout from one or more of your devices.","Muted","Messages to this chat are secured with end-to-end encryption. __businessName__ may use another company to store, read and respond to your messages. Click to learn more.","online","last seen __date__ at __time__","last seen today at __time__","last seen __date__ at __time__","last seen yesterday at __time__","__participant__ is typing","__participant__ is recording audio","Audio","Contact","__count__ page","Document","Photo","Location","Video","Voice message","Delete group","Delete broadcast list","Download __name__","Exit","Frequently Contacted","__name__ changed this group's settings to allow all participants to send messages to this group.","__name__ changed this group's settings to allow only admins to send messages to this group.","__name__ created group __subject__","__name__ created this group","An admin created group __subject__","You created group __subject__","You created this group","Created __date__ at __time__","Created __date__ at __time__","Group created by __name__, on __date__ at __time__","Group created by you, on __date__ at __time__","Created today at __time__","Created today at __time__","Group created by __name__, today at __time__","Group created by you, today at __time__","Created __day__ at __time__","Created __day__ at __time__","Created yesterday at __time__","Created yesterday at __time__","Group created by __name__, yesterday at __time__","Group created by you, yesterday at __time__","__name__ changed the group description. Click to view.","__name__ changed the group description.","__name__ reset this group's invite link. Click to view the new invite link.","__name__ changed this group's settings to allow messages that have been forwarded many times.","__name__ changed this group's settings to not allow messages that have been forwarded many times.","__name__ was added","__name__ changed their phone number to a new number.","__name__ changed to __new_number__","__participants__ is no longer an admin","__name__ joined via an invite link","You joined via an invite link","__name__ left","__participants__ is now an admin","__name__ was removed","__name__ added __participants__","__name__ added you","__name__ removed __participants__","__name__ removed you","A participant added __participants__","A participant removed __participants__","You added __participants__","You removed __participants__","__name__ changed this group's settings to allow all participants to edit this group's info.","__name__ changed this group's settings to allow only admins to edit this group's info.","__name__ changed the subject to __subject__","A participant changed the subject to __subject__","You changed the subject to __subject__","__num__ invite sent","Groups","Groups in common","Messages to this chat and calls are secured with end-to-end encryption, which means that WhatsApp and third parties cant read or listen to them. __businessName__ may use a service to store, read and respond to your messages and calls. Contact __businessName__ for information on their privacy practices.","__name__ added to the list","__name__ removed from the list","__name__ and possibly other group participants are using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message this group.","__name__ is using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message them.","This happened likely because __contactName__ or you recently changed which devices you use WhatsApp on. Please verify the security code again.","Your security code with __contactName__ changed","To verify that messages and calls with __contactName__ are end-to-end encrypted, open this screen on your phone, and follow the instructions.","To verify that messages and calls with __contactName__ are end-to-end encrypted, scan or upload this code on their device. You can also compare the number above instead.","About","Messages","Missed group video call at __time__","Missed group voice call at __time__","Missed video call","Missed video call at __time__","Missed voice call","Missed voice call at __time__","The business account for __businessName__ has registered as a standard user account and may no longer belong to the business.","Other contacts","__count__ participant","To receive a payment from __senderName__, set up your payment account on your phone.","__contactName__ canceled their payment request for __currencyAndAmount__","You canceled your payment request to __contactName__ for __currencyAndAmount__","__contactName__ declined your payment request for __currencyAndAmount__.","You declined __contactName__'s payment request for __currencyAndAmount__.","__senderName__'s payment request for __currencyAndAmount__ to you expired.","Your payment request to __receiverName__ for __currencyAndAmount__ expired.","You notified __receiverName__ that you are trying to send a payment.","You can now send __receiverName__ a payment.","__invitee__ has set up payments","You invited __otherUser__ to use payments","__otherUser__ invited you to use payments","Requested from __receiverName__","Requested __amount__ from You","__senderName__ requested __amount__ from You","__senderName__ requested __amount__ from __receiverName__","Sent __amount__ to You","__senderName__ sent __amount__ to You","__senderName__ sent __amount__ to __receiverName__","Sent to __receiverName__","Pending (expires __timeSpan__)","__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.","__senderName__'s payment __relativeTime__ is complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__  was refunded __relativeTime__.","on __date__","__name__ changed this group's icon","You changed this group's icon","__name__ deleted this group's icon","You deleted this group's icon","Preview","OFFICIAL ANNOUNCEMENTS","Recent chats","__count__ recipient","Your security code with __contactName__ changed because there was a logout from one of their devices.","Your security code with __contactName__ changed because there was a logout from one of your devices.","Your security code with __contactName__ changed. Click to learn more.","Your security code with __name__ changed because there was a registration on a new device of theirs.","Your security code with __name__ changed because there was a registration on a new device of yours.","Select messages",'WhatsApp has verified that this is the official business account of "__businessName__". This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.','This chat is with the verified business account for "__businessName__". Click for more info.','This chat is with the business account for "__businessName__". Click for more info.',"__businessName__ may be a business account, but WhatsApp hasnt verified their name yet.",'The business account youre chatting with is now verified as "__businessName__". Click for more info.','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer confirmed as "__businessName__". Click for more info.','WhatsApp is no longer able to confirm that this is the account for "__businessName__".','This account has registered as a business account and WhatsApp has confirmed that this is the account for "__businessName__".',"__businessName__ registered as a business account, but WhatsApp hasnt verified their name yet.",'The business account you\'re chatting with belongs to "__businessName__".',"To chat with __contact__, review and accept WhatsApps updated terms and privacy policy on your phone.","__date__ at __time__","today at __time__","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.",'You opened "Verify security code" for the wrong phone number. Open it for the correct number to verify __contact__.','__contact__ opened "Verify security code" for the wrong phone number. Ask __contact__ to open it for your phone number.',"yesterday at __time__","You","You created a broadcast list with __count__ recipient","To use WhatsApp, update __chrome_update__ or use __firefox_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Google Chrome __min_version_chrome__+","To use WhatsApp, update __edge_homepage__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Microsoft Edge __min_version_edge__+","To use WhatsApp, update __firefox_update__ or use __chrome_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Mozilla Firefox __min_version_firefox__+","WhatsApp group invite","WhatsApp","To use WhatsApp, update __safari_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","To use all of WhatsApp's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","Using Safari","WhatsApp works with Safari __min_version_safari__+","WhatsApp","Send and receive WhatsApp messages right from your computer.","WhatsApp is open in another window. Click Use Here to use WhatsApp in this window.","Quickly send and receive WhatsApp messages right from your computer.","We recommend using WhatsApp with one of the following browsers:","WhatsApp also supports:","You can't add more than __count__ labels","Go to Commerce Manager to update your shop."],{4:"__count__ @ messages",5:"Changing __count__ labels",6:"Some labels could not be updated",7:"__count__ labels changed",79:"Couldn't delete __count__ messages because the messages may have expired",80:"Couldn't delete messages",81:"__count__ messages deleted",82:"Deleting messages",83:"Couldn't star messages because the messages may have expired",84:"Couldn't star messages",85:"__count__ messages starred",86:"Starring messages",88:"Couldn't unstar messages because the messages may have expired",89:"Couldn't unstar messages",90:"__count__ messages unstarred",92:"Unstarring messages",96:"Couldn't add __participantNames__.",97:"You added __participantNames__.",98:"Adding __participantNames__.",99:"Removing __participantNames__ as admins failed.",101:"__participantNames__ are no longer group admins.",102:"Removing __participantNames__ as group admins.",103:"They are no longer in this group.",104:"You can't add these participants because they left the group recently.",105:"Couldn't make __participantNames__ admins.",106:"__participantNames__ are now group admins.",107:"Making __participantNames__ group admins.",108:"Couldn't remove __participantNames__.",110:"You removed __participantNames__.",111:"Removing __participantNames__.",146:"__count__ Pages",148:"__number__ audio files you tried adding have no content.",150:"__number__ audio files you tried adding are larger than the __maxSize__ limit.",254:"__count__ messages couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.",256:"__count__ messages couldn't be forwarded because the file is missing.",257:"__count__ messages couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",262:"__updated__ Items Updated",291:"__count__ items",350:"Send __count__ contacts to __chat__?",351:"Send __count__ contacts to __chat__?",352:"Send __count__ contacts to __chat__?",361:"__number__ groups in common",366:"__number__ contacts that you tried to add have no content.",367:"The contacts that you tried to add are larger than the __maxSize__ limit.",375:"Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete these labels?",376:"Delete messages",377:"Delete messages?",387:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",388:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",389:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",390:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",391:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",392:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",393:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",394:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",397:"__count__ Docs",399:"__number__ documents you tried adding have no content.",400:"__number__ documents you tried adding are larger than the __maxSize__ limit.",408:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent.",409:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent.",410:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent.",411:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent.",412:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",413:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",414:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",415:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",417:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",418:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",419:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",420:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",421:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",422:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",423:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",424:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",425:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",426:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",427:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",428:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",430:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",431:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",432:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",433:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",436:"All new messages will disappear from this chat __number__ days after they're sent.",437:"All new messages will disappear from this chat __number__ hours after they're sent.",438:"All new messages will disappear from this chat __number__ minutes after they're sent.",439:"All new messages will disappear from this chat __number__ seconds after they're sent.",442:"This message will disappear from this chat __number__ days after they're sent.",443:"This message will disappear from this chat __number__ hours after they're sent.",444:"This message will disappear from this chat __number__ minutes after they're sent.",445:"This message will disappear from this chat __number__ seconds after they're sent.",448:"__number__ days",449:"__number__ hours",450:"__number__ minutes",451:"__number__ seconds",452:"Wait until the messages finish sending and displays a checkmark before forwarding.",456:"__number__ files you tried adding have no content.",457:"__count__ files failed to be downloaded because they are no longer on your phone.",458:"__number__ files could not be added.",459:"__number__ files you tried adding are not supported.",460:"__number__ files you tried adding are larger than the __maxSize__ limit.",466:"You can only share with up to __count__ chats",467:"Forwarded many times. You can only share with up to __count__ chats.",468:"Forward messages",469:"Forward messages to",470:"Forwarded __count__ times",471:"Found contact cards for this number. View contact cards?",486:"__count__ contacts",489:"__count__ participants",507:"__count__ others",509:"__count__ more",512:"Couldn't add __participant__. You can invite them privately to join this group.",528:"__unreadCount__ New Messages",530:"__number__ images you tried adding have no content.",531:"__number__ images you tried adding are larger than the __maxSize__ limit.",540:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",541:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",550:"Expires in __number__ days",551:"__count__ items",556:"__count__ Links",557:"Accurate to __accuracy__ M",558:"__count__ people",563:"Live until __time__",564:"__hours__h left",566:"__minutes__m left",567:"__sharers__ are sharing live location",569:"__count__ people are sharing live location",572:"You and __count__ others are sharing live location",574:"Updated __hours__h ago",576:"Updated __minutes__m ago",624:"__count__ remaining",642:"__contactName__ and __count__ other contacts",643:"__count__ contacts",644:"You can only send up to __count__ contacts",707:"__count__ contacts excluded",708:"__count__ Products",709:"This photo is too small. Please select a photo with height and width of at least __size__ pixels.",715:"All",719:'Remove label "__labelName__" from __count__ items',728:"Retrying in __number__ seconds",747:"See __count__ archived chats",748:"__count__ selected",762:"__count__ Screenshots Maximum",767:"__days__d",768:"__hours__h",769:"__minutes__m",770:"__seconds__s",772:"Star messages",778:"__count__ suspicious links",783:"__time__ left",784:"Maximum number of files uploaded. __number__ files have been ignored.",792:"__count__ @ messages not synced",793:"__count__ unread messages",796:"Unstar messages",811:"__participants__ joined using your invite",812:"You invited __participants__",814:"__number__ videos you tried adding have no content.",816:"__number__ videos you tried adding are larger than the __maxSize__ limit.",817:"View Contact Cards",834:"Call cannot be placed for more than __count__ participants",835:"You can only call up to __count__ contacts",836:"__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.",837:"__count__ others",873:"__count__ pages",913:"__participants__ are no longer admins",917:"__participants__ are now admins",932:"__num__ invites sent",936:"__name__ were added to the list",937:"__name__ were removed from the list",946:"Missed group video call at __time__",947:"Missed group voice call at __time__",949:"Missed video call at __time__",951:"Missed voice call at __time__",954:"__count__ participants",956:"__contactName__ canceled their payment request for __currencyAndAmount__",957:"You canceled your payment request to __contactName__ for __currencyAndAmount__",958:"__contactName__ declined your payment request for __currencyAndAmount__.",959:"You declined __contactName__'s payment request for __currencyAndAmount__.",960:"__senderName__'s payment request for __currencyAndAmount__ to you expired.",961:"Your payment request to __receiverName__ for __currencyAndAmount__ expired.",968:"Requested __amount__ from You",969:"__senderName__ requested __amount__ from You",970:"__senderName__ requested __amount__ from __receiverName__",971:"Sent __amount__ to You",972:"__senderName__ sent __amount__ to You",973:"__senderName__ sent __amount__ to __receiverName__",976:"__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.",989:"__count__ recipients",1021:"You created a broadcast list with __count__ recipients"}]},11609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Offline=t.Disconnected=void 0;var n=r(40265);const i=(0,n.customError)("Disconnected",!1);t.Disconnected=i;const a=(0,n.customError)("Offline",!1,i);t.Offline=a},48338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AckParser=void 0,t.ackMatchesTemplate=function(e,t){return e.id===t.id&&(void 0===t.class||e.class===t.class)&&(void 0===t.type||e.type===t.type)&&(void 0===t.from||o(e.from,t.from))&&(void 0===t.participant||e.participant===t.participant)&&(void 0===t.ts||e.ts===t.ts)},t.fromJidsAreEqual=o;var n=r(74391),i=r(52230);const a=new(r(71914).WapParser)("ack",(e=>(e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null})));function o(e,t){if((0,i.extractFromJid)(e)===t)return!0;const{defaultDeviceJidForUser:r}=(0,n.getJidUtilsApi)();return e.userJid?r(e.userJid)===t:!!e.deviceJid&&(0===(0,i.extractDeviceId)(e.deviceJid)&&(0,i.extractUserJid)(e.deviceJid)===t)}t.AckParser=a},36184:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){_&&_.deadSocketTimer.cancel()},t.castStanza=function(e){const t=A("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=A("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.forceResetSocketLoop=function(){A("forceResetSocketLoop").socketLoop.reset()},t.isSocketConnected=E,t.maybeResetSocketLoop=function(){E()||A("maybeResetSocketLoop").socketLoop.reset()},t.onStreamErrorReceived=function(){A("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=y,t.resetStateForTests=function(){_=null,h=new u.Resolvable,g=1},t.sendIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqErrorParser=function(e,t,r){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendIqIfConnectedWithin=function(e,t,r){return T(e,!1,r).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqIfConnectedWithinErrorParser=function(e,t,r,n){return T(e,!1,r).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendIqWithoutRetry=function(e,t){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqWithoutRetryErrorParser=function(e,t,r){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendPing=function(){return C.apply(this,arguments)},t.sendSmaxIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendSmaxIqErrorParser=function(e,t,r){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendStanzaAndReturnAck=v,t.sendStanzaAndWaitForAck=function(e,t){return v(e,t).then((()=>{}))},t.singletonOrThrowIfUninitialized=A,t.socketLoopIteration=S,t.startComms=function(e,t,r,n){if(_)return;_=new m(e,t,r,n),setTimeout(y,0)},t.startHandlingRequests=function(){return A("startHandlingRequests").startHandlingRequests()},t.stopComms=function(){const e=A("stopComms");e.socketLoop.endWithValue(),e.socket&&e.socket.close()},t.waitForConnection=function(){return A("waitForConnection").sendPing(),h.promise};var i=n(r(11504)),a=r(48338),o=r(47151),s=r(11609),l=r(20221),c=r(37329),d=r(72287),u=r(88156),p=r(57319),f=r(31914);r(71914);let _=null,h=new u.Resolvable,g=1;class m{constructor(e,t,r,n){var i,a;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new u.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.handleStanza=(e,t,r)=>{const n=b(e);if(null!=n){const t=this.pendingIqs.get(n);t?(this.pendingIqs.delete(n),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${n}`}else{if("ack"!==e.tag)return"failure"===e.tag&&this.config.shouldBlockReceivingUntilSuccess?this._handleStanza(e,t,r):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,r)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new p.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new p.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.onConnectionChange=(0,l.notifyConnectionChangeFactory)(null!==(i=r.handlers.onConnectionChange)&&void 0!==i?i:()=>{},null!==(a=r.handlers.onOptimisticConnectionChange)&&void 0!==a?a:()=>{}),this.gzipInflate=n,this.config=r,this.socketLoop=new d.PromiseRetryLoop({name:"MainSocketLoop",code:S,timer:{jitter:.1,max:r.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{var r,n;null===(r=(n=this.config.handlers).onCastStanza)||void 0===r||r.call(n,e),t.sendFrame((0,f.encodeStanza)(e))}catch(e){__LOG__(4,void 0,new Error)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){return __LOG__(2)`Comms.startHandlingRequests`,this._recvBlocker.resolve(),this._recvBlocker.promise.then((()=>{}))}parseAndHandleStanza(e,t){e===this.socketId&&(this.deadSocketTimer.cancel(),h.resolveWasCalled()||h.resolve());const r=(0,f.decodeStanza)(t,this.gzipInflate).catch((e=>{throw __LOG__(4,void 0,new Error)`Failure parsing stanza!`,e})).then((r=>{var n,i;null===(n=(i=this.config.handlers).onHandleStanza)||void 0===n||n.call(i,r,e,t.byteLength);const a=this.activePing;return a&&a.socketId===e&&a.stanzaId===b(r)?(this.activePing=null,a.handler.resolve(r),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(r,e,t.byteLength)})).then((t=>{if(e===this.socketId){if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:this.castStanza(t);return"NO_ACK"}}));this._pending.add(r),r.finally((()=>{this._pending.delete(r)}))}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){var i,a;const s=t[r];(0,o.removeIndexWithoutPreservingOrder)(t,r),null===(i=(a=this.config.handlers).onHandleAck)||void 0===i||i.call(a,e),s.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,o.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new s.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}function y(){A("openSocketLoop").socketLoop.start()}function E(){var e;return!!(null===(e=_)||void 0===e?void 0:e.socket)}function S(){var e,t;const r=A("socketLoopIteration"),n=r.nextSocketId++;return __LOG__(2)`Comms: Socket ${n} opening`,null===(e=(t=r.config.handlers).onSocketLoopIteration)||void 0===e||e.call(t),r.config.openChatSocket((()=>{r.onConnectionChange("in_handshake")})).then((e=>{var t,i,a,o;null===(t=(i=r.config.handlers).onSocketOpen)||void 0===t||t.call(i);const s=new u.Resolvable;return __LOG__(2)`Comms: Socket ${n} opened`,r.socketId=n,r.socket=e,r.softCloseSocket=()=>{r.softCloseSocket=null,r.socket&&r.config.shouldCloseStaleSocket&&(r.socket.close(),r.socket=null),s.resolve()},r.socketLoop.resetTimeoutAfter(1e4),r.deadSocketTimer.cancel(),r.maybeScheduleHealthCheck(),e.setOnFrame((e=>r.parseAndHandleStanza(n,e))),e.setOnClose((()=>{var e,t;__LOG__(2)`Comms: Socket ${n} closed`,r.activePing&&n===r.activePing.socketId&&(r.activePing.handler.resolve(),r.activePing=null),r.filterPending((e=>e.attachedToSocketId===n)).forEach((e=>{r.removeHandler(e)})),n===r.socketId&&(r.socketId=0,r.socket=null,r.onConnectionChange("disconnected"),null===(e=(t=r.config.handlers).onDisconnect)||void 0===e||e.call(t),s.resolve(),h=new u.Resolvable)})),r.onConnectionChange("connected"),null===(a=(o=r.config.handlers).onConnect)||void 0===a||a.call(o),r.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((e=>{"iq"===e.type?r.sendPendingIq(e):r.callStanza(e.stanza)})),s.promise})).catch((e=>{e instanceof s.Disconnected?__LOG__(2)`socketLoopIteration socket closed while in noise handshake`:__LOG__(4,void 0,new Error)`socketLoopIteration failed ${e}`}))}function v(e,t){return new Promise((r=>{const n=A("sendStanzaAndWaitForAck");n.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=a.AckParser.parse(e);return!r.error&&(0,a.ackMatchesTemplate)(r.success,t)?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:g++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((n=>{var i,a;const o=A("sendIq"),l=e.attrs.id;if(!l||"string"!=typeof l)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const c=o.socketId;if(t&&!c)return void n(Promise.reject(new s.Offline));let d;r>0&&(d=setTimeout((()=>{const e=o.pendingIqs.get(l);e?o.removeHandler(e):n(Promise.reject(new Error(`Comms:_sendIq unexisting stanza to be cancelled: ${l}`)))}),1e3*r));const u={type:"iq",resolve:n,stanza:e,attachedToSocketId:t?c:0,orderedId:g++,timeoutId:d};o.pendingIqs.set(l,u),null===(i=(a=o.config.handlers).onSendIq)||void 0===i||i.call(a,e),o.socket?o.sendPendingIq(u):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}))}function C(){return(C=(0,i.default)((function*(e,t){const r=A("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new u.Resolvable;r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e);const a=yield i.promise;return a&&(0,c.parseIqResponse)(a,t)}))).apply(this,arguments)}function A(e){if(_)return _;throw new Error(`Comms::${e} called before startComms`)}function b(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,f.decodeAsString)(e.attrs.id)||null}return null}},20221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyConnectionChangeFactory=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;const n={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},i=()=>{const{optimismLevel:e,connectionStatus:i}=n;"optimist"===e?n.timeoutID=setTimeout((()=>{n.optimismLevel="realist",t(i)}),r):t(i)};return r=>{n.connectionStatus=r,"disconnected"===r||"in_handshake"===r?i():(null!=n.timeoutID&&(clearTimeout(n.timeoutID),n.timeoutID=null),t(r)),e(r)}}},34308:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmppParsingFailure=t.ParsableWapNode=void 0;var n=r(8584),i=r(74391),a=r(52230),o=r(8243),s=r(91560),l=r(17793),c=r(92844),d=r(31914),u=r(45506);class p{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmppParsingFailure: ${this.parser}: ${this.reason}`}}t.XmppParsingFailure=p;class f extends s.ParsableXmlNode{constructor(e,t){super(e,t)}assertFromServer(){const e=this.attrString("from");e!==a.WA_SERVER_DOMAIN&&this.throw(`to have "from"="s.whatsapp.net", but instead has "${e}"`)}attrUserJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).userJid||this.throw(`to have "${e}"={UserJid}, but instead has "${t}"`)}attrPhoneUserJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneUser"===r.jidType?r.userJid:this.throw(`to have "${e}"={PhoneUserJid}, but instead has "${t}"`)}maybeAttrUserJid(e){return this.hasAttr(e)?this.attrUserJid(e):null}maybeAttrPhoneUserJid(e){return this.hasAttr(e)?this.attrPhoneUserJid(e):null}attrGroupJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).groupJid||this.throw(`to have "${e}"={GroupJid}, but instead has "${t}"`)}maybeAttrGroupJid(e){return this.hasAttr(e)?this.attrGroupJid(e):null}attrChatJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return r.userJid||r.groupJid||this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrPhoneChatJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneUser"===r.jidType?r.userJid:"group"===r.jidType?r.groupJid:this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrDeviceJid(e){const{defaultDeviceJidForUser:t}=(0,i.getJidUtilsApi)(),r=this.attrString(e),n=(0,a.interpretAndValidateJid)(r);return n.deviceJid?n.deviceJid:n.userJid?t(n.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${r}"`)}attrPhoneDeviceJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneDevice"===r.jidType?r.deviceJid:"phoneUser"===r.jidType?(0,a.defaultPhoneDeviceJidForUser)(r.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrDeviceId(e){const t=this.attrInt(e);return(0,a.interpretAsDeviceId)(t)}attrFromJidChat(){const{defaultDeviceJidForUser:e}=(0,i.getJidUtilsApi)(),t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{const r=t.userJid,n=e(r);return{type:"device",chat:r,deviceJid:n,author:n}}case"phoneUser":{const r=t.userJid,n=e(r);return{type:"device",chat:r,deviceJid:n,author:n}}case"lidUser":{const e=t.userJid,r=(0,a.defaultLidDeviceJidForLidUserJid)(e);return{type:"device",chat:e,deviceJid:r,author:r}}case"phoneDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"msgrDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"lidDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"group":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:e}}case"broadcast":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:(0,a.extractUserJid)(e),author:e}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${t.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with a status jid")}}attrFromJidPhoneChat(){const e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{const t=e.userJid,r=(0,a.defaultPhoneDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:r,author:r}}case"phoneDevice":{const t=e.deviceJid;return{type:"device",chat:(0,a.extractPhoneUserJid)(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:(0,a.extractPhoneUserJid)(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw(`attrFromJidChat should not be used with jid of type ${e.jidType}`)}}attrFromPhoneJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidPhoneChat()}attrFromJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidChat()}attrJidWithType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"unknown"===r.jidType?this.throw(`to have "${e}"={Jid}, but instead has "${t}"`):r}attrWapJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"unknown"===r.jidType?u.WapJid.create(null,t):(0,d.JID)((0,a.extractFromJid)(r))}attrLongInt(e){const t=this.attrString(e);return(0,o.decimalStringToLongInt)(t)}attrTime(e){return(0,c.castToUnixTime)(this.attrInt(e))}attrFutureTime(e){const t=this.attrInt(e);return(0,c.futureUnixTime)(t)}contentString(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){const e=new n.Binary(this.contentBytes());return e.readString(e.size())}return this.throw("to have content")}decodeAsString(e){return(0,d.decodeAsString)(e)}contentSerializedPubKey(){return this.hasContent()?(0,l.serializeIdentity)(this.contentBytes()):this.throw("to have content")}throw(e){throw new p(this.name(),`expected <${this.tag()}> ${e}`)}}t.ParsableWapNode=f},37329:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIqResponse=function(e,t,r){const o=e.content;if(o&&Array.isArray(o)&&o[0]){const t=o[0];if("error"===t.tag){const o=t.attrs||{};let s;r&&(s=r instanceof i.WapParser?r.parseOrThrow(t):r(e));const l=s;return{success:!1,errorCode:parseInt(o.code,10),errorText:(0,n.decodeAsString)(o.text)||"",errorType:(0,n.decodeAsString)(o.type)||"",errorBackoff:parseInt(o.backoff,10),toString:a,customError:l}}}return t instanceof i.WapParser?{success:!0,result:t.parseOrThrow(e)}:{success:!0,result:t(e)}};var n=r(31914),i=r(71914);function a(){return`IqError ${this.errorCode}: ${this.errorText}`}},31914:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.BIG_ENDIAN_CONTENT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=e;const n=new Uint8Array(t);for(let e=t-1;e>=0;e--)n[e]=255&r,r>>>=8;return n},t.BROADCAST_JID=function(e){return W(e)},t.CALL_JID=function(e){return W(e)},t.CUSTOM_STRING=function(e){return e},t.DEVICE_JID=function(e){return W(e)},t.DROP_ATTR=void 0,t.GROUP_JID=function(e){return W(e)},t.G_US=void 0,t.INT=function(e){return e.toString()},t.JID=W,t.LONG_INT=function(e){return(0,o.longIntToDecimalString)(e)},t.MAYBE_CUSTOM_STRING=function(e){if(null==e)return S;return e},t.PARTICIPANT_JID=function(e){return"status"===e.type||"group"===e.type||"broadcast"===e.type?W(e.author):S},t.S_WHATSAPP_NET=t.STATUS_BROADCAST=void 0,t.TO_JID=function(e){return W(Y(e))},t.TO_WAP_JID=function(e){return"phoneDevice"===e.jidType||"msgrDevice"===e.jidType||"lidDevice"===e.jidType?W(e.deviceJid):"phoneUser"===e.jidType||"msgrUser"===e.jidType||"lidUser"===e.jidType?W(e.userJid):"group"===e.jidType?W(e.groupJid):"status"===e.jidType?W(e.statusJid):"call"===e.jidType?W(e.callJid):(e.jidType,W(e.broadcastJid))},t.USER_JID=function(e){return W(e)},t.WapNode=void 0,t.decodeAsString=function(e){if(e instanceof l.WapJid)return e.toString();return e},t.decodeStanza=function(e,t){const r=new i.Binary(e);if(2&r.readUint8())return __LOG__(2)`Decoding compressed stanza`,t(r.readByteArray()).then((e=>x(new i.Binary(e))));return Promise.resolve(x(r))},t.encodeStanza=function(e){const t=e instanceof b?e:O(e),r=new i.Binary;I(t,r);const n=r.readByteArray(),a=new Uint8Array(1+n.length);return a[0]=0,a.set(n,1),a},t.extractParticipantJid=function(e){switch(e.type){case"group":case"status":case"broadcast":return e.author;default:return e.type,null}},t.extractToJid=Y,t.generateId=function(){if(!y){const e=new Uint16Array(2);self.crypto.getRandomValues(e),y=`${String(e[0])}.${String(e[1])}-`}return`${y}${E++}`},t.makeStanza=O,t.makeWapNode=P,t.wap=void 0;var i=r(8584),a=r(52230),o=r(8243),s=r(27498),l=r(45506),c=(n(r(17890)),r(74277));const d=a.MSGR_USER_DOMAIN.replace("@",""),u=a.WA_USER_DOMAIN.replace("@",""),p=a.LID_DOMAIN.replace("@",""),f=[236,237,238,239],_=248,h=249,g=["0","1","2","3","4","5","6","7","8","9","-",".","","","",""],m=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let y="",E=1;const S={sentinel:"DROP_ATTR"};t.DROP_ATTR=S;const v=l.WapJid.create(null,"g.us");t.G_US=v;const T=l.WapJid.create(null,a.WA_SERVER_DOMAIN);t.S_WHATSAPP_NET=T;const C=l.WapJid.create("status","broadcast");t.STATUS_BROADCAST=C;const A={};class b{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=(0,c.attrsToString)(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:e+=t?`>${(0,c.uint8ArrayToDebugString)(t)}</${this.tag}>`:" />",e}}function P(e,t,r){let n=null;if(t&&null!=t.children)throw new Error('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(r))n=r.filter(Boolean);else if("string"==typeof r)n=i.Binary.build(r).readByteArray();else if(r instanceof ArrayBuffer)n=new Uint8Array(r);else if(r instanceof Uint8Array)n=r;else{const e=[];for(let t=2;t<arguments.length;t++){const r=arguments[t];r&&e.push(r)}n=e}Array.isArray(n)&&0===n.length&&(n=null);const a={};if(t){const r=t;Object.keys(r).forEach((t=>{const n=r[t];if(null==n)throw new Error(`Attr ${t} in <${e}> is null`);n!==S&&(a[t]=n)}))}return new b(e,a,n)}t.WapNode=b;const M=P;function O(e){let t=e.content;return Array.isArray(t)?t=t.map(O):"string"==typeof t&&(t=i.Binary.build(t).readByteArray()),new b(e.tag,e.attrs||A,t)}function I(e,t){if(null==e)t.writeUint8(0);else if(e instanceof b)w(e,t);else if(e instanceof l.WapJid)!function(e,t){const r=e.getInnerJid();if(r.type===l.WAP_JID_SUBTYPE.JID_AD){const{user:e,agent:n,device:i}=r;t.writeUint8(247),t.writeUint8(n),t.writeUint8(i),I(e,t)}else if(r.type===l.WAP_JID_SUBTYPE.JID_FB){const{user:e,device:n}=r;t.writeUint8(246),I(e,t),t.writeUint16(n),I(u,t)}else{const{user:e,server:n}=r;t.writeUint8(250),null!=e?I(e,t):t.writeUint8(0),I(n,t)}}(e,t);else if("string"==typeof e)L(e,t);else{if(!(e instanceof Uint8Array))throw new Error("Invalid payload type "+typeof e);!function(e,t){G(e.length,t),t.writeByteArray(e)}(e,t)}}function w(e,t){if(void 0===e.tag)return t.writeUint8(_),void t.writeUint8(0);let r=1;e.attrs&&(r+=2*Object.keys(e.attrs).length),e.content&&r++,r<256?(t.writeUint8(_),t.writeUint8(r)):r<65536&&(t.writeUint8(h),t.writeUint16(r)),I(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach((r=>{L(r,t),I(e.attrs[r],t)}));const n=e.content;if(Array.isArray(n)){n.length<256?(t.writeUint8(_),t.writeUint8(n.length)):n.length<65536&&(t.writeUint8(h),t.writeUint16(n.length));for(let e=0;e<n.length;e++)w(n[e],t)}else n&&I(n,t)}let R,D;function N(e){const t=new Map;for(let r=0;r<e.length;r++)t.set(e[r],r);return t}function L(e,t){if(""===e)return t.writeUint8(252),void t.writeUint8(0);null==R&&(R=N(s.SINGLE_BYTE_TOKEN));const r=R.get(e);if(null!=r)return void t.writeUint8(r+1);if(null==D){D=[];for(let e=0;e<s.DICTIONARIES.length;++e)D.push(N(s.DICTIONARIES[e]))}for(let r=0;r<D.length;++r){const n=D[r].get(e);if(null!=n)return t.writeUint8(f[r]),void t.writeUint8(n)}const n=(0,i.numUtf8Bytes)(e);if(n<128){if(!/[^0-9.-]+?/.exec(e))return void k(e,255,t);if(!/[^0-9A-F]+?/.exec(e))return void k(e,251,t)}G(n,t),t.writeString(e)}function k(e,t,r){const n=e.length%2==1;r.writeUint8(t);let i=Math.ceil(e.length/2);n&&(i|=128),r.writeUint8(i);let a=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);let o=null;if(48<=i&&i<=57?o=i-48:255===t?45===i?o=10:46===i&&(o=11):251===t&&65<=i&&i<=70&&(o=i-55),null==o)throw new Error(`Cannot nibble encode ${i}`);n%2==0?(a=o<<4,n===e.length-1&&(a|=15,r.writeUint8(a))):(a|=o,r.writeUint8(a))}}function G(e,t){if(e<256)t.writeUint8(252),t.writeUint8(e);else if(e<1048576)t.writeUint8(253),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(255&e);else{if(!(e<4294967296))throw new Error(`Binary with length ${e} is too big for WAP protocol`);t.writeUint8(254),t.writeUint32(e)}}function U(e,t){const r=e.readUint8();if(0===r)return null;if(r===_)return F(e,e.readUint8());if(r===h)return F(e,e.readUint16());if(252===r){const r=e.readUint8();return K(e,r,t)}if(253===r){const r=e.readUint8(),n=e.readUint8(),i=e.readUint8();return K(e,((15&r)<<16)+(n<<8)+i,t)}if(254===r){const r=e.readUint32();return K(e,r,t)}if(250===r)return function(e){const t=function(e){const t=U(e,!0);if(null!=t&&"string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}(e),r=B(e);return l.WapJid.create(t,r)}(e);if(246===r)return function(e){const t=B(e),r=e.readUint16();return B(e),l.WapJid.createFbJid(t,r)}(e);if(247===r)return function(e){const t=e.readUint8(),r=e.readUint8(),n=B(e);return l.WapJid.createAD(n,t,r)}(e);if(255===r){const t=e.readUint8();return j(e,g,t>>>7,127&t)}if(251===r){const t=e.readUint8();return j(e,m,t>>>7,127&t)}if(r<=0||r>=240)throw new Error("Unable to decode WAP buffer");if(r>=236&&r<=239){const t=r-236,n=s.DICTIONARIES[t];if(void 0===n)throw new Error(`Missing WAP dictionary ${t}`);const i=e.readUint8(),a=n[i];if(void 0===a)throw new Error(`Invalid value index ${i} in dict ${t}`);return a}const n=s.SINGLE_BYTE_TOKEN[r-1];if(void 0===n)throw new Error(`Undefined token with index ${r}`);return n}function F(e,t){const r=[];for(let n=0;n<t;n++)r.push(x(e));return r}function x(e){const t=e.readUint8();let r,n;if(t===_)r=e.readUint8();else{if(t!==h)throw new Error(`Failed to decode node since type byte ${String(t)} is invalid`);r=e.readUint16()}let i=null;if(0===r)throw new Error("Failed to decode node, list cannot be empty");const a=B(e);for(r-=1;r>1;){n||(n={});const t=B(e),i=U(e,!0);n[t]=i,r-=2}return 1===r&&(i=U(e,!1),i instanceof l.WapJid&&(i=String(i))),new b(a,n,i)}function B(e){const t=U(e,!0);if("string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}function K(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?e.readString(t):e.readByteArray(t)}function j(e,t,r,n){const i=new Array(2*n-r);for(let r=0;r<i.length-1;r+=2){const n=e.readUint8();i[r]=t[n>>>4],i[r+1]=t[15&n]}if(r){const r=e.readUint8();i[i.length-1]=t[r>>>4]}return i.join("")}function Y(e){switch(e.type){case"group":return e.groupJid;case"status":return a.STATUS_JID;case"device":return e.deviceJid;default:return e.type,e.broadcastJid}}function W(e){let[t,r]=e.split("@"),n=null,i=null;return r!==u&&r!==d&&r!==p||(-1!==t.indexOf(":")&&([t,i]=t.split(":"),i=parseInt(i,10)),-1!==t.indexOf(".")&&([t,n]=t.split("."),n=parseInt(n,10))),r===d?l.WapJid.createFbJid(t,i):null!=i&&0!==i||null!=n&&0!==n?l.WapJid.createAD(t,n,i):l.WapJid.create(t,r)}t.wap=M},27498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SINGLE_BYTE_TOKEN=t.DICT_VERSION=t.DICTIONARY_3_TOKEN=t.DICTIONARY_2_TOKEN=t.DICTIONARY_1_TOKEN=t.DICTIONARY_0_TOKEN=t.DICTIONARIES=void 0;t.DICT_VERSION=2;t.SINGLE_BYTE_TOKEN=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];const r=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];t.DICTIONARY_0_TOKEN=r;const n=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];t.DICTIONARY_1_TOKEN=n;const i=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];t.DICTIONARY_2_TOKEN=i;const a=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"];t.DICTIONARY_3_TOKEN=a;const o=[r,n,i,a];t.DICTIONARIES=o},45506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapJid=t.WAP_JID_SUBTYPE=void 0;var n=r(52230);const i={JID:0,JID_AD:1,JID_FB:3};t.WAP_JID_SUBTYPE=i;class a{constructor(e){this._jid=e}static createAD(e,t,r){return new a({type:i.JID_AD,user:e,device:null==r?0:r,agent:null==t?0:t})}static createFbJid(e,t){return new a({type:i.JID_FB,user:e,device:null==t?0:t})}static create(e,t){return new a({type:i.JID,user:e,server:t})}toString(){if(this._jid.type===i.JID_AD){const{user:e,agent:t,device:r}=this._jid,i=n.WA_USER_JID_SUFFIX;return 0===t&&0===r?`${e}@${i}`:0!==t&&0===r?`${e}.${t}@${i}`:0===t&&0!==r?`${e}:${r}@${i}`:`${e}.${t}:${r}@${i}`}if(this._jid.type===i.JID_FB){const{user:e,device:t}=this._jid;return`${e}:${t}@${n.MSGR_USER_JID_SUFFIX}`}{this._jid.type;const{user:e,server:t}=this._jid;return null!=e?`${e}@${t}`:t}}getInnerJid(){return this._jid}}t.WapJid=a},71914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapParser=void 0;var n=r(34308);t.WapParser=class{constructor(e,t){this._name=e,this._parser=t}parse(e){const t=new n.ParsableWapNode(this._name,e);try{return{success:this._parser(t)}}catch(e){if(e instanceof n.XmppParsingFailure)return{error:e};throw e}}parseOrThrow(e){const t=this.parse(e);if(t.error)throw new Error(String(t.error));return t.success}}},61070:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_MEDIA_KEY_TTL=void 0,t.isMediaKeyReusable=function(e){const t=Math.floor(Math.random()*i);return null!=e&&(0,n.happenedWithin)(e,a+t)};var n=r(92844);const i=n.DAY_SECONDS,a=2*n.DAY_SECONDS;t.MMS_MEDIA_KEY_TTL=a},2555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_MEDIA=void 0,t.castToServerMediaType=function(e){switch(e){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":return e;default:return null}};t.SERVER_MEDIA=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image"]},71610:(e,t)=>{"use strict";function r(e){return 16*parseInt((e+15)/16,10)}Object.defineProperty(t,"__esModule",{value:!0}),t.alignChunkLengthsToMultipleOfAesBlockSize=function(e,t){const n=[];let i=0,a=0,o=0;for(let s=0;s<e.length;++s){if(i+=e[s],s===e.length-1&&null!=t){i>a?n.push(t-a):(n.pop(),n.push(t-o));break}if(i>a){const e=r(i-a);o=a,n.push(e),a+=e}}return n},t.alignChunkSizeToMultipleAesBlockSize=r},17525:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketClosed=t.FrameSocket=void 0;var n=r(8584);class i extends Error{constructor(e){const t="SocketClosed";super(null!=e?e:t),this.name=t}}t.SocketClosed=i;function a(e){if(e.size()<3)return!1;return o(e)<=e.size()}function o(e){return e.readUint8()<<16|e.readUint16()}t.FrameSocket=class{constructor(e,t){this._incoming=new n.Binary,this.closed=!1,this._draining=!1,this.onFrame=null,this.onClose=null,this._handleData=e=>{this._incoming.writeByteArray(e),this.convertBufferedToFrames()},this._handleClose=()=>{if(this._incoming.peek(a))return __LOG__(2)`FrameSocket closed, waiting for pending processing`,void(this._draining=!0);this._doClose()},this._doClose=()=>{if(this.closed)return;__LOG__(2)`FrameSocket closed`,this._draining=!1,this.closed=!0;const e=this.onClose;e&&e()},this._handleError=e=>{__LOG__(4,void 0,new Error)`FrameSocket error ${e}`},this._introToSend=t,this._socket=e,e.onData=this._handleData,e.onClose=this._handleClose,e.onError=this._handleError}sendFrame(e){if(this._draining)return;this.throwIfClosed();const t=this._introToSend,r=e.byteLength,n=this._socket.dataToSend;t?(this._introToSend=null,n.ensureAdditionalCapacity(t.length+3+r),n.writeByteArray(t)):n.ensureAdditionalCapacity(3+r),n.writeUint8(r>>16),n.writeUint16(65535&r),n.write(e),this._socket.requestSend()}convertBufferedToFrames(){const e=this._incoming;let t=this.onFrame;for(;t&&e.peek(a);){const r=o(e);__LOG__(2)`FrameSocket.onFrame(${r} bytes)`;t(e.readByteArray(r)),t=this.onFrame}this._draining&&!e.peek(a)&&this._doClose(),t&&e.size()&&__LOG__(2)`FrameSocket: queueing partial frame of ${e.size()} bytes`}throwIfClosed(){if(this.closed)throw new i}close(){this._socket.close()}}},10095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseHandshake=void 0;var n=r(8584),i=r(81576),a=r(73045),o=r(11609),s=r(43891),l=r(88156);const c=Promise.reject("UNINITIALIZED HANDSHAKE"),d=new Uint8Array(0);c.catch((()=>{}));function u(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["encrypt","decrypt"];return self.crypto.subtle.importKey("raw",new Uint8Array(e),"AES-GCM",!1,t)}function f(e,t){return(0,i.extractWithSaltAndExpand)(t,new Uint8Array(e),"",64).then((e=>[e.slice(0,32),e.slice(32)]))}function _(e){e.catch((()=>{}))}t.NoiseHandshake=class{constructor(e){this._hash=c,this._salt=c,this._cryptoKey=c,this._counter=0,this._socket=e,this._rejectOnClose=new l.Resolvable,e.onClose=()=>{this._rejectOnClose.reject(new o.Disconnected("NoiseHandshake: SocketClosed"))},_(this._rejectOnClose.promise)}start(e,t){const r=n.Binary.build(e).readBuffer(),i=32===r.byteLength?Promise.resolve(r):(0,a.sha256)(r);this._hash=i,this._salt=i,this._cryptoKey=i.then(p),this.authenticate(t)}sendAndReceive(e){const t=this._socket,r=new Promise((r=>{t.onFrame=e=>{t.onFrame=null,r(e)},t.sendFrame(e)}));return this._orRejectOnClose(r)}send(e){this._socket.sendFrame(e)}authenticate(e){this._hash=Promise.all([this._hash,e]).then((e=>{let[t,r]=e;const i=n.Binary.build(t,r).readByteArray();return(0,a.sha256)(i)}))}encrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash,e]).then((e=>{let[r,n,i]=e;return function(e,t,r,n){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(r,t,n,i)}));return this.authenticate(r),this._orRejectOnClose(r)}decrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash]).then((r=>{let[n,i]=r;return function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(n,t,i,e)}));return this.authenticate(e),this._orRejectOnClose(r)}finish(){const e=this._salt.then((e=>f(e,new Uint8Array(0)))).then((e=>{let[t,r]=e;return Promise.all([p(t,["encrypt"]),p(r,["decrypt"])])})).then((e=>{let[t,r]=e;return new s.NoiseSocket(this._socket,t,r)}));return this._orRejectOnClose(e)}mixIntoKey(e){this._counter=0;const t=Promise.all([this._salt,e]).then((e=>{let[t,r]=e;return f(t,new Uint8Array(r))}));this._salt=t.then((e=>e[0])),this._cryptoKey=t.then((e=>p(e[1]))),_(this._salt),_(this._cryptoKey)}_orRejectOnClose(e){return Promise.race([e,this._rejectOnClose.promise]).then((e=>this._rejectOnClose.resolveWasCalled()?this._rejectOnClose.promise:e))}}},43891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseSocket=void 0;var n=r(27870);const i=Promise.reject("UNINITIALIZED HANDSHAKE"),a=new Uint8Array(0);i.catch((()=>{}));function o(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}t.NoiseSocket=class{constructor(e,t,r){this._incoming=[],this._readQueue=new n.PromiseQueue,this._sendQueue=new n.PromiseQueue,this._readCounter=0,this._writeCounter=0,this._draining=!1,this._sendCiphertextFrame=e=>{this._socket.closed?__LOG__(2)`NoiseSocket socket closed while encrypting frame`:this._socket.sendFrame(e)},this._handleCiphertext=e=>{const t=this._readCounter++;this._readQueue.enqueueHandlers(function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:o(t),additionalData:r?new Uint8Array(r):a},e,n)}(this._readKey,t,void 0,e),this._handlePlaintext)},this._handleOnClose=()=>{this._draining=!0,this._readQueue.wait().then((()=>{this._draining=!1;const e=this._onClose;e&&e()}))},this._handlePlaintext=e=>{this._onFrame?this._onFrame(e):this._incoming.push(e)},this._socket=e,this._writeKey=t,this._readKey=r,e.onFrame=this._handleCiphertext,this._socket.onClose=this._handleOnClose,e.convertBufferedToFrames()}sendFrame(e){if(this._draining)return;this._socket.throwIfClosed();const t=this._writeCounter++;var r,n,i,s;this._sendQueue.enqueueHandlers((r=this._writeKey,n=t,i=void 0,s=e,self.crypto.subtle.encrypt({name:"AES-GCM",iv:o(n),additionalData:i?new Uint8Array(i):a},r,s)),this._sendCiphertextFrame)}setOnFrame(e){this._onFrame=e}setOnClose(e){this._onClose=e}close(){this._socket.close()}}},44396:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleError=function(e){return a.parse(e),"NO_ACK"};var n=r(71914);const i=479,a=new n.WapParser("errorParser",(e=>{e.assertTag("error");const t=e.attrInt("code");switch(t){case i:return __LOG__(4,void 0,new Error,!0)`Invalid stanza sent (smax-invalid)`,void SEND_LOGS("smax-invalid");default:return function(e){__LOG__(4,void 0,new Error,!0)`Unknown error code: ${e}`,SEND_LOGS("unknown-error-code")}(t)}}))},48095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaConnParser=void 0;var n=r(2555);const i=new(r(71914).WapParser)("mediaConnParser",(e=>{var t,r;const n=e.child("media_conn");return{hosts:n.mapChildrenWithTag("host",o),authToken:n.attrString("auth"),authTTL:n.hasAttr("auth_ttl")?n.attrFutureTime("auth_ttl"):null,authExpires:n.attrFutureTime("ttl"),maxBuckets:n.hasAttr("max_buckets")?n.attrInt("max_buckets"):null,maxManualRetry:null!==(t=n.maybeAttrInt("max_manual_retry",0,4))&&void 0!==t?t:3,maxAutoDownloadRetry:null!==(r=n.maybeAttrInt("max_auto_download_retry",0,4))&&void 0!==r?r:3}}));function a(e){var t,r;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:null!==(t=e.maybeAttrString("fallback_ip4"))&&void 0!==t?t:void 0,ip6:null!==(r=e.maybeAttrString("fallback_ip6"))&&void 0!==r?r:void 0}}function o(e){var t,r,n,i;return{domain:e.attrString("hostname"),fallback:a(e),uploadable:s(e,"upload"),downloadable:s(e,"download"),isFallback:"fallback"===e.maybeAttrString("type"),downloadBuckets:null!==(t=null===(r=e.maybeChild("download_buckets"))||void 0===r?void 0:r.mapChildren((e=>parseInt(e.tag(),10))))&&void 0!==t?t:[],class:e.maybeAttrString("class"),ip4:null!==(n=e.maybeAttrString("ip4"))&&void 0!==n?n:void 0,ip6:null!==(i=e.maybeAttrString("ip6"))&&void 0!==i?i:void 0}}function s(e,t){return e.hasChild(t)?e.child(t).mapChildren((e=>{const t=e.tag();return(0,n.castToServerMediaType)(t)})).filter(Boolean):n.SERVER_MEDIA}t.mediaConnParser=i},50073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionSpec=t.SyncdValueSpec=t.SyncdSnapshotSpec=t.SyncdRecordSpec=t.SyncdPatchSpec=t.SyncdMutationsSpec=t.SyncdMutationSyncdOperation=t.SyncdMutationSpec=t.SyncdIndexSpec=t.KeyIdSpec=t.ExternalBlobReferenceSpec=t.ExitCodeSpec=void 0;var n=r(1390);const i=r(54302)({SET:0,REMOVE:1});t.SyncdMutationSyncdOperation=i;const a={};t.SyncdVersionSpec=a;const o={};t.ExitCodeSpec=o;const s={};t.SyncdIndexSpec=s;const l={};t.SyncdValueSpec=l;const c={};t.KeyIdSpec=c;const d={};t.SyncdRecordSpec=d;const u={};t.ExternalBlobReferenceSpec=u;const p={};t.SyncdSnapshotSpec=p;const f={};t.SyncdMutationsSpec=f;const _={};t.SyncdMutationSpec=_;const h={};t.SyncdPatchSpec=h,a.internalSpec={version:[1,n.TYPES.UINT64]},o.internalSpec={code:[1,n.TYPES.UINT64],text:[2,n.TYPES.STRING]},s.internalSpec={blob:[1,n.TYPES.BYTES]},l.internalSpec={blob:[1,n.TYPES.BYTES]},c.internalSpec={id:[1,n.TYPES.BYTES]},d.internalSpec={index:[1,n.TYPES.MESSAGE,s],value:[2,n.TYPES.MESSAGE,l],keyId:[3,n.TYPES.MESSAGE,c]},u.internalSpec={mediaKey:[1,n.TYPES.BYTES],directPath:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],fileSizeBytes:[4,n.TYPES.UINT64],fileSha256:[5,n.TYPES.BYTES],fileEncSha256:[6,n.TYPES.BYTES]},p.internalSpec={version:[1,n.TYPES.MESSAGE,a],records:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,d],mac:[3,n.TYPES.BYTES],keyId:[4,n.TYPES.MESSAGE,c]},f.internalSpec={mutations:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_]},_.internalSpec={operation:[1,n.TYPES.ENUM,i],record:[2,n.TYPES.MESSAGE,d]},h.internalSpec={version:[1,n.TYPES.MESSAGE,a],mutations:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_],externalMutations:[3,n.TYPES.MESSAGE,u],snapshotMac:[4,n.TYPES.BYTES],patchMac:[5,n.TYPES.BYTES],keyId:[6,n.TYPES.MESSAGE,c],exitCode:[7,n.TYPES.MESSAGE,o],deviceIndex:[8,n.TYPES.UINT32]}},381:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionValueSpec=t.SyncActionValue$UnarchiveChatsSettingSpec=t.SyncActionValue$SyncActionMessageSpec=t.SyncActionValue$SyncActionMessageRangeSpec=t.SyncActionValue$StarActionSpec=t.SyncActionValue$SecurityNotificationSettingSpec=t.SyncActionValue$RecentStickerWeightsActionSpec=t.SyncActionValue$RecentStickerMetadataSpec=t.SyncActionValue$RecentEmojiWeightsActionSpec=t.SyncActionValue$QuickReplyActionSpec=t.SyncActionValue$PushNameSettingSpec=t.SyncActionValue$PrimaryFeatureSpec=t.SyncActionValue$PinActionSpec=t.SyncActionValue$MuteActionSpec=t.SyncActionValue$MarkChatAsReadActionSpec=t.SyncActionValue$LocaleSettingSpec=t.SyncActionValue$LabelEditActionSpec=t.SyncActionValue$LabelAssociationActionSpec=t.SyncActionValue$KeyExpirationSpec=t.SyncActionValue$FavoriteStickerActionSpec=t.SyncActionValue$DeleteMessageForMeActionSpec=t.SyncActionValue$DeleteChatActionSpec=t.SyncActionValue$ContactActionSpec=t.SyncActionValue$ClearChatActionSpec=t.SyncActionValue$ArchiveChatActionSpec=t.SyncActionValue$AndroidUnsupportedActionsSpec=t.SyncActionDataSpec=t.RecentStickerWeightSpec=t.RecentEmojiWeightSpec=void 0;var n=r(1390),i=r(72493);const a={};t.RecentStickerWeightSpec=a;const o={};t.RecentEmojiWeightSpec=o;const s={};t.SyncActionValueSpec=s;const l={};t.SyncActionValue$AndroidUnsupportedActionsSpec=l;const c={};t.SyncActionValue$PrimaryFeatureSpec=c;const d={};t.SyncActionValue$KeyExpirationSpec=d;const u={};t.SyncActionValue$SyncActionMessageSpec=u;const p={};t.SyncActionValue$SyncActionMessageRangeSpec=p;const f={};t.SyncActionValue$UnarchiveChatsSettingSpec=f;const _={};t.SyncActionValue$DeleteChatActionSpec=_;const h={};t.SyncActionValue$ClearChatActionSpec=h;const g={};t.SyncActionValue$MarkChatAsReadActionSpec=g;const m={};t.SyncActionValue$DeleteMessageForMeActionSpec=m;const y={};t.SyncActionValue$ArchiveChatActionSpec=y;const E={};t.SyncActionValue$FavoriteStickerActionSpec=E;const S={};t.SyncActionValue$RecentEmojiWeightsActionSpec=S;const v={};t.SyncActionValue$RecentStickerMetadataSpec=v;const T={};t.SyncActionValue$RecentStickerWeightsActionSpec=T;const C={};t.SyncActionValue$LabelEditActionSpec=C;const A={};t.SyncActionValue$LabelAssociationActionSpec=A;const b={};t.SyncActionValue$QuickReplyActionSpec=b;const P={};t.SyncActionValue$LocaleSettingSpec=P;const M={};t.SyncActionValue$PushNameSettingSpec=M;const O={};t.SyncActionValue$SecurityNotificationSettingSpec=O;const I={};t.SyncActionValue$PinActionSpec=I;const w={};t.SyncActionValue$MuteActionSpec=w;const R={};t.SyncActionValue$ContactActionSpec=R;const D={};t.SyncActionValue$StarActionSpec=D;const N={};t.SyncActionDataSpec=N,a.internalSpec={filehash:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},o.internalSpec={emoji:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},s.internalSpec={timestamp:[1,n.TYPES.INT64],starAction:[2,n.TYPES.MESSAGE,D],contactAction:[3,n.TYPES.MESSAGE,R],muteAction:[4,n.TYPES.MESSAGE,w],pinAction:[5,n.TYPES.MESSAGE,I],securityNotificationSetting:[6,n.TYPES.MESSAGE,O],pushNameSetting:[7,n.TYPES.MESSAGE,M],quickReplyAction:[8,n.TYPES.MESSAGE,b],recentStickerWeightsAction:[9,n.TYPES.MESSAGE,T],recentStickerMetadata:[10,n.TYPES.MESSAGE,v],recentEmojiWeightsAction:[11,n.TYPES.MESSAGE,S],labelEditAction:[14,n.TYPES.MESSAGE,C],labelAssociationAction:[15,n.TYPES.MESSAGE,A],localeSetting:[16,n.TYPES.MESSAGE,P],archiveChatAction:[17,n.TYPES.MESSAGE,y],deleteMessageForMeAction:[18,n.TYPES.MESSAGE,m],keyExpiration:[19,n.TYPES.MESSAGE,d],markChatAsReadAction:[20,n.TYPES.MESSAGE,g],clearChatAction:[21,n.TYPES.MESSAGE,h],deleteChatAction:[22,n.TYPES.MESSAGE,_],unarchiveChatsSetting:[23,n.TYPES.MESSAGE,f],primaryFeature:[24,n.TYPES.MESSAGE,c],favoriteStickerAction:[25,n.TYPES.MESSAGE,E],androidUnsupportedActions:[26,n.TYPES.MESSAGE,l]},l.internalSpec={allowed:[1,n.TYPES.BOOL]},c.internalSpec={flags:[1,n.FLAGS.REPEATED|n.TYPES.STRING]},d.internalSpec={expiredKeyEpoch:[1,n.TYPES.INT32]},u.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,n.TYPES.INT64]},p.internalSpec={lastMessageTimestamp:[1,n.TYPES.INT64],lastSystemMessageTimestamp:[2,n.TYPES.INT64],messages:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,u]},f.internalSpec={unarchiveChats:[1,n.TYPES.BOOL]},_.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},h.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},g.internalSpec={read:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},m.internalSpec={deleteMedia:[1,n.TYPES.BOOL],messageTimestamp:[2,n.TYPES.INT64]},y.internalSpec={archived:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},E.internalSpec={directPath:[1,n.TYPES.STRING],lastUploadTimestamp:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],encFilehash:[4,n.TYPES.STRING],stickerHashWithoutMeta:[5,n.TYPES.STRING],mediaKey:[6,n.TYPES.STRING],mediaKeyTimestamp:[7,n.TYPES.INT64],isFavorite:[8,n.TYPES.BOOL]},S.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,o]},v.internalSpec={directPath:[1,n.TYPES.STRING],encFilehash:[2,n.TYPES.STRING],mediaKey:[3,n.TYPES.STRING],stanzaId:[4,n.TYPES.STRING],chatJid:[5,n.TYPES.STRING],participant:[6,n.TYPES.STRING],isSentByMe:[7,n.TYPES.BOOL]},T.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,a]},C.internalSpec={name:[1,n.TYPES.STRING],color:[2,n.TYPES.INT32],predefinedId:[3,n.TYPES.INT32],deleted:[4,n.TYPES.BOOL]},A.internalSpec={labeled:[1,n.TYPES.BOOL]},b.internalSpec={shortcut:[1,n.TYPES.STRING],message:[2,n.TYPES.STRING],keywords:[3,n.FLAGS.REPEATED|n.TYPES.STRING],count:[4,n.TYPES.INT32],deleted:[5,n.TYPES.BOOL]},P.internalSpec={locale:[1,n.TYPES.STRING]},M.internalSpec={name:[1,n.TYPES.STRING]},O.internalSpec={showNotification:[1,n.TYPES.BOOL]},I.internalSpec={pinned:[1,n.TYPES.BOOL]},w.internalSpec={muted:[1,n.TYPES.BOOL],muteEndTimestamp:[2,n.TYPES.INT64]},R.internalSpec={fullName:[1,n.TYPES.STRING],firstName:[2,n.TYPES.STRING]},D.internalSpec={starred:[1,n.TYPES.BOOL]},N.internalSpec={index:[1,n.TYPES.BYTES],value:[2,n.TYPES.MESSAGE,s],padding:[3,n.TYPES.BYTES],version:[4,n.TYPES.INT32]}},62109:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decryptCipherText=function(e,t,r){return(0,i.aesCbcDecrypt)(t,e,r)},t.generateAssociatedData=function(e,t){let r;switch(e){case s.SyncdMutationSyncdOperation.SET:r=l.OPERATION_SET_HEX;break;case s.SyncdMutationSyncdOperation.REMOVE:r=l.OPERATION_REMOVE_HEX}if(r){r=new Uint8Array([parseInt(r,16)]).buffer;const e=r,n=new Uint8Array(r.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),n.buffer}throw new Error("invalid mutation operation value")},t.generateCipherText=function(e,t,r){return(0,i.aesCbcEncrypt)(t,r,e)},t.generateEncryptionKeys=void 0,t.generateIndexMac=function(e,t){return(0,a.hmacSha256)(new Uint8Array(e),new Uint8Array(t))},t.generateMac=function(e,t,r){const n=new Uint8Array(l.OCTET_LENGTH);n.set([e.byteLength],n.byteLength-1);const i=(0,d.combine)([e,t,n.buffer]);return(0,a.hmacSha512)(r,i,l.MAC_LENGTH)},t.generatePadding=function(e,t){const r=Math.max(0,l.MAX_OF_MIN_DATA_LENGTH-e-t),n=new Uint8Array(r);return self.crypto.getRandomValues(n),n.buffer},t.generatePatchMac=function(e,t,r,n,i){return(0,a.hmacSha256)(e,(0,d.combine)([t,...r,n,i]))},t.generateSnapshotMac=function(e,t,r,n){return(0,a.hmacSha256)(e,(0,d.combine)([t,r,n]))},t.valueMacFromIndexAndValueCipherText=function(e){const t=e.byteLength;return new Uint8Array(e).slice(t-l.MAC_LENGTH).buffer};var n=r(15688),i=r(81484),a=r(11141),o=r(14950),s=r(50073),l=r(32458),c=r(40184),d=r(63109);const u=(0,o.memoizeWithArgs)(c.generateEncryptionKeysUnmemoized,n.encodeB64);t.generateEncryptionKeys=u},32458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_MAC_KEY_LENGTH=t.VALUE_MAC_KEY_END=t.VALUE_ENCRYPTION_KEY_LENGTH=t.VALUE_ENCRYPTION_KEY_END=t.SNAPSHOT_MAC_KEY_LENGTH=t.SNAPSHOT_MAC_KEY_END=t.PATCH_MAC_KEY_LENGTH=t.PATCH_MAC_KEY_END=t.OPERATION_SET_HEX=t.OPERATION_REMOVE_HEX=t.OCTET_LENGTH=t.MAX_OF_MIN_DATA_LENGTH=t.MAC_LENGTH=t.IV_LENGTH=t.INDEX_KEY_LENGTH=t.INDEX_KEY_END=t.HKDF_INFO=t.EMPTY_MUTATION_MAC=t.DERIVED_KEY_LENGTH=void 0;t.HKDF_INFO="WhatsApp Mutation Keys";t.DERIVED_KEY_LENGTH=160;t.INDEX_KEY_LENGTH=32;t.VALUE_ENCRYPTION_KEY_LENGTH=32;t.VALUE_MAC_KEY_LENGTH=32;t.SNAPSHOT_MAC_KEY_LENGTH=32;t.PATCH_MAC_KEY_LENGTH=32;t.INDEX_KEY_END=32;t.VALUE_ENCRYPTION_KEY_END=64;t.VALUE_MAC_KEY_END=96;t.SNAPSHOT_MAC_KEY_END=128;t.PATCH_MAC_KEY_END=160;t.OPERATION_SET_HEX="0x01";t.OPERATION_REMOVE_HEX="0x02";t.MAX_OF_MIN_DATA_LENGTH=0;t.MAC_LENGTH=32;t.OCTET_LENGTH=8;t.IV_LENGTH=16;const r=new ArrayBuffer(32);t.EMPTY_MUTATION_MAC=r},40184:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEncryptionKeysUnmemoized=function(){return s.apply(this,arguments)};var i=n(r(11504)),a=r(81576),o=r(32458);function s(){return(s=(0,i.default)((function*(e){const t=yield l(e);return{indexKey:t.slice(0,o.INDEX_KEY_END),valueEncryptionKey:t.slice(o.INDEX_KEY_END,o.VALUE_ENCRYPTION_KEY_END),valueMacKey:t.slice(o.VALUE_ENCRYPTION_KEY_END,o.VALUE_MAC_KEY_END),snapshotMacKey:t.slice(o.VALUE_MAC_KEY_END,o.SNAPSHOT_MAC_KEY_END),patchMacKey:t.slice(o.SNAPSHOT_MAC_KEY_END,o.PATCH_MAC_KEY_END)}}))).apply(this,arguments)}function l(e){return(0,a.extractAndExpand)(e,o.HKDF_INFO,o.DERIVED_KEY_LENGTH)}},63109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16))).toString().replace(/,/g," ")},t.arrayBufferToHexPadded=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")},t.combine=function(e){if(0===e.length)throw new Error("buffers length is zero");if(1===e.length)return e[0];const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let n,i=0;for(n=0;n<e.length;n++)r.set(new Uint8Array(e[n]),i),i+=e[n].byteLength;return r.buffer},t.hexToUint8Array=function(e){return Uint8Array.from(e.split(" ").map((e=>parseInt(e,16))))},t.split=function(e,t,r){if(t<0||r<0)throw new Error("buffers length is zero");const n=new Array(3),i=new Uint8Array(e);return n[0]=i.slice(0,t).buffer,n[1]=i.slice(t,t+r).buffer,n[2]=i.slice(t+r).buffer,n},t.to64BitNetworkOrder=function(e){const t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t},t.toUtf8=function(e){return r.encode(e)};const r=new TextEncoder},97245:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(e){return(0,u.redeemPrivateStatsToken)().then((t=>t?{result:t}:g(e).then((e=>{const t=(0,i.default)({},e),{result:r}=e;return r?(0,u.savePrivateStatsToken)(r).then((()=>t)):t}))))},t.issuePrivateStatsToken=g;var i=n(r(73982)),a=r(8584),o=r(36184),s=r(11609),l=r(72287),c=r(92844),d=r(47957),u=r(11562),p=r(31914),f=r(71914),_=r(14462);const h=new f.WapParser("issuePrivateStatsToken",(e=>{const t=e.child("sign_credential");return{signedCredential:t.child("signed_credential").contentBytes(),acsPublicKey:t.child("acs_public_key").contentBytes()}}));function g(e){const t=(0,c.monotonicTime)(),r={overallStartTime:t,retryStartTime:t,retryAttemptsLeft:3},n=new Uint8Array(32);self.crypto.getRandomValues(n);const u=new Uint8Array(32);self.crypto.getRandomValues(u);const f=(0,d.blindToken)(n,u),g=new l.PromiseRetryLoop({name:"issuePrivateStatsToken",timer:{algo:{type:"exponential",first:250},max:1e3},code:t=>{r.retryAttemptsLeft<3&&(r.retryStartTime=(0,c.monotonicTime)());const l=(0,p.wap)("iq",{xmlns:"privatestats",id:(0,p.generateId)(),type:"get",to:p.S_WHATSAPP_NET},(0,p.wap)("sign_credential",{version:"1"},(0,p.wap)("blinded_credential",null,f)));return(e||o.sendIqWithoutRetry)(l,h).then((e=>{if(!e.success){const n=function(e){switch(e.errorCode){case 400:return"bad-request";case 500:return"internal-server-error";case 501:return"feature-not-implemented";case 503:return"service-unavailable";default:return"unknown"}}(e);return __LOG__(3)`issuePrivateStatsToken: failed ${n}`,void("internal-server-error"!==n||r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:n})}):r.retryAttemptsLeft--)}const{signedCredential:o,acsPublicKey:s}=e.result,l=(0,d.unblindToken)(o,u,s);if(null==l)return __LOG__(3)`issuePrivateStatsToken: failed to unblind the signed token`,void t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"decryption-error"})});const c=a.Binary.build(n,l),p=(0,_.hash)(c.readByteArray());t({result:{token:n,sharedSecret:p},metric:(0,i.default)((0,i.default)({},r),{},{result:"success"})})})).catch((e=>{if(!(e instanceof s.Disconnected))return Promise.reject(e);__LOG__(3)`issuePrivateStatsToken: Disconnected`,r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"disconnected"})}):r.retryAttemptsLeft--}))}});return g.start(),g.promise()}},14604:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFinishedPrivateStatsBuffers=function(e){return(0,c.getFinishedStreamBuffers)("private").then((t=>v(t,e)))},t.upload_UNSAFE_INTERNAL_DO_NOT_USE=v;var i=n(r(11504)),a=r(15688),o=r(11141),s=r(72287),l=r(92844),c=r(11562);const d="https://dit.whatsapp.net/deidentified_telemetry",u="245118376424571|3e7d275052f1522bf3200afcf53841a7",p="WAMEventBuffer.dat",f=111e3,_=3067002,h=3067003,g=3067004;function m(e){return{result:e.result,httpResponseCode:e.httpResponseCode,uploadTime:(0,l.monotonicTimeSince)(e.uploadStartTime)}}function y(){return(y=(0,i.default)((function*(e,t,r,n){if((yield(0,c.privateStatsKillSwitchGetBlockedToken)())===u)return __LOG__(2)`Removing private stats buffer without submitting it (kill switch)`,(0,c.removeBufferByKey)(r.key).then((()=>{e()}));const i=(0,l.monotonicTime)(),s=yield n();if(null==s)return __LOG__(4,void 0,new Error)`Couldn't get token to submit a private stats buffer`,void e();const f=new FormData;f.append("access_token",u);const _=yield(0,o.hmacSha256)(s.sharedSecret,r.content),h=(0,a.encodeB64UrlSafe)(s.token,!0),g=(0,a.encodeB64UrlSafe)(_,!0);let m;f.append("credential",`${h}+${g}`),f.append("message",new Blob([r.content],{type:"application/octet-stream"}),p),f.append("meta_data",JSON.stringify({t:(0,l.unixTime)(),p:0}));try{m=yield fetch(d,{method:"POST",body:f,"Content-Type":"multipart/form-data"})}catch(e){return __LOG__(3)`Upload of a private stats buffer failed: ${e}`,void t({uploadStartTime:i,result:"error-other"})}const y=m.status,S=t=>{e({uploadStartTime:i,httpResponseCode:y,result:t})},v=e=>{t({uploadStartTime:i,httpResponseCode:y,result:e})};switch(y){case 200:return(0,c.removeBufferByKey)(r.key).then((()=>{S("success")}));case 429:return void S("error-server-other");case 401:return Promise.all([(0,c.privateStatsKillSwitchSet)(u),(0,c.removeBufferByKey)(r.key)]).then((()=>{S("error-access-token")}));case 400:{const{result:r,shouldRetry:n}=yield E(m),a={uploadStartTime:i,httpResponseCode:y,result:r};return void("retry"===n?t(a):e(a))}case 500:return void v("error-server-other")}__LOG__(3)`Unsupported response status code from PrivateStats upload request: ${y}`,v("error-other")}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=yield e.json().catch((()=>{}));if("object"!=typeof t)return __LOG__(3)`Unable to parse error response 400 from PrivateStats upload request or parsed response is not an object`,{result:"error-other",shouldRetry:"retry"};const{error:r}=t;if("object"!=typeof r)return __LOG__(3)`Incorrect or missing error entry in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};const{code:n,error_subcode:i}=r;if("number"!=typeof n||"number"!=typeof i)return __LOG__(3)`Incorrect code or subcode in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};switch(n){case 9:return{result:"error-server-other",shouldRetry:"no-retry"};case f:switch(i){case _:return{result:"error-parsing",shouldRetry:"retry"};case h:return{result:"error-decoding",shouldRetry:"retry"};case g:return{result:"error-credential",shouldRetry:"retry"};default:return __LOG__(3)`Unsupported subcode value in the error response 400 from PrivateStats upload request: ${i}`,{result:"error-other",shouldRetry:"retry"}}default:return __LOG__(3)`Unsupported code value in the error response 400 from PrivateStats upload request: ${n}`,{result:"error-other",shouldRetry:"retry"}}}))).apply(this,arguments)}function v(e,t){const r=e.map((e=>{let r=3;const n=[],i=new s.PromiseRetryLoop({name:"uploadPrivateStatsBuffer",timer:{algo:{type:"exponential",first:250},max:1e3},code:i=>function(){return y.apply(this,arguments)}(i,(e=>{const t=m(e);n.push(t),r<=0?i():r--}),e,t)});return i.start(),i.promise().then((t=>{if(null!=t){const e=m(t);n.push(e)}return{uploadedBufferKey:"success"===(null==t?void 0:t.result)?e.key:null,metrics:n}}))}));return Promise.all(r).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.metrics),e)),[]);return{uploadedBufferKeys:e.reduce(((e,t)=>(null!=t.uploadedBufferKey&&e.push(t.uploadedBufferKey),e)),[]),metrics:t}}))}},2486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_HANDLED=t.DynamicRouter=void 0;const r={sentinel:"RESPONSE_NAMESPACE"},n={sentinel:"NOT_HANDLED"};t.NOT_HANDLED=n;function i(e,t){const n=t.namespace;return n===r?a:e.get(n)}function a(e,t,r){r(t)}function o(e){if(null!=e&&("object"==typeof e||"function"==typeof e)){const t=e.then;return"function"==typeof t?t:null}return null}t.DynamicRouter=class{constructor(){var e=this;this._basePromise=Promise.resolve(),this._handlers=new Map,this._handlerChangeCount=0,this._firstRoute=null,this._nextRoute=null,this._lastRoute=null,this.fireAndForget=function(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e._schedule(t,r,n,null,i)},this.sendAndReceive=function(t,n,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(((s,l)=>{e._schedule(t,n,i,(t=>{try{const n=o(t);n?n.call(t,(t=>{e._schedule(r,"",t,s,a)}),(t=>{e._schedule(r,"",t,l,!1)})):e._schedule(r,"",t,s,a)}catch(t){e._schedule(r,"",t,l,!1)}}),a)}))},this._run=()=>{let e=this._nextRoute;if(!e)return;const t=this._handlers;let r;for(;e&&!(r=i(t,e));)this._nextRoute=e=e.nextRoute;if(!e||!r)return;const a=this._runHandler(r,e);let o=!0;if(a!==n){const t=e.prevRoute,r=e.nextRoute;this._nextRoute===e&&(this._nextRoute=r),t?t.nextRoute=r:this._firstRoute=r,r?r.prevRoute=t:(o=!1,this._lastRoute=t)}return o&&this._basePromise.then(this._run),a}}hasHandlerForNamespace(e){return this._handlers.has(e)}getHandledNamespaces(){return Array.from(this._handlers.keys())}setNamespaceHandler(e,t){const r=this._handlers,n=r.get(e);if(n!==t&&(++this._handlerChangeCount,r.set(e,t),!n)){const e=this._firstRoute;e&&(this._nextRoute||this._basePromise.then(this._run),this._nextRoute=e)}}setHandlers(e,t){this.setNamespaceHandler(e,(function(e,r,n){const i=t[e](r);n&&n(i)}))}_schedule(e,t,r,n,a){const o=this._lastRoute,s={namespace:e,route:t,arg:r,resolver:n,prevRoute:o,nextRoute:null,silentLog:a};this._lastRoute=s;let l=!0;o?(o.nextRoute=s,l=!this._nextRoute):this._firstRoute=s,l&&i(this._handlers,s)&&(this._nextRoute=s,this._basePromise.then(this._run))}_runHandler(e,t){const{route:r,arg:i,resolver:a,silentLog:o}=t,s=this._handlerChangeCount;let l=null,c=null;try{l=e(r,i,a,o)}catch(e){c=Promise.reject(e)}if(l===n){if(s!==this._handlerChangeCount)return n;c=Promise.reject(new Error("DynamicRouter: NOT_HANDLED can only be used when updating handlers"))}if(!a)return c;c&&a(c)}}},81484:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.AesCbcStream=void 0,t.aesCbcDecrypt=_,t.aesCbcDecryptSplit=function(e,t){return Promise.resolve().then((()=>{const r=t.slice(0,16),n=t.slice(16);return _(e,r,n)}))},t.aesCbcEncrypt=function(e,t,r){return Promise.resolve().then((()=>{const n=p(r),i=d(n);return Promise.resolve(u(e)).then((e=>self.crypto.subtle.encrypt(i,e,t))).then((e=>(0,s.concatTypedArrays)(Uint8Array,[n,new Uint8Array(e)]).buffer))}))},t.aesCbcEncryptWithChunking=function(){return h.apply(this,arguments)};var i=n(r(11504)),a=r(8584),o=r(46269),s=r(60977);const l=16,c=16777216;function d(e){return{name:"AES-CBC",iv:(0,o.castTypedArrays)(Uint8Array,e)}}function u(e){return self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function p(e){if(e)return(0,o.castTypedArrays)(Uint8Array,e);const t=new Uint8Array(16);return self.crypto.getRandomValues(t),t}function f(e){const t=e.byteLength,r=l-t%l;return Number.isNaN(r)?t:t+r}function _(e,t,r){const n=d(t);return Promise.resolve(self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then((e=>self.crypto.subtle.decrypt(n,e,r)))}function h(){return(h=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;if(n%l!=0)throw new Error(`chunkSize must be a multiple of 16, ${n} received`);const i=yield u(e),a=new Uint8Array(t),o=Math.ceil(a.byteLength/n),s=p(r),_=new Uint8Array(f(a)+s.byteLength);_.set(s);for(let e,t,r=0,l=s;r<o;r++){const c=r===o-1,u=r*n;e=a.subarray(u,u+n),t=yield self.crypto.subtle.encrypt(d(l),i,e).then((e=>c?new Uint8Array(e):new Uint8Array(e).subarray(0,-16))),_.set(t,s.byteLength+r*n),l=t.slice(-16)}return _.buffer}))).apply(this,arguments)}t.AesCbcStream=class{constructor(e,t,r,n){this._input=null,this._finished=!1,this._output=e,this._type=t,this._rawKey=r;const i={name:"AES-CBC",iv:n};this._promise=self.crypto.subtle.importKey("raw",r,"AES-CBC",!1,[t]).then((e=>({algo:i,key:e})))}append(e){let t;this._throwIfFinished("append");const r=this._input;if(r)if(r.writeByteArray(e),r.size()>1024){const e=r.size()%l;t=r.readByteArray(r.size()-e),r.size()||(this._input=null)}else t=null;else if(e.length>1024){const r=e.length%l;r?(this._input=new a.Binary(e),t=this._input.readByteArray(e.length-r)):t=e}else this._input=new a.Binary(e),t=null;const n=t;return n&&(this._promise=this._promise.then((e=>{let{key:t,algo:r}=e;if("encrypt"===this._type)return self.crypto.subtle.encrypt(r,t,n).then((e=>(this._output.writeByteArray(new Uint8Array(e,0,e.byteLength-l)),new Uint8Array(e,e.byteLength-32,l))));{const e=n.slice(-16);return self.crypto.subtle.decrypt(r,t,n).then((t=>(this._output.writeBuffer(t),e)))}})).then((e=>{const t={name:"AES-CBC",iv:e};return self.crypto.subtle.importKey("raw",this._rawKey,"AES-CBC",!1,[this._type]).then((e=>({algo:t,key:e})))}))),this._promise.then((()=>{}))}finalize(e){let t;if(this._throwIfFinished("finalize"),this._input?(e&&this._input.writeByteArray(e),t=this._input.readByteArray(),this._input=null):e&&(t=e),t){const e=t;return this._promise.then((t=>{let{algo:r,key:n}=t;return"encrypt"===this._type?self.crypto.subtle.encrypt(r,n,e):self.crypto.subtle.decrypt(r,n,e)})).then((e=>{this._output.writeBuffer(e)}))}return this._promise.then((()=>{}))}_throwIfFinished(e){if(this._finished)throw new Error(`AesCbcStream.${e} called after finalize`)}}},30141:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocate=o,t.elligator=C,t.fieldElement=s,t.hashSha512=function(e,t,r){n.lowlevel.crypto_hash(e,t,r)},t.hashToPoint=function(e){return a((()=>function(e){const{unpack25519:t}=n.lowlevel,r=(0,n.hash)(e),i=(128&r[31])>>7;r[31]&=127;const a=s();t(a,r);const l=s();C(l,a);const c=u();!function(e,t,r){const{unpack25519:i,M:a}=n.lowlevel,l=s();i(l,v);const c=s();!function(e,t){const{Z:r,A:i,M:a}=n.lowlevel,o=d(),l=s(),c=s(),u=s();r(l,t,o),i(c,t,o),b(u,c),a(e,l,u)}(c,t);const u=s();h(u,t);const p=s();!function(e,t){const{unpack25519:r,pow2523:i,M:a,S:o}=n.lowlevel,l=s();r(l,m);const c=s();i(c,t);const d=s();a(d,t,c);const u=s();o(u,d);const p=s();a(p,d,l),g(d,p,1^(f=u,_=t,P(f,_)?0:1)),e.set(d);var f,_}(p,u);const f=s();a(f,t,l);const _=s();b(_,p);const E=s();a(E,f,_);const S=s();y(S,E),g(E,S,function(e){const{pack25519:t}=n.lowlevel,r=o(Uint8Array,32);return t(r,e),1&r[0]}(E)^r),e[0].set(E),e[1].set(c),e[2].set(d()),a(e[3],e[0],e[1])}(c,l,i);const f=u();return function(e,t){const r=[s(),s(),s(),s()],i=p();(function(e,t){const r=p();(function(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])})(r,t),S(e,r)})(r,t),E(i,r),S(r,i),E(i,r),S(r,i),function(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3]),r(e[3],t[0],t[1])}(e,r)}(f,c),f}(e)))},t.inv25519=b,t.modL=l,t.p3Element=u,t.pack=A,t.reduce=function(e,t){for(let r=0;r<64;++r)t[r]=e[r],e[r]=0;l(e,t),t.fill(0)},t.runInAllocationScope=a,t.scalarmultBase=function(e,t){const r=[s(),s(),s(),s()];n.lowlevel.scalarbase(r,t),A(e,r)},t.unpack=function(e,t){const r=u();if(0!==M(r,t))return-1;return function(e,t){y(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),y(e[3],t[3])}(e,r),0},t.unpackneg=M;var n=r(14462);let i=null;function a(e){const t=i;i=[];try{return e()}finally{var r;(null!==(r=i)&&void 0!==r?r:[]).forEach((e=>{e.fill(0)})),i=t}}function o(e,t){if(null==i)throw new Error("allocate called outside of active scope");return new e(t)}function s(e){const t=o(Float64Array,16);if(e){if(e.length>16)throw new Error("Incorrect initialiser array provided to the fieldElement");for(let r=0;r<e.length;r++)t[r]=e[r]}return t}function l(e,t){n.lowlevel.modL(e,t)}const c=()=>s([0]),d=()=>s([1]);function u(){return[s(),s(),s(),s()]}function p(){return[s(),s(),s()]}function f(e,t){let r=0,n=t;for(;n>0;){const t=n%65536;e[r]=t,n=(n-t)/65536,r++}}function _(e,t){const{S:r,M:i}=n.lowlevel,a=s([2]),o=s();r(o,t),i(e,a,o)}function h(e,t){const{S:r,M:i,A:a}=n.lowlevel,o=c(),l=d(),u=s(),p=s(),_=s(),h=s();f(o,486662),r(u,t),i(p,o,t),a(_,u,p),a(h,_,l),i(e,t,h)}function g(e,t,r){1===r&&e.set(t)}const m=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function y(e,t){const{Z:r}=n.lowlevel;r(e,c(),t)}function E(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3])}function S(e,t){const{S:r,A:i,Z:a}=n.lowlevel;r(e[0],t[0]),r(e[2],t[1]),_(e[3],t[2]),i(e[1],t[0],t[1]);const o=s();r(o,e[1]),i(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],o,e[1]),a(e[3],e[3],e[2])}const v=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function T(e,t){const{M:r,A:i}=n.lowlevel,a=d(),o=c();f(o,486662);const l=s();_(l,t);const u=s();i(u,l,a);const p=s();b(p,u);const m=s();r(m,p,o);const E=s();y(E,m);const S=s();h(S,E);const v=function(e){const{S:t,M:r,pow2523:i,pack25519:a}=n.lowlevel,o=s(),l=s(),c=s(),d=s(),u=s();i(o,e),t(l,o),t(c,l),r(d,c,e),r(u,d,e);const p=new Uint8Array(32);return a(p,u),1&p[31]}(S),T=s([0]);g(T,o,v);const C=s();i(C,E,T);const A=s();y(A,C),g(C,A,v),e.set(C)}function C(e,t){return a((()=>T(e,t)))}function A(e,t){const r=s(),i=s(),a=s(),{M:o,pack25519:l}=n.lowlevel;b(a,t[2]),o(r,t[0],a),o(i,t[1],a),l(e,i);const c=new Uint8Array(32);l(c,r),e[31]^=(1&c[0])<<7}function b(e,t){const r=s();r.set(t);const{M:i,S:a}=n.lowlevel;for(let e=253;e>=0;--e)a(r,r),2!==e&&4!==e&&i(r,r,t);e.set(r)}function P(e,t){const{pack25519:r,crypto_verify_32:i}=n.lowlevel,a=new Uint8Array(32),o=new Uint8Array(32);return r(a,e),r(o,t),i(a,0,o,0)}function M(e,t){const{set25519:r,S:i,M:a,Z:o,A:l,D:u,unpack25519:p,pow2523:f}=n.lowlevel,_=s(),h=s(),g=s(),m=s(),y=s(),E=s(),S=s();return r(e[2],d()),p(e[1],t),i(g,e[1]),a(m,g,u),o(g,g,e[2]),l(m,e[2],m),i(y,m),i(E,y),a(S,E,y),a(_,S,g),a(_,_,m),f(_,_),a(_,_,g),a(_,_,m),a(_,_,m),a(e[0],_,m),i(h,e[0]),a(h,h,m),P(h,g)&&a(e[0],e[0],s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])),i(h,e[0]),a(h,h,m),P(h,g)?-1:(function(e){const{pack25519:t}=n.lowlevel,r=new Uint8Array(32);return t(r,e),1&r[0]}(e[0])===t[31]>>7&&o(e[0],c(),e[0]),a(e[3],e[0],e[1]),0)}},81576:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand=o,t.extractAndExpand=function(e,t,r){return(0,i.extractSha256)(null,e).then((e=>o(new Uint8Array(e),t,r)))},t.extractWithSaltAndExpand=function(e,t,r,n){return(0,i.extractSha256)(t,e).then((e=>o(new Uint8Array(e),r,n)))};var n=r(8584),i=r(11141);const a=255*i.SHA256_BYTE_LENGTH;function o(e,t,r){if(r<0||r>a)return Promise.reject(new Error(`HKDF::expand given bad length ${r}`));let o;const s=Math.ceil(r/i.SHA256_BYTE_LENGTH),l=n.Binary.build(t).readByteArray(),c=new n.Binary;let d=(0,i.encodeKeySha256)(e).then((e=>(o=e,new Uint8Array(0))));for(let e=1;e<=s;e++)d=d.then((t=>(0,i.sign)(o,n.Binary.build(t,l,e).readByteArray()))).then((e=>{const t=new Uint8Array(e);return c.writeByteArray(t),t}));return d.then((()=>c.readBuffer(r)))}},11141:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA256_BYTE_LENGTH=t.DEFAULT_SALT=void 0,t.encodeKeySha256=function(e){return l(a,e)},t.extractSha256=function(e,t){return l(a,null!=e?e:i).then((e=>c(e,t)))},t.hmacSha1=function(e,t,r){return l(s,e).then((e=>c(e,t,r)))},t.hmacSha256=function(e,t,r){return l(a,e).then((e=>c(e,t,r)))},t.hmacSha512=function(e,t,r){return l(o,e).then((e=>c(e,t,r)))},t.sign=c;var n=r(46269);t.SHA256_BYTE_LENGTH=32;const i=new Uint8Array(32);t.DEFAULT_SALT=i;const a={name:"HMAC",hash:"SHA-256"},o={name:"HMAC",hash:"SHA-512"},s={name:"HMAC",hash:"SHA-1"};function l(e,t){const r=(0,n.castTypedArrays)(Uint8Array,t);return self.crypto.subtle.importKey("raw",r,e,!1,["sign"]).then((t=>({key:t,algo:e})))}function c(e,t,r){let{key:n,algo:i}=e;return self.crypto.subtle.sign(i,n,t).then((e=>null!=r&&0!==r?e.slice(0,r):e))}},899:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.LtHash16=t.LT_HASH_ANTI_TAMPERING=t.KEY_LENGTH_BYTES=t.EMPTY_LT_HASH=void 0;var i=n(r(11504)),a=r(81576);const o=128;t.KEY_LENGTH_BYTES=o;const s=new ArrayBuffer(o);t.EMPTY_LT_HASH=s;class l{constructor(e){this.salt=e}add(e,t){var r=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return r._addSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtract(e,t){var r=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return r._subtractSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtractThenAdd(e,t,r){var n=this;return(0,i.default)((function*(){return n.add(yield n.subtract(e,r),t)}))()}_addSingle(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,a.extractAndExpand)(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e+t))}))()}_subtractSingle(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,a.extractAndExpand)(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e-t))}))()}performPointwiseWithOverflow(e,t,r){const n=new DataView(e),i=new DataView(t),a=new ArrayBuffer(n.byteLength),o=new DataView(a);for(let e=0;e<n.byteLength;e+=2)o.setUint16(e,r(n.getUint16(e,!0),i.getUint16(e,!0)),!0);return a}}t.LtHash16=l;const c=new l("WhatsApp Patch Integrity");t.LT_HASH_ANTI_TAMPERING=c},73045:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha256=i,t.sha256Base64=function(e){return Promise.resolve(i(e).then(n.encodeB64))};var n=r(15688);function i(e){return Promise.resolve(self.crypto.subtle.digest({name:"SHA-256"},e))}},7589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areBuffersEqual=function(e,t){return i(new Uint8Array(e),new Uint8Array(t))},t.areBytesEqual=i,t.randomNumberLessThan=function(e){if(e!==(0|e))throw new Error("bound must be int32");if(e<=0)throw new Error("bound must not be positive");const t=new Int32Array(1),r=e*Math.floor((-1>>>1)/e);let n=-1;for(;-1===n;){self.crypto.getRandomValues(t);const i=t[0]>>>1;i<r&&(n=i%e)}return n};var n=r(14462);function i(e,t){return 0===e.length&&0===t.length||(0,n.verify)(e,t)}},96573:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageIds=function(e,t){if(null!=t){const r=new Set;[e.ids,t].forEach((e=>e.forEach((e=>{r.has(e)||r.add(e)})))),e.ids=Array.from(r.values())}},t.buildEntry=function(e,t){if(!e||0===e.length)throw new Error("FtsIndexEntry: Expected non-empty blindIndices in constructor");return{ids:(0,i.default)(t,"ids"),prefixes:e,token:e[e.length-1]}};var i=n(r(45095))},44152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,token:r,timestamp:n}}},14056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildDBEntry=function(e,t,r,n,i){return{ftsRowId:e,id:t,chatId:r,timestamp:n,prefixes:i}},t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,timestamp:r,prefixes:n}}},74391:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getJidUtilsApi=function(){return function(){if(null==i)throw new Error("Globals called before set");return i}().jidUtils},t.setGlobals=a;var n=r(52230);let i=null;function a(e){i=e}a({jidUtils:(0,n.createJidUtils)({platform:"whatsapp"})})},18269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsatisfiableJobRequirement=t.JobRequirement=void 0,t.joinRequirements=function(e,t){const r=e.filter((e=>!e.isSatisfiable()));if(r.length>0){const e=r.map((e=>e.name));return n=>(null==t||t("unsatisfiable",e,n),r[0].waitUntilSatisfied())}let n=e.map((()=>Promise.resolve())),i=Promise.resolve(),a=null;const o=()=>{if(n.every(((t,r)=>t===e[r].waitUntilSatisfied())))return void(a=null);const t=[],r=e.map((e=>{const r=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),r.then((()=>{const r=t.indexOf(e.name);t.splice(r,1)}))),r}));return n=r,a=t,Promise.all(r).then(o)};return e=>{if(null==a){const e=o();null!=e&&(i=i.then((()=>e)))}return null==t||t(null==a?"satisfied":"unsatisfied",a,e),i}};class r{constructor(e){this._waitingOn=Promise.resolve(),this._satisfied=!0,this._newBlockers=null,this._blockersFinished=()=>{const e=this._newBlockers;if(null!=e)return this._newBlockers=null,Promise.all(e).then(this._blockersFinished);this._satisfied=!0},this.name=e}addBlocker(e){const t=e.catch((e=>{__LOG__(4,void 0,new Error,!0)`JobRequirement[${this.name}] blocker errored ${e}`,SEND_LOGS("job-blocker-rejected")}));if(this._satisfied)this._satisfied=!1,this._waitingOn=Promise.all([this._waitingOn,t]).then(this._blockersFinished);else{const e=this._newBlockers;null!=e?e.push(t):this._newBlockers=[t]}}waitUntilSatisfied(){return this._waitingOn}isSatisfied(){return this._satisfied}isSatisfiable(){return!0}}t.JobRequirement=r;t.UnsatisfiableJobRequirement=class extends r{constructor(e){super(e),super.addBlocker(new Promise((()=>{})))}addBlocker(){}isSatisfiable(){return!1}}},47901:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTARTED_JOB=t.RetryOnBackoff=t.RequiresPage=t.PersistedJobManager=t.InterruptJob=t.FINISHED_JOB=void 0;var i=n(r(11504)),a=r(18269),o=r(37178),s=r(92844);class l{constructor(e){this.feature=e}toString(){return`RequiresPage: ${this.feature}`}}t.RequiresPage=l;class c{constructor(e){this.backoffOptions=e}toString(){return"RetryOnBackoff"}}t.RetryOnBackoff=c;class d{constructor(e){this.result=e}}t.InterruptJob=d;const u="$unstarted";t.UNSTARTED_JOB=u;const p="$finished";t.FINISHED_JOB=p;function f(e){return`Job[${e.jobId}] (${e.type})`}function _(e){return`Job[${e.jobId}] (${e.type}.${e.step})`}function h(e,t,r){"unsatisfiable"===e?__LOG__(2)`${_(r)} halting because of ${t}`:"unsatisfied"===e&&__LOG__(2)`${_(r)} waiting on ${t}`}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{jobStartTime:e.startTime,afterCrash:t,interruptJob:m}}function m(e){return new d(e)}t.PersistedJobManager=class{constructor(e){const{isRestartAfterCrash:t,accessors:r,unfinishedJobEntries:n}=e,i=new Map,a=n.then((e=>{const n=[],a=[];return e.forEach((e=>{e.stepHardStartCountAfterTimeout>=5?n.push(e):a.push(e)})),Promise.all(n.map((e=>{var t;return __LOG__(4,void 0,new Error,!0)`${t=e,`[Job ${t.type}] `}: stuck on the step ${e.step}, aborting the job`,SEND_LOGS(`job-stuck-${e.type}`),r.deletePersistedJob(e.jobId)}))).then((()=>{a.forEach((e=>{i.has(e.jobId)||(__LOG__(2)`${f(e)}: restarting`,i.set(e.jobId,this._runJob(e,t)))}))}))}));this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=r,this.activeJobs=i,this.initialJobsPromise=a,this.listeners=e.listeners,this.deprecatedJobs=e.deprecatedJobs}loadAndRunJobFromId(e){const t=this.activeJobs.get(e);if(null!=t)return t;const r=this._loadAndRunJobFromId(e);return this.activeJobs.set(e,r),r}_loadAndRunJobFromId(e){var t=this;return(0,i.default)((function*(){const{initialJobsPromise:r,accessors:n}=t;yield r;const i=yield n.readPersistedJob(e);return i?t._runJob(i,!1):(__LOG__(4,void 0,new Error,!0)`No entry for job ${e}`,SEND_LOGS("missing-job-entry"),null)}))()}_getJobImplementation(e){const{implementations:t,implementationLoaders:r}=this,n=t.get(e);if(n)return n;const i=r.get(e);if(!i)return null;const a=i();return t.set(e,a),a}_waitForBlockers(e,t){if(null==t||0===t.length)return Promise.resolve();const{stepBlockers:r}=this;let n=r.get(t);return null==n&&(n=(0,a.joinRequirements)(t.map((e=>e())),h),r.set(t,n)),n(e)}_runRemainingSteps(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const{step:i}=e,a=t.findIndex((e=>e.stepName===i)),{requirements:o,code:l}=t[a].info(e.current,e.original,g(e,r));let c=this._waitForBlockers(e,o);return n&&(c=c.then(n)),c.then((()=>(__LOG__(2)`${_(e)}: running step`,l(e.current,e.original,g(e,r))))).then((n=>{if(n instanceof d)return __LOG__(2)`${_(e)}: InterruptJob`,n.result;const i=a+1;if(i>=t.length)return n;const o=t[i];return e.step=o.stepName,e.current=n,e.stepHardStartCountAfterTimeout=0,e.stepFirstStartTime=(0,s.unixTime)(),e.stepUnexpectedErrorCount=0,e.waitUntil=null,e.backedOffCount=0,this.accessors.updatePersistedJob(e).then((()=>this._runRemainingSteps(e,t,r)))}))}_runJob(e,t){var r=this;return(0,i.default)((function*(){var n;const{accessors:a,activeJobs:d,deprecatedJobs:h,listeners:{onJobFinished:m,onJobStarted:y}}=r,E=yield r._getJobImplementation(e.type);if(!E)return h.includes(e.type)?__LOG__(3)`No implementation for deprecated ${e.type}, job deleted`:(__LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}. Maybe it should have been put to the deprecated list?`,SEND_LOGS("missing-job-implementation")),yield a.deletePersistedJob(e.jobId),null;h.includes(e.type);const S=null!==(n=e.stepFirstStartTime)&&void 0!==n?n:(0,s.unixTime)();if(e.stepFirstStartTime=S,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===p){let t=e.waitUntil;const n=(0,s.secondsUntil)(S);return null!=t&&(0,s.isInFuture)(t)&&n>0&&(__LOG__(2)`${f(e)}: skew detected, adjusting accordingly`,t=(0,s.castToUnixTime)(t-n),(0,s.isInFuture)(t)&&(e.stepFirstStartTime=(0,s.castToUnixTime)(S-n),e.waitUntil=t,yield r.accessors.updatePersistedJob(e))),null!=t&&(0,s.isInFuture)(t)||(__LOG__(2)`${f(e)}: removing completed, expired job from db`,yield a.deletePersistedJob(e.jobId)),d.delete(e.jobId),e.current}const v=e.step!==u?E.find((t=>t.stepName===e.step)):E[0];if(!v)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}.${e.step}`,SEND_LOGS("missing-job-step"),yield a.deletePersistedJob(e.jobId),null;e.step=v.stepName;const T=()=>{const n=e.waitUntil;let i=Promise.resolve();if(null!=n){const t=(0,s.futureUnixTime)(s.DAY_SECONDS);n>t?(__LOG__(2)`${_(e)}: trim wait from ${n} to ${t}`,e.waitUntil=t,i=r.accessors.updatePersistedJob(e).then((()=>(0,s.delayUntil)(t)))):(__LOG__(2)`${_(e)}: delaying until ${n}`,i=(0,s.delayUntil)(n))}return i.then((()=>r._runRemainingSteps(e,E,t,(()=>(e.waitUntil=null,(0,s.happenedWithin)(S,s.DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,r.accessors.updatePersistedJob(e)))).catch((t=>{if(t instanceof l)return __LOG__(2)`${_(e)}: requires page`,e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e)),new Promise((()=>{}));if(t instanceof c){__LOG__(2)`${_(e)}: RetryOnBackoff`;const n=(0,o.getDelay)(++e.backedOffCount,t.backoffOptions);return e.waitUntil=(0,s.futureUnixTime)(Math.ceil(n/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e).then(T)}if(e.stepUnexpectedErrorCount<1)return __LOG__(3)`${_(e)}: Unhandled exception. Tried ${e.stepUnexpectedErrorCount} times`,e.stepUnexpectedErrorCount++,r.accessors.updatePersistedJob(e).then(T);throw t}))))},C=T(),A=C.then(function(){var t=(0,i.default)((function*(t){__LOG__(2)`${_(e)}: finished job`;let n=null;try{n=m(e.jobId,e.type,e.original,t)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobFinished for ${e.type} threw exception ${t}`,SEND_LOGS("onJobFinished-threw")}null!=n&&n>0?(e.waitUntil=(0,s.futureUnixTime)(Math.ceil(n/1e3)),e.step=p,e.current=t,e.stepFirstStartTime=(0,s.unixTime)(),yield r.accessors.updatePersistedJob(e)):(yield a.deletePersistedJob(e.jobId),d.delete(e.jobId))}));return function(){return t.apply(this,arguments)}}(),function(){var r=(0,i.default)((function*(r){__LOG__(4,void 0,new Error,!0)`${e.type} failed with error ${r}`,SEND_LOGS(`job-threw-exception-${e.type}`);const n=E.find((t=>t.stepName===e.step));if(n){const r=n.info(e.current,e.original,g(e,t));null!=r.stopRetryIf&&(yield r.stopRetryIf.onStopRetry(e.current,e.original,g(e,t)))}else __LOG__(4,void 0,new Error)`${e.type}: ${e.step} step not found`;yield a.deletePersistedJob(e.jobId),d.delete(e.jobId)}));return function(){return r.apply(this,arguments)}}());try{y(e.jobId,e.type,e.original)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobStarted for ${e.type} threw exception ${t}`,SEND_LOGS("onJobStarted-threw")}return A.then((()=>C))}))()}addPersistedJobImplementation(e,t){const{implementationLoaders:r,deprecatedJobs:n}=this;if(r.has(e))return __LOG__(4,void 0,new Error,!0)`addPersistedJobImplementation called twice for ${e}`,void SEND_LOGS("repeat-job-loader");n&&n.includes(e),r.set(e,t)}fireAndForget(e){this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}waitUntilPersisted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;this.loadAndRunJobFromId(t)}))}waitUntilCompleted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}}},89385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=t.ABORT_ERROR=void 0,t.catchAbort=function(e){return t=>{if(t.name===a)return e(t);throw t}};var n=r(40265);class i extends((0,n.customError)("AbortError")){}t.AbortError=i;const a="AbortError";t.ABORT_ERROR=a},52613:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncSleep=o,t.asyncSleepAfterGivenLoopIteration=function(){return a.apply(this,arguments)};var i=n(r(11504));function a(){return(a=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e>0&&e%t==0&&(yield o(r))}))).apply(this,arguments)}function o(e){return new Promise((t=>setTimeout(t,e)))}},30844:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11504)),a=n(r(73982)),o=n(r(45095)),s=n(r(9006));t.default=class{constructor(e,t){this._concurrency=e,this._groupLimits=t,this._runningTasksByGroup=new Map,this._enqueuedTasksByGroup=new Map}clearQueue(){this._enqueuedTasksByGroup.clear(),this._runningTasksByGroup.clear()}enqueue(e,t){let r,n;const o=new Promise(((e,t)=>{r=e,n=t}));var s;return this._doEnqueue((0,a.default)((0,a.default)({},t),{},{run:(s=(0,i.default)((function*(){try{const t=yield e();r(t)}catch(e){n(e)}})),function(){return s.apply(this,arguments)})})),this._runTasks(),o}_doEnqueue(e){this._getOrCreatePriorityQueueForGroup(e.group).push(e)}_doDequeue(){return this._getHighestPriorityAmongGroups()}_runTasks(){for(;this._getRunningTasksCount()<this._concurrency;){const e=this._doDequeue();if(null==e)break;this._runTask(e)}}_runTask(e){var t=this;return(0,i.default)((function*(){const{run:r,signal:n,group:i}=e,a=t._getRunningTasksForGroup(i);if(null==n?void 0:n.aborted)setTimeout((()=>t._runTasks()),0);else{a.add(e);try{yield r()}finally{a.delete(e),setTimeout((()=>t._runTasks()),0)}}}))()}_getHighestPriorityAmongGroups(){var e;let t;for(const e of this._enqueuedTasksByGroup.values()){const r=e.peek();r&&(this._isFullOfGroup(r.group)||(!t||t.priority<r.priority)&&(t=e))}return null===(e=t)||void 0===e?void 0:e.pull()}_getRunningTasksCount(){let e=0;for(const t of this._runningTasksByGroup.values())e+=t.size;return e}getEnqueuedTasksCount(){let e=0;for(const t of this._enqueuedTasksByGroup.values())e+=t.size();return e}_getRunningTasksForGroup(e){if(!this._runningTasksByGroup.has(e)){const t=new Set;return this._runningTasksByGroup.set(e,t),t}return(0,o.default)(this._runningTasksByGroup.get(e),"this._runningTasksByGroup.get(group)")}_isFullOfGroup(e){const t=this._runningTasksByGroup.get(e);return null!=t&&t.size>=this._getLimitForGroup(e)}_getOrCreatePriorityQueueForGroup(e){if(!this._enqueuedTasksByGroup.has(e)){const t=new s.default((e=>e.priority));this._enqueuedTasksByGroup.set(e,t)}return(0,o.default)(this._enqueuedTasksByGroup.get(e),"this._enqueuedTasksByGroup.get(group)")}_getLimitForGroup(e){const t=this._groupLimits[e];return null==t?1/0:t}}},50796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filteredCatch=function(e,t){return r=>{if(Array.isArray(e)?e.some((e=>r instanceof e)):r instanceof e)return t(r);throw r}}},856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseAny=function(e){if(0===e.length)return Promise.reject(new n.AggregateError([]));return Promise.all(e.map(i)).then((e=>{throw new n.AggregateError(e)}),(e=>e))};var n=r(40265);function i(e){return new Promise(((t,r)=>Promise.resolve(e).then(r,t)))}},37178:(e,t)=>{"use strict";function r(e){const{relativeDelay:t=!1}=e;let r=null;const a=i(e.algo);return function(){if(null==r)return r=t?Date.now():0,0;let i=n(e,a());if(t){const e=Date.now(),t=e-r;t>0&&(i=Math.max(0,i-t)),r=e}return i}}function n(e,t){let{max:r,min:n,jitter:i=.1}=e,a=t;return null!=r&&a>r&&(a=r),null!=n&&a<n&&(a=n),0!==i&&(a=Math.ceil(a*(1+i*Math.random()))),a}function i(e){switch(e.type){case"fibonacci":return function(e){let t=e.second-e.first,r=e.first-t;return function(){const e=t+r;return r=t,t=e,e}}(e);case"exponential":return function(e){const{base:t=2}=e;let r=e.first;return function(){const e=r;return r*=t,e}}(e);case"constant":return function(e){const t=e.delay;return function(){return t}}(e);case"adjust":return function(e){const{toMs:t,backoff:r}=e,n=i(r);return function(){return t(n())}}(e);default:throw new Error(`makeTimeFunc unrecognized backoff ${e.type}`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseTimer=function(e){const t=r(e);return function(e){return new Promise((r=>{const n=t();n>0?setTimeout(r,n,e):r(e)}))}},t.createTimer=r,t.getDelay=function(e,t){if(0===e)return 0;const r=i(t.algo);for(let t=1;t<e;t++)r();return n(t,r())}},18569:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class r{constructor(e){this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()}}t.default=class{constructor(e,t){let{maxCached:r=10,maxAge:n=1/0,shouldCache:i}=t;this._cache={},this._maxCached=r,this._maxAge=n,this._createPromiseFunc=e,this._shouldCacheFunc=i}getOrRun(e){const t=this._cache;if(this._maxAge!==1/0){const e=Date.now()-this._maxAge,r=Object.keys(t);for(let n=0;n<r.length;n++){const i=r[n];t[i].createdTime<e&&delete t[i]}}const n=t[e];if(n)return n.lastUsedTime=+Date.now(),n.promise;const i=Object.keys(t);if(i.length>=this._maxCached){let e,r;for(let n=0;n<i.length;n++){const a=i[n],o=t[a];(null==r||o.lastUsedTime<r)&&(r=o.lastUsedTime,e=a)}e&&delete t[e]}for(var a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];const l=this._createPromiseFunc.apply(void 0,[e,...o]);return t[e]=new r(l),l.then((t=>{const r=this._shouldCacheFunc;r&&this._cache[e]===l&&!r(t)&&delete this._cache[e]})).catch((()=>{this._cache[e]===l&&delete this._cache[e]})),l}isCached(e){const t=this._cache[e];if(t){let e=!0;if(this._maxAge!==1/0){const r=Date.now()-this._maxAge;e=t.createdTime>=r}return e&&Boolean(t)}return!1}}},18412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Promise.resolve(e.apply(t,n))}catch(e){return Promise.reject(e)}}},13959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delayMs=function(e,t){return new Promise(((r,i)=>{if(null==t?void 0:t.aborted)throw new n.AbortError;const a=setTimeout((function(){null==t||t.removeEventListener("abort",o),r()}),e);function o(){null==t||t.removeEventListener("abort",o),clearTimeout(a),i(new n.AbortError)}null==t||t.addEventListener("abort",o)}))},t.withTimeout=function(e,t,r){return new Promise(((n,i)=>{const a=setTimeout((()=>{try{n(r())}catch(e){i(e)}}),t);e.then((e=>{clearTimeout(a),n(e)}),(e=>{clearTimeout(a),i(e)}))}))};var n=r(89385)},69719:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseEach=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t){const r=[];for(let n=0;n<e.length;n++)r.push(yield t(e[n]));return r}));return function(){return e.apply(this,arguments)}}();t.promiseEach=a},4352:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseLoop=function(){return a.apply(this,arguments)};var i=n(r(11504));function a(){return(a=(0,i.default)((function*(e,t){let r,n=!1;const i=e=>{n=!0,r=e};let a=0,o=t;for(;!n;)o=yield e(i,o,a),a++;return r}))).apply(this,arguments)}},67602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseProps=function(e){const t=Object.keys(e);return Promise.all(t.map((t=>e[t]))).then((function(e){const r={};for(let n=0;n<e.length;n++)r[t[n]]=e[n];return r}))}},27870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueMap=t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._promise=Promise.resolve(),this._maxDelay=e}wait(){return this._promise}enqueueHandlers(e,t,n){const i=this._promise.then((()=>e)).then(t,n),a=i.then();return this._promise=r(i,this._maxDelay),a}enqueue(e){const t=this._promise.then(e),n=t.then();return this._promise=r(t,this._maxDelay),n}};function r(e,t){return t>=0?new Promise((r=>{const n=()=>{r()};e.then(n,n),setTimeout(n,t)})):e.then(n,n)}function n(){}t.PromiseQueueMap=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._map=new Map,this._maxDelay=e}waitIfPending(e){return this._map.get(e)}wait(e){return this._map.get(e)||Promise.resolve()}enqueueHandlers(e,t,r,n){const i=this.wait(e).then((()=>t)).then(r,n);return this._addToMap(e,i)}enqueue(e,t){const r=this.wait(e).then(t);return this._addToMap(e,r)}_addToMap(e,t){const n=t.then();let i;const a=()=>{this._map.get(e)===i&&this._map.delete(e)};return i=r(t,this._maxDelay).then(a,a),this._map.set(e,i),n}}},66751:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseReduce=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t,r){let n=r;const i=e.length;for(let r=0;r<i;r++)n=yield t(n,e[r],r);return n}));return function(){return e.apply(this,arguments)}}();t.promiseReduce=a},72287:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseRetryLoop=void 0;var n=r(37178),i=r(13959),a=r(88156);t.PromiseRetryLoop=class{constructor(e){this._resolvable=new a.Resolvable,this._promise=null,this._resetTime=null,this._currentLoopIdentificator=0,this.endWithValue=e=>{this._currentLoopIdentificator++,this._resolvable.resolve(e)},this._options=e}resetTimeoutAfter(e){this._resetTime=Date.now()+e}cancelReset(){this._resetTime=null}reset(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: resetting ${this._options.name}`,this._currentLoopIdentificator++,this._runLoop())}start(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: starting ${this._options.name}`,0!==this._currentLoopIdentificator&&__LOG__(4,void 0,new Error)`PromiseRetryLoop was called several times. You may have race conditions`,this._currentLoopIdentificator++,this._runLoop())}_runLoop(){const e=this._options,t=this._currentLoopIdentificator;let r=(0,n.createTimer)(this._options.timer);r();const a=()=>{if(this._resolvable.resolveWasCalled())return;if(t!==this._currentLoopIdentificator)return;const o=Date.now();return this._promise=(0,e.code)(this.endWithValue).then((()=>{if(this._resolvable.resolveWasCalled())return;const{resetDelay:t}=e;(void 0!==t&&Date.now()>=o+t||null!=this._resetTime&&this._resetTime<=Date.now())&&(__LOG__(2)`PromiseRetryLoop: resetting ${e.name}`,r=(0,n.createTimer)(this._options.timer)),this._resetTime=null;const s=r();return __LOG__(2)`PromiseRetryLoop: retrying ${e.name} in ${s}ms`,(0,i.delayMs)(s).then(a)})),this._promise};this._promise=Promise.resolve().then(a)}promise(){return this._resolvable.resolveWasCalled()?this._resolvable.promise:this._promise?Promise.race([this._resolvable.promise,this._promise.then((()=>this._resolvable.promise))]):Promise.reject(new Error(`PromiseRetryLoop ${this._options.name} had promise() called before start()`))}}},38284:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=void 0;var n=r(40265);t.promiseTimeout=(e,t,r)=>{let i=null,a=null;const o=new Promise(((e,o)=>{a=o,i=setTimeout((()=>{o(new n.TimeoutError(r)),clearTimeout(i)}),t)}));return Promise.race([e,o]).finally((()=>{a&&a(new Error),clearTimeout(i)}))}},20461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWrapSync=function(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}},88156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvable=void 0;t.Resolvable=class{constructor(){this._isResolved=!1,this.promise=new Promise((e=>{this._resolve=e}))}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this.resolve(Promise.reject(e))}resolveWasCalled(){return this._isResolved}}},97197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;t.Semaphore=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._count=0,this._queue=[],this._size=e}acquire(){return new Promise(((e,t)=>{this._performAcquisition(e,t)}))}availablePermits(){return this._size-this._count}_performRelease(){this._count--,this._dequeue()}_performAcquisition(e,t){if(this._count<this._size){this._count++;let t=!1;e({release:()=>{if(t)throw new Error("Permit has already been released");t=!0,this._performRelease()}})}else this._enqueue(e,t)}_enqueue(e,t){this._queue.push([e,t])}_dequeue(){if(0===this._queue.length)return;const[e,t]=this._queue.shift();this._performAcquisition(e,t)}}},74121:(e,t)=>{"use strict";t.Z=y;const r="undefined"!=typeof Promise?Promise:null,n="function"==typeof setImmediate?setImmediate:null;let i=0;const a=[],o=[],s=[],l={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},d={sentinel:"TO_STRING"},u={sentinel:"DID_ERROR"};let p=null;const f=[],_=64,h=128,g=512,m="undefined"==typeof self?void 0:self;function y(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,j(e,this._context,(e=>R(this,0,!0,!1,e)),(e=>R(this,0,!1,!1,e))))}let E,S;function v(e){if(void 0===e)return E;if(I(e))return e;{const t=new y;return R(t,0,!0,!1,e),H(t,g),t}}function T(e){const t=new y;return t._value=e,H(t,514),f.push(t),t}function C(e){let t="";if(e._flags&h){t=(e._onFulfilled||e._onRejected).call(e._context,d)}else if(e._control)t=`.addRawControl(${e._control.name}, ${e._control.foo})`;else if(16&e._flags)t=`.endWithControls(${Object.keys(e.control)})`;else if(e._flags&g)t=1&e._flags?`Promise.resolve(${void 0===e._value?"":e._value})`:`Promise.reject(${void 0===e._value?"":e._value})`;else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t=`new Promise(${e._onFulfilled})`}else e._onFulfilled&&e._onRejected?t=`.then(${e._onFulfilled}, ${e._onRejected})`:e._onFulfilled?t=`.then(${e._onFulfilled})`:e._onRejected&&(t=`.catch(${e._onRejected})`);return t}function A(e){this.message=e,this.stack=new Error(e||this.name).stack}function b(){0===i&&(o.length||f.length)&&(i=1,S||(S=function(){let e,t,i=0;return"undefined"==typeof MutationObserver||m&&m.navigator&&m.navigator.standalone?r?function(){r.resolve().then(x)}:"function"==typeof n?function(){n(x)}:function(){setTimeout(x,0)}:(e=document.createTextNode(""),t=new MutationObserver(x),t.observe(e,{characterData:!0}),function(){e.data=i=1-i})}()),S())}function P(e,t){H(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function M(e){if(e&&("object"==typeof e||"function"==typeof e)){let t;try{t=e.then}catch(e){return p=e,u}if("function"==typeof t)return t}}function O(e){if(!e||I(e))return e;const t=M(e);if(t===u)return T(p);if(t){const r=new y((function(r,n){t.call(e,r,n)}));return r._thenableParent=e,r}return e}function I(e){return e instanceof y}function w(e,t,r){const n=I(e=O(e));let i,a,o,s,d=!1;if(n){if(!(3&e._flags))return H(e.then(t,r),32);H(e,8),d=!!(e._flags&_),o=e._context,i=1&e._flags?t:r,a=e._value}else i=t,a=e;if(!i)return v(e).then();if(a=W(i,o,a,!0),a===u)s=T(p);else{if(a===c)return v(e).then(t,r);if(a===l)return n?e.then():v(e);s=v(a)}return d&&(s=s.cancellable()),void 0!==o&&(s=s.then(),s._context=o),s}function R(e,t,r,n,i){if(t!==e._resolveLevel)return;const a=++e._resolveLevel;if(H(e,4),e._thenableParent=null,r)if(i===e)e._parent=void 0,G(e,!1,n,new TypeError("promise resolved to itself"));else if(I(i)){const t=3&i._flags;0===t?P(i,e):(e._parent=i,H(e,1024),H(i,8),G(e,1===t,n,i._value))}else{const t=M(i);t===u?(e._parent=void 0,G(e,!1,n,p)):t?(e._parent=void 0,e._thenableParent=i,j(t,i,(t=>R(e,a,!0,!1,t)),(t=>R(e,a,!1,!1,t)))):G(e,!0,n,i)}else G(e,!1,n,i)}function D(e,t,r,n,i){t===e._resolveLevel&&(N(e),R(e,t,r,n,i))}function N(e){if(e._parent){const t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){const r=t._children;for(let t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1);break}0===r.length&&(t._children=void 0)}}}function L(e){if(null==e)throw new Error(`Invalid .catch guard ${e}`);if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function k(e,t){return function(r,n){return r===d?`.catch(..., ${t})`:e&&!function(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n===Error||n.prototype instanceof Error){if(t instanceof n)return!0}else if(n(t))return!0}return!1}(e,r)?l:n?c:t.call(this,r)}}function G(e,t,r,n){if(H(e,4|(t?1:2)),e._value=n,e._child)U(e._child,t,r,n),e._child=void 0;else if(e._children){const i=e._children;e._children=void 0;for(let e=0;e<i.length;e++)U(i[e],t,r,n)}else t||8&e._flags||f.push(e)}function U(e,t,r,n){e._resolveLevel++;const i=Y(e,t);if(i&&32&e._flags){H(e,4);const a=W(i,e._context,n,!0);if(a!==c)return void(a===u?(e._parent=void 0,G(e,!1,r,p)):a===l?G(e,t,r,n):(e._parent=void 0,R(e,e._resolveLevel,!0,r,a)));e._flags&=-5}i?((r?s:o).push(e),b()):G(e,t,r,n)}function F(e,t){for(;0!==e.length;)t.push(e.pop())}function x(){for(;0!==a.length||0!==o.length;){0===a.length&&F(o,a);const e=a.pop(),t=e._parent;let r=!!(t&&1&t._flags),n=t&&t._value;const i=Y(e,r);if(H(e,4),i){let t;do{t=W(i,e._context,n,!1)}while(t===c);t===u?(n=p,r=!1,e._parent=void 0):t!==l&&(n=t,r=!0,e._parent=void 0)}3&e._flags||(R(e,e._resolveLevel,r,!0,n),F(s,a))}for(i--;0!==f.length;){const e=f.pop();8&e._flags||K(e,e._value)}}y.resolve=v,y.reject=T,y.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);const r=new y;r._onFulfilled=e,r._onRejected=t,r._context=this._context,this._flags&_&&H(r,_);const n=3&this._flags;return 0===n?P(this,r):(H(this,8),(1===n?e:t)?(r._parent=this,o.push(r),b()):(r._parent=this,H(r,n),r._value=this._value,2===n&&f.push(r))),r},y.prototype.catch=function(e){const t=arguments.length-1;if(0===t)return this.then(void 0,e);const r=new Array(t);for(let e=0;e<t;e++)r[e]=L(arguments[e]);const n=k(r,arguments[t]),i=w(this,void 0,n);return i._onRejected&&H(i,h),i},y.all=function(e){return new y((function(t,r){let n=e.length;if(0===n)return void t([]);const i=new Array(e.length);function a(e){if(0==--n){const r=[];for(let t=0;t<i.length;t++){const n=i[t];r.push(n&&3&n._flags?n._value:e)}t(r)}return e}for(let t=0;t<e.length;t++)i[t]=w(e[t],a,r)}))},y.allSettled=function(e){return new y((function(t){const r=Array.from(e);let n=r.length;if(0===n)return void t([]);const i=new Array(r.length);function a(e){return function(r){const a=e?{status:"rejected",reason:r}:{status:"fulfilled",value:r};if(0==--n){const e=[];for(let t=0;t<i.length;t++){const r=i[t];e.push(r&&3&r._flags?r._value:a)}t(e)}return a}}const o=a(!1),s=a(!0);for(let e=0;e<r.length;e++)i[e]=w(r[e],o,s)}))},y.race=function(e){const t=O(e);if(I(t)){const e=t.then((e=>y.race(e)));return e._context=void 0,e._flags&=-65,e}return new y((function(e,r){for(let n=0;n<t.length;n++){const i=O(t[n]);if(!I(i)||3&i._flags)for(e(i),n++;n<t.length;n++){const e=t[n];I(e)&&H(e,8)}else i.then(e,r)}}))},y.prototype.toString=function(){const e=[];let t;for(let r=this,n=!1;r;r=r._parent){t=r,!n&&3&r._flags&&(n=!0,r._flags&g||(1&r._flags?e.push(`[resolved value: ${r._value}]`):e.push(`[rejected reason: ${r._value}]`)));let i=C(r);1024&r._flags&&(i=`~${i}`),e.push(i)}return e.reverse(),768&t._flags||(e[0]=`[Promise]${e[0]}`),e.join("\n")},y.prototype.finally=function(e){function t(t){return t===d?`.finally(${e})`:(e.call(this),l)}return H(this.then(t,t),h)},A.prototype=Object.create(Error.prototype,{name:{value:"AbortError"}}),y.CancellationError=A,y.prototype.cancellable=function(){return H(this.then(),_)},y.prototype.cancel=function(e){let t;for(let e=this;e&&!(3&e._flags);e=e._parent)e._flags&_&&(t=e);if(t)if(void 0===e&&(e=new A),Y(t,!1)){const r=new y;N(t),P(r,t),D(r,0,!1,!1,e)}else D(t,t._resolveLevel,!1,!1,e)};const B=null==(null==m?void 0:m.dispatchEvent)?null:class extends Event{constructor(e,t){super(e,{cancelable:!0}),Object.defineProperties(this,{promise:{value:t.promise,enumerable:!0},reason:{value:t.reason,enumerable:!0}})}};function K(e,t){if(null!=(null==m?void 0:m.dispatchEvent)){const r=new B("unhandledrejection",{promise:e,reason:t});if(m.dispatchEvent(r),!m.PromiseRejectionEvent&&m.onunhandledrejection)try{m.onunhandledrejection(r)}catch(e){}}else"undefined"!=typeof process&&null!=process.emit?process.emit("unhandledRejection",t,e):console.error(`StackPromise did not catch ${t}`,e,t)}function j(e,t,r,n){try{e.call(t,r,n)}catch(e){n(e)}}function Y(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function W(e,t,r,n){try{return n?e.call(t,r,!0):e.call(t,r)}catch(e){return p=e,u}}function H(e,t){return e._flags|=t,e}E=new y,R(E,0,!0,!1,void 0)},8243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decimalStringToLongInt=function(e){if(!/^-?\d+$/.test(e))throw __LOG__(2)`"${e}" is not a valid decimal string`,new Error("decimalStringToLongInt is given an invalid decimal string");const t="-"===e[0],r=e.replace(/^-?0*/,""),i=r.length;if(i<16||16===i&&r<="9007199254740991")return t?-Number(r):Number(r);if(i>20||20===i&&r>"18446744073709551615"||t&&(i>19||19===i&&r>"9223372036854775807"))throw __LOG__(2)`"${e}" is over 64 bits`,new Error("decimalStringToHexLong is given value over 64 bits");let a=0,o=0;for(let e=0;e<i;e++)a=10*a+Number(r[e]),o=10*o+Math.floor(a/4294967296),a%=4294967296;return(0,n.createHexLongFrom32Bits)(o,a,t)},t.isBiggerLongInt=function(e,t){if("number"==typeof e&&"number"==typeof t)return e>t;const r="number"==typeof e?(0,n.hexLongFromNumber)(e):e,i="number"==typeof t?(0,n.hexLongFromNumber)(t):t;return(0,n.isBiggerHexLong)(r,i)},t.longIntToDecimalString=function(e){if("number"==typeof e)return e.toString(10);const t=(0,n.hexLongToHex)(e),r=[0];let i=0;for(let e=0;e<t.length;e++){i=(0,n.hexAt)(t,e);for(let e=0;e<r.length;e++)r[e]=16*r[e]+i,i=r[e]/10|0,r[e]%=10;for(;i>0;)r.push(i%10),i=i/10|0}const a=r.reverse().join("");return(0,n.hexLongIsNegative)(e)?"-"+a:a},t.maybeNumberOrThrowIfTooLarge=void 0,t.numberOrThrowIfTooLarge=i;var n=r(87614);function i(e){if("number"!=typeof e)throw __LOG__(2)`${e} is not a safe integer`,new Error("numberOrThrowIfTooLarge is given a non-safe integer");return e}t.maybeNumberOrThrowIfTooLarge=e=>null==e?e:i(e)},42098:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spec=void 0,t.compileSpec=function(e){if(e.internalCompiledSpec)return e.internalCompiledSpec;const t=e.internalSpec;if(!t)throw new Error(`Message Class ${String(e)} does not have internalSpec`);const r=e.internalDefaults||{},o=Object.keys(t).filter((e=>e!==n.KEYS.ONEOF)),s=new Array(o.length),l=[],c=[],d=new Array(o.length),u=t[n.KEYS.ONEOF]||{};o.sort(((e,r)=>{const n=a(t,e),i=a(t,r);return n[0]-i[0]}));for(let e=0;e<o.length;e++){const i=o[e],u=a(t,i);d[e]=r[i];const p=u[1],f=u[0];if(l.push(f),c.push(p),(p&n.TYPE_MASK)===n.TYPES.MESSAGE)s[e]=u[2];else if((p&n.TYPE_MASK)===n.TYPES.ENUM){const t=u[2];if("function"==typeof t.cast)s[e]=t;else{let r,n=!0,i=0;for(const e in t)n&&e!==i++&&(n=!1);if(n){r=[];for(let e=0;e<i;e++)r.push(!0)}else{r={};for(const e in t)r[t[e]]=!0}s[e]=r}}else s[e]=null}const p={};for(const e in u)u[e].forEach((t=>{p[t]||(p[t]=[]),p[t].push(e)}));const f=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_TAGS],_=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_FIELDS],h=new i(o,l,c,d,s,u,p,f,_);return e.internalCompiledSpec=h,h};var n=r(1390);class i{constructor(e,t,r,n,i,a,o,s,l){this.names=e,this.fields=t,this.types=r,this.defaults=n,this.meta=i,this.oneofToFields=a,this.fieldToOneof=o,this.reservedTags=s?s.reduce(((e,t)=>(e[t]=!0,e)),{}):{},this.reservedFields=l?l.reduce(((e,t)=>(e[t]=!0,e)),{}):{}}}function a(e,t){const r=e[t];if(null==r)throw new Error(`fieldData of ${t} is missing`);return r}t.Spec=i},1390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_MASK=t.TYPES=t.KEYS=t.FLAGS=t.ENC=void 0;t.FLAGS={REPEATED:64,PACKED:128,REQUIRED:256};t.TYPE_MASK=31;t.TYPES={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17};t.ENC={VARINT:0,BIT64:1,BINARY:2,BIT32:5};t.KEYS={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"}},72058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeToEncType=function(e){if(e&a.PACKED)return l.BINARY;const t=e&s;return t<=o.ENUM?l.VARINT:t<=o.DOUBLE?l.BIT64:t<=o.MESSAGE?l.BINARY:l.BIT32};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(1390));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}const{FLAGS:a,TYPES:o,TYPE_MASK:s,ENC:l}=n},49259:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequirements=l,t.checkValid=function(e,t){l(e,t);const r=h(t,e);if(r)throw r.path.reverse(),new TypeError(`Invalid value at ${r.path.join(".")}: ${r.error}`)};var i=n(r(33344)),a=r(42098),o=r(1390);const s=Number.MAX_SAFE_INTEGER;function l(e,t){const r=c(e,t);if(r)throw r.reverse(),new TypeError(`Message missing required value ${r.join(".")}`)}function c(e,t){const{names:r,types:n,meta:s}=(0,a.compileSpec)(e);let l;for(let e=0;e<n.length&&!l;e++){const a=n[e],d=r[e],u=(0,i.default)(t,d)?t[d]:void 0;if(a&o.FLAGS.REQUIRED&&null==u)l=[d];else if((a&o.TYPE_MASK)===o.TYPES.MESSAGE&&a&o.FLAGS.REPEATED&&null!=u){const t=s[e];let r;for(r=0;r<u.length&&!l;r++)l=c(t,u[r]);l&&l.push(`${d}[${r}]`)}else(a&o.TYPE_MASK)===o.TYPES.MESSAGE&&null!=u&&(l=c(s[e],u),l&&l.push(d))}return l}function d(e,t,r){return"string"==typeof e?!/^-?0x[0-9a-f]{16}$/i.test(e)&&(__LOG__(2)`"${f(e)}" is not a valid long`,{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}):u(e,t,r)}function u(e,t,r){return"number"!=typeof e||e!=e||Math.floor(e)!==e?(__LOG__(2)`"${f(e)}" is not a valid int`,{path:[],error:"value must be an int"}):(e<t||e>=r)&&(__LOG__(2)`"${f(e)}" is out of range`,{path:[],error:"value is out of range"})}function p(e,t,r){return e?void 0:(__LOG__(2)`"${f(r)}" is not ${t}`,{path:[],error:"value is invalid"})}function f(e){return"string"==typeof e?`"${e}"`:Array.isArray(e)?`[${e.join(", ")}]`:`${e}`}const _=[void 0,e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>u(e,0,4294967296),e=>d(e,0,s+1),e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>p("boolean"==typeof e,"boolean",e),(e,t)=>p("number"==typeof e&&(t[e]||void 0!==t.cast(e)),"in enum",e),e=>d(e,0,s+1),e=>d(e,-s,s+1),e=>p("number"==typeof e,"number",e),e=>p("string"==typeof e,"string",e),e=>p(e instanceof ArrayBuffer||e instanceof Uint8Array,"ArrayBuffer or Uint8Array",e),h,e=>u(e,0,4294967296),e=>u(e,-2147483648,2147483648),e=>p("number"==typeof e,"number",e)];function h(e,t){const{names:r,fields:n,types:i,meta:s,oneofToFields:l,fieldToOneof:c,reservedTags:d,reservedFields:u}=(0,a.compileSpec)(t);let p;for(let t=0;t<r.length&&!p;t++){const a=r[t],h=i[t],g=e[a],m=h&o.TYPE_MASK,y=_[m];if(void 0===y)throw new Error(`Can not find the validator for type ${m}`);if(h&(o.FLAGS.PACKED|o.FLAGS.REPEATED)&&null!=g)if(Array.isArray(g)){const e=s[t];for(let t=0;t<g.length&&!p;t++)p=y(g[t],e),p&&p.path.push(`${a}[${t}]`)}else __LOG__(2)`"${f(g)}" is not an array`,p={path:[a],error:"repeated field must be array"};else if(null!=g){p=y(g,s[t]),p&&p.path.push(a);const r=c[a];r&&r.forEach((t=>{l[t].filter((e=>e!==a)).forEach((r=>{void 0!==e[r]&&(p={path:[t],error:`oneof has fields '${a}' and '${r}' set`})}))})),d[n[t]]&&(p={path:[a],error:`tag ${n[t]} is reserved`}),u[a]&&(p={path:[a],error:"field name is reserved"})}}return p}},84902:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtobuf=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!1);return(0,u.checkRequirements)(e,n),n},t.decodeProtobufWithUnknowns=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!0);return(0,u.checkRequirements)(e,n),n},t.getUnknownFields=function(e){return(0,o.default)(e,"unsafeUnknownFields")?e.unsafeUnknownFields:null};var i=n(r(73982)),a=r(8584),o=n(r(33344)),s=r(87614),l=r(42098),c=r(1390),d=r(72058),u=r(49259);function p(e,t,r){if(e!==(0,d.typeToEncType)(t))throw new Error(`FormatError: ${r} encoded with wire type ${e}`)}function f(e,t,r){switch(t){case c.TYPES.INT32:return _(r,-2147483648,2147483648,e,a.parseInt64OrThrow);case c.TYPES.INT64:return r.readVarInt(h);case c.TYPES.UINT32:return _(r,0,4294967296,e,a.parseUint64OrThrow);case c.TYPES.UINT64:return r.readVarInt(g);case c.TYPES.SINT32:{const t=_(r,0,4294967296,e,a.parseInt64OrThrow);return 1&t?~(t>>>1):t>>>1}case c.TYPES.SINT64:return r.readVarInt(m);case c.TYPES.BOOL:return!!_(r,0,2,e,a.parseUint64OrThrow);case c.TYPES.ENUM:return r.readVarInt(a.parseInt64OrThrow);case c.TYPES.FIXED64:return r.readLong(g,!0);case c.TYPES.SFIXED64:return r.readLong(h,!0);case c.TYPES.DOUBLE:return r.readFloat64(!0);case c.TYPES.STRING:return r.readString(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.BYTES:return r.readBuffer(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.FIXED32:return r.readUint32(!0);case c.TYPES.SFIXED32:return r.readInt32(!0);case c.TYPES.FLOAT:return r.readFloat32(!0)}}function _(e,t,r,n,i){const a=e.readVarInt(i);if(a<t||a>=r)throw new Error(`FormatError: ${n} encoded with out-of-range value ${a}`);return a}function h(e,t){if((0,a.longFitsInDouble)(!0,e,t)){return 4294967296*e+E(t)}{const r=e<0;let n;n=r?0===t?-e:~e:e;const i=r?-t:t;return(0,s.createHexLongFrom32Bits)(n,i,r)}}function g(e,t){if((0,a.longFitsInDouble)(!1,e,t)){return 4294967296*E(e)+E(t)}return(0,s.createHexLongFrom32Bits)(e,t)}function m(e,t){let r=e>>>1,n=e<<31|t>>>1;return 1&t&&(r=~r,n=~n),h(r,n)}function y(e,t,r,n){const{names:o,fields:s,types:d,meta:u,oneofToFields:h,fieldToOneof:g,reservedTags:m,reservedFields:E}=(0,l.compileSpec)(e),{internalDefaults:S}=e,v=r||(0,i.default)({},S)||{};for(let e=0;e<o.length;e++)d[e]&c.FLAGS.REPEATED&&(v[o[e]]=[]);let T=0,C=s[0];for(;t.size();){const e=_(t,0,4294967296,"field and enc type",a.parseInt64OrThrow),r=7&e,i=e>>>3;if(i!==C){const e=T;do{++T===s.length&&(T=0),C=s[T]}while(i!==C&&T!==e)}if(i===C){const e=o[T],s=d[T];p(r,s,e);const l=s&c.TYPE_MASK,_=u[T];if(s&c.FLAGS.PACKED){const r=t.readVarInt(a.parseUint64OrThrow),n=t.readBinary(r);for(;n.size();){const t=f(e,l,n);(l!==c.TYPES.ENUM||_[t]||void 0!==_.cast(t))&&v[e].push(t)}}else if(l===c.TYPES.MESSAGE){const r=t.readVarInt(a.parseUint64OrThrow),i=t.readBinary(r);if(s&c.FLAGS.REPEATED)v[e].push(y(_,i,void 0,n));else{const t=v[e];v[e]=y(_,i,t,n)}}else{const r=f(e,l,t);(l!==c.TYPES.ENUM||_[r]||void 0!==_.cast(r))&&(s&c.FLAGS.REPEATED?v[e].push(r):v[e]=r)}const S=g[e];S&&void 0!==v[e]&&S.forEach((t=>{h[t].filter((t=>t!==e)).forEach((e=>{delete v[e]}))})),(m[i]||E[e])&&delete v[e]}else if(n){let e;switch(v.unsafeUnknownFields||(v.unsafeUnknownFields={}),r){case c.ENC.VARINT:e=t.readVarInt(a.parseInt64OrThrow);break;case c.ENC.BIT64:e=t.readBinary(8);break;case c.ENC.BINARY:e=t.readBinary(t.readVarInt(a.parseUint64OrThrow));break;case c.ENC.BIT32:e=t.readBinary(4)}v.unsafeUnknownFields[i]=e}else r===c.ENC.VARINT?t.readVarInt(a.parseInt64OrThrow):r===c.ENC.BIT64?t.advance(8):r===c.ENC.BINARY?t.advance(t.readVarInt(a.parseUint64OrThrow)):r===c.ENC.BIT32&&t.advance(4)}return v}function E(e){return e>=0?e:4294967296+e}},60980:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeErrorInfo=function(){return void 0!==c?`Last encoded value for ${c}`:"No information known"},t.encodeProtobuf=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Binary;return(0,l.checkValid)(e,t),h(r,t,e),c=void 0,r};var n=r(8584),i=r(87614),a=r(42098),o=r(1390),s=r(72058),l=r(49259);let c;function d(e,t){e.writeVarInt(t)}function u(e,t){if("number"==typeof t&&t<4503599627370496&&t>=-4503599627370496)e.writeVarInt(t>=0?2*t:2*-t-1);else{const r=new n.Binary;let a;"number"==typeof t?(a=t<0,r.writeVarInt(a?-t:t)):(a=(0,i.hexLongIsNegative)(t),r.writeVarIntFromHexLong(a?(0,i.negateHexLong)(t):t));const o=r.peek((()=>r.readByteArray())),s=o.byteLength;if(a){let e,t=0;do{e=o[t],o[t]=128&e|(127&e)-1&127,t++}while(255===o[t-1])}let l=a?1:0;for(let e=0;e<s;e++){const t=o[e],r=128&t|(63&t)<<1|l;l=(64&t)>>6,o[e]=r}1===l&&(o[s-1]|=128,r.writeInt8(1)),e.writeBinary(r)}}function p(e,t){"number"==typeof t?e.writeVarInt(t):e.writeVarIntFromHexLong(t)}const f=[void 0,d,p,d,p,u,u,(e,t)=>{e.writeVarInt(t?1:0)},d,(e,t)=>{"number"==typeof t?e.writeUint64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{"number"==typeof t?e.writeInt64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{e.writeFloat64(t,!0)},function(e,t){e.writeVarInt((0,n.numUtf8Bytes)(t)),e.writeString(t)},function(e,t){e.writeVarInt(t.byteLength),e.writeBuffer(t)},function(e,t,r){e.writeWithVarIntLength(((e,t)=>h(e,t,r)),t)},(e,t)=>{e.writeUint32(t,!0)},(e,t)=>{e.writeInt32(t,!0)},(e,t)=>{e.writeFloat32(t,!0)}],_=f.map((e=>{if(null!=e)return(e,r)=>{e.writeWithVarIntLength(t,r)};function t(t,r){for(let n=0;n<r.length;n++)e(t,r[n])}}));function h(e,t,r){const{names:n,fields:i,types:l,meta:d}=(0,a.compileSpec)(r),{internalDefaults:u}=r;for(let r=0;r<n.length;r++){const a=n[r];let p=t[a];if(null==p&&u&&(p=u[a]),null!=p){c=a;const t=i[r],n=l[r],u=n&o.TYPE_MASK,h=d[r],g=8*t|(0,s.typeToEncType)(n);if(n&o.FLAGS.PACKED){if(p.length>0){e.writeVarInt(g);(0,_[u])(e,p,h)}}else if(n&o.FLAGS.REPEATED)for(let t=0;t<p.length;t++){e.writeVarInt(g);(0,f[u])(e,p[t],h)}else{e.writeVarInt(g);(0,f[u])(e,p,h)}}}}},17793:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_TYPE=void 0,t.castToPreKeyId=f,t.castToSerializedPubKey=_,t.deserializePreKey=function(e){try{const{id:t,publicKey:r,privateKey:o}=(0,a.decodeProtobuf)(n.PreKeyRecordStructureSpec,e);return null==t||null==r||null==o?null:{id:f(t),keyPair:d((0,i.toBytes)(o,32),_(new Uint8Array(r)))}}catch(e){return null}},t.ecdh=function(e,t){return(0,o.scalarMult)(e,t.subarray(1)).buffer},t.makeKeyPair=c,t.makeKeyPairFrom=function(e){const{publicKey:t,secretKey:r}=o.box.keyPair.fromSecretKey(e);return l((0,i.ensureSize)(t,32),(0,i.ensureSize)(r,32))},t.makeKeyPairFromArrayBuffers=function(e,t){return{publicKey:(0,i.toBytes)(e,32),privateKey:(0,i.toBytes)(t,32)}},t.makeKeyPairFromSerialized=d,t.makePreKeys=function(e,t){let r=(e-1)%s;r<=0&&(r+=s);const a=[];for(let e=0;e<t;e++){const e=r===s?1:r+1,t=c(),o=(0,i.encodeSignalProto)(n.PreKeyRecordStructureSpec,{id:e,publicKey:p(t),privateKey:t.privateKey});a.push({plainObject:{id:e,keyPair:t},record:o}),r=e}return a},t.makeRawSenderKey=function(){const e=(0,i.makeBytes)(32);return self.crypto.getRandomValues(e),e},t.makeSerializedKeyPair=function(){const e=c();return u(e.privateKey,p(e))},t.makeSerializedKeyPairFrom=u,t.serializeIdentity=function(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set((0,i.ensureSize)(e,32),1),t},t.serializePubKey=p,t.toSerializeKeyPair=function(e){return u(e.privateKey,p(e))};var n=r(93638),i=r(27764),a=r(84902),o=r(14462);t.KEY_TYPE=5;const s=16777215;function l(e,t){return{publicKey:e,privateKey:t}}function c(){const{publicKey:e,secretKey:t}=o.box.keyPair();return t[0]&=248,t[31]=64|63&t[31],l((0,i.ensureSize)(e,32),(0,i.ensureSize)(t,32))}function d(e,t){return l((0,i.sliceBytes)(t,1,32),e)}function u(e,t){return{serializedPubKey:t,privateKey:e}}function p(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set(e.publicKey,1),t}function f(e){return(0,i.ensureIntInRange)(e,1,s)}function _(e){if(0===e.length||5!==e[0])throw new Error("Unrecognized public key type");return(0,i.ensureSize)(e,33)}},27764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HMAC_SHA256=t.AES_CBC=void 0,t.castRegistrationId=function(e){return d(e)},t.castSenderKeyId=function(e){return d(e)},t.castToByteEncoded=function(e){return e},t.decodeSignalProto=function(e,t,r){return r((0,a.decodeProtobuf)(e,t))},t.encodeSignalProto=function(e,t){return(0,o.encodeProtobuf)(e,t).readByteArray()},t.ensureIntInRange=d,t.ensureSize=c,t.hkdf=function(e,t,r,i){return(0,n.extractWithSaltAndExpand)(e,t,r,i).then((e=>new Uint8Array(e)))},t.makeBytes=function(e){return new Uint8Array(e)},t.makeCryptoKey=function(e,t){let r,n;"hmac-sha256"===t?(r=l,n=["sign"]):(r=s,n=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",e,r,!1,n)},t.makeRegistrationId=function(e){const t="extendedRange"===e?2147483646:16380;return(0,i.randomNumberLessThan)(t)+1},t.makeSenderKeyId=function(){return(0,i.randomNumberLessThan)(-1>>>1)+1},t.readBytes=function(e,t){return e.readByteArray(t)},t.sliceBytes=function(e,t,r){if(e.length-t<r)throw new Error(`Can not split off ${r} bytes from index ${t} of ${e.length} bytes`);return e.slice(t,t+r)},t.toBuffer=function(e){const t=e.buffer,r=e.byteOffset,n=e.length;return 0===r&&n===t.byteLength?t:t.slice(r,r+n)},t.toBytes=function(e,t){return c(new Uint8Array(e),t)};var n=r(81576),i=r(7589),a=r(84902),o=r(60980);const s={name:"AES-CBC"};t.AES_CBC=s;const l={name:"HMAC",hash:"SHA-256"};function c(e,t){if(e.length!==t)throw new Error(`Signal expected ${t} bytes, given ${e.length}`);return e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967296;if("number"==typeof e&&t<=e&&e<r&&Math.floor(e)===e)return e;throw new Error(`Expected integer in range [${t}, ${r}), given ${String(e)}`)}t.HMAC_SHA256=l},93638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignedPreKeyRecordStructureSpec=t.SessionStructureSpec=t.SenderSigningKeySpec=t.SenderMessageKeySpec=t.SenderKeyStateStructureSpec=t.SenderKeyRecordStructureSpec=t.SenderChainKeySpec=t.RecordStructureSpec=t.PreKeyRecordStructureSpec=t.PendingPreKeySpec=t.PendingKeyExchangeSpec=t.MessageKeySpec=t.IdentityKeyPairStructureSpec=t.ChainSpec=t.ChainKeySpec=void 0;var n=r(1390);const i={};t.SessionStructureSpec=i;const a={};t.PendingPreKeySpec=a;const o={};t.PendingKeyExchangeSpec=o;const s={};t.ChainSpec=s;const l={};t.MessageKeySpec=l;const c={};t.ChainKeySpec=c;const d={};t.RecordStructureSpec=d;const u={};t.PreKeyRecordStructureSpec=u;const p={};t.SignedPreKeyRecordStructureSpec=p;const f={};t.IdentityKeyPairStructureSpec=f;const _={};t.SenderKeyStateStructureSpec=_;const h={};t.SenderSigningKeySpec=h;const g={};t.SenderMessageKeySpec=g;const m={};t.SenderChainKeySpec=m;const y={};t.SenderKeyRecordStructureSpec=y,i.internalSpec={sessionVersion:[1,n.TYPES.UINT32],localIdentityPublic:[2,n.TYPES.BYTES],remoteIdentityPublic:[3,n.TYPES.BYTES],rootKey:[4,n.TYPES.BYTES],previousCounter:[5,n.TYPES.UINT32],senderChain:[6,n.TYPES.MESSAGE,s],receiverChains:[7,n.FLAGS.REPEATED|n.TYPES.MESSAGE,s],pendingKeyExchange:[8,n.TYPES.MESSAGE,o],pendingPreKey:[9,n.TYPES.MESSAGE,a],remoteRegistrationId:[10,n.TYPES.UINT32],localRegistrationId:[11,n.TYPES.UINT32],needsRefresh:[12,n.TYPES.BOOL],aliceBaseKey:[13,n.TYPES.BYTES]},a.internalSpec={preKeyId:[1,n.TYPES.UINT32],signedPreKeyId:[3,n.TYPES.INT32],baseKey:[2,n.TYPES.BYTES]},o.internalSpec={sequence:[1,n.TYPES.UINT32],localBaseKey:[2,n.TYPES.BYTES],localBaseKeyPrivate:[3,n.TYPES.BYTES],localRatchetKey:[4,n.TYPES.BYTES],localRatchetKeyPrivate:[5,n.TYPES.BYTES],localIdentityKey:[7,n.TYPES.BYTES],localIdentityKeyPrivate:[8,n.TYPES.BYTES]},s.internalSpec={senderRatchetKey:[1,n.TYPES.BYTES],senderRatchetKeyPrivate:[2,n.TYPES.BYTES],chainKey:[3,n.TYPES.MESSAGE,c],messageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,l]},l.internalSpec={index:[1,n.TYPES.UINT32],cipherKey:[2,n.TYPES.BYTES],macKey:[3,n.TYPES.BYTES],iv:[4,n.TYPES.BYTES]},c.internalSpec={index:[1,n.TYPES.UINT32],key:[2,n.TYPES.BYTES]},d.internalSpec={currentSession:[1,n.TYPES.MESSAGE,i],previousSessions:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,i]},u.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES]},p.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES],signature:[4,n.TYPES.BYTES],timestamp:[5,n.TYPES.FIXED64]},f.internalSpec={publicKey:[1,n.TYPES.BYTES],privateKey:[2,n.TYPES.BYTES]},_.internalSpec={senderKeyId:[1,n.TYPES.UINT32],senderChainKey:[2,n.TYPES.MESSAGE,m],senderSigningKey:[3,n.TYPES.MESSAGE,h],senderMessageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,g]},h.internalSpec={public:[1,n.TYPES.BYTES],private:[2,n.TYPES.BYTES]},g.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},m.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},y.internalSpec={senderKeyStates:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_]}},4276:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseSuccess=function(e){const t=(0,s.assertTag)(e,"iq");if(!t.success)return t;const r=(0,o.parseIQResultResponse)(e);if(!r.success)return r;const n=(0,s.flattenedChildWithTag)(e,"props");if(!n.success)return n;const c=(0,s.assertAttr)(n.value,"protocol","1");if(!c.success)return c;const d=(0,s.optional)(s.attrString,n.value,"ab_key");if(!d.success)return d;const u=(0,s.optional)(s.attrString,n.value,"hash");if(!u.success)return u;const p=(0,s.optional)(s.attrIntRange,n.value,"refresh",0,void 0);if(!p.success)return p;const f=(0,s.optional)(s.attrIntRange,n.value,"refresh_id",0,void 0);if(!f.success)return f;const _=(0,s.mapChildrenWithTag)(n.value,"prop",0,1/0,l);return _.success?(0,a.makeSuccess)((0,i.default)((0,i.default)({},r.value),{},{propsAbKey:d.value,propsHash:u.value,propsRefresh:p.value,propsRefreshId:f.value,propsProp:_.value})):_},t.parseGetExperimentConfigResponseSuccessPropsProp=l;var i=n(r(73982)),a=r(87040),o=r(65363),s=r(8790);function l(e){const t=(0,s.assertTag)(e,"prop");if(!t.success)return t;const r=(0,s.mixinOr)(e,o.parseExperimentConfig,o.parseSamplingConfig,"ExperimentConfig","SamplingConfig");return r.success,r}},65363:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"config_code",1,void 0);if(!r.success)return r;const a=(0,i.attrString)(e,"config_value");if(!a.success)return a;const o=(0,i.optional)(i.attrIntRange,e,"config_expo_key",0,void 0);return o.success?(0,n.makeSuccess)({configCode:r.value,configValue:a.value,configExpoKey:o.value}):o},t.parseIQErrorBadRequest=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","bad-request");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","400");return n.success?i.voidSuccess:n},t.parseIQErrorFeatureNotImplemented=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","feature-not-implemented");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","501");return n.success?i.voidSuccess:n},t.parseIQErrorInternalServerError=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","internal-server-error");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","500");return n.success?i.voidSuccess:n},t.parseIQErrorResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","error");return r.success?i.voidSuccess:r},t.parseIQResultResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","result");return r.success?i.voidSuccess:r},t.parseSamplingConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"event_code",1,void 0);if(!r.success)return r;const a=(0,i.attrIntRange)(e,"sampling_weight",-1e4,1e4);return a.success?(0,n.makeSuccess)({eventCode:r.value,samplingWeight:a.value}):a},t.parseServerNotification=function(e){const t=(0,i.assertTag)(e,"notification");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"t",0,void 0);if(!r.success)return r;const a=(0,i.optional)(i.attrIntRange,e,"offline",0,1024);return a.success?(0,n.makeSuccess)({t:r.value,offline:a.value}):a};var n=r(87040),i=r(8790)},8790:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.SmaxParsingFailure=void 0,t.assertAttr=function(e,t,r){const n=c(e,t);if(!n.success)return n;if(n.value!==r)return _(e,`to have "${t}"="${r}", but instead has "${n.value}"`);return s},t.assertTag=function(e,t){if(e.tag!==t)return _(e,`to be <${t}>`);return s},t.attrInt=d,t.attrIntRange=function(e,t,r,n){const i=d(e,t);if(!i.success)return i;const a=i.value;if(void 0!==r&&a<r)return _(e,`to have "${t}"={at least ${r}} but has value ${a}`);if(void 0!==n&&a>=n)return _(e,`to have "${t}"={below ${n}} but has value ${a}`);return(0,o.makeSuccess)(a)},t.attrString=c,t.childWithTag=function(e,t,r){const n=p(e,t,r);if(!n.success)return n;const i=n.value;if(null==i)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(i)},t.countChildrenWithTag=function(e,t,r,n,i){const a=g(e,t,r,n);if(!a.success)return a;const s=a.value.length;for(let e=0;e<s;e++){const t=i(a.value[e]);if(!t.success)return t}return(0,o.makeSuccess)(s)},t.emptyObject=void 0,t.errorMixinDisjunction=function(e,t,r){const n=t.map(((e,t)=>`${e}: ${r[t].error}`));return _(e,[`to match any of following mixins: ${t.join(", ")}, but all mixins failed.`,...n].join(" "))},t.flattenedChildWithTag=function(e,t){const r=u(e,t);if(!r.success)return r;if(null==r.value)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(r.value)},t.hasLiteralAttr=function(e,t,r){const n=c(e,t);return n.success&&n.value===r},t.identity=function(e){return e},t.mapChildrenWithTag=function(e,t,r,n,i){const a=g(e,t,r,n);if(!a.success)return a;const s=[];for(let e=0;e<a.value.length;e++){const t=i(a.value[e]);if(!t.success)return t;s.push(t.value)}return(0,o.makeSuccess)(s)},t.mixinOr=function(e,t,r,n,a){const s=t(e);if(s.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},s.value),{},{mixinName:n}));const l=r(e);if(l.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},l.value),{},{mixinName:a}));return _(e,[`to match either ${n} or ${a}, but both mixins failed.`,`${n}: ${s.error}`,`${a}: ${l.error}`].join(" "))},t.optional=function(e,t,r,n,i){return f(t,r)?e(t,r,n,i):s},t.optionalChild=u,t.optionallChildWithTag=p,t.voidSuccess=void 0;var i=n(r(73982)),a=n(r(33344)),o=r(87040);const s=(0,o.makeSuccess)();t.voidSuccess=s;class l extends Error{constructor(){super(...arguments),this.name="SmaxParsingFailure"}}function c(e,t){return f(e,t)?function(e,t){if("string"!=typeof t)return _(e,`decodeAsString: attribute is ${typeof t} not a string: ${String(t)}`);return(0,o.makeSuccess)(t)}(e,e.attrs[t]):_(e,`to have attribute "${t}"`)}function d(e,t){const r=c(e,t);if(!r.success)return r;const n=parseInt(r.value,10);return Number.isNaN(n)?_(e,`to have "${t}"={integer} but has value "${r.value}"`):(0,o.makeSuccess)(n)}function u(e,t){const r=h(e);if(!r.success)return r;const n=r.value;if(null==n)return s;let i=null;for(let r=0;r<n.length;r++){const a=n[r];if(a.tag===t){if(null!=i)return _(e,`to have 1 child <${t}>, but found more than 1`);i=a}}return(0,o.makeSuccess)(i)}function p(e,t,r){const n=u(e,t);return n.success?null==n.value?s:r(n.value):n}function f(e,t){return(0,a.default)(e.attrs,t)}function _(e,t){return(0,o.makeError)(`expected <${e.tag}>: ${t}`)}function h(e){const t=e.content;return t instanceof Uint8Array?_(e,"to have children"):(0,o.makeSuccess)(t)}function g(e,t,r,n){const i=h(e);if(!i.success)return i;const a=i.value;if(null==a)return 0!==r?_(e,`to have at least ${r} <${t}> children, but found 0`):(0,o.makeSuccess)([]);const s=[];for(let e=0;e<a.length;e++){const r=a[e];r.tag===t&&s.push(r)}const l=s.length;return l<r?_(e,`to have at least ${r} <${t}> children, but found ${l}`):l>n?_(e,`to have at most ${n} <${t}> children, but found ${l}`):(0,o.makeSuccess)(s)}t.SmaxParsingFailure=l;t.emptyObject={}},72493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var n=r(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,n.TYPES.STRING],fromMe:[2,n.TYPES.BOOL],id:[3,n.TYPES.STRING],participant:[4,n.TYPES.STRING]}},76100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferMod=function(e,t){const r=new Uint8Array(e);if(t>8388607)throw new Error("Divisor is too big");let n=0;for(let e=0;e<r.length;++e)n=((n<<8)+r[e])%t;return n},t.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},t.arrayBuffersEqualUNSAFE=function(e,t){const n=new Uint8Array(e),i=new Uint8Array(t);return r(n,i)},t.concatBuffers=function(e){const t=e.map((e=>new Uint8Array(e))),r=t.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(r);return t.reduce(((e,t)=>(n.set(t,e),e+t.byteLength)),0),n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)},t.largeStringToArrayBuffer=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e5;return new Promise((r=>{const n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);let o=0;requestAnimationFrame((function s(){const l=Math.min(o+t,n);for(;o<l;)a[o]=e.charCodeAt(o),o++;if(o===n)return void r(i);requestAnimationFrame(s)}))}))},t.stringToArrayBuffer=function(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);let n,i;for(n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r.buffer},t.uint8ArraysEqualUNSAFE=r;function r(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r!==e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}},47151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeIndexWithoutPreservingOrder=function(e,t){const r=e.pop();t<e.length&&(e[t]=r)}},84973:e=>{e.exports=function(e){throw new Error(`Impossible value, the default statement should never be reached for value: ${e}`)}},15688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BASE64_DATA_URL_SCHEME=void 0,t.decodeB64=function(e){const t=a(e,43,47,61);if(t)return t.buffer;throw new Error("Base64.decode given invalid string")},t.decodeB64ToJsArray=function(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):a(e,43,47,61);return t&&Array.from(t)},t.decodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=a(e,45,95,t?61:-1);if(r)return r.buffer;throw new Error("Base64.decode given invalid string")},t.encodeB64=function(e){return n(e,43,47,!0)},t.encodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(e,45,95,t)},t.sizeWhenB64Decoded=function(e){return Math.floor(3*e.length/4)};const r=3e3;function n(e,t,n,a){const o=Array.isArray(e)||e instanceof ArrayBuffer?new Uint8Array(e):e;if(o.length<=r)return i(o,t,n,a);{const e=[];for(let s=0;s<o.length;s+=r)e.push(i(o.subarray(s,s+r),t,n,a));return e.join("")}}function i(e,t,r,n){const i=Math.ceil(4*e.length/3),a=4*Math.ceil(e.length/3),o=new Array(a);for(let t=0,r=0;t<a;t+=4,r+=3){const n=e[r]<<16|e[r+1]<<8|e[r+2];o[t]=n>>18,o[t+1]=n>>12&63,o[t+2]=n>>6&63,o[t+3]=63&n}for(let e=0;e<i;e++){const n=o[e];o[e]=n<26?65+n:n<52?71+n:n<62?n-4:62===n?t:r}for(let e=i;e<a;e++)o[e]=61;const s=String.fromCharCode.apply(String,o);return n?s:s.substring(0,i)}function a(e,t,r,n){let i=e.length;const a=new Int32Array(i+i%4);for(let o=0;o<i;o++){const s=e.charCodeAt(o);if(65<=s&&s<=90)a[o]=s-65;else if(97<=s&&s<=122)a[o]=s-71;else if(48<=s&&s<=57)a[o]=s+4;else if(s===t)a[o]=62;else{if(s!==r){if(s===n){i=o;break}return null!=self.ERROR&&__LOG__(4,void 0,new Error)`Found unexpected character code while decoding B64 at index ${o}, length ${i}: ${s}`,null}a[o]=63}}const o=a.length/4;for(let e=0,t=0;e<o;e++,t+=4)a[e]=a[t]<<18|a[t+1]<<12|a[t+2]<<6|a[t+3];const s=Math.floor(3*i/4),l=new Uint8Array(s);let c=0,d=0;for(;d+3<=s;c++,d+=3){const e=a[c];l[d]=e>>16,l[d+1]=e>>8&255,l[d+2]=255&e}switch(s-d){case 2:l[d]=a[c]>>16,l[d+1]=a[c]>>8&255;break;case 1:l[d]=a[c]>>16}return l}t.BASE64_DATA_URL_SCHEME="data:image/jpeg;base64,"},8584:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0,t.longFitsInDouble=u,t.numUtf8Bytes=d,t.parseInt64OrThrow=Y,t.parseUint64OrThrow=W;var n=r(87614);const i=65533,a=new Uint8Array(10),o=new Uint8Array(0);class s{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.write=function(){for(let t=0;t<arguments.length;t++){const r=t<0||arguments.length<=t?void 0:arguments[t];"string"==typeof r?e.writeString(r):"number"==typeof r?e.writeUint8(r):r instanceof s?e.writeBinary(r):r instanceof ArrayBuffer?e.writeBuffer(r):r instanceof Uint8Array&&e.writeByteArray(r)}},t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=this._writeIndex=t.byteLength):t instanceof Uint8Array&&(this._buffer=t,this._readEndIndex=this._writeIndex=t.length),this._bytesTrashed=0,this._earliestIndex=this._readIndex=0,this._view=null,this._littleEndian=r,this._hiddenReads=0,this._hiddenWrites=0}size(){return this._readEndIndex-this._readIndex}peek(e,t){this._hiddenReads++;const r=this._readIndex,n=this._bytesTrashed;try{return e(this,t)}finally{this._hiddenReads--,this._readIndex=r-(this._bytesTrashed-n)}}advance(e){this._shiftReadOrThrow(e)}readWithViewParser(e,t,r,n){return t(this._getView(),this._shiftReadOrThrow(e),e,r,n)}readWithBytesParser(e,t,r,n){return t(this._buffer,this._shiftReadOrThrow(e),e,r,n)}readUint8(){return p(this,1,_,!1)}readInt8(){return p(this,1,_,!0)}readUint16(){return p(this,2,h,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt32(){return p(this,4,g,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint32(){return p(this,4,m,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt64(){return p(this,8,y,Y,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint64(){return p(this,8,y,W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readLong(e){return p(this,8,y,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}readFloat32(){return p(this,4,E,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readFloat64(){return p(this,8,S,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readVarInt(e){const t=f(this,0,v,this.size());return f(this,t,T,e)}readBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new ArrayBuffer(0):f(this,e,C)}readByteArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new Uint8Array(0):f(this,e,A)}readBinary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;if(0===e)return new s(void 0,t);const r=f(this,e,A);return new s(r,t)}indexOf(e){if(0===e.length)return 0;const t=this._buffer,r=this._readEndIndex,n=this._readIndex;let i=0,a=n;for(let o=n;o<r;o++)if(t[o]===e[i]){if(0===i&&(a=o),i++,i===e.byteLength)return o-n-e.byteLength+1}else i>0&&(i=0,o=a);return-1}readString(e){return f(this,e,b)}ensureCapacity(e){this._maybeReallocate(this._readIndex+e)}ensureAdditionalCapacity(e){this._maybeReallocate(this._writeIndex+e)}writeToView(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._getView(),i,e,r,n)}writeToBytes(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._buffer,i,e,r,n)}writeUint8(e){K(e,0,256,"uint8"),M(this,1,O,e,!1)}writeInt8(e){K(e,-128,128,"signed int8"),M(this,1,O,e,!0)}writeUint16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,65536,"uint16"),P(this,2,I,e,t)}writeInt16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-32768,32768,"signed int16"),P(this,2,w,e,t)}writeUint32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,4294967296,"uint32"),P(this,4,R,e,t)}writeInt32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-2147483648,2147483648,"signed int32"),P(this,4,D,e,t)}writeUint64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,0x10000000000000000,"uint64"),P(this,8,N,e,t)}writeInt64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-0x8000000000000000,0x8000000000000000,"signed int64"),P(this,8,N,e,t)}writeFloat32(e){P(this,4,L,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeFloat64(e){P(this,8,k,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeVarInt(e){K(e,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");const t=e<0,r=t?-e:e;let n=Math.floor(r/4294967296),i=r-4294967296*n;t&&(n=~n,0===i?n++:i=-i);M(this,B(n,i),G,n,i)}writeVarIntFromHexLong(e){const t=(0,n.hexLongIsNegative)(e),r=t?(0,n.negateHexLong)(e):e,i=(0,n.hexLongToHex)(r);let a=0,o=0;for(let e=0;e<n.NUM_HEX_IN_LONG;e++)a=a<<4|o>>>28,o=o<<4|(0,n.hexAt)(i,e);t&&(a=~a,0===o?a++:o=-o);M(this,B(a,o),G,a,o)}writeBinary(e){const t=e.peek((e=>e.readByteArray()));if(t.length){const e=this._shiftWriteMaybeReallocate(t.length);this._buffer.set(t,e)}}writeBuffer(e){this.writeByteArray(new Uint8Array(e))}writeByteArray(e){const t=this._shiftWriteMaybeReallocate(e.length);this._buffer.set(e,t)}writeBufferView(e){this.writeByteArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}writeString(e){M(this,d(e),U,e)}writeHexLong(e){P(this,8,F,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeBytes(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(let e=0;e<t.length;e++)K(t[e],0,256,"byte");M(this,t.length,x,t)}writeAtomically(e,t){this._hiddenWrites++;let r=this._writeIndex,n=this._bytesTrashed;try{const i=e(this,t);return r=this._writeIndex,n=this._bytesTrashed,i}finally{this._hiddenWrites--,this._writeIndex=r-(this._bytesTrashed-n)}}writeWithVarIntLength(e,t){const r=this._writeIndex,n=this.writeAtomically(e,t),i=this._writeIndex;this.writeVarInt(i-r);const o=this._writeIndex-i,s=this._buffer;for(let e=0;e<o;e++)a[e]=s[i+e];for(let e=i-1;e>=r;e--)s[e+o]=s[e];for(let e=0;e<o;e++)s[r+e]=a[e];return n}static build(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=0;for(let e=0;e<t.length;e++){const r=t[e];"string"==typeof r?n+=d(r):"number"==typeof r?n++:r instanceof s?n+=r.size():r instanceof ArrayBuffer?n+=r.byteLength:r instanceof Uint8Array&&(n+=r.length)}const i=new s;return i.ensureCapacity(n),i.write.apply(i,arguments),i}_getView(){return this._view||(this._view=new DataView(this._buffer.buffer,this._buffer.byteOffset))}_shiftReadOrThrow(e){if(e<0)throw new Error("ReadError: given negative number of bytes to read");const t=this._readIndex,r=t+e;if(r>this._readEndIndex)throw new Error(t===this._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return this._readIndex=r,this._hiddenReads||(this._earliestIndex=r),t}_maybeReallocate(e){const t=this._buffer;if(e<=t.length)return e;{const r=this._earliestIndex,n=e-r,i=Math.max(n,2*(t.length-r),64),a=new Uint8Array(i);return r?(a.set(t.subarray(r)),this._bytesTrashed+=r,this._readIndex-=r,this._readEndIndex-=r,this._writeIndex-=r,this._earliestIndex=0):a.set(t),this._buffer=a,this._view=null,n}}_shiftWriteMaybeReallocate(e){const t=this._maybeReallocate(this._writeIndex+e),r=this._writeIndex;return this._writeIndex=t,this._hiddenWrites||(this._readEndIndex=t),r}}t.Binary=s;let l="",c=0;function d(e){if(e===l)return c;const t=e.length;let r=0;for(let n=0;n<t;n++){const i=e.charCodeAt(n);if(i<128)r++;else if(i<2048)r+=2;else if(i<55296||57344<=i&&i<=65535)r+=3;else if(55296<=i&&i<56320&&n+1!==t){const t=e.charCodeAt(n+1);56320<=t&&t<57344?(n++,r+=4):r+=3}else r+=3}return l=e,c=r}function u(e,t,r){const n=t>>21;if(e){const e=Boolean(2097151&t||r);return 0===n||-1===n&&e}return 0===n}function p(e,t,r,n,i){return e.readWithViewParser(t,r,n,i)}function f(e,t,r,n,i){return e.readWithBytesParser(t,r,n,i)}function _(e,t,r,n){return n?e.getInt8(t):e.getUint8(t)}function h(e,t,r,n){return e.getUint16(t,n)}function g(e,t,r,n){return e.getInt32(t,n)}function m(e,t,r,n){return e.getUint32(t,n)}function y(e,t,r,n,i){return n(e.getInt32(i?t+4:t,i),e.getInt32(i?t:t+4,i))}function E(e,t,r,n){return e.getFloat32(t,n)}function S(e,t,r,n){return e.getFloat64(t,n)}function v(e,t,r,n){const i=Math.min(n,10);let a=0,o=128;for(;a<i&&128&o;)o=e[t+a++];if(10===a&&o>1)throw new Error("ParseError: varint exceeds 64 bits");return 128&o?a+1:a}function T(e,t,r,n){let i=0,a=0,o=r;10===r&&(o--,a=1&e[t+o]);for(let r=o-1;r>=0;r--)i=i<<7|a>>>25,a=a<<7|127&e[t+r];return n(i,a)}function C(e,t,r){const n=t+e.byteOffset,i=e.buffer;return 0===n&&r===i.byteLength?i:i.slice(n,n+r)}function A(e,t,r){return e.subarray(t,t+r)}function b(e,t,r){const n=t+r;let a=[],o=null;for(let r=t;r<n;r++){a.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,a)),a=[]);const t=0|e[r];if(0==(128&t))a.push(t);else if(192==(224&t)){const o=H(e,r+1,n);if(o){r++;const e=(31&t)<<6|63&o;e>=128?a.push(e):a.push(i)}else a.push(i)}else if(224==(240&t)){const o=H(e,r+1,n),s=H(e,r+2,n);if(o&&s){r+=2;const e=(15&t)<<12|(63&o)<<6|63&s;e>=2048&&!(55296<=e&&e<57344)?a.push(e):a.push(i)}else o?(r++,a.push(i)):a.push(i)}else if(240==(248&t)){const o=H(e,r+1,n),s=H(e,r+2,n),l=H(e,r+3,n);if(o&&s&&l){r+=3;const e=(7&t)<<18|(63&o)<<12|(63&s)<<6|63&l;if(e>=65536&&e<=1114111){const t=e-65536;a.push(55296|t>>10,56320|1023&t)}else a.push(i)}else o&&s?(r+=2,a.push(i)):o?(r++,a.push(i)):a.push(i)}else a.push(i)}const s=String.fromCharCode.apply(String,a);return o?(o.push(s),o.join("")):s}function P(e,t,r,n,i){return e.writeToView(t,r,n,i)}function M(e,t,r,n,i){return e.writeToBytes(t,r,n,i)}function O(e,t,r,n){e[t]=n}function I(e,t,r,n,i){e.setUint16(t,n,i)}function w(e,t,r,n,i){e.setInt16(t,n,i)}function R(e,t,r,n,i){e.setUint32(t,n,i)}function D(e,t,r,n,i){e.setInt32(t,n,i)}function N(e,t,r,n,i){const a=n<0,o=a?-n:n;let s=Math.floor(o/4294967296),l=o-4294967296*s;a&&(s=~s,0===l?s++:l=-l),e.setUint32(i?t+4:t,s,i),e.setUint32(i?t:t+4,l,i)}function L(e,t,r,n,i){e.setFloat32(t,n,i)}function k(e,t,r,n,i){e.setFloat64(t,n,i)}function G(e,t,r,n,i){let a=n,o=i;const s=t+r-1;for(let r=t;r<s;r++)e[r]=128|127&o,o=a<<25|o>>>7,a>>>=7;e[s]=o}function U(e,t,r,n){let i=t;const a=n.length;for(let t=0;t<a;t++){const r=n.charCodeAt(t);if(r<128)e[i++]=r;else if(r<2048)e[i++]=192|r>>6,e[i++]=128|63&r;else if(r<55296||57344<=r)e[i++]=224|r>>12,e[i++]=128|r>>6&63,e[i++]=128|63&r;else if(55296<=r&&r<56320&&t+1!==a){const a=n.charCodeAt(t+1);if(56320<=a&&a<57344){t++;const n=65536+((1023&r)<<10|1023&a);e[i++]=240|n>>18,e[i++]=128|n>>12&63,e[i++]=128|n>>6&63,e[i++]=128|63&n}else e[i++]=239,e[i++]=191,e[i++]=189}else e[i++]=239,e[i++]=191,e[i++]=189}}function F(e,t,r,i,a){const o=(0,n.hexLongIsNegative)(i),s=(0,n.hexLongToHex)(i);let l=0,c=0;for(let e=0;e<16;e++)l=l<<4|c>>>28,c=c<<4|(0,n.hexAt)(s,e);o&&(l=~l,0===c?l++:c=-c),e.setUint32(a?t+4:t,l,a),e.setUint32(a?t:t+4,c,a)}function x(e,t,r,n){for(let i=0;i<r;i++)e[t+i]=n[i]}function B(e,t){let r,n;for(e?(r=5,n=e>>>3):(r=1,n=t>>>7);n;)r++,n>>>=7;return r}function K(e,t,r,n){if("number"!=typeof e||e!=e||Math.floor(e)!==e||e<t||e>=r)throw new TypeError("string"==typeof e?`WriteError: string "${e}" is not a valid ${n}`:`WriteError: ${String(e)} is not a valid ${n}`)}function j(e,t,r){let n;n=t>=0||e?t:4294967296+t;const i=4294967296*n+(r>=0?r:4294967296+r);if(!u(e,t,r))throw new Error(`ReadError: integer exceeded 53 bits (${i})`);return i}function Y(e,t){return j(!0,e,t)}function W(e,t){return j(!1,e,t)}function H(e,t,r){if(t>=r)return 0;const n=0|e[t];return 128==(192&n)?n:0}},42341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=[];r[34]="ES",r[49]="DE",r[52]="MX",r[44]="GB",r[966]="SA",r[39]="IT",r[93]="AF",r[355]="AL",r[213]="DZ",r[376]="AD",r[244]="AO",r[54]="AR",r[374]="AM",r[297]="AW",r[61]="AU",r[43]="AT",r[994]="AZ",r[973]="BH",r[880]="BD",r[375]="BY",r[32]="BE",r[501]="BZ",r[229]="BJ",r[975]="BT",r[591]="BO",r[387]="BA",r[267]="BW",r[55]="BR",r[246]="IO",r[673]="BN",r[359]="BG",r[226]="BF",r[257]="BI",r[225]="CI",r[855]="KH",r[237]="CM",r[238]="CV",r[236]="CF",r[235]="TD",r[56]="CL",r[86]="CN",r[57]="CO",r[269]="KM",r[242]="CG",r[243]="CD",r[682]="CK",r[506]="CR",r[385]="HR",r[53]="CU",r[599]="CW",r[357]="CY",r[420]="CZ",r[45]="DK",r[253]="DJ",r[593]="EC",r[20]="EG",r[503]="SV",r[240]="GQ",r[291]="ER",r[372]="EE",r[251]="ET",r[298]="FO",r[679]="FJ",r[358]="FI",r[33]="FR",r[594]="GF",r[689]="PF",r[241]="GA",r[220]="GM",r[995]="GE",r[233]="GH",r[350]="GI",r[30]="GR",r[299]="GL",r[590]="GP",r[502]="GT",r[224]="GN",r[245]="GW",r[592]="GY",r[509]="HT",r[504]="HN",r[852]="HK",r[36]="HU",r[354]="IS",r[91]="IN",r[62]="ID",r[98]="IR",r[964]="IQ",r[353]="IE",r[972]="IL",r[81]="JP",r[962]="JO",r[254]="KE",r[965]="KW",r[996]="KG",r[856]="LA",r[371]="LV",r[961]="LB",r[266]="LS",r[231]="LR",r[218]="LY",r[423]="LI",r[370]="LT",r[352]="LU",r[853]="MO",r[389]="MK",r[261]="MG",r[265]="MW",r[60]="MY",r[960]="MV",r[223]="ML",r[356]="MT",r[692]="MH",r[596]="MQ",r[222]="MR",r[230]="MU",r[691]="FM",r[373]="MD",r[377]="MC",r[976]="MN",r[382]="ME",r[212]="MA",r[258]="MZ",r[95]="MM",r[264]="NA",r[674]="NR",r[977]="NP",r[31]="NL",r[687]="NC",r[64]="NZ",r[505]="NI",r[227]="NE",r[234]="NG",r[672]="NF",r[850]="KP",r[47]="NO",r[968]="OM",r[92]="PK",r[680]="PW",r[970]="PS",r[507]="PA",r[675]="PG",r[595]="PY",r[51]="PE",r[63]="PH",r[48]="PL",r[351]="PT",r[974]="QA",r[40]="RO",r[7]="RU",r[250]="RW",r[262]="RE",r[508]="PM",r[685]="WS",r[378]="SM",r[221]="SN",r[381]="RS",r[248]="SC",r[232]="SL",r[65]="SG",r[421]="SK",r[386]="SI",r[677]="SB",r[252]="SO",r[27]="ZA",r[82]="KR",r[211]="SS",r[94]="LK",r[249]="SD",r[597]="SR",r[268]="SZ",r[46]="SE",r[41]="CH",r[963]="SY",r[239]="ST",r[886]="TW",r[992]="TJ",r[255]="TZ",r[66]="TH",r[670]="TL",r[228]="TG",r[676]="TO",r[216]="TN",r[90]="TR",r[993]="TM",r[256]="UG",r[380]="UA",r[971]="AE",r[1]="US",r[598]="UY",r[998]="UZ",r[678]="VU",r[58]="VE",r[84]="VN",r[681]="WF",r[967]="YE",r[260]="ZM",r[263]="ZW",r[383]="XK";var n=r;t.default=n},81574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={1:'[334,-1,"($1) $2-$3"],10',20:'["Ah","[23]"],[334,"1[0125]|[89]00"],["Bg","1[35]|[4-6]|[89][2-9]"],[9,10]',211:"333,9",212:'["[5-7]BF","5(2[015-7]|3[0-4])|[67]",1],["[58]CE",["5(2[2-489]|3[5-9]|92)|892","5(2([2-48]|9[0-7])|3([5-79]|8[0-7])|924)|892"],1],["5DD",["5(29|38)","5(29|38)[89]"],1],["[5]BBBB","5(4[067]|5[03])"],["8[09];G","8(0|9[013-9])",1],9',213:'["[5-8]BBBB","[5-8]"],["9ACBB",9],9',216:"233,8",218:'[27,"[25-79]",1],9',220:"34,7",221:'[2322,"[379]"],[3222,8],9',222:'"[2-48]ABBB",8',223:'[2222,"[246-9]"],8',224:'[2222,3],[3222,"[67]"],[8,9]',225:"2222,8",226:'[2222,"[025-7]"],8',227:'[233,"08"],[2222,"[0289]"],8',228:'[2222,"[279]"],8',229:"2222,8",230:'[34,"[2-46]|8[013]"],[44,5],[7,8]',231:'[133,"[45]"],[233,2],[234,"[23578]"],[7,8,9]',232:"26,8",233:'[234,"[235]"],9',234:'["CCd","[7-9]"],["CDe","[78]"],["CEf","[78]"],10',235:"2222,8",236:"2222,8",237:'[2222,88],[12222,"[26]"],[8,9]',238:"322,7",239:"34,7",240:'[333,"[235]"],[36,"[89]"],9',241:"[2222,0],8",242:'[234,"[02]"],[144,8],9',243:'[234,1],[333,"[89]"],9',244:'[333,"[29]"],9',245:'[333,"44|9[567]"],[34,40],[7,9]',246:"[34,3],7",247:"5",248:'[133,"[246]"],7',249:'[234,"[19]"],9',250:'["2BCC",2],["[7-9]BCC","[7-9]"],9',251:'"[1-59]ACD",9',252:'[17,"24|[67]"],["BA{5,7}","15|28|6[1-35-9]|799|9[2-9]"],[333,"3[59]|4[89]|6[24-6]|79|8[08]|90"],[8,9]',253:"2222,8",254:'["BA{5,7}","[24-6]"],[36,7],["CCd","[89]"],9',255:'["[24]ACD","[24]"],["[67]BCC","[67]"],["[89]BBD","[89]"],9',256:'[45,[202,2024]],[36,"[27-9]|4(6[45]|[7-9])"],[27,"[34]"],9',257:"2222,8",258:'["[28]ACd","2|8[2-7]"],["80ACC",80],9',260:'["[29]AG","[29]"],["800;CC",8],9',261:'[2232,"[23]"],9',262:'"[268]BBBB",9',263:'["7ACd",7],["86BCC","86[24]"],["CCd","2(1[39]|2[0157]|6[14]|7[35]|84)|329"],["[235]ACd","[23]9|54"],["[25]CA{3,5}",["(25|54)8","258[23]|5483"]],["8CF",86],["80ACD",80],[9,10]',264:'["8ACD","8[1235]"],["6ACd",6],["870;CC",870],9',265:'["2BCC",2],[3222,"[1789]"],9',266:"44,8",267:'["7ACC",7],8',268:'[44,"[027]"],8',269:"322,7",27:'[333,860],[234,"[1-9]"],9',290:"[4,5]",291:"133,7",297:"34,7",298:"6,6",299:"222,6",30:'[244,"21|7"],[46,"2(2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])"],[334,"[2689]"],10',31:'["[1-578]ACD","1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"],["[1-5]BCC","1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],["6;H","6[0-57-9]"],["66;G",66],["[89]0AA{4,7}","80|9"],[9,11]',32:"[3222,4],9",33:'[3222,8],[12222,"[1-79]"],9',34:'["[89]00;CC","[89]00"],["[5-9]BBBB","[568]|[79][0-8]"],9',350:"[35,2],8",351:'["2ACD","2[12]"],["[2-46-9]BCC","2[3-9]|[346-9]"],9',352:'[2223,20],[333,6],["BBBBb","2([0367]|4[3-8])"],["BBBA{1,5}","[3-57]|8[13-9]|9(0[89]|[2-579])|(2|80)[2-9]"],9',353:'["AdD",1],["BCd","[2569]|4[1-69]|7[14]"],[333,70],[333,81],[234,"[78]"],[433,1],[2134,8],[244,4],9',354:'[34,"[4-9]"],["3BCC",3],[7,8,9]',355:'["6[6-9];CD",6],9',356:'[44,"[2357-9]"],8',357:"26,8",358:'["CA{3,7}","([1-3]00|[6-8]0)"],["116C",116],["BA{4,10}","[14]|2[09]|50|7[135]"],["AA{4,11}","[25689][1-8]|3"],[6,7,8,9,10,11]',359:'[333,999],["BCd","48|8[7-9]|9[08]"],9',36:'["BCd","[2-9]"],9',370:'[134,"52[0-79]"],[323,"[7-9]"],[26,"37|4([15]|6[1-8])"],[35,"[3-6]"],8',371:'[233,"[269]|8[01]"],8',372:'["[3-79]BD",["[369]|4[3-8]|5([0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5([02]|1([0-8]|95)|5[0-478]|6(4[0-4]|5[1-589]))|7[1-9]"]],["70;BD",70],["8000;CC",[800,8000]],["[458]Cd",["40|5|8(00|[1-5])","40|5|8(00[1-9]|[1-5])"]],[7,8]',373:'[233,"22|3"],["[25-7]BBC","2[13-9]|[5-7]"],["[89]BE","[89]"],8',374:'[26,"1|47"],[26,"4[1349]|[5-7]|9[1-9]"],[35,"[23]"],[323,"8|90"],8',375:'[2322,["17[0-3589]|2[4-9]|[34]","17([02358]|1[0-2]|9[0189])|2[4-9]|[34]"],"$1 $2-$3-$4"],[3222,["1(5[24]|6[235]|7[467])|2(1[246]|2[25]|3[26])","1(5[24]|6(2|3[04-9]|5[0346-9])|7([46]|7[37-9]))|2(1[246]|2[25]|3[26])"],"$1 $2-$3-$4"],[423,["1(5[169]|6[3-5]|7[179])|2(1[35]|2[34]|3[3-5])","1(5[169]|6(3[1-3]|4|5[125])|7(1[3-9]|7[0-24-6]|9[2-7]))|2(1[35]|2[34]|3[3-5])"],"$1 $2-$3"],["[89]BCD","8[01]|9"],["82ADD",82],["800;BA{2,4}",800],9',376:'[33,"[135-9]"],[44,1],[333,6],[6,9]',377:'[2222,"[39]"],[233,4],["6;BBBB",6],[332,8],[8,9]',378:'[2222,"[5-7]"],["0549;F",0,"($1) $2"],8',379:"10",380:'[333,["6[12][29]|(3[1-8]|4[136-8]|5[12457]|6[49])2|(56|65)[24]","6[12][29]|(35|4[1378]|5[12457]|6[49])2|(56|65)[24]|(3[1-46-8]|46)2[013-9]"]],[234,["4[45][0-5]|5(0|6[37])|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]","4[45][0-5]|5(0|6(3[14-7]|7))|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]"]],[45,"[3-6]"],["CCd","[89]"],9',381:'["[23]BA{4,9}","(2[389]|39)0"],["[1-3]AA{5,10}","1|2([0-24-7]|[389][1-9])|3([0-8]|9[1-9])"],["6AA{6,8}",6],["[89]BA{3,9}","[89]"],["7[26];A{4,9}","7[26]"],["7[08]AA{4,9}","7[08]"],[8,9,10]',382:'[233,"[2-57-9]|6[036-9]"],[8,9]',383:'[233,"[23][89]|4[3-79]"],[35,"[89]00"],333,8',385:'["1;DC",1],["[2-5]ACd","[2-5]"],["9ACd",9],["[67]ACd","[67]"],["80[01];Bc",8],["80[01];CC",8],[8,9]',386:'[1322,"[12]|3[24-8]|4[24-8]|5[2-8]|7[3-8]"],["[3-7]ACC","[37][01]|4[0139]|51|6"],["[89][09];A{3,6}","[89][09]"],["[58]BE","59|8[1-3]"],8',387:'[233,"6[1-356]|[7-9]"],[233,"[3-5]","$1 $2-$3"],[2223,6],[8,9]',389:'["2;CD",2],["[347]ACC","[347]"],["[58]BABB","[58]"],8',39:'["BdD","0[26]|55"],["0[26];DE","0[26]"],["0BdD","0[13-57-9][0159]"],["CA{3,6}",["0[13-57-9][0159]|8(03|4[17]|9[245])","0[13-57-9][0159]|8(03|4[17]|9(2|[45][0-4]))"]],["0CCD","0[13-57-9][2-46-8]"],["0CA{2,6}","0[13-57-9][2-46-8]"],["CCd",["[13]|8(00|4[08]|9[59])","[13]|8(00|4[08]|9(5[5-9]|9))"]],[344,3],[9,10]',40:'[234,"[23]1"],[333,"[23][3-7]|[7-9]"],9',41:'["[2-9]ACBB","[2-7]|[89]1"],["[89]BCC","8[047]|90"],[32322,860],9',420:'["[2-9]BCC","[2-8]|9[015-7]"],["96ACCC",96],["9ACCC","9[36]"],9',421:'["2;CCB",2,"$1/$2 $3 $4"],["[3-5]ACBB","[3-5]","$1/$2 $3 $4"],["[689]BCC","[689]"],9',423:'[322,"[237-9]"],[234,69],[333,6],7',43:'["1;A{3,12}",1],["5ADA{4,7}","5[079]"],["CA{3,10}","316|46|51|732|6(5[0-3579]|[6-9])|7([28]0)|[89]"],["DA{3,9}","2|3(1[1-578]|[3-8])|4[2378]|5[2-6]|6([12]|4[1-9]|5[468])|7(2[1-8]|35|4[1-8]|[5-79])"],[10,11,12,13]',44:'["Ee",["1(38|5[23]|69|76|94)","1((38|69)7|5(24|39)|768|946)","1(3873|5(242|39[4-6])|(697|768)[347]|9467)"]],["Df","1([2-69][02-9]|[78])"],[244,["[25]|7(0|6[024-9])","[25]|7(0|6([04-9]|2[356]))"]],[46,7],[334,"[1389]"],10',45:"2222,8",46:'["8;ccB",8],["[1-69]AcBB","1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"],[3222,"1[2457]|2([247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6([124-689]|7[0-2])|9([125-8]|3[0-5]|4[0-3])"],["7ACBB",7],["9[034]ABBC","9[034]"],[32322,"25[245]|67[3-6]"],9',47:'["[489]BBC","[489]"],["[235-7]ABBB","[235-7]"],8',48:'[2322,"[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"],[333,"26|39|5[0137]|6[0469]|7[02389]|8[08]"],9',49:'["BA{3,13}","3[02]|40|[68]9"],["CA{3,12}",["2(0[1-389]|1[124]|2[18]|3[14])|3([35-9][15]|4[015])|906|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(0[1-389]|12[0-8])|3([35-9][15]|4[015])|906|2([13][14]|2[18])|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"]],["DA{2,11}",["[24-6]|3([3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(3(0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(2[135]|4[13578]|9[1346])|5(0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(2[1-7]|4[145]|6[1-5]|7[1-4])|8(21|3[1468]|6|7[1467]|8[136])|9(0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(47|60)[1356]|3(3[46]|46|5[49])[1246]|3[4579]3[1357]"]],[34,138],["EA{2,10}",3],["CA{5,11}",181],["CAA{4,10}","1(3|80)|9"],["Ch","1[67]"],["CA{7,12}",8],[56,[185,1850,18500]],[344,7],[47,"18[68]"],[56,"15[0568]"],[47,"15[1279]"],[38,18],["CBh","1(6[023]|7)"],[427,"15[279]"],[328,15],[7,8,9,10,11,12]',500:"5",501:'[34,"[2-8]",1],["0;800;DC",0,1],7',502:'[44,"[2-7]"],[434,1],8',503:'[44,"[267]"],[344,"[89]"],8',504:'[44,"[237-9]",1],8',505:"44,8",506:'[44,"[24-7]|8[3-9]"],[334,"[89]0",1],8',507:"[44,6,1],8",508:'"[45]ABB",6',509:"224,8",51:"[333,9],9",52:'[244,"33|5[56]|81"],[334,"[2-9]"],[1244,"1(33|5[56]|81)"],[1334,1],[10,11]',53:'["Ag",7],["BA{4,6}","[2-4]"],[17,5],8',54:'[424,["2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(2[24-9]|3[1-59]|47)","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5[56][46]|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(4[35][56]|58[45]|8([38]5|54|76))[4-6]","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|58|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|54(4|5[13-7]|6[89])|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(454|85[56])[46]|3(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2-$3"],[244,1,"$1 $2-$3"],[334,"[23]","$1 $2-$3"],[334,"[68]",1],[1424,["9(2[2-469]|3[3-578])","9(2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(2[24-9]|3[1-59]|47)","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5([56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4[35][56]|58[45]|8([38]5|54|76))[4-6]","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|5(4[46]|8)|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|5(4(4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2 $3-$4"],[1244,91,"$1 $2 $3-$4"],[1334,9,"$1 $2 $3-$4"],[10,11]',55:'[244,"[1-9][1-9]","$1 $2-$3"],[254,"([14689][1-9]|2[12478]|3[1-578]|5[1-5]|7[13-579])9","$1 $2-$3"],["[3589]00;cD","[3589]00"],[10,11]',56:'[144,"2[23]"],[234,"[357]|4[1-35]|6[13-57]"],["9;DD",9],["44;CD",44],["[68]00;Cd","60|8"],["600;CBC",60],["1230;CD",1],[54,219],9',57:'[17,["1(8[2-9]|9[0-3]|[2-7])|[24-8]","1(8[2-9]|9(09|[1-3])|[2-7])|[24-8]"]],[37,3],["1;CG",["1(80|9[04])","1(800|9(0[01]|4[78]))"]],[8,10]',58:"[37,-1,1],10",590:'["[56]90;BD",-1,"$1 $2-$3"],9',591:'[17,"[23]|4[46]"],[8,"[67]"],[324,8],8',592:"34,7",593:'[134,"[247]|[356][2-8]",1],[234,9],["1800;Cd",1],[8,9]',594:"3222,9",595:'["BCd","([26]1|3[289]|4[124678]|7[123]|8[1236])"],["CA{3,6}","[2-9]0"],[36,"9[1-9]"],[234,8700],[333,"[2-8][1-9]"],9',596:"3222,9",597:'[34,"[6-8]",1],7',598:'[233,9],[44,"[24]"],8',599:'[34,"[13-7]"],["9;CD",9],[7,8]',60:'["3;DD",3,"$1-$2 $3"],["[18]ACd","1[02-46-9][1-9]|8","$1-$2 $3"],["1;[36-8]00;BD","1[36-8]0",1],["11;DD",11,"$1-$2 $3"],["15[49];CD",15,"$1-$2 $3"],[9,10]',61:'["BCA{2,4}",16],[333,"14|[45]"],[144,"[2378]"],[433,"1(30|[89])"],9',62:'["BA{5,9}","2[124]|[36]1"],["CA{5,7}",800],["CA{5,8}","[2-79]"],["CdC","8[1-35-9]",1],["CA{6,8}",1],[334,804],[3133,80],["CDe",8,1],[2434,0],[9,10,11,12]',63:'["DA{4,6}",["3(23|39|46)|4(2[3-6]|[35]9|4[26]|76)|544|88[245]|(52|64|86)2","3(230|397|461)|4(2(35|[46]4|51)|396|4(22|63)|59[347]|76[15])|5(221|446)|642[23]|8(622|8([24]2|5[13]))"]],[334,"[89]"],[434,1],["DbCD",1],10',64:'[323,"[89]0"],[134,"24|[346]|7[2-57-9]|9[2-9]","$1-$2 $3"],["CCd","2(10|74)|[59]|80"],["BdD","2[028]"],["BCA{3,5}","2([169]|7[0-35-9])|7|86"],[8,9,10]',65:'["[3689]CD","[369]|8[1-9]"],["1[89]00;CD","1[89]"],["7000;DC",70],["800;CD",80],8',66:'["BCd","14|[3-9]"],[433,1],9',670:"[44,7],8",672:"[24,1],[15,3],[5,6]",673:'"[2-578]BD",7',674:"34,7",675:'[34,"[13-689]|27"],[44,"20|7"],[7,8]',676:'[34,"7[5-9]|8[47-9]"],[43,0],7',677:'[25,"[7-9]"],7',678:'[34,"[579]"],7',679:'[34,"[35-9]"],[434,0],7',680:"34,7",681:"222,6",682:"23,5",683:"4",685:'["8Bd",8],["7AE",7],[6,7]',686:"8",687:'[222,"[2-46-9]|5[0-4]","$1.$2.$3"],6',688:"[6,7]",689:'[2222,"4[09]|8[79]"],[222,44],[6,8]',690:"[4,5,6,7]",691:"34,7",692:"[34,-1,1],7",7:'[4222,["7(1[0-8]|2[1-9])","7(1([0-6]2|7|8[27])|2(1[23]|[2-9]2))","7(1([0-6]2|7|8[27])|2(13[03-69]|62[013-9]))|72[1-57-9]2"]],[5122,["7(1[0-68]|2[1-9])","7(1([06][3-6]|[18]|2[35]|[3-5][3-5])|2([13][3-5]|[24-689]|7[457]))","7(1(0([356]|4[023])|[18]|2(3[013-9]|5)|3[45]|43[013-79]|5(3[1-8]|4[1-7]|5)|6(3[0-35-9]|[4-6]))|2(1(3[178]|[45])|[24-689]|3[35]|7[457]))|7(14|23)4[0-8]|71(33|45)[1-79]"]],[334,7],[3322,"[3489]","$1 $2-$3-$4"],10',81:'[334,800,1],["DBd","0077",1],[424,"0088",1],["DCd","00(37|66)",1],["DDe","00(37|66)",1],["DEf","00(37|66)",1],["DFg","00(37|66)",1],[244,"[2579]0|80[1-9]",1],10',82:'["AdD",2,1],[234,"60|8",1],["BdD","[1346]|5[1-5]",1],[244,"[57]",1],[533,["003","0030"]],[254,5,1],["EdD",0],[5234,0],[9,10]',84:'[244,"2[48]"],[343,"2[0-35-79]"],["[89]ACBB","8(8|9[89])|9"],["1[2689]ACD","1([26]|8[68]|99)"],["[3578]ACD","[357]|8[1-5]"],["86[89];CC","86[89]"],["1[89]00;A{4,6}",["1[89]0","1[89]00"]],[9,10]',850:"[334,1],10",852:'[44,"[235-7]|[89](0[1-9]|[1-9])"],["800;CC",800],["900;BCC",900],["900;A{2,5}",900],8',853:'"[268]CD",8',855:'["BCd","[1-9]"],[433,1],[8,9]',856:"[2233,2],10",86:'["21;DA{4,6}",21],[344,"3(11|7[179])|4([15]1|3[1-35])|5(1|2[37]|3[12]|51|7[13-79]|9[15])|7(31|5[457]|6[09]|91)|8([57]1|98)"],[434,[807,8078]],[344,"1[3-578]"],["10800;CD",[108,1080,10800]],["Ch",950],11',880:'["CA{3,7}","3([67]|8[013-9])|4(6[168]|7|[89][18])|5(6[128]|9)|6(28|4[14]|5)|7[2-589]|8(0[014-9]|[12])|9[358]|(3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(44|66)[01346-9]",1],["DA{3,6}","[13-9]",1],10',886:'["AdD","[25][2-8]|[346]|7[1-9]|8[237-9]"],[234,"[258]"],[333,9],[244,7],9',90:'[334,"512|8[0589]|90"],[3322,["5([0-59]|61)","5([0-59]|616)","5([0-59]|6161)"]],[3322,"[24][1-8]|3[1-9]"],10',91:'[55,["600|7([02-8]|19|9[037-9])|8(0[015-9]|[1-9]|20)|9","600|7([078]|19[0-5]|2([02356-9]|[14][017-9]|9[389])|3([025-9]|1[07-9]|[34][017-9])|4([0-35689]|[47][017-9])|5([02346-9]|1[017-9]|5[017-9])|6([02-9]|1[0-257-9])|9([089]|31|7[02-9]))|8(0([01589]|6[67]|7[02-9])|1([0-57-9]|6[07-9])|2(0[078]|[14][07-9]|[235-9])|3([0357-9]|[126][07-9]|4[1-9])|[45]|6([02457-9]|[136][07-9])|7([078][07-9]|[1-69])|8([0-25-9]|3[07-9]|4[047-9])|9([02-9]|1[027-9]))|9","600|7(0|19[0-5]|2([0235679]|[14][017-9]|8([0-569]|[78][089])|9[389])|3([05-8]|1([089]|7[5-9])|2([5-8]|[0-49][089])|3[017-9]|4([07-9]|11)|9([01689]|[2345][089]|40|7[0189]))|4([056]|1([0135-9]|[23][089]|2[089]|4[089])|2(0[089]|[1-7][089]|[89])|3([0-8][089]|9)|4([089]|11|7[02-8])|7([089]|11|7[02-8])|8([0-24-7][089]|[389])|9([0-7][089]|[89]))|5([0346-9]|1[017-9]|2([03-9]|[12][089])|5[017-9])|6([0346-9]|1[0-257-9]|2([0-4].|[5-9][089])|5([0-367][089]|[4589]))|7(0([02-9]|1[089])|[1-9])|8([0-79]|8(0[0189]|11|8[013-9]|9))|9([089]|313|7([02-8]|9[07-9])))|8(0([01589]|6[67]|7([02-8]|9[05-9]))|1([02-57-9]|1([0-35-9]|4[0-46-9])|6([089]|7[02-8]))|2(0([08]|7[02])|[14]([089]|7[02-8])|[235-9])|3([0357-9]|1([089]|7[02-6])|2([09]|77|8[0-689])|4[1-9]|6([089]|7[02-7]))|[45]|6([02457-9]|1([089]|7[02-8])|3([089]|7[02358])|6([08]|7[02-8]|9[01]))|7(0[07-9]|[1-69]|7([089]|7[02-8])|8([089]|7[02-8]))|8([0-25-9]|3([089]|7[02-8])|4([0489]|7[02-68]))|9([02-9]|1([0289]|7[2-6])))|9"]],[244,"11|2[02]|33|4[04]|79[1-9]|80[2-46]"],[334,"1(2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(12|[2345]1|57|6[13]|7[14]|80)|7(12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"],[433,"1([23579]|[468][1-9])|[2-8]"],[2343,"008"],[334,140],[424,[160,1600]],["DA{2,4};D",[180,1800]],["DdD",[186,1860]],[4333,"18[06]"],10',92:'["Bh","(2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],["Cg",["2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(2[3-8]|98)|(2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"]],[55,58],[37,3],[2333,"2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],[3333,"[24-9]"],10',93:'["[2-7]ACD","[2-7]"],9',94:'[234,7],[333,"[1-689]"],9',95:'["ACd","[12]"],["BCd","[4-7]|8[1-35]"],["ACA{4,6}","9(2[0-4]|[35-9]|4[137-9])"],[144,2],[334,8],[1333,92],[154,9],[8,9,10]',960:'[34,"[3467]|9([1-9]|0[1-9])",1],[334,"[89]00"],7',961:'[133,"[13-69]|7([2-57]|62|8[0-7]|9[04-9])|8[02-9]"],[233,"[7-9]"],[7,8]',962:'["7;DD","7[457-9]"],["Cf","70|8[0158]|9"],9',963:'["BCd","[1-5]"],["9BCC",9],9',964:'["BCd","[2-6]"],[334,7],[9,10]',965:'["Dd","[169]|2([235]|4[1-35-9])|52"],[35,"[25]"],8',966:'[45,9],[234,1],[234,5],["CCd",81],[334,8],9',967:'["7BCC","7[0137]"],9',968:'["CA{4,6}","[58]"],[26,2],[44,"[79]"],8',970:'["5[69]ACC",5],["1[78]00;CC","1[78]"],9',971:'["CA{2,9}","60|8"],[315,"[479]"],[234,5],9',972:'[234,"[57]",1],[433,12,1],[46,159,1],[1333,"1[7-9]",1],["CbCD",15,"$1-$2 $3-$4"],9',973:"44,8",974:'["[3-7]CD","[3-7]"],8',975:'[2222,"1|77"],8',976:'["[12]ABD","[12]1"],["[12]2Af","[12]2[1-3]"],["[12]CE",["[12](27|[3-5])","[12](27|[3-5].)2"]],[44,"[57-9]"],["[12]De",["[12](27|[3-5])","[12](27|[3-5].)[4-9]"]],8',977:'["9BG","9(6[013]|7[245]|8)",1],10',98:'[244,"[1-8]"],["CCd",9],10',992:'[612,[331,3317]],[324,"[34]7|91[78]"],[414,3],[234,"[457-9]"],9',993:'[2222,12,"$1 $2-$3-$4"],[26,6],[3122,"13|[2-5]","$1 $2-$3-$4"],8',994:'[3222,9],[2322,["[12]|365","[12]|365","[12]|365([0-46-9]|5[0-35-9])"]],[2322,"[3-8]"],9',995:'[3222,"[348]"],[333,7],[3222,5],9',996:'[45,"3(1[346]|[24-79])"],[333,"[235-79]"],["CCAc",8],9',998:'[2322,"[679]"],[7,8,9]'}},40265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedError=t.UnimplementedMethod=t.TimeoutError=t.HttpError=t.AggregateError=void 0,t.customError=n,t.hasSupressedQuotaExceededError=function(){return l},t.obtainErrorSummary=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},t.supressQuotaExceededError=function(e){if(null==e||"QuotaExceededError"!==e.name)throw e;l=!0};const r=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function n(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;function i(r){const n=Error.call(this,r);this.message=r,n.name=e,this.name=e,t&&(this.stack=n.stack)}return i.prototype=Object.create(n?n.prototype:r),i.prototype.constructor=i,i}class i extends(n("AggregateError",!0)){constructor(e,t){super(null!=t&&t.length>0?t:function(e){return 0===e.length?"No errors":1===e.length?e[0].message:e.map((e=>"- "+e.message)).join("\n")}(e)),this.errors=e}}t.AggregateError=i;class a extends(n("TimeoutError",!1)){}t.TimeoutError=a;class o extends(n("HttpError",!1)){constructor(e,t){super(e),this.code=t}}t.HttpError=o;class s extends(n("UnimplementedMethod")){}t.UnimplementedMethod=s;let l=!1;class c extends Error{constructor(e,t){super(e),this.inner=t}}t.WrappedError=c},72651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GzipWrapper=void 0,t.createDeflate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new i(e)},t.inflate=function(e){return(0,n.decompressSync)(e)};var n=r(56856);class i extends n.Gzip{constructor(e){super(e),this._chunks=[],this.ondata=(e,t)=>{if(this._chunks.push(e),!t)return;let r=0;this._chunks.forEach((e=>{r+=e.length}));const n=new Uint8Array(r);let i=0;this._chunks.forEach((e=>{n.set(e,i),i+=e.length})),this._result=n}}push(e,t){if(null!=this._result)throw new Error("Tried to push chunk to compressor after final block");e instanceof Uint8Array?super.push(e,t):e instanceof ArrayBuffer?super.push(new Uint8Array(e),t):super.push((0,n.strToU8)(e),t)}result(){if(null==this._result)throw new Error("Tried to access result before adding final block");return this._result}}t.GzipWrapper=i},33344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},92226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"number":return`n:${e}`;case"string":return`s:${e}`;case"boolean":return`b:${e.toString()}`;case"object":{let t=r.get(e);return null==t&&(t=n++,r.set(e,t)),`o:${t}`}default:throw new Error("Unsupported type")}};const r=new WeakMap;let n=0},87614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUM_HEX_IN_LONG=t.HEX_LOWER=void 0,t.bytesToBuffer=function(e){const t=e.buffer;return 0===e.byteOffset&&e.length===t.byteLength?t:t.slice(e.byteOffset,e.byteOffset+e.length)},t.bytesToDebugString=function(e){let t=!0,r=e.length;for(;t&&r;){const n=e[--r];t=32<=n&&n<127}return t?JSON.stringify(String.fromCharCode.apply(String,e)):i(e)},t.createHexLong=s,t.createHexLongFrom32Bits=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=p(e),i=p(t);return`${r?"-":""}0x${n}${i}`},t.hexAt=a,t.hexLongFromNumber=function(e){const t=e<0;return s(t?(-e).toString(16):e.toString(16),t)},t.hexLongIsNegative=d,t.hexLongToHex=c,t.hexOrThrow=o,t.isBiggerHexLong=function(e,t){const r=d(e),n=d(t);if(r!==n)return!r;const i=c(e)>c(t);return r?!i:i},t.negateHexLong=function(e){return d(e)?e.slice(1):"-"+e},t.parseHex=function(e){const t=o(e);if(t.length%2!=0)throw new Error(`parseHex given hex "${t}" which is not a multiple of 8-bits.`);const r=new Uint8Array(t.length>>1);for(let e=0,n=0;e<t.length;e+=2,n++)r[n]=a(t,e)<<4|a(t,e+1);return r.buffer},t.randomHex=function(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t),i(t)},t.toHex=i,t.toLowerCaseHex=function(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];t.push(n[i>>4],n[15&i])}return String.fromCharCode.apply(String,t)};t.NUM_HEX_IN_LONG=16;const r=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],n=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102];function i(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(r[i>>4],r[15&i])}return String.fromCharCode.apply(String,t)}function a(e,t){const r=e.charCodeAt(t);return r<=57?r-48:r<=70?10+r-65:10+r-97}function o(e){if(/[^0-9a-fA-F]/.test(e))throw new Error(`"${e}" is not a valid hex`);return e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=o(e);return u(r,16),`${t?"-":""}0x${l(r,16)}`}function l(e,t){const r=t-e.length;let n=e;for(let e=0;e<r;e++)n="0"+n;return n}function c(e){return e.substring(e.indexOf("0x")+2)}function d(e){return"-"===e[0]}function u(e,t){if(e.length>t)throw new Error(`"${e}" is longer than ${4*t} bits.`)}function p(e){if(e>4294967295||e<-4294967296)throw new Error("uint32ToLowerCaseHex given number over 32 bits");return l((e>=0?e:4294967296+e).toString(16),8)}t.HEX_LOWER=n},89181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflatePhoneRegex=function(e){let t;t="number"==typeof e?String(e).split("").map((e=>".".repeat(Number(e)))).join(")("):e.replace(/;|[a-zA-Z]+/g,(e=>";"===e?")(":e.split("").map((e=>{const t=e.charCodeAt(0);return t>=97?".".repeat(t-96)+"?":".".repeat(t-64)})).join(")(")));return`(${t})`}},52230:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.WA_USER_JID_SUFFIX=t.WA_USER_DOMAIN=t.WA_SERVER_DOMAIN=t.SURVEY_USER_JID=t.STATUS_JID=t.MSGR_USER_JID_SUFFIX=t.MSGR_USER_DOMAIN=t.LID_DOMAIN=t.DEFAULT_DEVICE_ID=t.AUTHOR_SYSTEM=t.AUTHOR_ME=void 0,t.asChatJid=function(e){return e===s?null:e},t.asMulticastJid=function(e){return null==w(e)?e:null},t.asPhoneChatJid=function(e){return e===s?null:e},t.asStatusJid=function(e){return e===s?s:null},t.authorAsPhoneUserJid=function(e){if(e===a||e===o)return null;if(!e.endsWith(h))return null;return e},t.authorAsUserJid=function(e){if(e===a||e===o)return null;return e},t.authorToUserId=function(e,t){return e===a||e===o?t:M(e)},t.createJidUtils=function(e){let{platform:t}=e;const r="msgr"===t?d:h;return{toUserJid:function(e){return`${e}${r}`},toDeviceJid:function(e,t){return`${b(e)}:${t}${r}`},getUserDomain:function(){return r},getGroupCallDomain:function(){return"@call"},defaultDeviceJidForUser:function(e){return`${b(e)}:0${r}`}}},t.defaultLidDeviceJidForLidUserJid=function(e){return P(e,0)},t.defaultMsgrDeviceJidForUser=function(e){return`${b(e)}:0@msgr`},t.defaultPhoneDeviceJidForUser=function(e){return`${b(e)}:0@s.whatsapp.net`},t.extractDeviceIDParts=O,t.extractDeviceId=I,t.extractFromJid=L,t.extractJidFromJidWithType=function(e){return"phoneDevice"===e.jidType||"lidDevice"===e.jidType||"msgrDevice"===e.jidType?e.deviceJid:"lidUser"===e.jidType||"msgrUser"===e.jidType||"phoneUser"===e.jidType?e.userJid:"group"===e.jidType?e.groupJid:"status"===e.jidType?e.statusJid:"call"===e.jidType?e.callJid:(e.jidType,e.broadcastJid)},t.extractPhoneUserJid=function(e){return D(e)},t.extractUserId=M,t.extractUserJid=D,t.fullFormDeviceJidString=function(e){const{user:t,agent:r="0",device:n="0",server:i}=N(e);return`${t}.${r}:${n}@${i}`},t.getGroupDomain=function(){return l},t.getMsgrUserDomain=function(){return d},t.getServerDomain=function(){return"@s.whatsapp.net"},t.getWhatsappUserDomain=function(){return h},t.groupIdFromJid=function(e){if(e.endsWith(l))return e.slice(0,-l.length);throw new Error(`groupId called with non-group jid "${e}"`)},t.interpretAndValidateJid=k,t.interpretAsDeviceId=function(e){return e},t.interpretAsGroupJid=U,t.interpretAsNumber=function(e){return e},t.interpretAsPhoneUserJid=function(e){return e.endsWith(h)?e:null},t.interpretAsUserJid=w,t.isAuthorMe=function(e){return"@me"===e},t.isAuthorSystem=function(e){return"@system"===e},t.isPrimaryDevice=function(e){return 0===I(e)},t.lidFromLidUserJid=R,t.maybeSanitizeLogLineText=function(e){if(!e.includes("@"))return e;return e.replace(C,G)},t.parseJidParts=N,t.phoneNumberFromJid=function(e){if(!e.endsWith(h))throw new Error(`phoneNumberFromJid called with non-user jid "${e}"`);return e.slice(0,-h.length)},t.sanitizeJidForLogging=G,t.stripAgentIdFromPhoneDeviceJid=function(e){const{user:t,device:r="0",server:n}=N(e);return`${t}:${r}@${n}`},t.switchOnChatJidType=F,t.switchOnJidType=function(e,t){if(e===s)return t.status();return F(e,{phoneUser:t.phoneUser,msgrUser:t.msgrUser,lidUser:t.lidUser,group:t.group})},t.switchOnMsgrChatJidType=function(e,t){if(e.endsWith(d))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)},t.switchOnMulticastJidType=function(e,t){if(e===s)return t.multicast(s);return x(e,{user:t.user,group:t.multicast})},t.switchOnPhoneChatJidType=x,t.switchOnPhoneJidType=function(e,t){if(e===s)return t.status();return x(e,{user:t.user,group:t.group})},t.toBroadcastJid=function(e){return`${e}@broadcast`},t.toGroupJid=function(e){if(e.endsWith(l))return e;return`${e}@g.us`},t.toLidDeviceJid=P,t.toMsgrDeviceJid=function(e,t){return`${b(e)}:${t}@msgr`},t.toMsgrUserJid=A,t.toPhoneDeviceJid=function(e,t){return`${b(e)}:${t}@s.whatsapp.net`},t.toPhoneUserJid=function(e){return`${e}@s.whatsapp.net`},t.unsafeCoerceToDeviceId=z,t.unsafeCoerceToDeviceJid=B,t.unsafeCoerceToGroupJid=$,t.unsafeCoerceToLidDeviceJid=Y,t.unsafeCoerceToMsgrDeviceJid=j,t.unsafeCoerceToMsgrUserJid=V,t.unsafeCoerceToPhoneDeviceJid=K,t.unsafeCoerceToPhoneUserJid=H,t.unsafeCoerceToUserJid=W,t.userIdFromJid=b;var i=n(r(84973));t.DEFAULT_DEVICE_ID=0;const a="@me";t.AUTHOR_ME=a;const o="@system";t.AUTHOR_SYSTEM=o;const s="status@broadcast";t.STATUS_JID=s;const l="@g.us",c=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,d="@msgr";t.MSGR_USER_DOMAIN=d;t.MSGR_USER_JID_SUFFIX="msgr";const u=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,p=/^([1-9][0-9]{0,19})@msgr$/,f=/^([1-9][0-9]{0,19}):0?@msgr$/,_="s.whatsapp.net";t.WA_SERVER_DOMAIN=_;const h="@s.whatsapp.net";t.WA_USER_DOMAIN=h;t.WA_USER_JID_SUFFIX="s.whatsapp.net";const g=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,m=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,y="@lid";t.LID_DOMAIN=y;const E=/^([1-9][0-9]{0,14})@lid$/,S=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,v=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,T=/^([0-9a-fA-F]{18,32})@call$/;t.SURVEY_USER_JID="16505361212@s.whatsapp.net";const C=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function A(e){return`${e}@msgr`}function b(e){if(e.endsWith(h))return e.slice(0,-h.length);if(e.endsWith(d))return e.slice(0,-d.length);if(e.endsWith(y))return e.slice(0,-y.length);throw new Error(`userIdFromJid called with non-user jid "${e}"`)}function P(e,t){return`${R(e)}:${t}@lid`}function M(e){return e.split("@")[0]}function O(e){const t=e.split("@")[0].split(":"),r=t[0],n=t[1];return{userId:r,deviceID:parseInt(n,10)}}function I(e){return O(e).deviceID}function w(e){return e.endsWith(h)||e.endsWith(d)||e.endsWith(y)?e:null}function R(e){if(!e.endsWith(y))throw new Error(`lidFromLidUserJid called with non-LidUserJid "${e}"`);return e.slice(0,-y.length)}function D(e){const t=e.split("@");let r=t[0];const n=t[1];return r=r.split(":")[0],r=r.split(".")[0],`${r}@${n}`}function N(e){const[t,r]=e.split("@"),[n,i]=t.split(":"),[a,o]=n.split(".");return{user:a,device:i,agent:o,server:r}}function L(e){switch(e.jidType){case"lidUser":case"msgrUser":case"phoneUser":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"lidDevice":case"msgrDevice":case"phoneDevice":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;default:return(0,i.default)(e.jidType)}}function k(e){if(e===s)return{jidType:"status",statusJid:s};if(m.test(e))return{jidType:"phoneUser",userJid:e};if(p.test(e))return{jidType:"msgrUser",userJid:e};if(f.test(e)){return{jidType:"msgrUser",userJid:A(e.substr(0,e.indexOf(":")))}}return g.test(e)?{jidType:"phoneDevice",deviceJid:e}:u.test(e)?{jidType:"msgrDevice",deviceJid:e}:c.test(e)?{jidType:"group",groupJid:e.endsWith(l)?e:`${e}@g.us`}:v.test(e)?{jidType:"broadcast",broadcastJid:e}:T.test(e)?{jidType:"call",callJid:e}:E.test(e)?{jidType:"lidUser",userJid:e}:S.test(e)?{jidType:"lidDevice",deviceJid:e}:{jidType:"unknown"}}function G(e){const t=k(e);return"unknown"===t.jidType?e:"status"===t.jidType?t.statusJid:(t.jidType,L(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}function U(e){return e.endsWith(l)?e:null}function F(e,t){if(e.endsWith(h))return t.phoneUser(e);if(e.endsWith(d))return t.msgrUser(e);if(e.endsWith(y))return t.lidUser(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function x(e,t){if(e.endsWith(h))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function B(e){return e}function K(e){return e}function j(e){return e}function Y(e){return e}function W(e){return e}function H(e){return e}function V(e){return e}function $(e){return e}function z(e){return e}},14950:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoizeCache=void 0,t.clearAllMemoizeCache=function(){r.forEach((e=>e.clear()))},t.memoizeWithArgs=function(e,t){let r;return function(){r||(r=new n);const i=t(...arguments);let a=r.get(i);return null==a&&(a=e(...arguments),r.set(i,a)),a}};const r=[];class n extends Map{constructor(){super(),r.push(this)}}t.MemoizeCache=n},45095:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(null==e)throw new Error(`Unexpected null or undefined: ${t}`);return e}},5298:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=r;const n=function(){if(t===r){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];t=e.call(this,...i)}return t};return n.reset=()=>{t=r},n};const r={}},40277:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDigits=function(e){const t=e.match(/\d+/g);return null!=t?t.join(""):""},t.findCC=p,t.formatPhone=f,t.formattedPhoneNumber=function(e){return f((0,o.phoneNumberFromJid)(e))},t.isPotentiallyPhoneNumber=function(e){return _.test(e)},t.isPotentiallyValid=function(e,t){if(!/^\d+$/.test(t))return!1;const r=d[e]||u(e);if(!r)return!1;return"number"==typeof r.lengths?r.lengths===t.length:r.lengths.includes(t.length)},t.phoneCC=function(e){return p(e)};var i=n(r(81574)),a=r(89181),o=r(52230);const s=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,l=new Map;class c{constructor(e){let t;if(Array.isArray(e)){t=e[0];let r=e[1];null!=r&&-1!==r&&(Array.isArray(r)||(r=[r]),this._leadins=r.map((function(e){return new RegExp("^("+e+")")}))),this._formatString=e[2]}else t=e;this._regex=new RegExp(`^${(0,a.inflatePhoneRegex)(t)}$`)}_testAndFormat(e){if(!this._regex.test(e)||!this._checkLeadins(e))return!1;if("string"==typeof this._formatString)return e.replace(this._regex,this._formatString);const t=this._regex.exec(e);return null!=t?t.slice(1).join(null!=this._formatString?"-":" "):void 0}_checkLeadins(e){return!this._leadins||this._leadins.some((function(t){return t.test(e)}))}}const d={};function u(e){const t=null!=i.default[e]?JSON.parse(`[${i.default[e]}]`):null;if(null==t)return null;const r=t.pop();return d[e]={lengths:r,formats:t.map((function(e){return new c(e)}))}}function p(e){const t=e.match(s);return t?t[0]:e.length>=3?e.substring(0,3):e}function f(e){let t=l.get(e);return null==t&&(t=function(e){const t=e.length>0&&"+"===e[0]?e.substring(1):e,r=p(t);if(!r)return t;const n=t.substring(r.length),i=d[r]||u(r);if(!i)return"+"+r+" "+n;const a=i.formats;for(let e=0;e<a.length;e++){const t=a[e]._testAndFormat(n);if(null!=t&&!1!==t&&""!==t)return"+"+r+" "+t}return"+"+r+" "+n}(e),l.set(e,t)),t}const _=/^\+*[\d ()]+$/},87040:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeError=function(e){return{success:!1,error:e}},t.makeSuccess=function(e){return{success:!0,value:e}}},57319:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShiftTimer=void 0;function r(e){if(!(e>=0))throw new Error("ShiftTimer must be given delay >= 0")}t.ShiftTimer=class{constructor(e){this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,this._run=()=>{const e=this._arg,t=this._foo;this._rafId=0,this._timer=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,t(e)},this.onOrBefore=(e,t)=>{r(e);const n=Date.now()+e,i=this._upperBound;if(0!==i&&i<n)return;const a=this._lowerBound;0!==a&&n<a||(this._upperBound=n,this._rafId||this._timer&&!(n<this.ts)||this._setDelay(n,e,t))},this.forceRunNow=e=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._arg=e,this._run()},this.cancel=()=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0},this._foo=e}onOrBeforeRepaint(e){if(this._rafId)return;const t=Date.now(),r=this._lowerBound;if(0!==r&&t<r)return;const n=this._upperBound;(0===n||t<n)&&(this._upperBound=t),this._timer&&(clearTimeout(this._timer),this._timer=0),(!this.ts||this.ts>t)&&(this.ts=t),this._arg=e,this._rafId=requestAnimationFrame(this._run)}onOrAfter(e,t){r(e);const n=Date.now()+e,i=this._lowerBound;if(0!==i&&n<i)return;const a=this._upperBound;0!==a&&a<n||(this._lowerBound=n,(!this._timer||this.ts<n)&&this._setDelay(n,e,t))}debounce(e,t){r(e),this._debounce(Date.now(),e,t)}debounceAndCap(e,t,n){r(e),r(t);const i=Date.now(),a=i+t,o=this._lowerBound,s=this._upperBound;(0===o||o<=a)&&(0===s||a<s)&&(this._upperBound=a),this._debounce(i,e,n)}forceRunNowIfScheduled(){this._timer?(clearTimeout(this._timer),this._run()):this._rafId&&(cancelAnimationFrame(this._rafId),this._run())}isScheduled(){return 0!==this._timer||0!==this._rafId}_debounce(e,t,r){const n=e+t,i=this._lowerBound;if(0!==i&&n<i)return;const a=this.ts,o=this._upperBound;0!==o&&o<n?a<o&&this._setDelay(o,o-e,r):a<n&&this._setDelay(n,t,r)}_setDelay(e,t,r){if(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._arg=r,this.ts=e,this._timer){const t=e-this._timerTs;if(-16<t&&t<16)return;clearTimeout(this._timer)}this._timer=setTimeout(this._run,t),this._timerTs=e}}},2821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DO_NOT_RESCHEDULE=void 0,t.awaitTaskPromise=function(e){return l("awaitTaskPromise").awaitTaskPromise(e)},t.deactivate=function(e){s(e,i.DUMMY_UNIXTIME)},t.getScheduledTime=function(e){return l("getScheduledTime").getScheduledTime(e)},t.registerTask=function(e,t){l("registerTask").registerTask(e,t)},t.reschedule=s,t.rescheduleNow=function(e){s(e,(0,i.unixTime)())},t.startScheduler=function(e){__LOG__(2)`startScheduler invoked`,o||(o=new a(e))};var n=r(37178),i=r(92844);t.DO_NOT_RESCHEDULE="no_reschedule";class a{constructor(e){this._started=!1,this._resolvers={},this._timers={},this._timeoutIDs={},this._taskImplementations=new Map,this._scheduledTimeResolver=e.scheduledTimeResolver}_startTask(e){const t=this._taskImplementations.get(e);null!=t?this._scheduledTimeResolver.get(e).then((r=>{const n=null==r;if(!n&&r===i.DUMMY_UNIXTIME)return void __LOG__(2)`Task ${e} deactivated`;let a=null==r?0:1e3*r-(0,i.unixTimeMs)();a=Math.max(0,a),a=Math.min(a,~(1<<31)),__LOG__(2)`Scheduling task ${e} in ${a}ms`,this._timeoutIDs[e]=setTimeout((()=>{delete this._timeoutIDs[e],__LOG__(2)`Firing task ${e}`,t(n).then((t=>{if("no_reschedule"===t)return new Promise((()=>{}));let r;return t===i.DUMMY_UNIXTIME?(__LOG__(2)`Task ${e} complete, deactivating`,delete this._timers[e],r=i.DUMMY_UNIXTIME):t>=0?(__LOG__(2)`Task ${e} complete, waiting ${t}`,delete this._timers[e],r=(0,i.futureUnixTime)(t)):(__LOG__(2)`Task ${e} will try again later`,r=this._getNextRun(e)),this._scheduledTimeResolver.set(e,r)})).then((()=>{this._startTask(e),this._resolvers[e]&&(this._resolvers[e].forEach((e=>e())),delete this._resolvers[e])})).catch((t=>(__LOG__(2)`Task ${e} failed, try again later: ${t}`,this._scheduledTimeResolver.set(e,this._getNextRun(e)).then((()=>{this._startTask(e)})))))}),a)})):__LOG__(4,void 0,new Error)`Tried to start task ${e} before registering its implementation`}_getNextRun(e){return this._timers[e]||(this._timers[e]=(0,n.createTimer)({jitter:.1,max:1e3*i.HOUR_SECONDS,algo:{type:"fibonacci",first:1e3,second:2e3}})),(0,i.futureUnixTime)(Math.round(this._timers[e]()/1e3))}_registerResolver(e,t){this._resolvers[e]||(this._resolvers[e]=[]),this._resolvers[e].push(t)}awaitTaskPromise(e){return new Promise((t=>{this._registerResolver(e,t)}))}reschedule(e,t){this._started?(this._scheduledTimeResolver.set(e,t),null!=this._timeoutIDs[e]&&clearTimeout(this._timeoutIDs[e]),this._startTask(e)):this._scheduledTimeResolver.set(e,t)}registerTask(e,t){this._started||(this._started=!0),this._taskImplementations.set(e,t),this._startTask(e)}getScheduledTime(e){return this._scheduledTimeResolver.get(e)}}let o=null;function s(e,t){l("reschedule").reschedule(e,t)}function l(e){if(o)return o;throw new Error(`TaskScheduler::${e} called before startScheduler`)}},92844:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YEAR_SECONDS=t.WEEK_SECONDS=t.WEEK_MILLISECONDS=t.MonotonicTimer=t.MINUTE_MILLISECONDS=t.MAX_INT=t.HOUR_SECONDS=t.HOUR_MILLISECONDS=t.DUMMY_UNIXTIME=t.DAY_SECONDS=t.DAY_MILLISECONDS=void 0,t.cappedMillisecondsUntil=_,t.castLongIntToUnixTime=function(e){return"number"!=typeof e?(0,n.hexLongIsNegative)(e)?d:c:f(e)},t.castToUnixTime=f,t.delayUntil=function(e){const t=_(e);return new Promise((e=>{setTimeout(e,t)}))},t.futureUnixTime=function(e,t){const r=null!=t?t:h();return f(Math.ceil(r+Math.max(e,0)))},t.getClockSkew=function(){return p},t.happenedWithin=function(e,t){return E(h(),e,t)},t.happenedWithinAt=E,t.isInFuture=function(e){return g(e)>0},t.isOverflowTime=function(e){return e<d||e>c},t.isWithinNext24h=function(e){return e-h()<=a},t.midnight=function(){return f((new Date).setHours(0,0,0,0)/1e3-p)},t.midnightOn=function(e){return f(S(e).setHours(0,0,0,0)/1e3-p)},t.monotonicTime=m,t.monotonicTimeSince=y,t.oldest=function(e,t){return e<t?e:t},t.pastUnixTime=function(e,t){const r=null!=t?t:h();return f(Math.ceil(r-Math.max(e,0)))},t.performanceAbsoluteNow=function(){return Date.now()},t.sameDay=function(e,t){if(Math.abs(e-t)>a)return!1;const r=u.time===e?u.day:S(e+p).getDay(),n=u.time===t?u.day:S(t+p).getDay();return u.time=t,u.day=n,r===n},t.secondsUntil=g,t.setClockSkew=function(e){p=e},t.timeSince_USE_ONLY_IF_APPROVED=function(e){return Math.max(h()-e,0)},t.timeoutFor=function(e,t){const r=h(),n=Math.max(e+t-r,0);return Math.min(1e3*n,~(1<<31))},t.toDate=S,t.toHttpHeaderDate=function(e){return S(e).toUTCString()},t.unixTime=h,t.unixTimeMs=function(){return Date.now()-1e3*p},t.unskewedDate_USE_ONLY_IF_APPROVED=function(){return new Date};var n=r(87614);const i=3600;t.HOUR_SECONDS=i;const a=86400;t.DAY_SECONDS=a;t.WEEK_SECONDS=604800;t.YEAR_SECONDS=31536e3;t.MINUTE_MILLISECONDS=6e4;const o=36e5;t.HOUR_MILLISECONDS=o;const s=864e5;t.DAY_MILLISECONDS=s;t.WEEK_MILLISECONDS=6048e5;const l=1<<31;t.DUMMY_UNIXTIME=l;const c=2147483647;t.MAX_INT=c;const d=-2147483647,u={time:0,day:-4};let p=0;function f(e){return Math.max(d,Math.min(0|e,c))}function _(e){const t=Math.max(e-h(),0);return Math.min(1e3*t,~(1<<31))}function h(){return f(Date.now()/1e3-p)}function g(e){return Math.max(e-h(),0)}function m(){return performance.now()}function y(e){return Math.floor(performance.now()-e)}function E(e,t,r){return Math.abs(e-t)<=r}function S(e){return new Date(1e3*e)}t.MonotonicTimer=class{constructor(){const e=m();this._initTime=e,this._startTime=e}reset(){this._startTime=m()}elapsed(){return y(this._startTime)}cumulative(){return y(this._initTime)}}},32428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatArrayBuffers=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let a=0;return t.forEach((e=>{i.set(new Uint8Array(e),a),a+=e.byteLength})),i.buffer}},95024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBuffersDeepEqual=function(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0}},30138:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=[],n=e.length,i=t.length,a=Math.max(n,i);for(let o=0;o<a;o++)o<n&&r.push(e[o]),o<i&&r.push(t[o]);return r}},48206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMoveMutate=t.arrayMove=void 0;const r=function(e,t,r){const n=r<0?e.length+r:r,i=e.splice(t,1)[0];e.splice(n,0,i)};t.arrayMoveMutate=r;t.arrayMove=function(e,t,n){const i=e.slice();return r(i,t,n),i}},20177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.b64Equal=function(e,t){const r=e.length,n=t.length;switch(r-n){case-2:return 61===t.charCodeAt(r)&&61===t.charCodeAt(r+1)&&t.substr(0,r)===e;case-1:return 61===t.charCodeAt(r)&&t.substr(0,r)===e;case 0:return e===t;case 1:return 61===e.charCodeAt(n)&&e.substr(0,n)===t;case 2:return 61===e.charCodeAt(n)&&61===e.charCodeAt(n+1)&&e.substr(0,n)===t;default:return!1}}},13353:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=atob(e);let n=0;for(let e=0;e<r.length;e++){const i=r.charCodeAt(e);n=((n<<4)+(i>>4))%t,n=((n<<4)+(15&i))%t}return n}},78403:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return null;const t=e.replace(/\s+$/,"");e!==t&&Math.random()<1e-5&&(__LOG__(3,void 0,void 0,!0)`base64 sanitized due to extra whitespace`,SEND_LOGS("media-key-sanitize"));return t}},27194:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}},93131:(e,t,r)=>{"use strict";let n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.dir=function(e){!function(){if(n)return;const e=r(12182).D,t=e.length/2;n=new Int32Array(t),i=new Int32Array(t);for(let r=0,a=0;r<t;r++,a+=2)n[r]=e[a]+(0===r?0:n[r-1]),i[r]=e[a+1]}();for(let t=0;t<e.length;t++){let r=0|e.charCodeAt(t);if(55296<=r&&r<56320){if(++t===e.length)break;const n=e.charCodeAt(t);if(!(56320<=n&&n<57344))continue;r=65536+((1023&r)<<10|1023&n)}else if(56320<=r&&r<57344)continue;if(r<n[0])continue;const a=0|n.length;let o=0,s=a-1|0;for(;o<s;){const e=s+o>>1;if(n[e]>r)s=e-1|0;else{if(n[e+1]>r){s=e;break}o=e+1|0}}const l=i[s],c=n[s]+Math.abs(l)|0;if(r<c)return l<0?"rtl":"ltr"}return}},12182:(e,t)=>{"use strict";t.D=void 0;t.D=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,49,55,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-3,4,-24,28,-1,10,-1,4,-1,6,-43,46,-119,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,8,2,7,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,4,1,13,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,17,1,8,2,3,11,12,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,11,12,3,4,41,43,4,9,3,4,3,4,2,6,14,18,26,28,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,2,5,6,24,25,1,2,10,11,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,89,96,5,7,34,35,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,60,67,43,45,11,22,1,14,1,8,4,5,6,7,3,5,1,6,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,43,44,94,95,48,96,45,48,48,64,28,31,50,65,12,16,167,171,99,101,31,32,6592,6656,20989,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,55,57,9,51,13,14,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,13,14,38,46,25,36,2,13,30,36,48,49,2,6,2,4,16,17,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,58,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,86,2,67,45,176,29,32,49,96,36,45,30,35,38,48,30,31,37,41,14,56,158,160,10,16,36,40,36,40,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-484,488,-8,18,-294,325,-44,46,-153,164,-175,175,1,2,54,69,7,31,10,28,49,53,2,4,7,18,1,3,25,32,10,19,36,41,1,10,18,26,35,36,3,14,52,61,10,14,2,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,163,56,64,2,5,1,2,21,22,1,2,3,33,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,2,1,8,10,64,27,32,2,6,1,10,16,208,47,56,1,3,1,101,83,95,8,10,1,3,8,9,2,3,30,31,2,6,1,2,4,5,3,12,10,80,8,10,42,50,4,5,4,31,1,7,2,4,40,46,2,6,8,17,1,7,2,5,46,59,1,3,9,38,57,320,9,10,38,52,8,18,29,32,32,57,1,8,1,3,1,76,7,8,2,3,38,59,1,10,10,16,6,7,2,3,37,41,2,3,1,2,1,8,10,320,19,21,4,187,1,16,21,63,923,1025,111,112,5,16,196,2944,1071,1072,9,4048,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,707,91,192,75,80,56,67,13,77,2,3,1,13,2,16,6136,6144,1238,1280,9,8960,287,336,3,20,4,12,396,2704,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,306,20,128,25,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,1659,45,55,7,9,10,14,2,370,44,48,10,1296,-208,215,-109,116,-1445,1447,-270,542,31,32,58,64,61,118,29,42,44,48,9,16,2,3504,42718,42752,4149,4160,222,224,5762,5776,7473,10576,542,2048,4939,786432,65534,65536,65534]},48447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){if(e<=0)throw new RangeError("BitArray:numBits should be positive");this._numBits=e,this._array=new Uint8Array(Math.ceil(this._numBits/8))}get(e){const[t,r]=this._getArrayIndexOffset(e);return Boolean(this._array[t]>>r&1)}set(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]|=1<<r}unset(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]&=~(1<<r)}toggle(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]^=1<<r}clear(){this._array=new Uint8Array(Math.ceil(this._numBits/8))}toArray(){const e=[];for(let t=0;t<this._numBits;t++)e.push(this.get(t));return e}toString(){return this.toArray().map((e=>e?"1":"0")).join("")}get length(){return this._numBits}_getArrayIndexOffset(e){if(e<0||e>=this._numBits)throw new RangeError("BitArray:index out of bounds");const t=Math.floor(e/8);return[t,e-8*t]}}},42430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LruCache=void 0;var n=r(57319);class i{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}t.LruCache=class{constructor(e){var t;this._keyToNode=new Map,this.purgeNow=()=>{for(let e=this._dummyTail.prev;this._currentSize>this._sizeLimit&&e!==this._dummyHead;e=e?e.prev:null){if(null==e)throw new Error("The linked list is not constructed properly.");const{key:t,value:r}=e;this._shouldEvict(t,r)&&(this.delete(t),this._onEvict&&this._onEvict(t,r))}this._onPurge&&this._onPurge(this._keyToNode)},this._sizeLimit=e.sizeLimit,this._getSize=e.getSize,this._onPurge=e.onPurge,this._shouldEvict=null!==(t=e.shouldEvict)&&void 0!==t?t:()=>!0,this._onEvict=e.onEvict,this._onAdd=e.onAdd,this._onDelete=e.onDelete,this._currentSize=0,this._dummyHead=new i("dummy-head",null),this._dummyTail=new i("dummy-tail",null),this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._purgeTimer=new n.ShiftTimer((()=>this.purgeNow()))}get(e){if(!this._keyToNode.has(e))return null;const t=this._keyToNode.get(e);if(null==t)return null;const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r);const i=this._dummyHead.next;if(null==i)throw new Error("The linked list is not constructed properly.");return this._dummyHead.next=t,i.prev=t,t.prev=this._dummyHead,t.next=i,t.value}has(e){return this._keyToNode.has(e)}touch(e){this.get(e)}put(e,t){0!==this._sizeLimit&&(this._getSize(t)>this._sizeLimit?__LOG__(3)`Blob size is larger than the limit of the whole store.`:(this.delete(e),this._add(e,t),this.schedulePurge()))}_add(e,t){const r=new i(e,t);this._keyToNode.set(e,r);const n=this._dummyHead.next;if(null==n)throw new Error("The linked list is not constructed properly.");this._dummyHead.next=r,n.prev=r,r.prev=this._dummyHead,r.next=n,this._currentSize+=this._getSize(t),this._onAdd&&this._onAdd(e,t)}delete(e){if(!this._keyToNode.has(e))return;const t=this._keyToNode.get(e);if(null==t)return;this._currentSize-=this._getSize(t.value);const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r),this._keyToNode.delete(e),this._onDelete&&this._onDelete(e,t.value)}clear(){this._keyToNode.clear(),this._currentSize=0,this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._onClear&&this._onClear()}schedulePurge(){this._purgeTimer.onOrBefore(1e3)}}},9006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t){this._valueFn=e,this._heap=[],this._load(t)}size(){return this._heap.length}_load(e){(null==e?void 0:e.length)&&e.forEach((e=>{this.push(e)}))}_swap(e,t){const r=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=r}_siftUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return;const t=this._getParent(e),r=2*t+1,n=2*t+2,i=this._heap.length;if(e>=i)return;let a=this._getVal(t),o=t;if(r<i){const e=this._getVal(r);a>e&&(o=r,a=e)}if(n<i){a>this._getVal(n)&&(o=n)}o!==t&&(this._swap(o,t),this._siftUp(t))}_doHeapify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=2*e+1,r=2*e+2,n=this._heap.length;if(e>=n)return;let i=this._getVal(e),a=e;if(t<n){const e=this._getVal(t);i>e&&(a=t,i=e)}if(r<n){i>this._getVal(r)&&(a=r)}a!==e&&this._swap(a,e),t<n&&this._doHeapify(t),r<n&&this._doHeapify(r)}_getVal(e){return this._valueFn(this._heap[e])}_getParent(e){return e%2==0?(e-2)/2:(e-1)/2}push(e){this._heap.push(e);const t=this._heap.length-1;this._siftUp(t)}pull(){const e=this._heap.shift();return this.heapify(),e}heapify(){this._doHeapify(0)}peek(){return this._heap[0]}}},55205:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(45095));class a{constructor(e){this._children={},this._indices=[],e&&(this._data=e)}static fromBackwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addBackwardsString(t,r)),new a(t))._optimize()}addBackwardsString(e,t){let r=e.length-1,n=this;for(;r>=0;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r--}return n._addIndex(t),this}static fromForwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addForwardsString(t,r)),new a(t))._optimize()}addForwardsString(e,t){let r=0,n=this;for(;r<e.length;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r++}return n._addIndex(t),this}set(e,t){return this._children[e]=t,t}get(e){return this._children[e]}getChildren(){return Object.keys(this._children).map((e=>({prefix:e,node:(0,i.default)(this.get(e),"this.get(prefix)")})))}hasChildren(){return!function(e){for(const t in e)return!1;return!0}(this._children)}search(e){const t=this._data;if(!t)return[];let r=this;for(let t=0;t<e.length&&r;t++){const n=e[t];r=r.get(n)}if(!r)return[];return r.getIndices().map((e=>t[e]))}_addIndex(e){this._indices.push(e)}getIndices(){const e=this._indices,t=Object.keys(this._children);return 1===t.length&&0===this._indices.length?this._children[t[0]].getIndices():e}_optimize(){if(!this.hasChildren())return this;const e=Object.keys(this._children),t=this._children[e[0]]._indices;return e.forEach((e=>{this._children[e]._optimize()})),1===e.length&&this._indices.length===t.length&&(this._indices=[]),this}testOnlyGetChildrenProperty(){return this._children}testOnlyGetIndicesProperty(){return this._indices}}t.default=a},63438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,r)=>e===t[r]))}},62971:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.exponentialBackoffIterator=function*(e){const{factor:t,jitter:r,maxTimeout:n,minTimeout:s,retries:l}=(0,i.default)((0,i.default)({},o),e);let c=0;for(const e of(0,a.default)(t)){if(c++,c>l)return;const t=Math.random()*r*2-r+1;yield Math.min(s*e*t,n)}};var i=n(r(73982)),a=n(r(3691));const o={factor:2,jitter:0,maxTimeout:1/0};t.defaults=o},3691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function*(e){let t=1;for(;;)yield t,t*=e}},85396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIterator=function*(e,t){let r=0;for(const n of e)t(n,r)&&(yield n),r++},t.first=function(e){for(const t of e)return t;return},t.iteratorFromArray=function*(e){for(const t of e)yield t},t.mapIterator=function*(e,t){let r=0;for(const n of e)yield t(n,r),r++},t.rangeIterator=function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(0===r)throw new TypeError("Step can't be zero.");if(r>0){if(e>t)return;for(let n=e;n<t;n+=r)yield n}else{if(e<t)return;for(let n=e;n>t;n+=r)yield n}},t.takeIterator=function*(e,t){if(t<0)throw new TypeError("Count must be a positive integer");let r=0;for(const n of e){if(r>=t)return;yield n,r++}}},29984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNonZeroNumber=function(e){return null!=e&&0!==e&&!isNaN(e)}},65345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r,n){r(t).forEach((t=>e(t,r,n))),n(t)}},65023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astralRange=void 0,t.length=function(e){const t=e.match(r);return t?t.length:0},t.substring=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i=e.match(r);if(!i)return"";return i.slice(Math.max(0,t),Math.max(0,n)).join("")},t.toArray=function(e){return e.match(r)||[]};const r=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;t.astralRange=r},64331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.codePointAt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.codePointAt)return e.codePointAt(t);let r=e.charCodeAt(t);if(r>=55296&&r<=56319){const n=e.charCodeAt(t+1);n>=56320&&n<=57343&&(r=65536+(r-55296<<10)+(n-56320))}return r},t.firstNCodepoints=function(e,t){return i(e||"",0,t)},t.firstNEncodedBytes=function(e,t){if(null==t)return e;if(encodeURI(e).length<=t)return e;let r=0;const n=a(e),o=n.length;for(let a=0;a<o;a++){const o=n[a],s=encodeURI(o).length;if(r+s>t)return i(e,0,a);r+=s}return e},t.numCodepoints=function(e){return(0,n.length)(e||"")},t.substring=i,t.toArray=a;var n=r(65023);function i(e,t,r){if(null==e||""===e)return"";const i=t||0,a=null==r?1/0:r;return e.length,0===i&&a===1/0?e:e.length>=5e3&&a/e.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange);let a,o="",s=0;do{a=i.exec(e),a&&(o+=a[0]),s++}while(a&&s<r);return o}(e,0,a):(0,n.substring)(e,i,a)}function a(e,t,r){const i=e||"",a=t||0,o=null==r?1/0:r;return i.length>=5e3&&o/i.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange),a=[];let o;do{o=i.exec(e),o&&a.push(o[0])}while(o&&a.length<r);return a}(i,0,o):(0,n.toArray)(i).slice(a,o)}},82572:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,s){const l=e.split(".");let p,f=!1;if(l.forEach((e=>{if(f=!e.match(u),f){if(p)return null;p=e}})),null==p||f)return null;const _=[];let h=!0;const g=(0,i.toArray)(p);for(let e=0;e<g.length;e++){const t=g[e];if(h=h&&d(t),!h&&a[t]){if(_.length>=2)return null;_.push(t)}}if(h)return c(r)||c(t)||s.some((e=>function(e){return o.has(e)}(e)))?null:new Set(g);if(!_.length)return null;const m=_.filter((e=>{const i=a[e];if(null==i)return!1;if(s.some((e=>i.includes(e))))return!1;const o=new Set;for(let e=0;e<i.length;e++){const t=n.LANGUAGE_TO_REGIONS[i[e]];if(null!=t)for(let e=0;e<t.length;e++)o.add(t[e])}return!o.has(r)&&!o.has(t)}));return m.length?new Set(m):null};var n=r(36349),i=r(65023);const a={:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],:["mt"],:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],:["az","crh","tr"],:["lv"],:["dsb","nv","pl","hsb"],:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],:["naq"],:["naq"],:["liv"],:["fmp","dud","tmh"],:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],:["tzm","kab","okr","shi","tmh","taq"],:["tzm","kab","shi"],:["tzm","kab","shi","tmh","taq"],:[],:["izi","yaz","blt","vi"],:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},o=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),s=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),l="";function c(e){return s.has(e)}function d(e){return l.includes(e)}const u=new RegExp("^[a-z0-9-]+$")},36349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANGUAGE_TO_REGIONS=void 0;t.LANGUAGE_TO_REGIONS={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]}},53659:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,o){const s=e.match(a),l=s&&s[1];if(null==l)return null;const c=(0,i.phoneCC)(r),d="whatsapp"===t?"":(0,i.phoneCC)(t),u=o.map((e=>e.toLowerCase()));return(0,n.findSuspiciousCharacters)(l,d,c,u)};var n=r(82572),i=r(40277);const a=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i},46269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castTypedArrays=function(e,t){if(t instanceof e)return t;if("string"==typeof t)return new e((0,n.decodeB64)(t));return new e(t)};var n=r(15688)},60977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatTypedArrays=function(e,t){const r=t.reduce(((e,t)=>e+t.length),0),n=new e(r);let i=0;return t.forEach((e=>{n.set(e,i),i+=e.length})),n}},91560:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.ParsableXmlNode=void 0,t.convertBytesToUint=o;var i=n(r(33344)),a=r(56225);function o(e,t){let r=0;for(let n=0;n<t;n++)r=256*r+e[n];return r}t.ParsableXmlNode=class{constructor(e,t){this._name=e,this._node=t,this._children=Array.isArray(t.content)?t.content.map((t=>new this.constructor(e,t))):null}name(){return this._name}node(){return this._node}hasAttr(e){return(0,i.default)(this._node.attrs,e)}assertTag(e){this._node.tag!==e&&this.throw(`to be <${e}>`)}tag(){return this._node.tag}maybeChild(e){const t=this._children;if(!t)return null;for(let r=0;r<t.length;r++)if(t[r].tag()===e)return t[r];return null}hasChild(e){return!!this.maybeChild(e)}child(e){const t=this.maybeChild(e);return t||this.throw(`to have child <${e}>`)}assertAttr(e,t){const r=this.attrString(e);r!==t&&this.throw(`to have "${e}"="${t}", but instead has "${r}"`)}attrString(e){return(0,i.default)(this._node.attrs,e)?this.decodeAsString(this._node.attrs[e]):this.throw(`to have attribute "${e}"`)}forEachAttributeKey(e){const t=this._node.attrs;Object.keys(t).forEach((t=>e(t)))}maybeAttrString(e){return this.hasAttr(e)?this.decodeAsString(this._node.attrs[e]):null}maybeAttrInt(e,t,r){return this.hasAttr(e)?this.attrInt(e,t,r):null}attrEnumValues(e,t,r){const n=new Set(t),i=this.attrString(e);if(!n.has(i)){if(null!=r)return r;const t=Array.from(n).join("|");return this.throw(`to have "${e}"={${t}} but has value "${i}"`)}return i}attrEnum(e,t){const r=this.attrString(e);if(!(0,i.default)(t,r)){const n=Object.keys(t).join("|");return this.throw(`to have "${e}"={${n}} but has value "${r}"`)}return t[r]}attrEnumOrNullIfUnknown(e,t){const r=this.attrString(e);return(0,i.default)(t,r)?t[r]:null}attrEnumOrDefault(e,t,r){return this.hasAttr(e)?this.attrEnum(e,t):r}attrInt(e,t,r){const n=this.attrString(e);return this._parseInt(n,e,t,r)}_parseInt(e,t,r,n){const i=parseInt(e,10);return Number.isNaN(i)?this.throw(`to have "${t}"={integer} but has value "${e}"`):void 0!==r&&i<r?this.throw(`to have "${t}"={at least ${r}} but has value ${i}`):void 0!==n&&i>=n?this.throw(`to have "${t}"={below ${n}} but has value ${i}`):i}forEachChild(e){const t=this._children;if(t)t.forEach((t=>e(t)));else if(null!=this._node.content)return this.throw("to have children")}forEachChildWithTag(e,t){this.forEachChild((r=>{r.tag()===e&&t(r)}))}mapChildren(e){const t=this._children;return t||null==this._node.content?t?t.map((t=>e(t))):[]:this.throw("to have children")}mapChildrenWithTag(e,t){const r=this._children;return r||null==this._node.content?r?r.filter((t=>t.tag()===e)).map((e=>t(e))):[]:this.throw("to have children")}mapFirstChild(e){const t=this._children;return t&&0!==t.length?e(t[0]):this.throw("to have children")}hasContent(){return!this._children&&!!this._node.content}hasChildren(){return null!=this._children}getChildren(){return this._children}getNode(){return this._node}unsafeSetChildren(e){this._children=e}unsafeSetNodeContent(e){this._node.content=e}contentUint(e){return o(this.contentBytes(e),e)}contentBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._children)return this.throw("to have binary content, but has children instead");if(null!=this._node.content){const t=this._node.content;return-1!==e&&t.length!==e?this.throw(`to be ${e} bytes, but got ${t.length} instead`):t}return this.throw("to have content")}contentString(){return this._children?this.throw("to have string content, but has children instead"):null!=this._node.content?this._node.content:this.throw("to have content")}contentInt(e,t){const r=this.contentString();return this._parseInt(r,"content",e,t)}contentEnum(e){const t=this.contentString();if(!(0,i.default)(e,t)){const r=Object.keys(e).join("|");return this.throw(`to have content {${r}} but has value "${t}"`)}return e[t]}decodeAsString(e){if("string"!=typeof e)throw new Error(`decodeAsString: attribute is ${typeof e} not a string: ${e}`);return e}throw(e){throw new a.XmlParsingFailure(this._name,`expected <${this._node.tag}> ${e}`)}toString(){return this._node.toString()}}},17890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),r=t.length;let n=!1,i=0,a="",o=0;const s=["\n"];for(o=0;o<100;o++)s.push(s[o]+"    ");const l=function(e,t){const r=/^<[\w:\-.,]+/.exec(e[t-1]),n=/^<\/[\w:\-.,]+/.exec(e[t]);return null!=r&&null!=n&&r[0]===n[0]};for(o=0;o<r;o++)t[o].search(/<!/)>-1?(a+=s[i]+t[o],n=!0,(t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1||t[o].search(/!DOCTYPE/)>-1)&&(n=!1)):t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1?(a+=t[o],n=!1):l(t,o)?(a+=t[o],n||i--):t[o].search(/<\w/)>-1&&-1===t[o].search(/<\//)&&-1===t[o].search(/\/>/)?a=a+=n?t[o]:s[i++]+t[o]:t[o].search(/<\w/)>-1&&t[o].search(/<\//)>-1?a=a+=n?t[o]:s[i]+t[o]:t[o].search(/<\//)>-1?a=a+=n?t[o]:s[--i]+t[o]:t[o].search(/\/>/)>-1?a=a+=n?t[o]:s[i]+t[o]:t[o].search(/<\?/)>-1||t[o].search(/xmlns:/)>-1||t[o].search(/xmlns=/)>-1?a+=s[i]+t[o]:a+=t[o];return"\n"===a[0]?a.slice(1):a}},74277:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlNode=void 0,t.attrsToString=a,t.uint8ArrayToDebugString=o;var n=r(87614);const i={};function a(e){const t=Object.keys(e);let r="";for(let n=0;n<t.length;n++){const i=t[n];r+=` ${i}="${e[i].toString()}"`}return r}function o(e){let t="";return t=0===e.length?"\x3c!-- empty binary --\x3e":e.length<50?(0,n.bytesToDebugString)(e):`\x3c!-- ${e.length} bytes --\x3e`,t}t.XmlNode=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=a(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:t instanceof Uint8Array?e+=`>${o(t)}</${this.tag}>`:e+=null!=t?`>${String(t)}</${this.tag}>`:" />",e}}},56225:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlParsingFailure=void 0;t.XmlParsingFailure=class{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmlParsingFailure: ${this.parser}: ${this.reason}`}}},28970:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=void 0;var n=r(69719),i=r(57319),a=r(21282);t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=113760892;const o={putBuffer:()=>Promise.resolve()};t.Wam=class{constructor(e){this._pending=[],this._globals=new Map,this._initialized=!1,this._buffers=new Map,this._streamId=-1,this._sink=o,this._getNextSequenceNumber=null,this.deinitialize=()=>{this._initialized=!1,this._pending=[],this._globals.clear(),this._buffers=new Map,this._streamId=-1,this._sink=o,this.serializePending.cancel(),this.finalizeBuffers.cancel()},this.enqueueEvent=(e,t,r,n,i,a)=>{this._pending.push({type:1,id:e,commitTime:t,psIdIntValue:r,weight:i,fields:n,resolve:a}),this._initialized&&this.serializePending.onOrBefore(3e3)},this.enqueueAttributesUpdate=e=>{const t={type:2,delta:[]};e.forEach(((e,r)=>{void 0!==e&&t.delta.push([r,e])})),t.delta.length>0&&(__LOG__(2)`WAM: Enqueued ${t.delta.length} attribute keys for update`,this._pending.push(t))},this.finalizeBuffers=new i.ShiftTimer((()=>{this._finalizeBuffers()})),this.serializePending=new i.ShiftTimer((()=>{this._serializePending()})),this.forceSerializePending=()=>{this._initialized&&this._hasPendingEvents()&&this.serializePending.forceRunNow()},this._channel=e}initialize(e,t,r,n){if(this._initialized)return __LOG__(4,void 0,new Error,!0)`WAM: Failed to initialize already initialized WAM`,void SEND_LOGS("wam-initialize");this._options=n,this._streamId=e,this._sink=r,this._getNextSequenceNumber=t,this._hasPendingEvents()&&this.serializePending.forceRunNow(),this._initialized=!0,__LOG__(2)`WAM: Initialized with stream id ${this._streamId}`}_finalizeBuffers(){this._buffers.forEach((e=>{e.finalize()})),this._buffers.size>0&&this.serializePending.onOrBefore(3e3)}_getKeyHashIntForSequence(e){var t;return(null===(t=this._options)||void 0===t?void 0:t.multipleSequences)?0===e?"null-psid":e:"regular"}_maybeCreateNewBuffer(e){let t=this._buffers.get(e);if(t)return t;const r=this._getKeyHashIntForSequence(e);if(null==this._getNextSequenceNumber)return __LOG__(4,void 0,new Error,!0)`WAM: Sequence number generator not initialised for channel ${this._channel}`,void SEND_LOGS("wam-serializePending");const n=this._getNextSequenceNumber(r);if(t=new a.WamBuffer(this._channel,this._streamId,n,this._globals),this._buffers.set(e,t),"regular"!==e)if(null==this._privateStatsIds)__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats ids`,SEND_LOGS("wam-serializePending");else{const r=0===e?"none":this._privateStatsIds.get(e);null==r?(__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats id`,SEND_LOGS("wam-serializePending")):t.writeGlobal(6005,r)}return t}_serializePending(){const e=[];this.finalizeBuffers.onOrBefore(3e5);const t=new Map;let r=-1;this._pending.forEach(((n,i)=>{if(1===n.type){let o=!0;t.forEach((e=>{(0,a.canWriteGlobal)(e)||(o=!1)}));const s=(0,a.canWriteEvent)(n.fields);if(s&&o){let e;"regular"===this._channel?e=this._maybeCreateNewBuffer("regular"):(this._channel,null==n.psIdIntValue?(__LOG__(4,void 0,new Error,!0)`A WAM event in channel private was dropped before serialization. Reason: missing psIdIntValue in the event payload`,SEND_LOGS("wam-serializePending")):e=this._maybeCreateNewBuffer(n.psIdIntValue)),null!=e&&(t.forEach(((e,t)=>{const r=this._globals.get(t);void 0!==r&&r===e||(this._buffers.forEach((r=>r.writeGlobal(t,e))),this._globals.set(t,e))})),t.clear(),e.writeEvent(n.commitTime,n.id,n.fields,n.weight))}else __LOG__(3)`A WAM event in channel ${this._channel} was dropped before serialization. Event correct: ${s}, pending attributes correct: ${o}`;null!=n.resolve&&e.push(n.resolve),r=i}else{n.type;for(let e=0;e<n.delta.length;++e){const[r,i]=n.delta[e];t.set(r,i)}}}));let i=!1;this._buffers.forEach((e=>{(e.isFinalized()||e.getSize()>65536)&&(i=!0)}));const o=[];this._buffers.forEach(((e,t)=>{e.hasEvents()?o.push([e.getKey(),e.peek(),this._getKeyHashIntForSequence(t)]):__LOG__(3)`Skipping putting buffer to sink, as it does not contain any events`}));const s=(0,n.promiseEach)(o,(e=>{let[t,r,n]=e;return this._sink.putBuffer(t,r,i,n)})).then((()=>{e.forEach((e=>{e()}))}));return this._pending=this._pending.slice(r+1),i&&(this._buffers=new Map,this.finalizeBuffers.cancel()),s}_hasPendingEvents(){return this._pending.length>0&&this._pending.some((e=>1===e.type))}isInitialized(){return this._initialized}updatePrivateStatsIds(e){if("private"!==this._channel)return __LOG__(4,void 0,new Error,!0)`WAM: Tried to set private stats ids on a non-private channel`,void SEND_LOGS("wam-updatePrivateStatsIds");this._privateStatsIds=e}}},21282:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamBuffer=void 0,t.canWriteEvent=function(e){const t=c(e);for(let r=0;r<=t;r+=3){const t=e[r+2];if(null!=t){if(e[r+1]===i.TYPES.INT&&isNaN(t))return!1}}return!0},t.canWriteGlobal=function(e){if("number"==typeof e)return!isNaN(e);return!0};var n=r(8584),i=r(68518);function a(e,t,r,n){0===n?l(e,t,16|r):1===n?l(e,t,32|r):-128<=n&&n<128?(l(e,t,48|r),e.writeInt8(n)):-32768<=n&&n<32768?(l(e,t,64|r),e.writeInt16(n)):-2147483648<=n&&n<2147483648?(l(e,t,80|r),e.writeInt32(n)):(l(e,t,96|r),e.writeInt64(n))}function o(e,t,r,n){l(e,t,112|r),e.writeFloat64(n)}function s(e,t,r,i){const a=(0,n.numUtf8Bytes)(i);a<256?(l(e,t,128|r),e.writeUint8(a)):a<65536?(l(e,t,144|r),e.writeUint16(a)):(l(e,t,160|r),e.writeUint32(a)),e.writeString(i)}function l(e,t,r){t<256?(e.writeUint8(r),e.writeUint8(t)):(e.writeUint8(8|r),e.writeUint16(t))}function c(e){let t=-1;for(let r=0;r<e.length;r+=3)null!=e[r+2]&&(t=r);return t}t.WamBuffer=class{constructor(e,t,r,i){this._finalized=!1,this._hasEvents=!1;const a=new n.Binary(void 0,!0);switch(a.writeString("WAM"),a.writeUint8(5),a.writeUint8(t),a.writeUint16(r),e){case"regular":a.writeUint8(0);break;default:a.writeUint8(2)}this._channel=e,this._buffer=a,this._sequenceNumber=r,this._streamId=t,i.forEach(((e,t)=>{this.writeGlobal(t,e)}))}writeGlobal(e,t){if(null!=t)if("string"==typeof t)s(this._buffer,e,0,t);else if("number"==typeof t)a(this._buffer,e,0,t);else{if("boolean"!=typeof t)throw new Error("Incorrect value type "+typeof t);a(this._buffer,e,0,t?1:0)}else l(this._buffer,e,0)}writeEvent(e,t,r,n){const l=this._buffer;a(l,47,0,Math.floor(e/1e3));const d=c(r);a(l,t,-1===d?5:1,n);for(let e=0;e<=d;e+=3){const t=r[e+2];if(null!=t){const n=r[e],c=r[e+1],u=e===d?6:2;c===i.TYPES.INT?a(l,n,u,t):c===i.TYPES.BOOL?a(l,n,u,t?1:0):c===i.TYPES.STRING?s(l,n,u,t):o(l,n,u,t)}}this._hasEvents=!0}getKey(){return{streamId:this._streamId,sequenceNumber:this._sequenceNumber,channel:this._channel}}getSize(){return this._buffer.size()}peek(){return this._buffer.peek((e=>e.readByteArray()))}isFinalized(){return this._finalized}finalize(){this._finalized=!0}hasEvents(){return this._hasEvents}}},42114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeChannelManager=function(){null!=n&&n.close()},t.getChannelManager=function(){null==n&&(n=new r);return n};class r{constructor(){this._sinkIsBusy=new Map,this._initializedChannel=new Map}getChannelInitialized(e){return this._initializedChannel.get(e)||!1}setChannelInitialized(e){this._initializedChannel.set(e,!0)}isSinkBusy(e){return this._sinkIsBusy.get(e)||!1}setSinkBusy(e,t){this._sinkIsBusy.set(e,t)}close(){this._sinkIsBusy.forEach(((e,t)=>{this._sinkIsBusy.set(t,!1)})),this._initializedChannel.forEach(((e,t)=>{this._initializedChannel.set(t,!1)}))}}let n},7879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinitializeWAM=function(){s().deinitialize()},t.enableDebugMode=function(){a=!0},t.forceFlushBuffers=function(){s().forceFlushBuffers()},t.initializeWAM=function(e,t,r,n,i){s().initialize(r,e,t,n,i)},t.log=function(e,t,r,n,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();s().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),o)},t.logAsync=function(e,t,r,n,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();return new Promise((c=>{s().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),o,c)}))},t.logAttributes=function(e,t){const r=(0,i.getDeltaFromAttributes)(e);if(null==r)return;const{deltaRegular:n,deltaPrivate:a}=r;n.size>0&&s().enqueueAttributesUpdate("regular",n);a.size>0&&s().enqueueAttributesUpdate("private",a)},t.rotateBuffers=function(){s().rotateBuffers()},t.updatePrivateStatsIds=function(e){s().updatePrivateStatsIds(e)};var n=r(26305),i=r(56521);let a=!1,o=null;function s(){return o||(o=new n.WamManager),o}},26305:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamManager=void 0;var n=r(28970);class i{constructor(e){this._sequenceNumbers=new Map,this._options=e}_setSequenceNumber(e,t){null==t||0===t||t<0?this._sequenceNumbers.set(e,"uninitialized"):this._sequenceNumbers.set(e,t)}initializeForChannel(e,t){t.forEach(((t,r)=>{var n;if("regular"===e&&"regular"===r)this._setSequenceNumber(r,t);else if("private"===e&&"regular"!==r)this._setSequenceNumber(r,t);else if("private"!==e||(null===(n=this._options)||void 0===n?void 0:n.multipleSequences)){var i;__LOG__(4,void 0,new Error)`SequenceNumberGenerator::initializeForChannel: Incorrect combination of parameters: ${e} ${r} ${null===(i=this._options)||void 0===i?void 0:i.multipleSequences}`}else this._setSequenceNumber(r,t)}))}next(e){const t=this._sequenceNumbers.get(e);let r;return null==t||"uninitialized"===t?r=1:(r=t+1,r>65535&&(r=1)),this._sequenceNumbers.set(e,r),r}}t.WamManager=class{constructor(){this._wamInstances=new Map,this._sequenceNumberGenerator=null}getWamInstance(e){let t=this._wamInstances.get(e);return t||(t=new n.Wam(e),this._wamInstances.set(e,t)),t}initialize(e,t,r,n,a){const o=this.getWamInstance(e);if(o.isInitialized())return void __LOG__(3)`WAM instance for channel ${e} has already been initialized`;null==this._sequenceNumberGenerator&&(this._sequenceNumberGenerator=new i(a));const s=this._sequenceNumberGenerator;this._sequenceNumberGenerator.initializeForChannel(e,r),o.initialize(t,(e=>s.next(e)),n,a)}deinitialize(){this._wamInstances.forEach(((e,t)=>{e.isInitialized()&&(__LOG__(2)`WamManager: Deinitializing WAM Channel ${t}`,e.deinitialize())})),this._sequenceNumberGenerator=null}enqueueEvent(e,t,r,n,i,a,o){this.getWamInstance(e).enqueueEvent(t,r,n,i,a,o)}enqueueAttributesUpdate(e,t){this.getWamInstance(e).enqueueAttributesUpdate(t)}updatePrivateStatsIds(e){this.getWamInstance("private").updatePrivateStatsIds(e)}forceFlushBuffers(){this._wamInstances.forEach((e=>{e.forceSerializePending()}))}rotateBuffers(){this._wamInstances.forEach((e=>{e.finalizeBuffers.forceRunNow()}))}}},47957:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blindToken=function(e,t){return(0,n.runInAllocationScope)((()=>{const r=(0,n.p3Element)(),o=(0,n.allocate)(Uint8Array,32);o.set(t),a(o),i.lowlevel.scalarbase(r,o);const s=(0,n.hashToPoint)(e);(0,i.lowlevel.add)(s,r);const l=new Uint8Array(32);return(0,n.pack)(l,s),l}))},t.unblindToken=function(e,t,r){return(0,n.runInAllocationScope)((()=>{const o=(0,n.p3Element)();if((0,n.unpack)(o,e))return null;const s=(0,n.p3Element)();if(0!==(0,n.unpackneg)(s,r))return null;const l=(0,n.allocate)(Uint8Array,32);l.set(t),a(l);const c=(0,n.p3Element)();i.lowlevel.scalarmult(c,s,l);(0,i.lowlevel.add)(o,c);const d=new Uint8Array(32);return(0,n.pack)(d,o),d}))};var n=r(30141),i=r(14462);function a(e){e[0]&=248,e[31]&=127,e[31]|=64}},11562:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStorage=function(){(0,a.deinitializeWAM)(),(0,i.closeChannelManager)(),l=null,s=null},t.getFinishedStreamBuffers=function(e){return c("getFinishedStreamBuffers").getBuffers().then((t=>(0,o.getFinishedBuffers)(e,t)))},t.initializeWAMSink=function(e,t,r,n){const l=c("initializeWAMSink"),d=(0,i.getChannelManager)();if(d.getChannelInitialized(t))return Promise.resolve();d.setChannelInitialized(t);const u=l.getStreamId(e),p={putBuffer(e,n,i,a){if(d.isSinkBusy(t))return __LOG__(3)`WamStorage: Sink flush did not happen within timeout, buffer is not saved`,Promise.resolve();d.setSinkBusy(t,!0);const{bufferKey:s,meta:c,bufferRow:p}=(0,o.asBufferEntry)(e,t,u,n,i);return l.saveBuffer(c,p,a).then((()=>{const t=[e.streamId,e.sequenceNumber];__LOG__(2)`WamStorage: Successfully put buffer ${t} to sink`,i&&(r(),__LOG__(2)`WamStorage: Buffer ${s} is scheduled for send`)})).finally((()=>{d.setSinkBusy(t,!1)}))}};null==s&&(s=l.finishBuffer(u));return s.then((()=>{if(l.getStartingSequenceNumbers)return l.getStartingSequenceRow,l.getStartingSequenceNumbers(t,u);if(l.getStartingSequenceRow,null==n?void 0:n.multipleSequences)throw new Error("getStartingSequenceRow must not used when enabling support for multiple sequences");return l.getStartingSequenceRow(u).then((e=>{const t=(0,o.getSequenceNumber)(e),r=new Map;return r.set("regular",t),r}))})).then((e=>{(0,a.initializeWAM)(u,e,t,p,n),"private"===t&&l.updatePrivateStatsIds&&l.updatePrivateStatsIds().then(a.updatePrivateStatsIds)}))},t.nukeMetrics=function(){return c("nukeMetrics").nukeMetrics()},t.privateStatsKillSwitchGetBlockedToken=function(){const e=c("privateStatsKillSwitchGetBlockedToken");if(!e.privateStatsKillSwitchGetBlockedToken)throw new Error("privateStatsKillSwitchGetBlockedToken not implemented for WAM DB");return e.privateStatsKillSwitchGetBlockedToken()},t.privateStatsKillSwitchSet=function(e){const t=c("privateStatsKillSwitchSet");if(!t.privateStatsKillSwitchSet)throw new Error("privateStatsKillSwitchSet not implemented for WAM DB");return t.privateStatsKillSwitchSet(e)},t.redeemPrivateStatsToken=function(){const e=c("getPrivateStatsToken");if(!e.redeemPrivateStatsToken)throw new Error("redeemPrivateStatsToken not implemented for WAM DB");return e.redeemPrivateStatsToken(u)},t.removeBufferByKey=function(e){return c("removeBufferByKey").removeBufferByKey(e)},t.savePrivateStatsToken=function(e){const t=c("savePrivateStatsToken");if(!t.savePrivateStatsToken)throw new Error("savePrivateStatsToken not implemented for WAM DB");return t.savePrivateStatsToken(e)},t.startWamStorage=function(e){null==l?l=e:(__LOG__(3,void 0,void 0,!0)`startWamStorage: called again`,SEND_LOGS("startWamStorage"))};var n=r(92844),i=r(42114),a=r(7879),o=r(56521);let s=null,l=null;function c(e){if(l)return l;throw new Error(`WamStorage::${e} called before startWamStorage`)}const d=n.DAY_SECONDS,u=(e,t)=>{const r={maxRedeemCount:(null==t?void 0:t.maxRedeemCount)||64,maxExpirySeconds:(null==t?void 0:t.maxExpirySeconds)||d};return(0,n.happenedWithin)(e.creationTs,r.maxExpirySeconds)?!(e.redeemCount>=r.maxRedeemCount)||(__LOG__(2)`The private stats token was redeemed maximum number of time. The client shall re-issue a new one`,!1):(__LOG__(2)`The private stats token expired. The client shall re-issue a new one`,!1)}},68518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPES=void 0;t.TYPES={INT:0,BOOL:1,STRING:2,FLOAT:3}},56521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendRawFields=function(e,t){if(null==t||0===t.length)return e;const r=new Map;for(let t=0;t<e.length;t+=3){const n=e[t];r.set(n,t)}for(let n=0;n<t.length;++n){const[i,o,s]=t[n];if(null==s)continue;const l=r.get(i);if(null!=l){if(void 0!==e[l+2])continue}a[o]===typeof s&&(null==l?(r.set(i,e.length),e.push(i,o,s)):e[l+2]=s)}return e},t.asBufferEntry=function(e,t,r,i,a){const o=function(e){return JSON.stringify([e.streamId,e.sequenceNumber,e.channel])}(e);return{bufferKey:o,meta:{streamId:e.streamId,sequenceNumber:e.sequenceNumber},bufferRow:{key:o,channel:t,streamId:r,buffer:(0,n.encodeB64)(i),finished:a}}},t.getDeltaFromAttributes=function(e){const t=new Map,r=new Map;for(let n=0;n<e.length;n+=4){const a=e[n],o=e[n+1],s=e[n+2],l=e[n+3];if(s===i.TYPES.FLOAT)throw new Error("Float attributes are currently not supported in runtime");if(!Array.isArray(a))return __LOG__(4,void 0,new Error,!0)`logAttributes WAM channel is not an array`,void SEND_LOGS("wam-log-attributes");a.includes("regular")&&t.set(o,l),a.includes("private")&&r.set(o,l)}return{deltaRegular:t,deltaPrivate:r}},t.getFinishedBuffers=function(e,t){const r=[];return t.forEach((t=>{const{channel:i}=t;if(null==i){if("regular"!==e)return}else if(i!==e)return;if(t.finished){const e=new Uint8Array((0,n.decodeB64)(t.buffer)),i=t.key;r.push({key:i,content:e})}})),r},t.getSequenceNumber=function(e){let t=null;e&&(t=e.sequenceNumber);return t};var n=r(15688),i=r(68518);const a={[i.TYPES.INT]:"number",[i.TYPES.FLOAT]:"number",[i.TYPES.STRING]:"string",[i.TYPES.BOOL]:"boolean"}},46977:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){if(e===a.BUSINESS_CATEGORY_EMPTY_STR_ID)return(0,s.queryBusinessCategories)("");return(0,s.queryBusinessCategories)(e)},t.queryBusinessProfile=function(e,t){return(0,o.queryBusinessProfile)(e,t)},t.queryBusinessPublicKey=function(e){return(0,o.queryBusinessPublicKey)(e)},t.querySignedUserInfo=function(){return d.apply(this,arguments)},t.updateCartEnabled=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(32742),o=r(79235),s=r(40346),l=r(99234);function c(){return(c=(0,i.default)((function*(e){const t=r(93581).BusinessProfileCollection,n=yield(0,o.updateCartEnabled)(e),i=t.getValid((0,l.getMeUser)()),a=null==i?void 0:i.profileOptions;i&&a&&(a.cartEnabled=n,t.add(i,{merge:!0}))}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}=yield(0,o.querySignedUserInfo)(e);if(null==t||null==n||null==r||null==i)throw new Error("Unexpected null or undefined");return{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}}))).apply(this,arguments)}},9762:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(90257),o=r(99234),s=r(5819),l=r(30849);function c(){return(c=(0,i.default)((function*(e,t,r){const n=p(t),i=p(r),a=[u(e,n,i),d(e,n,i)];yield Promise.all(a.map((t=>t?(0,s.handleSingleMsgMD)(e,t):null)))}))).apply(this,arguments)}function d(e,t,r){if(!0===(0,o.getGlobalSecurityNotifications)())return t===l.ReducedPrivacyMode.E2EE&&r!==l.ReducedPrivacyMode.E2EE?(0,a.genEncryptNotificationMsg)(e,"e2e_identity_unavailable"):void 0}function u(e,t,r){if(t!==r)switch(r){case l.ReducedPrivacyMode.E2EE:return(0,a.genEncryptNotificationMsg)(e,"encrypt_now");case l.ReducedPrivacyMode.BSP:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_bsp");case l.ReducedPrivacyMode.FB:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_fb")}}function p(e){return(0,l.getReducedPrivacyMode)(e.isBusiness&&e.isEnterprise?e.privacyMode:null)}},96519:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.addProduct)(e,t,r)},t.appealProduct=function(e,t){return(0,s.appealProduct)(e,t)},t.createBusinessCatalog=function(){return(0,s.createCatalog)()},Object.defineProperty(t,"createProductCatalog",{enumerable:!0,get:function(){return c.createProductCatalog}}),t.deleteProducts=function(e){return(0,s.deleteProducts)(e)},t.editProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.editProduct)(e,t,r)},t.queryCatalog=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return(0,s.queryCatalog)(e,t,r,n,i,a,o)},t.queryProduct=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,s.queryProduct)(e,t,r,n,i,a)},t.queryProductList=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,s.queryProductList)(e,t,r,n,i)},t.reportProduct=function(e,t,r){return(0,s.reportProduct)(e,t,r)},t.sendProductToChat=function(e,t,r){const{catalogWid:s}=e;if(!t)return;const c=t.productCollection.get(e.id),d=c?(0,l.unproxy)(c):(0,l.unproxy)(e);if(!d)return;const u=d.getProductImageCollectionHead(),p=null==u?void 0:u.mediaData;if(!p)return;(0,a.findChat)(s).then((function(e){i.Cmd.openChatFromUnread(e).then((t=>{if(t){const t=(0,l.unproxy)((0,o.createProductInquiry)(d,s,p,null==r?void 0:r.session.toString()));e.composeQuotedMsg=t,i.Cmd.focusChatTextInput(e),window.innerWidth<=n.LAYOUT_2COLUMNS_MAX_WIDTH&&i.Cmd.closeDrawerRight()}}))}))};var n=r(41906),i=r(88102),a=r(50101),o=r(17304),s=r(21374),l=(r(27798),r(31019)),c=r(90880)},92002:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProductListHeaderImageRejected=function(e,t){var r,i,a;const o=n.MsgCollection.get(t),s=null==o||null===(r=o.list)||void 0===r||null===(i=r.productListInfo)||void 0===i||null===(a=i.headerImage)||void 0===a?void 0:a.productId;e.id===s&&null!=o&&(o.productHeaderImageRejected=!0)};var n=r(59871)},31452:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyContactBusinessProps=void 0,t.updateContactsWithVerifiedNames=p;var i=n(r(48926)),a=n(r(45095)),o=r(45454),s=r(93170),l=r(19380),c=r(7293),d=r(49714),u=r(68708);function p(e,t){const r={};for(const t of e){const{id:e}=t;r[e.user]=t}for(const e of t){const{id:t}=e,n=r[t.user],i=Boolean(n),{level:a,name:o,isApi:s,privacyMode:l}=n||{},c={isBusiness:i,isEnterprise:Boolean(s),verifiedLevel:_(a),verifiedName:o,privacyMode:l};e.set(c)}}const f=function(){var e=(0,i.default)((function*(){if(!c.GK.supportsFeature(c.GK.F.MD_BACKEND))return;p((yield(0,u.getAllVerifiedNames)()).map((e=>{let{id:t,name:r,level:n,isApi:i,privacyMode:s}=e;return{id:(0,o.createUserWid)(t),name:r,level:n,isApi:i,privacyMode:s?{actualActors:(0,a.default)(d.ActualActorsEnumType.cast(s.actualActors),"ActualActorsEnumType.cast(privacyMode.actualActors)"),hostStorage:(0,a.default)(d.HostStorageEnumType.cast(s.hostStorage),"HostStorageEnumType.cast(privacyMode.hostStorage)"),privacyModeTs:s.privacyModeTs}:null}})),l.ContactCollection.toArray())}));return function(){return e.apply(this,arguments)}}();function _(e){if(null!=e){switch(e){case"unknown":return s.VERIFIED_LEVEL.UNKNOWN;case"low":return s.VERIFIED_LEVEL.LOW;case"high":return s.VERIFIED_LEVEL.HIGH}return s.VERIFIED_LEVEL.UNKNOWN}}t.applyContactBusinessProps=f},66167:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateContactPropertiesOnNewChat=function(){return f.apply(this,arguments)},t.updateVerifiedInfo=u;var i=n(r(48926)),a=r(19380),o=r(7293),s=r(39354),l=r(69722),c=r(31452),d=r(68708);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=e.id,{name:n,level:i,isApi:a,serial:l}=t,u=t.privacyMode;o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&null!=u&&(yield(0,s.handlePrivacyModeTransition)(r,u,null,!0)),(0,c.updateContactsWithVerifiedNames)([{id:r,name:n,level:i,isApi:a,privacyMode:u}],[e]),yield(0,d.createOrUpdateVerifiedBusinessName)({id:r.user,level:i,serial:l,name:n,isApi:a,privacyMode:u?{actualActors:u.actualActors,hostStorage:u.hostStorage,privacyModeTs:u.privacyModeTs}:null})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const t=yield(0,l.queryExists)(e);if(null==t)return;const{bizInfo:r}=t;if(r){const t=a.ContactCollection.get(e);if(null==t)return __LOG__(4,void 0,new Error,!0)`queryAndUpdateContactPropertiesOnNewChat contact does not exist ${""}`,void SEND_LOGS("queryAndUpdateContactPropertiesOnNewChat contact does not exist");yield u(t,r.verifiedName)}}}))).apply(this,arguments)}},92027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedNameSync=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(7293),o=r(39354),s=r(31452),l=r(85808);function c(){return(c=(0,i.default)((function*(e){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND)||0===e.length)return;yield e.map((e=>{let{id:t,verifiedName:{privacyMode:n}}=e;if(null==n)return;const i=r(69951).ChatCollection.get(t);return null!=i&&!0!==i.shouldAppearInList?(0,o.handlePrivacyModeTransition)(t,n,i,!0):void 0}));const t=e.map((e=>{let{id:t,verifiedName:{level:r,serial:n,name:i,isApi:a,privacyMode:o}}=e;return{id:t.user,level:r,serial:n,name:i,isApi:a,privacyMode:o?{actualActors:o.actualActors,hostStorage:o.hostStorage,privacyModeTs:o.privacyModeTs}:null}}));yield(0,l.getTable)().bulkCreateOrReplace(t),yield(0,s.applyContactBusinessProps)()}))).apply(this,arguments)}},26878:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(24606),o=r(24175),s=r(14777),l=r(76290),c=r(58871);function d(){return(d=(0,i.default)((function*(e,t,r){var n,i;let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.maybeUpdateEphemeralSetting should not be called for group ${e.id.toString()}`,SEND_LOGS("handle-ephemeral-sync-response"),!1;if(!(0,s.isEphemeralDurationAllowed)(t))return __LOG__(2)`chat.maybeUpdateEphemeralSetting called with invalid setting ${t} seconds for chat ${e.id.toString()}`,!1;const u=null!==(n=e.ephemeralSettingTimestamp)&&void 0!==n?n:0,p=null!==(i=e.ephemeralDuration)&&void 0!==i?i:0,f=e.id,_=(0,l.shouldUpdateEphemeralSetting)({oldDuration:p,oldSettingTimestamp:u,newDuration:t,newSettingTimestamp:r,chatId:f});return _&&(yield(0,c.updateLocal)(e.id,{ephemeralDuration:t,ephemeralSettingTimestamp:r,disappearingModeInitiator:a.DisappearingModeInitiator.ChangedInChat}),p!==t&&d&&(yield(0,o.generateEphemeralSystemMessage)(e,t)),e.ephemeralDuration=t,e.ephemeralSettingTimestamp=r,e.disappearingModeInitiator=a.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.maybeUpdateEphemeralSetting updated chatId=${e.id.toString()} ephemeralDuration=${t} ephemeralSettingTimestamp=${r}`),_}))).apply(this,arguments)}},50039:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.updateEphemeralSettingTimestamp should not be called for group ${e.id.toString()}`,void SEND_LOGS("update-ephemeral-setting-timestamp");(0,n.updateLocal)(e.id,{ephemeralSettingTimestamp:t}).then((()=>{e.ephemeralSettingTimestamp=t,__LOG__(2)`chat.updateEphemeralSettingTimestamp chatId=${e.id.toString()} ephemeralSettingTimestamp=${t}`}))};var n=r(58871)},50101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findChat=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(89385),o=r(91829),s=r(9025);function l(){return(l=(0,i.default)((function*(e,t,r){if(null==r?void 0:r.aborted)throw new a.AbortError;const n=yield(0,s.getExisting)(e);if(n)return n;if(null==r?void 0:r.aborted)throw new a.AbortError;return yield(0,o.create)(e,{createdLocally:!0},{forceUsync:t})}))).apply(this,arguments)}},60629:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createChatOnNewMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(19380),o=r(91829),s=r(30849);function l(){return(l=(0,i.default)((function*(e,t,r){if(!e.isUserNotPSA())return;const n=a.ContactCollection.gadd(e);(0,s.comparePrivacyMode)(r,n.privacyMode)>0&&(n.privacyMode=r),yield(0,o.create)(e,{createdLocally:!1},{firstIncomingMsg:t,nextPrivacyMode:n.privacyMode})}))).apply(this,arguments)}},371:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearPresence=function(e){e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"));e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.typing=!1},t.markComposing=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.typing){const t=e.id;(0,i.sendChatStateComposing)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence composing error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.typing=!0,e.pausedTimerId&&clearTimeout(e.pausedTimerId);e.pausedTimerId=setTimeout((()=>u(e)),2500)}((0,s.unproxy)(e))},t.markPaused=function(e){return u((0,s.unproxy)(e))},t.markRecording=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.recording){const t=e.id;(0,i.sendChatStateRecording)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence recording error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.recording=!0,e.typing=!1}((0,s.unproxy)(e))},t.presenceOnlineChanged=function(e){e.presence.isOnline?p(e):e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"))},t.sendPresenceAvailable=function(){(0,o.setPresenceAvailable)()},t.sendPresenceUnavailable=function(){(0,o.setPresenceUnavailable)()};var n=r(50796),i=r(76931),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),o=r(1985),s=r(31019),l=r(77591);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}const d=1e4;function u(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&(e.typing||e.recording)){const t=e.id;(0,i.sendChatStatePaused)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence paused error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId")),e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId")),e.typing=e.recording=!1}function p(e){const t=e.id;if(e.recording)(0,i.sendChatStateRecording)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend recording error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})));else{if(!e.typing)return void e.unset("presenceResendTimerId");(0,i.sendChatStateComposing)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend composing error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId=setTimeout((()=>p(e)),d)}},83802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearChat=E,t.clearMessagesInChatModel=S,t.createEncryptionSystemMessage=function(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!t){const{handleSingleMsgMD:t}=r(5819),n=(0,d.default)(e.id,e.contact.privacyMode);return t(n.from,n)}return Promise.resolve()},t.sendClear=function(e,t){return y((0,_.unproxy)(e),t)};var i=n(r(48926)),a=r(50796),o=r(48360),s=r(46331),l=r(91177),c=r(88102),d=n(r(25868)),u=r(7293),p=r(57701),f=n(r(43725)),_=r(31019),h=r(58871),g=r(77591),m=r(85893);function y(e,t){const{promises:n}=e;if(n.sendClear)return n.sendClear;const _=e.getLastMsgKeyForAction(),v=n.sendClear=(0,l.sendClear)(e,_,t),T=new s.ActionType(f.default.t(19)),C=v.then(function(){var t=(0,i.default)((function*(){const t=r(63183).ConversationEndOfHistoryTransferModelPropType;return e.endOfHistoryTransferType=t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY,yield(0,h.updateLocal)(e.id,{endOfHistoryTransferType:t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY}),u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!(0,p.clearOrDeleteChatSyncEnabled)()?new s.ActionType(o.fbt._("Chat cleared from this device",null,{hk:"1XIeYe"})):new s.ActionType(f.default.t(18))}));return function(){return t.apply(this,arguments)}}()).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(e=>{if(e.status>=400)return new s.ActionType(f.default.t(17))}))).catch((()=>(__LOG__(3)`models:chat:sendClear dropped`,new s.ActionType(f.default.t(17),{actionText:f.default.t(129),actionHandler:()=>y(e,t)}))));return c.Cmd.openToast((0,m.jsx)(s.ActionToast,{id:(0,s.genId)(),initialAction:T,pendingAction:C})),v.then((n=>{if(!n._duplicate)if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){if(!(0,p.clearOrDeleteChatSyncEnabled)()){E(e,t);const{handleSingleMsgMD:n}=r(5819),i=(0,d.default)(e.id,e.contact.privacyMode);return n(i.from,i)}n.result&&S(e,n.result)}else E(e,t)})).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(()=>{}))).finally((()=>{n.sendClear=null}))}function E(e,t){if(e){const r=e.getLastMsgKeyForAction(),n=r?e.msgs.get(r):void 0;e.deleteMsgsBeforeMsgInclusive(n,t)}}function S(e,t){e&&t&&e.deleteMessages(t)}},75887:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addAndSendMsgToChat=function(e,t,n){return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const l=Promise.resolve(t).then((t=>{const i=r(59871).MsgCollection,l=(0,a.default)({},t),h=(0,g.getContactPrivacyMode)(e.id);null!=h&&(l.privacyModeWhenSent=h);const m=i.add(l)[0];if(m){var y;u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(m.wamMessageSendPerfReporter=new _.MessageSendPerfReporter(m.to,m.getWamMediaType(),m.getWamMessageType())),n=(0,d.default)(m,e);const t=n?[n,l]:[l];return null===(y=m.wamMessageSendPerfReporter)||void 0===y||y.startSavedStage(),(0,f.storeMessages)(t,e.id).then((()=>{var e;if(null===(e=m.wamMessageSendPerfReporter)||void 0===e||e.postSavedStage(),m.type===o.MSG_TYPE.GROUPS_V4_INVITE)return(0,p.persistGroupInviteV4Msg)(m.id.toString(),{id:m.id.toString(),from:m.from.toString(),to:m.to.toString(),groupId:m.inviteGrp,expiration:parseInt(m.inviteCodeExp,10),expired:s.Clock.globalUnixTime()>=parseInt(m.inviteCodeExp,10)})})).then((()=>m.waitForPrep().then((()=>m))))}throw new c.ModelCreateError("Msg",l)})),h=e.addQueue.enqueue(l).then((t=>{var r;return null===(r=t.wamMessageSendPerfReporter)||void 0===r||r.startRenderedStage(),n&&e.msgs.add(n),e.msgs.add(t)[0]})).then((e=>{var t;return null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.postRenderedStage(),e})),m=i?h.then(i).then((()=>h)):h,y=S(e,m);return[h,y]}((0,y.unproxy)(e),t,n)},t.resendMsgToChat=function(e,t){return S((0,y.unproxy)(e),t)};var i=n(r(48926)),a=n(r(81109)),o=r(15461),s=r(22683),l=r(1973),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),d=n(r(43239)),u=r(7293),p=r(62415),f=r(84886),_=r(30097),h=r(29731),g=r(30849),m=r(19708),y=(r(13705),r(31019));function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&e.isGroup){const t=r(63928).default;yield t.find(e.id)}return new h.NonPersistJob("sendMessage",(0,i.default)((function*(){const r=yield e.sendQueue.enqueue(t);return(0,m.sendMsgRecord)(r)})),{priority:l.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}},19569:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(e,t){return E((0,f.unproxy)(e),t)},t.sendSpamBlockClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,contact:i}=e;if(r.reportSpamBlockClear)return r.reportSpamBlockClear;if(n)return Promise.reject(new l.ActionError);const a=y(e,t);return r.reportSpamBlockClear=a.then((()=>(0,o.blockContact)(i))).then((()=>(0,u.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamBlockClear=null})),r.reportSpamBlockClear}((0,f.unproxy)(e),t)},t.sendSpamExitClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,isReadOnly:i,msgs:a}=e;if(r.reportSpamExitClear)return r.reportSpamExitClear;if(!n)return Promise.reject(new l.ActionError);let o;const s=y(e,t);if(i)o=s;else{const t=(0,c.sendExitGroup)(e),r=(0,_.default)(a,"change:last",(e=>e.isGroupLeave()));o=Promise.all([s,t,r])}return r.reportSpamExitClear=o.then((()=>(0,u.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamExitClear=null})),r.reportSpamExitClear}((0,f.unproxy)(e),t)},t.sendSpamReport=function(e,t){return y((0,f.unproxy)(e),t)};var i=r(50796),a=r(46331),o=r(80140),s=r(88102),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=r(5501),d=n(r(43725)),u=r(83802),p=r(26707),f=(r(38839),r(31019)),_=n(r(17072)),h=r(77591),g=r(85893);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.genId)();const{promises:n}=e;if(n.sendSpamReport)return n.sendSpamReport;const o=n.sendSpamReport=(0,p.sendSpamReport)(e,t),l=new a.ActionType(d.default.t(122)),c=o.then((()=>new a.ActionType(d.default.t(124)))).catch((0,i.filteredCatch)(h.ServerStatusCodeError,(()=>new a.ActionType(d.default.t(123))))).catch((()=>(__LOG__(3)`models:chat:sendSpamReport dropped`,new a.ActionType(d.default.t(123),{actionText:d.default.t(129),actionHandler:()=>y(e,t,r)}))));return s.Cmd.openToast((0,g.jsx)(a.ActionToast,{id:r,initialAction:l,pendingAction:c})),o.finally((()=>{n.sendSpamReport=null}))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.genId)();const{promises:n,notSpam:o}=e;if(o)return Promise.resolve();if(n.sendNotSpam)return n.sendNotSpam;const l=n.sendNotSpam=(0,p.sendNotSpam)(e);if(t){const n=new a.ActionType(d.default.t(76)),o=l.then((()=>new a.ActionType(d.default.t(78)))).catch((0,i.filteredCatch)(h.ServerStatusCodeError,(()=>new a.ActionType(d.default.t(77))))).catch((()=>(__LOG__(3)`models:chat:sendNotSpam dropped`,new a.ActionType(d.default.t(77),{actionText:d.default.t(129),actionHandler:()=>E(e,t,r)}))));s.Cmd.openToast((0,g.jsx)(a.ActionToast,{id:r,initialAction:n,pendingAction:o}))}return l.then((()=>{e.set({notSpam:!0})})).finally((()=>{e.isTrusted(),n.sendNotSpam=null}))}},41088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendTcToken=function(){return u.apply(this,arguments)},t.sendTcTokenWhenDeviceIdentityChange=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(64603),s=r(69951),l=r(22683),c=r(76214),d=r(80079);function u(){return(u=(0,i.default)((function*(e){if(!e.isUserNotPSA())return;const t=s.ChatCollection.get(e);if(null!=t&&(0,o.shouldSendNewToken)(t.tcTokenSenderTimestamp))try{const r=(0,a.castToUnixTime)(l.Clock.globalUnixTime());yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],r);const n={tcTokenSenderTimestamp:r};t.set(n),yield(0,c.getChatTable)().merge(e.toString(),n)}catch(e){__LOG__(3,!0,void 0,!0)`sendTcToken failed - ${e}`,SEND_LOGS("send-tc-token-failed")}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=s.ChatCollection.get(e);if(null==t)return;const r=t.tcTokenSenderTimestamp;if(null!=r&&!(0,o.isTokenExpired)(r,o.TcTokenMode.Sender))try{yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],(0,a.castToUnixTime)(r))}catch(e){__LOG__(3,!0,void 0,!0)`sendTcTokenWhenDeviceIdentityChange failed - ${e}`,SEND_LOGS("send-tc-token-device-identity-change-failed")}}))).apply(this,arguments)}},3553:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unstarAllMessages=function(e,t){return _(e,t?(0,u.unproxy)(t):t)};var i=r(50796),a=r(46331),o=r(88102),s=n(r(43725)),l=r(69694),c=n(r(11810)),d=r(19011),u=r(31019),p=r(77591),f=r(85893);function _(e,t){const n=r(69951).ChatCollection,u=t?t.promises:n.promises,h=t?t.id:void 0;if(u.sendUnstarAll)return u.sendUnstarAll;const g=u.sendUnstarAll=(0,l.sendUnstarAll)(e,h),m=new a.ActionType(s.default.t(93)),y=g.then((()=>new a.ActionType(s.default.t(91)))).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(e=>{if(e.statusCode>=400)return new a.ActionType(s.default.t(87))}))).catch((()=>(__LOG__(3)`models:chat:sendUnstarAll dropped`,new a.ActionType(s.default.t(87),{actionText:s.default.t(129),actionHandler:()=>_(e,t)}))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:(0,a.genId)(),initialAction:m,pendingAction:y})),g.then((()=>{e.forEach((e=>{e.set("star",!1)})),t?(0,d.removeStarredMsgs)(e):(d.AllStarredMsgsCollection.reset(),c.default.reset(),n.forEach((e=>{e.starredMsgs&&e.starredMsgs.reset()})))})).finally((()=>{u.sendUnstarAll=null}))}},59201:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcToken=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(95024),o=r(91829),s=r(9025),l=r(76214);function c(){return(c=(0,i.default)((function*(e,t,r){if(null==r)return;if(!e.isUserNotPSA())return;let n=yield(0,s.getExisting)(e);if(null==n)return void(n=yield(0,o.create)(e,{tcToken:r,tcTokenTimestamp:t,pendingInitialLoading:!1,createdLocally:!1}));if(null!=n.tcToken&&(0,a.arrayBuffersDeepEqual)(n.tcToken,r)||null!=n.tcTokenTimestamp&&n.tcTokenTimestamp>t)return;const i={tcToken:r,tcTokenTimestamp:t};n.set(i),yield(0,l.getChatTable)().merge(e.toString(),i)}))).apply(this,arguments)}},9609:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearUnreadMentions=function(e){var t;(0,f.isGroupCatchUpEnabled)()&&e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.unreadMentionMetadata.reset())},t.markSeen=v,t.markUnread=function(e,t){return C((0,h.unproxy)(e),t)},t.markUnseen=T,t.sendSeen=S,t.updateUnreadCountMD=O;var i=n(r(48926)),a=r(50796),o=n(r(64369)),s=r(46331),l=r(48285),c=r(88102),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(7293),p=n(r(43725)),f=r(10435),_=r(97848),h=r(31019),g=r(8080),m=r(77591),y=r(85893);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function S(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return A((0,h.unproxy)(e),t).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{__LOG__(3)`sendSeen: got status ${e.status}`})))}function v(e,t,r){return function(){return M.apply(this,arguments)}((0,h.unproxy)(e),t,r)}function T(e){!function(e){0!==e.unreadCount&&e.unreadCount!==o.default.MARKED_AS_UNREAD||(e.active&&(e.markedUnread=!0),(0,_.markConversationUnseen)(e.id).then((()=>{e.unreadCount=o.default.MARKED_AS_UNREAD})))}((0,h.unproxy)(e))}function C(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.genId)();t?e.active&&(e.markedUnread=!0):e.markedUnread=!1;const{promises:n}=e;if(n.markUnread)return n.markUnread;const i=n.markUnread=t?b(e):A(e),o=t?new s.ActionType(p.default.t(28)):new s.ActionType(p.default.t(27)),l=i.then((()=>{const n=t?p.default.t(26):p.default.t(25);return new s.ActionType(n,{actionText:p.default.t(133),actionHandler:()=>C(e,!t,r)})})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{if(e.status>=400)return t?new s.ActionType(p.default.t(24)):new s.ActionType(p.default.t(23));throw new Error("invalid response status")}))).catch((()=>{const n=t?p.default.t(24):p.default.t(23);return new s.ActionType(n,{actionText:p.default.t(129),actionHandler:()=>C(e,t,r)})}));return c.Cmd.openToast((0,y.jsx)(s.ActionToast,{id:r,initialAction:o,pendingAction:l})),i.then((()=>{})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{__LOG__(3)`markUnread: got status ${e.status}`}))).finally((()=>{n.markUnread=null}))}function A(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.markedUnread||0===e.unreadCount)return String(e.markedUnread),e.unreadCount,Promise.resolve();if(!g.Stream.available&&t)return e.listenToOnce(g.Stream,"change:available",(()=>S(e))),Promise.resolve();e.unreadCount,e.pendingSeenCount;const r=e.unreadCount-e.pendingSeenCount,n=-1===e.unreadCount&&-1===r;if(r<=0&&!n)return Promise.resolve();e.disableUnreadAnchor=!0,e.pendingSeenCount=e.unreadCount,e.pendingSeenCount;const i=()=>{e.pendingSeenCount=e.pendingSeenCount-r,e.pendingSeenCount,e.pendingSeenCount<0&&(__LOG__(3)`models:chat:sendSeen unread ${e.unreadCount} pending: ${e.pendingSeenCount} delta: ${r}`,e.pendingSeenCount=0)},o=e.getLastMsgKeyForAction();return(0,_.sendConversationSeen)(e,o,r).then((t=>{u.GK.supportsFeature(u.GK.F.MD_BACKEND)?O(e,r):t._duplicate?i():v(e,r,!0)})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>(i(),Promise.reject(e))))).catch((0,a.filteredCatch)([m.WebdDrop,d.ProtoVersionUndefined],(()=>{i(),__LOG__(3)`models:chat:sendConversationSeen dropped`})))}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=e.getLastMsgKeyForAction();try{yield(0,_.sendConversationUnseen)(e.id,t),T(e)}catch(t){return(0,a.filteredCatch)(m.ServerStatusCodeError,(t=>(e.markedUnread=!1,Promise.reject(t))))(t)}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];String(t);let n=null;null!=t?t>0&&t<=e.unreadCount?(n=e.unreadCount-t,String(n)):-1===t&&e.unreadCount<=0&&(n=0,String(n)):(n=0,String(n));const i=null==n?Promise.resolve():(0,_.markConversationSeen)(e.id,n);if(yield i,null!=t&&r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}null!=n&&(e.unreadCount=n),e.unreadMsgAnchor=void 0,e.markedUnread=!1}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{unreadCount:n}=yield(0,l.getChatMeta)(e.id);if(e.unreadCount,e.unreadCount=n,e.unreadMsgAnchor=void 0,e.markedUnread=!1,r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}}))).apply(this,arguments)}},67087:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeToCommunity=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(22683),s=r(58052),l=r(74028);function c(){return(c=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,s.getIsCommunityDiscovered)();if(t)return;if(e)return(0,s.setIsCommunityDiscovered)(!0),void __LOG__(2)`upgradeToCommunity: isInitialBootstrap is true, set isCommunityDiscovered to true`;const r=o.Clock.globalUnixTime(),n=(0,a.getABPropConfigValue)("parent_group_query_ts");if(0===n||r<n)(0,s.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), set isCommunityDiscovered to true`;else try{yield(0,l.queryAndUpdateAllGroupMetadata)(),(0,s.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), fetched groups and set isCommunityDiscovered to true`}catch(e){__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), fetched groups and failed, kept isCommunityDiscovered at false`}}))).apply(this,arguments)}},97270:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addJoinedSubgroup=function(e,t){e.joinedSubgroups=[...e.joinedSubgroups,t]},t.removeJoinedSubgroup=function(e,t){e.joinedSubgroups=e.joinedSubgroups.filter((e=>e!==t))}},53006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPushnameLocally=function(e){n.Conn.pushname=e,(0,i.setPushname)(e)};var n=r(17239),i=r(99234)},67146:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMeToContacts=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(72441),o=r(4233),s=r(99234),l=r(46582);function c(){return(c=(0,i.default)((function*(){const e=yield(0,l.requireContactCollection)(),t=(0,s.getMaybeMeUser)(),r=(0,a.toPhoneUserJid)(t.user);yield(0,o.getTable)().createOrMerge(r,{id:r}),e.gadd(t)}))).apply(this,arguments)}},66308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGenerateDeviceNotifications=function(){return h.apply(this,arguments)},t.createAndStoreDeviceNotifications=function(){return _.apply(this,arguments)},t.generateDeviceNotifications=p;var i=n(r(48926)),a=r(52230),o=r(45454),s=r(86945),l=r(90257),c=r(99234),d=r(76214),u=r(90641);function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){const n={notifications:[],chatIds:[]};if(!(0,c.getGlobalSecurityNotifications)())return n;if((0,s.getABPropConfigValue)("adv_v2_m6"))return n;if(!(t.length>0||r.length>0))return n;let i=[];if(e.equals((0,c.getMeUser)()))try{(yield(0,d.getChatTable)().all()).forEach((e=>{e.id!==a.STATUS_JID&&i.push((0,o.createWid)(e.id))}))}catch(e){throw __LOG__(4,!0,new Error,!0)`get all from chat table failed`,SEND_LOGS("get all from chat table failed when creating device notification"),new Error("get all from chat table failed")}else try{const t=yield(0,d.getChatTable)().get(String(e)),r=yield(0,d.getParticipantTable)().equals(["participants"],String(e));i=r.map((e=>(0,o.createWid)(e.groupId))),t&&i.push((0,o.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chays failed")}const u=i.map((n=>(0,l.genDeviceNotificationMsg)(n,e,t,r)));return n.notifications=u,n.chatIds=i.map(String),n}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r){const{notifications:n}=yield p(e,t,r);yield Promise.all(n.map((e=>(0,u.storeMessageInTransaction)([e]))))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){let t=[];const r=new Set;if((0,c.getGlobalSecurityNotifications)()){(yield Promise.all(e.map((e=>{let{wid:t,added:r,removed:n,isNewRecord:i}=e;return i?Promise.resolve(null):p(t,r,n)})))).forEach((e=>{e&&(t=t.concat(e.notifications),e.chatIds.forEach((e=>r.add(e))))}))}return t.length>0?{notifications:t,chatIds:Array.from(r)}:{notifications:[],chatIds:[]}}))).apply(this,arguments)}},54181:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceNotification=function(e){let{wid:t,devices:r,type:n}=e;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return null==n?Promise.reject(new Error("handleADVDeviceNotification: notification without type")):function(){return h.apply(this,arguments)}(t,r,n);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceSyncResult=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return function(){return g.apply(this,arguments)}(e);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceUpdateForMessage=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(68268),s=r(5087),l=r(9108),c=r(7293),d=r(54678),u=n(r(76128)),p=r(17041),f=r(93832);function _(){return(_=(0,i.default)((function*(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){let l;return(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(l=yield(0,o.getLastADVDeviceInfoCheckTime)()),(0,d.handleADVDeviceUpdateForMessage)(e,t,r,n,i,s,l)}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){let i=null;if("add"===n){const t=yield u.default.loadIdentityKey((0,f.createSignalAddress)(e).toString());i=t?(0,s.toCurveKeyPubKey)((0,f.strToBuffer)(t)):null}const c=yield(0,l.getDeviceRecord)(e.user);let d;(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(d=yield(0,o.getLastADVDeviceInfoCheckTime)());const _=(0,r(81864).handleDeviceNotification)(e,n,t,i,c,d);if(_)return _.clearRecord&&(yield(0,p.clearDeviceRecord)(e,(null==c?void 0:c.devices)||[])),(0,p.bulkApplyDeviceUpdate)([{wid:e,update:_.update,currentRecord:c}])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){__LOG__(2)`_handleADVDeviceSyncResult: start to handling ${e.length} updates`;const t=e.map((e=>e.wid)),n=e.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})),i=yield u.default.bulkLoadIdentityKey(n.map((e=>(0,f.createSignalAddress)(e.wid).toString()))),a=new Map;n.forEach(((e,t)=>{a.set(e.wid.user,i[t])}));const o=yield(0,l.bulkGetDeviceRecord)(t.map((e=>e.user))),c=[],d=[],_=r(81864).handleADVSyncResult;e.forEach(((e,t)=>{const r=a.get(e.wid.user),n=r?(0,s.toCurveKeyPubKey)((0,f.strToBuffer)(r)):null,i=o[t],l=_(e.wid,e.devices,n,i);null!=l&&(l.clearRecord?(c.push({wid:e.wid,currentList:(null==i?void 0:i.devices)||[]}),d.push({wid:e.wid,currentRecord:{id:e.wid.user,deleted:!0},update:l.update})):d.push({wid:e.wid,currentRecord:i,update:l.update}))})),yield Promise.all(c.map((e=>{let{wid:t,currentList:r}=e;return(0,p.clearDeviceRecord)(t,r)}))),yield(0,p.bulkApplyDeviceUpdate)(d)}))).apply(this,arguments)}},17041:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkApplyDeviceUpdate=function(){return y.apply(this,arguments)},t.clearDeviceRecord=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=n(r(91966)),o=r(52230),s=r(45454),l=r(66308),c=r(9108),d=r(99234),u=r(41796),p=r(14748),f=n(r(29783)),_=r(90641),h=r(93932),g=r(58928);function m(){return(m=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];yield Promise.all(t.filter((e=>e.id!==o.DEFAULT_DEVICE_ID)).map((t=>v((0,s.createDeviceWidFromUserAndDevice)(e.user,t.id)))));const n=[],a=t.map((e=>e.id)).filter((e=>e!==o.DEFAULT_DEVICE_ID)),{encryptedNotifications:l,chatIds:d}=yield E([{wid:e,added:n,removed:a,isNewRecord:!1}],r);yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=l.length>0?(0,_.storeEncryptedMessage)(l,d,!1):Promise.resolve(),r=(0,g.updateGroupParticipantsInTransaction)(e,n,a),i=(0,c.createOrReplaceDeviceRecord)({id:e.user,deleted:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove from device list table failed`,SEND_LOGS("remove from device list table failed when clearing device record"),new Error("remove from device list table failed")}));yield Promise.all([t,r,i])})),l.length>0)}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=[],n=[];let l=!1;e.forEach((e=>{let{wid:t,update:i,currentRecord:c}=e;const{devices:u}=i,p=u.map((e=>e.id)),f=c&&!c.deleted?c.devices.map((e=>e.id)):[],_=(0,a.default)(p,f).filter((e=>e!==o.DEFAULT_DEVICE_ID)),h=(0,a.default)(f,p).filter((e=>e!==o.DEFAULT_DEVICE_ID));r.push({wid:t,added:_,removed:h,isNewRecord:null==c}),h.forEach((e=>{n.push((0,s.createDeviceWidFromUserAndDevice)(t.user,e))})),t.user===(0,d.getMeUser)().user&&h.length>0&&(l=!0)}));const{encryptedNotifications:u,chatIds:f}=yield E(r,t);Promise.all(n.map((e=>v(e)))),yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=u.length>0?(0,_.storeEncryptedMessage)(u,f,!1):Promise.resolve(),n=(0,g.bulkUpdateGroupParticipantsInTransaction)(r),i=(0,c.bulkCreateOrReplaceDeviceRecord)(e.map((e=>e.update))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into device list table failed`,SEND_LOGS("bulkCreateOrReplace into device list table failed when applying device update"),new Error("bulkCreateOrReplace into device list table failed")})),a=l?i.then((()=>(0,h.updateMissingKeyDevices)().catch((e=>{__LOG__(3)`syncd: updateMissingKeyDevices failed with error:
${e}`})))):Promise.resolve();yield Promise.all([t,n,i,a])})),u.length>0,l)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{notifications:r,chatIds:n}=yield(0,l.bulkGenerateDeviceNotifications)(e);if(!t){const e=yield(0,_.encryptMultipleMsgs)(r);return C(r),{chatIds:n,encryptedNotifications:e}}return f.default.addOfflineMessage(r.map((e=>({msg:e})))),{chatIds:[],encryptedNotifications:[]}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const{deleteDeviceSenderKey:t,deleteRemoteInfo:n}=r(54084);try{yield Promise.all([n(e),t(e)])}catch(t){__LOG__(2)`handleDevicesNotification: failed to clean the signal info for ${e.user}`}}))).apply(this,arguments)}function C(e){return Promise.all(e.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,u.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})))}},58928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateGroupParticipantsInTransaction=function(){return f.apply(this,arguments)},t.updateGroupParticipantsInTransaction=function(){return p.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(45454),l=r(57701),c=n(r(11339)),d=r(76214),u=r(99039);function p(){return(p=(0,a.default)((function*(e,t,r){const n=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((n=>{let a=n.rotateKey;const o=new Map(n.senderKey);return(0,l.rotateSenderKeyIfSentEnabled)()?(r.forEach((t=>{var r;const n=String((0,s.createDeviceWidFromUserAndDevice)(e.user,t));a=a||null!==(r=o.get(n))&&void 0!==r&&r,o.delete(n)})),a&&o.forEach(((e,t)=>o.set(t,!1)))):(r.forEach((t=>{o.delete(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)))})),r.length>0&&(a=!0)),t.forEach((t=>{o.set(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)),!1)})),_(a,n,t,r),(0,i.default)((0,i.default)({},n),{},{senderKey:o,rotateKey:a})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}function f(){return(f=(0,a.default)((function*(e){if(0===e.length)return;const t=yield(0,d.getParticipantTable)().anyOf(["participants"],e.map((e=>String(e.wid))));if(0===t.length)return;const r=new Map;e.forEach((e=>{r.set(String(e.wid),e)}));const n=t.map((e=>{let t=e.rotateKey;const n=new Map(e.senderKey);return e.participants.forEach((i=>{const a=r.get(i);if(!a)return;const{added:o,removed:c}=a;(0,l.rotateSenderKeyIfSentEnabled)()?(c.forEach((e=>{var r;const i=String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e));t=t||null!==(r=n.get(i))&&void 0!==r&&r,n.delete(i)})),t&&n.forEach(((e,t)=>n.set(t,!1)))):(c.forEach((e=>{n.delete(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)))})),c.length>0&&(t=!0)),o.forEach((e=>{n.set(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)),!1)})),_(t,e,o,c)})),(0,i.default)((0,i.default)({},e),{},{senderKey:n,rotateKey:t})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}function _(e,t,r,n){e&&!t.rotateKey&&(0,u.postSenderKeyExpiredMetric)({chatId:t.groupId,deviceCount:t.senderKey.size,expiryReason:n.includes(o.DEFAULT_DEVICE_ID)&&r.includes(o.DEFAULT_DEVICE_ID)?c.default.EXPIRY_REASON.IDENTITY_CHANGE:c.default.EXPIRY_REASON.DEVICE_UNPAIR})}},89333:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeExpectedTsForDeviceRecord=function(e,t,r){const n=null==t?void 0:t.timestamp;if(null==n)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};let i,o,s;null==t||t.deleted||(i=t.expectedTs,o=t.expectedTsLastDeviceJobTs,s=t.expectedTsUpdateTs);return a(e,n,r,i,o,s)},t.computeNewExpectedTs=a,t.shouldClearExpectedTs=function(e,t,r,i){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return!1;if(null==r||r.deleted)return!1;if(null==r.expectedTs)return!1;if(e>=r.expectedTs)return!0;if(e<r.expectedTs&&t===r.expectedTs&&null!=i&&(null==r.expectedTsLastDeviceJobTs||i>r.expectedTsLastDeviceJobTs))return!0;return!1};var n=r(86945),i=r(22683);function a(e,t,r,a,o,s){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};const l={expectedTs:a,expectedTsLastDeviceJobTs:o,expectedTsUpdateTs:s};return t>=e||null!=a&&a>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=r,(null==a||t>=a)&&(l.expectedTsUpdateTs=i.Clock.localUnixTime())),l}},65414:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleICDCData=function(e,t,r){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND))return null!=r&&(0,d.getABPropConfigValue)("adv_v2_m4_m5")?m.enqueue((()=>function(){return y.apply(this,arguments)}(e,t,r))):Promise.resolve();return Promise.reject(new Error("handleICDCData: not supported for non md"))};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(8243),l=r(27870),c=r(92844),d=r(86945),u=r(68268),p=r(9108),f=r(89333),_=r(99234),h=r(7293),g=r(81864);const m=new l.PromiseQueue;function y(){return(y=(0,a.default)((function*(e,t,r){const{deviceListMetadata:n}=r;if(null==n)return void __LOG__(2,void 0,void 0,void 0,["handleICDCData"])`get empty device list metadata`;if((null==e.device||e.device===o.DEFAULT_DEVICE_ID)&&null!=n.senderTimestamp&&null==n.senderKeyHash){const t=(0,s.numberOrThrowIfTooLarge)(n.senderTimestamp)+1;return void(0,g.handleADVSyncResult)(e,{deviceList:[{id:o.DEFAULT_DEVICE_ID,keyIndex:0}],keyIndex:{ts:(0,c.castToUnixTime)(t),signedKeyIndexBytes:null}},null,null)}const a=[],l=e.user===(0,_.getMeUser)().user;a.push({id:e.user,ts:n.senderTimestamp}),l&&null!=t&&a.push({id:t.user,ts:n.recipientTimestamp});const d=yield(0,u.getLastADVDeviceInfoCheckTime)(),h=yield(0,p.bulkGetDeviceRecord)(a.map((e=>e.id))),m=[];return h.forEach(((e,t)=>{const r=a[t].ts;if(null==e||e.deleted||null==r)return;const n=(0,f.computeExpectedTsForDeviceRecord)((0,s.numberOrThrowIfTooLarge)(r),e,d);n.expectedTs===e.expectedTs&&n.expectedTsLastDeviceJobTs===e.expectedTsLastDeviceJobTs&&e.expectedTsUpdateTs==e.expectedTsUpdateTs||(__LOG__(2)`handleICDCData: update expectd timestamp for ${e.id}`,m.push((0,i.default)((0,i.default)({},e),n)))})),m.length>0?(0,p.bulkCreateOrReplaceDeviceRecord)(m):void 0}))).apply(this,arguments)}},84135:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleListReset=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(8243),s=r(92844),l=r(45454),c=n(r(41143)),d=r(86945),u=r(5087),p=r(89333),f=r(52083),_=r(17041),h=r(93832);function g(){return(g=(0,i.default)((function*(e,t,r,n,i){let g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6?arguments[6]:void 0;const{rawId:y,timestamp:E,keyIndex:S}=t,v=(0,o.numberOrThrowIfTooLarge)(E),T=(0,d.getABPropConfigValue)("adv_v2_m4_m5"),C=e.device;(0,c.default)(null!=C&&C!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const A=(0,l.toUserWid)(e);let b=0;if(T&&(b=(null==i?void 0:i.timestamp)||(0,s.pastUnixTime)(((0,d.getABPropConfigValue)("num_days_key_index_list_expiration")-1)*s.DAY_SECONDS)),null!=i&&!i.deleted){if(i.timestamp>v)throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");yield(0,_.clearDeviceRecord)(A,i.devices,g)}r&&(yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(A).toString(),(0,u.toSignalCurvePubKey)(r)));const P={id:e.user,rawId:y,timestamp:b,devices:[{id:C,keyIndex:S},{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};if(T){const e=(0,p.computeExpectedTsForDeviceRecord)(v,P,m);P.expectedTs=e.expectedTs,P.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,P.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,_.bulkApplyDeviceUpdate)([{wid:A,update:P,currentRecord:null}],g),yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(n))}))).apply(this,arguments)}},80405:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoListReset=function(){return g.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(8243),l=r(45454),c=n(r(41143)),d=r(86945),u=r(5087),p=r(89333),f=r(52083),_=r(17041),h=r(93832);function g(){return(g=(0,a.default)((function*(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5?arguments[5]:void 0;const{timestamp:m,keyIndex:y}=t,E=(0,s.numberOrThrowIfTooLarge)(m),S=e.device;if((0,c.default)(null!=S&&S!==o.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device"),n.timestamp>=E&&n.validIndexes&&!n.validIndexes.includes(y))throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");const v=new Map(n.devices.map((e=>[e.id,e.keyIndex])));if(!v.has(S)||v.get(S)!==y){v.set(S,y);const t=Array.from(v.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),o=(0,i.default)((0,i.default)({},n),{},{devices:t,deleted:!1});if((0,d.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,p.computeExpectedTsForDeviceRecord)(E,o,g);o.expectedTs=e.expectedTs,o.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,o.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,_.bulkApplyDeviceUpdate)([{wid:(0,l.toUserWid)(e),update:o,currentRecord:n}],a),yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(r))}}))).apply(this,arguments)}},54678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceUpdateForMessage=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(45454),s=n(r(41143)),l=r(9108),c=r(84135),d=r(80405),u=r(93832);function p(){return(p=(0,i.default)((function*(e,t,r,n,i){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const{rawId:_,timestamp:h,keyIndex:g}=t;(0,s.default)(null!=_,"handleADVDeviceIdentity: rawId of deviceIdentity should not be null"),(0,s.default)(null!=h,"handleADVDeviceIdentity: timestamp of deviceIdentity should not be null"),(0,s.default)(null!=g,"handleADVDeviceIdentity: keyIndex of deviceIdentity should not be null");const m={rawId:_,timestamp:h,keyIndex:g},y=e.device;(0,s.default)(null!=y&&y!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const E=(0,o.toUserWid)(e),S=yield(0,l.getDeviceRecord)(E.user),v=null==r||null!=n&&!(0,u.bufferEqual)(r,n);return!S||S.deleted||S.rawId!==_||v?(0,c.handleListReset)(e,m,v?n:null,i,S,p,f):(0,d.handleNoListReset)(e,m,i,S,p,f)}))).apply(this,arguments)}},79156:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDeviceAddNotification=function(e,t,r,n,i,d,u){if(!d||d.deleted)return null;if(r<d.timestamp)return null;if(null==i)return null;const p=(0,c.decodeSignedKeyIndexBytes)(i,n);if(!p)return null;const f=p.rawId,_=(0,o.numberOrThrowIfTooLarge)(p.timestamp);if(_!==r)return null;let h=!1,g=null;const m=d.timestamp;d.rawId!==f?h=!0:g=d.devices;const y=new Set(p.validIndexes),E=p.currentIndex||0,S=null==g?[]:g.filter((e=>e.id!==a.DEFAULT_DEVICE_ID&&(y.has(e.keyIndex)||e.keyIndex>E)));t.forEach((e=>{const{id:t,keyIndex:r}=e;t!==a.DEFAULT_DEVICE_ID&&null!=r&&y.has(r)&&S.push({id:t,keyIndex:r})})),S.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0});const v={id:e.user,rawId:f,timestamp:m,validIndexes:Array.from(y),devices:S,currentIndex:p.currentIndex,deleted:!1};if((0,s.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,l.computeExpectedTsForDeviceRecord)(_,v,u);v.expectedTs=e.expectedTs,v.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,v.expectedTsUpdateTs=e.expectedTsUpdateTs}return{update:v,clearRecord:h}},t.handleDeviceRemoveNotification=function(e,t,r){if(null==r||r.deleted)return null;if(t<r.timestamp)return null;const n=new Map(e.map((e=>[e.id,e.keyIndex]))),o=r.devices.filter((e=>{if(e.id!==a.DEFAULT_DEVICE_ID){const t=n.get(e.id);return null==t||t!==e.keyIndex}return!1}));return o.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0}),{update:(0,i.default)((0,i.default)({},r),{},{devices:o}),clearRecord:!1}};var i=n(r(81109)),a=r(52230),o=r(8243),s=r(86945),l=r(89333),c=r(87622)},40626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyIndexResult=function(e,t,r,s,l,c,d,u){if(null!=(null==c?void 0:c.timestamp)&&r<c.timestamp)return null;if(null==l)return null;const p=(0,o.decodeSignedKeyIndexBytes)(l,s);if(!p)return null;const f=p.rawId,_=(0,i.numberOrThrowIfTooLarge)(p.timestamp);if(_!==r)return null;let h=!1,g=null,m=t;c&&!c.deleted&&(null==m&&(m=c.devices),c.rawId!==f?h=!0:g=c.devices);const y=new Map,E=new Set(p.validIndexes),S=p.currentIndex||0;m&&m.forEach((e=>{null!=e.keyIndex&&E.has(e.keyIndex)&&y.set(e.id,e.keyIndex)}));null!=g&&g.forEach((e=>{e.keyIndex>S&&y.set(e.id,e.keyIndex)}));y.set(n.DEFAULT_DEVICE_ID,0);const v=Array.from(y.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),T={id:e.user,rawId:f,timestamp:_,validIndexes:Array.from(E),devices:v,currentIndex:p.currentIndex,deleted:!1};h||(0,a.shouldClearExpectedTs)(_,u,c,d)||c&&!c.deleted&&(T.expectedTs=c.expectedTs,T.expectedTsLastDeviceJobTs=c.expectedTsLastDeviceJobTs,T.expectedTsUpdateTs=c.expectedTsUpdateTs);return{update:T,clearRecord:h}};var n=r(52230),i=r(8243),a=r(89333),o=r(87622)},49884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOmittedResult=function(e,t,r,n){if(!t||t.deleted)return null;if(null!=e&&e<t.timestamp)return null;const s=(0,i.default)({},t);null!=e&&(s.timestamp=e,(0,o.shouldClearExpectedTs)(e,r,t,n)&&(s.expectedTs=void 0,s.expectedTsLastDeviceJobTs=void 0,s.expectedTsUpdateTs=void 0));return s.devices=[{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],{update:s,clearRecord:!1}};var i=n(r(81109)),a=r(52230),o=r(89333)},81864:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVSyncResult=function(e,t,r,n,a){const{deviceList:o,keyIndex:c}=t;if(null==c||null==c.signedKeyIndexBytes)return null!=o&&o.some((e=>e.id!==i.DEFAULT_DEVICE_ID))?void __LOG__(2)`processADVSyncResult: drop response with companion device but no keyIndexbytes`:(0,l.handleOmittedResult)(null==c?void 0:c.ts,n,null==c?void 0:c.expectedTs,a);const{ts:d,expectedTs:u,signedKeyIndexBytes:p}=c;return(0,s.handleKeyIndexResult)(e,o,d,p,r,n,a,u)},t.handleDeviceNotification=function(e,t,r,n,i,s){const{deviceList:l,keyIndex:c}=r;(0,a.default)(null!=l,`handleDeviceNotification: device list should not be none for device ${t} notification`),(0,a.default)(null!=c,`handleDeviceNotification: keyIndex should not be none for device ${t} notification`);const{ts:d,signedKeyIndexBytes:u}=c;if("add"===t)return(0,a.default)(null!=u,`handleDeviceNotification: signedKeyIndexBytes should not be none for device ${t} notification`),(0,o.handleDeviceAddNotification)(e,l,d,u,n,i,s);if("remove"===t)return(0,o.handleDeviceRemoveNotification)(l,c.ts,i)};var i=r(52230),a=n(r(41143)),o=r(79156),s=r(40626),l=r(49884)},87622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSignedKeyIndexBytes=function(e,t){let r,o;try{r=(0,n.decodeProtobuf)(i.ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!(0,a.verifyKeyIndexListAccountSignature)(r,e))return null;try{o=(0,n.decodeProtobuf)(i.ADVKeyIndexListSpec,r.details)}catch(e){return null}const{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}=o;if(null==s)return null;if(null==l)return null;return{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}};var n=r(84902),i=r(61438),a=r(46308)},80140:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockContact=function(e){return p((0,c.unproxy)(e),!0)},t.unblockContact=function(e){return p((0,c.unproxy)(e),!1)};var i=r(46331),a=r(30312),o=r(32826),s=r(88102),l=n(r(43725)),c=r(31019),d=r(77591),u=r(85893);function p(e,t,r){const{id:n}=e,c=e.isBlocked();if(t&&c||!t&&!c)return Promise.resolve();const f=(0,a.sendSetBlock)(t,n).then((e=>{e&&(t?o.BlocklistCollection.add({id:n}):o.BlocklistCollection.remove(n))}));return function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,i.genId)();const a={participant:e.formattedName},o=r?new i.ActionType(l.default.t(10,a)):new i.ActionType(l.default.t(132,a)),c=t.then((()=>{const t=r?l.default.t(9,a):l.default.t(131,a);return new i.ActionType(t,{actionText:l.default.t(133),actionHandler:()=>p(e,!r,n)})})).catch((t=>{if(!(t instanceof d.ServerStatusCodeError)){__LOG__(3)`action:setBlock dropped`;const t=r?l.default.t(8,a):l.default.t(130,a);throw new i.ActionType(t,{actionText:l.default.t(129),actionHandler:()=>p(e,r,n)})}if(t.statusCode>=400)throw r?new i.ActionType(l.default.t(8,a)):new i.ActionType(l.default.t(130,a))}));s.Cmd.openToast((0,u.jsx)(i.ActionToast,{id:n,initialAction:o,pendingAction:c}))}(e,f,t,r),f}},352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onIsBusinessChange=function(e){const t=(0,i.unproxy)(e),{businessProfile:a,id:o}=t,s=t.isBusiness||t.isMe&&n.Conn.isSMB;s&&!a?t.addChild("businessProfile",r(93581).BusinessProfileCollection.gadd(o)):!s&&a&&(t.stopListening(a),t.businessProfile=void 0,a.delete())};var n=r(17239),i=r(31019)},43024:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactFindQuery=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(13042),o=r(1255),s=r(7293),l=r(76285),c=n(r(56891));function d(){return(d=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=performance.now(),n={},i=yield c.default.contactFindQuery(e.retry,(e=>{n.binarySize=e.binarySize}));if("preempted"===i.data)return Promise.reject(new o.CollectionSilentQueryError("contacts preempted"));n.count=i.data.length,n.timing=Math.ceil(performance.now()-t);const d=r(19380).ContactCollection;return d.trigger(a.COLLECTION_HAS_SYNCED,n),(0,l.mungePSAContact)(i.data),i.checksum&&(d.setChecksum(i.checksum),__LOG__(2)`Store:Contact:query update checksum ${i.checksum}`),Promise.resolve(i.data)}))).apply(this,arguments)}},75888:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getOrQueryUsyncInfo=function(){return _.apply(this,arguments)},t.usyncContactCached=function(){return new a.default(u.queryPhoneExists,{maxCached:100,maxAge:36e4,shouldCache:e=>!!e})};var i=n(r(48926)),a=n(r(18569)),o=r(69951),s=r(91036),l=r(19380),c=r(7293),d=r(10435),u=r(69722),p=n(r(72639)),f=n(r(29126));function _(){return(_=(0,i.default)((function*(e){const t=l.ContactCollection.get(e);var r,n;if(null!=t&&(null!=t.name||null!=o.ChatCollection.get(e)))return Promise.resolve({wid:e,biz:t.isBusiness,bizInfo:t.isBusiness?{verifiedName:{level:(0,f.default)(t.verifiedLevel),serial:null,name:t.verifiedName,isApi:Boolean(t.isEnterprise),privacyMode:t.privacyMode}}:null,disappearingMode:(0,d.isDisappearingModeEnabled)()?{duration:null!==(r=t.disappearingModeDuration)&&void 0!==r?r:0,settingTimestamp:null!==(n=t.disappearingModeSettingTimestamp)&&void 0!==n?n:0}:null});const i=yield(0,u.queryExists)(e);if(i){const{biz:r,bizInfo:n,disappearingMode:a}=i;return c.GK.supportsFeature(c.GK.F.QUERY_VNAME)&&r&&(0,p.default)(e,n),(0,d.isDisappearingModeEnabled)()&&a&&null!=t&&(0,s.updateDisappearingMode)(e,a.duration,a.settingTimestamp),i}return Promise.reject(new Error("Invalid number"))}))).apply(this,arguments)}},84765:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryIdentity=function(e){const t=(0,a.unproxy)(e),{verificationBinary:r,verificationString:n,id:l}=t;if(r&&n)return Promise.resolve();if(t.promises.queryIdentity)return t.promises.queryIdentity;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));t.promises.queryIdentity=o.default.queryIdentity(l).then((t=>{s(e,t)})).catch((e=>{__LOG__(3)`models:contact:queryIdentity error: ${String(e)}`})).finally((()=>{t.promises.queryIdentity=null}))},t.updateIdentity=s;var i=r(7293),a=r(31019),o=n(r(56891));function s(e,t){const r=(0,a.unproxy)(e);null!=t.status&&t.status>=400?(r.unset("verificationBinary"),r.unset("verificationString")):(r.verificationBinary=t.binary,r.verificationString=t.string)}},1291:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeviceRecordForIdentityChange=g,t.handleNewIdentity=function(){return h.apply(this,arguments)},t.handleSelfPrimaryIdentityChange=function(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){__LOG__(4,void 0,new Error,!0)`handleNewIdentity: ignore identity change for your own primary device`,SEND_LOGS("self-identity-change");const e=r(65044).Socket,t=r(83578).LogoutReason;e.logout(!1,t.PrimaryIdentityKeyChange)}};var i=n(r(48926)),a=r(52230),o=r(72441),s=r(45454),l=r(66308),c=r(9108),d=n(r(69153)),u=r(7293),p=r(99069),f=r(58928),_=r(84356);function h(){return(h=(0,i.default)((function*(e){var t;if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in MD mode"));const n=Promise.resolve(),i=window.libsignal.SignalProtocolAddress.fromString(e).getName(),c=(0,s.createWid)((0,o.toPhoneUserJid)(i)),d=null!==(t=c.device)&&void 0!==t?t:a.DEFAULT_DEVICE_ID,p=(0,s.toUserWid)(c);if(d===a.DEFAULT_DEVICE_ID){_.Voip.notifyDeviceIdentityChangedOrDeleted(c,!0);const e=r(9701).addSecurityCodeChangedNotifications;yield g(p),yield e(p)}else yield(0,l.createAndStoreDeviceNotifications)(p,[d],[d]);return n}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND))return Promise.reject(new Error("clearDeviceRecordForIdentityChange: This call is only supported in MD mode"));const n=[a.DEFAULT_DEVICE_ID],i=[a.DEFAULT_DEVICE_ID];if(t)d.default.addOfflinePendingDevice(String(e),null),yield(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,n)));else{const t=yield(0,c.getDeviceRecord)(e.user);t&&!t.deleted&&t.devices.forEach((e=>{e.id!==a.DEFAULT_DEVICE_ID&&n.push(e.id)}));const o=r(77605).Session;Promise.all(n.map((t=>t===a.DEFAULT_DEVICE_ID?Promise.resolve():o.deleteRemoteInfo((0,s.createDeviceWidFromUserAndDevice)(e.user,t))))),yield Promise.all([(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,n))),(0,c.createOrReplaceDeviceRecord)({id:e.user,deleted:!0})])}}))).apply(this,arguments)}},3879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveLocation=function(e,t){const r=(0,n.unproxy)(e);r.liveLocations||(r.liveLocations=[]);const{liveLocations:i}=r;i.push(t)},t.removeLiveLocation=function(e,t){const r=(0,n.unproxy)(e),{liveLocations:i}=r;if(!i)return;for(let e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&(r.liveLocations=null)};var n=r(31019)},16150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePushname=function(e,t){const r=(0,i.toUserWid)(e);return s.enqueue((()=>{(0,a.getBridge)().sendAndReceive("contact_collection","updatePushname",{contactId:r,pushname:t}).then((e=>{if(e||void 0===e)return __LOG__(2)`updatePushName: set pushname for ${String(r)}`,(0,o.updateLocal)(r,{pushname:t})}))}))};var n=r(27870),i=r(45454),a=r(41796),o=r(27211);const s=new n.PromiseQueue},32613:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resyncContacts=function(e){void 0!==i.ContactCollection.checksum&&void 0!==e&&(i.ContactCollection.checksum!==e?i.ContactCollection.findQuery({retry:!0}).then((e=>{if(Array.isArray(e)){(0,l.mungePSAContact)(e),__LOG__(2)`Store:Contact:resync success`;const t=(0,s.getContactsToRemove)(e);let r=Promise.resolve();if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&t.length){const e=t.map((e=>e.id.toString()));r=(0,o.getContactTable)().bulkRemove(e).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from contact table failed`,SEND_LOGS("bulkRemove from contact table failed when resyncing contacts"),new Error("bulkRemove from contact table failed")}))}r.then((()=>{t.forEach((e=>{e.unset("name"),e.unset("shortName")}))}))}else __LOG__(3)`Store:Contact.resync error ${JSON.stringify(e)}`})).catch((0,n.filteredCatch)(c.WebdDrop,(()=>{}))):__LOG__(2)`Store:Contact:resync checksum match`)};var n=r(50796),i=r(19380),a=r(7293),o=r(76214),s=r(88129),l=r(76285),c=r(77591)},9701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSecurityCodeChangedNotifications=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(90257),s=r(99234),l=r(7293),c=r(41796),d=r(76214),u=n(r(29783)),p=r(90641);function f(){return(f=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const{notifications:r,chatIds:n}=yield _(e);if(0===r.length)return;if(!t){Promise.all(r.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,c.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})));const e=yield(0,p.encryptMultipleMsgs)(r);return(0,p.storeEncryptedMessage)(e,n,!1)}u.default.addOfflineMessage(r.map((e=>({msg:e}))))}}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t={notifications:[],chatIds:[]};if(!(0,s.getGlobalSecurityNotifications)())return t;let r=[];try{const t=yield(0,d.getChatTable)().get(String(e));r=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((e=>(0,a.createWid)(e.groupId))),t&&r.push((0,a.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chats failed")}const n=r.map((t=>(0,o.genSecurityCodeNotificationMsg)(t,e)));return t.notifications=n,t.chatIds=r.map(String),t}))).apply(this,arguments)}},76285:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mungePSAContact=function(e){if(Array.isArray(e)){const t=e.findIndex((e=>e&&i.default.isPSA(e.id))),r=e[t];t>-1&&r&&(r.name=a.default.t(1029),r.shortName=a.default.t(1029))}};var i=n(r(89867)),a=n(r(43725))},42822:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnjoinedSubgroupsToCollection=function(e,t){e.forEach((e=>{null!=e&&s.default.add({id:e.id,subject:e.subject,parentId:t},{merge:!0})}))},t.changesForParentGroupLink=function(e,t){var r;const n=o.ChatCollection.get(e.toString()),{parentGroupChanges:a,subgroupChanges:s}=c(n,t);return{parentGroupChanges:(0,i.default)((0,i.default)({},a),{},{unjoinedSubgroups:a.unjoinedSubgroups.map((e=>e.toString()))}),subgroupChanges:(0,i.default)((0,i.default)({},s),{},{parentGroup:null===(r=s.parentGroup)||void 0===r?void 0:r.toString(),unjoinedSubgroups:s.unjoinedSubgroups.map((e=>e.toString()))})}},t.changesForSubgroupLink=function(e,t){const r=l(o.ChatCollection.gadd(e),t);return(0,i.default)((0,i.default)({},r),{},{unjoinedSubgroups:r.unjoinedSubgroups.map((e=>e.toString()))})},t.getUnjoinedGroupIds=d,t.updateModelsForParentGroupLink=function(e,t){const r=o.ChatCollection.get(e.toString()),{parentGroupChanges:n,subgroupChanges:i}=c(r,t);(null==r?void 0:r.groupMetadata)&&Object.assign(r.groupMetadata,n);t.groupMetadata&&Object.assign(t.groupMetadata,i)},t.updateModelsForSubgroupLink=function(e,t){const r=e.groupMetadata,n=l(e,t);null!=r&&Object.assign(r,n)};var i=n(r(81109)),a=n(r(2883)),o=(r(63183),r(69951)),s=n(r(73213));function l(e,t){const r=e.groupMetadata,n=d(t);return{unjoinedSubgroups:(i=null==r?void 0:r.unjoinedSubgroups,o=n,(0,a.default)(null!=i?i:[],null!=o?o:[],((e,t)=>e.equals(t)))),isParentGroup:!0,parentGroup:void 0};var i,o}function c(e,t){var r;const n={parentGroup:null==e?void 0:e.id,isParentGroup:!1,unjoinedSubgroups:[]},i={};return null!=(null==e||null===(r=e.groupMetadata)||void 0===r?void 0:r.unjoinedSubgroups)&&(i.unjoinedSubgroups=e.groupMetadata.unjoinedSubgroups.filter((e=>e!==t))),{parentGroupChanges:i,subgroupChanges:n}}function d(e){return e.filter((e=>{var t;const r=o.ChatCollection.get(e.toString());return null==r||!(null===(t=r.groupMetadata)||void 0===t?void 0:t.participants.iAmMember())}))}},56489:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;return S(e,t,r,n,void 0,i,a)},t.sendForNeededAddRequest=v;var i=n(r(81109)),a=r(50796),o=r(87614),s=r(45454),l=r(48360),c=r(46331),d=r(88102),u=r(19380),p=r(79583),f=r(50101),_=r(7293),h=n(r(43725)),g=r(3764),m=r(82039),y=r(77591),E=r(85893);function S(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,c.genId)(),s=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const _=n.map((e=>e.id)),T=void 0,C=(0,p.sendCreateGroup)(e,_,T,(0,o.randomHex)(8),!1,!1,s,u),A=new c.ActionType(h.default.t(51)),b=C.then((t=>(v(t,e,T),new c.ActionType(h.default.t(50))))).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(e=>406===e.status?new c.ActionType(h.default.t(47)+" "+h.default.t(48)):429===e.status?new c.ActionType(h.default.t(47)+" "+l.fbt._("You've created too many groups too quickly. Try again later.",null,{hk:"2fN2Us"}).toString()):void 0))).catch((()=>(__LOG__(3)`models:chatCollection:createGroup dropped`,new c.ActionType(h.default.t(47),{actionText:h.default.t(129),actionHandler:()=>S(e,t,r,n,i,s)}))));return d.Cmd.openToast((0,E.jsx)(c.ActionToast,{id:i,initialAction:A,pendingAction:b})),C.then((e=>{if(null==u&&e.gid&&(0,f.findChat)(e.gid).then((e=>{d.Cmd.openChatBottom(e).then((t=>{t&&d.Cmd.focusChatTextInput(e)}))})),!e._duplicate&&t&&r){const n=m.ProfilePicThumbCollection.gadd(e.gid);return(0,g.setProfilePic)(n,t,r).then((()=>e.gid))}return e._duplicate&&__LOG__(3)`createGroup failed to set picture.`,e.gid})).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(()=>{})))}function v(e,t,r,n){if(!_.GK.supportsFeature(_.GK.F.GROUPS_V_4_JOIN_PERMISSION))return;if(!e.participants)return;const a=n||e.gid;a||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Group add request was provided with undefined gid"));const o=e.participants.reduce(((e,t)=>{const r=Object.keys(t)[0];if("403"!==t[r].code)return e;const n=(0,s.createWid)(r),a=u.ContactCollection.gadd(n,{silent:!0});return[...e,(0,i.default)((0,i.default)({},t[r]),{},{contact:a})]}),[]);o.length>0&&a&&d.Cmd.openGroupV4InviteRequestFlow(o,a,t,r)}},5501:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.localExitGroup=g,t.sendExitGroup=function(e){return h((0,u.unproxy)(e))};var i=r(50796),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(90447),c=r(99234),d=n(r(43725)),u=r(31019),p=r(77591),f=r(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function h(e){const{isGroup:t,promises:r}=e;if(!t)return Promise.reject(new s.ActionError);if(r.sendExit)return r.sendExit;const n=r.sendExit=(0,l.sendExitGroup)(e.id),c=new a.ActionType(d.default.t(57)),u=n.then((function(){return new a.ActionType(d.default.t(56))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(e=>{if(e.status>=400)return new a.ActionType(d.default.t(55))}))).catch((function(){return __LOG__(3)`actions:chat:sendExit dropped`,new a.ActionType(d.default.t(55),{actionText:d.default.t(129),actionHandler:()=>h(e)})}));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:(0,a.genId)(),initialAction:c,pendingAction:u})),n.then((t=>{t._duplicate||g(e)})).finally((()=>{r.sendExit=null})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(()=>{})))}function g(e){var t;e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.participants.remove((0,c.getMaybeMeUser)()),(0,l.markExited)(e.id).then((()=>{e.isReadOnly=!0})).catch((e=>{throw __LOG__(4,!0,new Error,!0)`failed to merge chat table`,SEND_LOGS("failed to merge chat table when exiting group: "+e),new Error("failed to merge chat table")})))}},36098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_ACTIONS=void 0;const r=Object.freeze({SUBJECT:"subject",ADD:"add",PROMOTE:"promote",DEMOTE:"demote",REMOVE:"remove",MODIFY:"modify",INVITE_CODE:"invite",DESC_ADD:"desc_add",DESC_REMOVE:"desc_remove",RESTRICT:"restrict",ANNOUNCE:"announce",NO_FORWARD:"no_frequently_forwarded",EPHEMERAL:"ephemeral",REVOKE_INVITE:"revoke_invite",SUSPEND:"suspend",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",SUB_GROUP_LINK:"sub_group_link",PARENT_GROUP_LINK:"parent_group_link",SIBLING_GROUP_LINK:"sibling_group_link"});t.GROUP_ACTIONS=r},42952:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupAction=function(e,t,r){return function(e,t,r){const n=(0,i.default)(e.groupMetadata,"chat.groupMetadata"),{action:c}=r;switch(r.action){case s.GROUP_ACTIONS.SUBJECT:const i={name:r.subject};e.contact.set(i);break;case s.GROUP_ACTIONS.ADD:case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:const d=r.participants.map((e=>({id:e,isAdmin:"promote"===c})));n.participants.add(d,{merge:!0}),"add"===c&&(r.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)})),t&&!o.ContactCollection.get(t)&&n.set({notAddedByContact:!0,addedBy:t}));break;case s.GROUP_ACTIONS.REMOVE:r.participants.forEach((e=>{n.participants.remove(e)})),r.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)}));break;case s.GROUP_ACTIONS.MODIFY:if(t&&r.participants&&r.participants.length>0){const e=r.participants[0],i=n.participants.remove(t);let a=!1,o=!1;i.length&&i[0]&&(a=i[0].isAdmin,o=i[0].isSuperAdmin);const s={id:e,isAdmin:a,isSuperAdmin:o};n.participants.add(s)}break;case s.GROUP_ACTIONS.INVITE_CODE:r.code?n.inviteCode=r.code:__LOG__(3)`model:chat:handleGroupAction:invalid invite code: ${r.code} for ${e.id.toString()}`;break;case s.GROUP_ACTIONS.DESC_ADD:n.set({desc:r.desc,descId:r.descId,descTime:r.descTime,descOwner:null==t?void 0:t.toString()});break;case s.GROUP_ACTIONS.DESC_REMOVE:if(n.descId===r.descId){n.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0});break}break;case s.GROUP_ACTIONS.RESTRICT:n.restrict=!!r.value;break;case s.GROUP_ACTIONS.SUSPEND:n.suspended=!!r.value;break;case s.GROUP_ACTIONS.ANNOUNCE:n.announce=!!r.value;break;case s.GROUP_ACTIONS.NO_FORWARD:n.noFrequentlyForwarded=!!r.value;break;case s.GROUP_ACTIONS.EPHEMERAL:n.ephemeralDuration=r.duration;break;case s.GROUP_ACTIONS.REVOKE_INVITE:break;case s.GROUP_ACTIONS.GROWTH_UNLOCKED:n.growthLockExpiration=void 0,n.growthLockType=void 0;break;case s.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===r.type&&(n.growthLockExpiration=r.expiration,n.growthLockType=r.type);break;case s.GROUP_ACTIONS.PARENT_GROUP_LINK:(0,a.updateModelsForParentGroupLink)(r.groups[0],e);break;case s.GROUP_ACTIONS.SUB_GROUP_LINK:(0,a.updateModelsForSubgroupLink)(e,r.groups);break;case s.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupAction`}return Promise.resolve()}((0,c.unproxy)(e),t,r)};var i=n(r(45095)),a=r(42822),o=r(19380),s=r(36098),l=n(r(63928)),c=r(31019)},34648:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupActionMD=function(e,t,r){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return function(){return I.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupActionMD: only supported on MD"))},t.handleGroupActionWap=function(e,t){const{chatId:n,author:i}=e,a=r(69951).ChatCollection.get(n);if(!a)return void __LOG__(3)`model:chat: unknown chat for ${n.toString()}, action ${JSON.stringify(t)}`;(0,y.handleGroupAction)(a,i,t)},t.handleGroupCreation=function(e,t,r){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return function(){return M.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupCreation: should not be called in wap mode"))};var i=n(r(48926)),a=r(50796),o=n(r(45095)),s=r(19380),l=r(91829),c=r(57062),d=r(76581),u=r(99234),p=r(9025),f=r(7293),_=r(57701),h=r(62415),g=r(90101),m=r(36098),y=r(42952),E=r(84886),S=n(r(11339)),v=r(59871),T=r(70405),C=r(80474),A=r(16150),b=r(10790),P=r(92188);function M(){return(M=(0,i.default)((function*(e,t,r){var n,i,a;__LOG__(2,void 0,void 0,void 0,["groups"])`inside handleGroupCreationMD`;const{chatId:o,author:d,pushname:f}=e;null!=e.author&&e.author.equals((0,u.getMaybeMeUser)())||new S.default.GroupJoinC({}).commit(),d&&f&&(0,A.updatePushname)(d,f),yield Promise.all([(0,C.updateParticipantsJob)(t.id,t.participants,t.pvId,r),(0,c.updateGroupMetadataTableJob)([t])]),__LOG__(2,void 0,void 0,void 0,["groups"])`updated GroupMetadata and participants tables`;let h=yield(0,p.getExisting)(o);if(h){var g;(0,b.updateSubject)(o,t.subject),null===(g=h.groupMetadata)||void 0===g||g.set(t)}else{var m;h=yield(0,l.create)(o,{t:t.creation,pendingInitialLoading:!1,createdLocally:!1}),null===(m=h.groupMetadata)||void 0===m||m.set(t),__LOG__(2,void 0,void 0,void 0,["groups"])`updated chat model and table`;s.ContactCollection.gadd(t.id).set({name:t.subject}),__LOG__(2,void 0,void 0,void 0,["groups"])`updated contact name`}const y=(null!==(n=null===(i=h.groupMetadata)||void 0===i?void 0:i.participants)&&void 0!==n?n:[]).length,E=null===(a=h.groupMetadata)||void 0===a?void 0:a.announce;!r&&!E&&y&&(0,_.sendKeyDistributionMsgToNewGroups)()&&y>=(0,_.sendKeyDistributionMsgMinGroupSize)()&&(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message`,(0,P.sendKeyDistributionMsg)(h).then((()=>{__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message: done`})).catch((e=>{__LOG__(3,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message failed: ${e}`})))}))).apply(this,arguments)}function O(e,t){return t?(0,c.markGroupAsDirtyJob)(e):(0,b.sendQueryGroup)(e)}function I(){return(I=(0,i.default)((function*(e,t,n){var i,l,p;__LOG__(2,void 0,void 0,void 0,["groups"])`inside _handleGroupActionMD`;const{chatId:f,author:_,pushname:S}=e;_&&S&&(0,A.updatePushname)(_,S);const b=[],P=r(69951).ChatCollection.get(f);switch(t.action){case m.GROUP_ACTIONS.ADD:_&&!s.ContactCollection.get(_)&&b.push((0,g.persistGroupMetadata)(f,{notAddedByContact:!0,addedBy:_.toString()})),b.push((0,C.addParticipantsJob)(f,t.participants,t.version,t.prevVersion,n).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`addParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.REMOVE:b.push((0,C.removeParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));const e=(0,u.getMaybeMeUser)();e&&t.participants.find((t=>t.equals(e)))&&(0,u.removeUserSentMessageToChat)(f);break;case m.GROUP_ACTIONS.DEMOTE:b.push((0,C.demoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.PROMOTE:b.push((0,C.promoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.REVOKE_INVITE:const y=null===(i=(0,u.getMaybeMeUser)())||void 0===i?void 0:i.toString();if(!y)return void __LOG__(3)`getMaybeMeUser returned null, can't process action ${t}`;const S=null==_?void 0:_.toString();let A=[];if(null==S)return void __LOG__(3)`Received revoke without an admin jid ${t}`;if(S===y)A=t.participants.map((e=>({from:y,to:e.id.toString(),groupId:f.toString(),expiration:e.expiration})));else{const e=t.participants.find((e=>e.id.toString()===y));if(!e)return __LOG__(4,void 0,new Error,!0)`Received group invite revokation from ${S}, but user not in participants list`,void SEND_LOGS("bad-revoke");A=[{from:S,to:y,groupId:f.toString(),expiration:e.expiration}]}const P=yield Promise.all(A.map((e=>(0,h.revokeGroupInvites)(e.from,e.to,e.groupId,e.expiration)))),M=[];P.flat().map((e=>{(null==e?void 0:e.id)&&M.push(e.id)})),(yield(0,d.msgFindByIds)(M)).map((e=>{var t;null===(t=v.MsgCollection.get(e.id))||void 0===t||t.set({inviteCodeExp:"0"}),e.inviteCodeExp="0",(0,E.updateExistingMessages)([e],e.id.remote)}));break;case m.GROUP_ACTIONS.MODIFY:if(1!==t.participants.length){__LOG__(3)`_handleGroupActionMD: participants length should be 1, but is ${t.participants.length}`;break}b.push((0,c.modifyGroupParticipantJob)(f,(0,o.default)(_,"author"),t.participants[0],null!==(l=t.prevVersion)&&void 0!==l?l:-1,null!==(p=t.version)&&void 0!==p?p:-1));break;case m.GROUP_ACTIONS.SUBJECT:b.push((0,g.persistGroupMetadata)(f,{subject:t.subject}));break;case m.GROUP_ACTIONS.DESC_ADD:b.push((0,g.persistGroupMetadata)(f,{desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==_?void 0:_.toString()}));break;case m.GROUP_ACTIONS.DESC_REMOVE:b.push((0,g.persistGroupMetadata)(f,{desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));break;case m.GROUP_ACTIONS.RESTRICT:b.push((0,g.persistGroupMetadata)(f,{restrict:!!t.value}));break;case m.GROUP_ACTIONS.SUSPEND:b.push((0,g.persistGroupMetadata)(f,{suspended:!!t.value}));break;case m.GROUP_ACTIONS.ANNOUNCE:b.push((0,g.persistGroupMetadata)(f,{announce:!!t.value}));break;case m.GROUP_ACTIONS.NO_FORWARD:b.push((0,g.persistGroupMetadata)(f,{noFrequentlyForwarded:!!t.value}));break;case m.GROUP_ACTIONS.EPHEMERAL:b.push((0,g.persistGroupMetadata)(f,{ephemeralDuration:t.duration}));break;case m.GROUP_ACTIONS.INVITE_CODE:break;case m.GROUP_ACTIONS.GROWTH_UNLOCKED:b.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:void 0,growthLockType:void 0}));break;case m.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&b.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:t.expiration,growthLockType:t.type}));break;case m.GROUP_ACTIONS.PARENT_GROUP_LINK:const I=t.groups[0],{parentGroupChanges:w,subgroupChanges:R}=r(42822).changesForParentGroupLink(I,f);b.push((0,g.persistGroupMetadata)(f,R)),b.push((0,g.persistGroupMetadata)(I,w));break;case m.GROUP_ACTIONS.SUB_GROUP_LINK:b.push((0,g.persistGroupMetadata)(f,r(42822).changesForSubgroupLink(f,t.groups)));break;case m.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupActionMD for action ${JSON.stringify(t)}`}yield Promise.all(b),__LOG__(2,void 0,void 0,void 0,["groups"])`finished all storageTasks`,P&&(0,y.handleGroupAction)(P,_,t)}))).apply(this,arguments)}},48537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(e,t,r,n){return(0,c.sendJoinGroupViaInviteV4)(e,t,r,n)},t.queryGroupInviteV4Info=function(){return d.apply(this,arguments)},t.revokeGroupInviteV4=function(e,t){return(0,c.sendRevokeGroupInviteV4)(e,t)};var i=n(r(48926)),a=r(45454),o=r(69951),s=r(19380),l=r(53686),c=r(64808);function d(){return(d=(0,i.default)((function*(e,t,n,i){let d=null;const u=r(63928).default.get(n);return u&&(d=yield(0,l.phashV1)(u.participants.map((e=>e.id)))),(0,c.sendQueryGroupInviteV4)(e,t,n,i,d).then((e=>{if(null!=e.status&&e.status>0)return e;if(null!=e.id)return s.ContactCollection.gadd(e.id),e;const t=r(63928).default.assertGet((0,a.createWidFromWidLike)(n)),i=o.ChatCollection.assertGet(t.id).contact.name;return{id:t.id,owner:t.owner,creation:t.creation,desc:t.desc,descId:t.descId,descOwner:t.descOwner,descTime:t.descTime,restrict:t.restrict,announce:t.announce,ephemeralDuration:t.ephemeralDuration,growthLockExpiration:t.growthLockExpiration,growthLockType:t.growthLockType,noFrequentlyForwarded:t.noFrequentlyForwarded,subject:i,participants:t.participants.map((e=>({id:e.id,isAdmin:e.isAdmin,isSuperAdmin:e.isSuperAdmin})))}}))}))).apply(this,arguments)}},96269:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupFromPhone=function(){return u.apply(this,arguments)},t.queryGroupInviteInfo=function(){return p.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),o=n(r(81629)),s=r(19380),l=n(r(14423)),c=r(10790);const d=["status","subject"];function u(){return(u=(0,a.default)((function*(e){const t=yield(0,c.groupMetadataFindFromPhone)(e);return"ok"===t.status?t.data:"missing"!==t.status?"error"===t.status?(__LOG__(3)`model:GroupMetadata:find error ${t.info}`,Promise.reject(new Error("model:GroupMetadata:find error"))):void 0:void(0,o.default)((()=>{r(69951).ChatCollection.assertGet(e).delete()}))}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){const t=yield(0,c.sendQueryGroupInvite)(e),{status:n,subject:a}=t,o=(0,i.default)(t,d),u=new l.default(o);s.ContactCollection.gadd(u.id);const p=r(69951).ChatCollection.get(u.id);return{status:n,subject:a,groupMetadata:u,inGroup:!!p&&!p.isReadOnly}}))).apply(this,arguments)}},74028:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateGroupMetadataModel=E,t.queryAndUpdateAllGroupMetadata=function(){return g.apply(this,arguments)},t.queryAndUpdateGroupMetadataById=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,h.queryGroupJob)(e).then(function(){var e=(0,i.default)((function*(e){yield(0,o.updateGroupParticipantTableWithoutDeviceSyncJob)([e]),E(e)}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(22683),o=r(57062),s=r(7293),l=r(37654),c=n(r(63928)),d=r(50313),u=r(5819),p=r(53686),f=r(85057),_=r(10790),h=r(61051);function g(){return(g=(0,i.default)((function*(){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const e=yield(0,f.queryAllGroups)();if(!e)return;e.forEach((e=>{E(e),m(e)})),yield(0,o.updateGroupMetadataTableJob)(e),yield(0,o.updateGroupParticipantTableWithoutDeviceSyncJob)(e)}return Promise.resolve()}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=(0,d.getInitialGroupPhash)(e.id.toString()),r=yield(0,p.phashV1)(e.participants.map((e=>e.id))),n=r.substring(2);t!==r&&t!==n&&(0,u.handleSingleMsgMD)(e.id,(0,l.genIntialPhashMismatchMsg)(e.id,a.Clock.globalUnixTime()))}))).apply(this,arguments)}function E(e){var t,r,n,i,a;(0,_.updateSubject)(e.id,e.subject),c.default.gadd({id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict||!1,announce:e.announce||!1,noFrequentlyForwarded:e.noFrequentlyForwarded||!1,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,participants:e.participants,support:null!==(t=e.support)&&void 0!==t&&t,unjoinedSubgroups:null!==(r=e.unjoinedSubgroups)&&void 0!==r?r:[],suspended:null!==(n=e.suspended)&&void 0!==n&&n,isParentGroup:null!==(i=e.parent)&&void 0!==i&&i,parentGroup:e.parentGroup,defaultSubgroup:null!==(a=e.defaultSubgroup)&&void 0!==a&&a})}},54248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(0,n.getMaybeMeUser)().equals(e.id)){const r=i.PresenceCollection.get(e.id);r&&("unsubscribe"===e.type?r.set({isSubscribed:!1,stale:!0}):(a(r,e),t&&r.set({stale:!1})))}return Promise.resolve()};var n=r(99234),i=r(68315);function a(e,t){let r,n=!1;if(void 0===t.type?t.type=e.chatstate.type||"unavailable":"paused"===t.type&&(n=!0,t.type="available"),e.isGroup&&"available"!==t.type&&(t.updateTime=Date.now()),e.isGroup){if(!t.participant)return;t.id=t.participant,t.participant=void 0,r=e.chatstates.gadd(t.id)}else r=e.chatstate;n&&"composing"!==r.type&&"recording"!==r.type||r.set(t),r.expireTimerId&&clearTimeout(r.expireTimerId),"composing"===r.type||"recording"===r.type?r.expireTimerId=setTimeout((()=>function(e){const t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}(r)),25e3):r.expireTimerId=void 0;const i=e.forceDisplay||e.isOnline||e.isUser&&!e.chatstate.deny;e.set({hasData:!0,isSubscribed:!0,forceDisplay:i})}},37638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeProfilePicThumb=function(e,t){return n.ProfilePicThumbCollection.imageChanged(e,t),Promise.resolve()};var n=r(82039)},78027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanAck=function(){return g.apply(this,arguments)},t.updateMsgAck=_;var i=n(r(48926)),a=r(35470),o=n(r(89867)),s=r(45454),l=r(25680),c=r(7293),d=r(41796),u=r(39354),p=r(59871),f=n(r(83147));function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,r){const{ack:n,t:i,from:l,to:p}=r,{remote:_,id:h}=e.id;if(e.updateAck(n,i),c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const{deliveryPrivacyMode:t}=r;n===a.ACK.RECEIVED&&null!=t&&e.isSentByMe&&(yield(0,u.handlePrivacyModeTransition)(_,t).catch((()=>{__LOG__(4,void 0,new Error,!0)`msg ack: handlePrivacyModeTransition failed`,SEND_LOGS("msg ack: handlePrivacyModeTransition failed")})),yield(0,f.default)(e,t))}const g=(0,d.getBridge)();if(yield g.sendAndReceive("msg_collection","updateLastReceipt",{wid:_,t:i}),o.default.isUser(_)){if(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:p,ack:n,participant:_,t:i}),t&&o.default.isBroadcast(t)){const e=t instanceof o.default?t:(0,s.createWid)(t);yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:e,ack:n,participant:_,t:i})}}else o.default.isStatusV3(_)&&(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:_,ack:n,participant:p,t:i}))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const r=p.MsgCollection.get(e);if(!r)return Promise.reject(new Error(`processOrphanAck: no msg found for id ${e.toString()}`));try{const e=yield(0,l.getHighestAck)(r);if(!e||e.ack===r.ack)return;return _(r,t,e)}catch(e){__LOG__(4,void 0,new Error)`Assertion failed: processOrphanAck failed!`}}))).apply(this,arguments)}},8765:(e,t,r)=>{"use strict";var n=r(95318);t.o0=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(92844),s=r(15461),l=n(r(89867)),c=r(84902),d=r(24808),u=r(99234),p=r(57701),f=r(49714),_=r(45033),h=r(76332),g=r(99069),m=r(93832),y=r(12896);function E(e){let t;const r=e.id.remote,n={externalId:e.id.id,ts:(0,o.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:r,pushname:null};var i;l.default.isGroup(r)?t=(0,a.default)((0,a.default)({},n),{},{type:f.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,u.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},n),{},{author:e.from,type:f.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:_.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){try{const t=(0,y.hydrateMessage)(e),n=t.id.remote;if(!(0,p.receiveReactionsEnabled)())return null;if(!l.default.isGroup(n)&&!l.default.isUser(n))return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: Reaction FutureProof msg.chat is an unexpected type`,null;const{msgInfo:i,e2eInfoType:a,paymentInfo:o,bizInfo:u}=E(t);if(null==t.futureproofBuffer)return null;const f=(0,m.unpad)(t.futureproofBuffer),_=(0,c.decodeProtobuf)(d.MessageSpec,f),h=r(27286).parseMessage,g=yield h(i,a,_,o,u,t.futureproofBuffer);if(null==g.renderableMsgs||null==g.renderableMsgs[0]||g.renderableMsgs[0].type!==s.MSG_TYPE.REACTION)return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: unexpected renderableMsgs`,null;const S=r(53348).createReactionsRow;return yield S(g.renderableMsgs[0],i)}catch(e){return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: reparse error`,null}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){try{let t=[];const n=e.filter((e=>e.type===s.MSG_TYPE.UNKNOWN&&e.subtype===s.MSG_TYPE.REACTION)),a=(yield Promise.all(n.map((e=>S(e))))).filter(Boolean);if(0===a.length)return;const o=a.map((e=>e.msgKey));yield(0,g.getStorage)().lock(["message","reactions"],function(){var e=(0,i.default)((function*(e){let[r,n]=e;t=yield(0,h.addOrUpdateReactionsDBBulk)(a),yield r.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()),t.forEach((e=>{(0,h.addOrUpdateReactionsModelCollection)(e,!1)})),o.forEach((e=>{const t=r(59871).MsgCollection.get(e);null==t||t.delete()}))}catch(e){__LOG__(4,void 0,new Error)`reparseReactionFutureProof: storeReactionsAndDeleteFP error`}}))).apply(this,arguments)}},39354:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrivacyModeTransition=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(93170),o=n(r(9762)),s=r(68708);function l(){return(l=(0,i.default)((function*(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.isUserNotPSA())return;let l=n;if(null==l){const t=r(9025).getExisting;l=yield t(e)}if(null==l)return;const c=l.contact;if(null!=c.privacyMode&&c.privacyMode.privacyModeTs>=t.privacyModeTs)return;const d={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:c.isBusiness,isEnterprise:c.isEnterprise,privacyMode:c.privacyMode},u={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:!0,isEnterprise:!0,privacyMode:t};c.set({isBusiness:!0,isEnterprise:!0,privacyMode:t}),yield Promise.all([i?null:(0,s.createOrUpdateVerifiedBusinessName)({id:c.id.user,isApi:!0,privacyMode:{actualActors:t.actualActors,hostStorage:t.hostStorage,privacyModeTs:t.privacyModeTs}},s.VerifiedBusinessNameUpdateType.Merge),(0,o.default)(c.id,d,u)])}))).apply(this,arguments)}},35288:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeHandlerAction=void 0;const n=r(76672).Mirrored(["DropMessage","SkipUI"]);t.ActiveRangeHandlerAction=n},91525:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActiveRangeHandlerAction",{enumerable:!0,get:function(){return f.ActiveRangeHandlerAction}}),Object.defineProperty(t,"RangeContain",{enumerable:!0,get:function(){return u.RangeContain}}),t.handleForActiveMessageRange=C,t.handleOfflineForMessageRange=function(){return b.apply(this,arguments)};var i=n(r(48926)),a=r(381),o=r(15461),s=r(45454),l=r(84902),c=r(69702),d=r(38342),u=r(87845),p=n(r(73407)),f=r(35288),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(13332)),h=r(93824);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}const m=new Set,y=e=>e.reduce(((e,t)=>new Set([...Array.from(e),...Array.from(t)])),new Set);function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r){let n=null;switch(e.action){case c.ActiveRangeAction.Archive:return e.actionValue.archived?yield _.handleForArchive(e,r):yield _.handleForUnarchive(e,r),m;case c.ActiveRangeAction.MarkChatAsRead:return yield _.handleForMarkAsReadUnread(e,r,!!e.actionValue.read),m;case c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return n=_.handleForClearChat(e,r),n?new Set([n]):m;case c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case c.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return(yield v(t.id))?m:(n=_.handleForClearChat(e,r),n?new Set([n]):m);case c.ActiveRangeAction.DeleteChatDeleteMedia:case c.ActiveRangeAction.DeleteChatKeepMedia:return n=_.handleForDeleteChat(e,r),n?new Set([n]):m}return __LOG__(3)`handleMessageContainment called with unknwon message range action action: ${e.action}`,m}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,h.constructStarMsgKeyFromMsgKey)(e),r=yield p.default.getSyncAction(t);if(r){var n;return(null===(n=(0,l.decodeProtobuf)(a.SyncActionValueSpec,r.binarySyncAction).starAction)||void 0===n?void 0:n.starred)||!1}return!1}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){if(o.SYSTEM_MESSAGE_TYPES.includes(t.type))return m;const r=(yield(0,d.getActiveMessageRanges)(e.toString())).map((e=>[e,(0,u.rangeContainsMessage)(e.actionValue.messageRange,t)])),n=r.filter((e=>{let[,t]=e;return t===u.RangeContain.CONTAINS_BY_ADDITIONAL})).map((e=>{let[t]=e;return t}));n.forEach((e=>{e.remainingMessages--})),yield(0,d.bulkUpdateActiveMessageRanges)(n);const i=r.map((e=>{let[r,n]=e;return E(r,t,n)})),a=yield Promise.all(i);return y(a)}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{if(o.SYSTEM_MESSAGE_TYPES.includes(e.type))return;const r=t.get(e.id.remote.toString());(null==r||r.t<e.t)&&t.set(e.id.remote.toString(),e)})),yield Promise.all(Array.from(t.entries()).map((e=>{let[t,r]=e;return C((0,s.createWid)(t),r)})))}))).apply(this,arguments)}},13332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForArchive=function(){return u.apply(this,arguments)},t.handleForClearChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForDeleteChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForMarkAsReadUnread=function(){return f.apply(this,arguments)},t.handleForUnarchive=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(38342),s=r(87845),l=r(35288),c=r(57701),d=n(r(68132));function u(){return(u=(0,i.default)((function*(e,t){if(t===s.RangeContain.DOES_NOT_CONTAIN){const t=r(74362).default;(0,c.archiveV2Supported)()&&d.default.showArchiveV2||t.setArchive([{id:e.chatId,archive:!1}]),yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){t!==s.RangeContain.DOES_NOT_CONTAIN&&0!==e.remainingMessages||(yield(0,o.removeActiveMessageRange)(e.chatId,e.action))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,n){if(t===s.RangeContain.DOES_NOT_CONTAIN)yield(0,o.removeActiveMessageRange)(e.chatId,e.action);else if(0===e.remainingMessages){const t=r(69951).ChatCollection.get((0,a.createWid)(e.chatId));if(t){const e=r(9609);n?e.markSeen(t):e.markUnseen(t)}yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}},5819:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleInitialSyncMsgs=function(e){const t={add:"last",isHistory:!0},n=Object.keys(e).map((r=>(0,f.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:(0,d.createWid)(r),msgObjs:e[r].msgs,meta:t,chatMsgsCollection:null})));return Promise.all([...n,(0,g.storeInitialSyncMessages)(e)]).then((()=>{const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].msgs.map((e=>e.id.toString())))));return(0,y.checkOrphanMutations)(t,Object.keys(e))})).then((()=>{if((0,p.parseWMIReaction)()){const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].reactionMessages)));return(0,r(53348).storeReactionMsgBulk)(t)}})).then((()=>{})).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleMsgsMD=function(e,t){const r=t.length;if(!r)return Promise.resolve();if(!(e instanceof c.default))return Promise.resolve();const n={add:"before",isHistory:!0};for(let e=0;e<r;e++){t[e].invis=!0}const i=(0,f.getBridge)();return i.fireAndForget("msg_collection","trigger",{name:"handle:msg_history",args:{count:t.length}}),(0,g.storeMessages)(t,e,!0).then((()=>{const r=t.map((e=>e.id.toString()));(0,y.checkOrphanMutations)(r,[e.toString()]),(0,p.receiveReactionsEnabled)()&&(0,T.checkUpdateForOrphanReactions)(r)})).then((()=>i.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:t,meta:n,chatMsgsCollection:null}))).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((t=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${r} Chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleProgressiveHistorySyncMsgs=function(){return M.apply(this,arguments)},t.handleSingleMsgMD=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(13959),s=r(4352),l=r(15461),c=n(r(89867)),d=r(45454),u=r(22683),p=r(57701),f=r(41796),_=r(62415),h=r(91525),g=r(84886),m=r(63728),y=r(12600),E=r(49831),S=r(6684),v=r(90641),T=r(76332),C=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=b(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),A=r(77591);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(b=function(e){return e?r:t})(e)}function P(){return(P=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d={add:"after",update:n,isHistory:!1},b=(0,f.getBridge)(),P=t.type===l.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(t.subtype);let M=t;if(!P){const e=yield(0,E.applyOrphanRevoke)([M]);if(0===e.length)return;M=e[0]}const O=yield(0,h.handleForActiveMessageRange)(e,M);if(O.has(h.ActiveRangeHandlerAction.DropMessage))return;const I=O.has(h.ActiveRangeHandlerAction.SkipUI);try{c.default.isStatusV3(e)&&(yield b.sendAndReceive("status_v3_collection","handleUpdate",{rawMsg:M,checksum:null,isMsgUpdate:!1})),yield(0,s.promiseLoop)(function(){var t=(0,i.default)((function*(t,i,a){const s=(0,o.delayMs)(C.expBackoff(a,12e4,1e3,.1));try{if(n)yield(0,g.updateMessage)(M),__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`placeholder populate successful`;else if(P){if(yield(0,g.processRevokeMsgs)([{revokeMsgKey:M.protocolMessageKey,newMsgKey:M.id,timestamp:M.t,subtype:M.subtype,sender:M.author}]),(0,p.receiveReactionsEnabled)()){const t=r(68819).getJobManager;yield t().waitUntilPersisted(S.jobSerializers.deleteReactions(e.toString(),[M.protocolMessageKey.toString()]))}}else try{yield(0,g.storeMessages)([M],e),M.type===l.MSG_TYPE.CIPHERTEXT&&(0,m.addPlaceHolderAction)(M)}catch(e){if(!(e instanceof g.DuplicateMessageError))throw e;M.type===l.MSG_TYPE.CIPHERTEXT?__LOG__(2)`processPlaceholderMsg: skip creating duplicate placeholder`:(__LOG__(2)`storeMessages loop: detect resend message`,yield(0,g.updateMessage)(M),d.update=!0)}if(M.type===l.MSG_TYPE.GROUPS_V4_INVITE){const e=M.id.toString();yield(0,_.persistGroupInviteV4Msg)(e,{id:e,from:M.from.toString(),to:M.to.toString(),groupId:M.inviteGrp,expiration:parseInt(M.inviteCodeExp,10),expired:u.Clock.globalUnixTime()>=parseInt(M.inviteCodeExp,10)})}__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop`,t()}catch(e){return __LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop: failed with error ${e}.`,a>3?(__LOG__(3)`storeMessages loop: Gave up after ${a} tries`,Promise.reject(e)):s}}));return function(){return t.apply(this,arguments)}}()),__LOG__(2,void 0,void 0,void 0,["messaging"])`handleSingleMsgMD: msgId::${M.id.id}, write message to db done, overwrite: ${n}, skipUI: ${I}`;try{yield(0,y.checkOrphanMutations)([M.id.toString()],[e.toString()]),(0,p.receiveReactionsEnabled)()&&(yield(0,T.checkUpdateForOrphanReactions)([M.id.toString()]))}catch(t){__LOG__(4,void 0,new Error)`handleSingleMsgMD: checkOrphanMutations failed during handleSingleMsgMD for: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}I||(M.recvFresh=!0,M.isNewMsg=!0,yield b.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:[M],meta:d,chatMsgsCollection:null,preserveOrder:a}))}catch(t){if(t instanceof A.LogoutDrop)return;if(t instanceof v.PreviousMsgNotPlaceholderError)return __LOG__(2,void 0,void 0,!0)`Msg: ${String(M.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`,void SEND_LOGS("msg_handler for MD: error storing/processing single message");__LOG__(4,void 0,new Error,!0,["messaging"])`Msg: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing single message")}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n,i){return yield Promise.resolve(),(0,g.storeRecentAndFullHistSyncMessages)(e,t,!0,!0).then((()=>{const r=t.map((e=>e)),n=e.map((e=>e.id.toString()));return(0,y.checkOrphanMutations)(n,r)})).then((()=>{if((0,p.parseWMIReaction)()){return(0,r(53348).storeReactionMsgBulk)(n)}})).then((()=>{const e=(0,f.getBridge)(),t=r(69951).ChatCollection;i.forEach((r=>{if(!r||!r.id||!r.id.remote)return;const n=r.id.remote,i=t.get(n);i&&0===i.msgs.length&&!i.pendingInitialLoading&&e.fireAndForget("msg_collection","processMultipleMessages",{chatId:n,msgObjs:[r],meta:{add:"last",isHistory:!0},chatMsgsCollection:null})}))})).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("handleProgressiveHistorySyncMsgs: error storing/processing multiple messages")}))}))).apply(this,arguments)}},52821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateMsgInfo=function(e,t,r,n){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return function(e,t,r,n){const o=e.id;a.default.isUser(o.remote)?function(e,t,r,n){t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n):function(e,t,r,n){let a=i.ACK.CLOCK;e.played.get(r)?a=i.ACK.PLAYED:e.read.get(r)?a=i.ACK.READ:e.delivery.get(r)&&(a=i.ACK.RECEIVED);if(t<=a)return;if(t>i.ACK.RECEIVED){const t=e.delivery.get(r);t?e.delivery.remove(t):e.deliveryRemaining-=1}if(t>i.ACK.READ){const t=e.read.get(r);t?e.read.remove(t):e.readRemaining-=1}t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n)}((0,s.unproxy)(e),t,r,n);return function(e,t,r,n){const o=e.id;if(!a.default.isUser(o.remote)){if(t!==i.ACK.RECEIVED){const t=e.delivery.get(r);t&&e.delivery.remove(t)}if(t!==i.ACK.READ){const t=e.read.get(r);t&&e.read.remove(t)}if(t!==i.ACK.PLAYED){const t=e.played.get(r);t&&e.played.remove(t)}}t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}((0,s.unproxy)(e),t,r,n)};var i=r(35470),a=n(r(89867)),o=r(7293),s=r(31019)},4280:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelOrDeclinePaymentRequest=function(){return s.apply(this,arguments)},t.fulfillPaymentRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(90641),o=r(12896);function s(){return(s=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((r=>{const n=t.get(r.id);n?n.set((0,o.hydrateMessage)(r),{merge:!0}):r.id===e.id.toString()&&(e.type=r.type,e.templateParams=r.templateParams)}))}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((e=>{const r=t.get(e.id);r&&r.set((0,o.hydrateMessage)(e),{merge:!0})}))}))).apply(this,arguments)}},17780:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._processMultipleMessages=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(15461),o=n(r(89867)),s=n(r(47545)),l=r(71473),c=r(22683),d=n(r(61516)),u=r(99234),p=n(r(46931)),f=r(7293),_=r(57701),h=r(32554),g=r(78986),m=r(58668),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(54676)),E=r(92671),S=r(91692),v=r(64551);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function C(){return(C=(0,i.default)((function*(e,t,n,i){const{filteredRecs:T,reorderRecs:C,updates:b}=(0,p.default)(e,t,n,i);yield Promise.all(b);const P=r(69951).ChatCollection,M=r(50101).findChat,O=r(59871).MsgCollection;if(0===T.length&&0===C.length){if(e&&n.pendingMsgsDone){const t=P.get(e);t&&(t.pendingMsgs=!1)}return t.map((e=>O.get(e.id))).filter((e=>e))}if(!e)return A(T).then((()=>t.map((e=>O.get(e.id))).filter((e=>e&&!!e.chat))));let I;const w=t[0];if(o.default.isStatusV3(e)){const e=w.id.fromMe?(0,u.getMaybeMeUser)():w.author;I=r(59387).StatusV3Collection.find(e)}else I=M(e);const R=yield I,D=yield A(T),N="after"===n.add||"last"===n.add,L=!n.isHistory;let k,G,U=!1;if("unread"===n.add?(k=i,R.msgChunks.push(k),G=n.firstUnreadKey):"last"===n.add&&n.resume?(k=i,U=!0):k="function"==typeof i?i():i,(0,s.default)(t,D,C,R,N,k||R.msgs,G,U),n.pendingMsgsDone&&(R.pendingMsgs=!1),L&&o.default.isBroadcast(e)&&!o.default.isStatusV3(e)&&D.forEach((function(e){e&&e.recvFresh&&!e.isNotification&&y.broadcastFanout(e)})),f.GK.supportsFeature(f.GK.F.RECENT_EMOJI_SYNC))for(let e=0;e<D.length;e++){const t=D[e];if(t.isNewMsg&&t.isSentByMe&&t.containsEmoji){E.RecentEmojiCollection.throttledSync();break}}if(f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&v.ServerProps.webServerStickerPanel){const e=D.map((e=>{if(!(e.isSentByMe&&e.type===a.MSG_TYPE.STICKER))return;const{mediaData:t,mediaObject:r}=e,n=e.id.toString(),i=null==r?void 0:r.entries.entries[0];return[{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:(null==i?void 0:i.encFilehash)||t.encFilehash,mediaKey:(null==i?void 0:i.mediaKey)||t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:c.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:m.OUTWARD_TYPES.STICKER,index:0},e.t,n]})).filter(Boolean);r(49264).RecentStickerCollectionMd.enqueue(e)}if(f.GK.isRecentStickersEnabled()){const e=D.map((e=>{if(!(e.isNewMsg&&e.isSentByMe&&e.type===a.MSG_TYPE.STICKER))return;const{mediaData:t}=e;return{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:t.encFilehash,mediaKey:t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:c.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:m.OUTWARD_TYPES.STICKER,index:0}})).filter(Boolean);S.RecentStickerCollection.enqueue(e)}if((0,_.webMediaAutoDownloadEnabled)()&&!o.default.isStatusV3(e)&&D.map((e=>e.asAutoDownloadableMedia)).filter(Boolean).forEach((e=>{l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MEDIA)})),v.ServerProps.webDownloadDocumentThumbMmsEnabled&&D.map((e=>e.asDoc)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0})})),D.map((e=>e.asUrl)).filter(Boolean).forEach((e=>{(0,h.hqLinkPreviewExpired)(e.t)||((0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0}))})),f.GK.supportsFeature(f.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&o.default.isStatusV3(e)){const e=(0,u.getLastStatusUsage)();(null==e||Date.now()-e<12096e5)&&D.map((e=>e.asImage||e.asVideo)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,g.downloadStatusV3Thumbnail)({msg:e,isPreload:!0})}))}return t.map((e=>O.get(e.id))).filter((e=>e))}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){let t=r(59871).MsgCollection.add(e,{merge:!0});return f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&(t=t.filter(((t,r)=>(null==t&&(__LOG__(4,void 0,new Error,!0)`Get empty message with id ${e[r].id}.`,SEND_LOGS("msgPrepWork-empty-message")),null!=t)))),yield Promise.all(t.map((e=>e.waitForPrep().catch((e=>{__LOG__(4,void 0,new Error,!0)`Assertion failed! ${String(e)}`,SEND_LOGS("bad-msg-prep")}))))),t}))).apply(this,arguments)}},47545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i,a,o,s,l){const c=function(e,t,r,n,i){const a={},o={};let s,l,c,d=r.length,u=i;if(0===d)return{msgs:t,collection:u};for(s=0;s<d;s++)l=r[s],o[l.id]=l;for(d=t.length,s=0;s<d;s++)l=t[s],l&&(a[l.id]=l);const p=[];for(d=e.length,s=0;s<d;s++)if(l=e[s],l&&(c=a[l.id],c&&p.push(c),c=o[l.id],c))if(c.recvFresh)p.push(c),n.removeMsg(c),c.unset("recvFresh");else{const e=n.getAllCMCs().find((function(e){return e.get(c.id)}));i&&e===i||(e?(e.forEach((function(e){p.push(e),delete o[e.id]})),e===n.msgs?(n.replaceMsgsCollection(i),u=n.msgs):(n.notifyMsgCollectionMerge(i,e,i),n.removeMsgsCollection(e))):(__LOG__(3)`models:Msg:reorder trying to merge CMC of orphaned message ${l.id}`,p.push(o[l.id])))}return{msgs:p,collection:u}}(e,t,r,i,o);n.addRecordsToChat(c.msgs,i,a,c.collection,s,l)};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(54676));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},46931:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){const O=[],w=[],R=[],D=r(69951).ChatCollection,N=r(59871).MsgCollection;return t.forEach((function(t){var L;t.id instanceof l.default||(__LOG__(4,void 0,new Error,!0)`_processMultipleMessages: el.id is not a MsgKey`,SEND_LOGS("forgot-to-create-msgkey"),t.id=new l.default({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,P.isString)(e)&&d.default.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<s.ACK.CLOCK&&(t.ack=s.ACK.CLOCK),null!=t.hydratedButtons&&((L=t).buttons=new b.TemplateButtonCollection,L.buttons.add(L.hydratedButtons.map(((e,t)=>{var r,n;const i=`${null!=e.index?e.index:t}`;return e.quickReplyButton?new A.default({id:i,displayText:e.quickReplyButton.displayText,selectionId:e.quickReplyButton.id,subtype:"quick_reply"}):e.callButton?new A.default({id:i,displayText:e.callButton.displayText,phoneNumber:e.callButton.phoneNumber,subtype:"call"}):new A.default({id:i,displayText:null===(r=e.urlButton)||void 0===r?void 0:r.displayText,url:null===(n=e.urlButton)||void 0===n?void 0:n.url,subtype:"url"})})))),null!=t.dynamicReplyButtons&&function(e){e.replyButtons=new p.ButtonCollection,e.replyButtons.add(e.dynamicReplyButtons.map((e=>{let{buttonId:t,buttonText:r}=e;return new u.default({id:t,displayText:null==r?void 0:r.displayText})})))}(t);let k=N.get(t.id);if(t.type===c.MSG_TYPE.PROTOCOL&&"ephemeral_setting"!==t.subtype)switch(t.subtype){case"admin_revoke":if(k=N.get(t.protocolMessageKey),k)if(k.isGroupMsg)if(d.default.equals(k.id.remote,t.id.remote)){__LOG__(2)`getMsgUpdates: admin revoked ${k.id.toString()}`;const e=new y.Msg(t);if((0,_.adminRevokeReceiverEnabled)()){const t=(0,o.default)(k.chat.groupMetadata,"m.chat.groupMetadata"),r=t.participants.get(e.sender);if(!r||!r.isAdmin){if(t.participants.add({id:e.sender,isAdmin:!0},{merge:!0}),!r){const t={action:g.GROUP_ACTIONS.ADD,participants:[e.sender]},r=(0,h.genGroupNotificationMsg)({author:void 0,chatId:k.chat.id,ts:e.t},t);(0,E.handleSingleMsgMD)(r.from,r)}(0,v.markGroupAsDirty)({group:k.chat.id})}}(0,C.revoke)(k,{msgKey:e.id,subtype:e.subtype,sender:e.sender})}else __LOG__(2)`getMsgUpdates: ${k.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke came for the different group than the original message was in`;else __LOG__(2)`getMsgUpdates: ${k.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke was sent to a non-group chat`;break;case"sender_revoke":if(k=N.get(t.protocolMessageKey),k){const n=new y.Msg(t);d.default.equals(k.sender,n.sender)?(__LOG__(2)`getMsgUpdates: sender revoked ${k.id.toString()}`,d.default.isStatusV3(e)&&k.msgChunk&&k.msgChunk.remove(k),(0,C.revoke)(k,{msgKey:n.id,subtype:n.subtype,sender:n.sender}),d.default.isStatusV3(e)&&r(59387).StatusV3Collection.find(k.sender).then((e=>{var t,r;if(f.GK.supportsFeature(f.GK.F.QUERY_STATUS_V_3_THUMBNAIL)&&(null===(t=k)||void 0===t||null===(r=t.msgChunk)||void 0===r?void 0:r.length)!==e.totalCount){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))throw new Error("Webd.statusQueryThumbnail is only supported in non-MD mode");M.default.statusQueryThumbnail(e.id)}}))):__LOG__(3)`getMsgUpdates: sender revoke: sender mismatch: ${n.id.toString()} <> ${k.id.toString()}`}break;case"ephemeral_sync_response":const n=D.get(t.id.remote);n&&(0,m.default)(n,t.ephemeralDuration,t.ephemeralSettingTimestamp);break;default:__LOG__(2)`unknown protocolMessage ${t.id.toString()}`}else if(k&&!k.asRevoked){t.ack<k.ack&&delete t.ack;for(const e in t)t.hasOwnProperty(e)&&void 0===t[e]&&delete t[e];t.id.fromMe&&!k.deprecatedMms3Url&&t.deprecatedMms3Url&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);const e=k.t?(0,a.default)(t,["t","id","from","to"]):t,r=k.applyUpdate(e).then((()=>k));if(R.push(r),d.default.isBroadcast(k.id.remote)){const t=S.getBroadcastFanoutKeys(k);t&&t.forEach((t=>{const r=N.get(t);r&&R.push(r.applyUpdate(e).then((()=>k)))}))}n.isHistory&&(k.recvFresh||i)&&!k.search?(__LOG__(3)`model:Msg:handle:processMM:${k.recvFresh?"dup:":"overlap:"}${String(k.id)}`,w.push(k)):n.isHistory&&k.search?(k.search=!1,__LOG__(3)`model:Msg:handle:processMM load search as history ${String(k.id)}`,O.push({id:k.id})):"search"===n.add&&O.push({id:k.id})}else{"payment_action_request_declined"===t.subtype||"payment_transaction_request_cancelled"===t.subtype?R.push((0,T.cancelOrDeclinePaymentRequest)(t)):t.type===c.MSG_TYPE.PAYMENT&&"send"===t.subtype&&R.push((0,T.fulfillPaymentRequest)(t)),S.typeIsMms(t)&&!t.deprecatedMms3Url&&(t.phoneUploading=t.id.fromMe&&t.ack===s.ACK.CLOCK);const e=D.get(t.id.remote);"search"===n.add&&(t.search=!0),n.update||O.push(t),!n.isHistory&&"search"!==n.add&&e&&R.push(function(){return I.apply(this,arguments)}(t,e)),t.ephemeralOutOfSync&&__LOG__(2)`ephemeralOutOfSync msgId=${t.id.toString()} chatId=${null==e?void 0:e.id.toString()}`}})),{filteredRecs:O,reorderRecs:w,updates:R}};var i=n(r(48926)),a=n(r(57557)),o=n(r(45095)),s=r(35470),l=n(r(65212)),c=r(15461),d=n(r(89867)),u=n(r(15871)),p=r(47688),f=r(7293),_=r(57701),h=r(37654),g=r(36098),m=n(r(26878)),y=r(17304),E=r(5819),S=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=O(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(54676)),v=r(51727),T=r(4280),C=r(81027),A=n(r(11897)),b=r(82988),P=r(31515),M=n(r(56891));function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(O=function(e){return e?r:t})(e)}function I(){return(I=(0,i.default)((function*(e,t){if(!e.isNewMsg||!e.recvFresh)return __LOG__(3,void 0,void 0,!0)`processLiveMessage should not be called with history message id ${e.id.toString()}`,SEND_LOGS("bad-process-live-message-call"),Promise.resolve();if(e.type===c.MSG_TYPE.GP2&&"delete"===e.subtype&&(t.isReadOnly=!0),t.isUser){var r;const a=null!==(r=e.ephemeralDuration)&&void 0!==r?r:0;let o,s=!1;e.type===c.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===e.subtype?o=e.t:e.ephemeralSettingTimestamp&&(o=e.ephemeralSettingTimestamp,s=!0);let l=!1;if(null!=o&&(l=yield(0,m.default)(t,a,o,s)),f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&!S.isNotification(e.type,e.subtype)){var n,i;const r=null!==(n=e.ephemeralDuration)&&void 0!==n?n:0,a=null!==(i=t.getEphemeralSetting())&&void 0!==i?i:0;e.ephemeralOutOfSync=r!==a&&!l}}}))).apply(this,arguments)}},76332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addOrUpdateReactions=function(){return y.apply(this,arguments)},t.addOrUpdateReactionsDB=h,t.addOrUpdateReactionsDBBulk=function(e){return(0,p.createOrUpdateReactions)(e)},t.addOrUpdateReactionsModelCollection=g,t.checkUpdateForOrphanReactions=function(){return P.apply(this,arguments)},t.deleteAllReactionsOfMsg=function(){return E.apply(this,arguments)},t.markReactionsAsRead=function(){return v.apply(this,arguments)},t.markReactionsAsReadByMessageKeys=function(){return T.apply(this,arguments)},t.updateHasReactionFromParent=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=n(r(65212)),o=r(67811),s=r(54958),l=r(88102),c=r(30010),d=r(76214),u=r(75250),p=r(63374),f=r(31464),_=r(35099);function h(e){return(0,p.createOrUpdateReactions)([e])}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{parentMsgKey:n}=e,i=t&&(0,c.shouldNotifyReaction)(e);let d;if(d=i?yield f.ReactionsCollection.find(n):f.ReactionsCollection.get(n),d){f.ReactionsCollection.addOrUpdateReaction(e);const t=d.reactions.length>0;yield(0,u.updateHasReactionInParent)(n,t)}else e.reactionText!==o.REVOKED_REACTION_TEXT&&(yield(0,u.updateHasReactionInParent)(n,!0));i&&l.Cmd.alertNewReactionMsg(e);const p=(0,o.isReactionByMe)(e.senderUserJid),_=a.default.fromString(n),h=_.fromMe;if((0,s.shouldUnarchiveChatOnReaction)(h,p,e.reactionText)){const e=r(69951).ChatCollection.get(_.remote.toString());e&&l.Cmd.archiveChat(e,!1,!1)}}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const[r]=yield h(e);r&&g(r,t)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,p.deleteReactionsByParentMessageKey)(e.toString());f.ReactionsCollection.get(e)&&f.ReactionsCollection.deleteReactionsByParentMessageKey(e)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=[],r=[];e.forEach((e=>{const n=e.parentMsgKey;e.reactionText!==o.REVOKED_REACTION_TEXT?r.push({id:n,hasReaction:!0}):t.push(e.parentMsgKey)}));const n=yield(0,p.getReactionsFromParentMsg)(t);return t.forEach((e=>{const t=n.get(e),i=t&&t.length>0||!1;r.push({id:e,hasReaction:i})})),(0,d.getMessageTable)().bulkCreateOrMerge(r)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){yield(0,_.sendReactionReadReceipts)(e),yield(0,p.markReactionRowsAsRead)(A(e)),f.ReactionsCollection.markReactionsAsRead(b(e))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=yield(0,p.markReactionsAsReadByMessageKeysInStore)(e);t&&f.ReactionsCollection.markReactionsAsRead(C(t))}))).apply(this,arguments)}function C(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:a.default.fromString(t),msgKey:a.default.fromString(r),reactionText:n}}))}function A(e){return e.map((e=>{let{parentMsgKey:t,senderUserJid:r}=e;return{parentMsgKey:t.toString(),senderUserJid:r}}))}function b(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:t,msgKey:r,reactionText:n}}))}function P(){return(P=(0,i.default)((function*(e){try{(yield(0,p.changeOrphanStateReactions)(e)).forEach((e=>{f.ReactionsCollection.get(e.parentMsgKey)&&f.ReactionsCollection.addOrUpdateReaction(e)}))}catch(e){__LOG__(3)`checkUpdateForOrphanReactions: error ${e}`}}))).apply(this,arguments)}},81027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.revoke=R,t.sendRevoke=function(e,t,n){return function(e,t,n){const{id:a,t:l}=e;if(t===u.Revoke.Sender&&!a.fromMe)return Promise.reject(new Error("revoking received message"));let c;_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&a.remote.isGroup()&&(c=(0,f.getMeUser)());const d=new o.default({id:o.default.newId(),remote:e.id.remote,fromMe:!0,participant:c}),g=function(e){switch(e){case u.Revoke.Sender:return"sender_revoke";case u.Revoke.Admin:return"admin_revoke"}}(t),m={id:d,to:a.remote,t:l,type:s.MSG_TYPE.PROTOCOL,subtype:g,protocolMessageKey:a,clearMedia:!!n,local:!0};return new C.NonPersistJob("sendMessage",(0,i.default)((function*(){try{yield(0,E.storeMessages)([m],e.chat.id)}catch(e){throw __LOG__(4,!0,new Error,!0)`_sendRevoke: failed to storeMessages into storage`,SEND_LOGS("storeMessages failed"),e}if((yield(0,P.sendMsgRecord)(new v.Msg(m)))===M.SendMsgResult.OK){const t=Math.trunc(Date.now()/1e3-e.t);return new S.default.SendRevokeMessage({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),revokeSendDelay:t}).commit(),(0,E.processRevokeMsgs)([{revokeMsgKey:e.id,newMsgKey:d,timestamp:e.t,subtype:g,sender:(0,f.getMeUser)()}]).then((0,i.default)((function*(){if((0,h.receiveReactionsEnabled)()){const t=r(68819).getJobManager;yield t().waitUntilPersisted(A.jobSerializers.deleteReactions(e.chat.id.toString(),[e.id.toString()]))}return R(e,{msgKey:d,subtype:g,sender:(0,f.getMeUser)()}),M.SendMsgResult.OK})))}return Promise.resolve(M.SendMsgResult.ERROR_UNKNOWN)})),{priority:p.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}((0,O.unproxy)(e),t,n)};var i=n(r(48926)),a=n(r(4788)),o=n(r(65212)),s=r(15461),l=n(r(89867)),c=r(48285),d=n(r(69048)),u=r(88102),p=r(1973),f=r(99234),_=r(7293),h=r(57701),g=r(11902),m=r(10435),y=w(r(78986)),E=r(84886),S=n(r(11339)),v=r(17304),T=w(r(54676)),C=r(29731),A=r(6684),b=r(4136),P=r(19708),M=r(13705),O=r(31019);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}function w(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function R(e,t){return function(e,t){var n;const i="admin_revoke"===t.subtype;if(i&&!(0,h.adminRevokeReceiverEnabled)())return void __LOG__(2)`revoke: admin revoke feature is disabled, ${e.id.toString()} has not been revoked`;if(i||(0,m.isSenderRevokeWindowReceiverEnabled)()){if(!(Math.trunc(Date.now()/1e3)-e.t<=b.REVOKE_WINDOW_V2+b.REVOKE_WINDOW_V2_RECEIVER_MARGIN))return void __LOG__(2)`revoke: outside of revoke window, ${e.id.toString()} has not been revoked`}r(16770).LabelCollection.removeAllLabelsMD(e),T.typeIsMms(e)&&y.deregisterMsg(e);e.chat&&e.chat.removeFromCollection(e);e.trigger("revoked");const o=e.getCollection(),u=e.id;e.msgChunk&&e.msgChunk.replaceId(u,t.msgKey);o.replaceId(u,t.msgKey);const p=null===(n=e.chat)||void 0===n?void 0:n.isUnreadMsg(e),f={id:t.msgKey,type:s.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",revokeSender:t.sender,body:void 0,caption:void 0,clientUrl:void 0,deprecatedMms3Url:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,doNotPlayInline:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1};e.set(f),e.trigger("change:msgKey",{newKey:t.msgKey,oldKey:u}),e.chat&&(e.chat.updateMediasCountOnMsg(e,!0),u.equals(e.chat.lastReceivedKey)&&(0,g.setLastReceivedKey)(e.chat.id,t.msgKey).then((()=>{e.chat.lastReceivedKey=t.msgKey})),e.chat.composeQuotedMsg===e&&(e.chat.composeQuotedMsg=null),(0,m.isSenderRevokeUiEnabled)()&&p&&(e.chat.unreadCount=Math.max(e.chat.unreadCount-1,0),(0,c.reduceChatUnreadCount)(e.chat.id.toString())));e.isLive&&r(85865).LiveLocationCollection.removeMsg(e);if(l.default.isBroadcast(u.remote)){const n=T.getBroadcastFanoutKeys(u),i=T.getBroadcastFanoutKeys(t.msgKey);if(!n||!i||n.length!==i.length)return void __LOG__(2)`cannot fanout revoke: ${String(n)} ${String(i)}`;if((0,a.default)(n,i).forEach((e=>{const r=o.get(e[0]);r&&R(r,{msgKey:e[1],subtype:t.subtype,sender:t.sender})})),_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&(d.default.purge([String(e.rowId)]),(0,h.receiveReactionsEnabled)())){const t=r(68819).getJobManager,n=e.chat?e.chat.id.toString():e.id.remote.toString();t().fireAndForget(A.jobSerializers.deleteReactions(n.toString(),[u.toString()]))}}}((0,O.unproxy)(e),t)}},4136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=t.REVOKE_WINDOW_V2=t.REVOKE_WINDOW=void 0;t.REVOKE_WINDOW=4096;t.REVOKE_WINDOW_V2=216e3;t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=43200},40256:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(84886),o=r(59387);function s(){return(s=(0,i.default)((function*(e){const t=o.StatusV3Collection.getPSAStatus();if(!t)return;const r=t.msgs.filter((t=>t.campaignId===e));if(0===r.length)return;const n=r.map((e=>e.id.toString()));t.revokeMsgs(n),yield(0,a.removeMessagesFromHistory)(n),__LOG__(2,void 0,void 0,void 0,["revoke-status-psa"])`revokeStatusPSA completed`}))).apply(this,arguments)}},92188:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendKeyDistributionMsg=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(65212)),o=r(45454),s=r(99234),l=n(r(63928));function c(){return(c=(0,i.default)((function*(e){if(!e.isGroup)return Promise.reject(new Error("[messaging] sendKeyDistributionMsg: only group chats are supported`"));const t=e.id,n=(0,s.getMaybeMeUser)(),i=new a.default({from:n,to:t,id:a.default.newId(),participant:(0,o.toUserWid)(n),selfDir:"out"});yield l.default.find(e.id);const{encryptAndSendKeyDistributionMsg:c}=r(95547);return c(i)}))).apply(this,arguments)}},19708:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){return(0,a.promiseCallSync)((()=>{const t=e.id,n=r(50101).findChat;let a;n(t.remote).then((e=>{e.isTrusted()||(0,T.sendNotSpam)(e).catch((()=>{}))})),p.default.isBroadcast(e.to)&&(a=(0,E.broadcastFanout)(e)),e.isNewMsg=!0;const b=e.type===d.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype),P=e.type===d.MSG_TYPE.REACTION&&e.reactionText===u.REVOKED_REACTION_TEXT;if(!e.isGroupMsg&&!b&&!P&&f.BlocklistCollection.get(e.to))return Promise.reject(new _.default("Contact is blocked",h.ContactCollection.assertGet(e.to)));let M;b||P||(M=new y.default.WebcMessageSend({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),messageIsForward:Boolean(e.isForwarded)}));const O=r(59871).MsgCollection,I=r(7293).GK;return n(e.id.remote).then((t=>((0,C.sendSeen)(t),e.type===d.MSG_TYPE.REACTION||b||O.trigger(l.default.NEW_MSG_SENT),(0,o.promiseProps)({reply:(0,S.sendMsgRecord)(e),chat:t})))).then((r=>{var i;let{reply:o,chat:l}=r;const u=t.remote,f=(0,g.getMaybeMeUser)(),_=t.fromMe&&p.default.equals(t.remote,f)?3:o.data?o.data.ack:1;return e.updateAck(_,o.t),M&&(M.markMessageSendT(),M.commit()),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postWrittenWireStage(),[d.MSG_TYPE.PROTOCOL,d.MSG_TYPE.REACTION].includes(e.type)||(0,m.setLastReceivedKey)(l.id,t).then((()=>{l.lastReceivedKey=t})),O.updateLastReceipt(u,o.t),p.default.isBroadcast(u)&&(a?a.forEach((e=>{const r=new c.default({from:f,to:e,id:t.id}),i=O.get(r);i&&(i.ack=s.ACK.SENT,O.updateLastReceipt(e,i.t),null==i.ephemeralStartTimestamp&&i.updateEphemeralStartTimestamp(i.t),n(e).then((e=>{(0,m.setLastReceivedKey)(e.id,r).then((()=>{e.lastReceivedKey=r}))})))})):__LOG__(2)`model:msg:createRecord bclist server ack, no recipients`),v.SendMsgResult.OK})).catch((0,i.filteredCatch)(A.ServerStatusCodeError,(t=>{if(408!==t.status&&(__LOG__(4,void 0,new Error,!0)`Phone responded ${t.status}`,SEND_LOGS("send-not-200")),I.supportsFeature(I.F.MD_BACKEND)){const t=(0,S.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!1,t.messageSendResult=y.default.MESSAGE_SEND_RESULT_TYPE.ERROR_NETWORK,t.commit()}return v.SendMsgResult.ERROR_NETWORK}))).catch((t=>{if(__LOG__(3)`model:msg:createRecord dropped msg: ${e.id.toString()}`,__LOG__(4,void 0,new Error,!0)`Got error ${String(t)}`,SEND_LOGS("send-msg-error"),I.supportsFeature(I.F.MD_BACKEND)){const t=(0,S.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!0,t.messageSendResult=y.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,t.commit()}return v.SendMsgResult.ERROR_UNKNOWN}))})).finally((()=>{e.sendDeferred&&e.sendDeferred.resolve(),e.wamMessageSendPerfReporter=null}))};var i=r(50796),a=r(18412),o=r(67602),s=r(35470),l=n(r(64369)),c=n(r(65212)),d=r(15461),u=r(67811),p=n(r(89867)),f=r(32826),_=n(r(89520)),h=r(19380),g=r(99234),m=r(11902),y=n(r(11339)),E=r(54676),S=r(90298),v=r(13705),T=r(19569),C=r(9609),A=r(77591)},13705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMsgResult=void 0;const n=r(76672).Mirrored(["OK","ERROR_NETWORK","ERROR_EXPIRED","ERROR_CANCELLED","ERROR_UPLOAD","ERROR_UNKNOWN"]);t.SendMsgResult=n},83147:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(90981),s=r(30849),l=r(21224);function c(){return(c=(0,i.default)((function*(e,t){if(!a.default.isUser(e.id.remote))return;const r=e.privacyModeWhenSent;if(null!=r&&r.privacyModeTs>t.privacyModeTs)return;const n=(0,s.getReducedPrivacyMode)(t);if(n===(0,s.getReducedPrivacyMode)(r))return;if(null!=e.bizPrivacyStatus)return void __LOG__(3)`msg.bizPrivacyStatus exist already, we can not assign a new value anymore`;const i=d(n);e.bizPrivacyStatus=i,yield(0,o.getTable)().merge(e.id.toString(),{bizPrivacyStatus:i})}))).apply(this,arguments)}function d(e){switch(e){case s.ReducedPrivacyMode.E2EE:return l.WebMessageInfoBizPrivacyStatus.E2EE;case s.ReducedPrivacyMode.BSP:return l.WebMessageInfoBizPrivacyStatus.BSP;case s.ReducedPrivacyMode.FB:return l.WebMessageInfoBizPrivacyStatus.FB}}},14810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncPrivacyDisallowedLists=s,t.syncSinglePrivacyDisallowedList=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(61319),o=r(25338);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){return{type:e,response:yield(0,o.queryPrivacyDisallowedList)(e)}}));return function(){return e.apply(this,arguments)}}())),r=[];return t.forEach((e=>{const{status:t,users:n,dhash:i}=e.response;"mismatch"===t&&null!=n&&null!=i&&r.push({id:e.type,disallowedList:n.map((e=>e.toString())),dhash:i})})),yield(0,a.getTable)().bulkCreateOrReplace(r),r}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){yield s([e])}))).apply(this,arguments)}},3764:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProfilePic=function(e){return g((0,u.unproxy)(e))},t.setProfilePic=function(e,t,r){return h((0,u.unproxy)(e),t,r)};var i=r(50796),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(99234),c=n(r(43725)),d=r(5018),u=r(31019),p=r(77591),f=r(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function h(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.genId)();const{id:u}=e;if(!e.canSet())return Promise.reject(new s.ActionError);const _=(0,d.sendSetPicture)(u,t,r);e.pendingPic=t;const g=(0,l.getMaybeMeUser)(),m=u.equals(g)?new a.ActionType(c.default.t(117)):new a.ActionType(c.default.t(63)),y=_.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:setPicture dropped`,u.equals(g)?new a.ActionType(c.default.t(116)):new a.ActionType(c.default.t(62))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(i=>{if(i.status>=400){const i=u.equals(g)?c.default.t(116):c.default.t(62);return new a.ActionType(i,{actionText:c.default.t(129),actionHandler:()=>h(e,t,r,n)})}}))).then((()=>u.equals(g)?new a.ActionType(c.default.t(115)):new a.ActionType(c.default.t(61))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:n,initialAction:m,pendingAction:y})),_.then((t=>{t._duplicate||e.set({tag:t.tag,eurl:t.eurl,token:t.token})})).finally((()=>{e.pendingPic=void 0}))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.genId)();const{id:r}=e;if(!e.canDelete())return Promise.reject(new s.ActionError);const n=(0,d.requestDeletePicture)(r);e.pendingPic=e.fallbackType;const u=(0,l.getMaybeMeUser)(),_=r.equals(u)?new a.ActionType(c.default.t(114)):new a.ActionType(c.default.t(60)),h=n.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:deletePicture dropped`,r.equals(u)?new a.ActionType(c.default.t(112)):new a.ActionType(c.default.t(58))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(n=>{if(n.status>=400){const n=r.equals(u)?c.default.t(112):c.default.t(58);return new a.ActionType(n,{actionText:c.default.t(129),actionHandler:()=>g(e,t)})}}))).then((()=>r.equals(u)?new a.ActionType(c.default.t(113)):new a.ActionType(c.default.t(59))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:t,initialAction:_,pendingAction:h})),n.then((t=>{t._duplicate||e.set({tag:void 0,eurl:void 0})})).finally((()=>{e.pendingPic=void 0}))}},47569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){return s||(s=(0,i.queryServerProps)().then((e=>{a.ServerProps.updateProps(e),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps Start ---`,Object.keys(a.ServerProps.attributes).forEach((e=>{__LOG__(2,void 0,void 0,void 0,["serverprops"])`key: ${e}, value: ${a.ServerProps.attributes[e]}, type: ${typeof a.ServerProps.attributes[e]}`})),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps End ---`})).catch((0,n.filteredCatch)(o.ServerStatusCodeError,(()=>{}))).catch((0,n.filteredCatch)(o.WebdDrop,(()=>{}))).finally((()=>{s=null})),s)};var n=r(50796),i=r(8369),a=r(64551),o=r(77591);let s},92052:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setArchiveClassicSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error)`Settings:setArchiveClassicSetting is not supported on MD Companion device.`,Promise.resolve();return m(e)},t.setArchiveEnabledSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return void __LOG__(4,void 0,new Error)`Settings:setArchiveEnabledSetting is not supported on MD Companion device.`;__LOG__(2)`Settings:setArchiveEnabledSetting value to ${e}`,f.default.archive.enabled!==e&&(f.default.archive=(0,a.default)((0,a.default)({},f.default.archive),{},{enabled:e}))};var i=n(r(48926)),a=n(r(81109)),o=r(50796),s=r(48360),l=r(46331),c=r(88102),d=r(7293),u=n(r(43725)),p=n(r(11339)),f=n(r(68132)),_=n(r(56891)),h=r(77591),g=r(85893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.genId)();__LOG__(2)`Settings:setArchiveClassicSetting value to ${e}`;const r=_.default.setArchiveSetting(e).then((e=>{if(e.status&&200!==e.status)throw new h.ServerStatusCodeError(e.status)})),n=new l.ActionType(s.fbt._("Changing archive setting",null,{hk:"4s5LmI"})),i=Boolean(f.default.archive.classic),d=r.then((()=>{__LOG__(2)`Settings:setArchiveClassicSetting:success value sucessfully set to ${e}`;const r=e?s.fbt._("Archived chats will unarchive when you receive a new message.",null,{hk:"2VniT0"}):s.fbt._("Archived chats will remain archived when you receive a new message.",null,{hk:"4C3WnP"});return new l.ActionType(r,{actionText:u.default.t(133),actionHandler:()=>m(i,t)})})).catch((0,o.filteredCatch)(h.ServerStatusCodeError,(e=>{if(__LOG__(3)`models:settings:setArchiveClassicSetting failed with server error`,e.status>=400)return new l.ActionType(s.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}))}))).catch((()=>{throw __LOG__(3)`models:settings:setArchiveClassicSetting dropped`,new l.ActionType(s.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}),{actionText:u.default.t(129),actionHandler:()=>m(e,t)})}));c.Cmd.openToast((0,g.jsx)(l.ActionToast,{id:t,initialAction:n,pendingAction:d})),yield r,f.default.archive.classic!==e&&(new p.default.ArchiveSettings({keepChatsArchived:e}).commit(),f.default.archive=(0,a.default)((0,a.default)({},f.default.archive),{},{classic:e}))}))).apply(this,arguments)}},82350:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(){return _.apply(this,arguments)},t.setMyStatus=h;var i=n(r(48926)),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(99234),c=n(r(43725)),d=r(51316),u=r(31515),p=r(85893);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function _(){return(_=(0,i.default)((function*(e){const t=yield(0,d.getStatus)(e),n={id:e};if((0,u.isNumber)(t.status))switch(t.status){case 429:case 401:case 403:case 404:case 304:n.stale=!0;const t=r(46133).StatusCollection.get(e);t&&!(0,u.isString)(t.status)&&(n.status="");break;default:n.status=""}else{let i=t.status;if(t.stale){const t=r(46133).StatusCollection.get(e);t&&(i=t.status)}n.status=i}return n}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.genId)(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.trim();if(!i)return Promise.reject(new s.ActionError);const u=(0,d.setMyStatus)(i),f=new a.ActionType(c.default.t(128)),_=(0,l.getMaybeMeUser)(),g=r(46133).StatusCollection,m=g.assertGet(_).status,y=u.then((e=>{if(200===e.status){const e=n?void 0:{actionText:c.default.t(133),actionHandler:()=>h(m,t,!0)};return new a.ActionType(c.default.t(126),e)}if(e.status>=400)return new a.ActionType(c.default.t(127))})).catch((()=>{throw __LOG__(3)`models:statusCollection:setMyStatus dropped`,new a.ActionType(c.default.t(127),{actionText:c.default.t(129),actionHandler:()=>h(e,t)})}));o.Cmd.openToast((0,p.jsx)(a.ActionToast,{id:t,initialAction:f,pendingAction:y}));const E=yield u;200!==E.status||E._duplicate||(g.assertGet(_).status=e)}))).apply(this,arguments)}},77905:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickers=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),o=n(r(18561)),s=n(r(43725)),l=n(r(11339)),c=r(2541),d=n(r(23082));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}const p="https://static.whatsapp.net/sticker";function f(){return(f=(0,i.default)((function*(e,t){const r={cat:"sticker_pack_data",id:e,lg:s.default.getLocale()},n=c.URL.build(p,r),i=yield(0,o.default)(n,{signal:null==t?void 0:t.signal}),u=new l.default.StickerCommonQueryToStaticServer;if(u.set({httpResponseCode:i.status,params:new d.default(r).toString(),queryType:l.default.QUERY_TYPE.STICKER_PACK_DATA}),u.commit(),!i.ok)throw new a.InvalidServerResponseError(n,i.status.toString(),"Invalid response from WhatsApp stickers endpoint");const f=yield i.json();if(null==f||0===f.length)throw new a.InvalidServerResponseError(n,i.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(f)}`);return f[0].stickers.map(((e,t)=>({mimetype:e.mimetype,width:e.width,height:e.height,index:t,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],deprecatedMms3Url:e.url,encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0})))}))).apply(this,arguments)}},76046:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleIncomingCallOffer=function(e,t){if(o.CallCollection.processIncomingCall(e.call_id,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:e.isVideoCall?u.default.isVideoCallEnabled():u.default.isVoiceCallEnabled(),offerTime:e.t}),!function(e){return e?u.default.isVideoCallEnabled():u.default.isVoiceCallEnabled()}(e.isVideoCall))return void d.Voip.handleIncomingSignalingMessage(e,t);const r=e.call_id;o.CallCollection.pendingOffers[r]=new a.Resolvable,o.CallCollection.pendingOffers[r].resolve(Promise.all([(0,c.default)(e,t),d.Voip.getNumParticipantsFromCallOffer(t)]).then((n=>{let[{result:i,retryCount:a},l]=n,c=!0;switch(l>0&&(__LOG__(4,void 0,new Error)`voip:incoming: Ignoring call offer since group calling is disabled`,c=!1),c=e.isVideoCall?c&&u.default.isVideoCallEnabled():c&&u.default.isVoiceCallEnabled(),i){case s.E2EProcessResult.SUCCESS:!function(e,t,r){const n=e.call_id;o.CallCollection.processIncomingCall(n,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:null!=r&&r,offerTime:e.t}),!1===r&&o.CallCollection.cleanupPendingOffer(n);d.Voip.handleIncomingSignalingMessage(e,t)}(e,t,c);break;case s.E2EProcessResult.RETRY:__LOG__(2)`voip:handleIncomingCallOffer reject call because of enc retry`,function(){f.apply(this,arguments)}(e,a);break;case s.E2EProcessResult.PARSE_ERROR:__LOG__(2)`voip:handleIncomingCallOffer ending call because of enc parse error`,d.Voip.endCall(r);break;default:throw new Error("invalid e2e result type")}})).finally((()=>{delete o.CallCollection.pendingOffers[r]})))},t.handleIncomingEncRekey=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)},t.handleIncomingSignalingMsg=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)};var i=n(r(48926)),a=r(88156),o=r(31218),s=r(49714),l=r(11849),c=n(r(84590)),d=r(84356),u=n(r(69594)),p=r(45473);function f(){return(f=(0,i.default)((function*(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=yield l.waSignalStore.getRegistrationInfo();if(!i)throw Error("No registration info found");const{registrationId:a}=i,o=n+1;d.Voip.rejectCallWithoutCallCtx(e.call_id,null===(t=e.peer_jid)||void 0===t?void 0:t.toString({legacy:!0}),null===(r=e.call_creator)||void 0===r?void 0:r.toString({legacy:!0}),p.ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,o,a),5===o&&(__LOG__(2)`voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats`,d.Voip.processMissedIncomingCallMaxRetry(e))}))).apply(this,arguments)}},42285:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s,l){if(__LOG__(2)`voip:handleIncomingCallOfferNotice: callId ${t}`,a.Clock.globalUnixTime()-r>45)return void __LOG__(2)`voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice`;i.CallCollection.add({id:t,isVideo:s,isGroup:l,offerTime:r,canHandleLocally:!1,peerJid:e},{merge:!0}),o.Cmd.alertCall((0,n.toUserWid)(e),t,s,l,!1),setTimeout((()=>{o.Cmd.cancelCall(e);const r=i.CallCollection.get(t);r&&i.CallCollection.remove(r)}),45e3)};var n=r(45454),i=r(31218),a=r(22683),o=r(88102)},56981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceipt=function(e){return(0,n.prepareRetryReceiptBridge)(e)},t.queryCall=function(e,t){return(0,n.sendQueryCallBridge)(e,t)},t.sendCallEnd=function(e,t){return(0,n.sendCallEndBridge)(e,t)},t.sendCallOffer=function(e){return(0,n.sendCallOfferBridge)(e)},t.sendCallSignalingMsg=function(e,t){return(0,n.sendCallSignalingMsgBridge)(e,t)},t.sendEncRekey=function(e){return(0,n.sendEncRekeyBridge)(e)};var n=r(92486)},55062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getCommsConfig=function(e){const t=e||{passive:!1};return{openChatSocket:e=>(0,o.default)(t).then((r=>(e(),t.passive=!1,r))),healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:9e5,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:()=>{(0,a.isRegistered)()&&(i.Cmd.setSocketState(l.SOCKET_STATE.CONNECTED),i.Cmd.openSocketStream())},onDisconnect:()=>{i.Cmd.socketStreamDisconnected()},onSocketOpen:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.PAIRING)},onSocketLoopIteration:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.OPENING)},onConnectionChange:()=>{},onOptimisticConnectionChange:()=>{},onCastStanza:()=>{},onHandleAck:e=>{(0,s.default)(e)},onHandleStanza:()=>{},onSendIq:()=>{}}}};var i=r(88102),a=(r(41796),r(58052)),o=n(r(85726)),s=n(r(23368)),l=r(62583);r(85893)},18438:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return F.apply(this,arguments)};var i=n(r(48926)),a=r(44396),o=r(31914),s=r(45823),l=r(40126),c=r(96429),d=n(r(83558)),u=n(r(69277)),p=r(27514),f=n(r(81367)),_=n(r(58626)),h=n(r(64054)),g=r(92419),m=r(46462),y=n(r(86741)),E=n(r(70605)),S=n(r(70569)),v=n(r(17234)),T=n(r(50404)),C=n(r(58645)),A=n(r(27258)),b=n(r(65347)),P=n(r(46007)),M=n(r(6571)),O=n(r(2276)),I=n(r(54341)),w=r(79711),R=r(56545),D=r(25773),N=n(r(87183)),L=n(r(95681)),k=r(89370),G=r(28237);function U(e,t,r){const{attrs:n}=e;if(n.offline){const e=parseInt(n.t,10);G.OfflineMessageHandler.newOfflineStanza(e,r)}switch(e.tag){case"iq":return function(e){const{attrs:t,content:r}=e;if("urn:xmpp:ping"===t.xmlns)return(0,o.wap)("iq",{type:"result",to:t.from});if("md"!==t.xmlns)throw new Error(`handleIq unrecognized ${e.toString()}`);if(!Array.isArray(r)||!r.length)return;switch(r[0].tag){case"pair-device":return(0,T.default)(e);case"pair-success":return(0,C.default)(e)}}(e);case"receipt":return"retry"===n.type?(0,w.handleMessageRetryRequest)(e):"enc_rekey_retry"===n.type?(0,k.handleEncRekeyRetryRequest)(e):(0,v.default)(e);case"notification":switch(n.type){case"server_sync":return(0,D.handleServerSyncNotification)(e);case"w:gp2":return(0,g.handleGroupNotification)(e);case"picture":return(0,O.default)(e);case"business":return(0,c.handleBusinessNotification)(e);case"contacts":return(0,u.default)(e);case"devices":return(0,p.handleDevicesNotification)(e);case"disappearing_mode":return(0,_.default)(e);case"mediaretry":return(0,E.default)(e);case"encrypt":{const r=e.content;if(!Array.isArray(r)||!r.length)break;switch(r[0].tag){case"count":return(0,b.default)(e,t);case"identity":return(0,m.handleE2eIdentityChange)(e);case"digest":return(0,f.default)(e)}break}case"server":return(0,R.handleServerNotification)(e);case"status":return(0,s.handleAboutNotification)(e);case"account_sync":return(0,l.handleAccountSyncNotification)(e);case"pay":return(0,A.default)(e);case"psa":return(0,I.default)(e);case"privacy_token":return(0,M.default)(e)}if(__LOG__(3)`Comms.handleStanza unrecognized notification stanza ${e.toString()}`,n.hasOwnProperty("id"))return(0,o.wap)("ack",{id:n.id,class:"notification",from:n.to||o.DROP_ATTR,to:n.from||o.DROP_ATTR,type:n.type||o.DROP_ATTR,participant:n.participant||o.DROP_ATTR});break;case"chatstate":return(0,d.default)(e);case"presence":return(0,P.default)(e);case"message":return(0,S.default)(e);case"ib":return(0,y.default)(e);case"stream:error":return(0,N.default)(e);case"failure":return(0,h.default)(e);case"success":return(0,L.default)(e);case"call":return(0,k.handleCall)(e);case"error":return(0,a.handleError)(e)}__LOG__(3)`Comms.handleStanza unrecognized stanza ${e.toString()}`}function F(){return(F=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield Promise.resolve(U(e,t,r));return null==n?"NO_ACK":n}))).apply(this,arguments)}},24747:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){b&&b.deadSocketTimer.cancel()},t.castStanza=function(e){const t=N("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=N("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.onStreamErrorReceived=function(){N("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=P,t.resetStateForTests=function(){b=null,T=new p.Resolvable,C=1},t.sendIq=function(e,t){return w(e,t,!1)},t.sendIqErrorParser=function(e,t,r){return w(e,t,!1,r)},t.sendIqIfConnectedWithin=function(e,t,r){const n=N("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);return new Promise(((t,a)=>{const o=setTimeout((()=>{const e=n.pendingIqs.get(i);if(!e)throw new Error(`Unexisting stanza to be cancelled ${i}`);n.removeHandler(e),a(new y.Offline)}),1e3*r),s={type:"iq",resolve:t,stanza:e,attachedToSocketId:0,orderedId:C++,timeoutId:o};n.pendingIqs.set(i,s),n.socket?n.sendPendingIq(s):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`})).then((e=>(0,d.parseIqResponse)(e,t)))},t.sendIqWithoutRetry=function(e,t){return w(e,t,!0)},t.sendPing=function(){return D.apply(this,arguments)},t.sendSmaxIq=function(e,t){return w(e,t,!1)},t.sendStanzaAndReturnAck=I,t.sendStanzaAndWaitForAck=function(){return O.apply(this,arguments)},t.singletonOrThrowIfUninitialized=N,t.socketLoopIteration=M,t.startComms=function(e,t,r,n,i,a){if(b)return;b=new A(e,t,r,n,i,a),setTimeout(P,0)},t.startHandlingRequests=function(){return N("startHandlingRequests").startHandlingRequests()},t.stopComms=function(e){e&&m.Cmd.onStartingLogout();const t=N("stopComms");t.socketLoop.endWithValue(),t.socket&&t.socket.close();b=null},t.waitForConnection=function(){N("waitForConnection").sendPing(),T||(T=new p.Resolvable);return T.promise};var i=n(r(81109)),a=n(r(48926)),o=r(48338),s=r(47151),l=r(50796),c=r(20221),d=r(37329),u=r(72287),p=r(88156),f=r(57319),_=r(31914),h=r(72441),g=r(79196),m=r(88102),y=r(64103),E=(r(41796),r(58052)),S=n(r(23368)),v=r(62583);r(85893);let T=null,C=1;class A{constructor(e,t,r,n,i,a){this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new p.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.parseAndHandleStanza=(e,t)=>{e===this.socketId&&(this.deadSocketTimer.cancel(),T&&(T.resolve(),T=null));const r=(0,_.decodeStanza)(t,this.gzipInflate).then((r=>{if(!r)return void __LOG__(3)`Failure parsing stanza!`;const n=this.activePing;return n&&n.socketId===e&&n.stanzaId===L(r)?(this.activePing=null,n.handler.resolve(r),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(r,e,t.byteLength)})).then((t=>{if(e===this.socketId)if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:t&&this.castStanza(t)}));this._pending.add(r),r.finally((()=>{this._pending.delete(r)}))},this.handleStanza=(e,t,r)=>{const n=L(e);if(null!=n){const t=this.pendingIqs.get(n);t?(this.pendingIqs.delete(n),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${n}`}else{if("ack"!==e.tag)return"failure"===e.tag?this._handleStanza(e,t,r):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,r)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new f.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new f.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.config=r,this.onConnectionChange=(0,c.notifyConnectionChangeFactory)(i,a),this.gzipInflate=n,this.socketLoop=new u.PromiseRetryLoop({name:"MainSocketLoop",code:M,timer:{jitter:.1,max:r.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{t.sendFrame((0,_.encodeStanza)(e))}catch(e){__LOG__(3)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){var e=this;return(0,a.default)((function*(){__LOG__(2)`Comms.startHandlingRequests`,e._recvBlocker.resolve(),yield e._recvBlocker.promise}))()}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){const i=t[r];(0,s.removeIndexWithoutPreservingOrder)(t,r),(0,S.default)(e),i.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,s.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new y.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}let b=null;function P(){N("openSocketLoop").socketLoop.start()}function M(){const e=N("socketLoopIteration"),t=e.nextSocketId++;__LOG__(2)`Comms: Socket ${t} opening}`;const r=()=>{e.onConnectionChange("in_handshake")};return m.Cmd.setSocketState(v.SOCKET_STATE.OPENING),e.config.openChatSocket(r).then((n=>{Promise.resolve().then(r),m.Cmd.setSocketState(v.SOCKET_STATE.PAIRING);const i=new p.Resolvable;return __LOG__(2)`Comms: Socket ${t} opened`,e.socketId=t,e.socket=n,e.softCloseSocket=()=>{e.softCloseSocket=null,e.socket&&(e.socket.close(),e.socket=null),i.resolve()},e.socketLoop.resetTimeoutAfter(1e4),e.deadSocketTimer.cancel(),e.maybeScheduleHealthCheck(),n.setOnFrame((r=>e.parseAndHandleStanza(t,r))),n.setOnClose((()=>{__LOG__(2)`Comms: Socket ${t} closed`,e.activePing&&t===e.activePing.socketId&&(e.activePing.handler.resolve(),e.activePing=null),e.filterPending((e=>e.attachedToSocketId===t)).forEach((t=>{e.removeHandler(t)})),t===e.socketId&&(e.socketId=0,e.socket=null,e.onConnectionChange("disconnected"),m.Cmd.socketStreamDisconnected(),i.resolve())})),e.onConnectionChange("connected"),(0,E.isRegistered)()&&(m.Cmd.setSocketState(v.SOCKET_STATE.CONNECTED),m.Cmd.openSocketStream()),e.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((t=>{"iq"===t.type?e.sendPendingIq(t):e.callStanza(t.stanza)})),i.promise})).catch((0,l.filteredCatch)(y.Disconnected,(()=>{__LOG__(2)`socketLoopIteration socket closed while in noise handshake`}))).catch((e=>{__LOG__(3)`socketLoopIteration failed ${e}`}))}function O(){return(O=(0,a.default)((function*(e,t){yield I(e,t)}))).apply(this,arguments)}function I(e,t){return new Promise((r=>{const n=N("sendStanzaAndWaitForAck");n.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=o.AckParser.parse(e),n=(0,h.extractJidFromJidWithType)((0,g.widToJidWithType)(t.from)),a=null==t.participant?null:(0,g.widToDeviceJid)(t.participant);return!r.error&&(0,o.ackMatchesTemplate)(r.success,(0,i.default)((0,i.default)({},t),{},{from:n,participant:a}))?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:C++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,r,n){const i=yield new Promise((t=>{const n=N("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const a=n.socketId;if(r&&!a)return void t(Promise.reject(new y.Offline));const o={type:"iq",resolve:t,stanza:e,attachedToSocketId:r?a:0,orderedId:C++};n.pendingIqs.set(i,o),n.socket?n.sendPendingIq(o):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}));return(0,d.parseIqResponse)(i,t,n)}))).apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t){const r=N("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new p.Resolvable;r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e);const a=yield i.promise;return a&&(0,d.parseIqResponse)(a,t)}))).apply(this,arguments)}function N(e){if(b)return b;throw new Error(`Comms::${e} called before startComms`)}function L(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,_.decodeAsString)(e.attrs.id)||null}return null}},23368:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{id:t,from:r,t:n}=e.attrs;"message"===e.attrs.class&&function(e,t,r){const n=new i.default({fromMe:!0,remote:t,id:e}),a=String(n);(0,s.getTable)().get(a).then((e=>l.MessagePropertyType.cast(null==e?void 0:e.messageRangeIndex.split("_")[1]))).then((e=>(0,s.getTable)().merge(a,{messageRangeIndex:(0,l.craftMessageRangeIndex)(t.toString(),!1,e===l.MessagePropertyType.SystemMessage,r)}))).catch((e=>{throw __LOG__(4,!0,new Error,!0)`processAckForOutgoingMessage: failed to update in storage`,SEND_LOGS("message processAckForOutgoingMessage failed"),e})),(0,o.checkAndRemoveActiveMessageRanges)(n,r)}(String(t),(0,a.createWid)(String(r)),parseInt(n,10))};var i=n(r(65212)),a=r(45454),o=r(87845),s=r(90981),l=r(12896)},29100:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockSendPing=function(){return d.apply(this,arguments)},t.sendPing=function(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null));(0,l.sendPing)(e,c).then((e=>{(null==e?void 0:e.success)&&u(e.result)}))};var i=n(r(48926)),a=r(92844),o=r(31914),s=r(71914),l=r(24747);const c=new s.WapParser("ping",(e=>e.attrTime("t")));function d(){return(d=(0,i.default)((function*(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null)),t=yield(0,l.sendPing)(e,c);(null==t?void 0:t.success)&&u(t.result)}))).apply(this,arguments)}function u(e){const t=Math.round(Date.now()/1e3-e);(0,a.setClockSkew)(t)}},39410:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_JID=function(e){if(!(e instanceof s.default&&(e.isUser()||e.isGroup()||e.isBroadcast())))throw Error(`CHAT_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,"c.us"===e.server?i.WA_USER_JID_SUFFIX:e.server)},t.DEVICE_JID=function(e){if(!(e instanceof s.default&&e.isUser()))throw Error(`DEVICE_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.createAD(e.user,e.agent,e.device)},t.GROUP_CALL_JID=function(e){if(!(e instanceof s.default&&e.isGroupCall()))throw Error(`GROUP_CALL_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,e.server)},t.GROUP_JID=function(e){if(!(e instanceof s.default&&e.isGroup()))throw Error(`GROUP_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,e.server)},t.JID=function(e){if(!(e instanceof s.default))throw Error(`JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);if(null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent)return o.WapJid.createAD(e.user,e.agent,e.device);return o.WapJid.create(e.user,e.server)},t.USER_JID=function(e){if(!(e instanceof s.default&&e.isUser()))throw Error(`USER_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,i.WA_USER_JID_SUFFIX)},t.wapNodeToVoipXml=t.voipXmlToWapNode=void 0;var i=r(52230),a=r(31914),o=r(45506),s=n(r(89867));t.voipXmlToWapNode=e=>{if(!e||!Array.isArray(e)||3!==e.length)throw Error("Invalid VOIP xml node");return function e(t){if(!t)return null;if(Array.isArray(t)){const r=t[0],n=t[1];let i;n&&Object.keys(n).map((e=>{i||(i={});let t=n[e];if(!t)throw Error("Attribute value is null");if("object"==typeof t){if(t.type!==o.WAP_JID_SUBTYPE.JID&&!o.WAP_JID_SUBTYPE.JID_AD)throw Error("Invalid attribute value type");t=new o.WapJid(t)}i[e]=t}));const s=t[2];let l=null;Array.isArray(s)&&s.length>0&&(l="number"==typeof s[0]?new Uint8Array(s):s.map(e).filter((e=>e)));const c=l;return new a.WapNode(r,i,c)}return t}(e)};t.wapNodeToVoipXml=e=>function e(t){const r=[];return r.push(t.tag),r.push(t.attrs||{}),Array.isArray(t.content)&&0===t.content.filter((e=>!Array.isArray(e)))?r.push(t.content):Array.isArray(t.content)?r.push(t.content.map((t=>e(t)))):null!=t.content?t.content instanceof Uint8Array?r.push(Array.from(t.content)):r.push(t.content):r.push(null),r}(e)},98969:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_IV_SIZE=void 0,t.decryptMediaRetryNotification=function(){return d.apply(this,arguments)},t.encryptServerErrorReceipt=function(e,t,r){return function(){return u.apply(this,arguments)}(e,t,function(e){__LOG__(2)`encodeServerErrorReceipt`;const t=new a.Binary;return(0,l.encodeProtobuf)(c.ServerErrorReceiptSpec,e,t),t.readByteArray()}({stanzaId:t}),r)};var i=n(r(48926)),a=r(8584),o=r(81576),s=r(84902),l=r(60980),c=r(16258);function d(){return(d=(0,i.default)((function*(e,t,r,n){const i=yield p(e,t,r,n);return(0,s.decodeProtobuf)(c.MediaRetryNotificationSpec,i)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,r,n){const i=(null==n?void 0:n.slice())||m(),{key:a,params:o}=yield h(e,t,i);return{ciphertext:yield self.crypto.subtle.encrypt(o,a,r),iv:i}}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r,n){const{key:i,params:a}=yield h(e,t,r);return self.crypto.subtle.decrypt(a,i,n)}))).apply(this,arguments)}const _="WhatsApp Media Retry Notification";function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,r){const n=yield(0,o.extractAndExpand)(e,_,32),i=new a.Binary;i.write(t);const s=i.readByteArray();return{key:yield self.crypto.subtle.importKey("raw",new Uint8Array(n),"AES-GCM",!1,["encrypt","decrypt"]),params:{name:"AES-GCM",iv:r,additionalData:s}}}))).apply(this,arguments)}function m(){const e=new Uint8Array(12);return self.crypto.getRandomValues(e),e}t.ENC_IV_SIZE=12},16104:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFanOutList=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(9108),s=r(99234);function l(){return(l=(0,i.default)((function*(e){let{wids:t}=e;const r=yield(0,o.getDeviceIds)(t.map((e=>e.user))),n=[],i=(0,s.assertGetMe)();return r.forEach(((e,r)=>{if(e){const{devices:t,id:r}=e;t.forEach((e=>{const t=(0,a.createDeviceWidFromUserAndDevice)(r,e);t.equals(i)||n.push(t)}))}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`getFanOutList: no device is found, just send to the primary device`;const e=(0,a.toUserWid)(t[r]);e.equals(i)||n.push(e)}})),n}))).apply(this,arguments)}},86791:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateGroupMetadataTable=function(){return s.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(99069);function s(){return(s=(0,a.default)((function*(e){let{groupInfos:t}=e,r=[];yield(0,o.getStorage)().lock(["group-metadata"],function(){var e=(0,a.default)((function*(e){let[n]=e;const a=yield n.bulkGet(t.map((e=>e.id.toString())));return r=t.map(((e,t)=>{var r,n,o,s,l;const c=a[t];let d={subject:e.subject,subjectTime:e.subjectTime||0},u={announce:e.announce,a_v_id:e.a_v_id||0},p={desc:e.desc,descId:e.descId,descOwner:null===(r=e.descOwner)||void 0===r?void 0:r.toString(),descTime:e.descTime||0},f=[];if(c){const e=c.subjectTime||0,t=c.a_v_id||0,r=c.descTime||0;e>d.subjectTime&&(d={subject:c.subject,subjectTime:e}),t>u.a_v_id&&(u={announce:c.announce,a_v_id:t}),r>p.descTime&&(p={desc:c.desc,descId:c.descId,descOwner:c.descOwner,descTime:r}),f=c.unjoinedSubgroups}return(0,i.default)((0,i.default)((0,i.default)({id:e.id.toString(),creation:e.creation,owner:null===(n=e.owner)||void 0===n?void 0:n.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:null!==(o=e.support)&&void 0!==o&&o,suspended:null!==(s=e.suspended)&&void 0!==s&&s,parentGroup:null===(l=e.parentGroup)||void 0===l?void 0:l.toString(),isParentGroup:e.parent,defaultSubgroup:e.defaultSubgroup,unjoinedSubgroups:f},d),p),u)})),n.bulkCreateOrMerge(r)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}},51727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirty=function(e){let{group:t}=e;return(0,f.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.merge(String(t),{deviceSyncComplete:!1})}))},t.modifyGroupParticipant=function(e){let{group:t,oldId:r,newId:n,prevVersion:s,newVersion:l}=e;const c=String(t);return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const a=yield t.get(c);if(!a)throw new u.GroupUnSyncedError(`modifyGroupParticipant: group participant info missing for group ${c}`);if(a.version&&(null==s||s!==a.version))throw new u.GroupUnSyncedError(`modifyGroupParticipant: prev version info missing for group ${c}`);return t.createOrReplace(function(e,t,r,n){const a=String(t),s=String(r),l=new Map(e.senderKey),c=e.participants.filter((e=>e!==a)).concat(s);Array.from(l.keys()).forEach((e=>{const r=(0,o.createWid)(e).user;t.user===r?l.delete(e):l.set(e,!1)})),l.set(s,!1);const d=e.admins.map((e=>e===a?s:e));return(0,i.default)((0,i.default)({},e),{},{participants:c,senderKey:l,admins:d,version:n,rotateKey:!0})}(a,r,n,l))}));return function(){return e.apply(this,arguments)}}())},t.removeParticipantInfo=h,t.replaceParticipants=function(e){let{group:t,participants:r,admins:n,deviceIds:i,version:a}=e;const o=t.toString();return(0,f.getStorage)().lock(["participant"],(e=>{let[t]=e;return t.get(o).then((e=>e?t.createOrReplace(function(e,t,r,n,i){let a=e.rotateKey;const o=e.senderKey,l=new Map;n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e),r=o.get(t);null==r?l.set(t,!1):(l.set(t,r),o.delete(t))})),0!==o.size&&(a=!0);return{groupId:e.groupId,senderKey:l,participants:t.map(String),admins:r.map(String),rotateKey:a,version:i,deviceSyncComplete:!0}}(e,r,n,i,a)):t.create(function(e,t,r,n,i){const a=new Map;return n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);a.has(t)||a.set(t,!1)})),{groupId:e,senderKey:a,participants:t.map(String),admins:r.map(String),rotateKey:!1,version:i,deviceSyncComplete:!0}}(o,r,n,i,a))))}))},t.updateGroupParticipantTableWithoutDeviceSync=function(){return _.apply(this,arguments)},t.updateParticipants=function(e,t){const{participants:r,version:n,prevVersion:i}=t,o=e.toString();return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[a]=e;const l=yield a.get(o);if(!l)throw new u.GroupUnSyncedError(`updateParticipants: group participant info missing for group ${o}, action ${t.action}`);if(l.version&&(null==i||i!==l.version))throw new u.GroupUnSyncedError(`updateParticipants: prevVersion info missing for group ${o}, action ${t.action}`);switch(t.action){case u.PARTICIPANT_OPERATION.ADD:return a.createOrReplace(function(e,t,r,n){const i=new Map(e.senderKey);return r.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);i.set(t,!1)})),{groupId:e.groupId,senderKey:i,participants:e.participants.concat(t.map(String)),admins:e.admins,rotateKey:e.rotateKey,version:n,deviceSyncComplete:e.deviceSyncComplete}}(l,r,t.deviceIds,n));case u.PARTICIPANT_OPERATION.REMOVE:return a.createOrReplace(h(l,r,n));case u.PARTICIPANT_OPERATION.DEMOTE:return a.createOrReplace(g(l,r,n,u.PARTICIPANT_OPERATION.DEMOTE));case u.PARTICIPANT_OPERATION.PROMOTE:return a.createOrReplace(g(l,r,n,u.PARTICIPANT_OPERATION.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(81109)),a=n(r(48926)),o=r(45454),s=r(99234),l=r(57701),c=n(r(11339)),d=r(76214),u=r(70405),p=r(99039),f=r(99069);function _(){return(_=(0,a.default)((function*(e){let{groupInfos:t}=e;const r=yield(0,d.getParticipantTable)().bulkGet(t.map((e=>e.id.toString()))),n=new Map;r.forEach((e=>e&&n.set(e.groupId,e.senderKey)));const i=t.map((e=>{var t;const r=[],i=[],a=e.id.toString(),o=n.get(a)||new Map;return null===(t=e.participants)||void 0===t||t.forEach((e=>{e.isAdmin&&i.push(e.id),r.push(e.id),o.set(String(e.id),!1)})),{groupId:a,participants:r.map(String),admins:i.map(String),senderKey:o,rotateKey:!1,deviceSyncComplete:!1}}));return(0,d.getParticipantTable)().bulkCreateOrReplace(i)}))).apply(this,arguments)}function h(e,t,r){const n=new Map(e.senderKey);let i=!(0,l.rotateSenderKeyIfSentEnabled)()||e.rotateKey;n.forEach(((e,r)=>{const a=(0,o.createWid)(r).user;t.some((e=>e.user===a))&&(i=i||e,n.delete(r))})),i&&n.forEach(((e,t)=>n.set(t,!1)));const a=t.map(String);return!e.rotateKey&&i&&(0,p.postSenderKeyExpiredMetric)({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:c.default.EXPIRY_REASON.USER_LEAVE}),{groupId:e.groupId,senderKey:n,participants:e.participants.filter((e=>!a.includes(e))),admins:e.admins.filter((e=>!a.includes(e))),rotateKey:i,version:r,deviceSyncComplete:e.deviceSyncComplete}}function g(e,t,r,n){let i=e.admins;const a=t.map(String);return n===u.PARTICIPANT_OPERATION.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):n===u.PARTICIPANT_OPERATION.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,admins:i,rotateKey:e.rotateKey,version:r,deviceSyncComplete:e.deviceSyncComplete}}},70405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0;const r=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote"});t.PARTICIPANT_OPERATION=r;class n extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=n},73184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHATSAPP_GRAPHQL_ENDPOINT=t.WHATSAPP_GRAPHQL_ACCESS_TOKEN=void 0;t.WHATSAPP_GRAPHQL_ENDPOINT="https://graph.whatsapp.com/graphql";t.WHATSAPP_GRAPHQL_ACCESS_TOKEN="WA|438455091201276|159a64e893c734301a4db315bba22e04"},7312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistedQueries=void 0;t.PersistedQueries={queryCatalogProductQuery:"4859472260800606",queryProductListCatalogQuery:"4751485608268572",queryCatalogQuery:"7084293094978569"}},48089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLServerError=void 0;class r extends Error{constructor(e){super(),this.name="GraphQLServerError",this.source=e}}t.GraphQLServerError=r},1321:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchQuery=function(){return d.apply(this,arguments)},t.getLocaleVariable=function(){return l.default.getFullLocale().replace("-","_")},t.graphql=function(){throw new Error("Invariant Violation")};var i=n(r(6479)),a=n(r(48926)),o=r(48089),s=r(52148),l=n(r(43725));const c=["eventLogger"];function d(){return(d=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{eventLogger:n}=r,a=(0,i.default)(r,c);const{fetchQuery:l}=yield(0,s.requireRelayRuntime)();try{const r=yield l(yield(0,s.getEnvironment)(),e,t,a).toPromise();return null==n||n.success(),r}catch(e){throw e instanceof o.GraphQLServerError&&(null==n||n.failure(e.source.errors)),e}}))).apply(this,arguments)}},52148:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironment=function(){return d.apply(this,arguments)},t.requireRelayRuntime=l;var i=n(r(48926)),a=r(73184),o=r(7312),s=r(48089);function l(){return r.e(4815).then(r.t.bind(r,44311,23)).then((e=>e.default))}let c;function d(){return(d=(0,i.default)((function*(){if(null!=c)return c;const{Environment:e,Network:t,RecordSource:r,Store:n}=yield l(),d={Accept:"application/json","Content-Type":"application/json"},u=function(){var e=(0,i.default)((function*(e,t){const r={access_token:a.WHATSAPP_GRAPHQL_ACCESS_TOKEN,doc_id:o.PersistedQueries[e.name],variables:t},n=yield fetch(a.WHATSAPP_GRAPHQL_ENDPOINT,{method:"POST",headers:d,body:JSON.stringify(r)}),i=yield n.json();if(null!=(null==i?void 0:i.errors))throw new s.GraphQLServerError({errors:i.errors});return i}));return function(){return e.apply(this,arguments)}}();return c=new e({network:t.create(u),store:new n(new r)}),c}))).apply(this,arguments)}},99805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new Error("Invariant Violation")}},79341:e=>{"use strict";const t={fragment:{argumentDefinitions:r=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogProductQuery",selections:a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetProductResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"product",plural:!1,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:r,kind:"Operation",name:"queryCatalogProductQuery",selections:a},params:{id:"queryCatalogProductQuery",metadata:{},name:"queryCatalogProductQuery",operationKind:"query",text:null}};var r,n,i,a;t.hash="789bf89862b4e217474bfb7e30300896",e.exports=t},25173:e=>{"use strict";const t={fragment:{argumentDefinitions:r=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogQuery",selections:o=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product_catalog",plural:!1,selections:[n={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[{kind:"InlineFragment",selections:[n,i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:r,kind:"Operation",name:"queryCatalogQuery",selections:o},params:{id:"queryCatalogQuery",metadata:{},name:"queryCatalogQuery",operationKind:"query",text:null}};var r,n,i,a,o;t.hash="1fc0bd8ed5b61085c7f309bf1755d75d",e.exports=t},69808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseABProps=function(e){const t=new Map;e.forEach((e=>{if("ExperimentConfig"===e.mixinName){const{configCode:r,configValue:n,configExpoKey:i}=e;t.set(r,{configValue:n,configExpoKey:i})}}));const r=new Map;return Object.keys(n.ABPropConfigs).map((e=>{const i=n.ABPropConfigs[e][0],a=t.get(i),o=null==a?void 0:a.configValue,s=null==a?void 0:a.configExpoKey;r.set(i,{configValue:o,configExpoKey:null==s?null:s.toString()})})),r};var n=r(56042)},89981:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncABProps=h,t.syncABPropsTask=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(13959),o=r(4276),s=r(31914),l=r(34541),c=r(86945),d=r(64971),u=r(69808),p=r(88102),f=r(24747),_=r(80024);function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){var e;let t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(t=(0,d.getHash)());const n=(0,s.wap)("iq",{xmlns:"abt",id:(0,s.generateId)(),type:"get",to:s.S_WHATSAPP_NET},(0,s.wap)("props",{protocol:"1",hash:r&&null!=t?(0,s.CUSTOM_STRING)(t):s.DROP_ATTR})),i=yield(0,f.sendSmaxIq)(n,o.parseGetExperimentConfigResponseSuccess);if(!i.success||null==i.result||!i.result.success)return!1;const a=i.result.value,c=Date.now();if((0,_.updateGlobalABKey)(null!==(e=a.propsAbKey)&&void 0!==e?e:""),(0,d.updateAttributesLocalStorage)(a.propsAbKey,a.propsHash,a.propsRefresh,c),null==a.propsHash)return!1;try{return yield(0,l.updateABPropConfigs)((0,u.parseABProps)(a.propsProp)),!0}catch(e){__LOG__(4,!0,new Error,!0)`update ABProps config table failed`,SEND_LOGS("update ABProps config table failed when syncing ABProps")}return!1}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){const e=(0,d.isABPropsAfterFirstSync)();let t=3;for(;t-- >0;)try{if(yield h(e))return yield(0,c.updateABPropsFromStorage)(),void p.Cmd.abPropsUpdate()}catch(e){0===t&&(__LOG__(4,!0,new Error,!0)`failed to sync ABProps`,SEND_LOGS("failed to sync ABProps")),yield(0,a.delayMs)(1e4*Math.random())}}))).apply(this,arguments)}},41075:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ACCOUNT_SYNC_TYPE=void 0,t.getAndUpdateProfilePicture=function(){const e=(0,a.default)(p.ProfilePicThumbCollection.get((0,d.getMeUser)()),"// $FlowFixMe[incompatible-call] (T102990553) Upgrade to flow 0.161.1\nProfilePicThumbCollection.get(getMeUser())");return p.ProfilePicThumbCollection.resyncPictures([e])},t.getDevices=function(e){return(0,s.syncDeviceListJob)([(0,d.assertGetMe)()],e,null)},t.updateBlocklist=function(){return v.apply(this,arguments)},t.updateDefaultDisappearingMode=function(){return T.apply(this,arguments)},t.updatePrivacySettings=function(){return S.apply(this,arguments)},t.updateTosState=function(e){return e.forEach((e=>{m.TosManager.setState(e.id,e.state?"ACCEPTED":"NOT_ACCEPTED")})),Promise.resolve()};var i=n(r(48926)),a=n(r(45095)),o=r(68387),s=r(10823),l=r(32826),c=r(91036),d=r(99234),u=r(61319),p=r(82039),f=r(92913),_=r(99192),h=r(4831),g=r(14810),m=r(70768);const y=r(76672)({BLOCKLIST:"blocklist",DEVICES:"devices",DISAPPEARING_MODE:"disappearing_mode",PICTURE:"picture",PRIVACY:"privacy",STATUS:"status",TOS:"tos"});function E(e,t){switch(t){case u.PrivacyDisallowedListType.About:return e.about===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.GroupAdd:return e.groupAdd===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.LastSeen:return e.lastSeen===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.ProfilePicture:return e.profilePicture===o.VISIBILITY.contact_blacklist}}function S(){return(S=(0,i.default)((function*(){const e=yield(0,h.getPrivacy)();(0,d.setUserPrivacySettings)(e);const t=[u.PrivacyDisallowedListType.About,u.PrivacyDisallowedListType.GroupAdd,u.PrivacyDisallowedListType.LastSeen,u.PrivacyDisallowedListType.ProfilePicture].filter((t=>E(e,t))),r=yield(0,g.syncPrivacyDisallowedLists)(t);return{privacySettings:e,privacyDisallowedRows:r}}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield(0,f.fetchAndUpdateBlocklist)();e.dhash&&(l.BlocklistCollection.toArray().forEach((e=>l.BlocklistCollection.remove(e))),e.wids&&e.wids.forEach((e=>{l.BlocklistCollection.gadd(e)})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield(0,_.queryDisappearingMode)();yield(0,c.updateDisappearingMode)((0,d.getMaybeMeUser)(),e.duration,e.t)}))).apply(this,arguments)}t.ACCOUNT_SYNC_TYPE=y},68268:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdvToSystemBridgeImpl=void 0,t.getLastADVDeviceInfoCheckTime=v,t.runAdvDeviceInfoCheck=I,t.scheduleAdvDeviceInfoCheck=M;var i=n(r(48926)),a=r(52230),o=r(92844),s=r(45454),l=r(86945),c=r(22683),d=r(9108),u=r(99234),p=n(r(11339)),f=r(97153),_=r(60998),h=r(17041),g=r(65044);const m=25*o.HOUR_SECONDS;class y{constructor(e){this.advToSystemBridge=e}run(e){var t=this;return(0,i.default)((function*(){const r=t.advToSystemBridge,n=yield r.getUsersForExpiration(e),{usersExpired:i,usersCloseToExpiration:a}=n;r.removeCompanions(i),r.sendADVStoredTimestampExpiredEvents(i,e);const o=Array.from(i.keys()).concat(Array.from(a.keys())).filter((e=>!r.canRemoveUserDevices(e)));return r.sendOrQueueDeviceUsyncQuery(o).catch((()=>{})),r.recordLocalTimestamp()}))()}}class E{getNumDaysKeyIndexListExpiration(){return(0,l.getABPropConfigValue)("num_days_key_index_list_expiration")}getNumDaysBeforeDeviceExpiryCheck(){return(0,l.getABPropConfigValue)("num_days_before_device_expiry_check")}getUsersForExpiration(e){var t=this;return(0,i.default)((function*(){const r=yield(0,d.getAllDeviceLists)(),n=yield v(),i=t.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS,l=new Map,c=new Map;return r.forEach((r=>{r.deleted||function(e){return 1===e.devices.length&&e.devices[0].id===a.DEFAULT_DEVICE_ID}(r)||(!function(e,t,r,n){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTsUpdateTs)return e-r.expectedTsUpdateTs>=m&&r.expectedTsLastDeviceJobTs!==n;return!1}(e,i,r,n)?function(e,t,r){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTs)return r.expectedTs>r.timestamp;return!1}(e,i-t.getNumDaysBeforeDeviceExpiryCheck()*o.DAY_SECONDS,r)&&c.set((0,s.createUserWid)(r.id),r):l.set((0,s.createUserWid)(r.id),r))})),{usersExpired:l,usersCloseToExpiration:c}}))()}sendADVStoredTimestampExpiredEvents(e,t){e.forEach((e=>{const r=t-(e.timestamp+this.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS);if(r<0)return;const n=Math.round(r/o.HOUR_SECONDS);new p.default.AdvStoredTimestampExpired({advExpireTimeInHours:n}).commit()}))}sendOrQueueDeviceUsyncQuery(e){return(0,i.default)((function*(){return yield(0,f.addUserToPendingDeviceSync)(e.map((e=>e.toString()))),(0,f.doPendingDeviceSync)()}))()}canRemoveUserDevices(){return!1}removeCompanions(e){return Array.from(e.entries()).some((e=>{let[t,r]=e;t.user,(0,u.getMeUser)().user}))?(g.Socket.logout(),Promise.resolve()):Promise.all(Array.from(e.entries()).map((e=>{let[t,r]=e;return(0,h.clearDeviceRecord)(t,r.devices)})))}recordLocalTimestamp(){return Promise.resolve()}}let S;function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){if(null==S){yield(0,_.getTaskScheduledTime)("advDeviceInfoCheck")}return S}))).apply(this,arguments)}t.AdvToSystemBridgeImpl=E;const C=o.DAY_SECONDS,A="advDeviceInfoCheck";let b,P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){null!=b&&(clearTimeout(b),b=null);const e=c.Clock.localUnixTime(),t=yield v();let r=0,n=()=>Promise.resolve();null!=t&&(r=Math.max(C-(e-t),0),n=()=>(0,l.getABPropConfigValue)("adv_v2_m4_m5")?I():Promise.resolve()),b=setTimeout((0,i.default)((function*(){try{yield n()}catch(e){__LOG__(4,void 0,new Error,void 0,["adv_device_info_check"])`error running the adv device check job`}b=null,S=c.Clock.localUnixTime(),(0,_.updateTaskScheduledTime)(A,(0,o.castToUnixTime)(S)),M()})),1e3*r)}))).apply(this,arguments)}function I(){return null==P&&(P=new y(new E)),P.run(c.Clock.localUnixTime())}},56375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!0)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.push(e),g((0,a.default)(t))}(e)},t.unblockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!1)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.splice(t.indexOf(e),1),g((0,a.default)(t))}(e)};var i=n(r(48926)),a=n(r(44908)),o=r(31914),s=r(71914),l=r(81663),c=r(32826),d=r(24747),u=r(99234),p=r(58052),f=r(64551),_=r(39410);const h=new s.WapParser("blockUser",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`sendBlocklist: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`sendBlocklist: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=0===e.length?(0,o.wap)("list",{name:"default"}):(0,o.wap)("list",{name:"default"},e.map((e=>(0,o.wap)("item",{action:"deny",type:"jid",value:(0,_.JID)(e),order:"1"})))),r=(0,o.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,_.JID)((0,u.assertGetMe)()),type:"set",id:(0,o.generateId)()},(0,o.wap)("query",null,t)),n=yield(0,d.sendIq)(r,h);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendBlocklist: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}return n.result}))).apply(this,arguments)}const y=new s.WapParser("blockUserV2ResponseParser",(e=>{var t;if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`blockUserV2ResponseParser: server response with ${r}, ${n}`,{errorCode:r,errorText:n}}__LOG__(2)`block/unblock user: success`;return{blockedUsers:null===(t=e.child("list"))||void 0===t?void 0:t.mapChildrenWithTag("item",(e=>(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid"))))}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=(0,p.getBlocklistHash)(),n=(0,o.wap)("iq",{xmlns:"blocklist",to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)()},(0,o.wap)("item",{dhash:null!=r?(0,o.CUSTOM_STRING)(r):o.DROP_ATTR,action:(0,o.CUSTOM_STRING)(t?"block":"unblock"),jid:(0,_.JID)(e)})),i=yield(0,d.sendIq)(n,y);if(!i.success){const{errorCode:e,errorText:t}=i;return __LOG__(3)`blockUnblockUserV2: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},8021:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.editBusinessProfile=function(){return f.apply(this,arguments)},t.updateCartEnabled=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer()})),d=new o.WapParser("commerceSettingsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("commerce_settings").child("cart").attrString("enabled")}));function u(e){let{note:t,timezone:r,config:n}=e;const i=[];for(const e in n){const t=n[e],{mode:r,hours:a}=t;if(a)for(const[t,n]of a)i.push({day_of_week:e,mode:r,open_time:t,close_time:n});else i.push({day_of_week:e,mode:r})}const o=[];return t&&o.push((0,a.wap)("business_hours_note",null,t)),o.push(...i.map((e=>(0,a.wap)("business_hours_config",{day_of_week:(0,a.CUSTOM_STRING)(e.day_of_week),mode:e.mode,open_time:e.open_time?(0,a.CUSTOM_STRING)(e.open_time.toString()):a.DROP_ATTR,close_time:e.close_time?(0,a.CUSTOM_STRING)(e.close_time.toString()):a.DROP_ATTR})))),(0,a.wap)("business_hours",{timezone:r?(0,a.CUSTOM_STRING)(r):a.DROP_ATTR},o)}function p(){return(p=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,smax_id:"25",xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"set"},(0,a.wap)("commerce_settings",null,(0,a.wap)("cart",{enabled:(0,a.CUSTOM_STRING)(e.toString())}))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){let{address:t,description:r,categories:n,email:i,website:o,businessHours:d}=e;const p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"set"},(0,a.wap)("business_profile",{v:"3",mutation_type:"delta"},void 0!==t?(0,a.wap)("address",null,t):null,void 0!==r?(0,a.wap)("description",null,r):null,void 0!==i?(0,a.wap)("email",null,i):null,o&&0===o.length?(0,a.wap)("website",null):null,o&&o.length>0?(0,a.wap)("website",null,o[0]):null,o&&o.length>1?(0,a.wap)("website",null,o[1]):null,n?(0,a.wap)("categories",null,n.map((e=>(0,a.wap)("category",{id:(0,a.CUSTOM_STRING)(e.id)})))):null,d?u(d):null)),f=yield(0,s.sendIq)(p,c);if(!f.success)throw new l.ServerStatusCodeError(f.errorCode)}))).apply(this,arguments)}},16116:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleActivitiesForChatThreadLogging=function(e){var t,r;return __LOG__(2)`chat_thread_logging: handling ${e.length} message(s)`,null!==(t=null===(r=u())||void 0===r?void 0:r.eventStore.handleMessages(e))&&void 0!==t?t:Promise.resolve()},t.initChatThreadLogging=function(){return p.apply(this,arguments)},t.setThreadDsTimeframeOffset=function(){return f.apply(this,arguments)},t.setThreadIdUserSecret=function(e){var t,r;return __LOG__(2)`chat_thread_logging: setting thread_id_user_secret`,null!==(t=null===(r=u())||void 0===r?void 0:r.metadataStore.setSecret(e))&&void 0!==t?t:Promise.resolve(!1)},t.uploadChatThreadLoggingEvents=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(86945),s=r(36112),l=r(7217),c=r(65120);let d=null;function u(){return null==d&&__LOG__(4,void 0,new Error)`getChatThreadLoggingState: init incomplete!`,d}function p(){return(p=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=e&&(yield(0,o.getABPropConfigValue)("message_count_logging_md_enabled")),r=new c.ChatThreadLoggingMetadataLocalStorage,n=t?new s.ChatThreadLoggingEventStoreImpl(r):{handleMessages:()=>Promise.resolve(),getEvent:()=>Promise.resolve(),getBeforeInclusive:()=>Promise.resolve([]),deleteBeforeInclusive:()=>Promise.resolve(0)},i=t?new l.ChatThreadLoggingEventUploaderImpl(r,n):{uploadEvents:()=>Promise.resolve(0)},a=yield r.getOffset();return null!=a&&h(a),d={metadataStore:r,eventStore:n,eventUploader:i},Promise.resolve(d)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){var t,r;__LOG__(2)`chat_thread_logging: setting offset`;const n=null!==(t=yield null===(r=u())||void 0===r?void 0:r.metadataStore.setOffset(e))&&void 0!==t&&t;return n&&h(e),n}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,r,n;if(null==(yield null===(t=u())||void 0===t?void 0:t.metadataStore.getOffset()))return void __LOG__(2)`chat_thread_logging: attempting to upload but offset is unset.`;null!=(yield null===(r=u())||void 0===r?void 0:r.metadataStore.getSecret())?yield null===(n=u())||void 0===n?void 0:n.eventUploader.uploadEvents(e):__LOG__(2)`chat_thread_logging: attempting to upload but secret is unset.`}))).apply(this,arguments)}function h(e){const t=(0,a.unixTime)();let r=t-t%86400+e-t;r<0&&(r+=a.DAY_SECONDS),setTimeout((0,i.default)((function*(){var t;yield null===(t=u())||void 0===t?void 0:t.eventUploader.uploadEvents(),h(e)})),1e3*r)}},61840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COUNT_FIELD_NAMES=t.COUNT_FIELDS=void 0,t.toMaybeCountActionType=function(e){if(!n.hasOwnProperty(e))return null;return e};const r={profileViews:0,statusViews:0,statusReplies:0,groupMembershipReplies:0,groupPrivateReplies:0,profileReplies:0,chatOverflowClicks:0},n=Object.freeze(r);t.COUNT_FIELDS=n;const i=Object.freeze(Object.keys(r));t.COUNT_FIELD_NAMES=i},85033:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeStartTs=u,t.generateThreadID=function(){return d.apply(this,arguments)},t.getThreadDs=function(e){return(0,s.toDate)((0,s.castToUnixTime)(e-8*s.HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")},t.shouldUpdateChatEvent=function(e,t,r){return u(e,t)>r};var i=n(r(48926)),a=r(15688),o=r(11141),s=r(92844);const l=new TextEncoder,c=e=>l.encode(e).buffer;function d(){return(d=(0,i.default)((function*(e,t,r){const n=c(t+r),i=yield(0,o.hmacSha256)(e,n);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function u(e,t){const r=t%s.DAY_SECONDS,n=t-r;return r>=e?n+e:n-s.DAY_SECONDS+e}},36112:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventStoreImpl=void 0,t._computeStartTs=function(e,t){const r=t%s.DAY_SECONDS,n=t-r;if(r>e)return n+e;return n-s.DAY_SECONDS+e};var i=n(r(81109)),a=n(r(48926)),o=r(57319),s=r(92844),l=n(r(89867)),c=r(45454),d=r(61840),u=r(60112),p=r(85033),f=r(35673);t.ChatThreadLoggingEventStoreImpl=class{constructor(e,t){this.metadataStore=e,this._getExistingChat=r(9025).getExisting,this._cachedChanges=new Map,this._updateIntervalSeconds=null!=t?t:5,this._shiftTimer=new o.ShiftTimer((()=>{this._flush()}))}handleMessages(e){var t=this;return(0,a.default)((function*(){const r=yield t.metadataStore.getOffset();if(null==r)return void __LOG__(2)`ChatThreadLoggingEventStoreImpl: handleMessages: offset unset.`;const n=yield t.metadataStore.getLastUploadedStartTs();__LOG__(2)`ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=${n}`,e.forEach((e=>{if(!(0,p.shouldUpdateChatEvent)(r,e.ts,n))return;const a=(0,p.computeStartTs)(r,e.ts),o=e.chatId.toString({legacy:!0}),s=o+"_"+String(a),l=t._cachedChanges.get(s),c=null!=l?l:(0,i.default)((0,i.default)({},d.COUNT_FIELDS),{},{startTs:a,chatId:o,addMsgsSent:0,addMsgsReceived:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0});null==l&&t._cachedChanges.set(s,c);const u=(0,d.toMaybeCountActionType)(e.activityType);if(null!=u)c[u]+=1;else switch(e.activityType){case"msgSend":c.addMsgsSent+=1,e.isViewOnce&&(c.addViewOnceMsgsSent+=1);break;case"msgReceive":c.addMsgsReceived+=1,e.isViewOnce&&(c.addViewOnceMsgsReceived+=1);break;case"viewOnceOpen":c.addViewOnceMsgsOpened+=1;break;case"voipCall":e.outgoing?c.addCallOffersSent+=1:c.addCallOffersReceived+=1,c.addTotalCallDuration+=e.durationInSeconds;break;default:__LOG__(3)`Passed event store info type not valid: ${e.activityType}`}})),yield t._setFlushIfNecessary()}))()}_setFlushIfNecessary(){this._shiftTimer.onOrBefore(1e3*this._updateIntervalSeconds)}_flush(){var e=this;return(0,a.default)((function*(){const t=Array.from(e._cachedChanges.values());e._cachedChanges.clear(),yield(0,u.createOrUpdateChatEvents)(t)}))()}_populateEvents(e){var t=this;return(0,a.default)((function*(){const r=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return[e,yield t._getExistingChat((0,c.createWid)(e.chatId))]}));return function(){return e.apply(this,arguments)}}()));return Promise.all(r.map(function(){var e=(0,a.default)((function*(e){var t,r,n,a,o,s,c;let[d,u]=e;const p=l.default.isGroup(d.chatId),_=p?{isAGroup:p,groupSize:null!==(t=null==u||null===(r=u.groupMetadata)||void 0===r?void 0:r.participants.length)&&void 0!==t?t:1}:{isAGroup:p,isAContact:yield(0,f.isAddressBookContact)(d.chatId)},h=(null!==(n=null==u?void 0:u.pin)&&void 0!==n?n:0)>0,g=null!==(a=null==u?void 0:u.archive)&&void 0!==a&&a,m=null!==(o=null==u?void 0:u.getStarredMsgs().length)&&void 0!==o?o:0,y=null!==(s=null==u?void 0:u.unreadCount)&&void 0!==s?s:0,E=0!==(null!==(c=null==u?void 0:u.muteExpiration)&&void 0!==c?c:0);return(0,i.default)((0,i.default)({},d),{},{isPinned:h,isArchived:g,contactInfo:_,messagesStarred:m,messagesUnread:y,isMuted:E})}));return function(){return e.apply(this,arguments)}}()))}))()}getEvent(e,t){var r=this;return(0,a.default)((function*(){r._cachedChanges.size>0&&(yield r._flush());const n=yield(0,u.getChatEvent)(e,t);return null==n?null:(yield r._populateEvents([n]))[0]}))()}getBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),t._populateEvents(yield(0,u.getBeforeInclusive)(e))}))()}deleteBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),(0,u.deleteBeforeInclusive)(e)}))()}}},7217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventUploaderImpl=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(92844),l=r(61840),c=r(85033),d=n(r(11339));t.ChatThreadLoggingEventUploaderImpl=class{constructor(e,t){this.eventStore=t,this.metadataStore=e}uploadEvents(e){var t=this;return(0,a.default)((function*(){var r,n;const u=null===(r=null==e?void 0:e.purgeAfter)||void 0===r||r,p=yield t.metadataStore.getOffset();if(null==p)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: offset not in store!`,-1;const f=null!==(n=null==e?void 0:e.lastStartTs)&&void 0!==n?n:(0,c.computeStartTs)(p,(0,s.unixTime)()-s.DAY_SECONDS);if(null==t.secret){const e=yield t.metadataStore.getSecret();if(null==e)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: secret not in store!`,-1;t.secret=e}const _=yield t.eventStore.getBeforeInclusive(f);if(yield Promise.all(_.map(function(){var e=(0,a.default)((function*(e){const r=(0,c.getThreadDs)(e.startTs),n=e.contactInfo;new d.default.ChatMessageCounts((0,i.default)((0,i.default)({},l.COUNT_FIELD_NAMES.reduce(((t,r)=>(t[r]=e[r],t)),{})),{},{messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,viewOnceMessagesSent:e.viewOnceMsgsSent,viewOnceMessagesReceived:e.viewOnceMsgsReceived,viewOnceMessagesOpened:e.viewOnceMessagesOpened,threadDs:r,threadId:yield(0,c.generateThreadID)((0,o.default)(t.secret,"_this.secret"),e.chatId,r),isAGroup:e.contactInfo.isAGroup,groupSize:n.isAGroup?n.groupSize:void 0,isAContact:n.isAGroup?void 0:n.isAContact,isArchived:e.isArchived,isPinned:e.isPinned,messagesStarred:e.messagesStarred,messagesUnread:e.messagesUnread,chatMuted:e.isMuted?d.default.CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:d.default.CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:e.callOffersSent,callOffersReceived:e.callOffersReceived,totalCallDuration:e.totalCallDuration})).commit()}));return function(){return e.apply(this,arguments)}}())),u){const e=yield t.eventStore.deleteBeforeInclusive(f);e!==_.length&&__LOG__(4,void 0,new Error)`uploadEvents: uploaded ${_.length} events but only deleted ${e} (they should be the same!)`}return yield t.metadataStore.setLastUploadedStartTs(f),_.length}))()}}},65120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingMetadataLocalStorage=void 0;var n=r(15688),i=r(58052);t.ChatThreadLoggingMetadataLocalStorage=class{constructor(){null==(0,i.getChatThreadLoggingLastUploadedStartTs)()&&(0,i.setChatThreadLoggingLastUploadedStartTs)(0)}setOffset(e){return(0,i.setChatThreadLoggingOffset)(e),Promise.resolve(!0)}getOffset(){return Promise.resolve((0,i.getChatThreadLoggingOffset)())}setSecret(e){return(0,i.setChatThreadLoggingSecretB64)((0,n.encodeB64)(e)),Promise.resolve(!0)}getSecret(){const e=(0,i.getChatThreadLoggingSecretB64)();return null==e?Promise.resolve():Promise.resolve((0,n.decodeB64)(e))}setLastUploadedStartTs(e){return(0,i.setChatThreadLoggingLastUploadedStartTs)(e),Promise.resolve(!0)}getLastUploadedStartTs(){var e;return Promise.resolve(null!==(e=(0,i.getChatThreadLoggingLastUploadedStartTs)())&&void 0!==e?e:0)}}},99609:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDirtyBits=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("cleanDirtyReplyParser",(e=>(e.assertAttr("type","result"),{})));function c(){return(c=(0,i.default)((function*(e){if(0===e.length)return;const t=e.map((e=>(0,a.wap)("clean",{type:(0,a.CUSTOM_STRING)(e.type),timestamp:(0,a.INT)(e.timestamp)}))),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:(0,a.generateId)()},t);try{yield(0,s.sendIq)(r,l),__LOG__(2)`clearDirtyBits: success for type: ${e.map((e=>e.type)).join(",")}`}catch(e){__LOG__(3)`clearDirtyBits: failed with error`}}))).apply(this,arguments)}},58853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeMaybeMediaType=t.encodeMaybeDecryptFail=t.CIPHERTEXT_VERSION=void 0,t.encodeMediaType=s,t.maybeEncoder=l,t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):null}if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):null}if(t.viewOnceMessage){const{message:r}=t.viewOnceMessage;return r?e(r):null}if(t.imageMessage)return a.MediaType.Photo;if(t.stickerMessage)return a.MediaType.Sticker;if(t.locationMessage)return a.MediaType.LiveLocation;if(t.contactMessage)return a.MediaType.Contact;if(t.contactsArrayMessage)return a.MediaType.ContactArray;if(t.documentMessage)return a.MediaType.Document;if(t.audioMessage)return t.audioMessage.ptt?a.MediaType.Ptt:a.MediaType.Audio;if(t.videoMessage)return t.videoMessage.gifPlayback?a.MediaType.Gif:a.MediaType.Video;if(t.buttonsMessage)return a.MediaType.Button;if(t.buttonsResponseMessage)return a.MediaType.ButtonResponse;if(t.listMessage)return a.MediaType.List;if(t.listResponseMessage)return a.MediaType.ListResponse;if(t.orderMessage)return a.MediaType.Order;if(t.productMessage)return a.MediaType.Product;if(t.groupInviteMessage)return a.MediaType.Url;return null},t.metricsCiphertextType=function(e){switch(e){case a.CiphertextType.Skmsg:return o.default.E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case a.CiphertextType.Pkmsg:return o.default.E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case a.CiphertextType.Msg:return o.default.E2E_CIPHERTEXT_TYPE.MESSAGE}},t.metricsDestinationType=function(e){if(e.isUser())return o.default.E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return o.default.E2E_DESTINATION.GROUP;if(e.isStatusV3())return o.default.E2E_DESTINATION.STATUS;if(e.isBroadcast())return o.default.E2E_DESTINATION.LIST;throw new Error},t.metricsMediaType=function(e){switch(e){case a.MediaType.Photo:return o.default.MEDIA_TYPE.PHOTO;case a.MediaType.Video:return o.default.MEDIA_TYPE.VIDEO;case a.MediaType.Audio:return o.default.MEDIA_TYPE.AUDIO;case a.MediaType.Ptt:return o.default.MEDIA_TYPE.PTT;case a.MediaType.Location:return o.default.MEDIA_TYPE.LOCATION;case a.MediaType.Contact:return o.default.MEDIA_TYPE.CONTACT;case a.MediaType.Document:return o.default.MEDIA_TYPE.DOCUMENT;case a.MediaType.Url:return o.default.MEDIA_TYPE.URL;case a.MediaType.Call:return o.default.MEDIA_TYPE.CALL;case a.MediaType.Gif:return o.default.MEDIA_TYPE.GIF;case a.MediaType.Future:return o.default.MEDIA_TYPE.FUTURE;case a.MediaType.ContactArray:return o.default.MEDIA_TYPE.CONTACT_ARRAY;case a.MediaType.LiveLocation:return o.default.MEDIA_TYPE.LIVE_LOCATION;case a.MediaType.ProfilePic:return o.default.MEDIA_TYPE.PROFILE_PIC;case a.MediaType.Sticker:return o.default.MEDIA_TYPE.STICKER;case a.MediaType.Hsm:return o.default.MEDIA_TYPE.HSM;case a.MediaType.ProductImage:return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.Template:return o.default.MEDIA_TYPE.TEMPLATE;case a.MediaType.MdAppState:return o.default.MEDIA_TYPE.MD_APP_STATE;case a.MediaType.MdHistorySync:return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case a.MediaType.List:return o.default.MEDIA_TYPE.LIST;case a.MediaType.ListResponse:return o.default.MEDIA_TYPE.LIST_REPLY;case a.MediaType.Button:return o.default.MEDIA_TYPE.BUTTON_MESSAGE;case a.MediaType.ButtonResponse:return o.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case a.MediaType.Order:return o.default.MEDIA_TYPE.ORDER;case a.MediaType.Product:return o.default.MEDIA_TYPE.PRODUCT_IMAGE}};var i=r(31914),a=r(45033),o=n(r(11339));function s(e){const t=(()=>{switch(e){case a.MediaType.Photo:return"image";case a.MediaType.Video:return"video";case a.MediaType.Audio:return"audio";case a.MediaType.Ptt:return"ptt";case a.MediaType.Contact:return"vcard";case a.MediaType.Document:return"document";case a.MediaType.Gif:return"gif";case a.MediaType.ContactArray:return"contact_array";case a.MediaType.LiveLocation:return"livelocation";case a.MediaType.Sticker:return"sticker";case a.MediaType.List:return"list";case a.MediaType.ListResponse:return"list_response";case a.MediaType.ButtonResponse:return"buttons_response";case a.MediaType.Order:return"order";case a.MediaType.Product:return"product";case a.MediaType.Url:return"url";default:return null}})();if(t)return(0,i.CUSTOM_STRING)(t);throw new Error("Unsupported type")}function l(e){return t=>null==t?i.DROP_ATTR:e(t)}t.CIPHERTEXT_VERSION=2;const c=l(s);t.encodeMaybeMediaType=c;const d=l((()=>(0,i.CUSTOM_STRING)("hide")));t.encodeMaybeDecryptFail=d},65508:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseErrorFields=void 0;const n=new(r(71914).WapParser)("parseErrorFields",(e=>{const t=[];return e.forEachChildWithTag("field",(e=>{const r=e.hasAttr("detail")?e.maybeAttrString("detail"):null;t.push({name:e.attrString("name"),reason:e.attrString("reason"),detail:r})})),t}));t.parseErrorFields=n},76199:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.maybeChild("address"),r=t?t.contentString():void 0,n=e.maybeChild("description"),o=n?n.contentString():void 0,s=e.maybeChild("email"),l=s?s.contentString():void 0,c=e.maybeChild("latitude"),d=c?parseFloat(c.contentString()):void 0,u=e.maybeChild("longitude"),p=u?parseFloat(u.contentString()):void 0,f=e.maybeChild("vertical");let _;if(f){const e=f.maybeAttrString("canonical"),t=f.hasContent()?f.contentString():void 0;_={name:t,canonical:e}}const h=[];e.forEachChildWithTag("website",(e=>{h.push(e.contentString())}));const g=[],m=e.maybeChild("categories");m&&m.forEachChildWithTag("category",(e=>{const t=e.attrString("id");g.push({id:t,localized_display_name:e.contentString()})}));let y;const E=e.maybeChild("business_hours");if(E){const e=E.maybeAttrString("timezone"),t=[];E.forEachChildWithTag("business_hours_config",(e=>{t.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})})),y={config:t,timezone:e}}let S;const v=e.maybeChild("profile_options");if(v){S={};const e=v.maybeChild("commerce_experience");var T;if(e)S.commerce_experience=null!==(T=a.COMMERCE_EXPERIENCE_TYPES.cast(e.contentString()))&&void 0!==T?T:a.COMMERCE_EXPERIENCE_TYPES.NONE;const t=v.maybeChild("cart_enabled");t&&(S.cart_enabled="true"===t.contentString());const r=v.maybeChild("shop_url");r&&(S.shop_url=r.contentString());const n=v.maybeChild("commerce_manager_url");n&&(S.commerce_manager_url=n.contentString());const i=v.maybeChild("is_banned");i&&(S.is_banned="true"===i.contentString());const o=v.maybeChild("direct_connection");o&&(S.direct_connection="true"===o.contentString())}const C=e.maybeChild("direct_connection");let A;if(C){const e=C.maybeChild("default_postcode");A={enabled:"true"===C.maybeAttrString("enabled"),defaultPostcode:e?{code:e.attrString("code"),locationName:e.attrString("location_name")}:void 0}}const b=e.maybeChild("catalog_status"),P=b?b.attrString("status"):void 0;let M,O,I;const w=e.maybeChild("linked_accounts");if(w){I=!0;const e=w.maybeChild("fb_page");if(e){const t=e.maybeChild("display_name"),r=e.maybeChild("likes");M={displayName:null==t?void 0:t.contentString(),likes:null==r?void 0:r.contentString(),id:e.maybeAttrString("id")}}const t=w.maybeChild("ig_professional");if(t){const e=t.maybeChild("ig_handle"),r=t.maybeChild("followers");O={handle:null==e?void 0:e.contentString(),followers:null==r?void 0:r.contentString()}}}const R={address:r,description:o,email:l,latitude:d,longitude:p,vertical:_,website:h,categories:g,business_hours:y,catalog_status:P,profile_options:S,fbPage:M,igProfessional:O,isProfileLinked:I,directConnection:A};return(0,i.default)(R)};var i=n(r(70740)),a=r(93170)},27874:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.attrEnum("verified_level",i.MSG_VERIFIED_LEVEL),r=e.hasContent()?e.contentBytes():null,o=e.maybeAttrString("serial"),{serial:s,name:l,isApi:c}=r&&function(e){const t=(0,a.getParsedProtoObjects)(e);if(null==t?void 0:t.details){const{name:e,serial:r,isApi:n}=(0,a.extractCertificateDetailsParams)(t.details);return{name:e,serial:String(r),isApi:n}}}(r)||{},d=n.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),u=n.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),p=e.maybeAttrInt("privacy_mode_ts");return{level:t,serial:o||s,name:l,isApi:!0===c,privacyMode:null!=d&&null!=u&&null!=p?{actualActors:d,hostStorage:u,privacyModeTs:p}:null}};var n=r(49714),i=r(12037),a=r(51836)},40376:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.digestKey=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(71914),l=r(24747),c=r(11849),d=r(46669);const u=new s.WapParser("digestResponseParser",(e=>{const t=e.child("digest"),r=t.child("skey");return{regId:t.child("registration").contentUint(4),type:t.child("type").contentUint(1),identity:t.child("identity").contentBytes(32),skey:{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32),signature:r.child("signature").contentBytes(64)},keys:t.child("list").mapChildren((e=>e.contentUint(3))),hash:t.child("hash").contentBytes(20)}}));function p(){return(p=(0,i.default)((function*(){const e=(0,o.wap)("iq",{xmlns:"encrypt",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("digest",null)),t=yield(0,l.sendIq)(e,u);let r=null;if(t.success)try{yield f(t.result),r=!1}catch(e){r=!1}else{const e=t.errorCode;404===e?(__LOG__(3)`digestKey: no record found for current user`,r=!0):406===e?(__LOG__(3)`digestKey: malformed request`,r=!1):503===e?(__LOG__(3)`digestKey: service unavailable`,r=!1):(__LOG__(3)`digestKey: server error ${e}`,r=!1)}if(null!=r&&r)return __LOG__(2)`digestKey: validate key bundle failed, upload prekeys again`,(0,d.uploadPreKeys)()}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[t,r]=yield Promise.all([c.waSignalStore.getRegistrationInfo(),c.waSignalStore.getSignedPreKey()]);if(!t||!r)throw new Error("validateLocalKeyBundle: No registration info is available");if(e.regId!==t.registrationId)throw new Error("validateLocalKeyBundle: registation id mismatch");const n=t.identityKeyPair.pubKey,o=r.keyPair.pubKey,s=n.byteLength+o.byteLength+r.signature.byteLength+32*e.keys.length,l=new Uint8Array(s);let d=0;[n,o,r.signature].forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const u=e.keys.map(function(){var e=(0,i.default)((function*(e){const t=yield c.waSignalStore.getPreKeyById(e);if(!t)throw Error(`validateLocalKeyBundle: missing prekey record for id ${e}`);return t.keyPair.pubKey}));return function(){return e.apply(this,arguments)}}());(yield Promise.all(u)).forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const p=yield self.crypto.subtle.digest("SHA-1",l),f=(0,a.encodeB64)(p),_=(0,a.encodeB64)(e.hash);if(f!==_)throw Error(`validateLocalKeyBundle: hash mismatch remote:${_} local:${f}`);__LOG__(2)`validateLocalKeyBundle: success`}))).apply(this,arguments)}},66457:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(79942),s=r(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getAbout: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withStatusProtocol().withUser((new o.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getAbout: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const n=r.list;return n.length||Promise.reject(new Error("no status data returned for user")),{id:e,status:n[0].status}}))).apply(this,arguments)}},37790:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(99234),d=r(39410);const u=new o.WapParser("getBlocklistParser",(e=>e.hasChild("error")&&404===e.child("error").attrInt("code")?{wids:[]}:{wids:p(e)}));function p(e){return e.child("query").child("list").mapChildrenWithTag("item",(e=>(0,s.userJidToUserWid)(e.attrPhoneUserJid("value"))))}function f(){return(f=(0,i.default)((function*(){const e=yield(0,l.sendIq)((0,a.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,d.JID)((0,c.assertGetMe)()),type:"get",id:(0,a.generateId)()},(0,a.wap)("query",null,(0,a.wap)("list",{name:"default"}))),u);if(e.success)return __LOG__(2)`getBlocklist from server`,e.result;const{errorCode:t,errorText:r}=e;return __LOG__(3)`getBlocklist: failed ${t}, ${r}`,{errorCode:t,errorText:r}}))).apply(this,arguments)}},88445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingMode=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(79942),s=r(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getDisappearingMode: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withDisappearingModeProtocol().withUser((new o.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getDisappearingMode: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const n=r.list;0!==n.length&&null!=n[0].disappearing_mode||Promise.reject(new Error("no disappearing_mode data returned for user"));const{duration:i,t:l}=n[0].disappearing_mode;return{id:e,disappearingModeDuration:i,disappearingModeSettingTimestamp:l}}))).apply(this,arguments)}},53379:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndStoreIdentityKeys=function(){return _.apply(this,arguments)},t.getIdentityKeys=h;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(5087),d=n(r(76128)),u=r(93832),p=r(39410);const f=new o.WapParser("identityKeysParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`identityKeysParser bad response: ${r} ${n}`)}return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"))}}))));function _(){return(_=(0,i.default)((function*(e){const t=yield d.default.bulkLoadIdentityKey(e.map((e=>String((0,u.createSignalAddress)(e))))),r=e.filter(((e,r)=>null==t[r]));if(0===r.length)return void __LOG__(2)`getAndStoreIdentityKeys: got 0 missing keys`;__LOG__(2)`getAndStoreIdentityKeys: query ${r.length} missing keys for ${e.length} contacts`;const n=(yield h(r)).map((e=>{const t=e.identity,r=(0,c.toSignalCurvePubKey)(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset));return{identityKey:(0,u.bufferToStr)(r),identifier:(0,u.createSignalAddress)(e.user).toString()}}));return d.default.bulkCreateIdentity(n)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("user",{jid:(0,p.DEVICE_JID)(e)}))),r=(0,a.wap)("iq",{xmlns:"encrypt",type:"get",to:a.S_WHATSAPP_NET,id:(0,a.generateId)()},(0,a.wap)("identity",null,t)),n=yield(0,l.sendIq)(r,f);if(!n.success)throw new Error(`getIdentityKeys bad response ${String(n)}`);return n.result}))).apply(this,arguments)}},94943:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilePicFull=function(e){return p(e,{preview:!1})},t.getProfilePicPreview=function(e,t){return p(e,{preview:!0,invite:t})};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(39410),c=r(77591);const d={preview:"preview",image:"image"},u=new o.WapParser("profilePicParser",(e=>{const t=e.child("picture");return{id:t.attrInt("id"),type:t.attrEnum("type",d),url:t.attrString("url")}}));function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){e.isBroadcast()&&(__LOG__(4,!0,new Error,!0)`getProfilePic failed with a broadcast WID type target}`,SEND_LOGS("getProfilePic failed with a broadcast WID type target"));const{preview:r,invite:n,photoId:i}=t,o=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:(0,l.CHAT_JID)(e),type:"get",xmlns:"w:profile:picture",id:(0,a.generateId)()},(0,a.wap)("picture",{invite:(0,a.MAYBE_CUSTOM_STRING)(n),type:r?"preview":a.DROP_ATTR,id:null!=i?(0,a.INT)(i):a.DROP_ATTR,query:"url"})),d=yield(0,s.sendIq)(o,u);if(!d.success)return Promise.reject(new c.ServerStatusCodeError(d.errorCode,d.errorText));const{id:p,url:f,type:_}=d.result;return __LOG__(2)`getProfilePic: ${e.toString()} ${p}, ${_}, ${f}`,{tag:p.toString(),eurl:f,type:_}}))).apply(this,arguments)}},26539:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(87614),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(24747),u=r(46920),p=n(r(11339)),f=r(39410),_=r(77591);const h=new s.WapParser("createGroupReplyParser",(e=>{var t;const r=e.child("group");let n;try{n=(0,c.createWid)(`${r.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=n)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");return{wid:n,subject:r.attrString("subject"),creator:(0,l.userJidToUserWid)(r.attrPhoneUserJid("creator")),ts:r.attrTime("creation"),participants:r.mapChildrenWithTag("participant",(e=>{const t=e.maybeChild("add_request");return{wid:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),error:e.hasAttr("error")?e.attrInt("error"):null,invite_code:t&&t.attrString("code"),invite_code_exp:t&&t.attrString("expiration"),type:e.attrEnumOrDefault("type",u.GROUP_PARTICIPANT_TYPES,"participant")}}))}}));function g(){return(g=(0,i.default)((function*(e,t,r,n){const i=(0,a.randomHex)(8),s=t.map((e=>(0,o.wap)("participant",{jid:(0,f.USER_JID)(e)})));null!=r&&0!==r&&s.unshift((0,o.wap)("ephemeral",{expiration:(0,o.INT)(r)})),null!=n&&s.unshift((0,o.wap)("linked_parent",{jid:(0,f.GROUP_JID)(n)}));const l=(0,o.wap)("iq",{to:o.G_US,type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("create",{subject:(0,o.CUSTOM_STRING)(e),key:(0,o.CUSTOM_STRING)(i)},s)),c=yield(0,d.sendIq)(l,h);return c.success?(new p.default.GroupCreateC({}).commit(),c.result):Promise.reject(new _.ServerStatusCodeError(c.errorCode,c.errorText))}))).apply(this,arguments)}},12594:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.leaveGroups=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(39410),d=r(77591);const u=new o.WapParser("leaveGroupResultParser",(e=>{e.assertAttr("type","result");return{groups:e.child("leave").mapChildren((e=>(0,s.groupJidToWid)(e.attrGroupJid("id"))))}}));function p(){return(p=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("group",{id:(0,c.GROUP_JID)(e)}))),r=(0,a.wap)("iq",{to:a.G_US,type:"set",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("leave",null,t)),n=yield(0,l.sendIq)(r,u);return n.success?n.result:Promise.reject(new d.ServerStatusCodeError(n.errorCode,n.errorText))}))).apply(this,arguments)}},82394:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(){return h.apply(this,arguments)},t.queryGroupInviteV4=function(){return p.apply(this,arguments)},t.revokeGroupInviteV4=function(){return g.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(71914),l=r(81663),c=r(24747),d=r(2182);const u=new s.WapParser("queryGroupInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}return e.hasChild("group")?{groupMetadata:(0,d.parseGroupNode)(e.child("group"))}:{phashMatch:!0}}));function p(){return(p=(0,a.default)((function*(e,t,r,n,a){const s=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(r),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{phash:(0,o.MAYBE_CUSTOM_STRING)(a)},(0,o.wap)("add_request",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(n)}))),l=yield(0,c.sendIq)(s,u);if(!l.success)return __LOG__(2)`parsing failed for queryGroupInviteV4: ${JSON.stringify(l)}`,{status:500};const d=l.result,p={status:null!=d.errorCode&&d.errorCode>0?d.errorCode:200};return d.groupMetadata?(0,i.default)((0,i.default)({},p),{},{groupMetadata:d.groupMetadata}):p}))).apply(this,arguments)}const f=new s.WapParser("joinGroupViaInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text"),groupId:(0,l.groupJidToWid)(t.attrGroupJid("from"))}}return{groupId:(0,l.groupJidToWid)(e.attrGroupJid("from"))}})),_=new s.WapParser("revokeGroupV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}const t=e.child("revoke"),r=[];return t.mapChildrenWithTag("participant",(e=>{e.hasAttr("error")||r.push((0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")))})),{revokedUsers:r}}));function h(){return(h=(0,a.default)((function*(e,t,r,n){const i=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(r),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("accept",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(n)})),a=yield(0,c.sendIq)(i,f);if(!a.success)return __LOG__(2)`joinGroupV4Parser: parsing failed ${a.errorCode}:${a.errorType}`,{status:500};const s=a.result;return{status:null!=s.errorCode&&s.errorCode>0?s.errorCode:200,gid:s.groupId}}))).apply(this,arguments)}function g(){return(g=(0,a.default)((function*(e,t){const r=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(t),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("revoke",null,e.map((e=>(0,o.wap)("participant",{jid:(0,o.CUSTOM_STRING)(e)}))))),n=yield(0,c.sendIq)(r,_);if(!n.success)return __LOG__(2)`revokeGroupV4Parser: parsing failed ${n.errorCode}:${n.errorType}`,{status:500};const i=n.result;return{status:null!=i.errorCode&&i.errorCode>0?i.errorCode:200}}))).apply(this,arguments)}},85057:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAllGroups=function(){return p.apply(this,arguments)},t.queryGroupInvite=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(2182),c=r(77591);const d=new o.WapParser("queryGroupParser",(e=>e.hasChild("group")?(0,l.parseGroupNode)(e.child("group")):{phashMatch:!0})),u=new o.WapParser("queryAllGroupParser",(e=>e.child("groups").mapChildren(l.parseGroupNode)));function p(){return(p=(0,i.default)((function*(){const e=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("participating",null,(0,a.wap)("participants",null),(0,a.wap)("description",null))),t=yield(0,s.sendIq)(e,u);return t.success?t.result:(__LOG__(2)`queryAllGroups failed: ${t.errorCode}:${t.errorType}`,Promise.reject(new c.ServerStatusCodeError(t.errorCode,t.errorText)))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("invite",{code:(0,a.CUSTOM_STRING)(e)})),r=yield(0,s.sendIq)(t,d);return r.success?r.result:(__LOG__(2)`queryGroupInvite failed: ${r.errorCode}:${r.errorType}`,Promise.reject(new c.ServerStatusCodeError(r.errorCode,r.errorText)))}))).apply(this,arguments)}},45823:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleAboutNotification=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){switch(__LOG__(2)`handleAboutNotification: received ${e.type}
for ${e.from.toString()}`,e.type){case d.SIDE_LIST_CHANGE:break;case d.CHANGE:const t=l.StatusCollection.get(e.from);t?t.status=e.content:__LOG__(3)`handleAboutNotification: get status update for unknown contact ${e.from}`;break;default:__LOG__(3)`handleAboutNotification: unhandled notification of
type ${e.type}`}return(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e.stanzaId),to:"change"===e.type?(0,c.JID)(e.from):(0,a.CUSTOM_STRING)(e.from),class:"notification",type:"status"})}(t.success)};var i=n(r(81109)),a=r(31914),o=r(71914),s=r(81663),l=r(46133),c=r(39410);const d=Object.freeze({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"});t.NOTIFICATION_TYPE=d;const u=new o.WapParser("incomingAboutNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id")},r=e.hasChild("set")&&e.child("set");if(r&&!r.hasAttr("hash"))return(0,i.default)({type:d.CHANGE,from:(0,s.userJidToUserWid)(e.attrPhoneUserJid("from")),pushname:e.attrString("notify"),content:r.contentString(),ts:e.attrTime("t")},t);let n=d.UNKNOWN;return r&&r.hasAttr("hash")&&(n=d.SIDE_LIST_CHANGE),(0,i.default)({type:n,from:e.attrString("from")},t)}))},40126:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateStatus=M,t.handleAccountSyncNotification=function(){return I.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(52230),s=r(31914),l=r(71914),c=r(81663),d=r(45454),u=r(41075),p=r(88102),f=r(91036),_=n(r(69153)),h=r(99234),g=n(r(66457)),m=r(88445),y=r(7293),E=r(54181),S=r(28237),v=r(10435),T=r(97153),C=r(46133),A=r(39410);const b=e=>{const t=e.maybeChild("key-index-list"),r=null==t?null:{ts:t.attrTime("ts"),signedKeyIndexBytes:t.hasContent()?t.contentBytes():null,expectedTs:t.hasAttr("expected_ts")?t.attrTime("expected_ts"):void 0},n=e.mapChildrenWithTag("device",(e=>({id:(0,d.createWid)(e.attrDeviceJid("jid")).device||o.DEFAULT_DEVICE_ID,keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null})));return 0===n.length?null:{deviceList:n,keyIndex:r}},P=new l.WapParser("incomingAccountSyncNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),ts:e.attrTime("t"),from:(0,c.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from"))};if(e.hasChild("status")){const r=e.child("status"),n=r.hasAttr("action")?r.attrString("action"):void 0;return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.STATUS,action:n},t)}if(e.hasChild("privacy"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PRIVACY},t);if(e.hasChild("devices"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.DEVICES,devices:b(e.child("devices"))},t);if(e.hasChild("blocklist"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.BLOCKLIST},t);if(e.hasChild("picture"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PICTURE},t);if(e.hasChild("tos")){const r=e.child("tos"),n=[];return r.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),r=e.attrString("id");n.push({id:r,state:t})})),(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.TOS,notices:n},t)}if(e.hasChild("disappearing_mode")){const r=e.child("disappearing_mode");let n,i,o;return r.hasAttr("action")?n=r.attrString("action"):(i=r.attrInt("duration"),o=r.attrInt("t")),(0,a.default)((0,a.default)({},t),{},{type:u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE,action:n,disappearingModeDuration:i,disappearingModeSettingTimestamp:o})}throw new Error("notification type not supported")}));function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,h.assertGetMe)(),t=yield(0,g.default)(e);if(t.error)return __LOG__(3)`getStatus failed for ${e}: failed ${t.error.errorCode} : ${t.error.errorText}`,Promise.reject(t.error.errorText);const r=t.status;r&&(C.StatusCollection.assertGet((0,h.getMaybeMeUser)()).status=r)}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=P.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r.stanzaId),to:(0,A.JID)(r.from),class:"notification",type:"account_sync"});switch(r.type){case u.ACCOUNT_SYNC_TYPE.STATUS:yield M();break;case u.ACCOUNT_SYNC_TYPE.DEVICES:if(y.GK.supportsFeature(y.GK.F.MD_BACKEND)){if(!S.OfflineMessageHandler.isResumeFromRestartComplete())return _.default.addOfflinePendingDevice(r.from.toString(),n),"NO_ACK";if(S.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,T.addUserToPendingDeviceSync)([r.from.toString()]),n}r.devices?yield(0,E.handleADVDeviceSyncResult)([{devices:r.devices,wid:(0,d.toUserWid)(r.from)}]):yield(0,u.getDevices)("notification");break;case u.ACCOUNT_SYNC_TYPE.PICTURE:yield(0,u.getAndUpdateProfilePicture)();break;case u.ACCOUNT_SYNC_TYPE.PRIVACY:p.Cmd.onAccountSyncForPrivacy(yield(0,u.updatePrivacySettings)());break;case u.ACCOUNT_SYNC_TYPE.BLOCKLIST:(0,u.updateBlocklist)();break;case u.ACCOUNT_SYNC_TYPE.TOS:r.notices&&(0,u.updateTosState)(r.notices);break;case u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE:if((0,v.isDisappearingModeEnabled)()){const{action:e,from:t}=r;let n=r.disappearingModeDuration,i=r.disappearingModeSettingTimestamp;if("modify"===e){const e=yield(0,m.getDisappearingMode)(t);null==e.error&&null!=e.disappearingModeDuration&&null!=e.disappearingModeSettingTimestamp&&(n=e.disappearingModeDuration,i=e.disappearingModeSettingTimestamp)}null!=n&&null!=i&&(yield(0,f.updateDisappearingMode)(t,n,i));break}default:__LOG__(2)`account sync notification of type ${r.type} not supported`}return n}))).apply(this,arguments)}},97760:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedBusinessNameNotificationContact=function(){return A.apply(this,arguments)},t.handleVerifiedBusinessNameNotificationHash=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(93170),l=r(24747),c=r(19380),d=n(r(9762)),u=r(9961),p=r(99069),f=r(31452),_=r(68708),h=n(r(27874)),g=r(39410);function m(e,t,r,n,i){const a=c.ContactCollection.get(e);return null!=a&&(0,f.updateContactsWithVerifiedNames)([{id:e,name:r,level:t,isApi:n,privacyMode:i}],[a]),Promise.resolve()}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,p.getStorage)().lock(["verified-business-name"],(()=>(0,_.createOrUpdateVerifiedBusinessName)({id:e.wid.user,level:e.level,serial:parseInt(e.serial||"0",10),name:e.verifiedName,isApi:e.isApi,privacyMode:e.privacyMode?{actualActors:e.privacyMode.actualActors,hostStorage:e.privacyMode.hostStorage,privacyModeTs:e.privacyMode.privacyModeTs}:null})));const t=[],r=c.ContactCollection.get(e.wid);null!=r&&t.push((0,d.default)(e.wid,{verifiedName:r.verifiedName,isVerifiedHigh:r.verifiedLevel===s.VERIFIED_LEVEL.HIGH,isBusiness:r.isBusiness,isEnterprise:r.isEnterprise,privacyMode:r.privacyMode},{verifiedName:e.verifiedName,isVerifiedHigh:"high"===e.level,isBusiness:!0,isEnterprise:e.isApi,privacyMode:e.privacyMode})),t.push(m(e.wid,e.level,e.verifiedName,e.isApi,e.privacyMode)),yield Promise.all(t)}))).apply(this,arguments)}const S=new o.WapParser("verifiedNameParser",(e=>(0,h.default)(e.child("verified_name"))));function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:(0,a.generateId)()},(0,a.wap)("verified_name",{jid:(0,g.DEVICE_JID)(e)})),r=yield(0,l.sendIq)(t,S);if(!r.success){if(404===r.errorCode)return void __LOG__(3)`verified name notification not found`;throw new Error("Could not send IQ in retrieveBusinessDetails")}return r.result}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){if("verified_name_hash"!==e.type)throw Error("Invalid notification type");const t=c.ContactCollection.resolveWidsFromHash(e.hash);if(!t)return!1;const r=yield Promise.all(t.map(function(){var e=(0,i.default)((function*(e){return{wid:e,verifiedName:yield v(e)}}));return function(){return e.apply(this,arguments)}}()));return r.length&&(yield Promise.all(r.map((t=>{let{wid:r,verifiedName:n}=t;if(n){const{name:t,level:i,serial:a,isApi:o,privacyMode:s}=n;return y({wid:r,verifiedName:t,level:i,stanzaId:e.stanzaId,ts:e.ts,serial:a,isApi:o,privacyMode:s})}if(void 0===n)return(0,u.handleBusinessRemoval)(r,e.stanzaId,e.ts)})))),!0}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){let{jid:t,stanzaId:r,ts:n,verifiedName:i}=e;const{serial:a="",level:o,isApi:s,privacyMode:l}=i;let d=i.name;var u;if(!d)if(null!=(null===(u=c.ContactCollection.get(t))||void 0===u?void 0:u.verifiedName)){var p;d=(null===(p=c.ContactCollection.get(t))||void 0===p?void 0:p.verifiedName)||""}else{const e=yield v(t);if(!e)return;d=e.name}return y({verifiedName:d,level:o,stanzaId:r,ts:n,wid:t,serial:a,isApi:s,privacyMode:l})}))).apply(this,arguments)}},96429:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessNotification=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(97760),d=r(91337),u=r(9961),p=r(80537),f=n(r(76199)),_=n(r(27874));const h=new s.WapParser("businessNotificationParser",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),from:e.attrString("from"),ts:e.attrTime("t")};let r;if(e.hasChild("remove"))return r=e.child("remove"),r.hasAttr("jid")?(0,a.default)({type:"remove_jid",jid:(0,l.chatJidToChatWid)(r.attrChatJid("jid"))},t):(0,a.default)({type:"remove_hash",hash:r.attrString("hash")},t);if(e.hasChild("verified_name"))return r=e.child("verified_name"),r.hasAttr("jid")?(0,a.default)({type:"verified_name_jid",jid:(0,l.chatJidToChatWid)(r.attrChatJid("jid")),verifiedName:(0,_.default)(r)},t):(0,a.default)({type:"verified_name_hash",hash:r.attrString("hash")},t);if(e.hasChild("profile")){const r=e.child("profile"),n=r.maybeAttrString("hash");if(n)return(0,a.default)({type:"profile_hash",hash:n},t);const i=(0,f.default)(r);return(0,a.default)({type:"profile",profile:i},t)}if(e.hasChild("product_catalog")){const r=e.child("product_catalog");if(r.hasChild("product")){const e=[];return r.forEachChildWithTag("product",(t=>{const r=t.child("id").contentString();e.push(r)})),(0,a.default)({type:"product",productsIds:e},t)}if(r.hasChild("collection")){const e=[],n=[];return r.forEachChildWithTag("collection",(t=>{if(t.hasChild("status_info")){var r,i;const a={reviewStatus:t.child("status_info").child("status").contentString(),rejectReason:null===(r=t.child("status_info").maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(i=t.child("status_info").maybeChild("commerce_url"))||void 0===i?void 0:i.contentString()};e.push(t.attrString("id")),n.push(a)}})),(0,a.default)({type:"collection",collectionIds:e,reviewStatuses:n},t)}}return(0,a.default)({type:"unknown"},t)}));function g(e,t,r){return r?(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:(0,o.CUSTOM_STRING)(t),class:"notification",type:"business"},(0,o.wap)("user",{side_list:"out"})):(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:(0,o.CUSTOM_STRING)(t),class:"notification",type:"business"})}function m(){return(m=(0,i.default)((function*(e){const t=h.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const r=t.success;switch(r.type){case"verified_name_hash":const e=yield(0,c.handleVerifiedBusinessNameNotificationHash)(r);return g(r.stanzaId,r.from,!e);case"verified_name_jid":return yield(0,c.handleVerifiedBusinessNameNotificationContact)(r),g(r.stanzaId,r.from,!1);case"remove_hash":const t=yield(0,u.handleBusinessRemovalNotificationHash)(r);return g(r.stanzaId,r.from,!t);case"remove_jid":return yield(0,u.handleBusinessRemovalNotificationContact)(r),g(r.stanzaId,r.from,!1);case"profile":return(0,d.handleBusinessProfile)(r),g(r.stanzaId,r.from,!1);case"profile_hash":const n=yield(0,d.handleBusinessProfileHash)(r);return g(r.stanzaId,r.from,!n);case"product":return yield(0,p.handleProductNotification)(r.productsIds),g(r.stanzaId,r.from,!1);case"collection":return yield(0,p.handleCollectionNotification)(r),g(r.stanzaId,r.from,!1);default:return g(r.stanzaId,r.from,!1)}}))).apply(this,arguments)}},91337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessProfileHash=t.handleBusinessProfile=void 0;var i=n(r(48926)),a=r(45454),o=r(93581),s=r(94010),l=r(19380),c=r(99234);t.handleBusinessProfile=e=>{let{from:t,profile:r}=e;const n=(0,a.createWidFromWidLike)(t),i=Boolean(o.BusinessProfileCollection.getValid(n)),l=(0,s.parseBusinessProfile)({id:n,profile:r,queryCatalog:!1}),d=o.BusinessProfileCollection.gaddUp(l);if(!i)return void(d.stale=!0);const u=(0,c.getMaybeMeUser)();n.equals(u)&&o.BusinessProfileCollection.fetchBizProfile(n)};const d=function(){var e=(0,i.default)((function*(e){let{hash:t}=e;const r=l.ContactCollection.resolveWidsFromHash(t);return!!r&&(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=Boolean(o.BusinessProfileCollection.getValid(e)),r=yield o.BusinessProfileCollection.update(e),n=Array.isArray(r)?r:[r];for(const e of n)t||(e.stale=!0)}));return function(){return e.apply(this,arguments)}}())),!0)}));return function(){return e.apply(this,arguments)}}();t.handleBusinessProfileHash=d},9961:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessRemoval=f,t.handleBusinessRemovalNotificationContact=function(){return g.apply(this,arguments)},t.handleBusinessRemovalNotificationHash=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(93170),o=r(19380),s=n(r(9762)),l=r(99069);function c(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=yield e.get(t.user);if(null!=r)return r.isBusiness=!1,r.verifiedLevel=0,r.verifiedName="",e.merge(t.user,r)}))).apply(this,arguments)}function u(e,t){return e.remove(t.user)}const p={isVerifiedHigh:!1,isBusiness:!1,isEnterprise:!1};function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=o.ContactCollection.get(e),r=t?{verifiedName:t.verifiedName,isVerifiedHigh:t.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:t.isBusiness,isEnterprise:t.isEnterprise,privacyMode:t.privacyMode}:p;yield(0,l.getStorage)().lock(["contact","verified-business-name"],(t=>{let[r,n]=t;return Promise.all([c(r,e),u(n,e)])}));const n=o.ContactCollection.get(e);return null!=n&&n.set({isBusiness:!1,verifiedLevel:null,verifiedName:null}),(0,s.default)(e,r,p)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){if("remove_hash"!==e.type)throw Error("Invalid notification type");const t=o.ContactCollection.resolveWidsFromHash(e.hash);return!!t&&(yield Promise.all(t.map((t=>f(t,e.stanzaId,e.ts)))),!0)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if("remove_jid"!==e.type)throw Error("Invalid notification type");yield f(e.jid,e.stanzaId,e.ts)}))).apply(this,arguments)}},80537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCollectionNotification=function(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(null==t?void 0:t.collections)for(let r=0;r<e.collectionIds.length;r++){const n=t.collections.get(e.collectionIds[r]);n&&n.set(e.reviewStatuses[r])}return Promise.resolve()},t.handleProductNotification=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(99989),o=r(99234);function s(){return(s=(0,i.default)((function*(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(t){const r=[];e.forEach((e=>{r.push(t.refreshProduct(e))})),yield Promise.all(r)}}))).apply(this,arguments)}},83558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=r(71914),a=r(81663),o=n(r(54248));const s=new i.WapParser("incomingChatStateParser",(e=>{let t;if(e.assertTag("chatstate"),e.hasChild("paused"))t="paused";else{if(!e.hasChild("composing"))return e.throw("Expected child of type paused or composing");t=e.child("composing").hasAttr("media")?"recording":"composing"}return{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,participant:e.hasAttr("participant")?(0,a.userJidToUserWid)(e.attrPhoneUserJid("participant")):void 0}}))},69277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=n(r(45095)),s=r(31914),l=r(71914),c=r(81663),d=n(r(65212)),u=r(45454),p=r(68638),f=r(69951),_=r(9995),h=r(99234),g=r(5819),m=r(68315),y=r(41601),E=r(37638),S=r(82350),v=r(46133);const T=new l.WapParser("incomingContactsNotification",(e=>{e.assertTag("notification");const t=e.attrString("id"),r={from:e.attrString("from"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:t};if(e.hasChild("update")){const t=e.child("update");return t.hasAttr("jid")?(0,a.default)({type:"update",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},r):(0,a.default)({type:"empty",jid:null},r)}if(e.hasChild("add")){const t=e.child("add");return(0,a.default)({type:"add",hash:t.hasContent()?t.contentBytes():null,jid:null},r)}if(e.hasChild("remove")){const t=e.child("remove");return(0,a.default)({type:"remove",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},r)}if(e.hasChild("modify")){const t=e.child("modify");return(0,a.default)({type:"modify",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("new")),oldJid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("old"))},r)}if(e.hasChild("sync")){const t=e.child("sync");return(0,a.default)({type:"sync",after:t.attrTime("after"),jid:null},r)}return __LOG__(3)`Unexpected "contacts" notification`,(0,a.default)({type:"empty",jid:null},r)}));function C(e,t){const r=function(e,t){if("modify"!==t.type)throw new Error("Error: genContactChangeNotificationMsg invalid type");{const r=(0,h.getMeUser)(),n=(0,o.default)(t.oldJid,"notification.oldJid"),i=(0,o.default)(t.jid,"notification.jid");return{id:new d.default({remote:e,fromMe:!1,id:d.default.newId()}),from:e,subtype:"change_number",t:t.ts,to:r,type:"notification_template",templateParams:[n,i]}}}(e,t);return(0,g.handleSingleMsgMD)(e,r)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){if(e.oldJid){const t=e.oldJid,r=e.jid,n=[];f.ChatCollection.get(t)&&n.push({id:t.toString(),changeNumberNewJid:r.toString(),changeNumberOldJid:void 0});f.ChatCollection.get(r)&&n.push({id:r.toString(),changeNumberNewJid:void 0,changeNumberOldJid:t.toString()}),(0,p.getTable)().bulkCreateOrMerge(n).then((()=>{n.forEach((e=>{const t=f.ChatCollection.get(e.id);t&&(t.changeNumberNewJid=e.changeNumberNewJid?(0,u.createWid)(e.changeNumberNewJid):void 0,t.changeNumberOldJid=e.changeNumberOldJid?(0,u.createWid)(e.changeNumberOldJid):void 0)}))})),yield Promise.all([C(t,e),C(r,e)])}else __LOG__(2)`notification.oldJid is null`;return Promise.resolve()}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=T.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.jid;switch(r.type){case"update":{if(!n)return __LOG__(3)`handleContactsNotification: an update command does not include jid`,i(r);const e=m.PresenceCollection.get(n);e&&e.reset();let t=Promise.resolve();const a=v.StatusCollection.get(n);a&&(a.set({status:""}),t=(0,S.getStatus)(n).then((e=>{a.set({status:e.status})})));const o=(0,E.changeProfilePicThumb)(r.jid,y.PROFILE_PIC_COMMAND.REMOVE);return Promise.all([o,t]).then((()=>i(r)))}case"modify":return yield A(r),i(r);case"sync":return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`received contact sync notification`,yield(0,_.contactSync)(),i(r);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${r.type}`,i(r)}function i(e,t){return(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e.stanzaId),to:(0,s.CUSTOM_STRING)(e.from),class:"notification",type:"contacts"},t)}}))).apply(this,arguments)}},27514:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_NOTIFICATION_TYPES=void 0,t.handleDevicesNotification=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(72441),c=r(45454),d=r(10823),u=n(r(69153)),p=r(7293),f=r(54181),_=r(28237),h=r(97153),g=r(84356),m=r(39410);const y={add:"add",remove:"remove",update:"update"};t.DEVICE_NOTIFICATION_TYPES=y;const E=new o.WapParser("incomingDevicesNotification",(e=>{e.assertTag("notification"),e.assertTag("notification"),e.assertAttr("type","devices");let t,r,n,i=[];if(e.hasChild("remove"))r=y.remove,t=e.child("remove");else if(e.hasChild("add"))r=y.add,t=e.child("add");else{if(!e.hasChild("update"))throw __LOG__(3)`Unknown Devices Notification: Devices notification without "remove" and "add" nodes`,new Error("Failed to parse devices notification");r=y.update,t=e.child("update")}if(r===y.add||r===y.remove){const e=t.maybeChild("key-index-list");if(!e)throw new Error("key index node is required to handle device add or remove notification");const a=e.attrTime("ts");if(r===y.remove&&!a)throw new Error("timestamp is required to handle device remove notification");n={ts:a,signedKeyIndexBytes:r===y.add?e.contentBytes():null};const o=t.child("device");i=[{id:(0,l.extractDeviceId)(o.attrPhoneDeviceJid("jid")),keyIndex:o.hasAttr("key-index")?o.attrInt("key-index"):null}]}return{type:r,stanzaId:e.attrString("id"),hash:t.attrString(r===y.update?"hash":"device_hash"),user:(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("from")),deviceList:i,keyIndex:n}}));function S(){return(S=(0,i.default)((function*(e){const t=E.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.user,i=(0,a.wap)("ack",{to:(0,m.USER_JID)(r.user),id:(0,a.CUSTOM_STRING)(r.stanzaId),class:"notification"});if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){if(!_.OfflineMessageHandler.isResumeFromRestartComplete())return u.default.addOfflinePendingDevice(n.toString(),i),"NO_ACK";if(_.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,h.addUserToPendingDeviceSync)([n.toString()]),i}const o={wid:n,devices:{deviceList:r.deviceList,keyIndex:r.keyIndex},type:r.type};if(r.type===y.add){try{yield(0,f.handleADVDeviceNotification)(o)}catch(e){__LOG__(3)`handleDevicesNotification - add error: ${e}`}return i}if(r.type===y.remove){try{var s;yield(0,f.handleADVDeviceNotification)(o);const e=(null===(s=r.deviceList)||void 0===s?void 0:s.map((e=>e.id)))||[];yield Promise.all(e.map((e=>{const t=(0,c.createDeviceWidFromUserAndDevice)(n.user,e);g.Voip.notifyDeviceIdentityChangedOrDeleted(t,!0)})))}catch(e){__LOG__(3)`handleDevicesNotification - remove error: ${e}`}return i}try{yield(0,d.syncDeviceListJob)([n],"notification",r.hash)}catch(e){__LOG__(3)`handleDevicesNotification - update error: ${e}`}return i}))).apply(this,arguments)}},81367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const r=t.success,i=(0,n.wap)("ack",{to:n.S_WHATSAPP_NET,id:(0,n.CUSTOM_STRING)(r.stanzaId),class:"notification"});return(0,a.digestKey)().then((()=>i))};var n=r(31914),i=r(71914),a=r(40376);const o=new i.WapParser("digestKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),e.child("digest").assertTag("digest"),{stanzaId:e.attrString("id")})))},58626:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(){return p.apply(this,arguments)}(t.success)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(91036),c=r(10435),d=r(39410);const u=new o.WapParser("disappearingModeNotification",(e=>{e.assertTag("notification");const t=e.child("disappearing_mode");return{stanzaId:e.attrString("id"),from:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),duration:t.attrInt("duration",0),ts:t.attrTime("t")}}));function p(){return(p=(0,i.default)((function*(e){let{duration:t,from:r,stanzaId:n,ts:i}=e;return __LOG__(2)`handleDisappearingModeNotification: received d=${t}:t=${i}
for ${r.toString()}`,(0,c.isDisappearingModeEnabled)()&&(yield(0,l.updateDisappearingMode)(r,t,i)),(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(n),to:(0,d.JID)(r),class:"notification",type:"disappearing_mode"})}))).apply(this,arguments)}},64054:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(24747),l=r(19518),c=r(29898),d=r(47221),u=r(42448),p=r(65044);const f=new a.WapParser("failureParser",(e=>(e.assertTag("failure"),{reason:e.attrInt("reason",400,599),location:e.attrString("location"),code:e.hasAttr("code")?e.attrInt("code"):null,expire:e.hasAttr("expire")?e.attrInt("expire"):null})));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);switch(t.success.reason){case 401:case 403:case 406:__LOG__(2)`received failure stanza, reason: ${t.success.reason}, logging out`,yield p.Socket.clearCredentialsAndStoredData(),o.Cmd.logout();break;case 405:case 409:__LOG__(2)`Client too old or bad user agent, attempting to update the app`;"web"===l.PLATFORMS[u.WAM_PLATFORM]?c.Updater.update(d.SANITIZED_VERSION_STR,!1,0):c.Updater.update(void 0,!1,0,!1),(0,s.stopComms)();break;case 402:const{code:e,expire:r}=t.success;if(null==e||null==r)throw __LOG__(4,void 0,new Error)`Incorrect temporary ban data ${e} ${r}`,new Error("handleFailure: wrong temp ban data");o.Cmd.onTemporaryBan({banned:!0,code:e,expire:r});break;case 400:case 500:case 501:__LOG__(3)`handleFailure: got failure code ${t.success.reason}`;break;default:return __LOG__(3)`failure reason ${t.success.reason} not implemented yet`,Promise.reject(new Error(`failure reason ${t.success.reason} not implemented yet`))}}))).apply(this,arguments)}},92419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotification=function(e){const t=I.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,{chatId:n,author:s,ts:l,pushname:c,externalId:d,actions:u,offline:p}=r,f=!!p&&!v.OfflineMessageHandler.isResumeFromRestartComplete(),_=(0,a.default)({chatId:n,author:s,ts:l,externalId:d},c?{pushname:c}:null);return(0,T.handleMessage)(n.toString(),f,(0,i.default)((function*(){return yield Promise.all(u.map((e=>function(){return U.apply(this,arguments)}(_,e,f)))),(0,o.wap)("ack",{to:(0,M.GROUP_JID)(r.chatId),id:(0,o.CUSTOM_STRING)(r.externalId),class:"notification",participant:s?(0,M.JID)(s):o.DROP_ATTR})})))};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(86945),d=r(68638),u=r(69951),p=r(22683),f=r(46920),_=r(99234),h=r(7293),g=r(57701),m=r(37654),y=r(64632),E=r(36098),S=r(34648),v=r(28237),T=r(15746),C=r(76214),A=n(r(29783)),b=r(5819),P=r(2182),M=r(39410);const O=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",LINK:"link"});const I=new s.WapParser("groupNotificationParser",(e=>{e.assertTag("notification"),e.hasAttr("to")&&e.assertAttr("to",(0,_.assertGetMe)().toJid());const t=(0,l.groupJidToWid)(e.attrGroupJid("from")),r=e.hasAttr("participant")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("participant")):null,n=e.attrTime("t");function i(e){return{participants:e.mapChildrenWithTag("participant",(e=>(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")))),prevVersion:e.hasAttr("prev_v_id")?e.attrInt("prev_v_id"):void 0,version:e.hasAttr("v_id")?e.attrInt("v_id"):void 0}}const o=e.mapChildren((e=>{const t=e.tag();switch(t){case O.CREATE:return function(e){const t=e.child("group"),r=t.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",f.GROUP_PARTICIPANT_TYPES,"participant");return{id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===f.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===f.GROUP_PARTICIPANT_TYPES.admin||t===f.GROUP_PARTICIPANT_TYPES.superadmin}})),n=function(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent())return{content:e.contentString(),id:t.attrString("id")}}}return null}(t),i=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(t),a=(0,P.extractLinkedParent)(t),o={subject:t.attrString("subject"),restrict:t.hasChild("locked"),announce:t.hasChild("announcement"),noFrequentlyForwarded:t.hasChild("no_frequently_forwarded"),ephemeralDuration:i?i.ephemeralDuration:void 0,owner:t.hasAttr("creator")?(0,l.userJidToUserWid)(t.attrPhoneUserJid("creator")):void 0,creation:t.attrTime("creation"),participants:r,desc:n?n.content:void 0,descId:n?n.id:void 0,subjectOwner:t.hasAttr("s_o")?(0,l.userJidToUserWid)(t.attrPhoneUserJid("s_o")):void 0,subjectTime:t.hasAttr("s_t")?t.attrTime("s_t"):void 0,support:t.hasChild("support"),pvId:t.attrInt("p_v_id"),parent:t.hasChild("parent"),parentGroup:a?a.parentGroup:void 0,defaultSubgroup:t.hasChild("default_sub_group")};return{action:O.CREATE,isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason"),groupInfo:o}}(e);case O.ADD:return(0,a.default)((0,a.default)({action:E.GROUP_ACTIONS.ADD},i(e)),{},{isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason")});case O.REMOVE:return(0,a.default)({action:O.REMOVE},i(e));case O.PROMOTE:return(0,a.default)({action:O.PROMOTE},i(e));case O.DEMOTE:return(0,a.default)({action:O.DEMOTE},i(e));case O.MODIFY:return(0,a.default)({action:E.GROUP_ACTIONS.MODIFY},i(e));case O.SUBJECT:return{action:E.GROUP_ACTIONS.SUBJECT,subject:e.attrString("subject"),s_o:e.hasAttr("s_o")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("s_o")):null,s_t:e.hasAttr("s_t")?e.attrTime("s_t"):null};case O.DESC:return e.hasChild("delete")?{action:E.GROUP_ACTIONS.DESC_REMOVE,descId:e.attrString("id")}:{action:E.GROUP_ACTIONS.DESC_ADD,descId:e.attrString("id"),desc:e.hasChild("body")?e.child("body").contentString():null,descTime:n};case O.SUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!0};case O.UNSUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!1};case O.LOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!0};case O.UNLOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!1};case O.ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!0};case O.NOT_ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!1};case O.NO_FREQUENTLY_FORWARDED:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!0};case O.FREQUENTLY_FORWARDED_OK:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!1};case O.INVITE:return{action:E.GROUP_ACTIONS.INVITE_CODE,code:e.attrString("code")};case O.EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:e.attrInt("expiration")};case O.NOT_EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:0};case O.REVOKE_INVITE:return{action:E.GROUP_ACTIONS.REVOKE_INVITE,participants:e.mapChildrenWithTag("participant",(e=>({id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),expiration:e.attrInt("expiration")})))};case O.GROWTH_UNLOCKED:return{action:E.GROUP_ACTIONS.GROWTH_UNLOCKED};case O.GROWTH_LOCKED:return{action:E.GROUP_ACTIONS.GROWTH_LOCKED,expiration:e.attrInt("expiration"),type:e.attrString("type")};case O.LINK:const r=e.attrString("link_type");return{action:{sub_group:E.GROUP_ACTIONS.SUB_GROUP_LINK,parent_group:E.GROUP_ACTIONS.PARENT_GROUP_LINK,sibling_group:E.GROUP_ACTIONS.SIBLING_GROUP_LINK}[r],groups:e.mapChildrenWithTag("group",(e=>(0,l.groupJidToWid)(e.attrGroupJid("jid"))))};default:throw new Error(`Unrecognized group action ${t}`)}}));return{externalId:e.attrString("id"),chatId:t,author:r,ts:e.attrTime("t"),pushname:e.hasAttr("notify")?e.attrString("notify"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,actions:o}}));function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const[t,r]=yield Promise.all([(0,y.getTable)().get(e.toString()),(0,d.getTable)().get(e.toString())]);return!!t||!!r&&!!r.t}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e,t){const r=yield(0,C.getParticipantTable)().get(e);return!!r&&r.admins.includes(t)}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t){var r;const n=yield(0,y.getTable)().get(e);return!!n&&n.growthLockType===t&&(null!==(r=n.growthLockExpiration)&&void 0!==r?r:0)>p.Clock.globalUnixTime()}))).apply(this,arguments)}function G(e,t){var r;const n=null===(r=u.ChatCollection.get(e))||void 0===r?void 0:r.groupMetadata;if(!n)return t;const i=n.participants;return t.filter((e=>!i.get(e)))}function U(){return(U=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;__LOG__(2,void 0,void 0,void 0,["groups"])`handle action ${t.action}`;const n=[];try{if(t.action===O.CREATE){const i=(0,a.default)((0,a.default)({},t.groupInfo),{},{id:e.chatId}),o=yield w(i.id);__LOG__(2,void 0,void 0,void 0,["groups"])`group id ${i.id} exists in storage = ${o}`,yield(0,S.handleGroupCreation)(e,i,r);const s=(0,_.getMaybeMeUser)();if(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreation done for group id ${i.id}`,o||n.push((0,m.genGroupCreationMsg)(e,i)),!s.equals(e.author)){const a={action:E.GROUP_ACTIONS.ADD,version:i.pvId,participants:[s],isInvite:t.isInvite};yield(0,S.handleGroupActionMD)(e,a,r),n.push((0,m.genGroupNotificationMsg)(e,a))}const{ephemeralDuration:l}=i;e.author&&null!=e.ts&&null!=l&&l>0&&n.push((0,m.genGroupEphemeralSettingMsg)(e.chatId,e.ts,e.author,l));const{parentGroup:c,defaultSubgroup:d}=i;if((0,g.communitiesEnabled)()&&null!=c&&!0!==d){const t={action:E.GROUP_ACTIONS.PARENT_GROUP_LINK,groups:[c]};n.push((0,m.genGroupNotificationMsg)(e,t))}}else if(t.action===E.GROUP_ACTIONS.ADD){const i=G(e.chatId,t.participants);yield(0,S.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i.length&&n.push((0,m.genGroupNotificationMsg)(e,(0,a.default)((0,a.default)({},t),{},{participants:i})))}else{const i=yield F(t,e.chatId);yield(0,S.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i||n.push((0,m.genGroupNotificationMsg)(e,t))}r?A.default.addOfflineMessage(n.map((e=>({msg:e})))):yield Promise.all(n.map((e=>(0,b.handleSingleMsgMD)(e.from,e))))}catch(e){__LOG__(2)`handleGroupNotification: failed with ${e}`}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,i.default)((function*(e,t){if(e.action===E.GROUP_ACTIONS.REVOKE_INVITE||e.action===E.GROUP_ACTIONS.SUSPEND)return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED||e.action===E.GROUP_ACTIONS.GROWTH_UNLOCKED){if(!(h.GK.supportsFeature(h.GK.F.MD_BACKEND)&&(0,c.getABPropConfigValue)("growth_lock_v0_enabled")))return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED){if("invite"!==e.type)return!0;if(yield L(t.toString(),e.type))return!0}const r=(0,_.getMaybeMeUser)();return!(yield D(t.toString(),r.toString()))}return!(e.action!==E.GROUP_ACTIONS.SUB_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.PARENT_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.SIBLING_GROUP_LINK||(0,g.communitiesEnabled)())}))).apply(this,arguments)}},19655:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistorySyncChunk=re,t.handleHistorySyncNotification=function(){return te.apply(this,arguments)};var a=i(r(81109)),o=i(r(48926)),s=r(52613),l=r(8584),c=r(72651),d=r(52230),u=r(8243),p=i(r(45095)),f=r(92844),_=i(r(65212)),h=i(r(89867)),g=r(45454),m=r(84902),y=r(86945),E=i(r(48277)),S=r(68638),v=r(63183),T=i(r(70257)),C=r(16116),A=r(88102),b=r(90257),P=r(19380),M=r(5087),O=r(24606),I=r(26384),w=r(24808),R=r(27856),D=r(99234),N=r(57701),L=r(41796),k=i(r(63928)),G=r(49714),U=r(41037),F=r(73027),x=r(49801),B=i(r(11339)),K=i(r(39436)),j=r(76214),Y=r(50313),W=r(5819),H=r(58052),V=i(r(57220)),$=r(13493),z=i(r(76128)),q=r(74727),J=i(r(61426)),Q=r(64551),X=r(27286),Z=r(93832),ee=i(r(56891));function te(){return(te=(0,o.default)((function*(e,t,r){if(!e)return;const{downloadOptions:n}=e;if(!n)return;const i=!!e.historySyncNotification.originalMessageId,o=i?e.historySyncNotification.originalMessageId:r,s={msgKey:new _.default({remote:t,fromMe:!0,id:o}).toString(),processed:0,downloadOptions:n,isReupload:1,historySyncStepStartedTs:(0,f.unixTimeMs)(),reuploadPending:!1,historySyncPayloadSize:e.historySyncNotification.fileLength};i&&e.historySyncNotification.syncType!==F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP||(s.syncType=e.historySyncNotification.syncType,s.chunkOrder=e.historySyncNotification.chunkOrder||0,s.isReupload=0);const l=s;switch(new B.default.MdBootstrapHistoryDataReceived({mdBootstrapPayloadType:l.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapHistoryPayloadType:de(l.syncType),mdTimestamp:(0,f.unixTimeMs)(),mdSessionId:yield x.MdSyncFieldStatsMeta.getMdSessionId()}).commit(),l.syncType){case F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP:case F.HistorySyncHistorySyncType.INITIAL_STATUS_V3:__LOG__(2)`[History sync initial sync received] ${oe(l)}`,re(l);break;case F.HistorySyncHistorySyncType.PUSH_NAME:return __LOG__(2)`[History sync initial pushname received] ${oe(l)}`,yield(0,U.enqueueNotification)((0,a.default)((0,a.default)({},l),{},{downloadOptions:(0,a.default)({},l.downloadOptions)}),!0),void re(l);default:__LOG__(2)`[History sync recent or full chunk received] adding chunk info to db: ${oe(l)}`,yield(0,U.enqueueNotification)(l)}E.default.continueProgressiveHistorySyncProcessing()}))).apply(this,arguments)}function re(){return ne.apply(this,arguments)}function ne(){return(ne=(0,o.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(__LOG__(2,void 0,void 0,void 0,["History sync"])`handleHistorySyncChunk started for ${oe(e)}`,e.syncType===F.HistorySyncHistorySyncType.INITIAL_STATUS_V3)try{const t=_.default.fromString(e.msgKey);(0,q.sendAggregateReceipts)(t.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,(new Map).set(t.remote,[t.id]))}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: sending Status v3 receipt failed`}const i=e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,S=new B.default.MdBootstrapHistoryDataDownloaded({mdBootstrapPayloadType:i,mdBootstrapPayloadSize:e.historySyncPayloadSize}),C=e.syncType!==F.HistorySyncHistorySyncType.PUSH_NAME&&!i;S.mdSessionId=yield x.MdSyncFieldStatsMeta.getMdSessionId();const N=yield x.MdSyncFieldStatsMeta.getStorageEstimation();N.mdStorageQuotaBytes!==x.STORAGE_QUOTA_UNAVAILABLE&&(S.mdStorageQuotaUsedBytes=N.mdStorageQuotaUsedBytes,S.mdStorageQuotaBytes=N.mdStorageQuotaBytes);let L=null;try{L=yield I.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new n).signal},e.downloadOptions))}catch(r){if(__LOG__(3)`history sync download failed`,r instanceof R.HttpNetworkError)return e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP&&t>0?(yield V.default.waitIfOffline({signal:(new n).signal}),__LOG__(3,void 0,void 0,void 0,["History sync"])`Initial sync download failed due to network error retry download`,re(e,t-1)):void(0,U.removeLocalFailureFromInFlightChunk)(e.msgKey);const i=_.default.fromString(e.msgKey);return se(S,e.historySyncStepStartedTs,!1),(0,J.default)(i.remote,i.id,e.downloadOptions.mediaKey),void(yield(0,U.markChunkForReuploadPending)(e.msgKey))}e.downloadOptions.mediaKey="",C&&(yield new Promise((e=>setTimeout(e,1e3)))),S.mdBootstrapStepResult=B.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS;const $=new l.Binary(L),ee=yield(0,c.inflate)($.readByteArray());C&&(yield new Promise((e=>setTimeout(e,1e3))));const te=(0,m.decodeProtobuf)(F.HistorySyncSpec,ee);__LOG__(2)`[History sync chunk downloaded], ${oe(e)}`,C&&(yield new Promise((e=>setTimeout(e,1e3))));const ne=new B.default.MdBootstrapDataApplied({mdBootstrapPayloadType:i,mdBootstrapSource:B.default.MD_BOOTSTRAP_SOURCE.HISTORY});if(ne.mdSessionId=yield x.MdSyncFieldStatsMeta.getMdSessionId(),e.syncType===F.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&te.statusV3Messages&&te.statusV3Messages.length>0?(S.mdBootstrapMessagesCount=te.statusV3Messages.length,se(S,e.historySyncStepStartedTs,!0),yield Promise.all(te.statusV3Messages.map(function(){var e=(0,o.default)((function*(e){const t={type:G.MESSAGE_TYPE.OTHER_STATUS,externalId:(0,p.default)(e.key.id,"msg.key.id"),ts:(0,f.castToUnixTime)(parseInt(e.messageTimestamp,10)),edit:-1,isHsm:!1,count:null,chat:(0,g.createWid)(d.STATUS_JID),author:!0===e.key.fromMe?(0,D.getMeUser)():(0,g.createWid)((0,p.default)(e.participant,"msg.participant")),pushname:null,isDirect:!1},r=yield(0,X.parseMessage)(t,"skmsg",(0,p.default)(e.message,"msg.message"),void 0),n=r.renderableMsgs&&r.renderableMsgs;if(!n||1!==n.length)return Promise.resolve();const i=n[0];return"0@s.whatsapp.net"!==e.participant||(0,y.getABPropConfigValue)("web_status_psa_history_sync")&&null!=i.staticUrl?(0,W.handleSingleMsgMD)(i.id.remote,i,!1):Promise.resolve()}));return function(){return e.apply(this,arguments)}}())),yield(0,U.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing Status V3 complete], ${oe(e,te.statusV3Messages.length)}`):e.syncType!==F.HistorySyncHistorySyncType.PUSH_NAME&&(te.conversations=te.conversations.reduce(((e,t)=>{let r=null;try{r=(0,g.createWid)(t.id)}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: invalid wid`}return r?e.concat(t):e}),[])),e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP){const t={},r=(0,D.assertGetMe)(),n=(0,g.toUserWid)(r),i=r.getDeviceId(),a={},o={},s=[];let l=0;const c=[];te.conversations.forEach((r=>{var d,p,f;let _=[];l+=r.messages.length;let m=[];r.messages.forEach(((n,i)=>{i===r.messages.length-1&&(t[r.id]=n.msgOrderId);const a=le(e,n.message);m.push(a),_=_.concat(ce(a))})),m=m.filter(Boolean).reverse(),r.pHash&&(o[r.id]=r.pHash);const E=(0,g.createWid)(r.id),S=r.contactPrimaryIdentityKey;if(S&&h.default.isUser(E)){const e=(0,Z.createSignalAddress)((0,g.toUserWid)(E)).toString(),t=(0,Z.bufferToStr)((0,M.toSignalCurvePubKey)(S));E.equals((0,D.getMeUser)())?ue(e,t):c.push({identifier:e,identityKey:t})}const T=(0,D.getGlobalSecurityNotifications)()&&!(0,y.getABPropConfigValue)("adv_v2_m6");if(!E.isStatusV3()&&T){const e=(0,b.genDeviceNotificationMsg)((0,g.createWid)(r.id),n,[i],[]);m.push(e)}let C;if(null!=(null===(d=r.disappearingMode)||void 0===d?void 0:d.initiator))switch(r.disappearingMode.initiator){case w.DisappearingModeInitiator.CHANGED_IN_CHAT:C=O.DisappearingModeInitiator.ChangedInChat;break;case w.DisappearingModeInitiator.INITIATED_BY_ME:C=O.DisappearingModeInitiator.InitiatedByMe;break;case w.DisappearingModeInitiator.INITIATED_BY_OTHER:C=O.DisappearingModeInitiator.InitiatedByOther}const A=null!=r.tcToken&&null!=r.tcTokenTimestamp,P={t:(0,u.maybeNumberOrThrowIfTooLarge)(null!==(p=r.conversationTimestamp)&&void 0!==p?p:r.lastMsgTimestamp),id:(0,g.createWid)(r.id),unreadCount:r.unreadCount,ephemeralDuration:r.ephemeralExpiration,ephemeralSettingTimestamp:r.ephemeralSettingTimestamp,disappearingModeInitiator:C,endOfHistoryTransferType:null!==(f=r.endOfHistoryTransferType)&&void 0!==f?f:v.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,name:r.name,notSpam:r.notSpam,pendingInitialLoading:!1,unreadMentionCount:r.unreadMentionCount,tcToken:A?r.tcToken:null,tcTokenTimestamp:A?r.tcTokenTimestamp:null};r.suspended&&k.default.add({id:P.id,suspended:!0},{merge:!1}),s.push(P),a[r.id]={chatInfo:P,msgs:m,reactionMessages:_}})),S.mdBootstrapMessagesCount=l,S.mdBootstrapChatsCount=te.conversations.length,se(S,e.historySyncStepStartedTs,!0),E.default.markInitialHistorySyncCountDebugStats(l,s.length);const d=te.conversations.some((e=>void 0!==e.unreadMentionCount));(0,D.setUnreadMentionCountEnabled)(d),yield z.default.bulkCreateIdentity(c),yield(0,T.default)([{cmd:"preempt",response:s,binarySize:10}])||Promise.resolve(),yield(0,W.handleInitialSyncMsgs)(a),yield(0,U.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(!0),__LOG__(2)`[History sync storing initial sync complete] ${oe(e,l,s.length)}`,yield fe(te),(0,Y.setHistoryInitialSyncBoundry)(t),(0,Y.setInitialGroupPhash)(o)}else if(e.syncType===F.HistorySyncHistorySyncType.PUSH_NAME){se(S,e.historySyncStepStartedTs,!0);const t=te.pushnames.map((e=>({id:e.id||"",pushname:e.pushname||""})));yield(0,j.getContactTable)().bulkCreateOrMerge(t),yield(0,U.updateCurrentlyProcessed)(e.msgKey);const r=te.pushnames.map((e=>{const t=(0,g.createWid)(e.id||""),r=P.ContactCollection.get(t);return{id:t,pushname:e.pushname||"",type:(null==r?void 0:r.type)||"out",name:null==r?void 0:r.name}}));P.ContactCollection.add(r,{merge:!0}),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing initial pushname complete] with ${te.pushnames.length} records`}else if(e.syncType!==F.HistorySyncHistorySyncType.INITIAL_STATUS_V3){yield new Promise((e=>setTimeout(e,0)));const t=[];let n=[];const i=new Set,a=[],o=(0,Y.getHistoryInitialSyncBoundry)();let l=0,c=0;for(let d=0;d<te.conversations.length;d++){const p=te.conversations[d],f=null==o?void 0:o[p.id];for(let o=0;o<p.messages.length;o++){const d=r(69951).ChatCollection.get((0,g.createWid)(p.id)),_=(null==d?void 0:d.endOfHistoryTransferType)===v.ConversationEndOfHistoryTransferModelPropType.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY;if(!d&&null!=f||d&&null==d.endOfHistoryTransferType||_){__LOG__(2,void 0,void 0,void 0,["History sync"])`One chat in sync payload ${oe(e)} is already marked as complete locally`;break}l++;const h=p.messages[o],m=(0,u.maybeNumberOrThrowIfTooLarge)(h.msgOrderId);if(null!=f&&null!=m&&m>=f)continue;i.add(p.id);const y=le(e,h.message);0===o&&y&&d&&0===d.msgs.length&&a.push(y),n=n.concat(ce(y)),y&&t.push(y),yield(0,s.asyncSleepAfterGivenLoopIteration)(c++,100)}}S.mdBootstrapMessagesCount=l,S.mdBootstrapChatsCount=te.conversations.length,se(S,e.historySyncStepStartedTs,!0),0!==t.length&&(yield(0,W.handleProgressiveHistorySyncMsgs)(t,Array.from(i),n,a)),(0,H.setLastHistorySycnedChunk)(e.syncType,e.chunkOrder),yield(0,U.updateCurrentlyProcessed)(e.msgKey);const d=new Set;te.conversations.forEach((e=>{d.add((0,g.createWid)(e.id).toString());const t=e.endOfHistoryTransferType;if(null!=t)return ie((0,g.createWid)(e.id),t)})),A.Cmd.onHistorySyncChunkProcessed(d),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync chunk storing recent or full chunk complete,  ${oe(e,l)}`}const ae=_.default.fromString(e.msgKey),de=new Map;var pe;de.set(ae.remote,[ae.id]),e.syncType!==F.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&(0,q.sendAggregateReceipts)(ae.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,de),yield(0,U.updateCurrentlyProcessed)(e.msgKey),Q.ServerProps.webMdMmsSyncDeletionRequest&&null!=e.downloadOptions.encFilehash&&K.default.deleteMdHistorySyncBlob({directPath:e.downloadOptions.directPath,encFilehash:e.downloadOptions.encFilehash,signal:(new n).signal}).catch((()=>{__LOG__(3)`MMS client delete error`})),pe=te.progress,e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?((0,H.setInitialHistorySyncComplete)(),(0,H.setHistorySyncStatus)({initialCompleted:!0}),A.Cmd.onInitialChatHistorySynced()):e.syncType===F.HistorySyncHistorySyncType.RECENT&&100===pe?(__LOG__(2,void 0,void 0,void 0,["History sync"])`Recent history sync complete`,(0,Y.setHistoryInitialSyncBoundry)({}),(0,H.setHistorySyncStatus)({recentCompleted:!0}),A.Cmd.onRecentChatHistorySynced()):e.syncType===F.HistorySyncHistorySyncType.FULL&&100===pe&&(__LOG__(2,void 0,void 0,void 0,["History sync"])`Full history sync complete`,(0,Y.setHistoryInitialSyncBoundry)({}),(0,H.setHistorySyncStatus)({fullCompleted:!0}),A.Cmd.onFullChatHistorySynced())}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,o.default)((function*(e,t){const r=t,n=(0,L.getBridge)();yield n.sendAndReceive("chat_collection","add",{things:[{id:e,endOfHistoryTransferType:r}],options:{merge:!0}}),yield(0,S.getTable)().merge(e.toString(),{endOfHistoryTransferType:r})}))).apply(this,arguments)}function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(e.msgKey||"").split("_")[2];return` type_${e.syncType}_order_${null!=e.chunkOrder?e.chunkOrder:"none"}_isReupload_${e.isReupload||0}}, id: ${n} ## msgCount: ${t}, chatCount: ${r}`}function se(e,t,r){e.mdTimestamp=(0,f.unixTimeMs)(),e.mdBootstrapStepDuration=(0,f.unixTimeMs)()-t,e.mdBootstrapStepResult=r?B.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:B.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,e.commit()}function le(e,t){let r=null;try{r=ee.default.parseWebMessageInfo(t,"after")}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMessageInfo failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return r}function ce(e){const t=[];try{(0,N.parseWMIReaction)()&&null!=e&&e.reactions.forEach((r=>{const{key:n,senderTimestampMs:i,text:a,unread:o}=r,s=(0,$.convertToTextWithoutSpecialEmojis)(null!=a?a:""),l=!!n.fromMe,c=(0,$.decodeJid)(n.remoteJid);let d;n.fromMe?c.isUser()||(d=(0,D.getMeUser)()):d=(0,$.decodeJid)(n.participant);const u=new _.default({id:n.id,fromMe:l,remote:c,participant:d}),p=(0,D.getMeUser)(),f=!0===l?p:d||c;null!=f&&f instanceof h.default?null==s?__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction:convertToTextWithoutSpecialEmojis reaction text is null.`:t.push({id:u,reactionTimestamp:i,reactionText:s,reactionParentKey:e.id,sender:f,unread:Boolean(o)}):__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction: reaction sender should be a wid.`}))}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMsgInfoReaction failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return t}function de(e){switch(e){case 0:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.INITIAL;case 1:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.STATUS_V3;case 2:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.FULL_HISTORY;case 3:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY;default:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.PUSHNAME}}function ue(){return pe.apply(this,arguments)}function pe(){return(pe=(0,o.default)((function*(e,t){const r=yield z.default.loadIdentityKey(e);r&&r!==t&&(__LOG__(4,void 0,new Error,!0,["history-sync"])`get changed self identity key from history sync,
exisiting length: ${r.length}, new length: ${t.length}`,SEND_LOGS("self-identity-change-from-history-sync"))}))).apply(this,arguments)}function fe(e){let t=Promise.resolve(),r=Promise.resolve();return null!=e.threadIdUserSecret&&(t=(0,C.setThreadIdUserSecret)(e.threadIdUserSecret)),null!=e.threadDsTimeframeOffset&&(r=(0,C.setThreadDsTimeframeOffset)(e.threadDsTimeframeOffset)),Promise.all([t,r])}},46462:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleE2eIdentityChange=function(e){const t=S.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{wid:r,stanzaId:n,delay:s,offline:l}=t.success,v=(0,o.wap)("ack",{to:(0,E.DEVICE_JID)(r),id:(0,o.CUSTOM_STRING)(n),class:"notification"});if(null!=r.device&&r.device!==a.DEFAULT_DEVICE_ID)return __LOG__(2)`handleNewIdentity: ignore identity change from companion device`,Promise.resolve(v);if(r.equals((0,c.getMeUser)()))return(0,u.handleSelfPrimaryIdentityChange)(),Promise.resolve(v);const T=!!l&&!d.OfflineMessageHandler.isResumeFromRestartComplete();return(0,f.handleMessage)(String(r),T,(0,i.default)((function*(){yield(0,u.clearDeviceRecordForIdentityChange)(r,T);return(yield(0,_.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(r).toString()))&&(__LOG__(2)`handleE2eIdentityChange: ${r.toString()} has old identity, establishing new session`,yield m.Session.deleteRemoteInfo(r),(0,h.addSecurityCodeChangedNotifications)(r,T),(0,g.sendTcTokenWhenDeviceIdentityChange)(r),T||(null!=s?(0,p.ensureE2ESessionsWithDelay)([r],s):(0,p.ensureE2ESessions)([r]))),v})))};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(71914),l=r(81663),c=r(99234),d=r(28237),u=r(1291),p=r(97398),f=r(15746),_=r(52083),h=r(9701),g=r(41088),m=r(77605),y=r(93832),E=r(39410);const S=new s.WapParser("identityChange",(e=>{e.assertTag("notification"),e.assertAttr("type","encrypt"),e.child("identity");const t=parseInt(e.maybeAttrString("delay"),10);return{wid:(0,l.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),stanzaId:e.attrString("id"),delay:isFinite(t)&&t>0?t:null,offline:e.hasAttr("offline")?e.attrString("offline"):null}}))},65341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_DIRTY_TYPE=t.SUPPORTED_DIRTY_PROTOCOLS=void 0,t.handleDirtyBits=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(41075),o=r(99609),s=r(88102),l=r(45606),c=n(r(69153)),d=r(99234),u=r(28237),p=n(r(11339)),f=r(97153),_=r(74028),h=r(38804);const g={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};t.SUPPORTED_DIRTY_TYPE=g;function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((e=>a.ACCOUNT_SYNC_TYPE.cast(e))).filter(Boolean);return 0===t.length&&(t=Array.from(a.ACCOUNT_SYNC_TYPE.members())),Promise.all(t.map((e=>e===a.ACCOUNT_SYNC_TYPE.DEVICES?S():e===a.ACCOUNT_SYNC_TYPE.PICTURE?(0,a.getAndUpdateProfilePicture)():void(e===a.ACCOUNT_SYNC_TYPE.PRIVACY?(0,a.updatePrivacySettings)():e===a.ACCOUNT_SYNC_TYPE.BLOCKLIST&&(0,a.updateBlocklist)()))))}function y(e){return null!=e.patches&&e.patches.length>0||null!=e.snapshot}function E(){return s.Cmd.once(s.APP_STATE_SYNC_COMPLETED,(e=>{const t=e.some(y);new p.default.MdAppStateDirtyBits({dirtyBitsFalsePositive:!t}).commit()})),(0,h.markCollectionsForSync)(Array.from(l.CollectionName.members()))}function S(){const e=String((0,d.getMeUser)());return u.OfflineMessageHandler.isResumeFromRestartComplete()?u.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()?(0,f.addUserToPendingDeviceSync)([e]):(0,a.getDevices)("notification"):(c.default.addOfflinePendingDevice(e,null),Promise.resolve())}function v(){return(v=(0,i.default)((function*(e){const{supported:t,unsupported:r,protocols:n}=e;__LOG__(2)`handleDirtyBits: handle dirty bits, supported: ${t.map((e=>e.type)).join(",")}, unsupported: ${r.map((e=>e.type)).join(",")}`;const i=[...r,...t];return yield Promise.all(t.map((e=>{const t=e.type;return t===g.groups?(0,_.queryAndUpdateAllGroupMetadata)():t===g.account_sync?m(n):t===g.syncd_app_state?E():void 0}))),(0,o.clearDirtyBits)(i)}))).apply(this,arguments)}t.SUPPORTED_DIRTY_PROTOCOLS={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist"}},86741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(65341),l=r(89816),c=r(25773),d=r(28237),u=r(70768),p=r(37222);const f=new a.WapParser("infoBulletinParser",(e=>{if(e.assertTag("ib"),e.assertFromServer(),e.hasChild(p.INFO_TYPE.DIRTY)){const t=[],r=[],n=[];return e.forEachChildWithTag(p.INFO_TYPE.DIRTY,(e=>{const i={type:e.attrString("type"),timestamp:e.attrInt("timestamp")};if("account_sync"===i.type){e.mapChildren((e=>e.tag())).forEach((e=>{s.SUPPORTED_DIRTY_PROTOCOLS.hasOwnProperty(e)&&n.push(e)})),r.push(i)}else s.SUPPORTED_DIRTY_TYPE.hasOwnProperty(i.type)?r.push(i):t.push(i)})),{type:p.INFO_TYPE.DIRTY,supported:r,unsupported:t,protocols:n}}if(e.hasChild(p.INFO_TYPE.ROUTING)){const t=e.child(p.INFO_TYPE.ROUTING);return{type:p.INFO_TYPE.ROUTING,edgeRouting:t.child("routing_info").contentBytes(),domain:t.hasChild("dns_domain")?t.child("dns_domain").contentEnum(l.DOMAINS):null}}if(e.hasChild(p.INFO_TYPE.DOWNGRADE))return{type:p.INFO_TYPE.DOWNGRADE};if(e.hasChild(p.INFO_TYPE.OFFLINE))return{count:e.child(p.INFO_TYPE.OFFLINE).attrInt("count"),type:p.INFO_TYPE.OFFLINE};if(e.hasChild(p.INFO_TYPE.OFFLINE_PREVIEW))return{count:{message:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:p.INFO_TYPE.OFFLINE_PREVIEW};if(e.hasChild(p.INFO_TYPE.TOS)){const t=[];return e.child("tos").forEachChildWithTag("notice",(e=>{t.push(e.attrString("id"))})),{type:p.INFO_TYPE.TOS,noticeIds:t}}return null}));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const r=t.success;if(r)switch(r.type){case p.INFO_TYPE.DIRTY:return yield(0,s.handleDirtyBits)(r),"NO_ACK";case p.INFO_TYPE.ROUTING:return(0,l.handleRoutingInfo)(r),"NO_ACK";case p.INFO_TYPE.DOWNGRADE:return o.Cmd.downgradeWebclient(),"NO_ACK";case p.INFO_TYPE.OFFLINE:return d.OfflineMessageHandler.setOfflineSessionComplete(r.count),(0,c.reportOfflineNotifications)(),"NO_ACK";case p.INFO_TYPE.OFFLINE_PREVIEW:return yield d.OfflineMessageHandler.setOfflineMessagePreviewCounter(r.count),"NO_ACK";case p.INFO_TYPE.TOS:return u.TosManager.maybeUpdateServer(r.noticeIds),"NO_ACK"}else __LOG__(3)`handleInfoBulletin unrecognized info bulletin`}))).apply(this,arguments)}},89816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.handleRoutingInfo=function(e){let t=e.domain;if(!t){const e=(0,i.getRoutingInfo)();t=e?e.domain:a.fb}const r=(0,n.bytesToBuffer)(e.edgeRouting);(0,i.setRoutingInfo)({domain:t,edgeRouting:r}),__LOG__(2)`handleInfoBulletin setting and domain: ${t} and edgeRouting:`};var n=r(87614),i=r(58052);const a={fb:"fb",sl:"sl"};t.DOMAINS=a},37222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFO_TYPE=void 0;const r=Object.freeze({DIRTY:"dirty",DOWNGRADE:"downgrade_webclient",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos"});t.INFO_TYPE=r},70605:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=n(r(45095)),s=r(31914),l=r(71914),c=r(99234),d=r(98969),u=r(16258),p=r(3151),f=r(39410);const _=new l.WapParser("mediaRetryNotification",(e=>{e.assertTag("notification");const t=e.maybeChild("error");if(t)return{msgId:e.attrString("id"),ciphertext:null,iv:null,errorCode:u.MediaRetryNotificationResultType.cast(t.attrInt("code"))};const r=e.child("encrypt");return{msgId:e.attrString("id"),ciphertext:r.child("enc_p").contentBytes(),iv:r.child("enc_iv").contentBytes(d.ENC_IV_SIZE),errorCode:null}}));function h(){return(h=(0,i.default)((function*(e){const t=_.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{msgId:r,errorCode:n}=t.success,i=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r),class:"notification",type:"mediaretry",to:(0,f.USER_JID)((0,c.getMeUser)())});if(null!=n)return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:n}),i;const{ciphertext:l,iv:u}=t.success,h=p.RequestMediaReuploadManager.getMediaKey(r);if(!h)return __LOG__(3)`handleMediaRetryNotification: mediaKey is not found for msgId ${r}`,i;const{stanzaId:g,directPath:m,result:y}=yield(0,d.decryptMediaRetryNotification)((0,a.decodeB64)(h),r,(0,o.default)(u,"iv"),(0,o.default)(l,"ciphertext"));if(g!==r)throw new Error("handleMediaRetryNotification: msg id does not match");return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:y,directPath:m}),i}))).apply(this,arguments)}},80278:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptE2EPayload=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(66751),s=r(15461),l=r(46308),c=r(58853),d=r(6303),u=r(8001),p=r(49714),f=r(12037),_=r(45033),h=r(84886),g=n(r(11339)),m=r(53348),y=r(52083),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),S=r(27286);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(e,t,r){const{e2eType:n,ciphertext:i}=e;switch(n){case _.CiphertextType.Skmsg:return t.isGroup()||t.isBroadcast()?r?E.Cipher.decryptGroupSignalProto(t,r,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`)):Promise.reject(new Error(`['messaging'] decryptEnc: Can not do skmsg for non group ${t.toString()}`));case _.CiphertextType.Pkmsg:case _.CiphertextType.Msg:const e=t.isUser()?t:r;return e?E.Cipher.decryptSignalProto(e,n,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`))}}function C(){return(C=(0,i.default)((function*(e){const{bizInfo:t,msgInfo:r,paymentInfo:n,deviceIdentity:_,encs:E}=e;if(null!=r.author.device&&0!==r.author.device){if(!(yield(0,l.validateADVwithEncs)(r.author,_,E,!!r.offline)))return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, validateADVIdentity failed`,{result:p.E2EProcessResult.RETRY,retryCount:E[0].retryCount}}const v=yield(0,o.promiseReduce)(e.encs,((e,o)=>{if(e.result!==p.E2EProcessResult.SUCCESS)return Promise.resolve(e);const l=(0,S.getFrom)(r),_=new g.default.E2eMessageRecv({e2eCiphertextType:(0,c.metricsCiphertextType)(o.e2eType),e2eCiphertextVersion:c.CIPHERTEXT_VERSION,e2eDestination:(0,c.metricsDestinationType)(l),e2eSuccessful:!1,messageMediaType:o.mediaType?(0,c.metricsMediaType)(o.mediaType):g.default.MEDIA_TYPE.NONE,retryCount:o.retryCount});return T(o,l,r.author).then(function(){var e=(0,i.default)((function*(e){_.e2eSuccessful=!0,_.weight=1e3,_.commit();const i={retryCount:o.retryCount,e2eType:o.e2eType,mediaType:o.mediaType,hideFail:o.hideFail};return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId} done`,yield(0,m.processDecryptedProto)(e,r,n,i,t),__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${r.externalId} done`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([u.SignalDecryptionError,d.UnknownMessageError],function(){var e=(0,i.default)((function*(e){return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ${e.toString()}`,_.weight=1,_.commit(),o.hideFail||(yield(0,m.processPlaceholderMsg)(r,p.PlaceholderType.E2E)),{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(u.SignalMessageCounterError,function(){var e=(0,i.default)((function*(e){if(__LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, signal counter error: ${e}`,null!=r.offline&&"peer"!==r.category){const e=(0,S.messageInfoToKey)(r),t=yield(0,h.getMsgByMsgKey)(e);if(null==t&&(__LOG__(4,void 0,new Error,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, creating placeholder (upload logs for debugging)`,SEND_LOGS("handleMsg: decryption counter error creating placeholder"),o.hideFail||(yield(0,m.processPlaceholderMsg)(r,p.PlaceholderType.E2E))),null==t||t.type===s.MSG_TYPE.CIPHERTEXT)return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, missing message for repeated signal counter`,{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ignore repeated signal counter`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(f.HsmMismatchError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: hsm mismatch error"),_.weight=1,_.commit(),{result:p.E2EProcessResult.HSM_MISMATCH})))).catch((0,a.filteredCatch)(d.ReactionValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: ReactionValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: parse decrypted message error"),_.weight=1,_.commit(),{result:p.E2EProcessResult.PARSE_ERROR})))}),{result:p.E2EProcessResult.SUCCESS});return yield(0,y.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),v}))).apply(this,arguments)}},6303:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageError=t.ReactionValidationError=t.DeviceSentMessageError=void 0;var i=r(40265),a=n(r(11339));class o extends((0,i.customError)("DeviceSentMessageError")){constructor(e,t){t===a.default.DSM_ERROR.MISSING_DSM?super("parseMessage: message should be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_SENDER?super("parseMessage: message should not be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_DSM?super("parseMessage: invalid deviceSentMessage"):super("parseMessage: unknown deviceSentMessage error"),new a.default.MdBadDeviceSentMessage({peerType:e,dsmError:t}).commit(),this.peerType=e,this.dsmError=t}}t.DeviceSentMessageError=o;class s extends((0,i.customError)("UnknownMessageError")){}t.UnknownMessageError=s;class l extends((0,i.customError)("ReactionValidationError")){}t.ReactionValidationError=l},49714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderType=t.MESSAGE_TYPE=t.HostStorageEnumType=t.E2EProcessResult=t.ActualActorsEnumType=void 0;const n=r(76672)({Self:1,Bsp:2});t.ActualActorsEnumType=n;const i=r(76672)({OnPremise:1,Facebook:2});t.HostStorageEnumType=i;const a=r(76672).Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR"]);t.E2EProcessResult=a;const o=r(76672).Mirrored(["E2E","FANOUT"]);t.PlaceholderType=o;const s=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});t.MESSAGE_TYPE=s},70569:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.incomingMsgParser.parse(e);if(t.error){const r=p.incomingMsgParserForAckOnly.parse(e);if(r.error)return Promise.reject(t.error);const{externalId:n,from:i,type:a}=r.success;return(0,_.sendAck)(n,i,a)}const r=t.success,{msgMeta:n,msgInfo:h}=r;h.clientReceivedTsMillis=(0,a.unixTimeMs)(),null!=h.offline&&(c.OfflineMessageHandler.addOfflinePendingMessage(),c.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete());c.OfflineMessageHandler.isResumeFromRestartComplete()&&delete r.msgInfo.offline;return(0,d.handleMessage)(h.chat.toString(),!!r.msgInfo.offline,(0,i.default)((function*(){if(h.msgProcessStartTsMillis=(0,a.unixTimeMs)(),n.isUnavailable&&(__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${h.externalId}, get fanout placeholder`,yield(0,f.processPlaceholderMsg)(h,s.PlaceholderType.FANOUT),(0,_.sendReceipt)(h,n,{result:s.E2EProcessResult.BACKFILL})),null!=h.offline){const e=yield c.OfflineMessageHandler.decryptOfflineMessage(r);e.result!==s.E2EProcessResult.SUCCESS||h.category===l.CATEGORY_PEER?(0,_.sendReceipt)(h,n,e):u.default.addOfflineMessage([{receiptInfo:{externalId:h.externalId,from:(0,_.getFrom)(h),author:h.author}}])}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${h.externalId}, start processing inline message`;const e=yield(0,o.decryptE2EPayload)(r);(0,_.sendReceipt)(h,n,e)}})))};var i=n(r(48926)),a=r(92844),o=r(80278),s=r(49714),l=r(12037),c=r(28237),d=r(15746),u=n(r(29783)),p=r(20365),f=r(53348),_=r(27286)},12037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAY_NODE_TYPES=t.MSG_VERIFIED_LEVEL=t.MSG_TYPES=t.HsmMismatchError=t.CATEGORY_PEER=void 0;var n=r(40265);t.MSG_TYPES={text:"text",media:"media",pay:"pay",reaction:"reaction"};t.MSG_VERIFIED_LEVEL={high:"high",low:"low",unknown:"unknown"};t.CATEGORY_PEER="peer";class i extends((0,n.customError)("HSMMismatchError")){}t.HsmMismatchError=i;t.PAY_NODE_TYPES={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"}},48616:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logReceivedMessagesInWAM=function(e,t,r,n,h){(function(e,t,r,n,o){const h=(0,a.unixTimeMs)();e.forEach((e=>{const a=new f.Msg(e),g=new p.default.MessageReceive((0,i.default)({messageType:a.getWamMessageType(),messageMediaType:a.getWamMediaType(),messageIsInternational:a.isInternational,messageIsOffline:t,isViewOnce:Boolean(a.isViewOnce)},(0,u.getGroupMetricsFromChatWid)(a.from)));if(a.from.isGroup()){var m;const e=null===(m=d.default.get(a.from))||void 0===m?void 0:m.cachedDeviceSizeBucket;null!=e&&(g.deviceSizeBucket=e)}else{const e=(0,c.getDisappearingModeSettingForUser)(a.from);null!=e&&(g.senderDefaultDisappearingDuration=e.duration);const t=(0,l.getMaybeMeUser)(),r=(0,c.getDisappearingModeSettingForUser)(t);null!=r&&(g.receiverDefaultDisappearingDuration=r.duration)}null!=n&&(g.messageReceiveT0=n-r,g.messageReceiveT1=h-n,null!=o&&(g.messageQueueTime=o-n)),null!=a.ephemeralDuration&&a.ephemeralDuration>0&&(g.ephemeralityDuration=a.ephemeralDuration);const y=a.getWamDisappearingModeInitiator();if(null!=y&&(g.disappearingChatInitiator=y),g.commit(),a.chat&&!a.isSentByMe)if((0,s.shouldBlockByCountry)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.COUNTRY}).commit()}else if((0,_.shouldBlockByTos)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.TOS3}).commit()}}))})(e,t,r,n,h),function(e){(0,o.handleActivitiesForChatThreadLogging)(e.map((e=>({activityType:e.id.fromMe?"msgSend":"msgReceive",ts:e.t,chatId:e.id.remote,isViewOnce:e.isViewOnce}))))}(e)};var i=n(r(81109)),a=r(92844),o=r(16116),s=r(47473),l=r(99234),c=r(28307),d=n(r(63928)),u=r(42515),p=n(r(11339)),f=r(17304),_=r(37894)},20365:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.incomingMsgParserForAckOnly=t.incomingMsgParser=void 0;var i=n(r(81109)),a=r(71914),o=r(81663),s=r(45454),l=r(2599),c=r(99234),d=r(49714),u=r(12037),p=r(45033),f=r(75295),_=r(52586),h=r(27286),g=r(21224);const m=new a.WapParser("incomingMsgParser",(e=>{e.assertTag("message"),e.hasAttr("to")&&e.assertAttr("to",(0,c.assertGetMe)().toJid());const t=e.mapChildrenWithTag("enc",(e=>({e2eType:e.attrEnumValues("type",p.CiphertextType.members()),mediaType:p.MediaType.cast(e.maybeAttrString("mediatype")),ciphertext:e.contentBytes(),retryCount:e.hasAttr("count")?e.attrInt("count"):0,hideFail:"hide"===e.maybeAttrString("decrypt-fail")}))),r=e.maybeChild("device-identity"),n=r?r.contentBytes():null,a=function(e,t){const r={externalId:e.attrString("id"),ts:e.attrTime("t"),edit:e.hasAttr("edit")?e.attrInt("edit"):-1,isHsm:e.hasChild("hsm"),count:e.hasAttr("count")?e.attrInt("count"):null,pushname:e.hasAttr("notify")?e.attrString("notify"):null,category:e.hasAttr("category")?e.attrString("category"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},n=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),a=e.hasAttr("participant")?(0,o.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,l=e.hasAttr("recipient")?(0,o.userJidToUserWid)(e.attrPhoneUserJid("recipient")):null,c=t.every((e=>e.e2eType!==p.CiphertextType.Skmsg)),u=t.some((e=>e.retryCount>0));let f;const _={},g=e.maybeChild("participants");if(g){const e=[];g.forEachChildWithTag("to",(t=>{const r=(0,o.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("jid")),n=t.maybeAttrString("eph_setting");e.push(r),null!=n&&(_[r.toString()]=n)})),f=e}if(n.isUser())return null!=l?(0,h.isPeer)(n)?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},r),{},{chat:(0,s.toUserWid)(l),author:n}):e.throw("recipient on non peer chat message"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},r),{},{chat:(0,s.toUserWid)(n),author:n});if(n.isGroup())return null==a?e.throw("group message with no participant"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.GROUP},r),{},{chat:n,author:a,isDirect:c});if(n.isBroadcast()&&!n.isStatusV3()){if(null==a)return e.throw("broadcast message with no participant");if((0,h.isPeer)(a)){if(null==f){if(!u)return e.throw("peer broadcast message with no participants node");f=[]}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.PEER_BROADCAST},r),{},{chat:n,author:a,isDirect:c,bclParticipants:f,bclHashValidated:!1,bclEphSettings:_})}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_BROADCAST},r),{},{chat:n,author:a,isDirect:c,ephSetting:e.maybeAttrString("eph_setting")})}if(n.isBroadcast()&&n.isStatusV3())return null==a?e.throw("status message with no participant"):(0,h.isPeer)(a)&&c?null==f?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,isDirect:c}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,bclParticipants:f,bclHashValidated:!1}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_STATUS},r),{},{chat:n,author:a,isDirect:c});return e.throw("Unrecognized message type")}(e,t);return{encs:t,msgInfo:a,msgMeta:function(e,t){const r=e.hasChild("unavailable");r||0!==t.length||e.throw("incomingMsgParser: to have enc node children");return{isUnavailable:r,type:e.attrEnum("type",u.MSG_TYPES),rawTs:e.attrString("t"),urlNumber:e.hasChild("url_number"),urlText:e.hasChild("url_text")}}(e,t),bizInfo:function(e){const t=e.hasChild("verified_name")?e.child("verified_name").contentBytes():null,r=e.attrEnumOrDefault("verified_level",u.MSG_VERIFIED_LEVEL,null),n=e.hasAttr("verified_name")?e.attrInt("verified_name"):-1,i=e.maybeChild("biz");let a=null;if(null!=i){const e=d.ActualActorsEnumType.cast(i.maybeAttrInt("actual_actors")),t=d.HostStorageEnumType.cast(i.maybeAttrInt("host_storage")),r=i.maybeAttrInt("privacy_mode_ts");null!=e&&null!=t&&null!=r&&(a={actualActors:e,hostStorage:t,privacyModeTs:r})}const o=null==i?void 0:i.maybeAttrString("native_flow_name");return{verifiedNameCert:t,verifiedLevel:r,verifiedNameSerial:n,privacyMode:a,nativeFlowName:o}}(e),paymentInfo:function(e){let t=null;const r=e.hasChild("pay")?e.child("pay"):null,n=e.hasChild("transaction")?e.child("transaction"):null,i=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")).isGroup(),a=e.hasAttr("participant")?(0,o.jidWithTypeToWid)(e.attrJidWithType("participant")):null;if((0,f.isNoviTransaction)(r)||(0,f.isNoviTransaction)(n))t={futureproofed:!0};else if(n){const e=(0,f.parseTransactionNode)(n);e&&(t=y(i,a,(0,s.createWid)(e.receiver.toString()))?{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:(0,_.getPaymentTxnWebStatus)(e.status)}:{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(r){switch(r.attrEnum("type",u.PAY_NODE_TYPES)){case u.PAY_NODE_TYPES.send:const{amount1000:n,currency:o}=(0,l.getAmount1000AndCurrency)(r),c=r.hasAttr("receiver")?r.attrString("receiver"):e.attrString("recipient");t=y(i,a,(0,s.createWid)(c))?{receiverJid:c,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t"),txnStatus:g.PaymentInfoTxnStatus.INIT}:{receiverJid:c,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t")};break;case u.PAY_NODE_TYPES.request:case u.PAY_NODE_TYPES.invite:}}return t}(e),deviceIdentity:n}}));function y(e,t,r){if(e&&null!=t&&null!=r){const e=(0,c.getMeUser)();if(!e.equals(t)&&!e.equals(r))return!1}return!0}t.incomingMsgParser=m;const E=new a.WapParser("incomingMsgParserForAckOnly",(e=>(e.assertTag("message"),{externalId:e.attrString("id"),from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),type:e.attrEnum("type",u.MSG_TYPES)})));t.incomingMsgParserForAckOnly=E},53348:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createReactionsRow=Q,t.processDecryptedProto=function(){return H.apply(this,arguments)},t.processPlaceholderMsg=function(){return z.apply(this,arguments)},t.processReactionMsg=q,t.processRenderableMsg=V,t.storeReactionMsgBulk=function(e){const t=e.map((e=>(0,s.webMsgInfoReactionTypeToReactionsRow)(e)));return t.map((e=>`${e.msgKey.toString()} to ${e.parentMsgKey}`)).toString(),(0,G.addOrUpdateReactionsDBBulk)(t)};var i=n(r(81109)),a=n(r(48926)),o=r(15461),s=r(67811),l=n(r(89867)),c=r(45454),d=r(84902),u=r(78027),p=r(10823),f=n(r(69153)),_=r(24808),h=r(6303),g=r(99234),m=r(9025),y=n(r(39505)),E=r(57701),S=r(19655),v=r(65582),T=r(82568),C=r(49714),A=r(12037),b=r(39354),P=r(65414),M=r(48616),O=r(84886),I=n(r(11339)),w=(r(17304),n(r(29783))),R=r(5819),D=r(60629),N=r(55552),L=r(30849),k=r(16150),G=r(76332),U=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=W(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),F=r(26704),x=n(r(83147)),B=r(66167),K=r(93832),j=r(27286),Y=r(22695);function W(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(W=function(e){return e?r:t})(e)}function H(){return(H=(0,a.default)((function*(e,t,r,n,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=a?(0,K.unpad)(e):new Uint8Array(e),l=(0,d.decodeProtobuf)(_.MessageSpec,s);if(null==t.offline&&__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${t.externalId}, message decrypted: `,!t.isHsm&&l.highlyStructuredMessage)throw new A.HsmMismatchError;const u=(0,j.getFrom)(t);if(!(yield(0,Y.isFromKnownDevice)(t.author))){const e=(0,c.toUserWid)(t.author);throw null==t.offline?(0,p.syncDeviceListJob)([e],null,null):f.default.addOfflinePendingDevice(String(e),null),new h.UnknownMessageError(`[messaging] msgId::${t.externalId}, processDecryptedProto: reject message from unknown device`)}if(t.type===C.MESSAGE_TYPE.PEER_BROADCAST&&n.retryCount>0){const e=yield(0,O.getMsgByMsgKey)((0,j.messageInfoToKey)(t));null!=(null==e?void 0:e.broadcastParticipants)&&(t.bclParticipants=e.broadcastParticipants,null!=e.broadcastEphSettings&&(t.bclEphSettings=e.broadcastEphSettings))}l.messageContextInfo&&(0,P.handleICDCData)(t.author,t.chat.isUser()?t.chat:null,l.messageContextInfo);const m=yield(0,j.parseMessage)(t,n.e2eType,l,r,i,e),y=[];if(m.history)(0,S.handleHistorySyncNotification)(m.history,u,t.externalId);else if(m.securityNotificationEnabled)(0,g.setGlobalSecurityNotifications)(m.securityNotificationEnabled.isEnabled);else if(m.appStateSyncKeyShare)(0,T.handleAppStateSyncKeyShare)(m.appStateSyncKeyShare,u);else if(m.appStateSyncKeyRequest)(0,v.handleAppStateSyncKeyRequest)(m.appStateSyncKeyRequest,u);else{var b;let e=!1;if(null==m.deviceSent?e=!0:m.deviceSent.phash?e=yield(0,Y.validateBclHash)(m.deviceSent.phash,m.deviceSent.info):m.deviceSent.destination&&(e=yield(0,Y.validateMsgDestination)(m.deviceSent.destination,t)),!e)throw new h.DeviceSentMessageError((0,j.getDeviceType)(t.author),I.default.DSM_ERROR.INVALID_DSM);if((0,E.receiveReactionsEnabled)()&&(null===(b=m.renderableMsgs[0])||void 0===b?void 0:b.type)===o.MSG_TYPE.REACTION)y.push(q(m.renderableMsgs[0],t));else{const e=n.retryCount>0&&(0,j.placeholderCheck)(t);y.push(V(m.renderableMsgs,t,r,i,e)),null!=m.storeMsg&&(0,O.storeMessages)([m.storeMsg],m.storeMsg.id.remote)}null!=m.senderKey&&y.push(U.Session.createGroupSignalSession(t.author,m.senderKey.groupId,m.senderKey.key)),t.pushname&&(0,k.updatePushname)(t.author,t.pushname),yield Promise.all(y),(0,M.logReceivedMessagesInWAM)(m.renderableMsgs,null!=t.offline,1e3*t.ts,t.clientReceivedTsMillis,t.msgProcessStartTsMillis)}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,n,s,c){try{const n=(0,y.default)(t,s),d=null==n?e:e.map((e=>(0,i.default)((0,i.default)({},e),{},{privacyModeWhenSent:n})));if(t.offline)return void w.default.addOfflineMessage(d.map((e=>({msg:e}))));const p=t.chat,f=r(69951).ChatCollection,_=p.isUserNotPSA(),h=_&&null==f.get(p),E=(0,L.getLatestPrivacyMode)(s.privacyMode,(0,L.getContactPrivacyMode)(p));try{if(_){const t=yield(0,m.getExisting)(p);if(null==t){const t=e[0];yield(0,D.createChatOnNewMsg)(p,t,E)}else null!=E&&(yield(0,b.handlePrivacyModeTransition)(p,E,t))}}catch(e){const t="";__LOG__(4,void 0,new Error,!0,["messaging"])`createChatOnNewMsg or handlePrivacyModeTransition ${t} failed with error: ${e}`,SEND_LOGS("createChatOnNewMsg or handlePrivacyModeTransition failed")}if(yield Promise.all(d.map(function(){var e=(0,a.default)((function*(e){yield(0,R.handleSingleMsgMD)(e.id.remote,e,c),(0,u.processOrphanAck)(e.id).catch((e=>{__LOG__(2)`processOrphanAck: msgId::${t.externalId}, failed with error: ${e}`,__LOG__(3,void 0,void 0,void 0,["messaging"])`processOrphanAck: failed`})),e.type===o.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,N.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),h&&(0,B.queryAndUpdateContactPropertiesOnNewChat)(p),_&&!l.default.equals((0,g.getMaybeMeUser)(),t.author)&&null!=E){const e=r(59871).MsgCollection;Promise.all(d.map((t=>{const r=e.get(t.id);if(r)return(0,x.default)(r,E)})))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMsg: msgId::${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e,t){if(e.category!==A.CATEGORY_PEER)try{const r=yield(0,j.genPlaceholderMsg)(e,t);e.offline?w.default.addOfflineMessage(r.map((e=>({msg:e})))):yield Promise.all(r.map(function(){var e=(0,a.default)((function*(e){const t=e.id.remote;yield(0,R.handleSingleMsgMD)(t,e)}));return function(){return e.apply(this,arguments)}}()))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}else __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, skip placeholder for peer message ${e.externalId}`}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(t.offline){const r={msg:e,receiptInfo:{from:e.from,author:t.author}};return void w.default.addOfflineMessage([r])}const r=yield Q(e,t);if(r)return String(e.id),String(e.reactionParentKey),(0,G.addOrUpdateReactions)(r,!0)}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e,t){var r;const n=yield(0,O.getMsgByMsgKey)(e.reactionParentKey);let i,a=0;n||(a=1,i=F.OrphanReactionsReasonType.ParentMsgMissing),(null==n?void 0:n.type)===o.MSG_TYPE.CIPHERTEXT&&(a=1,i=F.OrphanReactionsReasonType.ParentMsgPlaceholder);const l=t.author;if(n&&n.type!==o.MSG_TYPE.CIPHERTEXT&&!(0,s.canHaveReactions)(n.type))return __LOG__(3)`createReactionsRow: reactions not allowed for this message type ${n.type}`,Promise.resolve();const d=(0,c.toUserWid)(l);return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:d.toString(),reactionText:null!==(r=e.reactionText)&&void 0!==r?r:s.REVOKED_REACTION_TEXT,timestamp:e.reactionTimestamp,orphan:a,orphanReason:i,read:!1}}))).apply(this,arguments)}},27286:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPlaceholderMsg=function(){return F.apply(this,arguments)},t.generateBaseMsg=x,t.getDeviceType=W,t.getFrom=H,t.isPeer=j,t.messageInfoToKey=Y,t.parseMessage=function(){return M.apply(this,arguments)},t.placeholderCheck=U,t.sendAck=function(e,t,r){return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:t?(0,P.JID)(t):s.DROP_ATTR,type:r})))},t.sendReceipt=function(e,t,r){const{externalId:n}=e,{rawTs:i,type:a}=t,o=H(e),l=e.type===y.MESSAGE_TYPE.CHAT&&j(e.author)?e.chat:null,c=e.type===y.MESSAGE_TYPE.CHAT?null:e.author,d=e.category===E.CATEGORY_PEER;switch(r.result){case y.E2EProcessResult.SUCCESS:return(0,A.sendDeliveryReceiptsAfterDecryption)(n,o,l,c,d,a);case y.E2EProcessResult.HSM_MISMATCH:return Promise.resolve();case y.E2EProcessResult.RETRY:const e=null==r.retryCount?1:r.retryCount+1;return(0,b.sendRetryReceipt)(e,o,c,l,n,i,d);case y.E2EProcessResult.PARSE_VALIDATION_ERROR:return(0,A.sendDeliveryReceiptsAfterDecryption)(n,o,l,c,d,a),Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})));default:return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})))}};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(31914),l=r(35470),c=n(r(65212)),d=r(15461),u=n(r(89867)),p=r(45454),f=r(24747),_=r(47343),h=r(6303),g=r(7003),m=r(99234),y=r(49714),E=r(12037),S=r(45033),v=r(84886),T=n(r(11339)),C=r(13493),A=r(16927),b=r(55253),P=r(39410);function M(){return(M=(0,a.default)((function*(e,t,r,n,i){var a,o,s,l;let c,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(null!=(null===(a=r.protocolMessage)||void 0===a?void 0:a.historySyncNotification)){c={history:(0,C.parseMsgProto)(r,x(e),"relay",n,void 0,void 0,i).historySyncMetaData}}else if(null!=(null===(o=r.protocolMessage)||void 0===o?void 0:o.initialSecurityNotificationSettingSync)){var u;c={securityNotificationEnabled:{isEnabled:null===(u=r.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)||void 0===u||u}}}else if(null!=(null===(s=r.protocolMessage)||void 0===s?void 0:s.appStateSyncKeyShare))c={appStateSyncKeyShare:r.protocolMessage.appStateSyncKeyShare};else if(null!=(null===(l=r.protocolMessage)||void 0===l?void 0:l.appStateSyncKeyRequest))c={appStateSyncKeyRequest:r.protocolMessage.appStateSyncKeyRequest};else switch(e.type){case y.MESSAGE_TYPE.CHAT:c=j(e.author)?yield O(e,r,n,i,d):yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.GROUP:c=j(e.author)&&e.isDirect?yield O(e,r,n,i,d):yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.PEER_BROADCAST:if(t===S.CiphertextType.Skmsg){if(!e.bclHashValidated)throw new Error("parseMessage: participants for peer broadcast message is not validated");c=yield D(e,r,n,i,d)}else c=yield w(e,r,n,i,d);break;case y.MESSAGE_TYPE.OTHER_BROADCAST:c=yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.DIRECT_PEER_STATUS:c=e.isDirect?yield O(e,r,n,i,d):yield w(e,r,n,i,d);break;case y.MESSAGE_TYPE.OTHER_STATUS:c=yield D(e,r,n,i,d);break;default:throw new Error("Unrecognized MESSAGE_TYPE")}return c}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:o}=t;if(null==o)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.destinationJid)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{destinationJid:s}=o,l=yield L(e,o.message,r,n,a);return(0,i.default)({deviceSent:{destination:(0,p.createWid)(s)}},l)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:o}=t;if(null==o)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.phash)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{phash:s}=o,l=yield L(e,o.message,r,n,a);return(0,i.default)({deviceSent:{phash:s,info:e}},l)}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t,r,n,a){if(null!=t.deviceSentMessage)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_SENDER);const o=yield L(e,t,r,n,a);return(0,i.default)({deviceSent:null},o)}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t,r,n,a){var o;if(null==t)return{senderKey:null,storeMsg:null,renderableMsgs:[]};let s=(0,C.parseMsgProto)(t,x(e),"relay",r,void 0,void 0,n,e.edit);s=(0,i.default)((0,i.default)({},s),yield(0,g.genDirectConnectionMessageModifiers)(s.type,null===(o=s.list)||void 0===o?void 0:o.listType,s.businessOwnerJid));const l=null!=t.senderKeyDistributionMessage?G(e,t.senderKeyDistributionMessage):null,c=s.type===d.MSG_TYPE.UNKNOWN&&null==l,u=s.type===d.MSG_TYPE.UNKNOWN&&null!=l;let p=null;if(c&&(s.futureproofBuffer=a),e.type===y.MESSAGE_TYPE.OTHER_STATUS&&(s.campaignId=e.campaignId,s.campaignDuration=e.campaignDuration),e.type===y.MESSAGE_TYPE.PEER_BROADCAST&&(s.broadcastId=e.chat,s.broadcastParticipants=e.bclParticipants,s.broadcastEphSettings=e.bclEphSettings,p=s),e.type===y.MESSAGE_TYPE.OTHER_BROADCAST){s.broadcastId=e.chat;const t=e.ephSetting,r=s.ephemeralSharedSecret;if(null!=t&&null!=r){const{ephemeralDuration:n,ephemeralSettingTimestamp:i}=yield(0,_.decodeBroadcastEphemeralSetting)(e.chat,(0,m.getMeUser)(),e.author,t,r);s.ephemeralDuration=n,s.ephemeralSettingTimestamp=i}}let f=[];return u||(e.type===y.MESSAGE_TYPE.PEER_BROADCAST?f=yield B(s,e.bclParticipants,e.bclEphSettings):("payment_transaction_request_cancelled"!==s.subtype&&"payment_action_request_declined"!==s.subtype||null!=s.paymentRequestMessageKey)&&"non_renderable"!==s.subtype&&(f=[s])),{senderKey:l,storeMsg:p,renderableMsgs:f}}))).apply(this,arguments)}function G(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw new Error("should not have senderkey");const{groupId:r,axolotlSenderKeyDistributionMessage:n}=t;if(null==r||e.chat.toString({legacy:!0})!==r)throw new Error(`senderKeyDistributionMessage: from ${e.chat.toString()} mismatched to ${r||"null"}`);if(!n)throw new Error(`senderKeyDistributionMessage: from ${e.author.toString()} has no content`);return{groupId:r,key:n}}function U(e){return e.edit!==l.EDIT_ATTR.SENDER_REVOKE||e.type===y.MESSAGE_TYPE.PEER_BROADCAST}function F(){return(F=(0,a.default)((function*(e,t){if(!U(e))return[];const r=x(e);if(t===y.PlaceholderType.E2E?r.type=d.MSG_TYPE.CIPHERTEXT:(r.type=d.MSG_TYPE.CIPHERTEXT,r.subtype="fanout"),e.type===y.MESSAGE_TYPE.PEER_BROADCAST){if(r.broadcastParticipants=e.bclParticipants,r.broadcastEphSettings=e.bclEphSettings,(0,v.storeMessages)([r],r.id.remote),e.edit===l.EDIT_ATTR.SENDER_REVOKE)return[];return yield B(r,e.bclParticipants)}return[r]}))).apply(this,arguments)}function x(e){const t=Y(e),r=(0,m.getMeUser)(),n={id:t,from:t.fromMe?r:t.remote,to:t.fromMe?t.remote:r,type:d.MSG_TYPE.UNKNOWN,t:e.ts||0,ack:l.ACK.SENT,author:!t.fromMe&&u.default.isGroup(t.remote)||u.default.isStatusV3(t.remote)?t.participant:void 0,broadcast:!1,notifyName:e.pushname||""};return null!=e.count&&(n.count=e.count),n}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,r){return(yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){let n,a,o;try{n=new c.default({remote:t,fromMe:!0,id:e.id.id})}catch(e){return __LOG__(3)`drop: cannot create MsgKey: ${e.stack}`,null}const s=r?r[t.toString()]:null,l=e.ephemeralSharedSecret,d=e.broadcastId;null!=d&&null!=s&&null!=l&&({ephemeralDuration:a,ephemeralSettingTimestamp:o}=yield(0,_.decodeBroadcastEphemeralSetting)(d,t,(0,m.getMeUser)(),s,l));const u=(0,i.default)((0,i.default)({},e),{},{id:n,from:(0,m.getMeUser)(),to:t,broadcast:!0,ephemeralDuration:a,ephemeralSettingTimestamp:o});return e.protocolMessageKey&&(u.protocolMessageKey=new c.default({remote:t,fromMe:!0,id:e.protocolMessageKey.id})),u}));return function(){return t.apply(this,arguments)}}()))).filter(Boolean)}))).apply(this,arguments)}function j(e){return(0,p.toUserWid)(e).equals((0,m.getMeUser)())}function Y(e){return e.type===y.MESSAGE_TYPE.OTHER_BROADCAST?new c.default({remote:(0,p.toUserWid)(e.author),fromMe:!1,id:e.externalId}):e.type===y.MESSAGE_TYPE.CHAT?new c.default({remote:e.chat,fromMe:j(e.author),id:e.externalId}):new c.default({remote:e.chat,fromMe:j(e.author),participant:(0,p.toUserWid)(e.author),id:e.externalId})}function W(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID?T.default.DEVICE_TYPE.PRIMARY:T.default.DEVICE_TYPE.COMPANION}function H(e){return e.type===y.MESSAGE_TYPE.CHAT?e.author:e.chat}},39505:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.type!==o.MESSAGE_TYPE.CHAT)return;if(!i.default.equals((0,a.getMaybeMeUser)(),e.author))return t.privacyMode;const r=t.privacyMode,n=(0,s.getContactPrivacyMode)(e.chat);return(0,s.getLatestPrivacyMode)(n,r)};var i=n(r(89867)),a=r(99234),o=r(49714),s=r(30849)},22695:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isFromKnownDevice=function(){return p.apply(this,arguments)},t.validateBclHash=function(){return u.apply(this,arguments)},t.validateMsgDestination=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(45454),s=r(9108),l=r(99234),c=r(53686);function d(){return(d=(0,i.default)((function*(e,t){const r=t.author,n=t.chat;if(!e.equals(n))return __LOG__(4,void 0,new Error,!0)`encDestination: ${String(e)}, destination: ${n.toString()}`,SEND_LOGS("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),Promise.resolve(!1);const i=(0,o.toUserWid)(r),a=r.device||0;if(!i.equals((0,l.getMeUser)()))return __LOG__(4,void 0,new Error,!0)`sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination: drop due to msg is not sent from your own device."),Promise.resolve(!1);const c=yield(0,s.hasDevice)(i,a);return c||(__LOG__(4,void 0,new Error,!0)`no record found for sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination:drop due to invalid device")),c}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){var r;const n=null!==(r=t.bclParticipants)&&void 0!==r?r:[],i=yield(0,c.phashV2)(n);return i!==e?(__LOG__(4,void 0,new Error,!0)`expected: ${e}, got: ${i}`,SEND_LOGS("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=null==e.device?a.DEFAULT_DEVICE_ID:e.device;if(t===a.DEFAULT_DEVICE_ID)return!0;const[r]=yield(0,s.getDeviceIds)([e.user]);return null!=r&&r.devices.includes(t)}))).apply(this,arguments)}},48309:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleChatSimpleAck=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(35470),o=n(r(65212)),s=r(45454),l=r(86945),c=r(99234),d=r(29331),u=r(28237),p=r(47124),f=n(r(66545));function _(){return(_=(0,i.default)((function*(e){const{from:t,externalIds:r,ts:n,recipient:i,ackString:_,offline:g,biz:m}=e;let{ack:y}=e;const E=_===a.ACK_STRING.SENDER,S=!E&&(0,s.toUserWid)(t).equals((0,c.getMeUser)());let v;if(S||E){if(!i)throw new Error("handleChatSimpleAck: invalid sender/peer receipt without recipient");v=i}else{v=(0,s.toUserWid)(t);"none"===(0,c.getUserPrivacySettings)().readReceipts&&(y===a.ACK.READ||y===a.ACK.PLAYED&&(0,l.getABPropConfigValue)("played_self_enabled"))&&(y=a.ACK.RECEIVED)}const T=r.map((e=>new o.default({id:e,remote:v,fromMe:!S})));S&&y===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(T);const C=T.map((e=>e.toString()));if(null!=g&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==g||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(h(S,E,T,v,y,n,m)),S||e.push((0,p.updateReceiptRecords)(y,n,t,C,m?{actualActors:m.actualActors,hostStorage:m.hostStorage,privacyModeTs:m.privacyModeTs}:null).catch((e=>{__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleChatSimpleAck: failed")}))),yield Promise.all(e)}else{if(!S)return f.default.addOfflineReceipt(y,n,t,C);if(null!=i&&(_===a.ACK_STRING.READ||_===a.ACK_STRING.READ_SELF||_===a.ACK_STRING.PLAYED||_===a.ACK_STRING.PLAYED_SELF)&&r.length>0)return f.default.addOfflinePeerReceipt(n,C,y)}}))).apply(this,arguments)}function h(e,t,r,n,i,o,s){return i<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleChatSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleChatSimpleAck: peer receipt from peer device ${n.toString()}`,i===a.ACK.READ?(0,d.updateChatPeerRead)(n,r):i===a.ACK.PLAYED?(0,d.updateMsgAcks)(r,i,o):Promise.resolve()):(0,d.updateMsgAcks)(r,i,o,s)}},84947:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupSimpleAck=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(35470),o=n(r(65212)),s=r(45454),l=r(78027),c=r(99234),d=r(29331),u=r(28237),p=r(47124),f=r(59871),_=r(52821),h=r(17972),g=r(29731),m=n(r(66545));function y(){return(y=(0,i.default)((function*(e){const{ack:t,from:r,externalIds:n,ts:l,ackString:f,participant:_,recipient:h,offline:y}=e;if(!_)throw new Error("handleGroupSimpleAck: got group ack without participant.");const S=(0,c.getMeUser)(),v=(0,s.toUserWid)(_),T=f===a.ACK_STRING.SENDER,C=!T&&v.equals(S);let A;if(C){if(!h)throw new Error("handleGroupSimpleAck: invalid sender/peer receipt without recipient");A=h}else A=S;const b=n.map((e=>new o.default({id:e,remote:r,fromMe:!C,participant:A})));C&&t===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(b);const P=b.map((e=>e.toString()));if(null!=y&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==y||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(E(C,T,b,r,t,v,l)),C||e.push(new g.NonPersistJob("updateGroupReceiptRecords",(0,i.default)((function*(){try{yield(0,p.updateReceiptRecords)(t,l,_,P)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleGroupSimpleAck: failed")}}))).waitUntilCompleted()),yield Promise.all(e)}else{if(!C)return m.default.addOfflineReceipt(t,l,_,P);if(null!=h&&(f===a.ACK_STRING.READ||f===a.ACK_STRING.READ_SELF||f===a.ACK_STRING.PLAYED||f===a.ACK_STRING.PLAYED_SELF)&&n.length>0)return m.default.addOfflinePeerReceipt(l,P,t)}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r,n,o,s,u){return o<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleGroupSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleGroupSimpleAck: peer receipt from peer device ${n.toString()}`,o===a.ACK.READ&&(0,d.updateChatPeerRead)(n,r),o===a.ACK.PLAYED?(0,d.updateMsgAcks)(r,o,u):Promise.resolve()):void(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=f.MsgCollection.get(e);if(!t)return void __LOG__(2)`handleGroupSimpleAck: no message found for incoming ack, with msgKey:`;const r=yield h.MsgInfoCollection.find(e);return r||(__LOG__(3,void 0,void 0,!0)`Assertion failed! ${e.toString()}`,SEND_LOGS("handleGroupSimpleAck: no msgInfo found for msg:")),(0,_.updateMsgInfo)(r,o,s,u),o===a.ACK.RECEIVED&&0===r.deliveryRemaining||o===a.ACK.READ&&0===r.readRemaining||o===a.ACK.PLAYED&&0===r.playedRemaining?(0,l.updateMsgAck)(t,null,{from:(0,c.assertGetMe)(),to:n,ack:o,t:u}):void 0}));return function(){return e.apply(this,arguments)}}())))}))).apply(this,arguments)}},17234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return E.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(35470),l=n(r(65212)),c=n(r(89867)),d=r(48309),u=r(99234),p=r(84947),f=r(78428),_=r(28237),h=n(r(66545)),g=r(90756),m=r(97563),y=r(39410);function E(){return(E=(0,a.default)((function*(e){const t=f.msgReceiptParser.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,new Error(t.error);{const e=t.success,{ack:r,ackString:n,from:i,stanzaId:a}=e;if(e.type===f.RECEIPT_TYPE.SIMPLE){if(r===s.ACK.CONTENT_GONE)return T(i,a,n,null);let t=null;null==e.offline||_.OfflineMessageHandler.isResumeFromRestartComplete()?t=T(i,a,n,e.participant):h.default.addOfflineReceiptAck(i,a,n,e.participant);try{__LOG__(2)`handleSimpleAck: got receipt ${e.ack} for msg ${e.stanzaId}`,yield S(e)}catch(e){}return t}if(e.type===f.RECEIPT_TYPE.AGGREGATE){const t=T(i,a,n,null);try{__LOG__(2)`handleAggregateAck: got ${e.receipts.length} receipts of ack type ${e.ack} for msg ${e.externalId}`,yield v(e)}catch(e){}return t}return __LOG__(4,void 0,new Error,!0)`type: ${e.type}`,SEND_LOGS("handleMsgReceipt: Invalid receipt type"),T(i,a,n,null)}}))).apply(this,arguments)}function S(e){const{from:t,ack:r,stanzaId:n,participant:a}=e;if(r===s.ACK.MD_DOWNGRADE){const e=new l.default({id:n,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,u.getMeUser)()});return(0,m.updateLocalAndModel)(e,{mdDowngrade:!(a&&c.default.isWid(a)&&a.isUser())||a.toString()})}if(r===s.ACK.PEER)return Promise.resolve();if(t.isStatusV3())return(0,g.handleStatusSimpleAck)(e);if(t.isUser())return(0,d.handleChatSimpleAck)(e);if(t.isGroup())return(0,p.handleGroupSimpleAck)(e);if(t.isBroadcast()){if(!e.participant)return Promise.reject(new Error(`handleSimpleAck: missing participant for broadcast receipt ${t.toString()}`));const r=(0,i.default)((0,i.default)({},e),{},{from:e.participant,participant:null});return(0,d.handleChatSimpleAck)(r)}return Promise.reject(new Error(`handleSimpleAck: unsupported type for ${t.toString()}`))}function v(e){const{ack:t,from:r}=e;if(t===s.ACK.CONTENT_GONE)return Promise.reject(new Error("handleAggregateAck: reupload receipts cannot be aggregated"));if(!r.isGroup())return Promise.reject(new Error("handleAggregateAck: aggregate receipts should come only from group JIDs"));const n=e.receipts.map((t=>S({type:f.RECEIPT_TYPE.SIMPLE,stanzaId:e.externalId,externalIds:[e.externalId],from:e.from,participant:t.participant,recipient:null,ts:t.ts,ack:e.ack,ackString:e.ackString,offline:e.offline,biz:null})));return Promise.all(n)}function T(e,t,r,n){return(0,o.wap)("ack",{to:(0,y.JID)(e),id:(0,o.CUSTOM_STRING)(t),class:"receipt",type:(0,o.MAYBE_CUSTOM_STRING)(r),participant:n&&n!==e?(0,y.DEVICE_JID)(n):o.DROP_ATTR})}},29331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleViewOnceOpenedIfNecessary=function(e){e.forEach((e=>{const t=_.MsgCollection.get(e);(null==t?void 0:t.isViewOnce)&&(0,u.handleActivitiesForChatThreadLogging)([{activityType:"viewOnceOpen",ts:t.t,chatId:t.id.remote}])}))},t.processOrphanPeerReceipt=function(e){return y.enqueue((0,i.default)((function*(){const t=yield(0,h.getOrphanReceipt)(String(e));t?(null!=t[o.ACK_STRING.PLAYED]&&(__LOG__(2)`processOrphanPeerReceipt: orphan played ack found for incoming ${e}`,yield C([e],o.ACK.PLAYED,t[o.ACK_STRING.PLAYED])),null!=t[o.ACK_STRING.READ]&&(__LOG__(2)`processOrphanPeerReceipt: orphan read ack found for incoming ${e}`,v(e.remote,[e])),yield(0,h.removeOrphanReceipt)(String(e))):__LOG__(2)`processOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.updateChatPeerRead=v,t.updateMsgAcks=C;var i=n(r(48926)),a=r(27870),o=r(35470),s=n(r(65212)),l=r(38342),c=r(87845),d=r(48285),u=r(16116),p=r(57701),f=r(90981),_=r(59871),h=r(40221),g=r(76332),m=r(9609);const y=new a.PromiseQueue;function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=(yield(0,l.getActiveMessageRanges)(e)).filter((e=>"markChatAsRead"===e.action&&!1===e.actionValue.read&&null!=e.actionValue.messageRange));if(0===r.length)return!0;const n=r[0];return t.some((e=>!(0,c.rangeContainsMessage)(n.actionValue.messageRange,{id:s.default.fromString(e.id),t:e.t})))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const n=t.map(String),i=[];let a=null;const s=yield(0,f.getTable)().bulkGet(n,!1);s.forEach(((e,t)=>{e?null==e.pendingReadReceipt||null!=e.rowId&&(null==a||e.rowId>a)&&(a=e.rowId):i.push(n[t])})),y.enqueue((()=>(__LOG__(2)`updateChatPeerRead: storing ${i.length} orphan acks`,(0,h.createOrUpdateOrphanReceipt)(o.ACK_STRING.READ,0,i)))),yield(0,d.markMessageAndChatAsRead)(a,String(e),!(yield E(e.toString(),s.filter(Boolean)))),(0,p.receiveReactionsEnabled)()&&(yield(0,g.markReactionsAsReadByMessageKeys)(t));const l=r(69951).ChatCollection.get(e);l&&((0,m.updateUnreadCountMD)(l,0,!1),(0,m.clearUnreadMentions)(l))}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,i){const a=[],s=[],l=r(78027).updateMsgAck;e.forEach((e=>{const r=_.MsgCollection.get(e);r?s.push(l(r,null,{from:r.from,to:r.to,ack:t,t:n,deliveryPrivacyMode:o.ACK.RECEIVED===t?i:null})):(__LOG__(2)`updateMsgAcks: no message found for incoming ack, with msgKey: ${e}`,e.fromMe||a.push(e))})),a.length>0&&y.enqueue((()=>{__LOG__(2)`updateMsgAcks: store ${a.length} orphan acks`;let e=null;if(t===o.ACK.PLAYED?e=o.ACK_STRING.PLAYED:t===o.ACK.READ&&(e=o.ACK_STRING.READ),e)return(0,h.createOrUpdateOrphanReceipt)(e,n,a.map(String))})),yield Promise.all(s)}))).apply(this,arguments)}},78428:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgReceiptParser=t.RECEIPT_TYPE=void 0;var i=n(r(81109)),a=r(71914),o=r(35470),s=r(81663),l=r(99234),c=r(49714);const d={read:o.ACK.READ,played:o.ACK.PLAYED,inactive:o.ACK.INACTIVE,"server-error":o.ACK.CONTENT_GONE,"md-downgrade":o.ACK.MD_DOWNGRADE,sender:o.ACK.RECEIVED,"read-self":o.ACK.READ,"played-self":o.ACK.PLAYED,peer_msg:o.ACK.PEER},u={SIMPLE:"simple",AGGREGATE:"aggregate"};t.RECEIPT_TYPE=u;const p=new a.WapParser("incomingMsgReceiptParser",(e=>{e.assertTag("receipt"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t={ack:e.attrEnumOrDefault("type",d,o.ACK.RECEIVED),stanzaId:e.attrString("id"),from:(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),ackString:e.hasAttr("type")?e.attrString("type"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},r=e.maybeChild("participants");return r?function(e,t){const r=t.mapChildrenWithTag("user",(e=>{try{const t=(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"));return{participant:t,ts:e.attrTime("t")}}catch(e){return null}})).filter((e=>null!=e));return(0,i.default)((0,i.default)({},e),{},{type:u.AGGREGATE,externalId:t.attrString("key"),receipts:r})}(t,r):function(e,t){const r=t.hasAttr("participant")?(0,s.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("participant")):null,n=t.hasAttr("recipient")?(0,s.userJidToUserWid)(t.attrPhoneUserJid("recipient")):null;let a,o;a=t.hasChild("list")?t.child("list").mapChildrenWithTag("item",(e=>e.attrString("id"))):[];if(t.hasChild("biz")){const e=t.child("biz"),r=c.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),n=c.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),i=e.maybeAttrInt("privacy_mode_ts");null!=r&&null!=n&&null!=i&&(o={actualActors:r,hostStorage:n,privacyModeTs:i})}return a.push(e.stanzaId),(0,i.default)((0,i.default)({},e),{},{type:"simple",externalIds:a,participant:r,recipient:n,ts:t.attrTime("t"),biz:o})}(t,e)}));t.msgReceiptParser=p},90756:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleStatusSimpleAck=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(35470),s=n(r(65212)),l=r(45454),c=r(99234),d=r(29331),u=r(47124),p=r(52821),f=r(17972),_=r(59387);function h(){return(h=(0,i.default)((function*(e){const{externalIds:t,ts:r,ackString:n,ack:i,participant:d,recipient:p}=e;if("none"===(0,c.getUserPrivacySettings)().readReceipts||n!==o.ACK_STRING.READ)return;if(!d)return __LOG__(4,void 0,new Error,!0)`error: got status ack without participant`,void SEND_LOGS("handleStatusSimpleAck: failed");const f=(0,c.getMeUser)(),_=(0,l.toUserWid)(d),h=_.equals(f),m=new s.default({id:t[0],remote:(0,l.createWid)(a.STATUS_JID),fromMe:!h,participant:null!=p?p:f}),y=[m.toString()];if(!h)try{yield(0,u.updateReceiptRecords)(i,r,d,y)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleStatusSimpleAck: failed")}yield g(h,m,_,r)}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r,n){if(e){const e=_.StatusV3Collection.get(t.participant);e&&e.handleReadStatus(t)}else{const e=yield f.MsgInfoCollection.find(t);(0,p.updateMsgInfo)(e,o.ACK.READ,r,n)}yield(0,d.updateMsgAcks)([t],o.ACK.READ,n)}))).apply(this,arguments)}},58464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdaptiveOfflineEnabled=function(){return(0,n.getABPropConfigValue)("web_adaptive_offline_resume_enabled")};var n=r(86945)},98972:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDanglingReceipts=u,t.sendAndClearDanglingReceipts=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(45454),s=r(93771),l=r(74727),c=r(29100);function d(){return(d=(0,i.default)((function*(){const e=yield(0,s.getTable)().all(),t=new Map;e.forEach((e=>{const{receipts:r}=e;r.forEach((e=>{const r=(0,o.createWid)(e.from),n=(0,o.createWid)(e.author);let i=t.get(r);i||(i=new Map,t.set(r,i));let a=i.get(n);a||(a=[],i.set(n,a)),a.push(e.externalId)}))}));const r=String((0,a.unixTime)());yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,l.sendAggregateReceipts)(e,l.RECEIPT_TYPE.DELIVERY,r,n)}))),yield u()}))).apply(this,arguments)}function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){yield(0,c.blockSendPing)(),yield(0,s.getTable)().clear()}))).apply(this,arguments)}},69153:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),o=r(57319),s=r(24747),l=r(97153);var c=new class{constructor(){this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new a.PromiseQueue}addOfflinePendingDevice(e,t){this.pendingDeviceCache.add(e),t&&this.pendingAcks.push(t),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][device-cache]: creating snapshot: schedule in ${3e3} ms`,this.snapshotTimer.onOrAfter(3e3))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;__LOG__(2)`[offline-resume][device-cache]: creating snapshot for pending devices ${e.join(",")}`,this.checkpointQueue.enqueue((0,i.default)((function*(){yield(0,l.addUserToPendingDeviceSync)(e),t.forEach(s.castStanza),(0,s.cancelDeadSocketTimer)()}))),this.pendingDeviceCache=new Set,this.pendingAcks=[]}};t.default=c},28237:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineMessageHandlerImpl=t.OfflineMessageHandler=void 0;var i=n(r(48926)),a=r(13959),o=r(4352),s=r(98972),l=r(88102),c=r(80278),d=r(36163),u=r(15746),p=n(r(29783)),f=r(52083),_=n(r(66545)),h=r(49714),g=r(65044),m=r(97153),y=n(r(69153)),E=r(57319),S=r(83578),v=r(58464),T=r(45607),C=r(57701),A=r(6684),b=n(r(65212)),P=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=D(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),M=r(85553),O=r(97480),I=r(60324),w=r(55552),R=r(16116);function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(D=function(e){return e?r:t})(e)}const N=20,L=50,k=200,G=r(76672)({INIT:"INIT",RESUME_ON_RESTART:"RESUME_ON_RESTART",RESUME_WITH_OPEN_TAB:"RESUME_WITH_OPEN_TAB",COMPLETE:"COMPLETE"});class U{constructor(){this._offlineCompleteTimer=null,this.initState(),l.Cmd.on("logout",(()=>{this.initState()})),l.Cmd.on("open_socket_stream",(()=>{O.OfflineResumeReporter.logSocketConnectT()}))}initState(){this._offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=G.INIT,this._pendingMessageCount=0,this._isPendingPrevBatch=!1}setStatus(e){e===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] begin RESUME_WITH_OPEN_TAB`:e===G.RESUME_ON_RESTART?__LOG__(2)`[offline-resume][handler] begin RESUME_ON_RESTART`:e===G.COMPLETE&&(this._status===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] finished RESUME_WITH_OPEN_TAB`:__LOG__(2)`[offline-resume][handler] finished RESUME_ON_RESTART`),this._status=e}setOfflineMessagePreviewCounter(e){var t=this;return(0,i.default)((function*(){if(O.OfflineResumeReporter.logOfflinePreviewT(),t.isResumeFromRestartComplete()){__LOG__(2)`[offline-resume][handler] Offline session is complete when receiving offline preview ib.`,t._exceedResumeWithOpenTabLimit(e.message,e.receipt)&&(__LOG__(2)`[offline-resume][handler] restart client due to exceed the LIMIT, message: ${e.message}, receipt: ${e.receipt}`,B()),M.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_WITH_OPEN_TAB);const n=r(69951).ChatCollection;n.disableSortListener(),setTimeout((()=>{n.enableSortListener(!0)}),7e3)}else if(t._status===G.INIT)O.OfflineResumeReporter.logOfflineCount(e),t._hasMessagesToDownload=e.message>0,t._finishedDownloading=0===e.message,t._offlineMessagePreviewCounter=e.message,t._decryptedMessageCount=0,t._firstPreviewReceivedT=Date.now(),l.Cmd.handleOfflineProgressUpdate(),M.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_ON_RESTART),yield(0,f.enableMemSignalStore)(),t._startOfflineCompleteTimer(e.message,e.receipt);else{const r=t._firstPreviewReceivedT;if(null!=r){const n=Date.now()-r;n<1e3?(__LOG__(2)`[offline-resume][handler] Accept multiple offline preview ibs during offline resume, delay ${n}.`,t._offlineMessagePreviewCounter+=e.message,t._hasMessagesToDownload=t._offlineMessagePreviewCounter>0,t._finishedDownloading=0===t._offlineMessagePreviewCounter,O.OfflineResumeReporter.logOfflineCount(e),l.Cmd.handleOfflineProgressUpdate()):__LOG__(2)`[offline-resume][handler] Reject multiple offline preview ib during offline resume, delay ${n}.`}t.refreshOfflineCompleteTimer()}}))()}getOfflineDeliveryProgress(){return this._finishedDownloading?100:-1===this._offlineMessagePreviewCounter?0:0===this._offlineMessagePreviewCounter?100:Math.min(Math.ceil(100*this._decryptedMessageCount/this._offlineMessagePreviewCounter),100)}isResumeOnSocketDisconnectInProgress(){return this._status===G.RESUME_WITH_OPEN_TAB}isResumeFromRestartComplete(){return this._status!==G.RESUME_ON_RESTART&&this._status!==G.INIT}getHasMessagesToDownload(){return this._hasMessagesToDownload}getFinishedDownloading(){return 100===this.getOfflineDeliveryProgress()}setOfflineSessionComplete(e){var t=this;return(0,i.default)((function*(){var n;return setTimeout((()=>{r(69951).ChatCollection.enableSortListener(!0)}),3e3),null===(n=t._offlineCompleteTimer)||void 0===n||n.cancel(),t._offlineCompleteTimer=null,t._status===G.COMPLETE?Promise.resolve():t._status===G.RESUME_WITH_OPEN_TAB?(yield(0,u.waitForOnlineMsgThread)(),yield(0,m.doPendingDeviceSync)(),t.setStatus(G.COMPLETE),Promise.resolve()):(t._hasMessagesToDownload=e>0,t._finishedDownloading=0===e,t.setStatus(G.COMPLETE),t._offlineStanzaCountAfterOfflineMarker=0,setTimeout((()=>{t._offlineStanzaCountAfterOfflineMarker>100&&(__LOG__(3)`[offline-resume][handler] ${t._offlineStanzaCountAfterOfflineMarker} received after offline completion marker. Refreshing window due to potential server issue.`,B())}),2e4),l.Cmd.handleOfflineProgressUpdate(),t._onOfflineComplete())}))()}shouldUseOfflineResumeScreen(){return this._offlineMessagePreviewCounter>this._decryptedMessageCount}decryptOfflineMessage(e){var t=this;return(0,i.default)((function*(){const r=yield(0,c.decryptE2EPayload)(e);return t._decryptedMessageCount=t._decryptedMessageCount+1,r.result===h.E2EProcessResult.RETRY&&(t._decryptionErrorCount=t._decryptionErrorCount+1),(0,v.isAdaptiveOfflineEnabled)()&&(t._pendingMessageCount-=1,t.maybeRequestMoreStanza()),r}))()}offlineStanzaReceivedAfterCompelete(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker=this._offlineStanzaCountAfterOfflineMarker+1)}addOfflinePendingMessage(){(0,v.isAdaptiveOfflineEnabled)()&&!this.isResumeFromRestartComplete()&&(this._pendingMessageCount+=1)}maybeRequestMoreStanza(){this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._pendingMessageCount<=200&&((0,T.sendBatchRequestIb)(200),this._isPendingPrevBatch=!0,__LOG__(2)`[offline-resume][adaptive] maybeRequestMoreStanza: request next batch, pending message ${this._pendingMessageCount}`)}newOfflineStanza(e,t){(0,v.isAdaptiveOfflineEnabled)()&&(this._isPendingPrevBatch=!1,null==this._endBatchCheck&&(this._endBatchCheck=setTimeout((()=>{this.maybeRequestMoreStanza(),this._endBatchCheck=null,__LOG__(2)`[offline-resume][adaptive] _endBatchCheck: done`}),0))),this.refreshOfflineCompleteTimer(),O.OfflineResumeReporter.logAddOfflineSizeBytes(t),O.OfflineResumeReporter.logOldestStanzaTime(e)}refreshOfflineCompleteTimer(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(6e4)}_startOfflineCompleteTimer(e,t){var r;null===(r=this._offlineCompleteTimer)||void 0===r||r.cancel(),this._offlineCompleteTimer=new E.ShiftTimer((()=>{this._status!==G.COMPLETE&&(__LOG__(2)`[offline-resume][handler]: offline session completed by timeout`,this.setOfflineSessionComplete(e+t),this._offlineCompleteTimer=null,O.OfflineResumeReporter.logMissedOfflineComplete())})),this._offlineCompleteTimer.onOrAfter(6e4)}_onOfflineComplete(){var e=this;return(0,i.default)((function*(){yield(0,u.waitForOfflineMsgThread)(),e._finishedDownloading=!0,l.Cmd.handleOfflineProgressUpdate(),O.OfflineResumeReporter.logOfflineDecryptionErrorCount(e._decryptionErrorCount),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ${e._decryptionErrorCount}`,e._decryptionErrorCount=0,yield function(){return x.apply(this,arguments)}(),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: clearOfflineSnapShot done.`,(0,f.enablePersistSignalStore)(),(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e,t,r){const n=(0,a.delayMs)(P.expBackoff(r,12e4,1e3,.1));try{return yield(0,s.clearDanglingReceipts)(),__LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: done.`,e()}catch(t){return __LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: failed with error ${t}.`,r>3?(__LOG__(3)`[offline-resume][handler] runReceiptCleanUpLoop: Gave up clean up receipts ${r} tries`,e()):n}}));return function(){return e.apply(this,arguments)}}());try{const e=yield(0,I.pruneExpiredMessages)(),t=e.length;if((0,C.receiveReactionsEnabled)()&&t>0){const t=r(68819).getJobManager,n=[],i=new Set;e.forEach((e=>{const t=e.id.toString();i.add(b.default.fromString(t).remote.toString()),n.push(t)}));const a=Array.from(i.values()).join(",").toString();yield t().waitUntilPersisted(A.jobSerializers.deleteReactions(a,n))}__LOG__(2)`[offline-resume][handler] setOfflineSessionComplete: pruneExpiredMessages pruned ${t} msg(s)`}catch(e){throw __LOG__(4,void 0,new Error)`[offline-resume][handler] _onOfflineComplete: pruneExpiredMessages message failed with error: ${e}`,e}O.OfflineResumeReporter.logLastStanzaT();try{__LOG__(2)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages.`,yield Promise.all([(0,d.restoreChatsAndMessages)(),(0,d.restoreGroupsContactsAndProfilePics)()])}catch(e){__LOG__(4,!0,new Error,!0)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages failed with error ${e}.`,SEND_LOGS("offline-resume-fatal-error"),g.Socket.logout(!1,S.LogoutReason.ClientFatalError)}l.Cmd.readyForMainStreamMode(),O.OfflineResumeReporter.logMainScreenLoadT(),O.OfflineResumeReporter.commit(),(0,w.processAllOrphanPaymentNotifications)(),(0,R.uploadChatThreadLoggingEvents)(),setTimeout((()=>{(0,m.doPendingDeviceSync)()}),2e3)}))()}_exceedResumeWithOpenTabLimit(e,t){return e+t>k||e>N&&e+t>L}}t.OfflineMessageHandlerImpl=U;const F=new U;function x(){return(x=(0,i.default)((function*(){p.default.createSnapshot(),_.default.createSnapshot(),y.default.createSnapshot(),yield Promise.all([p.default.checkpointQueue.wait(),_.default.checkpointQueue.wait(),y.default.checkpointQueue.wait()])}))).apply(this,arguments)}function B(){var e;(null===(e=window.location)||void 0===e?void 0:e.reload)&&window.location.reload()}t.OfflineMessageHandler=F},29783:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),o=r(57319),s=r(92844),l=r(15461),c=r(67811),d=r(58464),u=r(88102),p=r(24747),f=r(93771),_=r(57701),h=n(r(54624)),g=r(76332),m=r(74727),y=r(11849),E=r(77246),S=r(71251);var v=new class{constructor(){this.cache=[],this.checkpointQueue=new a.PromiseQueue,this.lastCheckpointIndex=0,this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()}))}addOfflineMessage(e){this.cache.push(...e),(0,d.isAdaptiveOfflineEnabled)()&&this.cache.length-this.lastCheckpointIndex>=200?this.createSnapshot():this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][msg-cache]: snapshot schedule in ${1e3} ms`,this.snapshotTimer.onOrAfter(1e3))}_addToMessageTable(e,t){var r=this;return(0,i.default)((function*(){const n=[],i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg;null!=e&&((0,_.receiveReactionsEnabled)()&&e.type===l.MSG_TYPE.REACTION?i.push(r.cache[a]):n.push(e))}if(yield(0,S.storeOfflineMsgs)(n),i.length>0){const e=yield(0,c.createReactionsRowFromOffline)(i),t=yield(0,g.addOrUpdateReactionsDBBulk)(e);(0,g.updateHasReactionFromParent)(t)}}))()}_sendAggregateReceipts(e,t){var r=this;return(0,i.default)((function*(){const n=new Map,i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg,t=r.cache[a].receiptInfo;if(!t)continue;const o=t.externalId||(null==e?void 0:e.id.id);if(!o)continue;const{from:s,author:l}=t;let c=n.get(s);c||(c=new Map,n.set(s,c));let d=c.get(l);d||(d=[],c.set(l,d)),d.push(o),i.push({from:String(s),author:String(l),externalId:o})}const a=String((0,s.unixTime)());Promise.all(Array.from(n.keys()).map((e=>{const t=n.get(e);if(t)return(0,m.sendAggregateReceipts)(e,m.RECEIPT_TYPE.DELIVERY,a,t)}))),(0,p.cancelDeadSocketTimer)(),yield(0,f.getTable)().createOrReplace({receipts:i})}))()}createSnapshot(){var e=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const t=this.lastCheckpointIndex,r=this.cache.length;if(this.lastCheckpointIndex=r,__LOG__(2)`[offline-resume][msg-cache]: creating snapshot for offline ${t} to ${r}`,t===r)return;const n=h.default.generateSnapshot();this.checkpointQueue.enqueue((0,i.default)((function*(){yield e._addToMessageTable(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: messages done for ${t} - ${r}`,yield(0,E.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([y.waSignalStore.bulkPutSession(n.sessionUpdate),y.waSignalStore.bulkPutIdentityKeyWithRowId(n.identityUpdate),y.waSignalStore.bulkPutSenderKey(n.senderKeyUpdate),y.waSignalStore.bulkRemovePreKey(n.preKeyRemove),y.waSignalStore.bulkRemoveSession(n.sessionRemove),y.waSignalStore.bulkRemoveIdentity(n.identityRemove)])}))),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: signal done for ${t} - ${r}`,yield e._sendAggregateReceipts(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: sending receipt done for ${t} - ${r}`,u.Cmd.handleOfflineProgressUpdate()})))}};t.default=v},66545:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(52230),o=r(27870),s=r(57319),l=r(31914),c=r(35470),d=r(45454),u=r(24747),p=r(78956),f=r(99069),_=r(39410);const h=Object.freeze({[c.ACK.RECEIVED]:c.ACK_STRING.DELIVERY,[c.ACK.READ]:c.ACK_STRING.READ,[c.ACK.PLAYED]:c.ACK_STRING.PLAYED,[c.ACK.INACTIVE]:c.ACK_STRING.INACTIVE}),g=1e3;function m(e){return(0,p.getTable)().bulkCreate(e)}function y(e,t){if(null!=e&&null!=t)return Math.min(e,t);const r=null!=e?e:t;return null!=r?r:void 0}var E=new class{constructor(){this.peerReadCache=[],this.otherReceiptCache=new Map,this.receiptAckCache=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new o.PromiseQueue}addOfflinePeerReceipt(e,t,r){this.peerReadCache.push({ts:e,msgKeys:t,ack:r}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceipt(e,t,r,n){var i;const o=(0,d.toUserWid)(r).toString(),s=null!==(i=r.device)&&void 0!==i?i:a.DEFAULT_DEVICE_ID;n.forEach((r=>{const n=h[e];if(!n)return void __LOG__(3)`[offline-resume][receipt-cache]: not supported ack type ${e}`;const i=`${r},${o}`,a=this.otherReceiptCache.get(i);a?(n!==h[c.ACK.INACTIVE]&&(a[n]=y(a[n],t)),a.deviceDelivered.add(s)):this.otherReceiptCache.set(i,{[n]:t,deviceDelivered:new Set([s])})})),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceiptAck(e,t,r,n){this.receiptAckCache.push({from:e,stanzaId:t,ackString:r,participant:n}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.otherReceiptCache),t=this.peerReadCache,r=this.receiptAckCache;__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot for ${e.length} other, ${t.length} peer`,this.checkpointQueue.enqueue((0,i.default)((function*(){var n;yield Promise.all([(n=e,(0,f.getStorage)().lock(["message-info"],function(){var e=(0,i.default)((function*(e){let[t]=e;const r=yield t.bulkGet(n.map((e=>e[0].split(",")))),i=r.map(((e,t)=>{const[r,i]=n[t];if(!i)return null;if(!e){const[e,t]=r.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}const a=i.deviceDelivered;return e.deviceDelivered.forEach((e=>a.add(e))),{delivery:y(e.delivery,i.delivery),read:y(e.read,i.read),played:y(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(a),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!a.has(e)))}}));return t.bulkCreateOrReplace(i)}));return function(){return e.apply(this,arguments)}}())),m(t)]),function(e){e.forEach((e=>{let{from:t,stanzaId:r,ackString:n,participant:i}=e;const a=(0,l.wap)("ack",{to:(0,_.JID)(t),id:(0,l.CUSTOM_STRING)(r),class:"receipt",type:(0,l.MAYBE_CUSTOM_STRING)(n),participant:i&&i!==t?(0,_.DEVICE_JID)(i):l.DROP_ATTR});(0,u.castStanza)(a),(0,u.cancelDeadSocketTimer)()})),__LOG__(2)`[offline-resume][receipt-cache] finish sending ${e.length} acks`}(r),__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot done`}))),this.otherReceiptCache=new Map,this.peerReadCache=[],this.receiptAckCache=[]}};t.default=E},45607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendBatchRequestIb=function(e){if(!(0,i.isAdaptiveOfflineEnabled)())return;const t=(0,n.wap)("ib",null,(0,n.wap)("offline_batch",{count:(0,n.CUSTOM_STRING)(String(e))}));(0,a.castStanza)(t)};var n=r(31914),i=r(58464),a=r(24747)},71251:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeOfflineMsgs=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(15461),s=r(68638),l=r(7293),c=r(57701),d=r(91525),u=r(10435),p=r(90981),f=r(63728),_=r(17304),h=r(54676),g=r(12600),m=r(49831),y=r(6684),E=r(90641),S=r(76332),v=r(99069),T=r(12896);function C(){return(C=(0,i.default)((function*(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))try{const{newMsgs:t,replaceMsgs:r,revokeMsgs:n,paymentMessages:a,chatsWithNewOfflineMsg:o}=yield M(e);__LOG__(2)`[offline-resume][msg-cache] storeOfflineMsgs: newMsgs: ${t.length}, replaceMsgs: ${r.length}, revokeMsgs: ${n.length}, paymentMessages: ${a.length}`;const s=yield(0,m.applyOrphanRevoke)(t),[l,u]=yield Promise.all([A(s),(0,E.encryptMultipleMsgs)(s,!1)]);yield(0,p.getTable)().bulkCreateOrReplace(r),yield(0,v.getStorage)().lock(["chat","message","fts-indexing-queue"],function(){var e=(0,i.default)((function*(e){let[t,r,n]=e;yield t.bulkCreateOrMerge(l),yield(0,E.storeEncryptedMessage)(u,o,!1)}));return function(){return e.apply(this,arguments)}}()),yield P(n),yield(0,E.processPaymentMessages)(a),yield(0,d.handleOfflineForMessageRange)(e);const _=e.map((e=>e.id.toString()));yield(0,g.checkOrphanMutations)(_,o),(0,c.receiveReactionsEnabled)()&&(yield(0,S.checkUpdateForOrphanReactions)(_)),t.forEach((e=>{I(e)&&(0,f.addPlaceHolderAction)(e)}))}catch(e){__LOG__(4,void 0,new Error,!0)`[offline-resume] Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("storeOfflineMsgs-error")}}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const r=e.id,n=r.remote.toString();if(n!==a.STATUS_JID&&(0,T.isUnreadTypeMsg)(e)){const i=t.get(n)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!r.fromMe&&(i.unread+=1,(0,u.isGroupCatchUpEnabled)()&&(0,h.isImportantMessage)(e))){const t={id:e.id.toString(),timestamp:e.t};i.unreadMentionsOfMe?i.unreadMentionsOfMe.push(t):i.unreadMentionsOfMe=[t]}e.t>i.t&&(i.t=Math.max(e.t,i.t)),t.set(n,i)}}));const r=Array.from(t.keys()),n=(yield(0,s.getTable)().bulkGet(r)).map(((e,n)=>{var i;const a=r[n],o=t.get(a),s=(null==o?void 0:o.unread)||0,l=Math.max(0,e?e.unreadCount:0);let c=(null==o?void 0:o.t)||void 0;e&&null!=e.t&&(null==c||e.t>c)&&(c=e.t);let d=[],p=null!==(i=null==e?void 0:e.archiveAtMentionViewedInDrawer)&&void 0!==i&&i;if((0,u.isGroupCatchUpEnabled)()){var f,_;const t=null!==(f=null==o?void 0:o.unreadMentionsOfMe)&&void 0!==f?f:[],r=null!==(_=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==_?_:[];t.length>0&&(p=!1),d=t.concat(r)}return{id:a,unreadCount:l+s,t:c,unreadMentionsOfMe:d,archiveAtMentionViewedInDrawer:p}}));return __LOG__(2)`[offline-resume][msg-cache]: storing chat updates: ${JSON.stringify(n)}`,n}))).apply(this,arguments)}function P(e){const t=[];return e.forEach((e=>{const r=new _.Msg(e);r.protocolMessageKey&&t.push({revokeMsgKey:r.protocolMessageKey,newMsgKey:r.id,timestamp:r.t,subtype:r.subtype,sender:r.sender})})),(0,E.processRevokeMsgs)(t).then(function(){var e=(0,i.default)((function*(e){if((0,c.receiveReactionsEnabled)()&&t.length>0){const e=[],n=new Set;t.forEach((t=>{e.push(t.revokeMsgKey.toString());const r=t.revokeMsgKey.remote.toString();n.add(r)}));const i=r(68819).getJobManager;yield i().waitUntilPersisted(y.jobSerializers.deleteReactions(Array.from(n.values()).join(","),e))}return e}));return function(){return e.apply(this,arguments)}}())}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=yield(0,p.getTable)().bulkGet(e.map((e=>String(e.id))),!1),r=[],n=[],i=[],a=[],s=new Set,l=new Map;return e.forEach(((e,c)=>{const d=String(e.id),u=t[c];if(u)if(I(u)){const t=(0,T.convertToMessageRowType)(e);t.t=u.t,t.internalId=u.internalId,t.rowId=u.rowId,n.push(t),(0,f.populatePlaceHolderAction)(u)}else r.push(e.id.id);else{const t=l.get(d);t&&!I(t)?r.push(e.id.id):["sender_revoke","admin_revoke"].includes(e.subtype)?i.push(e):e.type===o.MSG_TYPE.PAYMENT&&"send"===e.subtype||"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype?(a.push(e),l.set(d,e),s.add(String(e.id.remote))):(l.set(d,e),s.add(String(e.id.remote)))}})),r.length>0&&__LOG__(2)`[offline-resume] classifyOfflineMsgs: skip for ${r.length} duplicate messages, with id ${r}`,{newMsgs:Array.from(l.values()),chatsWithNewOfflineMsg:Array.from(s),replaceMsgs:n,revokeMsgs:i,paymentMessages:a}}))).apply(this,arguments)}function I(e){return e.type===o.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype||e.type===o.MSG_TYPE.CIPHERTEXT}},50404:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;if(r&&r.refs&&Array.isArray(r.refs)&&6===r.refs.length){const{refs:e,id:t}=r;(0,l.castStanza)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"result",id:(0,a.CUSTOM_STRING)(t)})),(0,s.generateADVSecretKey)(),h=e,g||(g=new i.ShiftTimer((()=>{if(!(0,u.isRegistered)()&&p.default.online&&d.GK.supportsFeature(d.GK.F.MD_BACKEND))if(h&&h.length){const e=6===h.length?6e4:2e4,t=h.shift();c.Conn.set({ref:t,refTTL:e}),_.Socket.state=f.SOCKET_STATE.UNPAIRED,g&&g.onOrAfter(e)}else g&&g.cancel(),g=null,_.Socket.state=f.SOCKET_STATE.UNPAIRED_IDLE;else g&&g.cancel(),g=null}))),g.forceRunNow()}else __LOG__(3)`handlePairDevice: wrong pair device result received from server`};var i=r(57319),a=r(31914),o=r(71914),s=r(46308),l=r(24747),c=r(17239),d=r(7293),u=r(58052),p=n(r(57220)),f=r(62583),_=r(65044);let h=[],g=null;const m=new o.WapParser("pairDeviceParser",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.child("pair-device").forEachChild((e=>{e.assertTag("ref"),t.push(e.contentString())})),{refs:t,id:e.attrString("id")}}))},58645:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return D.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(11141),s=r(92844),l=r(31914),c=r(71914),d=r(81663),u=r(45454),p=r(84902),f=r(60980),_=n(r(41143)),h=r(61438),g=r(46308),m=r(24747),y=r(17186),E=r(17239),S=r(5087),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(91214)),T=r(99234),C=r(83578),A=n(r(11339)),b=r(58052),P=r(11849),M=r(93832),O=r(65044);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}let w=!1;const R=new c.WapParser("pairSuccessParser",(e=>{var t;e.assertTag("iq"),e.assertFromServer();const r=e.attrString("id"),n=e.child("pair-success"),i=null===(t=n.maybeChild("platform"))||void 0===t?void 0:t.maybeAttrString("name"),a=n.child("device"),o=n.child("device-identity").contentBytes(),s=n.maybeChild("biz"),l=s?s.attrString("name"):"";return{wid:(0,d.deviceJidToDeviceWid)(a.attrPhoneDeviceJid("jid")),id:r,deviceIdentityBytes:o,businessName:l,platform:i}}));function D(){return(D=(0,i.default)((function*(e){if(w||(0,b.isRegistered)())return;(0,T.getShowMdUpgradeCompleteMsg)()&&((0,T.setShowMdUpgradeCompleteMsg)(!1),(0,T.setForcedMdUpgradeComplete)(!1)),w=!0;const t=(0,s.unixTime)(),r=R.parse(e);if(r.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,w=!1,Promise.reject(r.error);try{(0,y.resetCompanionReg)(),(0,T.setHistorySyncEarliestDate)(t);const e=r.success,{id:n,wid:i,deviceIdentityBytes:s,platform:c}=e;E.Conn.blockStoreAdds=!1,c&&(E.Conn.platform=c);const d=(0,p.decodeProtobuf)(h.ADVSignedDeviceIdentityHMACSpec,s),C=d.details,O=d.hmac;(0,_.default)(null!=C&&null!=O,"ADVSignedDeviceIdentityHMAC should not have empty details or hmac");const I=(0,g.getADVSecretKey)(),R=yield(0,o.hmacSha256)(I,C),D=(0,a.encodeB64)(R);if(D!==(0,a.encodeB64)(O))return(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),(0,y.logoutAfterValidationFail)(),void(w=!1);const N=(0,p.decodeProtobuf)(h.ADVSignedDeviceIdentitySpec,C),L=N.accountSignatureKey;(0,_.default)(null!=L,"accountSignatreKey should not be null");const k=N.accountSignature;(0,_.default)(null!=k,"accountSignature should not be null");const G=yield P.waSignalStore.getRegistrationInfo();(0,_.default)(null!=G,"Empty regInfo"),v.initDeviceLinkEvent(L,G.identityKeyPair.pubKey,t),v.setDeviceLinkPairStage(A.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);if(!(0,g.verifyDeviceIdentityAccountSignature)(N,G.identityKeyPair.pubKey))return(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),v.commitDeviceLinkEvent(401),(0,y.logoutAfterValidationFail)(),void(w=!1);N.deviceSignature=(0,g.generateDeviceSignature)(N,G.identityKeyPair,L),yield P.waSignalStore.putIdentity((0,M.createSignalAddress)((0,u.toUserWid)(i)).toString(),(0,M.bufferToStr)((0,S.toSignalCurvePubKey)(L))),yield(0,g.setADVSignedIdentity)(N);const U=(0,p.decodeProtobuf)(h.ADVDeviceIdentitySpec,N.details).keyIndex;(0,_.default)(null!=U,"keyIndex should not be null"),N.accountSignatureKey=void 0;const F=(0,f.encodeProtobuf)(h.ADVSignedDeviceIdentitySpec,N).readByteArray();(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"result",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("pair-device-sign",null,(0,l.wap)("device-identity",{"key-index":(0,l.INT)(U)},F)))),v.setDeviceLinkPairStage(A.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT),(0,T.setMdOptedIn)(!0),(0,T.setMe)(i),(0,b.getInitialHistorySyncComplete)()||(0,y.startInitialHistorySyncTimeout)(),w=!1}catch(e){__LOG__(4,!0,new Error,!0)`error in handlePairSuccess, ${e}`,SEND_LOGS("error in handlePairSuccess"),(0,v.commitDeviceLinkEvent)(-1),O.Socket.logout(!1,C.LogoutReason.UnknownCompanion)}}))).apply(this,arguments)}},2599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAmount1000AndCurrency=function(e){return function(e){if(e.hasChild("amount")){return function(e){e.assertTag("money");const t=parseFloat(e.attrString("value")),n=e.attrString("currency"),i=e.maybeAttrInt("offset");return{currency:n,amount1000:t*r/(null!=i&&0!==i?i:r)}}(e.child("amount").child("money"))}if(e.hasAttr("amount")){return{amount1000:parseFloat(e.attrString("amount"))*r,currency:e.attrString("currency")}}throw __LOG__(3)`Amount missing in pay or transaction node`,new Error("Amount missing in pay or transaction node")}(e)};const r=1e3},27258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(55552).handlePaymentNotification;t.default=n},55552:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePaymentNotification=function(){return y.apply(this,arguments)},t.parseNotificationPaymentInfo=T,t.processAllOrphanPaymentNotifications=function(){return A.apply(this,arguments)},t.processOrphanPaymentNotifications=function(){return C.apply(this,arguments)},t.updateReceivedPaymentInfo=S;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=n(r(65212)),l=r(35588),c=r(84886),d=r(17304),u=r(59871),p=r(5819),f=r(45377),_=r(75295),h=r(39577),g=r(31019),m=r(52586);function y(){return(y=(0,a.default)((function*(e){if(e.content&&"invite"===e.content[0].tag)return E(e);const t=_.paymentNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const r=t.success,n=(0,o.default)(r.msgKey,"info.msgKey"),a=u.MsgCollection.get(n),s=a?(0,g.unproxy)(a):yield(0,l.getMsgByMsgKey)(n);if(!s){__LOG__(3)`handlePaymentNotification: no msg found for id ${n.toString()}`;const e=(0,i.default)((0,i.default)({},r),{},{msgKey:n.toString()});return(0,f.getTable)().createOrReplace(e)}return S(s,r)}))).apply(this,arguments)}function E(e){const t=_.paymentInviteNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const r=t.success;if("account-set-up"===r.type){const e=(0,h.genPaymentInviteAccoutSetupMsg)(r.from,r.timestamp);return(0,p.handleSingleMsgMD)(e.from,e)}return Promise.resolve()}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const r=[];T(e,t),r.push(e.id.toString());const n=[e instanceof d.Msg?e.toJSON():e];if(null!=e.paymentRequestMessageKey){const t=u.MsgCollection.get(e.paymentRequestMessageKey),r=t?(0,g.unproxy)(t):yield(0,l.getMsgByMsgKey)(e.paymentRequestMessageKey||"");r&&(r.paymentStatus=e.paymentStatus,r.paymentTxnStatus=(0,m.determinePaymentRequestFulfilledStatus)(e.paymentTxnStatus),n.push(r instanceof d.Msg?r.toJSON():r))}return(0,f.getTable)().bulkRemove(r).catch((()=>{__LOG__(4,void 0,new Error)`getOrphanPaymentNotificationTable bulkremove of ${r} failed. {e}`})),(0,c.updateExistingMessages)(n)}))).apply(this,arguments)}function T(e,t){t&&(null!=t.status&&(e.paymentStatus=(0,m.getPaymentWebStatus)(t.status,t.type),e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(t.status)),e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,o.default)(t.amount1000,"mdPaymentInfo.amount1000"),e.paymentMessageReceiverJid=t.receiver,e.paymentTransactionTimestamp=(0,o.default)(t.ts,"mdPaymentInfo.ts"))}function C(){return(C=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),r=yield(0,f.getTable)().bulkGet(t),n=new Map;e.forEach((e=>{n.set(e.id.toString(),e)})),r.forEach((e=>{if(e){const t=n.get(e.msgKey);if(!t)return;S(t,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)})}}))}))).apply(this,arguments)}function A(){return(A=(0,a.default)((function*(){const e=yield(0,f.getTable)().all(),t=new Map,r=[];if(e.forEach((e=>{const n=u.MsgCollection.get(e.msgKey);n?S(n,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)}):(t.set(e.msgKey,e),r.push(e.msgKey))})),r.length>0){const e=yield(0,l.getMsgsByMsgKey)(r);return e.forEach((e=>{const r=t.get(e.id.toString());r&&(e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(r.status),e.paymentCurrency=r.currency||"",e.paymentAmount1000=(0,o.default)(r.amount1000,"notification.amount1000"),e.paymentMessageReceiverJid=r.receiver,e.paymentTransactionTimestamp=(0,o.default)(r.ts,"notification.ts"))})),(0,c.updateExistingMessages)(e)}}))).apply(this,arguments)}},75295:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isNoviTransaction=d,t.parseTransactionNode=f,t.paymentNotificationParser=t.paymentInviteNotificationParser=void 0;var i=r(71914),a=r(81663),o=n(r(65212)),s=r(2599),l=r(99234),c=r(52586);function d(e){return!(!e||!e.hasAttr("service")||"NOVI"!==e.attrString("service").toUpperCase())}const u=new i.WapParser("paymentNotificationParser",(e=>{if(e.hasChild("transaction")){return f(e.child("transaction"))}return __LOG__(2)`No transaction node in the payment notification`,null}));t.paymentNotificationParser=u;const p=new i.WapParser("paymentInviteNotificationParser",(e=>{if(e.hasChild("invite")){const t=e.child("invite");return{type:t.maybeAttrString("type"),service:t.maybeAttrString("service"),inviteUsed:t.hasAttr("invite-used")?"1"===t.attrString("invite-used"):null,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),timestamp:e.attrTime("t")}}return __LOG__(2)`No invite node in the payment invite notification`,null}));function f(e){if(d(e))return __LOG__(2)`Payment notification from Novi not supported`,null;let t,r;const n=(0,l.getMeUser)(),i=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender")),u=(0,a.jidWithTypeToWid)(e.attrJidWithType("receiver")),p=n.equals(i);e.hasAttr("group")?(t=(0,a.jidWithTypeToWid)(e.attrJidWithType("group")),r=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender"))):t=p?u:i;const f=new o.default({id:e.attrString("message-id"),fromMe:p,remote:t,participant:r}),_=(0,c.getPaymentTransactionType)(e.attrString("transaction-type"),f.fromMe),{amount1000:h,currency:g}=(0,s.getAmount1000AndCurrency)(e);return{receiver:u,currency:g,amount1000:h,status:(0,c.getNotificationTransactionStatus)(_,e.attrString("status")),ts:e.attrInt("ts"),type:_,msgKey:f}}t.paymentInviteNotificationParser=p},52586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentTransactionTypeServerString=t.PaymentTransactionType=t.PaymentTransactionStatusServerString=t.NotificationTransactionStatus=void 0,t.determinePaymentRequestFulfilledStatus=function(e){if(function(e){return e===n.PaymentInfoTxnStatus.COMPLETED||e===n.PaymentInfoTxnStatus.SUCCESS}(e))return e;return n.PaymentInfoTxnStatus.COLLECT_INIT},t.getNotificationTransactionStatus=function(e,t){if(!t)return a.STATUS_UNSET;const r=t.toUpperCase();switch(e){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(r){case s.PENDING_RECEIVER_SETUP:return a.SEND_PAY_PENDING_RECEIVER;case s.FAILED_DA:return a.SEND_PAY_PENDING;case s.REFUND_FAILED_DA:return a.SEND_PAY_REFUND_PENDING;case s.FAILED_RISK:return a.SEND_PAY_FAILURE_RISK;case s.INITIAL:return a.SEND_PAY_INIT;case s.SUCCESS:case s.COMPLETED:return a.SEND_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.SEND_PAY_FAILURE;case s.REFUNDED:return a.SEND_PAY_REFUNDED;case s.REFUND_FAILED:return a.SEND_PAY_REFUND_FAILED;case s.FAILED_RECEIVER_PROCESSING:return a.SEND_PAY_FAILURE_RECEIVER;case s.REFUND_FAILED_PROCESSING:return a.SEND_PAY_REFUND_FAILED_PROCESSING;case s.FAILED_DA_FINAL:return a.SEND_PAY_PENDING_REFUND;case s.AUTH_CANCEL_FAILED_PROCESSING:return a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case s.AUTH_CANCEL_FAILED:return a.SEND_PAY_AUTH_CANCEL_FAILED;case s.AUTH_CANCELED:return a.SEND_PAY_AUTH_CANCELED;case s.EXPIRED:return a.SEND_PAY_EXPIRED;case s.IN_REVIEW:return a.SEND_PAY_IN_REVIEW;case s.PENDING:return a.SEND_PAY_PENDING_PROCESSING;case s.CANCELED:return a.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(r){case s.PENDING_SETUP:return a.RECV_PAY_PENDING_SETUP;case s.FAILED_DA:return a.RECV_PAY_PENDING;case s.FAILED_PROCESSING:return a.RECV_PAY_RETRY_ON_FAILURE;case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.RECV_PAY_FAILURE;case s.EXPIRED:return a.RECV_PAY_EXPIRED;case s.FAILED_RISK:return a.RECV_PAY_FAILURE_RISK;case s.WITHDRAWAL_PROCESSING:return a.RECV_PAY_WITHDRAWAL_PROCESSING;case s.WITHDRAWAL_FAILURE:return a.RECV_PAY_WITHDRAWAL_FAILURE;case s.WITHDRAWAL_PERMANENT_FAILED:return a.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case s.CANCELED:return a.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(r){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SUCCESS;case s.COLLECT_FAILED:return a.REQUEST_PAY_FAILED;case s.COLLECT_FAILED_RISK:return a.REQUEST_PAY_FAILED_RISK;case s.COLLECT_REJECTED:return a.REQUEST_PAY_REJECTED;case s.COLLECT_EXPIRED:return a.REQUEST_PAY_EXPIRED;case s.COLLECT_CANCELED:return a.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(r){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case s.AUTH_SUCCESS:return a.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(r){case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(r){case s.PENDING:return a.WITHDRAWAL_PENDING;case s.IN_REVIEW:return a.WITHDRAWAL_IN_REVIEW;case s.SUCCESS:case s.COMPLETED:return a.WITHDRAWAL_SUCCESS;case s.FAILED:case s.DECLINED:return a.WITHDRAWAL_FAILED;case s.CANCELED:return a.WITHDRAWAL_USER_CANCELED;case s.EXPIRED:return a.WITHDRAWAL_EXPIRED;case s.WITHDRAWAL_ACTIVE:return a.WITHDRAWAL_ACTIVE}break;default:return a.STATUS_UNSET}return a.STATUS_UNSET},t.getPaymentTransactionType=function(e,t){if(e){const r=e.toLowerCase();switch(r){case o.TYPE_P2P:return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case o.TYPE_P2M:return t?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case o.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case o.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case o.TYPE_REFUND:return i.TYPE_REFUND;case o.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:__LOG__(2)`parsePaymentTransactionType payment transaction string=${r}`}}return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD},t.getPaymentTxnWebStatus=function(e){if(null==e)return n.PaymentInfoTxnStatus.UNKNOWN;switch(e){case a.RECV_PAY_EXPIRED:case a.SEND_PAY_EXPIRED:return n.PaymentInfoTxnStatus.EXPIRED_TXN;case a.RECV_PAY_FAILURE:case a.SEND_PAY_FAILURE:return n.PaymentInfoTxnStatus.FAILED;case a.RECV_PAY_INIT:case a.SEND_PAY_INIT:return n.PaymentInfoTxnStatus.INIT;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoTxnStatus.PENDING_SETUP;case a.RECV_PAY_PENDING:case a.SEND_PAY_PENDING:return n.PaymentInfoTxnStatus.FAILED_DA;case a.RECV_PAY_RETRY_ON_FAILURE:return n.PaymentInfoTxnStatus.FAILED_PROCESSING;case a.RECV_PAY_SUCCESS:case a.SEND_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoTxnStatus.SUCCESS;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoTxnStatus.COLLECT_CANCELED;case a.REQUEST_PAY_CANCELLING:return n.PaymentInfoTxnStatus.COLLECT_CANCELLING;case a.REQUEST_PAY_EXPIRED:return n.PaymentInfoTxnStatus.COLLECT_EXPIRED;case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoTxnStatus.COLLECT_FAILED_RISK;case a.REQUEST_PAY_FAILED:return n.PaymentInfoTxnStatus.COLLECT_FAILED;case a.REQUEST_PAY_INIT:return n.PaymentInfoTxnStatus.COLLECT_INIT;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoTxnStatus.COLLECT_REJECTED;case a.REQUEST_PAY_SUCCESS:return n.PaymentInfoTxnStatus.COLLECT_SUCCESS;case a.SEND_PAY_AUTH_CANCELED:return n.PaymentInfoTxnStatus.AUTH_CANCELED;case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case a.SEND_PAY_AUTH_CANCEL_FAILED:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED;case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoTxnStatus.FAILED_RECEIVER_PROCESSING;case a.SEND_PAY_FAILURE_RISK:case a.RECV_PAY_FAILURE_RISK:return n.PaymentInfoTxnStatus.FAILED_RISK;case a.SEND_PAY_PENDING_RECEIVER:return n.PaymentInfoTxnStatus.PENDING_RECEIVER_SETUP;case a.SEND_PAY_PENDING_REFUND:return n.PaymentInfoTxnStatus.FAILED_DA_FINAL;case a.SEND_PAY_REFUNDED:return n.PaymentInfoTxnStatus.REFUNDED_TXN;case a.SEND_PAY_REFUND_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.REFUND_FAILED_PROCESSING;case a.SEND_PAY_REFUND_FAILED:return n.PaymentInfoTxnStatus.REFUND_FAILED;case a.SEND_PAY_REFUND_PENDING:return n.PaymentInfoTxnStatus.REFUND_FAILED_DA;case a.SEND_PAY_IN_REVIEW:return n.PaymentInfoTxnStatus.IN_REVIEW;case a.STATUS_UNSET:default:return n.PaymentInfoTxnStatus.UNKNOWN}},t.getPaymentWebStatus=function(e,t){if(null==e)return n.PaymentInfoStatus.UNKNOWN_STATUS;switch(e){case a.SEND_PAY_INIT:case a.SEND_PAY_PENDING:case a.RECV_PAY_INIT:case a.RECV_PAY_PENDING:case a.RECV_PAY_RETRY_ON_FAILURE:case a.REQUEST_PAY_INIT:return n.PaymentInfoStatus.PROCESSING;case a.SEND_PAY_PENDING_RECEIVER:case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoStatus.SENT;case a.REQUEST_PAY_SUCCESS:return t===i.TYPE_P2P_REQ_SENT?n.PaymentInfoStatus.WAITING_FOR_PAYER:n.PaymentInfoStatus.WAITING;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoStatus.NEED_TO_ACCEPT;case a.SEND_PAY_SUCCESS:case a.RECV_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoStatus.COMPLETE;case a.SEND_PAY_FAILURE:case a.SEND_PAY_FAILURE_RISK:case a.SEND_PAY_PENDING_REFUND:case a.SEND_PAY_REFUND_PENDING:case a.SEND_PAY_REFUND_FAILED:case a.SEND_PAY_REFUND_FAILED_PROCESSING:case a.RECV_PAY_FAILURE:case a.REQUEST_PAY_FAILED:case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoStatus.COULD_NOT_COMPLETE;case a.SEND_PAY_REFUNDED:return n.PaymentInfoStatus.REFUNDED;case a.RECV_PAY_EXPIRED:case a.REQUEST_PAY_EXPIRED:case a.SEND_PAY_AUTH_CANCELED:case a.SEND_PAY_AUTH_CANCEL_FAILED:case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoStatus.EXPIRED;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoStatus.REJECTED;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoStatus.CANCELLED;case a.STATUS_UNSET:case a.REQUEST_PAY_CANCELLING:default:return n.PaymentInfoStatus.UNKNOWN_STATUS}};var n=r(21224);const i=r(76672)({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700});t.PaymentTransactionType=i;const a=r(76672)({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608});t.NotificationTransactionStatus=a;const o={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"};t.PaymentTransactionTypeServerString=o;const s={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};t.PaymentTransactionStatusServerString=s},65347:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(88102),l=r(11849),c=r(46669);const d=new Set,u=new Promise((e=>{s.Cmd.isMainStreamReadyMd&&e(),s.Cmd.on("main_stream_mode_ready",(()=>{e()}))})),p=new o.WapParser("lowKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),{stanzaId:e.attrString("id"),numRemaining:e.child("count").attrInt("value")})));function f(){return(f=(0,i.default)((function*(e,t){const r=p.parse(e);if(r.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,new Error(r.error);{const e=r.success,n=(0,a.wap)("ack",{to:a.S_WHATSAPP_NET,id:(0,a.CUSTOM_STRING)(e.stanzaId),class:"notification"});return d.has(t)?n:(d.add(t),l.waSignalStore.setServerHasPreKeys(!1),yield u,(0,c.uploadPreKeys)().then((()=>n)).finally((()=>{d.delete(t)})))}}))).apply(this,arguments)}},46007:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=r(71914),a=r(81663),o=n(r(54248));const s=new i.WapParser("incomingPresenceParser",(e=>{e.assertTag("presence");const t=e.attrEnumOrDefault("type",{available:"available",unavailable:"unavailable",unsubscribe:"unsubscribe"},"available"),r="deny"===e.maybeAttrString("last")||void 0;let n;return"unavailable"===t&&(e.hasAttr("last")?["deny","none","error"].includes(e.attrString("last"))||(n=e.attrTime("last")):n=Date.now()),{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,t:n,deny:r}}))},6571:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(86945),c=r(11365),d=r(68315),u=r(59201);const p=new o.WapParser("incomingPrivacyTokensParser",(e=>{e.assertTag("notification");return{id:e.attrString("id"),from:e.attrPhoneUserJid("from"),privacyTokens:e.child("tokens").mapChildrenWithTag("token",(e=>({type:e.attrString("type"),content:(0,c.uint8ArrayToBuffer)(e.contentBytes()),ts:e.attrTime("t")})))}}));function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const{type:r,content:n,ts:i}=t;if("trusted_contact"!==r)return;const a=(0,s.userJidToUserWid)(e.from);yield(0,u.setTcToken)(a,i,n),yield d.PresenceCollection.reSubscribeWhenActive(a)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(r.id),class:"notification",to:(0,a.JID)(r.from),type:"privacy_token"});return(0,l.getABPropConfigValue)("trusted_contacts")?(yield Promise.all(r.privacyTokens.map((e=>f(r,e)))),n):n}))).apply(this,arguments)}},2276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;let i=Promise.resolve();if(r.jid){const e=r.jid;switch(r.type){case"delete":case"set":const t="delete"===r.type?c.PROFILE_PIC_COMMAND.REMOVE:c.PROFILE_PIC_COMMAND.SET;i=(0,d.changeProfilePicThumb)(e,t).then((()=>{if(!e.isGroup())return;const n=(0,s.genGroupPicChangeNotificationMsg)(r.jid,t,r.ts,r.author||(0,o.getMeUser)());return(0,l.handleSingleMsgMD)(r.jid,n)}));break;case"request":break;default:__LOG__(3)`Invalid type received`}}return i.then((()=>(0,n.wap)("ack",{id:(0,n.CUSTOM_STRING)(r.stanzaId),to:(0,u.JID)(r.from),class:"notification",type:"picture"})))};var n=r(31914),i=r(71914),a=r(81663),o=r(99234),s=r(37654),l=r(5819),c=r(41601),d=r(37638),u=r(39410);const p=new i.WapParser("incomingProfilePicNotificationParser",(e=>{let t,r;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",r=e.child("delete");else if(e.hasChild("set"))t="set",r=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",r=e.child("request"),r.assertAttr("jid",(0,o.assertGetMe)().toJid())}const n=e.attrString("id");return r.hasAttr("jid")?{type:t,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),jid:(0,a.chatJidToChatWid)(r.attrChatJid("jid")),author:r.hasAttr("author")?(0,a.userJidToUserWid)(r.attrPhoneUserJid("author")):null,ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:n,picId:"set"===t?r.attrInt("id",1):0}:{from:(0,a.userJidToUserWid)(e.attrPhoneUserJid("from")),jid:null,type:t,hash:r.attrString("hash"),stanzaId:n}}))},54341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(86945),u=r(11365),p=r(49714),f=r(45033),_=r(53348),h=n(r(40256)),g=r(39410);const m=r(76672)({Image:"image",Video:"video",Text:"text"}),y=new s.WapParser("incomingCampaignParser",(e=>{e.assertTag("notification"),e.assertAttr("from",a.STATUS_JID);const t=e.attrString("id"),r=(0,l.userJidToUserWid)(e.attrPhoneUserJid("participant")),n=e.attrTime("t"),i=e.child("campaign"),o=i.hasChild("revoke"),s=i.attrString("id"),c=i.maybeAttrInt("duration"),d=i.mapChildrenWithTag("message",(e=>{const t=e.child("media");t.attrEnumValues("mediatype",m.members());return{id:e.attrString("id"),ts:n,body:(0,u.uint8ArrayToBuffer)(t.contentBytes())}}));return{participant:r,stanzaId:t,campaignId:s,campaignDuration:c,revoke:o,ts:n,messages:d}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{participant:r,campaignId:n,campaignDuration:i}=e,{id:o,ts:s,body:l}=t,d={type:p.MESSAGE_TYPE.OTHER_STATUS,externalId:o,ts:s,edit:-1,isHsm:!1,count:null,chat:(0,c.createWid)(a.STATUS_JID),author:r,pushname:null,isDirect:!1,campaignId:n,campaignDuration:i},u={retryCount:0,e2eType:f.CiphertextType.Msg,mediaType:f.MediaType.Photo,hideFail:!1};yield(0,_.processDecryptedProto)(l,d,null,u,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(r.stanzaId),participant:(0,g.USER_JID)(r.participant),class:"notification",type:"psa",to:(0,g.JID)((0,c.createWid)(a.STATUS_JID))});return(0,d.getABPropConfigValue)("web_status_psa")?(r.revoke?yield(0,h.default)(r.campaignId):yield Promise.all(r.messages.map((e=>E(r,e)))),n):n}))).apply(this,arguments)}},79711:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_RETRY=void 0,t.handleMessageRetryRequest=function(e){const t=h.default.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(new Error(t.error));const r=t.success,{from:n,participant:a,recipient:s,retryCount:l,stanzaId:c}=r;if(null==c)return __LOG__(3)`Received null stanzaID when handling message retry request`,Promise.reject(new Error("Received null stanzaID when handling message retry request"));const d=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(c),to:(0,y.JID)(n),participant:a?(0,y.DEVICE_JID)(a):o.DROP_ATTR,class:"receipt",type:"retry"}),p=T(n,s);if(!p)return Promise.resolve(d);return(0,u.handleMessage)(String(p),!1,(0,i.default)((function*(){const e=yield S(r);if(null==e)return d;const{originalMsgId:t,chat:i,requester:o,identityRowId:c}=e;try{const e=yield(0,_.getMsgIfAuthorized)(t,i,o,l,c);if(!e)return __LOG__(3)`handleMessageRetryRequest msg retry not authorized`,d;yield(0,g.sendRetry)(n,a,s,e,l)}catch(e){__LOG__(3)`handleMessageRetryRequest error: ${e}`}return d})))},t.handleVoipRetryRequest=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(45454),l=r(9108),c=r(99234),d=r(97398),u=r(15746),p=n(r(11339)),f=n(r(76128)),_=r(28870),h=n(r(87423)),g=r(95547),m=r(93832),y=r(39410);function E(){return(E=(0,i.default)((function*(e){return null!=(yield S(e))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{originalMsgId:t,from:r,participant:n,recipient:i,retryCount:o,offline:s}=e;if(o>=5)return void __LOG__(2)`handleRetryRequest refusing retry attempt #${o}`;const c=T(r,i);if(!c)return void __LOG__(3)`handleRetryRequest: no chat found for incoming retry request.`;const u=c.isUser()?r:n;if(!u)return void __LOG__(3)`handleRetryRequest: no requester found for incoming retry request.`;const h=u.device||0;try{if(!(yield(0,l.hasDevice)(u,h)))return __LOG__(3)`handleRetryRequest: no device ${h} found for ${u.user} for incoming retry request .`,void new p.default.MdRetryFromUnknownDevice({offline:s,senderType:h===a.DEFAULT_DEVICE_ID?p.default.DEVICE_TYPE.PRIMARY:p.default.DEVICE_TYPE.COMPANION}).commit();yield(0,_.updateLocalSession)(c,e),yield(0,d.ensureE2ESessions)([u]);return{originalMsgId:t,chat:c,requester:u,identityRowId:yield f.default.getIdentityRowId((0,m.createSignalAddress)(u).toString())}}catch(e){__LOG__(3)`handleRetryRequest error: ${e}`}}))).apply(this,arguments)}function T(e,t){return e.isUser()?(0,s.toUserWid)(e).equals((0,c.getMeUser)())?t||(__LOG__(3)`getActualChatId: from is a peer device, but without recipient`,null):(0,s.toUserWid)(e):e}t.MAX_RETRY=5},28870:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgIfAuthorized=function(){return m.apply(this,arguments)},t.processKeyBundle=y,t.updateLocalSession=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(15461),l=r(45454),c=r(99234),d=r(90981),u=r(47124),p=n(r(11339)),f=r(17304),_=r(43201),h=r(77605),g=r(12896);function m(){return(m=(0,a.default)((function*(e,t,r,n,i){const a=new o.default({id:e,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,c.getMeUser)()}),l=yield(0,d.getTable)().get(String(a));if(!l)return __LOG__(3)`getMsgIfAuthorized: can not find msg ${a.toString()}.`,null;const _=l.type===s.MSG_TYPE.REVOKED?l.protocolMessageRowId:l.rowId;if(null==_)return __LOG__(3)`getMsgIfAuthorized: msg missing rowId ${a.toString()}.`,null;const h=yield(0,u.isRetryEligible)(a,r,i,_);__LOG__(2,void 0,void 0,void 0,["messaging"])`getMsgIfAuthorized: ${e}, ${String(r)} retry eligibility ${h}`;const m=new f.Msg((0,g.hydrateMessage)(l));yield m.waitForPrep();let y=!1;switch(m.type===s.MSG_TYPE.REVOKED&&(y=!0,m.type="protocol",m.subtype="admin"===m.subtype?"admin_revoke":"sender_revoke"),h){case u.RetryEligibilityResult.ELIGIBLE:return m;case u.RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:new p.default.E2eRetryAfterDelivery({deviceType:r.isCompanion()?p.default.DEVICE_TYPE.COMPANION:p.default.DEVICE_TYPE.PRIMARY,messageType:m.getWamMessageType(),msgRetryCount:n,retryRevoke:y}).commit()}return null}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,r,n,a){return null!=r&&e&&e.key?a?null==n?(__LOG__(2)`processKeyBundle: missing session for retry`,yield h.Session.deleteRemoteInfo(t),!1):n!==r?(__LOG__(2)`processKeyBundle: delete session because reg does not match, saved: ${n}, received: ${r}`,yield h.Session.deleteRemoteInfo(t),!1):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield h.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield h.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: skip due to missing key bundle`,!1)}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const{from:n,keyBundle:i,offline:a,originalMsgId:o,participant:s,regId:d,retryCount:u}=t,p=s||n;if(__LOG__(2)`updateLocalSession: retryCount: ${u}, offline: ${a.toString()}, has keyBundle: ${(!!i).toString()}`,e.isGroup()){const t=r(69951).ChatCollection.get(e);t&&p&&(0,_.markForgetSenderKey)(t.id,[p])}const f=yield h.Session.getRemoteRegId(p);if((0,l.toUserWid)(p).equals((0,c.getMeUser)())&&f!==d)throw new Error(`updateLocalSession: detect registration Id change remote: ${d}, local: ${f} for peer device`);(yield y(i,p,d,f,a))||null!=f&&f!==d&&(__LOG__(2)`updateLocalSession: delete session because reg does not match, saved: ${f}, received: ${f}`,yield h.Session.deleteRemoteInfo(p));if(2===u)return h.Session.saveSessionBaseKey(p,o);if(u>2){if(yield h.Session.hasSameBaseKey(p,o))return __LOG__(2)`updateLocalSession: delete local session due to same base key`,h.Session.deleteRemoteInfo(p)}}))).apply(this,arguments)}},87423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(71914),i=r(81663),a=r(99234);var o=new n.WapParser("retryRequestParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","retry"),e.hasAttr("to")&&e.assertAttr("to",(0,a.assertGetMe)().toJid());const t=(0,i.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.hasAttr("participant")?(0,i.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,n=e.hasAttr("recipient")?(0,i.deviceJidToUserWid)(e.attrPhoneDeviceJid("recipient")):null,o=e.child("retry"),s=e.maybeChild("keys");let l=null;if(null!=s){var c;const e=s.child("skey"),t=s.child("key");l={identity:s.child("identity").contentBytes(32),deviceIdentity:null===(c=s.maybeChild("device-identity"))||void 0===c?void 0:c.contentBytes(),skey:{id:e.child("id").contentUint(3),pubkey:e.child("value").contentBytes(32),signature:e.child("signature").contentBytes(64)},key:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32)}}}return{stanzaId:e.attrString("id"),originalMsgId:o.attrString("id"),ts:e.attrTime("t"),retryCount:o.hasAttr("count")?o.attrInt("count"):0,regId:e.child("registration").contentUint(4),offline:e.hasAttr("offline"),from:t,participant:r,recipient:n,keyBundle:l}}));t.default=o},56545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleServerNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){const t=(0,n.wap)("ack",{id:(0,n.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server",to:(0,n.CUSTOM_STRING)(e.from)});switch(e.type){case c.LOG:return o.upload({reason:"Server request",immediate:!0,force:!0,skipSampling:!1}),Promise.resolve(t);case c.PROPS:return(0,s.queryServerProps)().then((()=>t));case c.ABPROPS:return(0,a.syncABProps)(!1).then((()=>t));default:return __LOG__(3)`Unsupported notification with type "server",
blindly ack-ing it and doing nothing`,Promise.resolve(t)}}(t.success)};var n=r(31914),i=r(71914),a=r(89981),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(85965)),s=r(47569);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const c=Object.freeze({LOG:"log",PROPS:"props",ABPROPS:"abprops"});t.NOTIFICATION_TYPE=c;const d=new i.WapParser("incomingServerNotificationParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),r=e.attrString("from");return e.hasChild(c.LOG)?{type:c.LOG,stanzaId:t,from:r}:e.hasChild(c.PROPS)?{type:c.PROPS,stanzaId:t,from:r}:e.hasChild(c.ABPROPS)?{type:c.ABPROPS,stanzaId:t,from:r}:{type:null,stanzaId:t,from:r}}))},25773:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerSyncNotification=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){if(e.changedCollections){const t=new Map;for(const[r,n]of e.changedCollections){const e=s.CollectionName.cast(r);null!=e?t.set(e,n):__LOG__(3)`syncd: unknown collection name in notification: ${r}`}let r=Array.from(t.keys());e.offline&&r.forEach((e=>{const t=u.get(e);null!=t?u.set(e,t+1):u.set(e,1)})),__LOG__(2)`syncd: incoming sync notification for collections
${Array.from(t.entries()).map((e=>{let[t,r]=e;return`${t} v${r}`})).join("\n")}`,o.default.isSyncDCriticalDataSyncInProcess()&&(r=r.filter((e=>(0,d.isCriticalCollection)(e))),__LOG__(2)`syncd: filtered non critical collections during bootstrap. new collections: ${r}`),(0,c.markCollectionsForSync)(r,t)}return Promise.resolve((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server_sync",to:i.S_WHATSAPP_NET}))}(t.success)},t.reportOfflineNotifications=function(){if(u.size<1)return;let e=0;Array.from(u.entries()).forEach((t=>{let[,r]=t;e+=r-1})),new l.default.MdAppStateOfflineNotifications({redundantCount:e}).commit(),u.clear()};var i=r(31914),a=r(71914),o=n(r(48277)),s=r(45606),l=n(r(11339)),c=r(38804),d=r(93824);const u=new Map,p=new a.WapParser("serverSyncNotification",(e=>{if(e.assertTag("notification"),!e.hasChild("collection"))throw new Error("Server sync notifcation does not contain any collections");const t=e.attrString("id"),r=new Map(e.mapChildrenWithTag("collection",(e=>[e.attrString("name"),e.attrInt("version")]))),n=e.hasAttr("offline");return e.attrString("from")!==i.S_WHATSAPP_NET.toString()&&__LOG__(4,void 0,new Error)`handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"`,{changedCollections:r,stanzaId:t,offline:n}}))},87183:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(24747),l=r(17186),c=r(91214),d=r(65044);const u=new a.WapParser("streamErrorParser",(e=>{if(e.assertTag("stream:error"),!e.hasChild("conflict"))return e.hasAttr("code")?{type:"code",code:e.attrInt("code")}:e.hasChild("ack")?{type:"ack",id:e.child("ack").hasAttr("id")?e.child("ack").attrString("id"):null}:(__LOG__(3)`Unrecognized stream:error: ${e.toString()}`,{type:"other"});switch(e.child("conflict").attrString("type")){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}));function p(){return(p=(0,i.default)((function*(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;if("code"===r.type&&r.code>=500&&r.code<600){if(515===r.code)return(0,l.startLogin)(),Promise.resolve("NO_ACK");if(516===r.code)return(0,c.commitDeviceLinkEvent)(516),(0,l.startLogout)(),Promise.resolve("NO_ACK");(0,s.onStreamErrorReceived)()}else{if("device_removed"===r.type)return(0,s.stopComms)(!0),yield d.Socket.clearCredentialsAndStoredData(),__LOG__(2)`stream error due to device removed, logging out`,o.Cmd.logout(),Promise.resolve("NO_ACK");if("replaced"===r.type)return(0,s.stopComms)(),Promise.resolve("NO_ACK")}return Promise.resolve("CLOSE_SOCKET")}))).apply(this,arguments)}},95681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=_.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`handleSuccess: failed to parse ${t.error}`,Promise.reject(t.error);const r=t.success;(function(e){const t=Date.now()/1e3,r=Math.round(t-e),n=Math.round(r/3600);0!==n&&(0,o.getABPropConfigValue)("log_clock_skew")&&new u.default.ClockSkewDifferenceT({clockSkewHourly:-1*n}).commit();(0,i.setClockSkew)(r),s.Clock.setSkew(r)})(r.ts),l.Cmd.onTemporaryBan({banned:!1});const n=r.companionEncStatic;if(c.DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(n),(0,d.generateFinalDbEncryptionAndFtsKeyForInvoker)(n),null==f.ServerProps.serverPropsVersion||f.ServerProps.serverPropsVersion<r.propsVersion)return(0,p.queryServerProps)()};var i=r(92844),a=r(71914),o=r(86945),s=r(22683),l=r(88102),c=r(15998),d=r(10786),u=n(r(11339)),p=r(47569),f=r(64551);const _=new a.WapParser("successParser",(e=>(e.assertTag("success"),{ts:e.attrTime("t"),propsVersion:e.attrInt("props"),companionEncStatic:e.maybeAttrString("companion_enc_static")||"NULL"})))},2634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{callCreator:r,from:n,message:a,payloadTag:o,stanzaId:s}=t.success,l=(0,h.wapNodeToVoipXml)(e),g={elapsed_msec:a.elapsed_msec,epoch_msec:a.epoch_msec,is_offline:a.is_offline,payload:l[2][0],peer_app_version:a.peer_app_version,peer_platform:a.peer_platform,peer_jid:a.peer_jid?a.peer_jid.toString({legacy:!0}):void 0},E=a.call_id;switch(a.type){case _.TYPE.OFFER:return y(n,s,E,r,a.type),(0,p.getDoNotDisturb)()&&!u.default.isFocused?__LOG__(2)`handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`:(0,d.handleIncomingCallOffer)(a,g),Promise.resolve("NO_ACK");case _.TYPE.ENC_REKEY:return(0,d.handleIncomingEncRekey)(a,g).then((e=>{let{shouldRetry:t,retryCount:i}=e;t?(0,f.default)(s,a,i):y(n,s,E,r,_.TYPE.ENC_REKEY)})),Promise.resolve("NO_ACK");case _.TYPE.ACCEPT:case _.TYPE.REJECT:return y(n,s,E,r,a.type),(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve("NO_ACK");case _.TYPE.OFFER_NOTICE:return(0,c.default)(e);default:return(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve(function(e,t,r){return(0,i.wap)("ack",{to:(0,h.JID)(e),id:(0,i.CUSTOM_STRING)(t),class:"call",type:(0,i.MAYBE_CUSTOM_STRING)(r)})}(n,s,o))}};var i=r(31914),a=r(71914),o=(n(r(64369)),r(81663)),s=r(24747),l=r(99234),c=n(r(66337)),d=r(76046),u=n(r(96489)),p=r(17506),f=n(r(64254)),_=r(45473),h=r(39410);function g(e){return _.TYPE[e.tag().toUpperCase()]||_.TYPE.NONE}const m=new a.WapParser("callParser",(e=>{e.assertTag("call");const t=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.mapFirstChild((e=>e));if(r){const n=r.attrString("call-id"),i=(0,o.jidWithTypeToWid)(r.attrJidWithType("call-creator")),a={call_id:n,call_creator:i,peer_jid:t,peer_platform:e.hasAttr("platform")?e.attrString("platform"):void 0,peer_app_version:e.hasAttr("version")?e.attrString("version"):void 0,epoch_msec:e.hasAttr("t")?String(1e3*e.attrInt("t")):void 0,elapsed_msec:e.hasAttr("e")?String(1e3*e.attrInt("e")):void 0,type:g(r),common:{call_id:n,peer_jid:t.toString(),type:String(g(r))},isVideoCall:r.hasChild("video"),t:e.attrTime("t")};return{from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),stanzaId:e.attrString("id"),payloadTag:r.tag(),message:a,callCreator:i}}throw new Error("Unrecognized call stanza")}));function y(e,t,r,n,a){let o;switch(a){case _.TYPE.OFFER:o=(0,i.wap)("offer",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.ENC_REKEY:o=(0,i.wap)("enc_rekey",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.ACCEPT:o=(0,i.wap)("accept",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.REJECT:o=(0,i.wap)("reject",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)})}(0,s.castStanza)((0,i.wap)("receipt",{to:(0,h.JID)(e),id:(0,i.CUSTOM_STRING)(t),from:(0,h.JID)((0,l.getMaybeMeUser)())},o))}},71419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),o=r(31914),s=r(71914),l=r(81663),c=r(79711),d=r(84356),u=r(39410);const p=new s.WapParser("rekeyRetryReceiptParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","enc_rekey_retry");const t=e.child("enc_rekey");return{from:(0,l.jidWithTypeToWid)(e.attrJidWithType("from")),originalMsgId:t.attrString("call-id"),stanzaId:e.attrString("id"),retryCount:t.hasAttr("count")?t.attrInt("count"):0,regId:e.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}}));function f(){return(f=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve();const r=t.success,n=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)((0,a.default)(r.stanzaId,"retryInfo.stanzaId")),to:(0,u.JID)(r.from),class:"receipt",type:"enc_rekey_retry"});try{return(yield(0,c.handleVoipRetryRequest)(r))?d.Voip.resendEncRekeyRetry(r.from.toString({legacy:!0,formatFull:!0}),r.retryCount):(__LOG__(3)`voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry`,d.Voip.endCall(r.originalMsgId)),n}catch(e){return __LOG__(3)`voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry`,n}}))).apply(this,arguments)}},66337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{stanzaId:r,fromWid:n,callCreator:a,callId:o,isGroup:d,isVideo:u,t:p}=t.success;return(0,s.default)(a,o,p,u,d),Promise.resolve((0,i.wap)("ack",{to:(0,l.JID)(n),id:(0,i.CUSTOM_STRING)(r),class:"call",type:(0,i.CUSTOM_STRING)("offer_notice")}))};var i=r(31914),a=r(71914),o=r(81663),s=n(r(42285)),l=r(39410);const c=new a.WapParser("callOfferNoticeParser",(e=>{e.assertTag("call");const t=e.attrString("id"),r=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.child("offer_notice");return{stanzaId:t,fromWid:r,callCreator:(0,o.deviceJidToDeviceWid)(n.attrPhoneDeviceJid("call-creator")),callId:n.attrString("call-id"),isGroup:"group"===n.attrString("type"),isVideo:"video"===n.attrString("media"),t:e.attrTime("t")}}))},89370:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"handleCall",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"handleEncRekeyRetryRequest",{enumerable:!0,get:function(){return a.default}});var i=n(r(2634)),a=n(r(71419))},51836:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCertificateDetailsParams=function(e){return{serial:e.serial,name:e.verifiedName,isApi:"ent:wa"===e.issuer}},t.getParsedProtoObjects=function(e){if(!e)return null;const t=(0,n.decodeProtobuf)(i.VerifiedNameCertificateSpec,e);if(!t.details)throw new Error("verifyCertificate cert missing details");if(!t.signature)throw new Error("verifyCertificate cert missing signature");const r=(0,n.decodeProtobuf)(i.VerifiedNameCertificate$DetailsSpec,t.details);return{cert:t,details:r}};var n=r(84902),i=r(91344)},45033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.CiphertextType=void 0;const n=r(76672)({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg"});t.CiphertextType=n;const i=r(76672)({Photo:"photo",Video:"video",Audio:"audio",Ptt:"ptt",Location:"location",Contact:"contact",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"live_location",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product"});t.MediaType=i},68819:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getJobManager=function(){if(null==d)throw new Error("jobs manager has not been initialized");return d},t.maybeCreateJob=f,t.startWebPersistedJobManager=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(87614),o=r(47901),s=r(92844),l=r(16703),c=n(r(56816));let d=null;function u(){return(u=(0,i.default)((function*(){yield(0,l.initialize)();const e=(0,l.getJobsTable)();d=new o.PersistedJobManager({accessors:p(),unfinishedJobEntries:e.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:()=>{},onJobFinished:()=>null},deprecatedJobs:[]}),(0,c.default)(d)}))).apply(this,arguments)}function p(){return{deletePersistedJob:e=>(0,l.getJobsTable)().remove(e),updatePersistedJob:e=>(0,l.getJobsTable)().createOrReplace(e),readPersistedJob:e=>(0,l.getJobsTable)().get(e),maybeCreateJob:f}}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,r;const n=(0,l.getJobsTable)(),i=JSON.stringify([e.type,null!==(t=e.uniqKey)&&void 0!==t?t:(0,a.randomHex)(32)]),c={type:e.type,uniqKey:i,startTime:(0,s.unixTime)(),version:null!==(r=e.version)&&void 0!==r?r:1,original:e.args,current:e.args,step:o.UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(null==e.uniqKey)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const d=yield n.equals(["uniqKey"],[e.uniqKey]);if(0===d.length)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const u=[];let p=null;for(const e of d)e.step!==o.FINISHED_JOB?p=e:u.push(n.remove(e.jobId));return yield Promise.all(u),null!=p?{id:p.jobId,newlyCreated:!1}:n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})))}))).apply(this,arguments)}},97398:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureE2ESessions=m,t.ensureE2ESessionsWithDelay=function(e,t){const r=new s.ShiftTimer((()=>{m(e)}));e.forEach((e=>{h.set(String(e),r)})),r.onOrAfter(1e3*t)},t.splitWidsIntoChunks=S;var i=n(r(48926)),a=r(52230),o=r(27870),s=r(57319),l=r(31914),c=r(71914),d=r(81663),u=r(86945),p=r(24747),f=r(77605),_=r(39410);const h=new Map,g=new o.PromiseQueueMap;function m(e){const t=e.map((e=>e.toString())).join();e.forEach((e=>{const t=h.get(e.toString());t&&(t.cancel(),h.delete(e.toString()))})),__LOG__(2)`ensureE2ESession ${t}`;const r=g.waitIfPending(t);if(r)return __LOG__(2)`ensureE2ESession deduped ${t}`,r;const n=f.Session.hasSignalSessions(e).then(function(){var t=(0,i.default)((function*(t){const r=e.filter(((e,r)=>!t[r]));if(r.length>0){const{depletedPrekeyCount:e}=yield function(){return E.apply(this,arguments)}(r);return{missedPrekeyCount:r.length,depletedPrekeyCount:e}}return{missedPrekeyCount:0,depletedPrekeyCount:0}}));return function(){return t.apply(this,arguments)}}());return g.enqueueHandlers(t,n)}const y=new c.WapParser("e2eSessionParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`establishE2ESessionParser bad response: ${r} ${n}`)}{const t=e.child("skey"),r=e.hasChild("key")?e.child("key"):null,n=e.hasChild("device-identity")?e.child("device-identity").contentBytes():null;return{wid:(0,d.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid")),regId:e.child("registration").contentUint(4),identity:e.child("identity").contentBytes(32),deviceIdentity:n,skey:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32),signature:t.child("signature").contentBytes(64)},key:r&&{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32)}}}}))));function E(){return(E=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=new o.PromiseQueue,n=new o.PromiseQueue;let s=0;return S(e,(0,u.getABPropConfigValue)("web_prekeys_fetch_first_batch_size")).forEach((e=>{r.enqueue((0,i.default)((function*(){const r=e.map((e=>(0,l.wap)("user",{jid:(0,_.DEVICE_JID)(e),reason:t?"identity":l.DROP_ATTR}))),o=(0,l.wap)("iq",{id:(0,l.generateId)(),xmlns:"encrypt",type:"get",to:l.S_WHATSAPP_NET},(0,l.wap)("key",null,r)),c=yield(0,p.sendIq)(o,y);if(!c.success)throw new Error(`establishE2ESession bad response ${String(c)}`);const d=c.result;if(!d||d.length<=0)throw new Error("establishE2ESession: empty keyInfo");n.enqueue((0,i.default)((function*(){const e=[],t=[];d.forEach((r=>{null!=r.wid.device&&r.wid.device!==a.DEFAULT_DEVICE_ID?t.push(r):e.push(r),r.key||s++}));const r=e=>f.Session.createSignalSession(e).catch((t=>{__LOG__(4,void 0,new Error,!0)`createSignalSession: failed for device ${e.wid} with error ${t}`,SEND_LOGS("createSignalSession-fail")}));yield Promise.all(e.map((e=>r(e)))),yield Promise.all(t.map((e=>r(e))))})))})))})),__LOG__(2)`establishE2ESession: successfully established E2E sessions`,yield r.wait(),yield n.wait(),{depletedPrekeyCount:s}}))).apply(this,arguments)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<500)return[e];const r=Math.max(Math.min(t,1),0),n=Math.ceil(r*e.length);return[e.slice(0,n),e.slice(n)].filter((e=>e.length>0))}},63442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMerchantCompliance=function(){return f.apply(this,arguments)},t.setMerchantCompliance=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(24747),c=r(39410),d=r(77591);const u=e=>{var t,r,n;return{email:(null==e||null===(t=e.maybeChild("email"))||void 0===t?void 0:t.contentString())||"",landline_number:(null==e||null===(r=e.maybeChild("landline_number"))||void 0===r?void 0:r.contentString())||"",mobile_number:(null==e||null===(n=e.maybeChild("mobile_number"))||void 0===n?void 0:n.contentString())||""}},p=new s.WapParser("merchantComplianceResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.forEachChildWithTag("merchant_info",(e=>{var r,n,i,o;const s=(null===(r=e.maybeChild("entity_name"))||void 0===r?void 0:r.contentString())||"",l=(null===(n=e.maybeChild("entity_type"))||void 0===n?void 0:n.contentString())||"",c=null===(i=e.maybeChild("entity_type_custom"))||void 0===i?void 0:i.contentString(),d="true"===e.attrString("is_registered"),p=e.maybeChild("customer_care_details"),f=e.maybeChild("grievance_officer_details"),_=(0,a.default)({},u(p)),h=(0,a.default)({name:(null==f||null===(o=f.maybeChild("name"))||void 0===o?void 0:o.contentString())||""},u(f));t.push({entity_name:s,entity_type:l,is_registered:d,entity_type_custom:c,customer_care_details:_,grievance_officer_details:h})})),t}));function f(){return(f=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"get",smax_id:"53"},e.map((e=>(0,o.wap)("merchant_info",{jid:(0,c.USER_JID)(e.wid)})))),r=yield(0,l.sendIq)(t,p);if(r.success)return r.result;throw new d.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){let{entityName:e,entityType:t,isRegistered:r,entityTypeCustom:n,customerCareDetails:i,grievanceOfficerDetails:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"set",smax_id:"54"},(0,o.wap)("merchant_info",{is_registered:r?"true":"false"},void 0!==e?(0,o.wap)("entity_name",null,e):null,void 0!==t?(0,o.wap)("entity_type",null,t):null,void 0!==n?(0,o.wap)("entity_type_custom",null,n):null,i?(0,o.wap)("customer_care_details",null,void 0!==i.email?(0,o.wap)("email",null,i.email):null,void 0!==i.landlineNumber?(0,o.wap)("landline_number",null,i.landlineNumber):null,void 0!==i.mobileNumber?(0,o.wap)("mobile_number",null,i.mobileNumber):null):null,a?(0,o.wap)("grievance_officer_details",null,void 0!==a.name?(0,o.wap)("name",null,a.name):null,void 0!==a.email?(0,o.wap)("email",null,a.email):null,void 0!==a.landlineNumber?(0,o.wap)("landline_number",null,a.landlineNumber):null,void 0!==a.mobileNumber?(0,o.wap)("mobile_number",null,a.mobileNumber):null):null)),c=yield(0,l.sendIq)(s,p);if(c.success)return c.result;throw new d.ServerStatusCodeError(c.errorCode)}))).apply(this,arguments)}},63728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addPlaceHolderAction=function(e){d(e,{placeholderActionInd:l.default.PLACEHOLDER_ACTION.ADD}).commit()},t.populatePlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.POPULATE}).commit()},t.viewPlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.VIEW}).commit()};var i=n(r(81109)),a=r(92844),o=n(r(89867)),s=r(45454),l=n(r(11339)),c=r(12896);function d(e,t){const n=new(r(17304).Msg)(e),c=new l.default.PlaceholderActivity((0,i.default)({placeholderChatTypeInd:o.default.isGroup(n.from)||o.default.isGroup(n.to)?l.default.PLACEHOLDER_CHAT_TYPE.GROUP:l.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,a.unixTime)()-n.t,0),placeholderTypeInd:"fanout"===n.subtype?l.default.PLACEHOLDER_TYPE.FANOUT:l.default.PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:Boolean(n.asRevoked),messageMediaType:n.getWamMediaType(),messageType:n.getWamMessageType()},t));return function(e,t){let n;o.default.isGroup(e.from)?n=e.from instanceof o.default?e.from:(0,s.createWidFromWidLike)(e.from):o.default.isGroup(e.to)&&(n=e.to);if(null!=n&&n.isGroup()){var i;const e=null===(i=r(63928).default.get(n))||void 0===i?void 0:i.cachedDeviceSizeBucket;null!=e&&(t.deviceSizeBucket=e)}}(n,c),c}},24872:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllContactsFromChatCollectionIntoChunks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const t=[],r=[],n=new Set;let i=new Set;for(const a of l.ChatCollection.toArray())i.size===e&&(t.push(i),i=new Set),a.isBroadcast||(a.isGroup?r.push(a.id):n.has(a.id)||(i.add(a.id),n.add(a.id)));for(const s of r){var a,o;const r=l.ChatCollection.get(s)||{},c=null!==(a=null===(o=r.groupMetadata)||void 0===o?void 0:o.participants.toArray())&&void 0!==a?a:[];for(const r of c)i.size===e&&(t.push(i),i=new Set),n.has(r.id)||(i.add(r.id),n.add(r.id))}0!==i.size&&t.push(i);return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${t.length} chunks of contacts from chat collection, chunk size: ${e}`,t},t.getAndUpdateNonAddressBookContacts=function(){return g.apply(this,arguments)},t.getNonAddressBookContactsAndMarkAllContactsDirty=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(72441),o=n(r(89867)),s=r(45454),l=r(69951),c=r(76214),d=r(99069);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){const e=new Set;return yield(0,c.getParticipantTable)().forEach((t=>{t.participants.forEach((t=>{e.add((0,a.toPhoneUserJid)((0,s.createWid)(t).user))}))})),yield(0,c.getChatTable)().forEach((t=>{o.default.isUser(t.id)&&e.add((0,a.toPhoneUserJid)((0,s.createWid)(t.id).user))})),__LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${e.size} contacts from chat and group participant tables`,Array.from(e)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=yield e.anyOf(["isAddressBookContact"],[1,0]),r=new Set(t.map((e=>e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${r.size} contacts with set isAddressBookContact value from contact table`,r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield f(r),i=Array.from(e).map((e=>n.has(e)?{id:e,isContactSyncCompleted:0}:{id:e,isAddressBookContact:0,isContactSyncCompleted:0}));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${i.length} contacts dirty during the regular sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield f(r),i=e.filter((e=>!n.has(e))).map((e=>({id:e,isAddressBookContact:0,isContactSyncCompleted:0})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${i.length} non-address book contacts, mark dirty, and update the contact table during the inital sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}},10058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactListInChunksJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactListInChunks",(e=>(0,n.syncContactListInChunks)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldDelayBetweenChunks:t})},t.syncContactListJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactList",(e=>(0,n.syncContactList)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldSyncDevice:t})};var n=r(33192),i=r(1973),a=r(29731)},57062:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirtyJob=function(e){return(0,a.NonPersistJob)("markGroupAsDirty",(e=>(0,o.markGroupAsDirty)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})},t.modifyGroupParticipantJob=function(e,t,r,i,s){return(0,a.NonPersistJob)("modifyGroupParticipant",(e=>(0,o.modifyGroupParticipant)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:r,prevVersion:i,newVersion:s})},t.replaceParticipantsJob=function(e,t,r,i,s){return(0,a.NonPersistJob)("replaceParticipants",(e=>(0,o.replaceParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,admins:r,deviceIds:i,version:s})},t.updateGroupMetadataTableJob=function(e){return(0,a.NonPersistJob)("updateGroupMetadataTable",(e=>(0,i.updateGroupMetadataTable)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})},t.updateGroupParticipantTableWithoutDeviceSyncJob=function(e){return(0,a.NonPersistJob)("updateGroupParticipantTableWithoutDeviceSync",(e=>(0,o.updateGroupParticipantTableWithoutDeviceSync)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})};var n=r(1973),i=r(86791),a=r(29731),o=r(51727)},80474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipantsJob=function(e,t,r,o,s){return(0,i.NonPersistJob)("addParticipants",(e=>(0,a.addParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o,isOffline:s})},t.demoteParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("demoteParticipants",(e=>(0,a.demoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.promoteParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("promoteParticipants",(e=>(0,a.promoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.removeParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("removeParticipants",(e=>(0,a.removeParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.updateParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("updateParticipants",(e=>(0,a.updateParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,isOffline:o})};var n=r(1973),i=r(29731),a=r(18615)},61051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupJob=function(e,t,r){return(0,o.NonPersistJob)("queryGroup",function(){var e=(0,i.default)((function*(e){const t=yield(0,l.queryGroup)(e);return t.id&&(yield Promise.all([(0,a.updateGroupMetadataTable)({groupInfos:[t]}),(0,s.updateParticipants)({group:t.id,participants:t.participants,version:t.pvId,isOffline:null})])),t}));return function(){return e.apply(this,arguments)}}()).waitUntilCompleted({groupWid:e,request:t,phash:r})};var i=n(r(48926)),a=r(86791),o=r(29731),s=r(18615),l=r(2182)},10823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncDeviceListJob=function(e,t,r){return(0,a.NonPersistJob)("syncDeviceList",(e=>(0,n.syncDeviceList)(e))).waitUntilCompleted({wids:e,context:t,phash:r})},t.syncMyDeviceListJob=function(){return(0,a.NonPersistJob)("syncMyDeviceList",(()=>(0,n.syncMyDeviceList)()),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted()};var n=r(64114),i=r(1973),a=r(29731)},66101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.reportSyncdStatsJob=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(1973),s=n(r(11339)),l=r(29731),c=r(35047);function d(){return(d=(0,i.default)((function*(){if(yield(0,a.getABPropConfigValue)("md_app_state_report_md_sync_mutation_stats"))return new l.NonPersistJob("reportSyncdStats",(0,i.default)((function*(){const e=yield(0,c.generateActionStatCounts)();for(const t of e.values())new s.default.MdAppStateSyncMutationStats({syncdAction:t.action,applied:(0,c.convertToBucket)(t.applied),invalid:(0,c.convertToBucket)(t.invalid),orphan:(0,c.convertToBucket)(t.orphan),unsupported:(0,c.convertToBucket)(t.unsupported),failed:(0,c.convertToBucket)(t.failed)}).commit()})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()}))).apply(this,arguments)}},4454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.requestAllSyncdMissingKeysJob=function(){return new s.NonPersistJob("requestAllSyncdMissingKeys",(0,i.default)((function*(){yield(0,o.requestAllMissingKeys)(),setTimeout(l.setMissingKeyTimeout,2e4)})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=n(r(48926)),a=r(1973),o=r(84051),s=r(29731),l=r(93932)},5474:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncdSyncAllCollectionsJob=function(){return new s.NonPersistJob("syncdSyncAllCollections",(0,i.default)((function*(){__LOG__(2)`syncd: periodic sync for all collection`,yield(0,l.markCollectionsForSync)([a.CollectionName.CriticalBlock,a.CollectionName.CriticalUnblockLow,a.CollectionName.Regular,a.CollectionName.RegularLow,a.CollectionName.RegularHigh])})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=n(r(48926)),a=r(45606),o=r(1973),s=r(29731),l=r(38804)},1973:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JOB_PRIORITY=void 0;const n=r(76672)({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH"});t.JOB_PRIORITY=n},26681:(e,t,r)=>{"use strict";var n=r(95318);t.eE=void 0;var i=n(r(48926)),a=n(r(81109)),o=r(40265),s=r(87614),l=r(38284),c=r(1973);const d=c.JOB_PRIORITY.LOW;class u{constructor(){this._isInitialized=!1,this._tasks=[],this._pendingTasks=[]}init(e,t){var r;if(this._isInitialized)throw new Error("ConcurrentPreemptiveQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(r=e.maxConcurrencyPerJob)&&void 0!==r?r:{},this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("ConcurrentPreemptiveQueue not initialized");this._tasks=[],this._pendingTasks=[]}enqueue(e,t,r){var n=this;if(!this._isInitialized)return Promise.reject(new Error("ConcurrentPreemptiveQueue not initialized"));let l,u;const p=new Promise(((e,t)=>{l=e,u=t})),f=(0,a.default)({priority:d},r),_=(0,s.randomHex)(8).substr(0,64),h=this._addJobTask(e,f,_,(0,i.default)((function*(){try{n._jobLogger.logJobStarted(_);const e=yield n._promiseTimeoutWrapper(t(),null==r?void 0:r.maxTimeoutMs);n._jobLogger.logJobCompleted(_),l(e)}catch(e){e instanceof o.TimeoutError?n._jobLogger.logJobTimeout(_):n._jobLogger.logJobError(_),u(e)}})));return r&&r.priority===c.JOB_PRIORITY.UI_ACTION&&this._runJobTask(h),this._runJobTasks(),p}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobTask();if(null==e)break;this._runJobTask(e)}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,l.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){t._availableThreadsCount--,t._markJobTaskPending(e);const{run:r,jobId:n,jobName:i}=e;try{var a;yield t._promiseTimeoutWrapper(r(),void 0===(null===(a=e.jobInfo)||void 0===a?void 0:a.maxTimeoutMs)?1e4:void 0)}catch(e){if(!(e instanceof o.TimeoutError))throw e;t._jobLogger.logJobTimeout(n),__LOG__(2)`[job-orchestator]: ${i} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,t._markJobTaskDone(n),setTimeout((()=>t._runJobTasks()),0)}}))()}_addJobTask(e,t,r,n){const i={jobId:r,jobInfo:t,jobName:e,run:n};return this._jobLogger.logJobCreated({jobId:r,jobName:e,jobPriority:t.priority,pendingJobsCount:this._tasks.length}),this._tasks.push(i),i}_markJobTaskPending(e){this._pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this._pendingTasks.push(e),this._tasks=this._tasks.filter((t=>t.jobId!==e.jobId))}_markJobTaskDone(e){this._pendingTasks=this._pendingTasks.filter((t=>t.jobId!==e)),this._tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}_getNextJobTask(){if(0===this._tasks.length)return null;const e=this._pendingTasks.reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.jobName))&&void 0!==r?r:0;return e.set(t.jobName,n+1),e}),new Map);return this._tasks.filter((t=>{var r,n;return(null!==(r=e.get(t.jobName))&&void 0!==r?r:0)<(null!==(n=this._jobMaxConcurrency[t.jobName])&&void 0!==n?n:1)}))[0]}}const p=new u;t.eE=p},5215:(e,t,r)=>{"use strict";var n=r(95318);t.e=void 0;var i=n(r(48926)),a=r(87614),o=r(1973);const s=new class{constructor(){this._isInitialized=!1}init(e,t){if(this._isInitialized)throw new Error("DefaultNoQueue has already initialized");this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){}enqueue(e,t,r){var n=this;return(0,i.default)((function*(){var i;let s;const l=(0,a.randomHex)(8).substr(0,64);n._jobLogger.logJobCreated({jobId:l,jobName:e,jobPriority:null!==(i=null==r?void 0:r.priority)&&void 0!==i?i:o.JOB_PRIORITY.LOW,pendingJobsCount:0});try{n._jobLogger.logJobStarted(l),s=yield t(),n._jobLogger.logJobCompleted(l)}catch(e){throw n._jobLogger.logJobError(l),e}return s}))()}};t.e=s},26558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobInfoEvent=void 0;r(1973),n(r(11339));t.JobInfoEvent=class{constructor(e,t,r,n){this.jobName=e,this.scenario=n,this.pendingJobsCount=r,this.jobPriority=t}logJobAdded(){this.webcJobAddedT=Date.now()}logJobStarted(){this.webcJobStartedT=Date.now()}logJobCompleted(e){this.webcJobCompletedT=Date.now(),this.jobResultType=e}}},69221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=function(e){let t;if(e)t=r(5215).e;else{switch(function(){let e=s;e=i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(0,n.getABPropConfigValue)("web_orchestrator_enabled_version"):s;return e}()){case"preemptive":t=r(26681).eE;break;case"v2":case"v1":default:t=r(5215).e}}if(!t.isInitialized()){const e=function(){l||(l=new a.JobStatsLogger);return l}();t.init(o,e)}return t};var n=r(86945),i=r(7293),a=r(95236);const o={maxConcurrency:1},s="default";let l},95236:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobStatsLogger=void 0;n(r(81109)),n(r(52991)),r(26558);var i=n(r(11339));t.JobStatsLogger=class{constructor(){this._jobEventMap=new Map}logJobCreated(e){}logJobStarted(e){}logJobCompleted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.COMPLETED)}logJobError(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ERROR)}logJobTimeout(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.TIMEOUT)}logJobAborted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ABORTED)}_logJobFinished(e,t){}_maybeCommitJobEvent(e){}}},29731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonPersistJob=function(e,t,r){if("function"!=typeof t)throw new Error("NonPersistJob got invalid function param");const a=(0,i.getInstance)((null==r?void 0:r.priority)===n.JOB_PRIORITY.SKIP);return{fireAndForget(){a.enqueue(e,(()=>t.apply(null,arguments)),r)},waitUntilCompleted(){return a.enqueue(e,(()=>t.apply(null,arguments)),r)}}};var n=r(1973),i=r(69221)},47587:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveIb=function(e){const t=(0,a.wap)("ib",null,(0,a.wap)("passive",{value:(0,a.CUSTOM_STRING)(String(e))}));(0,s.castStanza)(t)},t.sendPassiveIq=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("passiveIqParser",(e=>{e.assertAttr("type","result")}));function c(){return(c=(0,i.default)((function*(e){const t=e?(0,a.wap)("passive",null):(0,a.wap)("active",null),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"passive",type:"set",id:(0,a.generateId)()},t),n=yield(0,s.sendIq)(r,l);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendPassiveIq: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}__LOG__(2)`sendPassiveIq: passive mode set to ${String(e)}`}))).apply(this,arguments)}},56816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){!function(e,t){Object.keys(t).forEach((r=>{t.hasOwnProperty(r)&&e.addPersistedJobImplementation(r,t[r])}))}(e,{rotateKey:()=>r.e(5179).then(r.bind(r,95179)).then((e=>e.default)),setAbout:()=>r.e(2776).then(r.bind(r,62776)).then((e=>e.default)),queryProductList:()=>r.e(1505).then(r.bind(r,71505)).then((e=>e.QueryProductListCatalog)),getPublicKey:()=>r.e(8578).then(r.bind(r,58578)).then((e=>e.QueryGetPublicKey)),getSignedUserInfo:()=>r.e(6801).then(r.bind(r,6801)).then((e=>e.QueryGetSignedUserInfo)),deleteReactions:()=>r.e(5377).then(r.bind(r,55377)).then((e=>e.default))})}},6684:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobSerializers=void 0;var n=r(57701),i=r(77591);const a={rotateKey:()=>({type:"rotateKey",args:{},uniqKey:"rotateKey"}),setAbout:e=>({type:"setAbout",args:{content:e},uniqKey:"setAbout"}),queryProductList(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if((0,n.commerceFeaturesDisabledBySanctions)())throw new i.E451;return{type:"queryProductList",args:{catalogWid:e.toString(),productIds:t,width:a,height:o,directConnectionEncryptedInfo:r},uniqKey:`queryProductList:${t.slice().sort().join(",")}:${a}:${o}`}},getPublicKey:e=>({type:"getPublicKey",args:{businessJid:e.toString()},uniqKey:`getPublicKey:${e.toString()}`}),getSignedUserInfo:e=>({type:"getSignedUserInfo",args:{businessJid:e.toString()},uniqKey:`getSignedUserInfo:${e.toString()}`}),deleteReactions:(e,t)=>({type:"deleteReactions",args:{chatId:e,parentMsgKeys:t},uniqKey:`deleteReactions:${e}`})};t.jobSerializers=a},93306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProductMD=function(){return f.apply(this,arguments)},t.addProductResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(65508),c=r(57701),d=r(90667),u=r(77591);const p=new o.WapParser("addProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_add").child("product");return(0,d.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,r){if((0,c.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_add",{v:"1"},(0,d.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,s.sendIqErrorParser)(n,p,l.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw null!=i.customError?new u.CatalogEditServerError(i.errorCode,i.customError):new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.addProductResponse=p},27534:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealProductMD=function(){return u.apply(this,arguments)},t.appealProductResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("appealProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("response").child("success").contentString()}));function u(){return(u=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"fb:thrift_iq"},(0,a.wap)("request",{type:"appeal_product"},(0,a.wap)("reason",null,t),(0,a.wap)("id",null,e))),n=yield(0,s.sendIq)(r,d);if(n.success)return n.result;if(451===n.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.appealProductResponse=d},23216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCatalogEventLogger=t.GRAPHQL_CATALOG_ENDPOINT=void 0;var i=n(r(11339));const a=i.default.GRAPHQL_CATALOG_ENDPOINT;t.GRAPHQL_CATALOG_ENDPOINT=a;t.createCatalogEventLogger=e=>{const t=new i.default.GraphqlCatalogRequest({graphqlCatalogEndpoint:e});return{success:()=>{t.set({graphqlErrorCode:-1,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.SUCCESS}),t.commit()},failure:e=>{let[r]=e;t.set({graphqlErrorCode:r.code,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.FAILURE}),t.commit()}}}},90880:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductCatalog=function(){return u.apply(this,arguments)},t.productCatalogCreateResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("productCatalogCreateResponse",(e=>{e.assertTag("iq"),e.assertFromServer(),e.child("product_catalog_create")}));function u(){return(u=(0,i.default)((function*(){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const e=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_create",{version:"1"})),t=yield(0,s.sendIq)(e,d);if(t.success)return t.result;if(451===t.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(t.errorCode)}))).apply(this,arguments)}t.productCatalogCreateResponse=d},15814:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProductsMD=function(){return u.apply(this,arguments)},t.productDeleteResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("productDeleteResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{deletedCount:e.child("product_catalog_delete").attrInt("deleted_count")}}));function u(){return(u=(0,i.default)((function*(e){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const t=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_delete",{v:"1"},e.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e)))))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;if(451===r.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}t.productDeleteResponse=d},21013:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(65508),c=r(57701),d=r(90667),u=r(77591);const p=new o.WapParser("editProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_edit").child("product");return(0,d.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,r){if((0,c.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_edit",{v:"1"},(0,d.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,s.sendIqErrorParser)(n,p,l.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw i.customError?new u.CatalogEditServerError(i.errorCode,i.customError):new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},90667:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseLegacyProductErrorReason=function(e){if(null!=e){const t=Object.keys(e)[0];return[{name:t,reason:e[t]||"",detail:e.detail}]}return[]},t.parseProductNode=void 0,t.productModelToNode=function(e){var t,r;const n=e.id?(0,a.wap)("id",null,e.id.toString()):void 0,c=e.description?(0,a.wap)("description",null,e.description):void 0,d=e.url?(0,a.wap)("url",null,e.url):void 0,u=e.retailerId?(0,a.wap)("retailer_id",null,e.retailerId):void 0,p=null!=e.priceAmount1000?(0,a.wap)("currency",null,e.currency):void 0,f=null!=e.priceAmount1000?(0,a.wap)("price",null,e.priceAmount1000.toString()):void 0,_=[(0,a.wap)("image",null,(0,a.wap)("url",null,e.imageCdnUrl))].concat(null===(t=e.additionalImageCdnUrl)||void 0===t?void 0:t.map((e=>(0,a.wap)("image",null,(0,a.wap)("url",null,e))))),h=function(e){var t,r,n,i,s,l;const{isExempt:c,hasCountryCodeOrigin:d,hasImporterName:u,hasImporterAddress:p}=(0,o.scanComplianceInfoForMissingData)(e);return!c&&(d||u||p)?(0,a.wap)("compliance_info",null,d?(0,a.wap)("country_code_origin",null,null==e?void 0:e.countryCodeOrigin):void 0,u?(0,a.wap)("importer_name",null,null==e?void 0:e.importerName):void 0,p?(0,a.wap)("importer_address",null,(null==e||null===(t=e.importerAddress)||void 0===t?void 0:t.street1)?(0,a.wap)("street1",null,e.importerAddress.street1):void 0,(null==e||null===(r=e.importerAddress)||void 0===r?void 0:r.street2)?(0,a.wap)("street2",null,e.importerAddress.street2):void 0,(null==e||null===(n=e.importerAddress)||void 0===n?void 0:n.city)?(0,a.wap)("city",null,e.importerAddress.city):void 0,(null==e||null===(i=e.importerAddress)||void 0===i?void 0:i.region)?(0,a.wap)("region",null,e.importerAddress.region):void 0,(null==e||null===(s=e.importerAddress)||void 0===s?void 0:s.postalCode)?(0,a.wap)("postal_code",null,e.importerAddress.postalCode):void 0,(null==e||null===(l=e.importerAddress)||void 0===l?void 0:l.countryCode)?(0,a.wap)("country_code",null,e.importerAddress.countryCode):void 0):void 0):void 0}(e.complianceInfo),g=(0,i.default)({is_hidden:e.isHidden?"true":"false"},(null===(r=e.complianceInfo)||void 0===r?void 0:r.countryCodeOrigin)===String(s.SyntheticCountryCode.NotApplicable)?{compliance_category:l.ProductComplianceCategory.CountryOriginExempt}:void 0);return(0,a.wap)("product",g,n,(0,a.wap)("name",null,e.name),c,d,u,(0,a.wap)("media",null,_),f,p,h)};var i=n(r(81109)),a=r(31914),o=r(72549),s=r(9978),l=r(6822);t.parseProductNode=e=>{var t,r,n;const a=e.child("id").contentString(),o=e.maybeChild("url");let c="";o&&o.hasContent()&&(c=o.contentString());const d=e.child("name").contentString(),u=null!==(t=e.maybeAttrString("availability"))&&void 0!==t?t:l.ProductAvailability.UNKNOWN,p=e.maybeChild("description"),f=p?p.contentString():"",_=e.maybeChild("belongs_to"),h="true"===(null==_?void 0:_.contentString())||!1,g=[],m=[],y=[],E=e.child("media");let S=!0;E.forEachChildWithTag("image",(e=>{if(S)S=!1,g.push({key:"requested",value:e.child("request_image_url").contentString()}),g.push({key:"full",value:e.child("original_image_url").contentString()}),y.push(e.child("id").contentString());else{const t=[];t.push({key:"requested",value:e.child("request_image_url").contentString()}),t.push({key:"full",value:e.child("original_image_url").contentString()}),m.push(t),y.push(e.child("id").contentString())}}));const v=e.maybeChild("status_info"),T=(null==v?void 0:v.child("status").contentString())||"APPROVED",C=null==v||null===(r=v.maybeChild("can_appeal"))||void 0===r?void 0:r.contentString(),A=e.maybeChild("currency"),b=A?A.contentString():void 0,P=e.maybeChild("price"),M=null==P?void 0:P.contentString(),O=e.maybeChild("retailer_id"),I=O?O.contentString():"",w=!!e.hasAttr("is_hidden")&&"true"===e.attrString("is_hidden"),R=e.hasAttr("compliance_category")?l.ProductComplianceCategory.cast(e.attrString("compliance_category")):l.ProductComplianceCategory.Default,D=e.maybeChild("sale_price"),N=D?(0,i.default)({sale_price:null===(n=D.maybeChild("price"))||void 0===n?void 0:n.contentString()},D.hasChild("start_date")&&D.hasChild("end_date")?{sale_start_date:D.child("start_date").contentString(),sale_end_date:D.child("end_date").contentString()}:null):null,L=(0,i.default)({id:a,is_hidden:w,url:c,name:d,description:f,availability:u,additional_image_cdn_urls:m,image_cdn_urls:g,capability_to_review_status:[{key:"WHATSAPP",value:T}],whatsapp_product_can_appeal:"true"===C,image_hashes_for_whatsapp:y,currency:b,price:M,retailer_id:I,checkmark:h},N),k=e.maybeChild("compliance_info");return R===l.ProductComplianceCategory.CountryOriginExempt?L.compliance_info={country_code_origin:String(s.SyntheticCountryCode.NotApplicable)}:k&&(L.compliance_info=function(e){var t;const r=e.child("country_code_origin").contentString(),n=null===(t=e.maybeChild("importer_name"))||void 0===t?void 0:t.contentString(),i=e.maybeChild("importer_address"),a={country_code_origin:r,importer_name:n};var o,s,l;i&&(a.importer_address={street1:i.child("street1").contentString(),street2:null===(o=i.maybeChild("street2"))||void 0===o?void 0:o.contentString(),postal_code:null===(s=i.maybeChild("postal_code"))||void 0===s?void 0:s.contentString(),city:i.child("city").contentString(),region:null===(l=i.maybeChild("region"))||void 0===l?void 0:l.contentString(),country_code:i.child("country_code").contentString()});return a}(k)),L}},53069:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseProductGraphQL=function(e){var t,r,n,u,p,f,_,h;let{status_info:g,sale_price:m,availability:y,compliance_info:E}=e,S=(0,a.default)(e,c);const[v,...T]=null!==(t=null===(r=S.media)||void 0===r?void 0:r.images)&&void 0!==t?t:[],C=(0,i.default)((0,i.default)({id:(0,o.default)(S.id,"product.id"),retailer_id:null!==(n=S.retailer_id)&&void 0!==n?n:"",name:(0,o.default)(S.name,"product.name"),description:null!==(u=S.description)&&void 0!==u?u:"",url:null!==(p=S.url)&&void 0!==p?p:"",currency:S.currency,price:S.price,is_hidden:"ISHIDDEN_TRUE"===S.is_hidden,availability:y&&y in d?d[y]:l.ProductAvailability.UNKNOWN},null!=(null==m?void 0:m.price)?(0,i.default)({sale_price:m.price},null!=m.start_date&&null!=m.end_date?{sale_start_date:m.start_date,sale_end_date:m.end_date}:null):null),{},{checkmark:"true"===S.belongs_to,image_hashes_for_whatsapp:(null!==(f=null===(_=S.media)||void 0===_?void 0:_.images)&&void 0!==f?f:[]).map((e=>(0,o.default)(e.id,"img.id"))),image_cdn_urls:v?[{key:"requested",value:(0,o.default)(v.request_image_url,"firstImage.request_image_url")},{key:"full",value:(0,o.default)(v.original_image_url,"firstImage.original_image_url")}]:[],additional_image_cdn_urls:T.map((e=>[{key:"requested",value:(0,o.default)(e.request_image_url,"img.request_image_url")},{key:"full",value:(0,o.default)(e.original_image_url,"img.original_image_url")}])),whatsapp_product_can_appeal:"true"===(null==g?void 0:g.can_appeal),capability_to_review_status:[{key:"WHATSAPP",value:null!==(h=null==g?void 0:g.status)&&void 0!==h?h:"APPROVED"}]});if(null!=E){var A,b,P,M,O;const{importer_address:e}=E;C.compliance_info="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"===S.compliance_category?{country_code_origin:s.SyntheticCountryCode.NotApplicable}:{country_code_origin:null!==(A=E.country_code_origin)&&void 0!==A?A:void 0,importer_name:null!==(b=E.importer_name)&&void 0!==b?b:void 0,importer_address:{street1:(0,o.default)(null==e?void 0:e.street1,"importerAddress?.street1"),street2:null!==(P=null==e?void 0:e.street2)&&void 0!==P?P:void 0,postal_code:null!==(M=null==e?void 0:e.postal_code)&&void 0!==M?M:void 0,city:(0,o.default)(null==e?void 0:e.city,"importerAddress?.city"),region:null!==(O=null==e?void 0:e.region)&&void 0!==O?O:void 0,country_code:(0,o.default)(null==e?void 0:e.country_code,"importerAddress?.country_code")}}}return C};var i=n(r(81109)),a=n(r(6479)),o=n(r(45095)),s=(r(1321),r(9978)),l=r(6822);const c=["status_info","sale_price","availability","compliance_info"];const d={AVAILABILITY_INSTOCK:l.ProductAvailability.IN_STOCK,AVAILABILITY_OUTOFSTOCK:l.ProductAvailability.OUT_OF_STOCK}},17728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("visibilitySetResponse",(e=>{e.assertTag("iq"),e.assertFromServer()}));function u(){return(u=(0,i.default)((function*(e){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",smax_id:"23",id:(0,a.generateId)()},(0,a.wap)("product_visibility_update",{v:"1"},e.map((e=>(0,a.wap)("product",{is_hidden:e.isHidden?"true":"false"},(0,a.wap)("id",null,e.productId)))))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;if(451===r.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}},60323:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealCollection=function(){return b.apply(this,arguments)},t.createCollection=function(){return S.apply(this,arguments)},t.deleteCollection=function(){return T.apply(this,arguments)},t.editCollection=function(){return C.apply(this,arguments)},t.parseCollectionStatusInfoNode=void 0,t.queryCollections=function(){return h.apply(this,arguments)},t.querySingleCollection=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(90667),d=r(39410),u=r(77591);const p=e=>{var t,r,n;return{status:e.child("status").contentString(),canAppeal:"true"===(null===(t=e.maybeChild("can_appeal"))||void 0===t?void 0:t.contentString().toLowerCase()),rejectReason:null===(r=e.maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(n=e.maybeChild("commerce_url"))||void 0===n?void 0:n.contentString()}};t.parseCollectionStatusInfoNode=p;const f=e=>{var t;const r=e.maybeChild("status_info"),n=r?p(r):void 0,i=(null==n?void 0:n.status)||"APPROVED",a=!!n&&n.canAppeal,o={id:e.child("id").contentString(),name:e.child("name").contentString(),isHidden:"TRUE"===(null===(t=e.maybeChild("is_hidden"))||void 0===t?void 0:t.contentString()),rejectReason:null==n?void 0:n.rejectReason,commerceUrl:null==n?void 0:n.commerceUrl,totalItemsCount:0,products:[],reviewStatus:i,canAppeal:a};return e.forEachChildWithTag("product",(e=>{o.products.push((0,c.parseProductNode)(e))})),o},_=new o.WapParser("collectionsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collections"),r=[];t.forEachChildWithTag("collection",(e=>{r.push(f(e))}));const n=t.child("paging").child("after"),i=n.hasContent()?n.contentString():"";return{collections:r,afterCursor:i}}));function h(){return(h=(0,i.default)((function*(e,t,r,n,i,o){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const p=t?(0,a.wap)("after",null,t):void 0,f=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"35"},(0,a.wap)("collections",{biz_jid:(0,d.DEVICE_JID)(e)},(0,a.wap)("collection_limit",null,r.toString()),(0,a.wap)("item_limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,o.toString()),p,c?(0,a.wap)("direct_connection_encrypted_info",null,c):null)),h=yield(0,s.sendIq)(f,_);if(h.success)return h.result;if(404===h.errorCode)return{collections:[],afterCursor:""};if(451===h.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(h.errorCode)}))).apply(this,arguments)}const g=new o.WapParser("singleCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=f(t),n=t.child("paging").child("after");return{collections:[r],afterCursor:n.hasContent()?n.contentString():""}}));function m(){return(m=(0,i.default)((function*(e,t,r,n,i,o){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const p=r?(0,a.wap)("after",null,r):void 0,f=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"30"},(0,a.wap)("collection",{biz_jid:(0,d.DEVICE_JID)(e),id:(0,a.CUSTOM_STRING)(t)},(0,a.wap)("limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,o.toString()),p,c?(0,a.wap)("direct_connection_encrypted_info",null,c):null)),_=yield(0,s.sendIq)(f,g);if(_.success)return _.result;if(451===_.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(_.errorCode)}))).apply(this,arguments)}const y=new o.WapParser("createOrEditCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=t.child("id").contentString(),n=t.maybeChild("status_info");return{id:r,reviewStatus:n?p(n).status:"APPROVED"}})),E=new o.WapParser("createOrEditCollectionResponseErrorParser",(e=>{const t=e.attrString("code"),r=e.attrString("text"),n=e.maybeChild("field");return{code:t,text:r,fieldName:null==n?void 0:n.attrString("name"),fieldReason:null==n?void 0:n.attrString("reason")}}));function S(){return(S=(0,i.default)((function*(e,t,r){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=[];n.push((0,a.wap)("name",null,e)),n.push(...t.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e))))),n.push((0,a.wap)("catalog_session_id",null,r));const i=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"36"},(0,a.wap)("collection",{op:"create"},n)),o=yield(0,s.sendIqErrorParser)(i,y,E);if(o.success)return o.result;if(451===o.errorCode)throw new u.E451;throw o.customError}))).apply(this,arguments)}const v=new o.WapParser("deleteCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function T(){return(T=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"43"},(0,a.wap)("collections",{op:"delete"},(0,a.wap)("id",null,e),(0,a.wap)("catalog_session_id",null,t))),n=yield(0,s.sendIq)(r,v);if(!n.success){if(451===n.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(n.errorCode)}if(!n.result)throw new u.ServerStatusCodeError(500)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n,i,o){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const c=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"40"},(0,a.wap)("collection",{op:"update"},(0,a.wap)("id",null,e),t?(0,a.wap)("name",null,t):void 0,n.length>0?(0,a.wap)("add",null,n.map((e=>(0,a.wap)("id",null,e)))):void 0,i.length>0?(0,a.wap)("remove",null,i.map((e=>(0,a.wap)("id",null,e)))):void 0,(0,a.wap)("catalog_session_id",null,o))),d=yield(0,s.sendIqErrorParser)(c,y,E);if(d.success)return d.result;if(451===d.errorCode)throw new u.E451;throw d.customError}))).apply(this,arguments)}const A=new o.WapParser("appealCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function b(){return(b=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const r=t?(0,a.wap)("reason",null,t):void 0,n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"48"},(0,a.wap)("collection",{op:"appeal",id:(0,a.CUSTOM_STRING)(e)},r)),i=yield(0,s.sendIq)(n,A);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},92913:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAndUpdateBlocklist=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(73382),c=r(24747),d=r(37790),u=r(58052),p=r(64551);const f=new o.WapParser("blocklistParser",(e=>{const t={wids:[]};if(e.hasChild("error"))return function(e){const t=e&&e.maybeAttrString("code"),r=e&&e.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getBlocklist error: code ${t} text ${r}`,SEND_LOGS("getBlocklist")}(e.child("error")),t;e.assertAttr("type","result");const r=e.maybeChild("list");if(r){const e=r.maybeAttrString("dhash");e&&(t.dhash=e),r.hasChild("item")&&(t.wids=r.mapChildrenWithTag("item",(e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid"))))||[])}return t}));function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=(0,u.getBlocklistHash)(),t=(0,a.wap)("iq",{xmlns:"blocklist",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},e?(0,a.wap)("item",{dhash:(0,a.CUSTOM_STRING)(e)}):null),r=yield(0,c.sendIq)(t,f);if(!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`fetchBlocklist: failed ${e}, ${t}`,{errorCode:e,errorText:t}}return r.result?r.result:Promise.reject(new Error("response does not have blocked list"))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=p.ServerProps.mdBlocklistV2?_:d.getBlocklist;__LOG__(2)`[blocklist] fetch blocklist using blocklist ${p.ServerProps.mdBlocklistV2?"v2":"v1"}`;const t=yield e();return null!=t.errorCode||(t.dhash?(__LOG__(2)`[blocklist] updating blocklist with ${t.wids.length||0} contact(s)`,(0,u.setBlocklistHash)(t.dhash),yield(0,l.updateBlocklist)(t.wids)):__LOG__(2)`[blocklist] no change in blocklist, skip update`),t}))).apply(this,arguments)}},87117:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("businessCategoriesResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("response"),r=[];let n="";try{const e=t.maybeChild("not_a_biz");null==e||e.forEachChildWithTag("category",(e=>{n=e.attrString("id")}));t.child("categories").forEachChildWithTag("category",(e=>{const t=e.attrString("id"),i=e.contentString();r.push({id:t,localized_display_name:i,not_a_biz:!!n.length&&t===n})}))}catch(e){}return{categories:r,notABizId:n}}));function d(){return(d=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t?"profile_typeahead":"typeahead",n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"get"},(0,a.wap)("request",{op:(0,a.CUSTOM_STRING)(r),type:"catkit",v:"1"},(0,a.wap)("query",null,e))),i=yield(0,s.sendIq)(n,c);if(i.success)return i.result;throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},63638:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=n(r(76199)),d=r(39410),u=r(77591);const p=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("business_profile"),r=[];return t.forEachChildWithTag("profile",(e=>{const t=(0,s.jidWithTypeToWid)(e.attrJidWithType("jid")),n=e.attrString("tag"),i=(0,c.default)(e);Object.keys(i).length?r.push({wid:t,tag:n,profile:i}):r.push({wid:t,tag:n})})),r}));function f(){return(f=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"get"},(0,a.wap)("business_profile",{v:(0,a.INT)(t)},e.map((e=>(0,a.wap)("profile",{jid:(0,d.USER_JID)(e.wid),tag:null!=e.tag?(0,a.INT)(e.tag):a.DROP_ATTR}))))),n=yield(0,l.sendIq)(r,p);if(n.success)return n.result;throw new u.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},43077:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=n(r(48926)),o=r(31914),s=r(71914),l=r(1321),c=(n(r(99805)),r(23216)),d=r(24747),u=r(57701),p=r(90667),f=r(53069),_=r(39410),h=r(77591);const g=new s.WapParser("catalogResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog"),r=[];t.forEachChildWithTag("product",(e=>{e.maybeChild("id")&&r.push((0,p.parseProductNode)(e))}));const n=t.child("paging"),i=n.child("before"),a=i.hasContent()?i.contentString():"",o=n.child("after"),s=o.hasContent()?o.contentString():"";return{data:r,paging:{cursors:{after:s,before:a}}}}));const m=function(){var e=(0,a.default)((function*(e){let{catalogWid:t,afterCursor:r,limit:n,width:i,height:a,checkmarkCollectionId:s,allowShopSource:l,directConnectionEncryptedInfo:c=null}=e;if((0,u.commerceFeaturesDisabledBySanctions)())throw new h.E451;const p=r?(0,o.wap)("after",null,r):void 0,f=s?(0,o.wap)("belongs_to",null,(0,o.wap)("collection_id",null,s)):void 0,m=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,o.generateId)()},(0,o.wap)("product_catalog",{jid:(0,_.DEVICE_JID)(t),allow_shop_source:(y=l,y?"true":"false")},(0,o.wap)("limit",null,n.toString()),(0,o.wap)("width",null,i.toString()),(0,o.wap)("height",null,a.toString()),p,f,c?(0,o.wap)("direct_connection_encrypted_info",null,c):null));var y;const E=yield(0,d.sendIq)(m,g);if(E.success)return E.result;if(451===E.errorCode)throw new h.E451;throw new h.ServerStatusCodeError(E.errorCode)}));return function(){return e.apply(this,arguments)}}(),y=function(){var e=(0,a.default)((function*(e){if((0,u.commerceFeaturesDisabledBySanctions)())throw new h.E451;try{var t,n,a;const{catalogWid:o,afterCursor:s,limit:d,width:u,height:p,checkmarkCollectionId:_,allowShopSource:h,directConnectionEncryptedInfo:g}=e,m=yield(0,l.fetchQuery)(void 0!==i?i:i=r(25173),{request:{product_catalog:{jid:o.toString(),allow_shop_source:h?"ALLOWSHOPSOURCE_TRUE":"ALLOWSHOPSOURCE_FALSE",width:String(u),height:String(p),direct_connection_encrypted_info:g,limit:String(d),after:s,catalog_session_id:_,locale:(0,l.getLocaleVariable)()}}},{eventLogger:(0,c.createCatalogEventLogger)(c.GRAPHQL_CATALOG_ENDPOINT.GET_CATALOG)}),{paging:y,products:E}=(null==m||null===(t=m.xwa_product_catalog_get_product_catalog)||void 0===t?void 0:t.product_catalog)||{};return{data:E.map(f.parseProductGraphQL),paging:{cursors:{before:null!==(n=null==y?void 0:y.before)&&void 0!==n?n:"",after:null!==(a=null==y?void 0:y.after)&&void 0!==a?a:""}}}}catch(t){var o,s;const[r]=null!==(o=null===(s=t.source)||void 0===s?void 0:s.errors)&&void 0!==o?o:[];switch(null==r?void 0:r.code){case 2498030:case 2498031:case 2498033:case 2498029:case 2498032:case 2498027:throw new h.ServerStatusCodeError(400,t.message);case 2498048:throw new h.E451;case 2498047:throw new h.ServerStatusCodeError(421);default:return __LOG__(3)`GraphQL: Failed fetching query xwa_product_catalog_get_product_catalog. Falling back to IQ.`,m(e)}}}));return function(){return e.apply(this,arguments)}}();var E=e=>((0,u.graphQLForCatalogM1Enabled)()?y:m)(e);t.default=E},27678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=n(r(48926)),o=n(r(45095)),s=r(31914),l=r(71914),c=r(1321),d=(n(r(99805)),r(23216)),u=r(24747),p=r(57701),f=r(90667),_=r(53069),h=r(39410),g=r(77591);const m=new l.WapParser("productResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog").child("product");return(0,f.parseProductNode)(t)})),y=function(){var e=(0,a.default)((function*(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if((0,p.commerceFeaturesDisabledBySanctions)())throw new g.E451;const o=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,s.generateId)()},(0,s.wap)("product",{jid:(0,h.DEVICE_JID)(e)},(0,s.wap)("product_id",null,t),(0,s.wap)("width",null,r.toString()),(0,s.wap)("height",null,n.toString()),i?(0,s.wap)("fetch_compliance_info",null,i.toString()):void 0,a?(0,s.wap)("direct_connection_encrypted_info",null,a):null)),l=yield(0,u.sendIq)(o,m);if(l.success)return{data:l.result};if(404===l.errorCode)return{error:"NOT_FOUND"};throw 451===l.errorCode?new g.E451:new g.ServerStatusCodeError(l.errorCode)}));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,a.default)((function*(){if((0,p.commerceFeaturesDisabledBySanctions)())throw new g.E451;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[a,s,l,u,f=!1,h=null]=t;try{var m,E;const e=yield(0,c.fetchQuery)(void 0!==i?i:i=r(79341),{request:{product:{jid:a.toString(),product_id:s,width:String(l),height:String(u),fetch_compliance_info:String(f),direct_connection_encrypted_info:h,locale:(0,c.getLocaleVariable)()}}},{eventLogger:(0,d.createCatalogEventLogger)(d.GRAPHQL_CATALOG_ENDPOINT.GET_PRODUCT)}),t=(0,o.default)(null==e||null===(m=e.xwa_product_catalog_get_product)||void 0===m||null===(E=m.product_catalog)||void 0===E?void 0:E.product,"data?.xwa_product_catalog_get_product?.product_catalog?.product");return{data:(0,_.parseProductGraphQL)(t)}}catch(e){var S,v;const[r]=null!==(S=null===(v=e.source)||void 0===v?void 0:v.errors)&&void 0!==S?S:[];switch(null==r?void 0:r.code){case 2498036:return{error:"NOT_FOUND"};case 2498035:case 2498034:case 2498037:case 2498025:throw new g.ServerStatusCodeError(400,e.message);case 2498048:throw new g.E451;case 2498040:throw new g.ServerStatusCodeError(421);default:return __LOG__(3)`GraphQL: Failed fetching query xwa_product_catalog_get_product. Falling back to IQ.`,y(...t)}}}));return function(){return e.apply(this,arguments)}}();var S=function(){return((0,p.graphQLForCatalogM1Enabled)()?E:y)(...arguments)};t.default=S},99192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryDisappearingMode=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("dmParser",(e=>{const t=e.child("disappearing_mode");return{duration:t.attrInt("duration"),t:t.attrInt("t")}}));function d(){return(d=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"disappearing_mode",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()}),t=yield(0,s.sendIq)(e,c);if(!t.success)throw new l.ServerStatusCodeError(t.errorCode);return t.result}))).apply(this,arguments)}},71820:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExist=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(10435),o=r(79942),s=r(52284),l=r(77591);function c(){return(c=(0,i.default)((function*(e){const t=(new s.USyncQuery).withContactProtocol();t.withUser((new o.USyncUser).withPhone(e)),t.withBusinessProtocol(),(0,a.isDisappearingModeEnabled)()&&t.withDisappearingModeProtocol();const r=yield t.execute(),n=r.error.all||r.error.contact;if(n)return Promise.reject(new l.ServerStatusCodeError(n.errorCode,n.errorText));const{list:i}=r;if(1===i.length){const{id:e,contact:t,business:r,disappearing_mode:n}=i[0];if(t&&"in"===t.type){const t={wid:e,biz:!!r,bizInfo:r};return n&&(t.disappearingMode={duration:n.duration,settingTimestamp:n.t}),t}}return null}))).apply(this,arguments)}},78518:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mapParsedMediaConn=f,t.queryMediaConn=function(e){const t=new Date,r=(0,o.unixTime)(),n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:(0,s.generateId)()},(0,s.wap)("media_conn",null)),u=(0,l.sendIq)(n,a.mediaConnParser).then((e=>{if(e.success){__LOG__(2)`backend:queryMediaConn: got ${e.result.hosts.length} hosts`;const{auth:n,authTTL:a,ttl:o,hosts:s,maxBuckets:l}=f(e.result);if(!n||null==o||!s||0===s.length)throw __LOG__(2)`backend:queryMediaConnections: auth exists ${String(!!n)}`,__LOG__(2)`backend:queryMediaConnections: ttl exists ${String(!!o)}`,__LOG__(2)`backend:queryMediaConnections: hosts exists ${String(!!s)}`,s&&__LOG__(2)`backend:queryMediaConnections: hosts.length ${s.length}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("backend:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");return(0,i.default)({queryStartTime:t,auth:n,hosts:s,ttl:o-r,maxBuckets:l},null!=a?{authTTL:a-r}:null)}if(__LOG__(4,void 0,new Error,!0)`response: ${e.errorCode} ${e.errorText}`,SEND_LOGS("backend:queryMediaConn: fail"),507===e.errorCode)throw new d.E507(e.errorText,e.errorBackoff);throw new d.ServerStatusCodeError(e.errorCode,e.errorText)}));return(0,c.default)(u,e)};var i=n(r(81109)),a=r(48095),o=r(92844),s=r(31914),l=r(24747),c=n(r(84644)),d=r(77591);function u(e){switch(e){case"kyc-id":case"novi-image":case"novi-video":case"thumbnail-gif":case"ppic":return null;default:return e}}function p(e){return{hostname:e.domain,class:e.class,ips:[{ip4:e.ip4,ip6:e.ip6}]}}function f(e){var t,r;const n=e=>{const t=[],r=e.downloadable.map(u).filter(Boolean);r.length>0&&t.push({download:r});const n=e.uploadable.map(u).filter(Boolean);n.length>0&&t.push({upload:n});const i=e.downloadBuckets.map((e=>e.toString()));return null!=i&&i.length>0&&t.push({downloadBuckets:i}),t};return{hosts:e.hosts.map((e=>(0,i.default)((0,i.default)({},p(e)),{},{fallback:null!=e.fallback?p(e.fallback):void 0,type:e.isFallback?"fallback":"primary",rules:n(e)}))),auth:e.authToken,authTTL:null!==(t=e.authTTL)&&void 0!==t?t:void 0,ttl:e.authExpires,maxBuckets:null!==(r=e.maxBuckets)&&void 0!==r?r:void 0}}},25338:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryPrivacyDisallowedList=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747);r(61319);const c=new o.WapParser("getPrivacyDisallowedListParser",(e=>{const t=e.child("privacy").maybeChild("list");if(null==t)return{status:"match"};return{status:"mismatch",users:t.mapChildren((e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")))),dhash:t.attrString("dhash")}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)(),xmlns:"privacy"},(0,a.wap)("privacy",null,(0,a.wap)("list",{name:(0,a.CUSTOM_STRING)(e),value:(0,a.CUSTOM_STRING)("contact_blacklist")}))),r=yield(0,l.sendIq)(t,c);if(r.success)return r.result;throw new Error("invalid response")}))).apply(this,arguments)}},4831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPrivacy=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(68387),l=r(24747);function c(e,t){const r=t.maybeChild("error"),n=r&&r.maybeAttrString("code"),i=r&&r.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getPrivacy error: ${e} code ${n} text ${i}`,SEND_LOGS("getPrivacy")}const d=new o.WapParser("privacyParser",(e=>{e.assertAttr("type","result");const t={};return e.child("privacy").forEachChildWithTag("category",(e=>{switch(e.attrString("name")){case"readreceipts":{const r=e.attrEnum("value",s.ALL_NONE_WITH_ERROR);"error"!==r?t.readReceipts=r:c("readreceipts",e);break}case"last":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.lastSeen=r:c("last",e);break}case"profile":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.profilePicture=r:c("profile",e);break}case"status":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.about=r:c("status",e);break}case"groupadd":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.groupAdd=r:c("groupadd",e);break}default:c("unknown type",e)}})),t}));function u(){return(u=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"privacy",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},(0,a.wap)("privacy",null)),t=yield(0,l.sendIq)(e,d);if(t.success)return t.result;throw new Error("invalid response")}))).apply(this,arguments)}},66501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,n.wap)("iq",{xmlns:"w",id:(0,n.generateId)(),type:"get",to:n.S_WHATSAPP_NET},(0,n.wap)("props",null));return(0,a.sendIq)(e,o)};var n=r(31914),i=r(71914),a=r(24747);const o=new i.WapParser("serverProps",(e=>{e.assertTag("iq"),e.assertAttr("from","s.whatsapp.net");const t=e.child("props"),r={serverPropsVersion:t.attrInt("version")};return t.forEachChildWithTag("prop",(e=>{switch(e.attrString("name")){case"web_ctwa_context_compose_enabled":r.ctwaContextCompose=1===e.attrInt("value");break;case"ctwa_context_enabled":r.ctwaContextRender=1===e.attrInt("value")?1:0;break;case"ephemeral_messages_allowed_values":r.ephemeralMessagesAllowedValues=e.attrString("value");break;case"frequently_forwarded_max":r.frequentlyForwardedMax=e.attrInt("value");break;case"frequently_forwarded_threshold":r.frequentlyForwardedThreshold=e.attrInt("value");break;case"web_gif_search":r.gifSearch=e.attrString("value");break;case"group_call_max_participants":r.groupCallMaxParticipants=e.attrInt("value",0);break;case"group_description_length":r.groupDescLength=e.attrInt("value");break;case"hfm_string_changes":r.hfmStringChanges=e.attrInt("value");break;case"image_max_edge":r.imageMaxEdge=e.attrInt("value");break;case"image_max_kbytes":r.imageMaxKBytes=e.attrInt("value");break;case"image_quality":r.imageQuality=e.attrInt("value")/100;break;case"max_participants":r.maxParticipants=e.attrInt("value");break;case"max_subject":r.maxSubject=e.attrInt("value");break;case"max_keys":r.maxKeys=e.attrInt("value");break;case"media":r.media=e.attrInt("value");break;case"multicast_limit_global":r.multicastLimitGlobal=e.attrInt("value");break;case"mute_always":r.muteAlways=e.attrInt("value");break;case"mms_media_key_ttl":r.mmsMediaKeyTTL=e.attrInt("value");break;case"wallpapers_v2":r.wallpapersV2=e.attrInt("value");break;case"web_shops_chat_header_button_enabled":r.webShopsChatHeaderButtonEnabled=1===e.attrInt("value",0);break;case"shops_hide_catalog_attachment_entrypoint":r.shopsHideCatalogAttachmentEntrypoint=1===e.attrInt("value",0);break;case"shops_header_dropdown_menu_item":r.shopsHeaderDropdownMenuItem=1===e.attrInt("value",0);break;case"shops_product_grid":r.shopsProductGrid=e.attrInt("value",0);break;case"mms_hot_content_timespan_in_seconds":r.mmsHotContentTimespan=e.attrInt("value");break;case"mms_vcache_aggregation_enabled":r.mmsVCacheAggregationEnabled=1===e.attrInt("value");break;case"mms_vcard_autodownload_size_kb":r.mmsVcardAutodownloadSizeKb=e.attrInt("value");break;case"product_media_attachments":r.productMediaAttachments=e.attrInt("value");break;case"status_video_max_duration":r.statusVideoMaxDuration=e.attrInt("value");break;case"syncd_inline_mutations_max_count":r.syncdInlineMutationsMaxCount=e.attrInt("value");break;case"syncd_patch_protobuf_max_size":r.syncdPatchProtobufMaxSize=e.attrInt("value");break;case"syncd_key_max_use_days":r.syncdKeyMaxUseDays=e.attrInt("value");break;case"syncd_wait_for_key_timeout_days":r.syncdWaitForKeyTimeoutDays=e.attrInt("value");break;case"syncd_additional_mutations":r.syncdAdditionalMutations=e.attrInt("value");break;case"syncd_sentinel_timeout_seconds":r.syncdSentinelTimeoutSeconds=e.attrInt("value");break;case"syncd_patch_device_index_included":r.syncdPatchDeviceIndexIncluded=1===e.attrInt("value");break;case"syncd_clear_chat_delete_chat_enabled":r.syncdClearChatDeleteChatEnabled=1===e.attrInt("value");break;case"md_pin_chat_enabled":r.syncdPinChatEnabled=1===e.attrInt("value");break;case"template_doc_mime_types":r.templateDocMimeTypes=e.attrInt("value");break;case"web_biz_profile_options":r.webBizProfileOptions=e.attrInt("value");break;case"web_biz_profile_v3":r.webBizProfileV3=1===e.attrInt("value");break;case"view_once_read":r.viewOnceRead=e.attrInt("value");break;case"view_once_write":r.viewOnceWrite=e.attrInt("value");break;case"vcard_as_document_size_kb":r.vcardAsDocumentSizeKb=e.attrInt("value");break;case"vcard_max_size_kb":r.vcardMaxSizeKb=e.attrInt("value");break;case"md_blocklist_v2":r.mdBlocklistV2=1===e.attrInt("value");break;case"web_download_document_thumb_mms_enabled":r.webDownloadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_download_status_thumb_mms_enabled":r.webDownloadStatusThumbMmsEnabled=1===e.attrInt("value");break;case"web_send_document_thumb_in_message_disabled":r.webSendDocumentThumbInMessageDisabled=1===e.attrInt("value");break;case"web_upload_document_thumb_mms_enabled":r.webUploadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_list_message":r.webListMessage=1===e.attrInt("value");break;case"web_voip_mac_os_min_version":r.webVoipMacOsMinVersion=e.attrString("value");break;case"web_voip_windows_os_min_version":r.webVoipWindowsOsMinVersion=e.attrString("value");break;case"web_cart_enabled":r.webCart=1===e.attrInt("value");break;case"web_cart_v1_1_order_message_changes_enabled":r.webCartV11OrderMessageChanges=1===e.attrInt("value");break;case"mms_cat_v1_forward_hot_override_enabled":r.mmsCatV1ForwardHotOverrideEnabled=1===e.attrInt("value");break;case"web_buttons_message_enabled":r.webButtonsMessage=1===e.attrInt("value");break;case"web_product_list_message_fallback":r.webProductListMessageFallback=1===e.attrInt("value");break;case"web_product_list_message_render_kill_switch":r.webProductListMessageRenderKillSwitch=1===e.attrInt("value");break;case"web_smb_upsell_in_biz_profile_enabled":r.webSMBUpsellInBizProfile=1===e.attrInt("value");break;case"ptt_conversation_waveform":r.pttConversationWaveform=1===e.attrInt("value");break;case"ptt_oot_playback":r.pttOotPlayback=1===e.attrInt("value");break;case"ptt_forwarded_features_enabled":r.pttForwardedFeaturesEnabled=1===e.attrInt("value");break;case"ptt_pausable_enabled":r.pttPausableEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_enabled":r.pttPlaybackSpeedEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_hide_delay":r.pttPlaybackSpeedHideDelay=e.attrInt("value");break;case"web_product_list_message_page_size":r.webProductListMessagePageSize=e.attrInt("value");break;case"ptt_remember_play_position":r.pttRememberPlayPosition=1===e.attrInt("value");break;case"ptt_waveform_send":r.pttWaveformSend=1===e.attrInt("value");break;case"web_youtube_player_enhancements":r.webYouTubePlayerEnhancements=1===e.attrInt("value");break;case"web_server_sticker_panel":r.webServerStickerPanel=e.attrInt("value");break;case"web_collections_display_enabled":r.webCollectionsDisplay=1===e.attrInt("value");break;case"web_cart_on_off":r.webCartOnOffToggle=1===e.attrInt("value");break;case"web_product_list_message_enabled":r.webProductListMessage=1===e.attrInt("value");break;case"web_media_auto_download_enabled":r.webMediaAutoDownloadEnabled=1===e.attrInt("value");break;case"download_host_switching_enabled":r.downloadHostSwitchingEnabled=1===e.attrInt("value");break;case"upload_host_switching_enabled":r.uploadHostSwitchingEnabled=1===e.attrInt("value");break;case"web_is_direct_connection_for_plm_transparent":r.isDirectConnectionForPLMTransparent=1===e.attrInt("value");break;case"web_pip_redesign":r.webPipRedesign=1===e.attrInt("value");break;case"max_electron_file_size":r.maxElectronFileSize=e.attrInt("value");break;case"max_file_size":r.maxFileSize=e.attrInt("value");break;case"web_sticker_maker":r.stickerMaker=1===e.attrInt("value");break;case"web_md_migration_experience":r.webMdMigrationExperience=1===e.attrInt("value");break;case"web_log_upload_download_crashes":r.webLogUploadDownloadCrashes=1===e.attrInt("value");break;case"web_large_files_ui":r.webLargeFilesUi=1===e.attrInt("value");break;case"web_graphql_for_catalog_m1":r.webGraphQLForCatalogM1=1===e.attrInt("value");break;case"web_md_mms_sync_deletion_request":r.webMdMmsSyncDeletionRequest=1===e.attrInt("value");break;case"web_payment_background_enabled":r.webPaymentBackgroundEnabled=1===e.attrInt("value");break;case"web_forwarding_limit_to_groups":r.webForwardingLimitToGroups=1===e.attrInt("value");break;case"streaming_upload_chunk_size":r.streamingUploadChunkSize=e.attrInt("value")}})),r}))},74727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RECEIPT_TYPE=t.RECEIPT_MSG_TYPE=void 0,t.sendAggregateReceipts=function(){return h.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(71914),l=r(68387),c=r(24747),d=r(99234),u=r(39410);const p=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"});t.RECEIPT_TYPE=p;const f=Object.freeze({PEER:"peer"});t.RECEIPT_MSG_TYPE=f;const _=new s.WapParser("readReceiptAckParser",(e=>(e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",l.ALL_NONE):null})));function h(){return(h=(0,a.default)((function*(e,t,r,n,s,l){const f=t===p.READ||t===p.PLAYED||t===p.READ_SELF||t===p.PLAYED_SELF||t===p.HISTORY_SYNC_COMPLETION;yield Promise.all(Array.from(n.keys()).map((h=>{const g=n.get(h);if(!g||0===g.length)return;const m=e.isUser()?null:h,y=[];for(;g.length>0;){const n=g.splice(0,256);let h=null;n.length>1&&(h=(0,o.wap)("list",null,n.slice(1).map((e=>(0,o.wap)("item",{id:(0,o.CUSTOM_STRING)(e)})))));const E=(0,o.wap)("receipt",{to:(0,u.JID)(e),type:t===p.DELIVERY?o.DROP_ATTR:(0,o.CUSTOM_STRING)(t),msgtype:l?(0,o.CUSTOM_STRING)(l):o.DROP_ATTR,id:(0,o.CUSTOM_STRING)(n[0]),t:null!=r?(0,o.CUSTOM_STRING)(r):o.DROP_ATTR,participant:m?(0,u.DEVICE_JID)(m):o.DROP_ATTR,recipient:s?(0,u.USER_JID)(s):o.DROP_ATTR},h);if(f){const r=function(){var r=(0,a.default)((function*(){const r={id:n[0],from:e,class:"receipt",type:t,participant:m};if(t!==p.READ&&t!==p.READ_SELF)return(0,c.sendStanzaAndWaitForAck)(E,r);{const e=yield(0,c.sendStanzaAndReturnAck)(E,r),t=_.parse(e);if(t.error)__LOG__(4,void 0,new Error,!0)`[messaging] sendAggregateReceipts: Invalid ack from server`,SEND_LOGS("Invalid-Receipt-Ack");else{const{readReceipts:e}=t.success;null!=e&&(0,d.setUserPrivacySettings)((0,i.default)((0,i.default)({},(0,d.getUserPrivacySettings)()),{},{readReceipts:e}))}}}));return function(){return r.apply(this,arguments)}}();y.push(r())}else y.push((0,c.castStanza)(E))}return Promise.all(y)})))}))).apply(this,arguments)}},16927:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterDecryption=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const o=(0,h.default)(),l=(0,d.assertGetMe)(),c=!l.getDeviceId(),u=t.isUser()&&(0,s.toUserWid)(l).equals((0,s.toUserWid)(t))||null!=n&&(0,s.toUserWid)(l).equals((0,s.toUserWid)(n)),_=!(a===p.MSG_TYPES.reaction)&&(u||o||c);let g=Promise.resolve();if(!_){const r={msgId:e,chatId:t.toString(),participantId:n?n.toString():null};g=(0,f.getInactiveReceiptTable)().createOrReplace(r)}return g.then((()=>{if(m(e,t,r,n,_,u,i),_)return(0,f.getInactiveReceiptTable)().remove(e)}))}return Promise.resolve()},t.sendDeliveryReceiptsAfterPresence=function(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND))return(0,f.getInactiveReceiptTable)().all().then(function(){var e=(0,i.default)((function*(e){const t=new Map,r=Date.now().toString();return e.forEach((e=>{const{msgId:r,chatId:n,participantId:i}=e,a=(0,s.createWid)(n),o=(i?(0,s.createWid)(i):null)||a;let l=t.get(a);l||(l=new Map,t.set(a,l));let c=l.get(o);c||(c=[],l.set(o,c)),c.push(r)})),yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,_.sendAggregateReceipts)(e,_.RECEIPT_TYPE.DELIVERY,r,n)}))),(0,f.getInactiveReceiptTable)().bulkRemove(e.map((e=>e.msgId)))}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(31914),o=r(72441),s=r(45454),l=r(79196),c=r(24747),d=r(99234),u=r(7293),p=r(12037),f=r(76214),_=r(74727),h=n(r(84435)),g=r(39410);function m(e,t,r,n,i,s,d){let u=a.DROP_ATTR;d?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.PEER_MSG):s?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.SENDER):i||(u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.INACTIVE));const p=(0,o.extractJidFromJidWithType)((0,l.widToJidWithType)(t)),f=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(e),to:(0,a.JID)(p),participant:(t.isGroup()||t.isBroadcast())&&n?(0,g.DEVICE_JID)(n):a.DROP_ATTR,recipient:!d&&s&&r?(0,g.USER_JID)(r):a.DROP_ATTR,type:u});(0,c.castStanza)(f)}},61426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(24747),l=r(98969),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t,r){const n=(0,a.decodeB64)(r),{ciphertext:i,iv:d}=yield(0,l.encryptServerErrorReceipt)(n,t),u=(0,o.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(e),id:(0,o.CUSTOM_STRING)(t),category:"peer"},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,i),(0,o.wap)("enc_iv",null,d)));return(0,s.sendStanzaAndWaitForAck)(u,{id:t,class:"receipt",type:"server-error",from:e,participant:null})}))).apply(this,arguments)}},35099:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markChatRead=function(){return v.apply(this,arguments)},t.markStatusRead=function(){return T.apply(this,arguments)},t.sendReactionReadReceipts=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=n(r(45095)),s=r(92844),l=r(35470),c=n(r(65212)),d=r(15461),u=r(68387),p=r(67811),f=r(45454),_=r(48285),h=r(99234),g=r(90981),m=r(63728),y=r(74727);const E=(0,f.createWid)(a.STATUS_JID);function S(e){return e.isGroup()?y.RECEIPT_TYPE.READ:(0,h.getUserPrivacySettings)().readReceipts===u.ALL_NONE.none?y.RECEIPT_TYPE.READ_SELF:y.RECEIPT_TYPE.READ}function v(){return(v=(0,i.default)((function*(e,t){const r=Date.now().toString(),n=String(e.id),i=yield(0,g.getTable)().equals(["from","pendingReadReceipt"],[n,1],{shouldDecrypt:!1});i.sort(((e,t)=>(e.rowId||0)-(t.rowId||0)));const a=t?String(t):null;let o=i.length-1;if(a){for(;o>=0&&i[o].id!==a;o--);o<0&&(o=i.length-1)}let s=null;const l=[];for(;o>=0;o--){const e=i[o];null!=e.rowId&&(null==s||e.rowId>s)&&(s=e.rowId);const t=c.default.fromString(e.id);if(e.type===d.MSG_TYPE.CIPHERTEXT){(0,m.viewPlaceHolderAction)(e);continue}e.type===d.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype&&(0,m.viewPlaceHolderAction)(e);const r=e.broadcastId||e.from,n=e.author||e.from;l.push({id:t.id,sender:(0,f.createWidFromWidLike)(n),chat:(0,f.createWidFromWidLike)(r)})}const u=A(l);return yield Promise.all(Array.from(u.keys()).map((t=>{const n=u.get(t);if(!n)return;const i=S(e.id);return(0,y.sendAggregateReceipts)(t,i,r,n)}))),(0,_.markMessageAndChatAsRead)(s,n,!1)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if("status"!==e.remote.user)return void __LOG__(3)`markStatusRead: message is not a status.`;if(e.fromMe)return;yield(0,y.sendAggregateReceipts)(E,S(E),String(t),new Map([[(0,o.default)(e.participant,"msgKey.participant"),[e.id]]]));const r={ack:l.ACK.READ};e.participant&&e.participant.isPSA()&&(r.statusPSAReadTimestamp=t),yield(0,g.getTable)().merge(e.toString(),r)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){const t=String((0,s.unixTime)()),r=A(e.filter((e=>!(0,p.isReactionByMe)(e.senderUserJid))).map((e=>({chat:e.msgKey.remote,sender:(0,f.createWidFromWidLike)(e.senderUserJid),id:e.msgKey.id}))));yield Promise.all(Array.from(r.keys()).map((e=>{const n=r.get(e);if(n)return(0,y.sendAggregateReceipts)(e,y.RECEIPT_TYPE.READ_SELF,t,n)})))}))).apply(this,arguments)}function A(e){const t=new Map;return e.forEach((e=>{var r,n;let{chat:i,sender:a,id:o}=e;const s=null!==(r=t.get(i))&&void 0!==r?r:new Map,l=null!==(n=s.get(a))&&void 0!==n?n:[];l.push(o),s.set(a,l),t.set(i,s)})),t}},55253:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareKeysForRetry=E,t.sendRetryReceipt=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=n(r(64369)),s=r(45454),l=r(46308),c=r(24747),d=r(5087),u=r(99234),p=r(7293),f=r(58425),_=r(52083),h=r(11849),g=r(91335),m=r(39410);function y(){return(y=(0,i.default)((function*(e,t,r,n,i,o){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{const p=(0,_.getSignalProtocolStore)(),[f,h]=yield Promise.all([p.getLocalRegistrationId(),p.getIdentityKeyPair()]);if(null==f||null==h)throw new Error("No registration info found");const g=yield E(e,(0,d.toCurveKeyPair)(h));let y,S,v=a.DROP_ATTR,T=a.DROP_ATTR;if(t.isUser()){if(S=a.DROP_ATTR,y=(0,m.DEVICE_JID)(t),(0,u.getMeUser)().equals((0,s.toUserWid)(t)))if(l)v=(0,a.CUSTOM_STRING)("peer"),T=a.DROP_ATTR;else{if(!n)return Promise.reject(new Error("sendRetryReceipt: send retry to peer device without receipient"));T=(0,m.USER_JID)(n)}}else y=(0,m.CHAT_JID)(t),S=r?(0,m.DEVICE_JID)(r):a.DROP_ATTR;const C=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(i),to:y,participant:S,recipient:T,type:"retry",category:v},(0,a.wap)("retry",{v:"1",count:(0,a.INT)(e),id:(0,a.CUSTOM_STRING)(i),t:(0,a.CUSTOM_STRING)(o)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(f)),g);return(0,c.sendStanzaAndWaitForAck)(C,{id:i,class:"receipt",from:t,participant:r,type:"retry"})}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("sendRetryReceipt: error while creating or sending the retry message")}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const[r,n]=yield v(e,t);return n&&(yield h.waSignalStore.markKeyAsUploaded(n.keyId),yield h.waSignalStore.markPreKeyAsDirectDistribution(n.keyId)),r}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(e<2)return Promise.resolve([null,null]);let r=Promise.resolve(null);p.GK.supportsFeature(p.GK.F.MD_ADV)&&(r=(0,l.getADVEncodedIdentity)().then((e=>(0,a.wap)("device-identity",null,e))));try{const[e,n,i]=yield Promise.all([h.waSignalStore.getSignedPreKey(),h.waSignalStore.getOrGenSinglePreKey(f.generatePreKeyPair),r]);if(!e)throw new Error("Signed pre key is not available");return[(0,a.wap)("keys",null,(0,a.wap)("type",null,o.default.KEY_BUNDLE_TYPE),(0,a.wap)("identity",null,t.pubKey),(0,g.xmppPreKey)(n),(0,g.xmppSignedPreKey)(e),i),n]}catch(e){throw Error("Could not create keys section for retry")}}))).apply(this,arguments)}},27184:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(24747),l=r(99234),c=r(98969),d=r(39410);function u(){return(u=(0,i.default)((function*(e){const t=e.id.id,r=(0,a.decodeB64)(e.mediaKey),{ciphertext:n,iv:i}=yield(0,c.encryptServerErrorReceipt)(r,t),{chat:u}=e,p=(0,o.CUSTOM_STRING)(u.id.toString({legacy:!0})),f=u.isGroup||u.isBroadcast?(0,o.CUSTOM_STRING)(e.sender.toString({legacy:!0})):o.DROP_ATTR,_=(0,l.getMeUser)(),h=(0,o.wap)("receipt",{type:"server-error",to:(0,d.USER_JID)(_),id:(0,o.CUSTOM_STRING)(t)},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,n),(0,o.wap)("enc_iv",null,i)),(0,o.wap)("rmr",{jid:p,from_me:(0,o.CUSTOM_STRING)(String(e.isSentByMe)),participant:f}));return(0,s.sendStanzaAndWaitForAck)(h,{id:t,class:"receipt",type:"server-error",from:_,participant:null})}))).apply(this,arguments)}},93374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(39410),d=r(77591);const u=new o.WapParser("reportProductResponse",(e=>{e.assertTag("iq"),e.assertAttr("type","result")}));function p(){return(p=(0,i.default)((function*(e,t,r){if((0,l.commerceFeaturesDisabledBySanctions)())throw new d.E451;const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",type:"set",id:(0,a.generateId)()},(0,a.wap)("request",{type:"report_product",biz_jid:(0,c.USER_JID)(e)},r?(0,a.wap)("reason",null,r):void 0,(0,a.wap)("id",null,t))),i=yield(0,s.sendIq)(n,u);if(!i.success){if(451===i.errorCode)throw new d.E451;throw new d.ServerStatusCodeError(i.errorCode)}}))).apply(this,arguments)}},18701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getSpamMessageProtobuf=S,t.reportSpam=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=n(r(67154)),o=n(r(81109)),s=r(31914),l=r(71914),c=r(15461),d=r(60980),u=r(58853),p=r(24747),f=r(24808),_=r(99234),h=r(6565),g=r(93650),m=r(84728),y=r(39410);const E=new Set([c.MSG_TYPE.CHAT,c.MSG_TYPE.AUDIO,c.MSG_TYPE.IMAGE,c.MSG_TYPE.PTT,c.MSG_TYPE.VIDEO,c.MSG_TYPE.VCARD,c.MSG_TYPE.UNKNOWN,c.MSG_TYPE.CIPHERTEXT,c.MSG_TYPE.LIST,c.MSG_TYPE.LIST_RESPONSE,c.MSG_TYPE.BUTTONS_RESPONSE,c.MSG_TYPE.NATIVE_FLOW]);function S(e){return null==e.buttonsMessage||null!=e.buttonsMessage.buttons&&(e.buttonsMessage=(0,o.default)((0,o.default)({},e.buttonsMessage),{},{buttons:e.buttonsMessage.buttons.map((e=>{if(e.nativeFlowInfo){var t;const r=JSON.parse(null!==(t=e.nativeFlowInfo.paramsJson)&&void 0!==t?t:"{}");return delete r.reference_id,delete r.total_amount,(0,o.default)((0,o.default)({},e),{},{nativeFlowInfo:(0,o.default)((0,o.default)({},e.nativeFlowInfo),{},{paramsJson:JSON.stringify(r)})})}return e}))})),e}function v(e){const t=[],r=e.isGroup?null:e.id;return function(e,t,r){const n=[],i=e.msgs.toArray().reverse();for(let a=0;a<i.length&&!(n.length>=t);a++){const t=i[a];if(E.has(t.type)&&!t.from.equals((0,_.getMaybeMeUser)())){if(r){if(e.isGroup&&!r.equals(t.author))continue;if(e.isUser&&!r.equals(t.from))continue}n.push(t)}}return n}(e,5,r).forEach((r=>{let n,i,o,l;const p=r.t.toString(),_=r.isViewOnce&&!(0,m.isUnviewed)(r.safe());switch(r.type){case c.MSG_TYPE.UNKNOWN:l=null,n=s.DROP_ATTR,o=s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString());break;case c.MSG_TYPE.CIPHERTEXT:l=null,n=s.DROP_ATTR,o=s.DROP_ATTR,i=s.DROP_ATTR;break;default:let e={};if(r.asMms){e=r.isUnsentPhoneMsg()||_||!r.mediaObject?{type:r.type}:r.avParams()}const t=S((0,h.createMsgProtobuf)(r,e)),a=(0,u.mediaTypeFromProtobuf)(t);l=_?null:(0,d.encodeProtobuf)(f.MessageSpec,t).readByteArray(),n=(0,g.typeAttributeFromProtobuf)(t),o=a?(0,s.CUSTOM_STRING)(a):s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString())}let E;const v={};if(_&&(v.deleted_reason=(0,m.isViewed)(r.safe())?"view_once_opened":"view_once_expired"),e.isGroup){let t=s.DROP_ATTR;r.author?t=(0,y.USER_JID)(r.author):r.from.isUser()&&(t=(0,y.USER_JID)(r.from)),E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.CHAT_JID)(e.id),participant:t,id:(0,s.CUSTOM_STRING)(r.id.id),type:n}),(0,s.wap)("raw",{v:i,mediatype:o},l))}else E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.USER_JID)(r.from),to:(0,y.USER_JID)(r.to),type:n,id:(0,s.CUSTOM_STRING)(r.id.id)}),r.multicast?(0,s.wap)("multicast",null):null,r.urlNumber?(0,s.wap)("url_number",null):null,r.urlText?(0,s.wap)("url_text",null):null,(0,s.wap)("raw",{v:i,mediatype:o},l));t.push(E)})),t}const T=new l.WapParser("reportUserSpam",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`reportSpam: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`reportSpam: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function C(){return(C=(0,i.default)((function*(e,t){const r=v(e);let n;if(e.isGroup){var i;const a=(null===(i=e.groupMetadata)||void 0===i?void 0:i.owner)&&(0,y.USER_JID)(e.groupMetadata.owner);n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{creator:a||s.DROP_ATTR,subject:(0,s.CUSTOM_STRING)(e.name),jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},r))}else n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},r));const a=yield(0,p.sendIq)(n,T);if(!a.success){const{errorCode:e,errorText:t}=a;return __LOG__(3)`reportSpam: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}return a.result}))).apply(this,arguments)}},88795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;switch(t){case"paused":r=(0,n.wap)("paused",null);break;case"composing":r=(0,n.wap)("composing",null);break;case"recording":r=(0,n.wap)("composing",{media:"audio"});break;default:throw new Error(`Impossible value, the default statement should never be reached for value: ${t}`)}return(0,i.castStanza)((0,n.wap)("chatstate",{to:(0,o.CHAT_JID)(e),from:(0,o.JID)((0,a.assertGetMe)())},r))};var n=r(31914),i=r(24747),a=r(99234),o=r(39410)},52407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(24747),o=r(99094),s=r(6565);function l(){return(l=(0,i.default)((function*(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendKeyMsg: sending ${e.id.toString()}`;const t=e.to,r=(0,s.createMsgProtobuf)(e),n=yield(0,o.createUserDeviceMsgStanza)(t,null,e,r,{type:o.MsgType.AppStateSync});return(0,a.sendStanzaAndWaitForAck)(n,{id:e.id.id,class:"message",from:t,participant:null})}))).apply(this,arguments)}},99094:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=void 0,t.createGroupDeviceMsgStanza=function(){return T.apply(this,arguments)},t.createUserDeviceMsgStanza=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=n(r(41143)),l=r(46308),c=r(58853),d=r(40316),u=r(99234),p=r(6565),f=r(7293),_=r(45033),h=r(97398),g=r(76802),m=r(52083),y=r(93650),E=r(39410);const S=r(76672).Mirrored(["Retry","AppStateSync"]);function v(){return(v=(0,i.default)((function*(e,t,r,n,i){let a=n;return yield(0,h.ensureE2ESessions)([e]),(0,o.toUserWid)(e).equals((0,u.getMeUser)())&&i.type!==S.AppStateSync?((0,s.default)(null!=t,"[messaging] createDeviceMsgStanza: no recipient for peer device message"),a=(0,p.createDeviceSentMessage)(n,t),yield(0,g.populateICDCMeta)((0,o.toUserWid)(t),a)):yield(0,g.populateICDCMeta)((0,o.toUserWid)(e),a),C(e,null,t,r,a,i)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i){if(yield(0,h.ensureE2ESessions)([t]),i.type===S.AppStateSync)return Promise.reject(new Error("[messaging] createGroupDeviceMsgStanza: not expect for App State Sync message"));const a=(0,o.toUserWid)(t).equals((0,u.getMeUser)())?(0,p.createDeviceSentMessage)(n,e):n;return yield(0,g.populateICDCMeta)((0,o.toUserWid)(t),a),C(e,t,null,r,a,i)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i,o){var s;const u=t||e,p=null!==(s=o.retryCount)&&void 0!==s?s:0,h=(0,c.mediaTypeFromProtobuf)(i),v=n.id,{type:T,ciphertext:C}=yield(0,d.encryptMsgProtobuf)(u,p,i);let A=null;if(f.GK.supportsFeature(f.GK.F.MD_ADV)&&T===_.CiphertextType.Pkmsg){const e=yield(0,l.getADVEncodedIdentity)();A=(0,a.wap)("device-identity",null,e)}return o.type!==S.Retry&&(yield(0,g.updateIdentityRange)(v,[u])),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(v.id),to:(0,E.JID)(e),participant:t?(0,E.DEVICE_JID)(t):a.DROP_ATTR,recipient:r?(0,E.USER_JID)(r):a.DROP_ATTR,type:(0,y.typeAttributeFromProtobuf)(i),edit:(0,g.editAttribute)(i,n.subtype),category:o.type===S.AppStateSync?(0,a.CUSTOM_STRING)("peer"):a.DROP_ATTR,push_priority:o.type===S.AppStateSync?(0,a.CUSTOM_STRING)("high"):a.DROP_ATTR},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(T),count:0===p?a.DROP_ATTR:(0,a.INT)(p),mediatype:(0,c.encodeMaybeMediaType)(h),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(i.reactionMessage)},C),A)}))).apply(this,arguments)}t.MsgType=S},40316:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMsgProtobuf=function(){return u.apply(this,arguments)},t.encryptMsgSenderKey=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(58853),o=r(45033),s=n(r(11339)),l=r(76802),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function u(){return(u=(0,i.default)((function*(e,t,r){const n=(0,a.mediaTypeFromProtobuf)(r),i=new s.default.E2eMessageSend({e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:(0,a.metricsDestinationType)(e),messageMediaType:n?(0,a.metricsMediaType)(n):s.default.MEDIA_TYPE.NONE,retryCount:t});try{const{type:t,ciphertext:n}=yield c.Cipher.encryptSignalProto(e,(0,l.encodeAndPad)(r));return i.e2eCiphertextType=(0,a.metricsCiphertextType)(t),i.e2eSuccessful=!0,i.commit(),{type:t,ciphertext:n}}catch(t){return i.e2eSuccessful=!1,i.weight=1,i.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=new s.default.E2eMessageSend({e2eCiphertextType:(0,a.metricsCiphertextType)(o.CiphertextType.Skmsg),e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:s.default.E2E_DESTINATION.GROUP,messageMediaType:s.default.MEDIA_TYPE.NONE,retryCount:0});try{const n=yield c.Cipher.encryptSenderKeyMsgSignalProto(e,t);return r.e2eSuccessful=!0,r.commit(),n}catch(t){return r.e2eSuccessful=!1,r.weight=1,r.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}},45325:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FANOUT_TYPE=void 0,t.createFanoutMsgStanza=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=r(46308),l=r(58853),c=r(19380),d=r(40316),u=r(99234),p=r(6565),f=r(7293),_=r(45033),h=r(97398),g=r(47124),m=n(r(11339)),y=r(76802),E=r(16860),S=r(52083),v=r(93650),T=r(39410);const C=Object.freeze({CHAT:"chat",GROUP_DIRECT:"groupDirect"});function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,n,s){const c=(0,l.mediaTypeFromProtobuf)(r),f=(0,u.getMeUser)();if(n.fanoutType===C.CHAT&&1===t.length&&(0,y.isPrimaryDevice)(t[0])){null==s||s.startClientEncryptStage();const{type:e,ciphertext:n}=yield(0,d.encryptMsgProtobuf)(t[0],0,r);return null==s||s.postClientEncryptStage(),{shouldHaveIdentity:e===_.CiphertextType.Pkmsg,body:(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(r.reactionMessage)},n)}}let h=!1;null==s||s.startClientEncryptStage();const g=t.map(function(){var t=(0,i.default)((function*(t){const i=(0,o.toUserWid)(t).equals(f)?(0,p.createDeviceSentMessage)(r,e):r,s=n.fanoutType===C.GROUP_DIRECT?(0,o.toUserWid)(t):(0,o.toUserWid)(e);yield(0,y.populateICDCMeta)(s,i);try{const{type:e,ciphertext:n}=yield(0,d.encryptMsgProtobuf)(t,0,i);return e===_.CiphertextType.Pkmsg&&(h=!0),(0,a.wap)("to",{jid:(0,T.DEVICE_JID)(t)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(r.reactionMessage)},n))}catch(e){return(0,y.isPrimaryDevice)(t)&&(__LOG__(4,void 0,new Error,!0,["messaging"])`encryptAndSendUserMsg: encryption fail for primary device ${String(t)}`,SEND_LOGS("encryption-fail-for-primary-device")),null}}));return function(){return t.apply(this,arguments)}}()),m=yield Promise.all(g);null==s||s.postClientEncryptStage();const E=m.filter((e=>null!=e));return E.length>0?{body:(0,a.wap)("participants",null,E),shouldHaveIdentity:h}:Promise.reject(new Error("[messaging] encryptAndSendUserMsg: encryption fail for all devices"))}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r,n){const i=e.to;try{const e=yield(0,h.ensureE2ESessions)(r);(0,E.postPrekeysDepletionMetric)({count:null==e?void 0:e.depletedPrekeyCount,prekeysFetchReason:m.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:n.fanoutType===C.CHAT?m.default.MESSAGE_TYPE.INDIVIDUAL:m.default.MESSAGE_TYPE.GROUP,chatId:i})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const o=e.id;let d=r;n.isResendingMsg&&(d=yield(0,y.filterDeviceWithChangedIdentity)(o,r));const u=d.map((e=>({msgKey:o,receiverId:e})));yield(0,g.createOrMergeReceiptRecords)(u);const p=yield A(i,d,t,n,e.wamMessageSendPerfReporter),b=n.fanoutType===C.GROUP_DIRECT?(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(_.CiphertextType.Skmsg)}):null;let P=null;if(f.GK.supportsFeature(f.GK.F.MD_ADV)&&p.shouldHaveIdentity){const e=yield(0,s.getADVEncodedIdentity)();P=(0,a.wap)("device-identity",null,e)}const M=(0,v.getBizNativeFlowName)(t);let O;const I=c.ContactCollection.get(i),w=null==I?void 0:I.privacyMode;null!=w&&(O=(0,a.wap)("biz",{host_storage:(0,a.INT)(w.hostStorage),actual_actors:(0,a.INT)(w.actualActors),privacy_mode_ts:(0,a.INT)(w.privacyModeTs),native_flow_name:(0,a.MAYBE_CUSTOM_STRING)(M)})),null==O&&null!=M&&(O=(0,a.wap)("biz",{native_flow_name:(0,a.CUSTOM_STRING)(M)})),n.isResendingMsg||(yield(0,y.updateIdentityRange)(o,d)),yield(0,S.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const{id:R}=o;return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(R),to:(0,T.CHAT_JID)(i),type:(0,v.typeAttributeFromProtobuf)(t),edit:(0,y.editAttribute)(t,e.subtype),device_fanout:n.isResendingMsg?(0,a.CUSTOM_STRING)("false"):a.DROP_ATTR},p.body,b,P,O)}))).apply(this,arguments)}t.FANOUT_TYPE=C},43341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupDirectMsg=function(){return g.apply(this,arguments)},t.resendGroupMsg=m;var i=n(r(48926)),a=n(r(70735)),o=r(45454),s=r(10823),l=r(22683),c=r(24747),d=r(45325),u=r(16104),p=n(r(11339)),f=r(76802),_=r(52083),h=r(90298);function g(){return(g=(0,i.default)((function*(e,t,r){const n=e.to;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: sending ${e.id} with group ${n.toString()}`;const i=yield E(e,t,r,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT}),{phash:a}=i;if(a){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: phash mismatch, got server phash ${a}`;const n=l.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,s.syncDeviceListJob)(r,"message",a).then((()=>m(e,t,r,n)))}return i}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r,n){__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: to ${e.to.toString()}`;const i=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(l.Clock.globalUnixTime()-n>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip group resending due to 5 min timeout`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void i.commit();try{const n=Array.from(new Set(r.map((e=>e.user)))).map((e=>(0,o.createUserWid)(e))),s=yield(0,u.getFanOutList)({wids:n}),l=(0,a.default)(s,r,String);if(0===l.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: skip sending to the empty list`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void i.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resending to devices ${l.join(",")}`,yield E(e,t,l,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT,isResendingMsg:!0})}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resend got error ${e} `,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,i.commit(),e}(0,h.logSuccessfulMessageSend)(i,e)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:o}=e,s=yield(0,d.createFanoutMsgStanza)(e,t,r,n);yield(0,_.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const l=yield(0,c.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(l);return u.error?Promise.reject(new Error("[messaging] encryptAndSendGroupDirectMsg: Invalid ack from server")):u.success}))).apply(this,arguments)}},23712:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDistributionMsg=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(40316),s=(r(45033),r(97398)),l=n(r(11339)),c=r(76802),d=r(16860),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function f(){return(f=(0,i.default)((function*(e,t,r){var n,p,f,_;if(null==e||null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startPrekeysFetchStage(),null==e||null===(p=e.wamMessageSendPerfReporter)||void 0===p||p.setFetchedPrekeyCount(0),null==e||null===(f=e.wamMessageSendPerfReporter)||void 0===f||f.setSenderKeyDistributionCount(r.length),0===r.length)return null==e||null===(_=e.wamMessageSendPerfReporter)||void 0===_||_.postPrekeysFetchStage(),null;try{var h;const n=yield(0,s.ensureE2ESessions)(r),i=null==n?void 0:n.missedPrekeyCount;var g;if(null!=i)null==e||null===(g=e.wamMessageSendPerfReporter)||void 0===g||g.setFetchedPrekeyCount(i);null==e||null===(h=e.wamMessageSendPerfReporter)||void 0===h||h.postPrekeysFetchStage(),(0,d.postPrekeysDepletionMetric)({count:null==n?void 0:n.depletedPrekeyCount,prekeysFetchReason:l.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:l.default.MESSAGE_TYPE.GROUP,chatId:t})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const m=yield u.Session.getGroupSenderKeyInfo(t),y={senderKeyDistributionMessage:{groupId:t.toString({legacy:!0}),axolotlSenderKeyDistributionMessage:m}},E=r.map(function(){var e=(0,i.default)((function*(e){try{yield(0,c.populateICDCMeta)((0,a.toUserWid)(e),y);const t=yield(0,o.encryptMsgProtobuf)(e,0,y);return{type:t.type,ciphertext:t.ciphertext,participant:e}}catch(t){if(__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: encryption fail for ${e.toString()}, ${t}`,(0,c.isPrimaryDevice)(e))return Promise.reject(new Error(`[messaging] encryptAndSendUserMsg: encryption fail for primary device ${String(e)}`))}}));return function(){return e.apply(this,arguments)}}());return(yield Promise.all(E)).filter(Boolean)}))).apply(this,arguments)}},51974:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupMsg=function(e,t){var r;const{id:n,to:d}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: sending ${n}`;const{protocolMessage:u}=t;let p=null;if((null==u?void 0:u.type)===c.Message$ProtocolMessageType.REVOKE&&(null==u?void 0:u.key)){const{remoteJid:e,id:t,participant:r}=u.key;e&&t&&r&&(p=new o.default({remote:(0,s.createWid)(e),fromMe:!0,id:t,participant:(0,s.createWid)(r)}))}return null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startWaitingToEncryptStage(),_.senderKeyQueueMap.enqueue(d.toString(),(0,a.default)((function*(){var r;null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.postWaitingToEncryptStage();const n=yield function(){return m.apply(this,arguments)}(d,p);if(n.type===g.DIRECT){const{deviceList:r}=n,a=yield(0,l.encryptAndSendGroupDirectMsg)(e,t,r);return(0,i.default)((0,i.default)({},a),{},{deviceCount:r.length})}const{senderKeyList:a}=n,o=yield(0,h.encryptAndSendSenderKeyMsg)(e,t,a);return(0,i.default)((0,i.default)({},o),{},{deviceCount:a.skList.length+a.skDistribList.length})})))};var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(45454),l=r(43341),c=r(24808),d=r(16104),u=r(7293),p=r(76214),f=r(43201),_=r(92657),h=r(3922);const g=Object.freeze({SKMSG:"skmsg",DIRECT:"direct"});function m(){return(m=(0,a.default)((function*(e,t){const r=yield(0,f.getGroupSenderKeyList)(e),n={senderKeyList:r,type:g.SKMSG};if(t&&u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const e=yield(0,p.getMsgInfoTable)().equals(["msgKey"],String(t));if(0===e.length)return n;const{skDistribList:i,skList:a}=r,o=new Set(i.concat(a).map((e=>String((0,s.toUserWid)(e))))),l=e.filter((e=>!o.has(e.receiverUserJid))).map((e=>(0,s.createWid)(e.receiverUserJid)));if(0===l.length)return n;const c=[...yield(0,d.getFanOutList)({wids:l}),...a,...i];return{type:g.DIRECT,deviceList:c}}return n}))).apply(this,arguments)}},95216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupKeyDistributionMsg=function(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupKeyDistributionMsg: sending ${e}`;const t=e.remote;return y.senderKeyQueueMap.enqueue(t.toString(),(()=>function(){return T.apply(this,arguments)}(e)))};var i=n(r(48926)),a=r(31914),o=r(46308),s=r(58853),l=r(24747),c=r(99234),d=r(23712),u=r(7293),p=r(45033),f=r(47124),_=r(76802),h=r(43201),g=r(53686),m=r(52083),y=r(92657),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),S=r(39410);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(){return(T=(0,i.default)((function*(e){const{id:t}=e,r=e.remote,{skDistribList:n,skList:i,rotateKey:o}=yield(0,h.getGroupSenderKeyList)(r),[d,u]=yield C(r,n,o),y=i.concat(n);yield(0,_.updateIdentityRange)(e,y),yield(0,f.createOrMergeReceiptRecords)(y.map((t=>({msgKey:e,receiverId:t})))),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const E=yield(0,g.phashV2)([...y,(0,c.assertGetMe)()]),v=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(t),to:(0,S.CHAT_JID)(r),phash:(0,a.CUSTOM_STRING)(E),type:"text",device_fanout:(0,a.CUSTOM_STRING)("false")},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(p.CiphertextType.Skmsg),"decrypt-fail":(0,a.CUSTOM_STRING)("hide")}),d,u),T=yield(0,l.sendStanzaAndReturnAck)(v,{id:t,class:"message",from:r,participant:null}),A=_.sendMsgAckSyncParser.parse(T);return A.error?(__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"))):(yield(0,h.markHasSenderKey)(r,n),A.success)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r){r&&(yield E.Session.deleteGroupSenderKeyInfo(e));const n=yield(0,d.getKeyDistributionMsg)(null,e,t);let i=null,l=!1;n&&n.length>0&&(i=(0,a.wap)("participants",null,n.map((e=>{let{type:t,ciphertext:r,participant:n}=e;return t===p.CiphertextType.Pkmsg&&(l=!0),(0,a.wap)("to",{jid:(0,S.DEVICE_JID)(n)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),"decrypt-fail":(0,a.CUSTOM_STRING)("hide"),type:(0,a.CUSTOM_STRING)(t)},r))}))));let c=null;if(u.GK.supportsFeature(u.GK.F.MD_ADV)&&l){const e=yield(0,o.getADVEncodedIdentity)();c=(0,a.wap)("device-identity",null,e)}return[i,c]}))).apply(this,arguments)}},92657:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.senderKeyQueueMap=void 0;const n=new(r(27870).PromiseQueueMap);t.senderKeyQueueMap=n},3922:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendSenderKeyMsg=function(){return w.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(46308),s=r(22683),l=r(58853),c=r(24747),d=r(43341),u=r(40316),p=r(99234),f=r(23712),_=r(7293),h=r(45033),g=r(90981),m=r(47124),y=n(r(11339)),E=r(76802),S=r(43201),v=r(53686),T=r(52083),C=r(10790),A=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=M(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),b=r(93650),P=r(39410);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(M=function(e){return e?r:t})(e)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,r,n){var i,s;const c=(0,E.encodeAndPad)(n),d=(0,l.mediaTypeFromProtobuf)(n),p=yield(0,f.getKeyDistributionMsg)(e,t,r);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startClientEncryptStage();const g=yield(0,u.encryptMsgSenderKey)(t,c);null===(s=e.wamMessageSendPerfReporter)||void 0===s||s.postClientEncryptStage();let m=null,y=!1;p&&p.length>0&&(m=(0,a.wap)("participants",null,p.map((e=>{let{type:t,ciphertext:r,participant:i}=e;return t===h.CiphertextType.Pkmsg&&(y=!0),(0,a.wap)("to",{jid:(0,P.DEVICE_JID)(i)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(t),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},r))}))));const S=(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(h.CiphertextType.Skmsg),mediatype:(0,l.encodeMaybeMediaType)(d),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},g.ciphertext);let v=null;if(_.GK.supportsFeature(_.GK.F.MD_ADV)&&y){const e=yield(0,o.getADVEncodedIdentity)();v=(0,a.wap)("device-identity",null,e)}return[m,S,v]}))).apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t,r){var n;const{id:i,to:o}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: sending ${i}`;const{id:l}=i,{skDistribList:u,skList:f,rotateKey:_}=r;R(e);const h=f.concat(u),M=yield(0,v.phashV2)([...h,(0,p.assertGetMe)()]);yield(0,m.createOrMergeReceiptRecords)(h.map((e=>({msgKey:i,receiverId:e})))),_&&(yield A.Session.deleteGroupSenderKeyInfo(o));const[I,w,D]=yield O(e,o,u,t),N=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(l),to:(0,P.CHAT_JID)(o),phash:(0,a.CUSTOM_STRING)(M),type:(0,b.typeAttributeFromProtobuf)(t),edit:(0,E.editAttribute)(t,e.subtype)},I,w,D);yield(0,E.updateIdentityRange)(i,h),yield(0,T.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.postReadyToSendStage();const L=yield(0,c.sendStanzaAndReturnAck)(N,{id:l,class:"message",from:o,participant:null}),k=E.sendMsgAckSyncParser.parse(L);if(k.error)return __LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"));yield(0,S.markHasSenderKey)(o,u);const{phash:G,count:U}=k.success;if(G&&G!==M){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: phash mismatch, got server phash ${G}`;const r=s.Clock.globalUnixTime();new y.default.MdDeviceSyncAck({chatType:y.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,E.isRevokeMsg)(t)}).commit(),(0,C.sendQueryGroup)(o).then((()=>{(0,d.resendGroupMsg)(e,t,h,r)}))}return null!=U&&(0,g.getTable)().merge(String(i),{count:U}),k.success}))).apply(this,arguments)}function R(e){var t;(0,p.markUserSentMessageToChat)(e.chat.id)&&(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.setMessageIsFirstUserMessage(!0))}},24659:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendRetry=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(41143)),o=r(24747),s=r(99094),l=r(6565);function c(){return(c=(0,i.default)((function*(e,t,r,n,i){const c=n.id.id;let d;__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: id ${c} to ${e.toString()}, requester: ${(t||e).toString()}, count: ${i}`,n.asMms&&(d=n.isUnsentPhoneMsg()?{type:n.type}:n.avParams());const u=(0,l.createMsgProtobuf)(n,d||{}),p={type:s.MsgType.Retry,retryCount:i};let f;return e.isUser()?f=yield(0,s.createUserDeviceMsgStanza)(e,r,n,u,p):((0,a.default)(null!=t,"[messaging] sendRetry: no participant for group retry message"),f=yield(0,s.createGroupDeviceMsgStanza)(e,t,n,u,p)),__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: sending ${c} to ${e.toString()}`,(0,o.sendStanzaAndWaitForAck)(f,{id:c,class:"message",from:e,participant:t})}))).apply(this,arguments)}},95547:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"encodeAndPad",{enumerable:!0,get:function(){return h.encodeAndPad}}),t.encryptAndSendKeyDistributionMsg=function(e){if(!e.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!e.remote)return Promise.reject(new Error("[messaging] sending message without an remote id"));if(e.remote.isGroup()){const t=new l.MessageSendPerfReporter(e.remote,c.default.MEDIA_TYPE.NONE,c.default.MESSAGE_TYPE.GROUP);return(0,u.encryptAndSendGroupKeyDistributionMsg)(e).then((()=>{t.setMessageIsInvisible(!0),t.postWrittenWireStage()}))}return Promise.reject(new Error("[messaging] unsupported remote jid type"))},t.encryptAndSendMsg=function(e){var t,r;const n=e.id,l=e.to;if(!n||!n.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!l)return Promise.reject(new Error("[messaging] sending message without an remote id"));s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===i.MSG_TYPE.STICKER&&null==e.deprecatedMms3Url&&(e.deprecatedMms3Url=g);let c;if(e.asMms){const t=e.isUnsentPhoneMsg();c=t?{type:e.type}:e.avParams(),s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===i.MSG_TYPE.STICKER&&!t&&null==c.url&&(c.url=g)}const u=(0,o.createMsgProtobuf)(e,c||{});if(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.startWrittenWireStage(),null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startReadyToSendStage(),l.isUser()){const t=(0,f.encryptAndSendUserMsg)(e,u);return s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&(0,a.getABPropConfigValue)("trusted_contacts_sender")&&(0,p.sendTcToken)(l),t}if(l.isGroup())return(0,d.encryptAndSendGroupMsg)(e,u);return Promise.reject(new Error("[messaging] unsupported remote jid type"))},Object.defineProperty(t,"sendRetry",{enumerable:!0,get:function(){return _.sendRetry}});var i=r(15461),a=r(86945),o=r(6565),s=r(7293),l=r(30097),c=n(r(11339)),d=r(51974),u=r(95216),p=r(41088),f=r(68264),_=r(24659),h=r(76802);const g="https://whatsapp.net"},68264:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendUserMsg=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=n(r(70735)),o=r(10823),s=r(22683),l=r(24747),c=r(45325),d=r(16104),u=r(99234),p=n(r(11339)),f=r(76802),_=r(90298);function h(){return(h=(0,i.default)((function*(e,t){const{id:r,to:n}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: sending ${r}`;const i=(0,u.assertGetMe)(),a=yield(0,d.getFanOutList)({wids:[n,i]}),l=yield y(e,t,a,{fanoutType:c.FANOUT_TYPE.CHAT}),{phash:_}=l;if(_){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: phash mismatch, got server phash ${_}`;const r=s.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.INDIVIDUAL,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,o.syncDeviceListJob)([n,i],"message",_).then((()=>g(e,t,a,r)))}return l}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r,n){const{id:i,to:l}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending ${i.id}`;const h=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(s.Clock.globalUnixTime()-n>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending due to 5 min timeout`,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void h.commit();try{const n=(0,u.assertGetMe)(),i=yield(0,d.getFanOutList)({wids:[l,n]}),s=(0,a.default)(i,r,String);if(0===s.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending to the empty list`,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void h.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending to devices ${s.join(",")}`;const{phash:f}=yield y(e,t,s,{fanoutType:c.FANOUT_TYPE.CHAT,isResendingMsg:!0});f&&(0,o.syncDeviceListJob)([l,n],"message",f)}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resend got error ${e} `,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,h.commit(),e}(0,_.logSuccessfulMessageSend)(h,e)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:o}=e,s=yield(0,c.createFanoutMsgStanza)(e,t,r,n);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const d=yield(0,l.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(d);if(u.error)throw new Error("[messaging] sendMsgToDeviceList: Invalid ack from server");return u.success}))).apply(this,arguments)}},93167:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{type:e,name:(0,n.MAYBE_CUSTOM_STRING)(a.Conn.pushname)}))};var n=r(31914),i=r(24747),a=r(17239)},34083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e.isUser()&&null!=t&&(0,i.getABPropConfigValue)("trusted_contacts");return(0,a.castStanza)((0,n.wap)("presence",{id:(0,n.generateId)(),to:(0,o.CHAT_JID)(e),type:"subscribe"},r?(0,n.wap)("tctoken",null,t):null))};var n=r(31914),i=r(86945),a=r(24747),o=r(39410)},66612:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=n(r(89867)),l=r(24747),c=r(39410),d=r(77591);const u=new o.WapParser("photoResponseParser",(e=>{if(e.assertAttr("type","result"),e.hasChild("picture")){return{id:e.child("picture").attrInt("id")}}return{id:null}}));function p(){return(p=(0,i.default)((function*(e,t){const r=yield(0,l.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:s.default.isGroup(e)?(0,c.CHAT_JID)(e):a.DROP_ATTR,type:"set",xmlns:"w:profile:picture",id:(0,a.generateId)()},t?(0,a.wap)("picture",{type:"image"},t):null),u);return r.success?{id:r.result.id}:Promise.reject(new d.ServerStatusCodeError(r.errorCode,r.errorText))}))).apply(this,arguments)}},80079:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,t.setPrivacyTokens=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(39410),c=r(77591);const d=new o.WapParser("setPrivacyTokensParser",(e=>({stanzaId:e.attrString("id")}))),u=r(76672)({TrustedContact:"trusted_contact"});function p(){return(p=(0,i.default)((function*(e,t,r){const n=t.map((t=>(0,a.wap)("token",{jid:(0,l.USER_JID)(e),t:(0,a.CUSTOM_STRING)(String(r)),type:(0,a.CUSTOM_STRING)(t)}))),i=yield(0,s.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:(0,a.generateId)()},(0,a.wap)("tokens",null,n)),d);if(!i.success)throw new c.ServerStatusCodeError(i.errorCode,i.errorText)}))).apply(this,arguments)}t.TokenType=u},45723:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{name:(0,n.MAYBE_CUSTOM_STRING)(e)}))};var n=r(31914),i=r(24747)},35065:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(97197),o=r(92844),s=r(97245),l=r(24747),c=n(r(11339));function d(e){const{result:t,overallStartTime:r,retryStartTime:n,retryAttemptsLeft:i}=e,a=function(e){switch(e){case"success":return c.default.SIGN_CREDENTIAL_RESULT.SUCCESS;case"bad-request":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_BAD_REQUEST;case"internal-server-error":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_SERVER;case"disconnected":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_CLIENT_NETWORK;default:return c.default.SIGN_CREDENTIAL_RESULT.ERROR_OTHER}}(t);new c.default.SignCredential({signCredentialResult:a,overallT:(0,o.monotonicTimeSince)(r),signCredentialT:(0,o.monotonicTimeSince)(n),retryCount:3-i,waConnectedToChatd:"disconnected"!==t,applicationState:"visible"===document.visibilityState?c.default.APPLICATION_STATE.FOREGROUND:c.default.APPLICATION_STATE.BACKGROUND}).commit()}const u=new a.Semaphore(1);function p(){return(p=(0,i.default)((function*(){const e=yield u.acquire();try{const{result:t,metric:r}=yield(0,s.getToken)(l.sendIqWithoutRetry);return null!=r&&d(r),t||__LOG__(3)`Couldn't get a private stats token`,t}finally{e.release()}}))).apply(this,arguments)}},13176:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("uploadStats",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`fieldStatsUpload: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`fieldStatsUpload: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function c(){return(c=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:stats",id:(0,a.generateId)()},(0,a.wap)("add",{t:(0,a.INT)(t)},e));__LOG__(2)`fieldStatsUpload:sendIq start`;const n=yield(0,s.sendIq)(r,l);if(__LOG__(2)`fieldStatsUpload:sendIq end`,!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`fieldStatsUpload: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},66837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactSyncRefreshSeconds=function(){var e;const t=null!==(e=(0,a.default)(c.default,"localStorage").getItem(p.KEYS.CONTACT_SYNC_REFRESH))&&void 0!==e?e:86400;return parseInt(t,10)},t.runSyncDirtyContactsJob=function(){(0,u.getShouldCheckContactSyncStatus)()&&setTimeout((function(){!function(){h.apply(this,arguments)}()}),6e4);(0,u.setShouldCheckContactSyncStatus)()},t.syncNewContact=function(e){_.push(e),f?f.debounce(1e3):(f=new o.ShiftTimer((()=>{if(!(0,u.isRegistered)())return;const e=_;_=[],f=null,__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start new contact sync for ${e.length} contacts`,(0,l.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0}).catch((e=>{__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}))})),f.onOrBefore(2e4))};var i=n(r(48926)),a=n(r(45095)),o=r(57319),s=r(45454),l=r(33192),c=n(r(92417)),d=r(76214),u=r(58052),p=r(72407);let f=null,_=[];function h(){return(h=(0,i.default)((function*(){const e=(yield(0,d.getContactTable)().equals(["isContactSyncCompleted"],0)).map((e=>(0,s.createWid)(e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync dirty contacts, found ${e.length} contacts to sync`,(0,l.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0})}))).apply(this,arguments)}},99684:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryTosState=function(){return d.apply(this,arguments)},t.resetTosState=function(){return u.apply(this,arguments)},t.updateTosState=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("tosNotices",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("tos"),r={refresh:t.attrInt("refresh"),notice:[]};return t.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),n=e.attrString("id");r.notice.push({id:n,state:t})})),(r.refresh>259200||r.refresh<7200)&&(r.refresh=86400),r}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"get",to:a.S_WHATSAPP_NET},(0,a.wap)("request",null,e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)}))))),r=yield(0,s.sendIq)(t,c);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode,r.errorText)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new o.WapParser("tosNoticesSet",(()=>{})),r=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"set",to:a.S_WHATSAPP_NET},(0,a.wap)("request",{type:"session_update"},e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)})))));yield(0,s.sendIq)(r,t)}))).apply(this,arguments)}},14892:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unpairDevice=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(99234),c=r(39410);const d=new o.WapParser("unpairResponse",(e=>{e.assertTag("iq"),e.assertFromServer();let t=200;return"error"===e.attrString("type")&&(t=e.child("error").attrInt("code")),{status:t}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",id:(0,a.generateId)(),xmlns:"md"},(0,a.wap)("remove-companion-device",{jid:(0,c.DEVICE_JID)((0,l.assertGetMe)()),reason:(0,a.CUSTOM_STRING)(e)})),r=yield(0,s.sendIq)(t,d);return r.success?{status:r.result.status}:{status:r.errorCode}}))).apply(this,arguments)}},46669:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPreKeys=function(){const e=new a.PromiseRetryLoop({name:"uploadPreKeys",timer:g,code:e=>(0,i.default)((function*(){__LOG__(2)`uploadPreKeys: running`;!0===(yield function(){return h.apply(this,arguments)}()).success?e():__LOG__(2)`uploadPreKeys: retrying (after delay)`}))()});return e.start(),e.promise()};var i=n(r(48926)),a=r(72287),o=r(31914),s=r(71914),l=n(r(64369)),c=r(24747),d=r(58425),u=r(11849),p=r(91335);const f={error:!1,result:!0},_=new s.WapParser("uploadPreKeyResParser",(e=>{e.assertTag("iq"),e.assertFromServer();if(e.attrEnum("type",f))return{success:!0};const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.hasAttr("text")?t.attrString("text"):""}}));function h(){return(h=(0,i.default)((function*(){const[e,t]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!e||!t)throw new Error("No signal info is available");const{registrationId:r,identityKeyPair:n}=e,[i,a]=yield u.waSignalStore.getOrGenPreKeys(30,d.generatePreKeyPair).then((e=>{if(0===e.length)throw new Error("No preKey is available");return[(0,o.wap)("iq",{id:(0,o.generateId)(),xmlns:"encrypt",type:"set",to:o.S_WHATSAPP_NET},(0,o.wap)("registration",null,(0,o.BIG_ENDIAN_CONTENT)(r)),(0,o.wap)("type",null,l.default.KEY_BUNDLE_TYPE),(0,o.wap)("identity",null,n.pubKey),(0,o.wap)("list",null,e.map(p.xmppPreKey)),(0,p.xmppSignedPreKey)(t)),e[e.length-1].keyId]}));try{const e=yield(0,c.waitForConnection)().then((()=>u.waSignalStore.markKeyAsUploaded(a))).then((()=>(0,c.sendIqWithoutRetry)(i,_)));if(e.success)return u.waSignalStore.setServerHasPreKeys(!0),{success:!0};const t=e.errorCode;return t>=500?__LOG__(3)`_uploadPreKeys: server requested backoff ${t}`:406===t?__LOG__(3)`_uploadPreKeys: uploaded invalid keys`:__LOG__(3)`_uploadPreKeys: unrecognized error ${t}`,{errorCode:e.errorCode,errorText:e.errorText}}catch(e){return void __LOG__(3)`_uploadPreKeys: disconnected, unclear if on server`}}))).apply(this,arguments)}const g={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4}},15746:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._waitForMainStream=t._online=void 0,t.handleMessage=function(){return f.apply(this,arguments)},t.waitForOfflineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return p.chatQueue.wait(e);return p.allChatQueue.wait()},t.waitForOnlineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return u.chatQueue.wait(e);return u.allChatQueue.wait()};var i=n(r(48926)),a=r(27870),o=r(38284),s=r(88102),l=r(28237);const c=2e4,d=new Promise((e=>{s.Cmd.on("main_stream_mode_ready",(()=>{e()}))}));t._waitForMainStream=d;const u={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};t._online=u;const p={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};function f(){return(f=(0,i.default)((function*(e,t,r){return t&&!l.OfflineMessageHandler.isResumeFromRestartComplete()?p.allChatQueue.enqueue((()=>p.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(r(),c))))):(yield d,u.allChatQueue.enqueue((()=>u.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(r(),c))))))}))).apply(this,arguments)}},26775:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=n(r(64369)),l=n(r(89867)),c=r(45454),d=r(46308),u=r(58853),p=r(24747),f=r(7293),_=r(45033),h=r(97398),g=r(52083),m=r(95547),y=T(r(77605)),E=T(r(45473)),S=r(39410);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const{VOIP_LOG_COLOR:C}=s.default;function A(){return(A=(0,i.default)((function*(e,t){const r=e.common,n=(0,c.createWid)(r.peer_jid);if(l.default.isGroupCall(n))return b((0,o.CUSTOM_STRING)(r.peer_jid),n,e);try{return b(yield M(e,n,t),n,e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Failed to encrypt and send msg`}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r){const n=(0,S.voipXmlToWapNode)(r.payload),i=(0,o.generateId)(),a=(0,o.wap)("call",{to:e,id:i},n);yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const s=yield(0,p.sendStanzaAndReturnAck)(a,{id:String(i),class:"call",from:t,participant:null});return{payload:(0,S.wapNodeToVoipXml)(s),status:200}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,r){const n=e.payload[2].findIndex((e=>"destination"===e[0])),o=e.payload[2][n];if(o){e.payload[0]!==E.TYPE_STR.OFFER&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("call offer check"));const r=o[2].map((e=>(0,c.createDeviceWidFromUserAndDevice)(e[1].jid.user,e[1].jid.device)));try{yield(0,h.ensureE2ESessions)(r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Could not establish E2E session with all deviceWids`}let n=!1,a=!1;return yield Promise.all(o[2].map(function(){var t=(0,i.default)((function*(t,i){if(I(t[2])){const o=N(t[2]),s=r[i];try{const{encNode:r,shouldHaveIdentity:n}=yield L(o,s,D(e.payload[2]));a=a||n,R(t[2],r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Signal encryption failed for ${s.toString()}, ${e}`,n=!0}}}));return function(){return t.apply(this,arguments)}}())),n?(__LOG__(3)`voip:encryptMsgCallKey: Removing all enc nodes due to encryption failure`,o[2].forEach((e=>w(e)))):a&&(yield G(e.payload[2])),(0,S.USER_JID)(t)}if(!I(e.payload[2]))return(0,S.DEVICE_JID)(t);try{const e=[t];if(t.isCompanion()){const r=(0,c.createDeviceWidFromUserAndDevice)(t.user,a.DEFAULT_DEVICE_ID);e.unshift(r)}yield(0,h.ensureE2ESessions)(e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Could not establish E2E session with deviceWid`}const s=N(e.payload[2]);let l,d;try{const r=yield L(s,t,D(e.payload[2]));l=r.encNode,d=r.shouldHaveIdentity}catch(e){if(r!==E.TYPE.OFFER)throw e;l=null,d=!1,__LOG__(3)`voip:encryptAndSendSignalingMsg: Sending offer without enc`}return R(e.payload[2],l),d&&(yield G(e.payload[2])),(0,S.DEVICE_JID)(t)}))).apply(this,arguments)}function I(e){if(null==e)return!1;return e.findIndex((e=>"enc"===e[0]))>=0}function w(e){if(null==e)return;const t=e.findIndex((e=>"enc"===e[0]));e.splice(t,1)}function R(e,t){const r=e.findIndex((e=>"enc"===e[0]));r>=0&&(e[r]=t)}function D(e){var t;const r=e.find((e=>"enc"===e[0])),n=null==r||null===(t=r[1])||void 0===t?void 0:t.count;return null!=n?n:0}function N(e){const t=e.find((e=>"enc"===e[0])),r=null==t?void 0:t[2];return{call:{callKey:new Uint8Array(r)}}}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t,r){const{type:n,ciphertext:i}=yield y.Cipher.encryptSignalProto(t,(0,m.encodeAndPad)(e));return{encNode:(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(n),count:(0,o.INT)(r)},i),shouldHaveIdentity:n===_.CiphertextType.Pkmsg}}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){if(f.GK.supportsFeature(f.GK.F.MD_ADV)){const t=yield(0,d.getADVEncodedIdentity)();e.push((0,o.wap)("device-identity",null,t))}}))).apply(this,arguments)}},77723:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(55253),o=r(11849);function s(){return(s=(0,i.default)((function*(e){var t;const r=yield o.waSignalStore.getRegistrationInfo();if(!r)throw Error("No registration info found");const{identityKeyPair:n}=r,i=null!==(t=e[1]&&parseInt(e[1].count,10))&&void 0!==t?t:0,s=yield(0,a.prepareKeysForRetry)(i,n);return s&&e[2]&&Array.isArray(e[2])&&e[2].push(s),e}))).apply(this,arguments)}},25662:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=r(24747),l=r(97398),c=r(39410);function d(){return(d=(0,i.default)((function*(e){const t=e.common,r=(0,o.createWid)(t.peer_jid);let n,i;r.isGroupCall()?(n=(0,c.GROUP_CALL_JID)(r),i=Promise.resolve()):(n=(0,c.DEVICE_JID)(r),i=(0,l.ensureE2ESessions)([r])),yield i;const d=(0,c.voipXmlToWapNode)(e.payload),u=(0,a.generateId)(),p=(0,a.wap)("call",{to:n,id:u},d),f=yield(0,s.sendStanzaAndReturnAck)(p,{id:String(u),class:"call",from:r,participant:null});return{payload:(0,c.wapNodeToVoipXml)(f),status:200}}))).apply(this,arguments)}},64254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(24747),s=r(11849),l=r(45473),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield s.waSignalStore.getRegistrationInfo();if(!n)throw Error("No registration info found");const i=(0,a.wap)("receipt",{to:(0,c.DEVICE_JID)(t.peer_jid),id:(0,a.CUSTOM_STRING)(e),type:(0,a.CUSTOM_STRING)(l.ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},(0,a.wap)("enc_rekey",{"call-creator":(0,c.DEVICE_JID)(t.call_creator),"call-id":(0,a.CUSTOM_STRING)(t.call_id),count:(0,a.INT)(r+1)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(n.registrationId)));(0,o.castStanza)(i)}))).apply(this,arguments)}},84590:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(52230),s=n(r(45095)),l=r(84902),c=n(r(41143)),d=r(46308),u=r(24808),p=r(8001),f=r(49714),_=r(45033),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),g=r(93832);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function y(){return(y=(0,i.default)((function*(e,t){var r;const n=t.payload[2]&&t.payload[2].find((e=>"enc"===e[0])),i=e.peer_jid;if(!n||!i)return{result:f.E2EProcessResult.SUCCESS};let a=0;(null===(r=n[1])||void 0===r?void 0:r.count)&&(a=parseInt(n[1].count,10)||0);const l={e2eType:n[1].type,mediaType:null,ciphertext:new Uint8Array(n[2]),retryCount:a,hideFail:!1};try{const e=t.payload[2].find((e=>"device-identity"===e[0]));if(null!=i.device&&i.device!==o.DEFAULT_DEVICE_ID&&l.e2eType===_.CiphertextType.Pkmsg&&!e)return __LOG__(2)`voip:validateAndDecryptEnc: expected device-identity with pkmsg enc`,{result:f.E2EProcessResult.PARSE_ERROR};if(e){const t=new Uint8Array(e[2]);if(!(yield(0,d.validateADVwithEncs)(i,t,[l])))return{result:f.E2EProcessResult.PARSE_ERROR};__LOG__(2)`voip:validateAndDecryptEnc: successfully validated ADV device-identity`}const{result:r,decrypted:c}=yield E(l,i);return r===f.E2EProcessResult.SUCCESS&&(n[2]=Array.prototype.slice.call(new Uint8Array((0,s.default)(c,"decrypted")))),{result:r,retryCount:a}}catch(e){return __LOG__(3)`voip:validateAndDecryptEnc error`,{result:f.E2EProcessResult.PARSE_ERROR}}}))).apply(this,arguments)}function E(e,t){return(0,c.default)(e.e2eType!==_.CiphertextType.Skmsg,"VoIP enc type should not be skmsg"),h.Cipher.decryptSignalProto(t,e.e2eType,e.ciphertext).then((e=>{var t;const r=(0,g.unpad)(e),n=(0,l.decodeProtobuf)(u.MessageSpec,r);return(null===(t=n.call)||void 0===t?void 0:t.callKey)?{result:f.E2EProcessResult.SUCCESS,decrypted:n.call.callKey}:{result:f.E2EProcessResult.PARSE_ERROR}})).catch((0,a.filteredCatch)(p.SignalDecryptionError,(e=>(__LOG__(3)`voip:decryptSignalProto failed with decryption error; ${e}`,{result:f.E2EProcessResult.RETRY})))).catch((e=>(__LOG__(3)`voip:decryptSignalProto failed with unexpected error; ${e}`,{result:f.E2EProcessResult.PARSE_ERROR})))}},4182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=t.CONTACT_SYNC_CHUNK_SIZE=void 0;t.CONTACT_SYNC_CHUNK_SIZE=500;t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=20},33192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactList=b,t.syncContactListInChunks=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),o=r(13959),s=r(92844),l=r(72441),c=r(45454),d=r(4182),u=r(91036),p=r(9108),f=r(53379),_=r(54181),h=r(10435),g=n(r(92417)),m=r(76214),y=r(53686),E=r(72407),S=r(46133),v=r(79942),T=r(52284),C=r(92027);function A(){return(A=(0,i.default)((function*(e){let{contactIds:t,shouldDelayBetweenChunks:r}=e;const n=d.CONTACT_SYNC_CHUNK_SIZE;__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${t.length} contacts in ${Math.ceil(t.length/n)} chunks, each chunk size: ${n}`;for(let e=0;e<t.length;e+=n){const i=t.slice(e,e+n);r&&(yield(0,o.delayMs)(1e3*d.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS)),yield b({contactIds:i,shouldSyncDevice:!0})}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){let{contactIds:t,shouldSyncDevice:r}=e;if(0===t.length)return;const n=yield G(t),i=(new T.USyncQuery).withContext("background").withMode("full").withBusinessProtocol().withStatusProtocol().withPictureProtocol();r&&i.withDeviceProtocol(),(0,h.isDisappearingModeEnabled)()&&i.withDisappearingModeProtocol(),n.forEach((e=>{i.withUser((new v.USyncUser).withId(e.id).withDeviceHash(String(e.hash)))}));let a=null,s=3,l=10*Math.random();for(;s-- >0;)try{a=yield i.execute();const e=a.error.all;var c;if(e)throw l=null!==(c=e.errorBackoff)&&void 0!==c?c:10*Math.random(),new Error(`syncContactList: error ${e.errorCode}: ${e.errorText}`);s=0}catch(e){0===s&&(__LOG__(4,!0,new Error,!0)`failed to execute usync query`,SEND_LOGS("failed to execute usync query: "+e)),yield(0,o.delayMs)(1e3*l)}if(null==a||a.error.all)return;const d=a.refresh,u=[];for(const e of Object.keys(d))u.push(d[e]);if(u.length>0){F(Math.min(...u))}yield Promise.all([r?L(a):Promise.resolve(),(0,h.isDisappearingModeEnabled)()?O(a):Promise.resolve(),M(a),w(a),D(a)]),yield N(t)}))).apply(this,arguments)}function M(e){const t=e.error.status;t?__LOG__(3)`handleSyncStatus: failed ${t.errorCode} : ${t.errorText}`:e.list.map((e=>{const t=S.StatusCollection.get(e.id);t&&e.status&&t.set({status:e.status})}))}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=e.error.status;t?__LOG__(3)`handleDisappearingMode: failed ${t.errorCode} : ${t.errorText}`:yield Promise.all(e.list.map(function(){var e=(0,i.default)((function*(e){e.disappearing_mode&&(yield(0,u.updateDisappearingMode)(e.id,e.disappearing_mode.duration,e.disappearing_mode.t))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=e.list.filter((e=>{let{business:t}=e;return Boolean(t)}));yield(0,C.handleVerifiedNameSync)(t.map((e=>{let{id:t,business:{verifiedName:r}}=e;return{id:t,verifiedName:r}})))}))).apply(this,arguments)}function D(e){const t=e.error.pictures;t&&__LOG__(3)`handleSyncProfilePictures: failed ${t.errorCode} : ${t.errorText}`}function N(e){const t=e.map((e=>({id:(0,l.toPhoneUserJid)(e.user),isContactSyncCompleted:1})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${t.length} contacts completed for contact sync`,(0,m.getContactTable)().bulkCreateOrMerge(t)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){const t=e.error.devices;t&&__LOG__(3)`handleSyncDevice: error ${t.errorCode}: ${t.errorText}`;const r=e.list.filter((e=>e.devices&&null!=e.devices.deviceList&&null!=e.devices.keyIndex&&!("errorCode"in e.devices))).map((e=>({wid:e.id,devices:e.devices})));return __LOG__(2)`handleSyncDevice: skipping ${e.list.length-r.length} out of ${e.list.length} records`,yield(0,f.getAndStoreIdentityKeys)(r.map((e=>e.wid))),(0,_.handleADVDeviceSyncResult)(r)}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){const t=e.map((e=>e.user)),r=(yield(0,p.getDeviceIds)(t)).map((e=>e?e.devices.map((t=>(0,c.createDeviceWidFromUserAndDevice)(e.id,t))):[])),n=yield Promise.all(r.map((e=>0===e.length?"":(0,y.phashV2)(e))));return e.map(((e,t)=>({id:e,hash:n[t]})))}))).apply(this,arguments)}function F(e){Number.isNaN(e)||e<=s.HOUR_SECONDS?__LOG__(3,void 0,void 0,void 0,["contact-sync"])`invalid contact sync refresh period: ${e}`:(__LOG__(2,void 0,void 0,void 0,["contact-sync"])`set contact sync refresh period: ${e}`,(0,a.default)(g.default,"localStorage").setItem(E.KEYS.CONTACT_SYNC_REFRESH,String(e)))}},60764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_ALERT_TYPE=void 0;const n=r(76672)({LOW_QUOTA_EXCEEDED:"low_quota_exceed",HIGH_QUOTA_EXCEEDED:"high_quota_exceed",NO_ALERT:"no_alert"});t.STORAGE_ALERT_TYPE=n},46920:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_PARTICIPANT_TYPES=void 0;t.GROUP_PARTICIPANT_TYPES={superadmin:"superadmin",admin:"admin",participant:"participant"}},18615:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipants=function(){return u.apply(this,arguments)},t.demoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.DEMOTE,t,r,n,i)},t.participantsAction=p,t.promoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.PROMOTE,t,r,n,i)},t.removeParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.REMOVE,t,r,n,i)},t.updateParticipants=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(64114),s=r(51727),l=r(70405),c=r(97153);function d(){return(d=(0,i.default)((function*(e){let{group:t,participants:r,version:n,isOffline:i}=e;const a=[],o=[];r.forEach((e=>{e.isAdmin&&o.push(e.id),a.push(e.id)}));const l=yield f(a,i);return(0,s.replaceParticipants)({group:t,participants:a,admins:o,deviceIds:l,version:n})}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){let{group:t,participants:r,version:n,prevVersion:i,isOffline:a}=e;if(null==n)throw new Error("addParticipants: incoming change missing version id");const o=yield f(r,a);return(0,s.updateParticipants)(t,{action:l.PARTICIPANT_OPERATION.ADD,participants:r,deviceIds:o,version:n,prevVersion:i})}))).apply(this,arguments)}function p(e,t,r,n,i){return null==n?Promise.reject(new Error(`participantsAction with action = ${e}: incoming change missing version id`)):(0,s.updateParticipants)(t,{action:e,participants:r,version:n,prevVersion:i})}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){let r=[];if(t)return yield(0,c.addUserToPendingDeviceSync)(e.map((e=>String(e)))),e;r=yield(0,o.syncAndGetDeviceList)(e);let n=[];return r.forEach(((t,r)=>{if(t){const{devices:e,id:r}=t;n=n.concat(e.map((e=>(0,a.createDeviceWidFromUserAndDevice)(r,e))))}else n.push(e[r])})),n}))).apply(this,arguments)}},2182:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDescription=_,t.extractLinkedParent=h,t.parseGroupNode=g,t.queryGroup=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(24747),u=r(46920),p=r(39410),f=r(77591);function _(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent()){const r={desc:e.contentString(),descId:t.attrString("id")};return t.hasAttr("participant")&&(r.descOwner=(0,l.userJidToUserWid)(t.attrPhoneUserJid("participant"))),t.hasAttr("t")&&(r.descTime=t.attrTime("t")),r}}}return null}function h(e){const t=e.maybeChild("linked_parent"),r=null==t?void 0:t.maybeAttrGroupJid("jid");return null==r?null:{parentGroup:(0,l.groupJidToWid)(r)}}function g(e){var t,r,n;const i=_(e),o=function(e){const t={subject:e.attrString("subject")};return e.hasAttr("s_o")&&(t.subjectOwner=(0,l.userJidToUserWid)(e.attrPhoneUserJid("s_o"))),e.hasAttr("s_t")&&(t.subjectTime=e.attrTime("s_t")),t}(e),s=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(e),d=function(e){const t=e.maybeChild("growth_locked"),r=null==t?void 0:t.maybeAttrInt("expiration"),n=null==t?void 0:t.maybeAttrString("type");return null==r||null==n?null:{growthLockExpiration:r,growthLockType:n}}(e),p=h(e);let f;try{f=(0,c.createWid)(`${e.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=f)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");const g=e.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",u.GROUP_PARTICIPANT_TYPES,u.GROUP_PARTICIPANT_TYPES.participant);return{id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===u.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===u.GROUP_PARTICIPANT_TYPES.admin||t===u.GROUP_PARTICIPANT_TYPES.superadmin}})),m={id:f,owner:e.hasAttr("creator")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("creator")):void 0,creation:e.attrTime("creation"),restrict:e.hasChild("locked"),announce:e.hasChild("announcement"),noFrequentlyForwarded:e.hasChild("no_frequently_forwarded"),participants:g,pvId:e.hasAttr("p_v_id")?e.attrInt("p_v_id"):void 0,support:e.hasChild("support"),size:e.hasAttr("size")?e.attrInt("size"):void 0,suspended:e.hasChild("suspended"),parent:null!==(r=e.hasChild("parent"))&&void 0!==r?r:void 0,defaultSubgroup:null!==(n=e.hasChild("default_sub_group"))&&void 0!==n?n:void 0};return(0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)({},m),i),s),d),o),p)}const m=new s.WapParser("queryGroupParser",(e=>e.hasChild("group")?g(e.child("group")):{phashMatch:!0}));function y(){return(y=(0,i.default)((function*(e){const{groupWid:t,request:r,phash:n}=e,i=(0,o.wap)("iq",{to:(0,p.GROUP_JID)(t),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{request:r||o.DROP_ATTR,phash:(0,o.MAYBE_CUSTOM_STRING)(n)})),a=yield(0,d.sendIq)(i,m);if(!a.success)return __LOG__(2)`queryGroup failed: ${a.errorCode}:${a.errorType}`,Promise.reject(new f.ServerStatusCodeError(a.errorCode,a.errorText));const{result:s}=a;return s.phashMatch?Promise.reject(new Error("queryGroup: phash match case is not implemented!")):s}))).apply(this,arguments)}},46308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearADVSecretKey=function(){(0,y.setADVSecretKey)(void 0)},t.generateADVSecretKey=function(){const e=new Uint8Array(32);self.crypto.getRandomValues(e);const t=(0,a.encodeB64)(e);return(0,y.setADVSecretKey)(t),t},t.generateDeviceSignature=function(e,t,r){const n=e.details,i=o.Binary.build(O,n,t.pubKey,r).readByteArray().buffer;return window.libsignal.Curve.calculateSignature(t.privKey,i)},t.getADVEncodedIdentity=function(){return w.apply(this,arguments)},t.getADVSecretKey=function(){const e=(0,y.getADVSecretKey)();if(null==e)throw new Error("MD secretKey is null or undefined");return e},t.setADVSignedIdentity=function(e){if(null==e)return Promise.reject(new Error("MD advSignedDeviceIdentity is null or undefined"));if(null==e.deviceSignature)return Promise.reject(new Error("MD advSignedDeviceIdentity is missing deviceSignature"));return v.waSignalStore.putADVSignedIdentity(e)},t.validateADVwithEncs=function(){return P.apply(this,arguments)},t.validateADVwithIdentityKey=A,t.verifyDeviceIdentityAccountSignature=R,t.verifyDeviceSignature=D,t.verifyKeyIndexListAccountSignature=function(e,t){const r=e.details,n=e.accountSignature;(0,d.default)(null!=n,"accountSignature should not be null");const i=o.Binary.build(I,r).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),i,new Uint8Array(n))};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(45454),l=r(84902),c=r(60980),d=n(r(41143)),u=r(61438),p=r(11365),f=r(5087),_=r(7293),h=r(57701),g=r(54181),m=r(45033),y=r(58052),E=n(r(76128)),S=r(52083),v=r(11849),T=r(91335),C=r(93832);function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!_.GK.supportsFeature(_.GK.F.MD_ADV))return!0;try{const i=(0,p.uint8ArrayToBuffer)(r),a=yield(0,S.getSignalProtocolStore)().loadIdentityKey((0,C.createSignalAddress)(e).toString());if(a){const e=(0,f.toCurveKeyPubKey)((0,C.strToBuffer)(a));if((0,C.bufferEqual)(e,i))return!0}const o=(0,l.decodeProtobuf)(u.ADVSignedDeviceIdentitySpec,t);(0,d.default)(null!=o,"advSignedDeviceIdentity should not be null");const c=yield E.default.loadIdentityKey((0,C.createSignalAddress)((0,s.toUserWid)(e)).toString()),_=c?(0,f.toCurveKeyPubKey)((0,C.strToBuffer)(c)):null;if(!R(o,i,_))return __LOG__(3)`validateADVIdentity: invalid account signature`,!1;if(!D(o,i,_))return __LOG__(3)`validateADVIdentity: invalid device signature`,!1;const h=(0,l.decodeProtobuf)(u.ADVDeviceIdentitySpec,o.details);(0,d.default)(null!=h,"advDeviceIdentity should not be null");try{yield(0,g.handleADVDeviceUpdateForMessage)(e,h,_,o.accountSignatureKey,i,n)}catch(e){return __LOG__(3)`validateADVIdentity: process adv device identity failed`,!1}return __LOG__(2)`validateADVIdentity: successfully verified accountSignature and deviceSignature`,!0}catch(e){return __LOG__(3)`validateADVIdentity: failed`,!1}}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!_.GK.supportsFeature(_.GK.F.MD_ADV))return!0;const i=r.find((e=>e.e2eType===m.CiphertextType.Pkmsg));if(!i)return!0;__LOG__(2)`validateADVwithEncs: start validate prekey msg `;try{(0,d.default)(null!=e,"author should not be null");const r=(0,T.extractIdentityKey)(i.ciphertext);(0,d.default)(null!=r,"identityKey should not be null");const a=yield A(e,t,new Uint8Array(r),n);return(0,h.identityStoreCacheEnabled)()&&(yield(0,S.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode()),a}catch(e){return __LOG__(3)`validateADVwithEncs: failed ${e}`,!1}}))).apply(this,arguments)}const M=new Uint8Array([6,0]),O=new Uint8Array([6,1]),I=new Uint8Array([6,2]);function w(){return(w=(0,i.default)((function*(){const e=yield v.waSignalStore.getADVSignedIdentity();if(null==e)throw new Error("MD advSignedDeviceIdentity is null or undefined");if(null==e.deviceSignature)throw new Error("MD advSignedDeviceIdentity is missing deviceSignature");return(0,c.encodeProtobuf)(u.ADVSignedDeviceIdentitySpec,e).readByteArray()}))).apply(this,arguments)}function R(e,t,r){const n=e.details,i=e.accountSignatureKey||r;(0,d.default)(null!=i,"accountSignatureKey should not be null");const a=e.accountSignature;(0,d.default)(null!=a,"accountSignature should not be null");const s=o.Binary.build(M,n,t).readByteArray();return(0,f.verifySignature)(new Uint8Array(i),s,new Uint8Array(a))}function D(e,t,r){const n=e.details,i=e.deviceSignature;(0,d.default)(null!=i,"deviceSignature should not be null");const a=e.accountSignatureKey||r;(0,d.default)(null!=a,"accountSignatureKey should not be null");const s=o.Binary.build(O,n,t,a).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),s,new Uint8Array(i))}},18634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeIdentityHash=y,t.getICDCMeta=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(73045),o=r(52230),s=n(r(45095)),l=r(27764),c=r(92844),d=r(45454),u=r(86945),p=r(5087),f=r(9108),_=r(99234),h=n(r(76128)),g=r(56592);function m(){return(m=(0,i.default)((function*(e){if(!1===(0,u.getABPropConfigValue)("md_icdc_enabled"))return null;const t=yield(0,f.getDeviceRecord)(e.user);if(!t||t.deleted)return null;const r={keyHash:void 0,timestamp:void 0},{timestamp:n,devices:i}=t,a=i.some((e=>e.id!==o.DEFAULT_DEVICE_ID));if(a){const n=i.map((e=>[e.keyIndex,(0,d.createDeviceWidFromUserAndDevice)(t.id,e.id)])),a=[],o=(0,_.assertGetMe)();let l=null;n.forEach((e=>{let[t,r]=e;r.equals(o)?l=t:a.push([t,r])}));const c=yield(0,g.getAllIdentityKeysBytes)(a.map((e=>{let[,t]=e;return t}))),u=[],f=[];if(c.forEach(((e,t)=>{null!=e&&(u.push(e),f.push(a[t][0]))})),o.user===e.user){const e=yield h.default.getIdentityKeyPair();if(!e)return null;u.push(new Uint8Array(e.pubKey)),f.push((0,s.default)(l,"myKeyIndex"))}const m=S();r.keyHash=yield y(u.map((e=>new Uint8Array((0,p.toCurveKeyPubKey)(e.buffer)))),m),f.length!==i.length&&(r.keyIndexes=f)}return(a||v(n))&&(r.timestamp=n),r}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const r=(0,g.identityKeysToBinary)(e),n=yield(0,a.sha256)(r),i=new Uint8Array(n);return(0,l.sliceBytes)(i,0,t)}))).apply(this,arguments)}function S(){const e=(0,u.getABPropConfigValue)("md_icdc_hash_length");return Math.max(e,8)}function v(e){return(0,c.unixTime)()-e<2592e3}},56592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllIdentityKeysBytes=d,t.getAllIdentityKeysBytesOrThrow=function(){return c.apply(this,arguments)},t.identityKeysToBinary=function(e){const t=new a.Binary;return e.sort(l).forEach((e=>{t.writeByteArray(e)})),t.readByteArray()};var i=n(r(48926)),a=r(8584),o=n(r(76128)),s=r(93832);function l(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return e[r]-t[r];return e.length-t.length}function c(){return(c=(0,i.default)((function*(e){return(yield d(e)).map(((t,r)=>{if(null==t)throw new Error(`getAllIdentityKeys: missing identity key for device ${String(e[r])}`);return t}))}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){return(yield o.default.bulkLoadIdentityKey(e.map((e=>(0,s.createSignalAddress)(e).toString())))).map((e=>null==e?null:new Uint8Array((0,s.strToBuffer)(e))))}))).apply(this,arguments)}},76802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RESEND_TIMEOUT_IN_SECONDS=void 0,t.createResendAbortMetric=function(e,t,r){const n=(0,i.default)({e2eBackfill:!0,messageIsRevoke:e,messageSendResultIsTerminal:!1,isViewOnce:t},(0,g.getGroupMetricsFromChatWid)(r));return new E.default.MessageSend(n)},t.editAttribute=function(e,t){if(T(e)){const e="admin_revoke"===t?c.EDIT_ATTR.ADMIN_REVOKE:c.EDIT_ATTR.SENDER_REVOKE;return(0,s.CUSTOM_STRING)(String(e))}if(C(e))return(0,s.CUSTOM_STRING)(String(c.EDIT_ATTR.SENDER_REVOKE));return s.DROP_ATTR},t.encodeAndPad=function(e){const t=(0,p.encodeProtobuf)(f.MessageSpec,e);return(0,v.writeRandomPadMax16)(t),t.readByteArray()},t.filterDeviceWithChangedIdentity=function(){return M.apply(this,arguments)},t.isPrimaryDevice=function(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID},t.isRevokeMsg=T,t.isRevokeReactionMsg=C,t.populateICDCMeta=function(){return b.apply(this,arguments)},t.sendMsgAckSyncParser=void 0,t.updateIdentityRange=function(){return P.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(31914),l=r(71914),c=r(35470),d=r(67811),u=r(45454),p=r(60980),f=r(24808),_=r(99234),h=r(6565),g=r(42515),m=r(18634),y=r(90981),E=n(r(11339)),S=n(r(76128)),v=r(93832);function T(e){return null!=e.protocolMessage&&e.protocolMessage.type===f.Message$ProtocolMessageType.REVOKE}function C(e){return null!=e.reactionMessage&&e.reactionMessage.text===d.REVOKED_REACTION_TEXT}t.RESEND_TIMEOUT_IN_SECONDS=300;const A=new l.WapParser("sendMsgAckSyncParser",(e=>(e.assertTag("ack"),{t:e.attrTime("t"),sync:e.hasAttr("sync")?e.attrString("sync"):null,phash:e.hasAttr("phash")?e.attrString("phash"):null,count:e.hasAttr("count")?e.attrInt("count"):null})));function b(){return(b=(0,a.default)((function*(e,t){const r=(0,_.getMeUser)();let n,i;try{n=yield(0,m.getICDCMeta)(r)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!0}).commit(),e}try{i=e.equals(r)?null:yield(0,m.getICDCMeta)(e)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!1}).commit(),e}(0,h.populateMessageContextInfo)(t,n,i)}))).apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){const r=yield(0,y.getTable)().get(String(e),!1);null!=(null==r?void 0:r.rowId)&&(yield S.default.updateIdentityRangeAfterEncryption(r.rowId,t.map((e=>(0,v.createSignalAddress)(e).toString()))))}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t){const r=yield(0,y.getTable)().get(String(e),!1),n=null==r?void 0:r.rowId;if(null==n)return __LOG__(2)`filterDeviceWithChangedIdentity: get message with empty rowId`,[];const i=new Set;t.forEach((e=>{i.add(e.user)}));const a=Array.from(i).map((e=>(0,u.createDeviceWidFromUserAndDevice)(e,o.DEFAULT_DEVICE_ID))),s=yield S.default.bulkGetIdentityRowId(a.map((e=>(0,v.createSignalAddress)(e).toString()))),l=new Set;return s.forEach(((e,t)=>{const r=a[t];(null==e||e>n)&&l.add(r.user)})),t.filter((e=>!l.has(e.user)))}))).apply(this,arguments)}t.sendMsgAckSyncParser=A},64114:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncAndGetDeviceList=function(){return S.apply(this,arguments)},t.syncDeviceList=h,t.syncMyDeviceList=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=n(r(94654)),o=r(45454),s=r(9108),l=r(99234),c=r(53379),d=r(54181),u=r(53686),p=r(79942),f=r(52284);const _=new Map;function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let{wids:t,context:r,phash:n}=e;if(null!=n){const e=t.map((e=>e.user)),r=(yield(0,s.getDeviceIds)(e)).map((e=>e?e.devices.map((t=>(0,o.createDeviceWidFromUserAndDevice)(e.id,t))):[])),i=(0,a.default)(r,(e=>e));if(n===(yield(0,u.phashV2)(i)))return}const i=new Set,l=[];if(t.forEach((e=>{const t=_.get(e.user);t?i.add(t):l.push(e)})),0===l.length)return void(yield Promise.all(Array.from(i)));const c=m(l.map((e=>e.user)),l,r);l.map((e=>{_.set(e.user,c)})),yield Promise.all([c,...Array.from(i)])}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r){try{const n=yield(0,s.getDeviceInfoForSync)(e),i=n.map((e=>e?e.devices.map((t=>(0,o.createDeviceWidFromUserAndDevice)(e.id,t))):[])),a=yield Promise.all(i.map((e=>0===e.length?"":(0,u.phashV2)(e))));return v(t.map(((e,t)=>{var r,i;return{id:e,hash:a[t],ts:null===(r=n[t])||void 0===r?void 0:r.timestamp,expectedTs:null===(i=n[t])||void 0===i?void 0:i.expectedTs}})),r)}catch(e){__LOG__(4,void 0,new Error)`Failed to sync device list with error: ${e}`}finally{t.map((e=>{_.delete(e.user)}))}}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){yield h({wids:[(0,l.getMeUser)()],context:null,phash:null})}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=e.map((e=>e.user));return yield h({wids:e,context:null,phash:null}),(0,s.getDeviceIds)(t)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(0===e.length)return;const r=(new f.USyncQuery).withContext(t||"interactive").withDeviceProtocol();e.forEach((e=>{0!==e.id.user&&r.withUser((new p.USyncUser).withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))}));const n=yield r.execute();if(n.error.all)throw new Error(`syncDeviceList: error ${n.error.all.errorCode}: ${n.error.all.errorText}`);n.error.devices&&__LOG__(3)`syncDeviceList: error ${n.error.devices.errorCode}: ${n.error.devices.errorText}`;let i=n.list.filter((e=>!("errorCode"in e.devices)));i=i.map((e=>({wid:e.id,devices:e.devices})));const a=i.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})).map((e=>e.wid));return __LOG__(2)`syncDeviceList: skipping ${n.list.length-a.length} out of ${n.list.length} records`,yield(0,c.getAndStoreIdentityKeys)(a),(0,d.handleADVDeviceSyncResult)(i)}))).apply(this,arguments)}},37039:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBuildHash=g,t.getClientPayloadForLogin=function(e){const t=(0,d.assertGetMe)(),r=(0,i.default)((0,i.default)({},h(e)),{},{username:parseInt(t.user,10),device:null!=t.device?t.device:0});return(0,o.encodeProtobuf)(f.ClientPayloadSpec,r).readByteArray()},t.getClientPayloadForRegistration=function(e,t,r){const n=g(),a=m(),s=(0,i.default)((0,i.default)({},h(r)),{},{regData:{buildHash:n,companionProps:a,eRegid:(0,l.intToBytes)(4,e.registrationId),eKeytype:(0,l.intToBytes)(1,5),eIdent:e.identityKeyPair.pubKey,eSkeyId:(0,l.intToBytes)(3,t.keyId),eSkeyVal:t.keyPair.pubKey,eSkeySig:t.signature}});return(0,o.encodeProtobuf)(f.ClientPayloadSpec,s).readByteArray()},t.getCompanionProps=m,t.getPlatformTypeFromName=E,t.getUserAgent=y,t.getWebSubPlatform=S;var i=n(r(81109)),a=r(15688),o=r(60980),s=n(r(87045)),l=r(11365),c=r(98263),d=r(99234),u=r(14111),p=n(r(64084)),f=r(84331),_=r(42448);function h(e){return{passive:!!e&&e.passive,connectType:f.ClientPayloadConnectType.WIFI_UNKNOWN,connectReason:f.ClientPayloadConnectReason.USER_ACTIVATED,userAgent:y(),webInfo:{webSubPlatform:S()}}}function g(){const e=(0,a.decodeB64)((0,p.default)("2.2208.7"));return new Uint8Array(e)}function m(){const e=s.default.info();let t;if(e.version&&""!==e.version){const r=e.version.split(".");r.length>0&&e.version&&/^[0-9\.]+$/.test(e.version)&&(t={primary:parseInt(r[0],10),secondary:r.length>1?parseInt(r[1],10):void 0,tertiary:r.length>2?parseInt(r[2],10):void 0})}const r={os:e.os,version:t,platformType:E(e.name),requireFullSync:!1};return(0,o.encodeProtobuf)(c.CompanionPropsSpec,r).readByteArray()}function y(){const e=u.deviceInfo.get(),t=f.ClientPayload$UserAgentReleaseChannel.RELEASE;return{appVersion:{primary:Number("2"),secondary:Number("2208"),tertiary:Number("7")},platform:f.ClientPayload$UserAgentPlatform.WEB,releaseChannel:t,mcc:e.mcc,mnc:e.mnc,osVersion:e.osVersion,manufacturer:e.manufacturer,device:e.device,osBuildNumber:e.osBuild,localeLanguageIso6391:e.lg,localeCountryIso31661Alpha2:e.lc}}function E(e){switch(e){case"Chrome":return c.CompanionPropsPlatformType.CHROME;case"Firefox":return c.CompanionPropsPlatformType.FIREFOX;case"IE":return c.CompanionPropsPlatformType.IE;case"Opera":return c.CompanionPropsPlatformType.OPERA;case"Safari":return c.CompanionPropsPlatformType.SAFARI;case"Edge":return c.CompanionPropsPlatformType.EDGE;case"electron":case"Desktop":return c.CompanionPropsPlatformType.DESKTOP;case"ipad":case"iPad":return c.CompanionPropsPlatformType.IPAD;case"tablet":case"Android tablet":return c.CompanionPropsPlatformType.ANDROID_TABLET;case"Ohana":return c.CompanionPropsPlatformType.OHANA;case"Aloha":return c.CompanionPropsPlatformType.ALOHA;case"Catalina":return c.CompanionPropsPlatformType.CATALINA;default:return c.CompanionPropsPlatformType.UNKNOWN}}function S(){switch(_.WAM_PLATFORM){case"WEB":return f.ClientPayload$WebInfoWebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return f.ClientPayload$WebInfoWebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return f.ClientPayload$WebInfoWebSubPlatform.WIN32;case"MACSTORE":return f.ClientPayload$WebInfoWebSubPlatform.APP_STORE;case"WINSTORE":return f.ClientPayload$WebInfoWebSubPlatform.WIN_STORE;default:return}}},10151:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=w;var i=n(r(48926)),a=(r(70818),r(65044)),o=r(7293),s=r(79736),l=r(41796),c=r(46582),d=r(72651),u=r(99234),p=r(58052),f=r(36163),_=r(97480),h=r(10786),g=r(76214),m=r(318),y=r(92613),E=n(r(18438)),S=r(29100),v=r(24747),T=r(83254),C=r(88102),A=n(r(67938)),b=n(r(52991)),P=r(62583),M=r(55062);function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(){const e=(0,M.getCommsConfig)(void 0);return(0,v.startComms)(E.default,S.sendPing,e,(e=>Promise.resolve((0,d.inflate)(e))),(()=>{}),(()=>{})),yield(0,v.waitForConnection)(),(0,v.startHandlingRequests)()}))).apply(this,arguments)}function w(e){const t=(0,s.makeBridge)();(0,l.setBridge)(t),(0,c.requireSetHandlers)().then((e=>e(t)));let r=Promise.resolve();return o.GK.supportsFeature(o.GK.F.MD_BACKEND)?r=(0,h.initEncSalt)().then((()=>(0,h.initEncSaltForInvoker)())).then((()=>(0,m.initialize)())).catch((e=>{__LOG__(4,void 0,new Error,void 0,["launch_socket"])`storageInitializationError triggered logout: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}.`,C.Cmd.storageInitializationError()})).then((()=>{if(b.default.isLogoutInProgress)throw new Error("aborting launchSocket due to logout");return(0,p.isRegistered)()?(__LOG__(2)`[launch socket] launch socket for loggin`,C.Cmd.initialLoadReady(),(0,g.initialize)().catch((()=>C.Cmd.storageInitializationError())).then((()=>{C.Cmd.incrementProgress(),(0,f.restoreImportantMetaData)()})).then((()=>(0,f.restoreBlocklist)())).then((()=>{C.Cmd.incrementProgress(),(0,y.startBackend)()}))):(__LOG__(2)`[launch socket] launch socket for registration`,C.Cmd.incrementProgress(),_.OfflineResumeReporter.setIsInitialSync(),Promise.all([(0,T.refreshNoiseCredentials)(),(0,T.refreshSignalCredentials)()]).then((()=>{C.Cmd.incrementProgress(),O()})))})):a.Socket.launch(e),r}C.Cmd.on("md_downgrade_webclient",(0,i.default)((function*(){(0,v.stopComms)(),yield(0,h.deleteEncKeysAndCache)(),a.Socket.set({launched:!1,stream:P.SOCKET_STREAM.DISCONNECTED,mustExitLoop:!1,shouldUpgradeToMD:!1}),(0,u.setMdOptedIn)(!1),o.GK.setFeature(o.GK.F.MD_BACKEND,!1),o.GK.setFeature(o.GK.F.MD_ADV,!1),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),a.Socket.initialize(),a.Socket.handler||a.Socket.registerHandler(A.default),w(!0)}))),C.Cmd.on("upgrade_to_md",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),o.GK.setFeature(o.GK.F.MD_ADV,!0),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),w(!0),(0,p.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("upgrade_to_md_prod",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),o.GK.setFeature(o.GK.F.MD_ADV,!0),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),w(!0),(0,p.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("md_refresh_qr",(()=>{(0,v.stopComms)(),O()})),C.Cmd.on("logout",(()=>{o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&w(!0)}))},85726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(0,m.isRegistered)())return function(){return R.apply(this,arguments)}(e);return function(){return w.apply(this,arguments)}(e)};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(17525),l=(r(87614),r(10095)),c=n(r(45095)),d=r(27498),u=r(84902),p=r(60980),f=r(37039),_=r(88102),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=C(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(5087)),g=r(14111),m=r(58052),y=r(11849),E=n(r(33815)),S=r(24774),v=r(78155),T=n(r(17072));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(C=function(e){return e?r:t})(e)}const A=new Uint8Array([87,65,6,d.DICT_VERSION]),b="Noise_XX_25519_AESGCM_SHA256\0\0\0\0";let P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,m.getRoutingInfo)(),t=e?e.edgeRouting:null;let r=t?(0,a.encodeB64UrlSafe)(t):null;const n=new E.default({routingToken:r}),i=h.keyPair(),[c,d,u]=yield(0,T.default)(n,"change:socket").cancellable().then((()=>n.socket)).finally((()=>{n.deactivate()})).then((e=>{let r;if(t){const e=new o.Binary;e.write("ED",0,1),e.writeUint8(t.byteLength>>16),e.writeUint16(65535&t.byteLength),e.writeBuffer(t),r=e.readByteArray()}const n=r?o.Binary.build(r,A).readByteArray():A,a=new s.FrameSocket(e,n);P=new l.NoiseHandshake(a),P.start(b,A),__LOG__(2)`openChatSocket send hello`,P.authenticate(i.pubKey);const c={clientHello:{ephemeral:i.pubKey}};return P.sendAndReceive((0,p.encodeProtobuf)(v.HandshakeMessageSpec,c).readByteArray())})).then((e=>I(P,e,i)));return __LOG__(2)`verifying certificate`,(0,S.verifyChainCertificateWA6)(d,c),u}))).apply(this,arguments)}function I(e,t,r){__LOG__(2)`openChatSocket rcv hello`;const{serverHello:n}=(0,u.decodeProtobuf)(v.HandshakeMessageSpec,t);if(!n)throw new Error("ServerHello payload error");const{ephemeral:i,static:a,payload:o}=n;if(null==i||null==a||null==o)throw new Error("Missing server Ephemeral");e.authenticate(i),e.mixIntoKey(h.sharedSecret(i,r.privKey));const s=e.decrypt(a),l=s.then((e=>h.sharedSecret(e,r.privKey)));return e.mixIntoKey(l),Promise.all([s,e.decrypt(o),i])}function w(){return(w=(0,i.default)((function*(e){try{const t=yield M().then(function(){var t=(0,i.default)((function*(t){_.Cmd.incrementProgress();const r=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair,n=(0,f.getClientPayloadForLogin)(e);return Promise.all([D(r,P,t),P.encrypt(Promise.resolve(n))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return _.Cmd.incrementProgress(),P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return _.Cmd.incrementProgress(),__LOG__(2)`openChatSocketForLogin success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForLogin error ${e}`}}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){try{const t=yield M().then((e=>Promise.all([y.waSignalStore.getRegistrationInfo(),y.waSignalStore.getSignedPreKey(),e]))).then(function(){var t=(0,i.default)((function*(t){let[r,n,i]=t;if(!n||!r)throw new Error("Invalid signal credentials");const a=(0,f.getClientPayloadForRegistration)(r,n,e),o=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair;return Promise.all([D(o,P,i),P.encrypt(Promise.resolve(a))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return __LOG__(2)`openChatSocketForRegistration success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForRegistration error ${e}`}}))).apply(this,arguments)}function D(e,t,r){const n=Promise.resolve(e.pubKey),i=t.encrypt(n);if(!r)return Promise.reject(new Error("staticAgreement called before serverKeys"));const a=h.sharedSecret(r,e.privKey);return t.mixIntoKey(a),i}},72006:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.openSocket=function(e){return new WebSocket(e)};n(r(45095)),r(57932),n(r(92417))},83254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildUrl=function(e,t,r){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw new Error(`buildUrl given invalid host "${e}"`);if(!t.startsWith("/"))throw new Error(`buildUrl given invalid path "${t}"`);const n=r,i=`${e}${t}`;if(!n)return i;const a=Object.keys(n).map((e=>{let t=n[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));const r=t instanceof Uint8Array?Array.prototype.slice.call(t).map((e=>`%${e.toString(16)}`)).join(""):encodeURIComponent(t);return`${encodeURIComponent(e)}=${r}`}));if(a.length>0){const e=a.join("&");return i.includes("?")?`${i}&${e}`:`${i}?${e}`}return i},t.refreshNoiseCredentials=function(){const e=(0,o.keyPair)(),t=new Uint8Array(24);return self.crypto.getRandomValues(t),Promise.resolve(s.waNoiseInfo.set({recoveryToken:t.buffer,staticKeyPair:e}))},t.refreshSignalCredentials=function(){return u.apply(this,arguments)},t.setRoutingInfo=function(e,t){const r={domain:e,edgeRouting:t?(0,a.decodeB64)(t):null};return __LOG__(2)`set routingInfo:`,Promise.resolve((0,c.setRoutingInfo)(r))};var i=n(r(48926)),a=r(15688),o=r(5087),s=r(14111),l=r(58425),c=r(58052),d=r(11849);function u(){return(u=(0,i.default)((function*(){const e=window.libsignal.KeyHelper.generateRegistrationId();yield d.waSignalStore.clearCredential();const t=yield(0,l.generateIdentityKeyPair)();yield Promise.all([d.waSignalStore.setRegistrationInfo({registrationId:e,identityKeyPair:t}),d.waSignalStore.rotateSignedPreKey((0,o.toSignalCurveKeyPair)(t),l.generateSignedKeyPair)])}))).apply(this,arguments)}},62583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WATCHED_SOCKET_STATE=t.SOCKET_STREAM=t.SOCKET_STATE=void 0;t.SOCKET_STATE={OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"};t.SOCKET_STREAM={DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"};t.WATCHED_SOCKET_STATE={OPEN:"OPEN",CLOSED:"CLOSED"}},94030:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=r(8584),s=r(856),l=r(13959),c=r(85553),d=r(11290),u=i(r(78144)),p=i(r(57220)),f=i(r(17072)),_=r(7388),h=r(24465),g=r(12099);const m=3e5,y=18e4,E=(0,h.fibonacci)(8e3,4e3,3e5);class S extends d.BaseModel{constructor(){super(...arguments),this.active=(0,d.prop)(!0),this.socket=(0,d.prop)(),this.sockets=(0,d.prop)(),this.pendingSocketPromiseCount=(0,d.prop)(0),this.attempts=(0,d.prop)(0),this.startId=(0,d.prop)(0),this.controller=(0,d.prop)(),this.retryTimestamp=(0,d.prop)(),this.tsListener=(0,d.prop)(),this.onerror=(0,d.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpener set to socket ${e.id}`,this.set({active:!1,socket:e}),p.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpener closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpener deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(p.default,"change:online",this.onOnlineChange),this.listenTo(c.jsHaltDetector,c.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return __LOG__(2,void 0,void 0,!0)`attemptOpen called while not active!`,void SEND_LOGS("rogue-opener");const e=(0,g.open)({url:"wss://web.whatsapp.com/ws",msgParser:T});this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new n).signal;return p.default.checkOnline({signal:e})},i=new n;(0,l.delayMs)(6e3,i.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=p.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpener:onlineController activating`,new h.Watchdog({waitAlgorithm:E,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpener:offlineController activating`;let e,t=0;return new h.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpener:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpener:offline... heuristic poll`,e=v(n,[(0,_.waitForOnlineNaive)(),(0,f.default)(c.jsHaltDetector,c.JS_HALT_EVENT),(0,f.default)(r(8080).Stream,"change:available")]),m):(__LOG__(2)`SocketOpener:offline... wait for navigator`,t=0,e=v(n,[(0,_.waitForOnlineNaive)()]),m)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function v(e,t){return(0,s.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}function T(e){const t=e.data;let r,n,i;if(t instanceof ArrayBuffer){let e;const a=[],s=new o.Binary(t);for(;44!==(e=s.readUint8());)a.push(e);r=String.fromCharCode.apply(String,a),n=s.readBuffer(),i=t.byteLength}else{if("string"!=typeof t)throw new Error("Unexpected message event type");{const e=t.indexOf(",");r=t.slice(0,e),n=t.slice(e+1),n=n?JSON.parse(n,u.default):void 0,i=new Blob([t]).size}}return{tag:r,data:n,binarySize:i}}var C=(0,d.defineModel)(S);t.default=C},33815:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=r(856),s=r(13959),l=r(85553),c=r(11290),d=i(r(57220)),u=i(r(17072)),p=r(7388),f=r(24465),_=r(14350);const h="wss://web.whatsapp.com/ws/chat",g=3e5,m=18e4,y=(0,f.fibonacci)(8e3,4e3,3e5);class E extends c.BaseModel{constructor(){super(...arguments),this.active=(0,c.prop)(!0),this.socket=(0,c.prop)(),this.sockets=(0,c.prop)(),this.pendingSocketPromiseCount=(0,c.prop)(0),this.attempts=(0,c.prop)(0),this.controller=(0,c.prop)(),this.retryTimestamp=(0,c.prop)(),this.tsListener=(0,c.prop)(),this.onerror=(0,c.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpenerMD set to socket ${e.id}`,this.set({active:!1,socket:e}),d.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpenerMD closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpenerMD deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(d.default,"change:online",this.onOnlineChange),this.listenTo(l.jsHaltDetector,l.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return void __LOG__(2)`attemptOpen called while not active!`;const e=(0,_.open)(this.routingToken?`${h}?ED=${this.routingToken}`:h);this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new n).signal;return d.default.checkOnline({signal:e})},i=new n;(0,s.delayMs)(6e3,i.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=d.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpenerMD:onlineController activating`,new f.Watchdog({waitAlgorithm:y,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpenerMD:offlineController activating`;let e,t=0;return new f.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpenerMD:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpenerMD:offline... heuristic poll`,e=S(n,[(0,p.waitForOnlineNaive)(),(0,u.default)(l.jsHaltDetector,l.JS_HALT_EVENT),(0,u.default)(r(8080).Stream,"change:available")]),g):(__LOG__(2)`SocketOpenerMD:offline... wait for navigator`,t=0,e=S(n,[(0,p.waitForOnlineNaive)()]),g)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>m&&(__LOG__(2)`js halt longer than ${m} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function S(e,t){return(0,o.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}var v=(0,c.defineModel)(E);t.default=v},24774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCertificateWA6=d,t.verifyCertificateWA6=u,t.verifyChainCertificateWA6=function(e,t){const r=(0,a.decodeProtobuf)(s.CertChainSpec,e);if(!r)throw new Error("verifyCertificateWA6 - Missing Certificate");const i=r.intermediate,o=r.leaf;if(null==i||null==o)throw new Error("verifyCertificateWA6 - Missing Leaf and/or Intermediate Certificate");__LOG__(2)`verifying intermediate certificate`;const l=d(i);if(u(l,c.PUBLIC_KEY),l.issuerSerial!==c.SERIAL)throw new Error("verifyChainCertificateWA6 intermediateCert was not issued by RootCA");__LOG__(2)`verifying leaf certificate`;const p=d(o);if(u(p,l.key),p.issuerSerial!==l.serial)throw new Error("verifyChainCertificateWA6 leafCert was not issued by IntermediateCert");if(!(0,n.areBuffersEqual)(p.key,t))throw new Error("verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static")};var n=r(7589),i=r(87614),a=r(84902),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(5087)),s=r(78155);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const c={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:(0,i.parseHex)("142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b")};function d(e){const t=e.details,r=e.signature;if(!t)throw new Error('parseCertificateWA6 certificate is missing "details"');if(!r)throw new Error('parseCertificateWA6 certificate is missing "signature"');const n=(0,a.decodeProtobuf)(s.CertChain$NoiseCertificate$DetailsSpec,t),{issuerSerial:i,serial:o,key:l,notAfter:c,notBefore:d}=n;if(null==i)throw new Error('parseCertificateWA6 certificate is missing "issuer_serial"');if(null==o)throw new Error('parseCertificateWA6 certificate is missing "serial"');if(null==l)throw new Error('parseCertificateWA6 certificate is missing "key"');return{serial:o,issuerSerial:i,key:l,notBefore:d,notAfter:c,details:t,signature:r}}function u(e,t){if(!o.verifySignature(new Uint8Array(t),new Uint8Array(e.details),new Uint8Array(e.signature)))throw new Error("verifyCertificateWA6 certificate is poorly signed!")}},12099:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketModel=void 0,t.open=function(e){let t;try{t=new T(e)}catch(e){return __LOG__(3)`WatchedSocket error constructing: ${e}`,h.default.reject(e)}return new h.default(t,(function(e,t){this.id=(T.numSocketsAttempted++).toString(),__LOG__(2)`WatchedSocket opening socket ${this.id}`;const r=(0,u.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new d.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocket error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocket opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,m.default)().then(this.close.bind(this,!1,"offline")).catch((0,a.catchAbort)((()=>{}))),this._pingTimer.onOrAfter(C()),this.state=_.WATCHED_SOCKET_STATE.OPEN,this}))};var i=n(r(82569)),a=r(89385),o=r(38284),s=r(57319),l=r(85553),c=r(11290),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(72006),p=n(r(84426)),f=n(r(26445)),_=r(62583),h=n(r(59402)),g=r(65127),m=n(r(14706));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}const E=18e4;function S(e,t){let r=-1;const n=e.find((e=>(r++,t(e))));return void 0===n?void 0:{index:r,value:n}}class v extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.session)(),this.url=(0,c.session)(),this.onmessage=(0,c.session)(),this.onactivity=(0,c.session)(),this.timeSkew=(0,c.session)(),this.msgParser=(0,c.session)(),this.state=(0,c.session)(),this.error=(0,c.session)(),this.socket=(0,c.session)(),this.isQueueing=(0,c.session)(!0),this.maxQueueSize=(0,c.session)(),this.messageQueue=(0,c.session)(),this._offlineListener=(0,c.session)(),this._msgListeners=(0,c.session)(),this._pingTimer=(0,c.session)(),this._killTimer=(0,c.session)()}initialize(){this._msgListeners=[],this.messageQueue=[],this.safariSplitter=g.UA.isSafari?new p.default(this):null,this._pingTimer=new s.ShiftTimer((()=>this._ping())),this._killTimer=new s.ShiftTimer((()=>this._killSocket())),l.jsHaltDetector.on(l.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>E&&(__LOG__(2)`js halt longer than ${E} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_ping(){this.send("?,,"),this._killTimer.onOrAfter(A())}_killSocket(){__LOG__(3)`WatchedSocket ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.set({onactivity:void 0,onmessage:void 0})}send(e){this.cast(e),this._pingTimer.cancel(),this._killTimer.onOrAfter(A())}cast(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)throw new d.SocketNotOpen(this.state);if("string"==typeof e&&/\[object ArrayBuffer\]/.test(e))throw new TypeError("converted ArrayBuffer to string prematurely");if(this.safariSplitter)this.safariSplitter.send(e);else try{this.socket.send(e)}catch(e){__LOG__(3,void 0,void 0,!0)`exception sending: ${e}\n${e.stack}`,SEND_LOGS("send-exception"),this.close(!0,e)}}partingSend(e,t,r){const n=this,i=this.socket,a=new Promise((function(a){function o(){a(void 0)}i.onclose=o,i.onerror=o,i.onmessage=function(e){const t=e.data;r&&!r(t)||a(t)},n.send(t),n._onCloseOrError(!1,e)}));return(0,o.promiseTimeout)(a,2e4,"paringSendTimeout").catch((()=>{})).finally((function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()}))}close(e,t){const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocket:exception closing: ${e}\n${e.stack}`}}_onMessage(e){this._pingTimer.onOrAfter(C()),this._killTimer.cancel();const t=e.data;if("string"==typeof t&&"!"===t.charAt(0)){const e=parseInt(t.slice(1),10);return e==e&&(this.timeSkew=Date.now()-e),void(this.onactivity&&this.onactivity())}const r=this.msgParser(e);this.onactivity&&this.onactivity(r),this._onParsedMsg(r)}_onParsedMsg(e){const t=S(this._msgListeners,(function(t){return!t.filter||t.filter(e)}));t?(this._msgListeners.splice(t.index,1),t.value.removed=!0,t.value.promise.force(e)):this.isQueueing?(__LOG__(3)`watchedSocket:enqueued`,this.messageQueue.push(e),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(e):__LOG__(3)`watchedSocket:dropped!`}_onCloseOrError(e,t){if(this.state===_.WATCHED_SOCKET_STATE.CLOSED)return;this.safariSplitter&&this.safariSplitter.cancel(),this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,l.jsHaltDetector.off(l.JS_HALT_EVENT,this._onJsHalt,this),this._pingTimer.cancel(),this._killTimer.cancel(),this.set({state:_.WATCHED_SOCKET_STATE.CLOSED,error:e?t:void 0});const r=this._msgListeners,n=e?new d.SocketError(t):new d.SocketClosed(t);this._msgListeners=[],r.forEach((function(e){e.removed=!0,e.promise.cancel(n)}))}holdMessages(e){const t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")}releaseMessages(e){if(!this.isQueueing)return void __LOG__(3)`WatchedSocket:releaseMessages not queued!`;const t=this.messageQueue;this.set({isQueueing:!1,messageQueue:[]}),e?t.length>0&&__LOG__(3)`WatchedSocket:releaseMessages dropping ${t.length} messages.`:t.forEach((e=>{this._onParsedMsg(e)}))}nextMessage(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)return h.default.reject(new d.SocketNotOpen(this.state)).cancellable();let t;if(t=e instanceof f.default?e.test.bind(e):e,this.isQueueing){let e;if(t){const r=S(this.messageQueue,t);r&&(e=r.value,this.messageQueue.splice(r.index,1))}else this.messageQueue.length>0&&(e=this.messageQueue.shift());if(e)return h.default.resolve(e).cancellable()}const r=(new h.default).cancellable().forceable(),n={removed:!1,filter:t,promise:r};return this._msgListeners.push(n),r.catch((()=>{n.removed||(this._msgListeners=(0,i.default)(this._msgListeners,n))})),r}}const T=(0,c.defineModel)(v);function C(){return 2e4*Math.random()+1e4}function A(){return 7e4*Math.random()+2e4}t.WatchedSocketModel=T,T.numSocketsAttempted=0},14350:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketMD=void 0,t.open=function(e){let t;try{t=new h(e)}catch(e){return __LOG__(3)`WatchedSocketMD error constructing: ${e}`,u.default.reject(e)}return new u.default(t,(function(e,t){h.numSocketsAttempted++,this.id=h.numSocketsAttempted,__LOG__(2)`WatchedSocketMD opening socket ${this.id}`;const r=(0,c.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new s.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocketMD error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocketMD opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,p.default)().then(this.close.bind(this,!1,"offline")).catch((0,i.catchAbort)((()=>{}))),this.state=d.WATCHED_SOCKET_STATE.OPEN,this}))};var i=r(89385),a=r(8584),o=r(57319),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(85553),c=r(72006),d=r(62583),u=n(r(59402)),p=n(r(14706));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}const _=18e4;class h{constructor(e){this.onError=null,this.dataToSend=new a.Binary,this.url=e,this._killTimer=new o.ShiftTimer((()=>this._killSocket())),l.jsHaltDetector.on(l.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>_&&(__LOG__(2)`js halt longer than ${_} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_killSocket(){__LOG__(3)`WatchedSocketMD ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.socket.onmessage=g}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocketMD:exception closing: ${e}\n${e.stack}`}}requestSend(){if(this.state!==d.WATCHED_SOCKET_STATE.OPEN)throw new s.SocketNotOpen(this.state);if(this.dataToSend.size())try{this.socket.send(this.dataToSend.readByteArray())}catch(e){__LOG__(3)`exception sending: ${e}\n${e.stack}`,this.close(!0,e)}}_onMessage(e){if(!(e.data instanceof ArrayBuffer))throw new TypeError("expected ArrayBuffer from the socket");if(this.onData){(0,this.onData)(new Uint8Array(e.data))}}_onCloseOrError(e,t){this.state!==d.WATCHED_SOCKET_STATE.CLOSED&&(this.socket&&(this.socket.onclose=g,this.socket.onerror=g,this.socket.onmessage=g),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,l.jsHaltDetector.off(l.JS_HALT_EVENT,this._onJsHalt,this),this._killTimer.cancel(),this.state=d.WATCHED_SOCKET_STATE.CLOSED,this.error=e?t:void 0,null!=this.onClose&&this.onClose())}}function g(){}t.WatchedSocketMD=h,h.numSocketsAttempted=0},6565:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return{deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}}},t.createDisappearingMode=E,t.createMessageKey=function(e){const t=P(e.to),r={fromMe:!0,id:e.id.id};(0,h.isString)(t)&&(r.remoteJid=t);return r},t.createMsgProtobuf=function(e,t){const r=function(e){const t=e.id,r=e.toJSON();delete r.status,delete r.mimetype,delete r.height,delete r.width,delete r.recipients,delete r.chat,delete r.broadcast,delete r.ack,delete r.invis,delete r.filehash,delete r.recvFresh,delete r.mediaData,g.URL.isHttp(e.clientUrl)||delete r.clientUrl;g.URL.isHttp(e.deprecatedMms3Url)||delete r.deprecatedMms3Url;for(const e in r)null==r[e]&&delete r[e];const n=l.default.get(t.remote);n&&(r.conversionTuple=n.serialize());return r}(e),n={};if(r.quotedMsg){const e=r.quotedMsg.mentionedJidList,t=Array.isArray(e)&&e.length>0?{mentionedJid:e.map(P)}:void 0;n.stanzaId=r.quotedStanzaID,n.remoteJid=P(r.quotedRemoteJid),n.participant=P(r.quotedParticipant),n.quotedMessage=A(r.quotedMsg,{duration:r.quotedMsg.duration,directPath:r.quotedMsg.directPath,encFilehash:r.quotedMsg.encFilehash,filehash:r.quotedMsg.filehash,height:r.quotedMsg.height,mediaKey:r.quotedMsg.mediaKey,mediaKeyTimestamp:(0,h.isNumber)(r.quotedMsg.mediaKeyTimestamp)?r.quotedMsg.mediaKeyTimestamp:void 0,mimetype:r.quotedMsg.mimetype,url:r.quotedMsg.clientUrl||r.quotedMsg.deprecatedMms3Url,width:r.quotedMsg.width},t)}else r.quotedRemoteJid&&r.quotedGroupSubject&&r.quotedParentGroupJid?(n.remoteJid=P(r.quotedRemoteJid),n.groupSubject=r.quotedGroupSubject,n.parentGroupJid=P(r.quotedParentGroupJid)):r.quotedRemoteJid&&(n.remoteJid=P(r.quotedRemoteJid));if(r.mentionedJidList&&r.mentionedJidList.length>0){const e=r.mentionedJidList;n.mentionedJid=e.map(P)}r.conversionTuple&&Object.assign(n,r.conversionTuple);r.isForwarded&&(n.isForwarded=r.isForwarded);r.forwardingScore&&(n.forwardingScore=r.forwardingScore);r.ephemeralDuration&&(n.expiration=r.ephemeralDuration);r.ephemeralSettingTimestamp&&(n.ephemeralSettingTimestamp=r.ephemeralSettingTimestamp);r.disappearingModeInitiator&&(n.disappearingMode=E(r.disappearingModeInitiator));r.ctwaContext&&(n.externalAdReply={sourceUrl:r.ctwaContext.sourceUrl,sourceId:r.ctwaContext.sourceId,sourceType:r.ctwaContext.sourceType,body:r.ctwaContext.description,title:r.ctwaContext.title,thumbnailUrl:r.ctwaContext.thumbnailUrl,thumbnail:r.ctwaContext.thumbnail?M(r.ctwaContext.thumbnail):void 0,mediaType:r.ctwaContext.mediaType,mediaUrl:r.ctwaContext.mediaUrl});return A(r,t,Object.keys(n).length>0?n:void 0)},t.createViewOnceFutureProofMessage=y,t.encodeJid=P,t.populateMessageContextInfo=function(e,t,r){if(!t&&!r)return;e.messageContextInfo={deviceListMetadata:{senderKeyHash:null==t?void 0:t.keyHash,senderTimestamp:null==t?void 0:t.timestamp,senderKeyIndexes:null==t?void 0:t.keyIndexes,recipientKeyHash:null==r?void 0:r.keyHash,recipientTimestamp:null==r?void 0:r.timestamp,recipientKeyIndexes:null==r?void 0:r.keyIndexes},deviceListMetadataVersion:2}};var i=n(r(81109)),a=r(15688),o=r(15461),s=n(r(89867)),l=n(r(35667)),c=r(24606),d=r(24808),u=r(7293),p=r(34535),f=n(r(5165)),_=r(64551),h=r(31515),g=r(2541),m=r(93650);function y(e){return{viewOnceMessage:{message:e}}}function E(e){let t;switch(e){case c.DisappearingModeInitiator.ChangedInChat:t=d.DisappearingModeInitiator.CHANGED_IN_CHAT;break;case c.DisappearingModeInitiator.InitiatedByMe:t=d.DisappearingModeInitiator.INITIATED_BY_ME;break;case c.DisappearingModeInitiator.InitiatedByOther:t=d.DisappearingModeInitiator.INITIATED_BY_OTHER}return{initiator:t}}function S(e,t,r){const{documentMessage:n,imageMessage:i,locationMessage:a,videoMessage:o}=e;if(t.isForwarded&&(n||i||a||o))return e;const s={buttons:!0===t.isForwarded?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:r};return n?(s.documentMessage=n,s.headerType=d.Message$ButtonsMessageHeaderType.DOCUMENT,s.contentText=t.caption):i?(s.imageMessage=i,s.headerType=d.Message$ButtonsMessageHeaderType.IMAGE,s.contentText=t.caption):a?(s.locationMessage=a,s.headerType=d.Message$ButtonsMessageHeaderType.LOCATION,s.contentText=t.caption):o?(s.videoMessage=o,s.headerType=d.Message$ButtonsMessageHeaderType.VIDEO,s.contentText=t.caption):t.title?(s.text=t.title,s.headerType=d.Message$ButtonsMessageHeaderType.TEXT,s.contentText=t.body):(s.contentText=t.body,s.headerType=d.Message$ButtonsMessageHeaderType.EMPTY),{buttonsMessage:s}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i={url:t.url,mimetype:n,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),contextInfo:r,viewOnce:e.isViewOnce};return O(e.type,i),i}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=t.duration;i=(0,h.isString)(i)?parseInt(i,10):i;const a=e.type===o.MSG_TYPE.INTERACTIVE?void 0:e.caption,s={url:t.url,mimetype:n,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,seconds:i,caption:a,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:r,streamingSidecar:e.streamingSidecar,viewOnce:e.isViewOnce};return O(e.type,s),s}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i=e.type===o.MSG_TYPE.INTERACTIVE?void 0:e.caption,a={url:t.url,mimetype:n,title:i,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),fileName:t.filename,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body),contextInfo:r,contactVcard:e.isVcardOverMmsDocument,thumbnailDirectPath:t.thumbnailDirectPath,thumbnailSha256:M(t.thumbnailSha256),thumbnailEncSha256:M(t.thumbnailEncSha256),thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth};return Number.isFinite(e.pageCount)&&!Number.isNaN(e.pageCount)&&(a.pageCount=e.pageCount),O(e.type,a),a}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=n||{};const s=e.mimetype||t.mimetype||void 0;let l=t.duration;switch(e.type){case o.MSG_TYPE.CHAT:"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg||e.ephemeralDuration||e.ephemeralSettingTimestamp||e.ctwaContext?a.extendedTextMessage={text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:M(e.thumbnail),previewType:e.richPreviewType,contextInfo:r,mediaKey:M(e.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(e.mediaKeyTimestamp)?e.mediaKeyTimestamp:void 0,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:M(e.thumbnailSha256),thumbnailEncSha256:M(e.thumbnailEncSha256),thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth}:a.conversation=e.body;break;case o.MSG_TYPE.GROUPS_V4_INVITE:a.groupInviteMessage={inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:M(e.inviteGrpJpegThum)};break;case o.MSG_TYPE.STICKER:if("image/webp"!==t.mimetype)throw __LOG__(3)`invalid sticker mimetype: ${t.mimetype}`,new Error("invalid sticker mimetype");a.stickerMessage={url:t.url,mimetype:t.mimetype,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,firstFrameLength:t.firstFrameLength||void 0,firstFrameSidecar:e.firstFrameSidecar||void 0,isAnimated:t.isAnimated,contextInfo:r},O(e.type,a.stickerMessage);break;case o.MSG_TYPE.LOCATION:const n={degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:M(e.body),contextInfo:r};if(e.loc&&(0,h.isString)(e.loc)){const t=e.loc.split("\n");n.name=t[0],n.address=t[1],n.url=e.clientUrl}a.locationMessage=n;break;case o.MSG_TYPE.VCARD:a.contactMessage={displayName:e.vcardFormattedName,vcard:e.body,contextInfo:r};break;case o.MSG_TYPE.MULTI_VCARD:a.contactsArrayMessage={displayName:e.subtype,contacts:e.vcardList.map((e=>e)),contextInfo:r};break;case o.MSG_TYPE.IMAGE:a.imageMessage=v(e,t,r,s);break;case o.MSG_TYPE.PRODUCT:a.productMessage={product:{productImage:{url:t.url,mimetype:s,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body)},productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,salePriceAmount1000:e.salePriceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount},businessOwnerJid:e.businessOwnerJid,contextInfo:r,body:e.caption,footer:e.footer};break;case o.MSG_TYPE.DOCUMENT:a.documentMessage=C(e,t,r,s);break;case o.MSG_TYPE.PTT:case o.MSG_TYPE.AUDIO:l=(0,h.isString)(l)?parseInt(l,10):l;const c={url:t.url,mimetype:s,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),seconds:l,ptt:"ptt"===e.type,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,contextInfo:r,streamingSidecar:e.streamingSidecar};_.ServerProps.pttWaveformSend&&e.waveform&&((0,m.validateWaveform)(e.waveform)?c.waveform=e.waveform.buffer:(__LOG__(4,void 0,new Error,!0)`Outgoing waveform with invalid size: ${e.waveform.byteLength}`,SEND_LOGS("outgoing-waveform-invalid-size"))),a.audioMessage=c,O(e.type?"ptt":"audio",a.audioMessage);break;case o.MSG_TYPE.VIDEO:a.videoMessage=T(e,t,r,s);break;case o.MSG_TYPE.PROTOCOL:let u;switch(e.subtype){case"admin_revoke":case"sender_revoke":u={key:b(e.protocolMessageKey),type:d.Message$ProtocolMessageType.REVOKE};break;case"ephemeral_setting":u={type:d.Message$ProtocolMessageType.EPHEMERAL_SETTING,ephemeralExpiration:e.ephemeralDuration};break;case"ephemeral_sync_response":u={type:d.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE,ephemeralExpiration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingMode:E(e.disappearingModeInitiator)};break;case"app_state_sync_key_share":u={type:d.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE,appStateSyncKeyShare:e.appStateSyncKeyShare};break;case"app_state_sync_key_request":u={type:d.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST,appStateSyncKeyRequest:e.appStateSyncKeyRequest};break;case"app_state_fatal_exception_notification":u={type:d.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION,appStateFatalExceptionNotification:e.appStateFatalExceptionNotification}}u&&(a.protocolMessage=u);break;case o.MSG_TYPE.INTERACTIVE:let g={};if((e.caption||e.nativeFlowName===f.default.ORDER_STATUS)&&(g={body:{text:e.caption}}),e.interactiveHeader){const n={title:e.interactiveHeader.title,subtitle:e.interactiveHeader.subtitle,hasMediaAttachment:e.interactiveHeader.hasMediaAttachment};if(e.interactiveHeader.thumbnail)n.jpegThumbnail=M(e.interactiveHeader.thumbnail);else if(e.interactiveHeader.mediaType)switch(e.interactiveHeader.mediaType){case p.InteractiveMessageHeaderMediaType.VIDEO:n.videoMessage=T(e,t,r,s);break;case p.InteractiveMessageHeaderMediaType.DOCUMENT:n.documentMessage=C(e,t,r,s);break;case p.InteractiveMessageHeaderMediaType.IMAGE:n.imageMessage=v(e,t,r,s)}g.header=n}e.footer&&(g.footer={text:e.footer});const y=(0,m.getInteractiveMessageFieldNameForType)(e.interactiveType);y&&(g[y]=e.interactivePayload),r&&(g.contextInfo=r),a.interactiveMessage=g;break;case o.MSG_TYPE.PAYMENT:const I={};I.stanzaId=e.quotedStanzaID,I.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(P),I.isForwarded=e.isForwarded,I.forwardingScore=e.forwardingScore,I.participant=P(e.quotedParticipant),e.quotedMsg&&(I.quotedMessage=A(e.quotedMsg));const w=e.paymentNoteMsg?A(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),I):void 0;switch(e.subtype){case"send":const t=e.paymentRequestMessageKey?{fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:P(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:P(e.paymentRequestMessageKey.participant)}:void 0;a.sendPaymentMessage={requestMessageKey:t,noteMessage:w};break;case"request":a.requestPaymentMessage={amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:w}}break;case o.MSG_TYPE.TEMPLATE_BUTTON_REPLY:a.templateButtonReplyMessage={selectedId:e.selectedId,selectedIndex:e.selectedIndex,selectedDisplayText:e.body,contextInfo:r};break;case"template":return"text"===e.subtype?(e.type="chat",e.title&&(e.body="*"+e.title+"*\n"+e.body)):e.type=e.subtype,A(e,t,r,a);case o.MSG_TYPE.LIST:a.listMessage=e.list,a.listMessage.contextInfo=r;break;case o.MSG_TYPE.LIST_RESPONSE:a.listResponseMessage=e.listResponse,a.listResponseMessage.contextInfo=r;break;case o.MSG_TYPE.BUTTONS_RESPONSE:a.buttonsResponseMessage=e.buttonsResponse,a.buttonsResponseMessage.contextInfo=r;break;case o.MSG_TYPE.ORDER:e.itemCount||e.message||e.orderId||e.orderTitle||e.sellerJid||e.status||e.surface||e.thumbnail||e.token||e.totalAmount1000||e.totalCurrencyCode?a.orderMessage={itemCount:e.itemCount,message:e.message,orderId:e.orderId,orderTitle:e.orderTitle,sellerJid:e.sellerJid,status:e.status,surface:e.surface,thumbnail:M(e.thumbnail),token:e.token,totalAmount1000:e.totalAmount1000,totalCurrencyCode:e.totalCurrencyCode}:a.conversation=e.body;break;case o.MSG_TYPE.NATIVE_FLOW:e.headerType===d.Message$ButtonsMessageHeaderType.IMAGE&&(a.imageMessage=v(e,t,void 0,s)),a=S(a,e,r),a.buttonsMessage=(0,i.default)((0,i.default)({},a.buttonsMessage),{},{buttons:e.nativeFlowButtons});break;case o.MSG_TYPE.REACTION:a.reactionMessage={key:b(e.reactionParentKey),text:e.reactionText,senderTimestampMs:e.reactionTimestamp}}return!0===e.isDynamicReplyButtonsMsg&&(a=S(a,e,r)),e.isViewOnce&&(a=y(a)),a}function b(e){const t={fromMe:e.fromMe,id:e.id},r=P(e.remote),n=P(e.participant);return(0,h.isString)(r)&&(t.remoteJid=r),(0,h.isString)(n)&&(t.participant=n),t}function P(e){return e instanceof s.default?e.toString({legacy:!0}):(0,h.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function M(e){return e?(0,a.decodeB64)(e):void 0}function O(e,t){u.GK.supportsFeature(u.GK.F.LOG_OUTGOING_MSG_MISSING_REQUIRED_PROPERTIES)&&(t.viewOnce||(null==t.directPath&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-direct-path`)),null==t.fileSha256&&(__LOG__(2,void 0,void 0,!0)`fileSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-sha`)),null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-enc-sha`)),null==t.url&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-mms3-url`))))}},13493:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTextWithoutSpecialEmojis=Me,t.decodeBytes=ne,t.decodeJid=te,t.decodeUrl=re,t.isValidReactionMessage=be,t.parseAudioMessageProto=q,t.parseButtons=oe,t.parseButtonsMessageProto=Te,t.parseButtonsResponseMessageProto=Ee,t.parseCancelPaymentRequestMessageProto=fe,t.parseContactMessageProto=W,t.parseContactsArrayMessageProto=H,t.parseContextInfoProto=Q,t.parseConversationProto=K,t.parseCtwaContextProto=X,t.parseDeclinePaymentRequestMessageProto=pe,t.parseDeviceSentMessage=ie,t.parseDisappearingModeProto=Ce,t.parseDocumentMessageProto=z,t.parseEphemeralFutureProofMessageProto=ve,t.parseExtendedTextMessageProto=$,t.parseGroupInviteMessageProto=he,t.parseImageMessageProto=j,t.parseInteractiveMessageProto=Ae,t.parseListMessageProto=me,t.parseListResponseMessageProto=ye,t.parseLiveLocationMessageProto=ce,t.parseLocationMessageProto=V,t.parseMsgProto=B,t.parseOrderMessageProto=ge,t.parsePaymentInviteMessageProto=_e,t.parseProductMessageProto=le,t.parseProtocolMessageProto=ee,t.parseReactionMessageProto=Pe,t.parseRequestPaymentMessageProto=ue,t.parseSendPaymentMessageProto=de,t.parseStickerMessageProto=Y,t.parseTemplateButtonReplyMessage=se,t.parseTemplateMessage=ae,t.parseVideoMessageProto=J,t.parseViewOnceFutureProofMessageProto=Se,t.validateRequiredMediaProperties=Oe;var i=n(r(81109)),a=n(r(88306)),o=r(15688),s=n(r(78403)),l=n(r(45095)),c=r(35470),d=n(r(64369)),u=r(72441),p=n(r(65212)),f=r(15461),_=n(r(89867)),h=r(45454),g=r(99140),m=r(22683),y=r(17239),E=r(24606),S=r(24808),v=r(70449),T=r(6303),C=r(99234),A=r(7293),b=r(57701),P=r(41796),M=r(34535),O=n(r(84064)),I=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=F(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(86688)),w=r(26287),R=n(r(5165)),D=r(90837),N=r(64551),L=r(31515),k=r(2541),G=r(93650),U=r(21224);function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(F=function(e){return e?r:t})(e)}const x=(0,a.default)((function(e){if((0,P.isConnectedToPage)())return k.URL.hostname(e);if(!e)return"";const t=k.URL.isHttp(e)?e:"http://"+e;return new self.URL(t).hostname}));function B(e,t,r,n,i,a,o,s){if(!e)return __LOG__(4,void 0,new Error,!0)`drop: not Message`,SEND_LOGS("null-message"),t;const{conversation:c,imageMessage:d,contactMessage:u,locationMessage:p,liveLocationMessage:_,extendedTextMessage:h,documentMessage:g,audioMessage:m,videoMessage:y,stickerMessage:E,contactsArrayMessage:S,sendPaymentMessage:v,requestPaymentMessage:T,productMessage:C,groupInviteMessage:b,viewOnceMessage:P,ephemeralMessage:M,orderMessage:O,listMessage:I,listResponseMessage:w,protocolMessage:R,declinePaymentRequestMessage:D,cancelPaymentRequestMessage:k,paymentInviteMessage:G,templateMessage:U,templateButtonReplyMessage:F,buttonsResponseMessage:x,buttonsMessage:B,interactiveMessage:Z,reactionMessage:te}=e;let re;var ne,oe,Ce,be;((0,L.isString)(c)&&K(t,c),b&&he(t,b),d&&(j(t,d),re=d.contextInfo),E&&(Y(t,E),re=E.contextInfo),u&&(W(t,u),re=u.contextInfo),S&&(H(t,S),re=S.contextInfo),p&&(V(t,p),re=p.contextInfo),_&&(ce(t,_,i),re=_.contextInfo),v)&&(re=null===(ne=v.noteMessage)||void 0===ne||null===(oe=ne.extendedTextMessage)||void 0===oe?void 0:oe.contextInfo,de(t,v,n));T&&(re=null===(Ce=T.noteMessage)||void 0===Ce||null===(be=Ce.extendedTextMessage)||void 0===be?void 0:be.contextInfo,ue(t,T,n));if(D&&pe(t,D),k&&fe(t,k),G&&_e(t,G),h&&($(t,h),re=h.contextInfo),g&&(z(t,g),re=g.contextInfo),m&&(q(t,m),re=m.contextInfo),y&&(J(t,y),re=y.contextInfo),R&&ee(t,R,r,s),C&&(le(t,C),re=C.contextInfo),O&&(ge(t,O),re=O.contextInfo),I&&(me(t,I),re=I.contextInfo),w&&(ye(t,w),re=w.contextInfo),P&&Se(t,P),M&&ve(t,M),B&&Te(t,B,o),x&&(Ee(t,x),re=x.contextInfo),Z&&(Ae(t,Z,o),re=Z.contextInfo),te&&Pe(t,te),A.GK.supportsFeature(A.GK.F.MD_BACKEND)){const{deviceSentMessage:n,highlyStructuredMessage:i}=e;var Oe;if(n&&ie(t,n,r),i)t.type=f.MSG_TYPE.HSM,(null===(Oe=i.hydratedHsm)||void 0===Oe?void 0:Oe.hydratedTemplate)&&(t.body=Me(i.hydratedHsm.hydratedTemplate.hydratedContentText))}return U&&(A.GK.supportsFeature(A.GK.F.MD_BACKEND)&&U.hydratedTemplate?ae(t,U.hydratedTemplate):ae(t,(0,l.default)(U.hydratedFourRowTemplate,"templateMessage.hydratedFourRowTemplate"))),F&&(se(t,F),re=F.contextInfo,t.type=f.MSG_TYPE.TEMPLATE_BUTTON_REPLY),re&&(Q(t,re,a),re.externalAdReply&&N.ServerProps.ctwaContextRender&&X(t,re.externalAdReply)),t}function K(e,t){e.type=f.MSG_TYPE.CHAT,e.body=Me(t)}function j(e,t){e.type=f.MSG_TYPE.IMAGE,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath||"",e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype||"",e.caption=Me(t.caption),e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.body=ne(t.jpegThumbnail)||"",e.interactiveAnnotations=t.interactiveAnnotations,e.scanLengths=t.scanLengths,e.scansSidecar=t.scansSidecar,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),Oe(e,t)}function Y(e,t){e.type=f.MSG_TYPE.STICKER,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.mediaKey=(0,s.default)(ne(t.mediaKey)),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.height=t.height||0,e.width=t.width||0,e.firstFrameLength=t.firstFrameLength,e.firstFrameSidecar=t.firstFrameSidecar,e.isAnimated=t.isAnimated,Oe(e,t)}function W(e,t){e.type=f.MSG_TYPE.VCARD,e.vcardFormattedName=t.displayName,e.body=t.vcard}function H(e,t){const r=t.contacts;e.type=f.MSG_TYPE.MULTI_VCARD,e.vcardFormattedName=t.displayName,e.vcardList=Array.isArray(r)?r.map((e=>({displayName:e.displayName,vcard:e.vcard}))):[]}function V(e,t){const r=t.name&&t.address?`${t.name}\n${t.address}`:t.name||t.address||"";e.type=f.MSG_TYPE.LOCATION,e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=r,e.body=ne(t.jpegThumbnail)||"",e.clientUrl=t.url}function $(e,t){const r=t.matchedText||t.canonicalUrl||t.description||t.title;if(r){const r=x(t.canonicalUrl||""),n=x(t.matchedText||"");e.canonicalUrl=r===n||""===r?t.canonicalUrl:n}e.type=f.MSG_TYPE.CHAT,e.subtype=r?"url":void 0,e.body=Me(t.text||""),e.matchedText=t.matchedText,e.description=t.description,e.title=t.title,e.thumbnail=ne(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.doNotPlayInline=t.doNotPlayInline,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=t.mediaKeyTimestamp,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth;const n=S.Message$ExtendedTextMessageFontType;if(null!=t.font)switch(t.font){case n.SANS_SERIF:case n.SERIF:case n.NORICAN_REGULAR:case n.BRYNDAN_WRITE:case n.BEBASNEUE_REGULAR:case n.OSWALD_HEAVY:e.font=t.font}}function z(e,t){e.type=f.MSG_TYPE.DOCUMENT,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.filename=(0,g.cleanIncomingFilename)(t.fileName||t.title),e.caption=e.filename,e.body=ne(t.jpegThumbnail)||"",e.isVcardOverMmsDocument=Boolean(t.contactVcard)&&e.size<=1024*N.ServerProps.vcardMaxSizeKb,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth,Oe(e,t)}function q(e,t){e.type=t.ptt?f.MSG_TYPE.PTT:f.MSG_TYPE.AUDIO,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.duration=`${t.seconds||0}`,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.streamingSidecar=t.streamingSidecar,e.waveform=t.waveform&&(0,G.validateWaveform)(t.waveform)?new Uint8Array(t.waveform):void 0,Oe(e,t)}function J(e,t){e.type=f.MSG_TYPE.VIDEO,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=`${t.seconds||0}`,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.caption=Me(t.caption),e.body=ne(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar,e.interactiveAnnotations=t.interactiveAnnotations,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),Oe(e,t)}function Q(e,t,r){const n=t.quotedMessage,i=t.mentionedJid;e.quotedMsg=n&&B(n,{type:f.MSG_TYPE.UNKNOWN}),e.quotedMsg&&"payment"===e.quotedMsg.type&&r&&__LOG__(2)`parseContextInfoProto: payment not supported`,e.quotedStanzaID=t.stanzaId,e.quotedParticipant=te(t.participant),e.quotedRemoteJid=te(t.remoteJid),e.quotedGroupSubject=te(t.groupSubject),e.quotedParentGroupJid=te(t.parentGroupJid),e.mentionedJidList=Array.isArray(i)?i.map(te):i,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore,null!=t.expiration&&(e.ephemeralDuration=t.expiration),null!=t.ephemeralSettingTimestamp&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),null!=t.ephemeralSharedSecret&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret),null!=t.disappearingMode&&Ce(e,t.disappearingMode),null!=t.actionLink&&(e.actionLink=t.actionLink)}function X(e,t){const r=I.findLink(t.sourceUrl||"",!1,e.from);e.ctwaContext={sourceUrl:t.sourceUrl,description:t.body,title:t.title,thumbnail:t.thumbnail?ne(t.thumbnail):null,thumbnailUrl:t.thumbnailUrl,mediaType:t.mediaType,mediaUrl:t.mediaUrl,isSuspiciousLink:(null==r?void 0:r.suspiciousCharacters)&&r.suspiciousCharacters.size>0}}function Z(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for protocol message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for protocol message");let n=null;return n=A.GK.supportsFeature(A.GK.F.MD_BACKEND)?function(e,t,r){var n;let i,a,o;if(null==r||null===(n=r.id)||void 0===n?void 0:n.fromMe)i=!!t.fromMe,o=te(t.remoteJid),t.fromMe?o.isUser()||(a=(0,C.getMeUser)()):a=te(t.participant);else if(o=r.id.remote,t.fromMe)i=!1,a=r.author;else{const e=te(t.participant);e?e.equals((0,C.getMeUser)())?(i=!0,o.isUser()||(a=(0,C.getMeUser)())):(i=!1,o.isUser()||(a=e)):i=!0}null!=o&&(o instanceof _.default&&o.isBroadcast()&&!o.isStatusV3()||"broadcast"===(0,u.interpretAndValidateJid)(o.toString()).jidType)&&(o=te(t.participant),a=void 0);return new p.default({id:e,fromMe:i,remote:o,participant:a})}(r,e,t):new p.default({id:r,fromMe:!!e.fromMe,remote:te(e.remoteJid),participant:te(e.participant)}),n}function ee(e,t,r,n){if("relay"!==r&&t.type!==S.Message$ProtocolMessageType.EPHEMERAL_SETTING)return;const{key:i,type:a}=t;let o=null;if(e.type=f.MSG_TYPE.PROTOCOL,null!=a)switch(a){case S.Message$ProtocolMessageType.REVOKE:o=Z(i,e),e.protocolMessageKey=o,e.subtype=n===c.EDIT_ATTR.ADMIN_REVOKE?"admin_revoke":"sender_revoke";break;case S.Message$ProtocolMessageType.EPHEMERAL_SETTING:e.subtype="ephemeral_setting",e.ephemeralDuration=t.ephemeralExpiration;break;case S.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE:e.subtype="ephemeral_sync_response",e.ephemeralDuration=t.ephemeralExpiration,e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp,null!=t.disappearingMode&&Ce(e,t.disappearingMode);break;case S.Message$ProtocolMessageType.HISTORY_SYNC_NOTIFICATION:e.subtype="history_sync_notification";const{historySyncNotification:r}=t;if(r){const n={directPath:r.directPath,encFilehash:ne(r.fileEncSha256),filehash:ne(r.fileSha256),mediaKey:ne(r.mediaKey),type:"md-msg-hist"};e.historySyncMetaData={historySyncNotification:t.historySyncNotification,downloadOptions:n}}break;case S.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST:case S.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE:case S.Message$ProtocolMessageType.MSG_FANOUT_BACKFILL_REQUEST:case S.Message$ProtocolMessageType.INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:case S.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION:e.subtype="unknown"}}function te(e){return e&&_.default.isWid(e)?(0,h.createWid)(e):e}function re(e){return e&&!e.includes("/u/")?e:void 0}function ne(e){return e?(0,o.encodeB64)(e):void 0}function ie(e,t,r){const n=te(t.destinationJid);e.id.remote=n,e.to=n,B(t.message,e,r)}function ae(e,t){const{documentMessage:r,imageMessage:n,locationMessage:i,videoMessage:a}=t;e.isFromTemplate=!0,r?z(e,r):n?j(e,n):i?V(e,i):a?J(e,a):(e.type=f.MSG_TYPE.CHAT,t.hydratedContentText&&(e.body=Me(t.hydratedContentText))),t.hydratedButtons&&oe(e,t),t.hydratedContentText&&(e.caption=Me(t.hydratedContentText)),t.hydratedFooterText&&(e.footer=Me(t.hydratedFooterText)),t.hydratedTitleText&&(e.title=Me(t.hydratedTitleText))}function oe(e,t){const{hydratedButtons:r}=t;r.length&&(e.hydratedButtons=r)}function se(e,t){e.body=Me(t.selectedDisplayText),e.selectedIndex=t.selectedIndex,e.selectedId=t.selectedId}function le(e,t){const{product:r,body:n,footer:i}=t;r&&(r.productImage&&j(e,r.productImage),e.type=f.MSG_TYPE.PRODUCT,e.businessOwnerJid=t.businessOwnerJid,e.productId=r.productId,e.currencyCode=r.currencyCode,e.priceAmount1000=r.priceAmount1000,e.salePriceAmount1000=r.salePriceAmount1000,e.retailerId=r.retailerId,e.url=r.url,e.productImageCount=r.productImageCount,e.title=r.title,e.description=r.description,e.caption=n,e.footer=i)}function ce(e,t,r){e.type="location",e.isLive=!0,e.lat=t.degreesLatitude,e.lng=t.degreesLongitude,e.body=ne(t.jpegThumbnail)||"",e.accuracy=t.accuracyInMeters,e.speed=t.speedInMps,e.degrees=t.degreesClockwiseFromMagneticNorth,e.comment=Me(t.caption),e.sequence=t.sequenceNumber,r&&(e.finalLat=r.degreesLatitude,e.finalLng=r.degreesLongitude,e.finalThumbnail=ne(r.jpegThumbnail)||"",e.finalAccuracy=r.accuracyInMeters,e.finalSpeed=r.speedInMps,e.finalDegrees=r.degreesClockwiseFromMagneticNorth,e.finalTimeOffset=r.timeOffset)}function de(e,t,r){if((null==r?void 0:r.futureproofed)||(0,G.hasUnsupportedCurrency)(r))e.type="unknown",e.subtype="phone_only_feature",__LOG__(2)`parseSendPaymentMessageProto: does not support novi transactions`;else{var n,i,a;e.type=f.MSG_TYPE.PAYMENT,e.subtype="send",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=B(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",(0,G.parseMsgPaymentInfo)(e,r);const o=t.requestMessageKey;o&&(e.paymentRequestMessageKey=function(e,t){if(!e)throw new Error("_getPaymentRequestMessageKey: no message key is defined");const{id:r}=e;if(!r)throw new Error("_getPaymentRequestMessageKey: no key id is defined");if(!t.id)return __LOG__(3)`_getPaymentRequestMessageKey: no message id is defined`,null;let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)()))&&"send"!==t.subtype)return null;n=te(e.participant)}return new p.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(o,e))}}function ue(e,t,r){if((null==r?void 0:r.futureproofed)||(0,G.hasUnsupportedCurrency)(r))e.subtype="phone_only_feature",__LOG__(2)`parseRequestPaymentMessageProto: does not support novi transactions`;else{var n,i,a;if(e.type=f.MSG_TYPE.PAYMENT,(0,G.parseMsgPaymentInfo)(e,r),e.subtype="request",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=B(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",null!=t.amount){if(t.amount.currencyCode&&!e.paymentCurrency&&(e.paymentCurrency=t.amount.currencyCode),null!=t.amount.value&&!e.paymentAmount1000){const r=t.amount,n=null==r.offset||0===r.offset?1e3:r.offset;e.paymentAmount1000=1e3*parseFloat(r.value)/n}}else t.currencyCodeIso4217&&!e.paymentCurrency&&(e.paymentCurrency=t.currencyCodeIso4217),null==t.amount1000||e.paymentAmount1000||(e.paymentAmount1000=t.amount1000);t.requestFrom&&!e.paymentMessageReceiverJid&&(e.paymentMessageReceiverJid=te(t.requestFrom)),e.paymentStatus&&e.paymentTxnStatus||(0,G.isEitherSenderOrReceiverOfPaymentMessage)(e)&&(e.paymentStatus=U.PaymentInfoStatus.WAITING,e.paymentTxnStatus=U.PaymentInfoTxnStatus.COLLECT_INIT),null==t.expiryTimestamp||e.paymentExpiryTimestamp||(e.paymentExpiryTimestamp=t.expiryTimestamp)}}function pe(e,t){const r=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for decline payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for decline payment request message");let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)()))&&"send"!==t.subtype)return null;n=te(e.participant)}return new p.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(t.key,e);e.paymentRequestMessageKey=r,e.subtype="payment_action_request_declined"}function fe(e,t){const r=t.key;if(r){const t=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for cancel payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for cancel payment request message");let n;var i;if(t.id.remote.isGroup())if(n=t.id.participant,t.id.fromMe)n=te(t.from);else if(!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)())))return null;return new p.default({id:r,fromMe:t.id.fromMe,remote:t.id.remote,participant:n})}(r,e);e.paymentRequestMessageKey=t,e.subtype="payment_transaction_request_cancelled"}}function _e(e,t){t.serviceType===S.Message$PaymentInviteMessageServiceType.NOVI?(e.subtype="phone_only_feature",__LOG__(2)`[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions`):(e.type=f.MSG_TYPE.PAYMENT,e.subtype="invite",e.paymentExpiryTimestamp=t.expiryTimestamp,e.paymentInviteServiceType=t.serviceType,__LOG__(2)`[payment-invite] render payment invite of type ${t.serviceType}`)}function he(e,t){e.comment=t.caption,e.inviteCode=t.inviteCode,e.inviteCodeExp=t.inviteExpiration,e.inviteGrp=t.groupJid,e.inviteGrpName=t.groupName,e.type=f.MSG_TYPE.GROUPS_V4_INVITE}function ge(e,t){e.type=f.MSG_TYPE.ORDER,e.thumbnail=ne(t.thumbnail),e.message=t.message||"",e.orderId=t.orderId,e.itemCount=t.itemCount||0,e.status=t.status,e.surface=t.surface,e.sellerJid=t.sellerJid,e.orderTitle=t.orderTitle||"",e.token=t.token||"",e.totalAmount1000=t.totalAmount1000,e.totalCurrencyCode=t.totalCurrencyCode,e.body=""}function me(e,t){var r,n;N.ServerProps.webListMessage&&t.listType===S.Message$ListMessageListType.SINGLE_SELECT||(0,b.productListMessagesEnabled)()&&t.listType===S.Message$ListMessageListType.PRODUCT_LIST?(e.type=f.MSG_TYPE.LIST,e.list=t,e.footer=t.footerText,t.listType===S.Message$ListMessageListType.PRODUCT_LIST&&(e.businessOwnerJid=null===(r=t.productListInfo)||void 0===r?void 0:r.businessOwnerJid,e.productListItemCount=null===(n=t.productListInfo)||void 0===n?void 0:n.productSections.reduce(((e,t)=>e+t.products.length),0))):(t.listType===S.Message$ListMessageListType.PRODUCT_LIST&&(0,b.productListMessageFallbackEnabled)()&&(e.subtype="phone_only_feature"),e.type=f.MSG_TYPE.UNKNOWN)}function ye(e,t){if(N.ServerProps.webListMessage&&t.listType===S.Message$ListResponseMessageListType.SINGLE_SELECT){e.type=f.MSG_TYPE.LIST_RESPONSE,e.listResponse=(0,i.default)((0,i.default)({},t),{},{contextInfo:void 0});let r=t.title||"";t.description&&(r+="\n"+t.description),e.body=Me(r)}}function Ee(e,t){let{selectedDisplayText:r,selectedButtonId:n,type:i}=t;(0,b.buttonsMessagesEnabled)()&&i===S.Message$ButtonsResponseMessageType.DISPLAY_TEXT?(e.type=f.MSG_TYPE.BUTTONS_RESPONSE,e.selectedButtonId=n,e.body=Me(r)):e.type=f.MSG_TYPE.UNKNOWN}function Se(e,t){N.ServerProps.viewOnceRead?B(t.message,e):(e.type=f.MSG_TYPE.UNKNOWN,e.subtype="phone")}function ve(e,t){B(t.message,e)}function Te(e,t,r){if(!(0,b.buttonsMessagesEnabled)())return void(e.type=f.MSG_TYPE.UNKNOWN);const{documentMessage:n,imageMessage:a,locationMessage:o,videoMessage:s,contentText:l,footerText:c,text:d,buttons:u=[],headerType:p}=t,_=R.default.cast((0,G.getBizNativeFlowName)({buttonsMessage:t}));if(!(0,G.shouldParseNFM)(_,r)||(0,G.hasUnsupportedButtons)(u))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(p!==S.Message$ButtonsMessageHeaderType.UNKNOWN&&new Set(S.Message$ButtonsMessageHeaderType.members()).has(p)){if(e.type=f.MSG_TYPE.CHAT,e.headerType=p,a?j(e,a):n?z(e,n):o?V(e,(0,i.default)((0,i.default)({},o),{},{name:void 0,address:void 0})):s?J(e,s):(d&&(e.title=Me(d)),l&&(e.body=Me(l))),null==_)u.length&&(e.isDynamicReplyButtonsMsg=!0,e.dynamicReplyButtons=u);else{var h;if(e.type=f.MSG_TYPE.NATIVE_FLOW,e.nativeFlowName=R.default.cast(_),e.nativeFlowButtons=u,!e.nativeFlowName||!(0,w.isValidNativeFlowMessage)(e))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(e.nativeFlowName===R.default.ORDER_STATUS&&!(0,D.validateOrderAndSendReceipt)(null===(h=e.id)||void 0===h?void 0:h.remote,e))return void(e.subtype="non_renderable")}l&&(e.caption=Me(l)),c&&(e.footer=Me(c))}else e.type=f.MSG_TYPE.UNKNOWN}function Ce(e,t){if(null==e.from)return;const r=e.from.equals((0,C.getMeUser)());if(null!=t.initiator)switch(t.initiator){case S.DisappearingModeInitiator.CHANGED_IN_CHAT:e.disappearingModeInitiator=E.DisappearingModeInitiator.ChangedInChat;break;case S.DisappearingModeInitiator.INITIATED_BY_ME:e.disappearingModeInitiator=r?E.DisappearingModeInitiator.InitiatedByMe:E.DisappearingModeInitiator.InitiatedByOther;break;case S.DisappearingModeInitiator.INITIATED_BY_OTHER:e.disappearingModeInitiator=r?E.DisappearingModeInitiator.InitiatedByOther:E.DisappearingModeInitiator.InitiatedByMe}}function Ae(e,t,r){var n;const i=(0,G.getInteractiveMessageTypeForProto)(t);if(!i||!(0,G.isInteractiveMessageTypeEnabled)(i))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");const{body:a,footer:o}=t,s=(0,G.getInteractiveMessageFieldNameForType)(i),l={type:f.MSG_TYPE.INTERACTIVE,caption:null!==(n=Me(null==a?void 0:a.text))&&void 0!==n?n:"",interactiveType:i,interactivePayload:t[s]};if(!(0,G.isSupportedInteractiveMessageVersion)(l))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(i===O.default.NATIVE_FLOW){var c;if(l.nativeFlowName=R.default.cast((0,G.getBizNativeFlowName)({interactiveMessage:t})),!(0,G.isValidNativeFlowName)(l.nativeFlowName,r)||!(0,w.isValidNativeFlowMessage)(l))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(l.nativeFlowName===R.default.ORDER_STATUS&&!(0,D.validateOrderAndSendReceipt)(null===(c=e.id)||void 0===c?void 0:c.remote,l))return void(e.subtype="non_renderable")}o&&(l.footer=Me(o.text)),function(e,t){let{header:r}=t;if(!r)return;const n={title:Me(r.title),subtitle:Me(r.subtitle),thumbnail:ne(r.jpegThumbnail),mediaType:void 0,hasMediaAttachment:Boolean(r.hasMediaAttachment)};n.hasMediaAttachment&&(r.documentMessage?(z(e,r.documentMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.DOCUMENT):r.videoMessage?(J(e,r.videoMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.VIDEO):r.imageMessage&&(j(e,r.imageMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.IMAGE)),e.interactiveHeader=n}(e,t),Object.assign(e,l)}function be(e){const t=e.text;return null==t||t.length<=d.default.REACTION_CONTENT_MAX_LENGTH}function Pe(e,t){if(!(0,b.receiveReactionsEnabled)())return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="reaction");if(!be(t))throw new T.ReactionValidationError("[messaging] Reaction failed validation");const r=Me(t.text);e.type=f.MSG_TYPE.REACTION,e.reactionParentKey=Z(t.key,e),e.reactionText=r,e.reactionTimestamp=t.senderTimestampMs}function Me(e){return e?y.Conn.platform===y.PLATFORMS.ANDROID?e:v.EmojiUtil.convertToTextWithoutSpecialEmojis(e):e}function Oe(e,t){var r;if(!A.GK.supportsFeature(A.GK.F.LOG_INCOMING_MSG_MISSING_REQUIRED_PROPERTIES))return;if(Math.random()>.001)return;if(!e.id)return;if("status"===(null===(r=e.id.remote)||void 0===r?void 0:r.user)&&_.default.isPSA(e.author)&&!t.staticUrl)return;if(e.id.fromMe)return;const n=e.type;null==t.directPath&&null==t.fileEncSha256?(__LOG__(2,void 0,void 0,!0)`directPath and fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path-and-file-enc`)):null==t.directPath?(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path`)):null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-file-enc`)),null==t.url&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-mms3-url`)),null==t.mediaKey&&(__LOG__(2,void 0,void 0,!0)`mediaKey is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-media-key`))}},93650:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBizNativeFlowName=function(e){var t,r,n,i,a,o;if(1===(null===(t=e.interactiveMessage)||void 0===t||null===(r=t.nativeFlowMessage)||void 0===r||null===(n=r.buttons)||void 0===n?void 0:n.length))return(0,f.getNativeFlowNameByButtonName)(e.interactiveMessage.nativeFlowMessage.buttons[0].name);if(1===(null===(i=e.buttonsMessage)||void 0===i||null===(a=i.buttons)||void 0===a?void 0:a.length))return(0,f.getNativeFlowNameByButtonName)(null===(o=e.buttonsMessage.buttons[0].nativeFlowInfo)||void 0===o?void 0:o.name)},t.getInteractiveMessageFieldNameForType=m,t.getInteractiveMessageTypeForProto=function(e){for(const t of p.default.members())if(m(t)in e)return t;return null},t.hasUnsupportedButtons=function(e){return e.some((e=>e.nativeFlowInfo&&g.includes(e.nativeFlowInfo.name)||g.includes(e.buttonId)))},t.hasUnsupportedCurrency=function(e){var t;const r=(null==e||null===(t=e.primaryAmount)||void 0===t?void 0:t.currencyCode)||(null==e?void 0:e.currency);if(["XUS","XDX","USDP"].includes(null==r?void 0:r.toUpperCase()))return!0;return!1},t.isEitherSenderOrReceiverOfPaymentMessage=function(e){var t,r;if((null===(t=e.id)||void 0===t?void 0:t.remote.isGroup())&&!(null===(r=e.id)||void 0===r?void 0:r.participant.equals((0,c.getMeUser)()))&&!e.paymentMessageReceiverJid.equals((0,c.getMeUser)()))return!1;return!0},t.isInteractiveMessageTypeEnabled=function(e){switch(e){case p.default.NATIVE_FLOW:return(0,d.interactiveNativeFlowMessagesEnabled)();case p.default.SHOPS_STOREFRONT:return(0,d.shopsInteractiveMessageEnabled)()}},t.isSupportedInteractiveMessageVersion=function(e){let{interactivePayload:t,interactiveType:r}=e;const n=null==t?void 0:t.messageVersion;if(null==n||null==r)return!1;switch(r){case p.default.NATIVE_FLOW:case p.default.SHOPS_STOREFRONT:return n<=1}},t.isValidNativeFlowName=h,t.msgKeyToProtobuf=function(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||null===(t=e.participant)||void 0===t?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}},t.parseMsgPaymentInfo=function(e,t){t&&(e.paymentStatus=t.status,e.paymentTxnStatus=t.txnStatus,e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.amount1000),"maybeNumberOrThrowIfTooLarge(paymentInfo.amount1000)"),e.paymentMessageReceiverJid=(0,s.createWid)((0,a.default)(t.receiverJid,"paymentInfo.receiverJid")),e.paymentExpiryTimestamp=(0,i.maybeNumberOrThrowIfTooLarge)(t.expiryTimestamp),e.paymentTransactionTimestamp=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.transactionTimestamp),"maybeNumberOrThrowIfTooLarge(paymentInfo.transactionTimestamp)"))},t.protobufToMsgKey=function(e){const{fromMe:t,id:r,participant:n,remoteJid:i}=e;(0,l.default)(null!=t&&null!=i&&null!=r,"fromMe, remoteJid, and id should be set");let a=null!=n&&(0,s.isWidlike)(n)?(0,s.createWid)(n):void 0;const d=(0,s.createWid)(i);(d.isGroup()||d.isBroadcast())&&t&&(a=(0,c.getMaybeMeUser)());return new o.default({fromMe:t,id:r,participant:a,remote:(0,s.createWid)(i)})},t.shouldParseNFM=function(e,t){if(null!=e||null!=(null==t?void 0:t.nativeFlowName))return!!(0,d.nativeFlowMessagesEnabled)()&&h(e,t);return!0},t.typeAttributeFromProtobuf=function e(t){if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):u.MSG_TYPES.text}if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):u.MSG_TYPES.text}if(t.reactionMessage)return u.MSG_TYPES.reaction;if(t.conversation||t.extendedTextMessage||t.templateButtonReplyMessage||t.protocolMessage||t.interactiveMessage)return u.MSG_TYPES.text;return u.MSG_TYPES.media},t.validateWaveform=function(e){return e.byteLength>=64&&e.byteLength<=192};var i=r(8243),a=n(r(45095)),o=n(r(65212)),s=r(45454),l=n(r(41143)),c=r(99234),d=r(57701),u=r(12037),p=n(r(84064)),f=r(26287),_=n(r(5165));function h(e,t){return null==e&&null==(null==t?void 0:t.nativeFlowName)||null==(null==t?void 0:t.nativeFlowName)||null!=e&&_.default.cast(t.nativeFlowName)===e}const g=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function m(e){switch(e){case p.default.NATIVE_FLOW:return"nativeFlowMessage";case p.default.SHOPS_STOREFRONT:return"shopStorefrontMessage"}}},55878:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptGroupSignalProto=function(){return p.apply(this,arguments)},t.decryptSignalProto=function(){return d.apply(this,arguments)},t.encryptSenderKeyMsgSignalProto=function(){return f.apply(this,arguments)},t.encryptSignalProto=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(8001),o=r(99234),s=r(45033),l=r(52083),c=r(93832);function d(){return(d=(0,i.default)((function*(e,t,r){const n=new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e));try{const e=yield Promise.resolve(n);let i;switch(t){case s.CiphertextType.Pkmsg:i=yield e.decryptPreKeyWhisperMessage(r);break;case s.CiphertextType.Msg:i=yield e.decryptWhisperMessage(r);break;default:return Promise.reject(new Error(`decryptSignalProto: Received unsupported msg type ${t}`))}return i}catch(e){if(e&&"call_failure"===e.reason&&e.value&&"number"==typeof e.value.result)__LOG__(3)`decryptSignalProto error code ${e.value.result}`;else{if(e&&"MessageCounterError"===e.name)return Promise.reject(new a.SignalMessageCounterError(e));__LOG__(3)`decryptSignalProto js error ${e}`}return Promise.reject(new a.SignalDecryptionError(e))}}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const r=yield new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e)),{type:n,body:i}=yield r.encrypt(t);return __LOG__(2)`encryptSignalProto complete, type=${n}`,{type:3===n?s.CiphertextType.Pkmsg:s.CiphertextType.Msg,ciphertext:(0,c.strToBuffer)(i)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,r){try{const n=yield new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)(t));return yield n.decryptSenderKeyMessage(r)}catch(e){if(e&&"MessageCounterError"===e.name)throw new a.SignalMessageCounterError(e);throw new a.SignalDecryptionError(e)}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const r=new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)((0,o.assertGetMe)())),n=yield Promise.resolve(r).then((e=>e.encrypt(t)));return{ciphertext:(0,c.strToBuffer)(n)}}))).apply(this,arguments)}},8001:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalMessageCounterError=t.SignalDecryptionError=void 0;var n=r(40265);class i extends((0,n.customError)("SignalDecryptionError")){}t.SignalDecryptionError=i;class a extends((0,n.customError)("SignalMessageCounterError")){}t.SignalMessageCounterError=a},11849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waSignalStore=void 0;var n=r(88102),i=r(318),a=r(77246);const o="signal_reg_id",s="signal_static_pubkey",l="signal_static_privkey",c="signal_next_pk_id",d="signal_last_spk_id",u="signal_first_unupload_pk_id",p="signal_sever_has_pre_keys",f="adv_signed_identity",_={name:"AES-CTR",length:128,counter:new Uint8Array(16)};function h(e){return self.crypto.subtle.generateKey({name:_.name,length:_.length},!1,["encrypt","decrypt"]).then((t=>self.crypto.subtle.encrypt(_,t,e).then((e=>({encKey:t,value:e})))))}function g(e){return self.crypto.subtle.decrypt(_,e.encKey,e.value)}const m=new class{constructor(){this.idToSignedPreKey=new Map,n.Cmd.on("logout",(()=>{this.registrationInfo=void 0,this.idToSignedPreKey.clear()}))}getMeta(e){return(0,i.getMetaTable)().get(e).then((e=>e?e.value:null))}putMeta(e){const t=(0,i.getMetaTable)(),r=e.map((e=>t.createOrReplace(e)));return Promise.all(r).then()}setServerHasPreKeys(e){this.putMeta([{key:p,value:e}])}getServerHasPreKeys(){return this.getMeta(p)}putADVSignedIdentity(e){return this.putMeta([{key:f,value:e}])}getADVSignedIdentity(){return this.getMeta(f)}getPreKeysByRange(e,t){return(0,i.getPreKeyTable)().greaterThan(["keyId"],e-1,{limit:t})}getPreKeyById(e){return(0,i.getPreKeyTable)().get(e)}removePreKeyById(e){return(0,i.getPreKeyTable)().remove(e)}bulkRemovePreKey(e){return(0,i.getPreKeyTable)().bulkRemove(e)}putPreKeys(e){const t=(0,i.getPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,isDirectDistribution:i}=e;return t.get(r).then((e=>{if(e)throw Error(`preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,isDirectDistribution:i})}))}));return Promise.all(r).then()}markPreKeyAsDirectDistribution(e){return(0,i.getPreKeyTable)().merge(e,{isDirectDistribution:1})}getSignedPreKey(){return this.getMeta(d).then((e=>this.getSignedPreKeyById(e)))}getSignedPreKeyById(e){if(this.idToSignedPreKey.has(e))return Promise.resolve(this.idToSignedPreKey.get(e));return(0,i.getSignedPreKeyTable)().get(e).then((t=>(this.idToSignedPreKey.set(e,t),t)))}putSignedPreKeys(e){const t=(0,i.getSignedPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,signature:i}=e;return t.get(r).then((e=>{if(e)throw Error(`signed preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,signature:i})}))}));return Promise.all(r).then()}putSession(e,t){return(0,i.getSessionTable)().createOrReplace({address:e,session:t})}bulkPutSession(e){return(0,i.getSessionTable)().bulkCreateOrReplace(e)}removeSession(e){return(0,i.getSessionTable)().remove(e)}bulkRemoveSession(e){return(0,i.getSessionTable)().bulkRemove(e)}getSession(e){return(0,i.getSessionTable)().get(e).then((e=>e?e.session:null))}bulkGetSession(e){return(0,i.getSessionTable)().bulkGet(e).then((e=>e.map((e=>e?e.session:null))))}putIdentity(e,t){return(0,i.getIdentityTable)().createOrReplace({identifier:e,identityKey:t})}bulkPutIdentity(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}bulkGetIdentity(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?e.identityKey:null))))}getIdentity(e){return(0,i.getIdentityTable)().get(e).then((e=>e?e.identityKey:null))}removeIdentity(e){return(0,i.getIdentityTable)().remove(e)}bulkRemoveIdentity(e){return(0,i.getIdentityTable)().bulkRemove(e)}getIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().get(e).then((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))}bulkGetIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))))}bulkPutIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}saveBaseKey(e,t,r){return(0,i.getBaseKeyTable)().createOrReplace({address:e,originalMsgId:t,baseKey:r})}loadBaseKey(e,t){return(0,i.getBaseKeyTable)().equals(["address","originalMsgId"],[e,t]).then((e=>e&&0!==e.length?e[0].baseKey:null))}deleteBaseKey(e,t){const r=(0,i.getBaseKeyTable)();return r.equals(["address","originalMsgId"],[e,t]).then((e=>{if(e&&0!==e.length)return r.remove(e[0].id)}))}putSenderKey(e,t,r){return(0,i.getSenderKeyTable)().createOrReplace({senderKeyName:e,senderId:t,senderKey:r})}bulkPutSenderKey(e){return(0,i.getSenderKeyTable)().bulkCreateOrReplace(e)}removeSenderKey(e){return(0,i.getSenderKeyTable)().remove(e)}getSenderKey(e){return(0,i.getSenderKeyTable)().get(e).then((e=>e?e.senderKey:null))}removeSenderKeyBySenderId(e){const t=(0,i.getSenderKeyTable)();return t.equals(["senderId"],e).then((e=>t.bulkRemove(e.map((e=>e.senderKeyName)))))}clearCredential(){const e=[(0,i.getIdentityTable)(),(0,i.getMetaTable)(),(0,i.getPreKeyTable)(),(0,i.getSessionTable)(),(0,i.getSignedPreKeyTable)()];return Promise.all(e.map((e=>e.clear()))).then((()=>{}))}getRegistrationInfo(){return null!=this.registrationInfo?Promise.resolve(this.registrationInfo):Promise.all([this.getMeta(o),this.getMeta(s),this.getMeta(l)]).then((e=>{let[t,r,n]=e;if(t&&r&&n)return Promise.all([g(r),g(n)]).then((e=>{let[r,n]=e;return this.registrationInfo={registrationId:t,identityKeyPair:{pubKey:r,privKey:n}},this.registrationInfo}))}))}setRegistrationInfo(e){return Promise.all([h(e.identityKeyPair.pubKey),h(e.identityKeyPair.privKey)]).then((t=>{let[r,n]=t;return Promise.all([this.putMeta([{key:o,value:e.registrationId},{key:s,value:r},{key:l,value:n}])]).then()}))}getOrGenPreKeys(e,t){return(0,a.getStorage)().lock(["signal-meta-store","prekey-store"],(()=>Promise.all([this.getMeta(u),this.getMeta(c)]).then((r=>{let[n,i]=r;const a=n||1,o=i||1,s=o-a,l=e-s;if(l<=0)return __LOG__(2)`getPreKeys: no prekey needs to be generated, avaliable: ${s}, need: ${e}`,this.getPreKeysByRange(a,e);const c=function(e,t){const r=[];for(let n=e;n<t;n++)r.push(n);return r}(o,o+l).map((e=>t(e)));return Promise.all(c).then((e=>this.savePreKeys(e))).then((()=>this.getPreKeysByRange(a,e)))}))))}getOrGenSinglePreKey(e){return this.getOrGenPreKeys(1,e).then((e=>{if(1!==e.length)throw Error("Expected to get exactly one key but got ${keys.length}");return e[0]}))}savePreKeys(e){if(0===e.length)return Promise.resolve();const t=e[e.length-1];return Promise.all([this.putMeta([{key:c,value:t.keyId+1}]),this.putPreKeys(e)]).then()}markKeyAsUploaded(e){return Promise.all([this.getMeta(u),this.getMeta(c)]).then((t=>{let[r,n]=t;if(e<0||!n||e>=n)throw Error(`markKeyAsUploaded: key ${e} is out of boundary.`);const i=r?Math.max(r,e+1):e+1;return this.putMeta([{key:u,value:i}])}))}rotateSignedPreKey(e,t){return(0,a.getStorage)().lock(["signal-meta-store","signed-prekey-store"],(()=>this.getMeta(d).then((r=>{const n=null==r?1:r+1;return t(e,n).then((e=>(this.putSignedPreKeys([e]),this.putMeta([{key:d,value:n}]),e)))}))))}};t.waSignalStore=m},93832:(e,t)=>{"use strict";function r(e,t){for(let r=0;r<t;r++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.bufferEqual=function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0},t.bufferToStr=function(e){return new window.dcodeIO.ByteBuffer.wrap(e).toString("binary")},t.createSignalAddress=function(e){if(!(e.isUser()||e.isServer()||e.isPSA()))throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified, jid.server should be "s.whatsapp.net"`);return new window.libsignal.SignalProtocolAddress(e.getSignalAddress(),0)},t.strToBuffer=function(e){return new window.dcodeIO.ByteBuffer.wrap(e,"binary").toArrayBuffer()},t.unpad=function(e){const t=new Uint8Array(e);if(0===t.length)throw new Error("unpadPkcs7 given empty bytes");const r=t[t.length-1];if(r>t.length)throw new Error(`unpad given ${t.length} bytes, but pad is ${r}`);return new Uint8Array(t.buffer,t.byteOffset,t.length-r)},t.writePad=r,t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),r(e,1+(15&t[0]))}},77605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.KeyGenerator=t.Cipher=void 0;var n=s(r(58425)),i=s(r(55878)),a=s(r(54084));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const l=n;t.KeyGenerator=l;const c=i;t.Cipher=c;const d=a;t.Session=d},58425:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIdentityKeyPair=function(){return l.apply(this,arguments)},t.generatePreKeyPair=function(){return o.apply(this,arguments)},t.generateSignedKeyPair=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(5087);function o(){return(o=(0,i.default)((function*(e){const t=yield window.libsignal.KeyHelper.generatePreKey(e),{keyId:r,keyPair:n}=t;return{keyId:r,keyPair:(0,a.toCurveKeyPair)(n),isDirectDistribution:0}}))).apply(this,arguments)}function s(){return(s=(0,i.default)((function*(e,t){const r=yield window.libsignal.KeyHelper.generateSignedPreKey(e,t),{keyId:n,keyPair:i,signature:o}=r;return{keyId:n,keyPair:(0,a.toCurveKeyPair)(i),signature:o}}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){const e=yield window.libsignal.KeyHelper.generateIdentityKeyPair();return(0,a.toCurveKeyPair)(e)}))).apply(this,arguments)}},46361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyIdentityKey=function(e){if(e instanceof ArrayBuffer)return(0,n.bufferToStr)(e);return e};var n=r(93832)},52083:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enableMemSignalStore=function(){o=i.default},t.enablePersistSignalStore=function(){o=a.default},t.getSignalProtocolStore=function(){return o};var i=n(r(54624)),a=n(r(76128));let o=a.default},54624:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(50361)),o=r(88102),s=r(46361),l=r(5087),c=r(99234),d=r(1291),u=r(11849),p=r(93832);var f=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.PrekeyStore=new Map,this.SenderKeyStore=new Map,o.Cmd.on("logout",(()=>{this.cleanStorage()}))}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityStore.has(e)){const r=yield u.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityStore.set(e,r)}return(null===(r=t.IdentityStore.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}saveIdentity(e,t){var r=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to put identity key for undefined/null key"));const n=(0,s.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);i&&i===n||(i&&e===(0,p.createSignalAddress)((0,c.getMeUser)()).toString()?(0,d.handleSelfPrimaryIdentityChange)():r.putIdentity(e,n))}))()}putIdentity(e,t){this.IdentityStore.set(e,{identityKey:t})}removeIdentity(e){return null==e?Promise.reject(new Error("Tried to remove identity key for undefined/null key")):(this.IdentityStore.set(e,{deleted:!0}),Promise.resolve())}loadPreKey(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t.PrekeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getPreKeyById(e))||void 0===r?void 0:r.keyPair;t.PrekeyStore.set(e,{keyPair:n})}const n=t.PrekeyStore.get(e);return(null==n?void 0:n.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this.PrekeyStore.set(e,{deleted:!0}),Promise.resolve())}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SignedPreKeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStore.set(e,n)}return t.SignedPreKeyStore.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){var r;if(null!=e){if(!t.SessionStore.has(e)){const r=yield u.waSignalStore.getSession(e);t.SessionStore.set(e,r?{session:r}:void 0)}return(null===(r=t.SessionStore.get(e))||void 0===r?void 0:r.session)||void 0}}))()}storeSession(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SessionStore.set(e,{session:t}),Promise.resolve())}removeSession(e){return null==e?Promise.reject(new Error("Tried to remove session without identifier")):(this.SessionStore.set(e,{deleted:!0}),Promise.resolve())}storeSenderKey(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SenderKeyStore.set(e,t),Promise.resolve())}loadSenderKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SenderKeyStore.has(e)){const r=yield u.waSignalStore.getSenderKey(e);t.SenderKeyStore.set(e,r)}return t.SenderKeyStore.get(e)||void 0}}))()}cleanStorage(){this.RegistrationInfo=null,this.SessionStore.clear(),this.IdentityStore.clear(),this.PrekeyStore.clear(),this.SignedPreKeyStore.clear(),this.SenderKeyStore.clear()}_generateSessionUpdate(){const e=[],t=[];return Array.from(this.SessionStore.keys()).forEach((r=>{const n=this.SessionStore.get(r);n&&(n.deleted?t.push(r):e.push({address:r,session:(0,a.default)(n.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return Array.from(this.SenderKeyStore.keys()).forEach((t=>{const r=this.SenderKeyStore.get(t);if(r){const n=t.split("::");2===n.length&&e.push({senderKeyName:t,senderId:n[1],senderKey:(0,a.default)(r)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return Array.from(this.IdentityStore.keys()).forEach((r=>{const n=this.IdentityStore.get(r);n&&(n.deleted?t.push(r):e.push({identifier:r,identityKey:n.identityKey,rowId:n.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return Array.from(this.PrekeyStore.keys()).forEach((t=>{const r=this.PrekeyStore.get(t);(null==r?void 0:r.deleted)&&e.push(parseInt(t,10))})),e}generateSnapshot(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.default=f},76128:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(97197),s=r(46361),l=r(5087),c=r(99234),d=r(57701),u=r(1291),p=r(11849),f=r(77246),_=r(93832);var h=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache=new Map,this.SessionCache=new Map,this.SessionCacheDirtySet=new Set,this._sessionMutex=new o.Semaphore(1),this.IdentityCache=new Map,this.IdentityCacheDirtySet=new Set,this._identityMutex=new o.Semaphore(1)}getIdentityKeyPair(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfoReadThruCache.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}saveIdentity(e,t){var r=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const n=(0,s.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);if(!i||i!==n){if(i){if(e===(0,_.createSignalAddress)((0,c.getMeUser)()).toString())return void(0,u.handleSelfPrimaryIdentityChange)();yield(0,u.handleNewIdentity)(e)}yield r.putIdentity(e,n)}}))()}_putIdentityImpl(e,t){const r=this.IdentityCache.get(e);this.IdentityCache.set(e,(0,i.default)((0,i.default)({},r),{},{identityKey:t})),this.IdentityCacheDirtySet.add(e)}putIdentity(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{(0,d.identityStoreCacheEnabled)()?r._putIdentityImpl(e,t):(yield p.waSignalStore.putIdentity(e,t),r.IdentityCache.set(e,{identityKey:t}))}finally{n.release()}}))()}_loadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityCache.has(e)){const r=yield p.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityCache.set(e,r)}return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{r.release()}}))()}getIdentityRowId(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var r;return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const r=new Array(e.length),n=[];if(e.forEach(((e,i)=>{var a;t.IdentityCache.has(e)?r[i]=null===(a=t.IdentityCache.get(e))||void 0===a?void 0:a.identityKey:n.push({id:e,pos:i})})),n.length>0){(yield p.waSignalStore.bulkGetIdentityKeyWithRowId(n.map((e=>e.id)))).forEach(((e,i)=>{const a=n[i];t.IdentityCache.set(a.id,e),r[a.pos]=null==e?void 0:e.identityKey}))}return r}))()}bulkLoadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{r.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,f.getStorage)().lock(["identity-store"],(0,a.default)((function*(){const r=e.map((e=>e.identifier)),n=yield t._bulkLoadIdentityKeyImpl(r),i=e.filter(((e,t)=>!n[t]));i.length>0&&(yield p.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:r,identityKey:n}=e;t.IdentityCache.set(r,{identityKey:n})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{r.release()}}))()}_removeIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));yield p.waSignalStore.removeIdentity(e),t.IdentityCache.delete(e),t.IdentityCacheDirtySet.delete(e)}))()}removeIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._removeIdentityImpl(e)}finally{r.release()}}))()}loadPreKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);const t=yield p.waSignalStore.getPreKeyById(e);return(null==t?void 0:t.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):p.waSignalStore.removePreKeyById(e)}loadSignedPreKey(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SignedPreKeyStoreReadThruCache.has(e)){var r;const n=null===(r=yield p.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStoreReadThruCache.set(e,n)}return t.SignedPreKeyStoreReadThruCache.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SessionCache.has(e)){const r=yield p.waSignalStore.getSession(e);t.SessionCache.set(e,r)}return t.SessionCache.get(e)||void 0}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this.SessionCache.set(e,t),this.SessionCacheDirtySet.add(e)}storeSession(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._sessionMutex.acquire();return r._storeSessionImpl(e,t),n.release(),Promise.resolve()}))()}removeSession(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove session without identifier"));yield p.waSignalStore.removeSession(e),t.SessionCache.delete(e),t.SessionCacheDirtySet.delete(e)}))()}containSessions(e){var t=this;return(0,a.default)((function*(){const r=[];for(const n of e)t.SessionCache.has(n)||r.push(n);if(r.length>0){(yield p.waSignalStore.bulkGetSession(r)).forEach(((e,n)=>{const i=r[n];t.SessionCache.set(i,e)}))}return e.map((e=>!!t.SessionCache.get(e)))}))()}storeSenderKey(e,t){if(null==e)return Promise.reject(new Error("Tried to put senderKey without senderKeyName"));const r=e.split("::");if(r.length<2)return Promise.reject(new Error("Tried to put senderKey with invalid senderKeyName"));const n=r[1];return p.waSignalStore.putSenderKey(e,n,t)}loadSenderKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);return(yield p.waSignalStore.getSenderKey(e))||void 0}))()}deleteAllCache(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`deleteAllCache`,this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache.clear(),this.SessionCache.clear(),this.IdentityCache.clear(),this.SessionCacheDirtySet.clear(),this.IdentityCacheDirtySet.clear()}_flushSessions(){var e=this;return(0,a.default)((function*(){if(0===e.SessionCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: get dirty updates for ${Array.from(e.SessionCacheDirtySet).join(",")}`;const t=[];e.SessionCacheDirtySet.forEach((r=>{const n=e.SessionCache.get(r);n&&t.push({address:r,session:n})})),t.length>0&&(yield p.waSignalStore.bulkPutSession(t)),e.SessionCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: ${t.length} flushed`}))()}_flushIdentities(){var e=this;return(0,a.default)((function*(){if(!(0,d.identityStoreCacheEnabled)())return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: disabled`;if(0===e.IdentityCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: get dirty updates for ${Array.from(e.IdentityCacheDirtySet).join(",")}`;const t=[];e.IdentityCacheDirtySet.forEach((r=>{const n=e.IdentityCache.get(r);n&&t.push((0,i.default)((0,i.default)({},n),{},{identifier:r}))})),t.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(t)),e.IdentityCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: ${t.length} flushed`}))()}flushBufferToDiskIfNotMemOnlyMode(){var e=this;return(0,a.default)((function*(){const t=yield e._sessionMutex.acquire(),r=yield e._identityMutex.acquire();try{yield(0,f.getStorage)().lock(["identity-store","session-store"],(()=>Promise.all([e._flushSessions(),e._flushIdentities()])))}finally{r.release(),t.release()}}))()}_updateIdentityRangeAfterEncryptionImpl(e,t){var r=this;return(0,a.default)((function*(){if(__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: start`,yield r._bulkLoadIdentityKeyImpl(t),(0,d.identityStoreCacheEnabled)()){const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(r.IdentityCache.set(t,{identityKey:i.identityKey,rowId:e}),r.IdentityCacheDirtySet.add(t),n.push(t))})),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} updated`}else{const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(i.rowId=e,n.push({identifier:t,identityKey:i.identityKey,rowId:e}))})),n.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(n),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} flushed`)}}))()}updateIdentityRangeAfterEncryption(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{yield r._updateIdentityRangeAfterEncryptionImpl(e,t)}finally{n.release()}}))()}};t.default=h},54084:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupSignalSession=function(){return E.apply(this,arguments)},t.createSignalSession=function(){return _.apply(this,arguments)},t.deleteDeviceSenderKey=function(e){const t=String((0,f.createSignalAddress)(e));return p.waSignalStore.removeSenderKeyBySenderId(t)},t.deleteGroupSenderKeyInfo=function(e){const t=(0,f.createSignalAddress)((0,c.assertGetMe)()),r=`${e.toString({legacy:!0})}::${t.toString()}`;return p.waSignalStore.removeSenderKey(r)},t.deleteRemoteInfo=function(){return g.apply(this,arguments)},t.getGroupSenderKeyInfo=function(){return S.apply(this,arguments)},t.getRemoteRegId=function(){return h.apply(this,arguments)},t.hasSameBaseKey=function(){return y.apply(this,arguments)},t.hasSignalSessions=function(e){return d.default.containSessions(e.map((e=>(0,f.createSignalAddress)(e).toString())))},t.saveSessionBaseKey=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(8584),o=r(52230),s=r(46308),l=r(5087),c=r(99234),d=n(r(76128)),u=r(52083),p=r(11849),f=r(93832);function _(){return(_=(0,i.default)((function*(e){const{wid:t,identity:r,deviceIdentity:n}=e;if(__LOG__(2)`Signal::createSignalSession with `,null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID){if(!n)throw new Error("Signal::createSignalSession: expected device-identity in keyBundle for companion device");if(!(yield(0,s.validateADVwithIdentityKey)(t,n,r)))throw new Error("Signal::createSignalSession: invalid identityKey fetched")}let i,c,u;try{i=(0,l.toSignalCurvePubKey)(new a.Binary(e.identity).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid identityKey fetched"),e}try{c=(0,l.toSignalCurvePubKey)(new a.Binary(e.skey.pubkey).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(e.key)try{u=(0,l.toSignalCurvePubKey)(new a.Binary(e.key.pubkey).readBuffer())}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid preKey fetched")}const p={registrationId:e.regId,identityKey:i,signedPreKey:{keyId:e.skey.id,publicKey:c,signature:new a.Binary(e.skey.signature).readBuffer()}};return e.key&&u&&(p.preKey={keyId:e.key.id,publicKey:u}),new window.libsignal.SessionBuilder(d.default,(0,f.createSignalAddress)(t)).processPreKey(p)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=new window.libsignal.SessionCipher(d.default,(0,f.createSignalAddress)(e));return(yield Promise.resolve(t)).getRemoteRegistrationId()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=(0,f.createSignalAddress)(e).toString();yield Promise.all([(0,u.getSignalProtocolStore)().removeIdentity(t),(0,u.getSignalProtocolStore)().removeSession(t)])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const r=(0,f.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,r),i=yield n.getSessionBaseKey();i?yield p.waSignalStore.saveBaseKey(r.toString(),t,i):__LOG__(2)`saveSessionBaseKey: for ${t}, no basekey provided`}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const r=(0,f.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,(0,f.createSignalAddress)(e)),[i,a]=yield Promise.all([n.getSessionBaseKey(),p.waSignalStore.loadBaseKey(r.toString(),t)]);return a?i?(0,f.bufferEqual)(a,i)?(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is same`,!0):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is different `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no session has been saved locally `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no base key has been saved locally `,!1)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r){const n=new window.libsignal.GroupCipher((0,u.getSignalProtocolStore)(),t,(0,f.createSignalAddress)(e));return(yield Promise.resolve(n)).decryptSenderKeyDistributionMessage(r)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=new window.libsignal.GroupCipher(d.default,e.toString({legacy:!0}),(0,f.createSignalAddress)((0,c.assertGetMe)())),r=yield t.createSenderKeyDistributionMsg();return(0,f.strToBuffer)(r)}))).apply(this,arguments)}},91335:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractIdentityKey=function(e){const t=window.dcodeIO.ByteBuffer.wrap(e);t.readUint8();try{const e=window.libsignal.Protobuf.PreKeyWhisperMessage.decode(t);return(0,i.toCurveKeyPubKey)(e.identityKey.toArrayBuffer())}catch(e){return __LOG__(3)`extractIdentityKey: parse proto failed`,null}},t.xmppPreKey=function(e){return(0,n.wap)("key",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey))},t.xmppSignedPreKey=function(e){return(0,n.wap)("skey",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey),(0,n.wap)("signature",null,e.signature))};var n=r(31914),i=r(5087)},92613:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startBackend=q;var i=n(r(48926)),a=r(72651),o=r(38284),s=r(55062),l=r(18018),c=r(86945),d=r(64971),u=r(89981),p=r(68268),f=n(r(48277)),_=r(16116),h=r(98972),g=n(r(69048)),m=r(88102),y=r(24747),E=r(79502),S=r(93771),v=r(15998),T=r(91214),C=r(99234),A=r(7293),b=n(r(18438)),P=r(36163),M=r(37726),O=r(68819),I=(r(83578),r(46582)),w=n(r(11339)),R=r(76214),D=r(85417),N=r(67087),L=r(47587),k=r(34771),G=r(48694),U=r(47569),F=r(29100),x=r(64551),B=r(11849),K=r(66837),j=r(38804),Y=r(42862),W=r(70768),H=r(31452),V=r(46669),$=(r(47221),r(77959)),z=r(65044);function q(){return J.apply(this,arguments)}function J(){return(J=(0,i.default)((function*(){if(!B.waSignalStore.getRegistrationInfo())return void __LOG__(2)`startBackendRegistered: chatd user not registered`;__LOG__(2)`[startBackend]: connected as ${(0,C.assertGetMe)()}`;try{yield(0,o.promiseTimeout)(Promise.all([(0,R.initialize)()]),2e4),yield(0,o.promiseTimeout)((0,D.initialize)(),2e4)}catch(e){m.Cmd.storageInitializationError()}(0,d.isABPropsAfterFirstSync)()&&(yield(0,c.updateABPropsFromStorage)());const e=yield(0,S.getTable)().count(),t=yield B.waSignalStore.getServerHasPreKeys(),r=(0,s.getCommsConfig)({passive:e>0||!t});yield te(),yield(0,y.startComms)(b.default,F.sendPing,r,(e=>Promise.resolve((0,a.inflate)(e))),(()=>{}),(()=>{})),yield(0,y.waitForConnection)();{const r=[];e>0&&r.push((0,h.sendAndClearDanglingReceipts)()),t||((0,T.setDeviceLinkPairStage)(w.default.MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS),r.push((0,V.uploadPreKeys)().catch((e=>{__LOG__(4,!0,new Error,!0)`error while uploading prekeys, ${e}`,SEND_LOGS("error while uploading prekeys"),(0,T.commitDeviceLinkEvent)(-1)})))),yield Promise.all(r),(0,T.setDeviceLinkPairStage)(w.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),(0,T.commitDeviceLinkEvent)(),yield(0,L.sendPassiveIq)(!1)}k.PrimaryFeatures.initializeFromLocalStorage(),(0,d.isABPropsAfterFirstSync)()||(yield(0,u.syncABPropsTask)()),yield X(),Q(),yield(0,j.initialize)(),G.PrimaryForceUpgrade.setup(),yield(0,_.initChatThreadLogging)(),yield(0,O.startWebPersistedJobManager)(),yield(0,y.startHandlingRequests)();const n=!f.default.isCriticalDataSynced();n?yield f.default.syncCriticalData():__LOG__(2)`[bootstrap] need to sync critical data: false`,yield v.DbEncKeyStore.waitForFinalDbMsgEncKey(),null==x.ServerProps.serverPropsVersion&&(yield(0,U.queryServerProps)()),(0,l.compareServerPropsAndABProps)(),ee(),W.TosManager.run(),(0,M.startQPL)(),(0,N.upgradeToCommunity)(n)}))).apply(this,arguments)}function Q(){var e;const t=null===(e=(0,C.getMaybeMeUser)())||void 0===e?void 0:e.user;t&&$.Wam.set(w.default.METRICS.getGlobal("psCountryCode"),(0,E.getCountryShortcodeByPhone)(t))}function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.default)((function*(){(0,c.getABPropConfigValue)("web_wam_v5_enabled")&&(yield $.Wam.upgradeWamRuntime())}))).apply(this,arguments)}function ee(){(0,H.applyContactBusinessProps)(),(0,P.restoreLabels)(),(0,P.restoreQuickReplies)(),(0,P.restoreLabelAssociations)(),(0,P.restoreCarts)(),(0,P.restoreArchiveV2Settings)()}function te(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(){const e=r(99234),t=r(56891).default,{loadProtoVersions:n}=r(77113),i=e.getVersion(),a=(null==i?void 0:i.protoVersion)||[0,17];yield n(),A.GK.setVersion(a),t.setVersion(a,10,"EAEYASACKAEwAjgBQAFIAVgBYAFoAXgBmAEBoAEBqAEBsAECuAEBwAEByAEB0AEA2AEB4AEC8AED+AEDgAIDkAIDmAIAqAIDsAIAuAIDwAIB"),x.ServerProps.updateSelectiveProps({groupDescLength:512,multicastLimitGlobal:5,frequentlyForwardedMax:5,stickers:1,mdBlocklistV2:1})}))).apply(this,arguments)}m.Cmd.on("main_stream_mode_ready",(()=>{try{f.default.continueProgressiveHistorySyncProcessing(),g.default.startIndexer(),(0,I.requireStatusV3Collection)().then((e=>{e.sync()})),(0,Y.registerTasks)(),(0,K.runSyncDirtyContactsJob)(),(0,P.restoreRecentStickers)(),(0,P.restoreFavoriteStickers)(),(0,p.scheduleAdvDeviceInfoCheck)()}catch(e){__LOG__(2)`debug setup failed:`}})),m.Cmd.on("md_restart_backend",(()=>{(0,y.stopComms)(),q()})),m.Cmd.on("storage_initialization_error",(0,i.default)((function*(){__LOG__(2)`storage initialization error, logging out`,yield z.Socket.clearCredentialsAndStoredData(),m.Cmd.logout()}))),A.GK.on(A.FEATURE_CHANGE_EVENT,(()=>{(0,P.updateGKFeatures)()}))},21084:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50073),i=r(381),a=r(92844),o=r(60980),s=r(45606),l=r(58052),c=r(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=4}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){const{value:t}=e,r=t.androidUnsupportedActions;if(!r)return __LOG__(3)`android unsupported actions: malformed mutation`,{actionState:s.SyncActionState.Malformed};return r.allowed&&this.updatePrimaryAllowsAllMutationsFlag("allow_unsupported_mutation"),{actionState:s.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}})))}getAndroidUnsupportedActionsMutation(){const e=(0,a.unixTimeMs)();return{collection:s.CollectionName.RegularLow,index:JSON.stringify([s.Actions.AndroidUnsupportedActions]),operation:n.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,o.encodeProtobuf)(i.SyncActionValueSpec,{timestamp:e,androidUnsupportedActions:{allowed:!0}}).readBuffer(),timestamp:e,action:s.Actions.AndroidUnsupportedActions}}updatePrimaryAllowsAllMutationsFlag(e){(0,l.getPrimaryAllowsAllMutations)()||(__LOG__(2)`[syncd] primary allows all mutations flag set: ${e}`,(0,l.setPrimaryAllowsAllMutations)())}}const u=new d;Object.freeze(u);var p=u;t.default=p},74362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=r(69951),h=r(45606),g=r(57701),m=r(19937),y=n(r(11339)),E=r(76214),S=n(r(68132)),v=r(89835),T=r(22954),C=r(93824);function A(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:h.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:h.SyncActionState.Orphan,orphanModel:{modelType:h.SyncModelType.Chat,modelId:e.toString()}}}}class b extends v.SyncActionBase{constructor(){super(...arguments),this.version=3}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,T.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}setArchive(e){return(0,a.default)((function*(){yield(0,E.getChatTable)().bulkCreateOrMerge(e),e.forEach((e=>{const t=(0,d.createWid)(e.id),r=_.ChatCollection.get(t);r&&(r.archive=e.archive)}))}))()}validateSyncActionValue(e){const t=e.archiveChatAction;return null!=(null==t?void 0:t.archived)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return(0,a.default)((function*(){const r=new Map;yield(0,E.getChatTable)().bulkGet(e.map((e=>{const{indexParts:t}=e,[,r]=t;return r&&c.default.isWid(r)?(0,d.createWid)(r).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const n=[],i=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,T.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,C.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:h.SyncActionState.Malformed};const l=a.archiveChatAction;if(!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][archive-chat]: malformed mutation`,{actionState:h.SyncActionState.Malformed};const u=(0,o.default)(null==l?void 0:l.archived,"archiveChatAction?.archived"),p=(0,o.default)(null==l?void 0:l.messageRange,"archiveChatAction?.messageRange"),f=(0,d.createWid)(s);if(!r.has(f.toString()))return{actionState:h.SyncActionState.Orphan,orphanModel:{modelType:h.SyncModelType.Chat,modelId:f.toString()}};const _=yield t._applyMutation(f,u,p,a);return _.updates&&n.push(_.updates),_.syncApplyActionResult}return __LOG__(3)`[syncd][archive-chat]: REMOVE operation not supported`,{actionState:h.SyncActionState.Unsupported}}catch(e){return{actionState:h.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return n.length>0&&(yield t.setArchive(n)),i}))()}_applyMutation(e,t,r,n){return(0,a.default)((function*(){if(yield(0,f.removeActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive")),!t)return{updates:{id:e.toString(),archive:t},syncApplyActionResult:{actionState:h.SyncActionState.Success}};const i=yield(0,m.constructMessageRange)(e,!1),a=(0,m.compareMessageRanges)(i,r),o=(0,p.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer(),s=()=>(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive"),o),c=(0,g.archiveV2Supported)()&&S.default.showArchiveV2;switch(a){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield s(),{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)};case m.MessageRangeEncloseType.RangeAEnclosesRangeB:case m.MessageRangeEncloseType.RangesNotEnclosing:return c?{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)}:(yield s(),{updates:void 0,syncApplyActionResult:A(e,a)})}}))()}_constructArchiveChatIndex(e){return JSON.stringify([h.Actions.Archive,e.toString({legacy:!0})])}getArchiveChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,archiveChatAction:{archived:t,messageRange:yield(0,m.constructMessageRange)(r,!0)}};return{collection:h.CollectionName.RegularLow,index:n._constructArchiveChatIndex(r),binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:h.Actions.Archive}}))()}getMutationsForArchive(e,t,n){var i=this;return(0,a.default)((function*(){const a=[yield i.getArchiveChatMutation(e,t,n)];if(t&&(0,g.pinChatSyncEnabled)()){const t=r(36014).default;a.push(t.getPinMutation(e,!1,n))}return a}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,s;const c=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),_=c(e.binarySyncAction),g=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(_.archiveChatAction,"pendingMutationValue.archiveChatAction"),v=(0,o.default)(g.archiveChatAction,"incomingMutationValue.archiveChatAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return h.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return h.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?h.ConflictResolutionState.ApplyRemoteAndDropLocal:h.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(n=v.archived)&&void 0!==n&&n:null!==(s=S.archived)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange")),u=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},g),{},{archiveChatAction:{archived:t,messageRange:c}})).readBuffer(),_=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:u});return delete _.id,yield(0,m.lockForMessageRangeSync)(["chat"],[_],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,d.createWid)(n[1]);return yield(0,f.addActiveMessageRange)(i.toString(),(0,f.getActiveRangeAction)("archive"),u),r.setArchive([{id:i.toString(),archive:t}])}))),h.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new b;Object.freeze(P);var M=P;t.default=M},28464:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(381),s=r(45454),l=r(84902),c=r(38342),d=r(69702),u=n(r(21084)),p=r(69951),f=r(45606),_=n(r(73407)),h=r(57701),g=r(19937),m=r(76214),y=r(58052),E=n(r(68132)),S=r(99069),v=r(89835);class T extends v.SyncActionBase{constructor(){super(...arguments),this.version=4}decodeValue(e){if(!e.binarySyncData){if(!e.binarySyncAction)throw __LOG__(4,void 0,new Error,!0,["syncd"])`binarySyncAction should not be null`,SEND_LOGS("syncd binarySyncAction should not be null"),new Error("binarySyncAction should not be null");return(0,l.decodeProtobuf)(o.SyncActionValueSpec,e.binarySyncAction)}{const t=(0,l.decodeProtobuf)(o.SyncActionDataSpec,e.binarySyncData);if(t.value)return t.value}}applyMutations(e,t){var r=this;return(0,a.default)((function*(){u.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{setMutationsPendingToPersist:n}=t;if(e.length>0){const t=e[e.length-1];try{let e=[];if(!(0,h.archiveV2Supported)())return __LOG__(3)`archive setting sync: ArchiveV2 not supported yet`,[{actionState:f.SyncActionState.Unsupported}];if("set"===t.operation){const{value:o}=t,l=o.unarchiveChatsSetting;if(null==(null==l?void 0:l.unarchiveChats))return __LOG__(3)`archive setting sync: malformed mutation`,[{actionState:f.SyncActionState.Malformed}];const c=l.unarchiveChats;return(0,y.getArchiveV2EnabledSetting)()||((0,y.setArchiveV2EnabledSetting)(!0),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{enabled:!0})),(0,y.setUnarchiveChatsSetting)(c),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{classic:c}),yield(0,S.getStorage)().lock(["message","chat","sync-actions","active-message-ranges"],(0,a.default)((function*(){e=yield r.updateSideEffectOnChats(c,n),yield(0,m.getChatTable)().bulkCreateOrMerge(e)}))),e.forEach((e=>{const t=(0,s.createWid)(e.id),r=p.ChatCollection.get(t);r&&(r.archive=e.archive)})),[{actionState:f.SyncActionState.Success}]}return __LOG__(3)`archive setting sync: operation not supported`,[{actionState:f.SyncActionState.Unsupported}]}catch(e){return[{actionState:f.SyncActionState.Failed}]}}return __LOG__(3)`archive setting sync: no mutations`,[{actionState:f.SyncActionState.Failed}]}))()}handleSettingOn(e){var t=this;return(0,a.default)((function*(){const r=[];performance.now();const n=(yield(0,m.getChatTable)().all()).filter((e=>e.archive)).map((e=>e.id)),i=(yield Promise.all(n.map((e=>(0,c.getActiveMessageRanges)(e))))).flat().filter((e=>e.action===d.ActiveRangeAction.Archive)).map((e=>e.chatId)),a=n.filter((e=>!i.includes(e))),o=(yield Promise.all(a.map((t=>{const r=(0,s.createWid)(t),n=JSON.stringify([f.Actions.Archive,r.toString({legacy:!0})]),i=e.find((e=>e.index===n));return i?Promise.resolve(i):_.default.getSyncAction(n)})))).filter((e=>{if(!e)return!1;const r=t.decodeValue(e).archiveChatAction;return[f.SyncActionState.Success,f.SyncActionState.Orphan].includes(e.actionState)&&(null==r?void 0:r.archived)&&r.messageRange})).map((e=>{const r=e&&t.decodeValue(e).archiveChatAction;return[e?JSON.parse(e.index)[1]:"",null==r?void 0:r.messageRange]})),l=new Map(o),u=Array.from(l.keys()),p=yield Promise.all(u.map((e=>(0,g.constructMessageRange)((0,s.createWid)(e),!1))));return u.forEach(((e,t)=>{const n=p[t],i=l.get(e);if(i){const t=(0,g.compareMessageRanges)(n,i);if(t===g.MessageRangeEncloseType.RangeAEnclosesRangeB||t===g.MessageRangeEncloseType.RangesNotEnclosing){const t=(0,s.createWid)(e);r.push({id:t.toString({legacy:!1}),archive:!1})}else __LOG__(4,void 0,new Error,!0)`Archive_Setting_Sync: Unsupported rangeEnclosedType ${t}`,SEND_LOGS("ArchiveSettingSync setting true rangeEnclosedType unsupported")}})),performance.now(),r.length,r}))()}handleSettingOff(e){var t=this;return(0,a.default)((function*(){const r=[],n=yield _.default.getSyncActionsRows(["action"],[f.Actions.Archive]),i=e.filter((e=>e.action===f.Actions.Archive)),a=i.map((e=>e.index));return[...n.filter((e=>!a.includes(e.index))),...i].filter((e=>{if(e.actionState===f.SyncActionState.Success){var r;return null===(r=t.decodeValue(e).archiveChatAction)||void 0===r?void 0:r.archived}return!1})).forEach((e=>{const t=JSON.parse(e.index)[1],n=(0,s.createWid)(t);r.push({id:n.toString({legacy:!1}),archive:!0})})),r.length,r}))()}updateSideEffectOnChats(e,t){return e?this.handleSettingOn(t):this.handleSettingOff(t)}}const C=new T;Object.freeze(C);var A=C;t.default=A},29867:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=n(r(21084)),h=r(69951),g=r(45606),m=n(r(73407)),y=r(57701),E=r(19937),S=n(r(11339)),v=r(76214),T=r(6684),C=r(89835),A=r(22954),b=r(93824);class P extends C.SyncActionBase{constructor(){super(...arguments),this.version=6}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,A.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}_getMessageIdsThatWereUnstarredInCurrentPatch(e,t){const r=new Set;return e.forEach((e=>{if(e.actionName===g.Actions.Star&&e.timestamp>t){const t=(0,b.getMsgKeyFromStarActionIndex)(e.index);r.add(t.toString())}})),r}validateSyncActionValue(e){const t=e.clearChatAction;return(0,E.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e,t){var r=this;_.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{allSupportedSetMutations:n}=t;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,y.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][clear-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var t;const{indexParts:i,value:a}=e,[,s,l,u]=i;if(s&&l&&u||(0,A.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,b.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!r.validateSyncActionValue(a))return __LOG__(3)`[syncd][clear-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const p=(0,o.default)(null===(t=a.clearChatAction)||void 0===t?void 0:t.messageRange,"value.clearChatAction?.messageRange"),f=(0,d.createWid)(s),_=f.toString();if(!(yield(0,v.getChatTable)().get(_)))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:_}};const h=r._getMessageIdsThatWereUnstarredInCurrentPatch(n,e.timestamp);return r._applyMutation(f,p,"1"===l,"0"===u,h,a)}return __LOG__(3)`[syncd][clear-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}clearChat(e,t,n,i){return(0,a.default)((function*(){const{queryAndRemoveMessagesInMessageRange:a}=r(13946),o=yield a(e,t,{skipStarred:!n,skipMessages:i});if((0,y.receiveReactionsEnabled)()&&o.length>0){const t=r(68819).getJobManager;yield t().waitUntilPersisted(T.jobSerializers.deleteReactions(e.toString(),o))}const s=h.ChatCollection.get(e);s&&s.deleteMessages(o)}))()}_applyMutation(e,t,r,n,i,o){var s=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,o).readBuffer();return yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteMedia:n,deleteStarred:r}),a),yield s.clearChat(e,t,r,i),{actionState:g.SyncActionState.Success}}))()}getClearChatMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){let a=yield(0,E.constructForwardMovingMessageRange)(t);const o=i._constructClearChatIndex(t,r,n||!1),c=yield m.default.getPendingMutationsRowsByIndex(["index"],o);if(c.length){var d;const e=c.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(d=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).clearChatAction)||void 0===d?void 0:d.messageRange;t&&(a=(0,E.mergeMessageRanges)(a,t))}const f={timestamp:e,clearChatAction:{messageRange:a}};return{collection:g.CollectionName.RegularHigh,index:o,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,f).readBuffer(),version:i.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.ClearChat}}))()}_constructClearChatIndex(e,t,r){return JSON.stringify([g.Actions.ClearChat,e.toString({legacy:!0}),t?"1":"0",r?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=n(e.binarySyncAction),c=n(t.binarySyncAction),_=e.timestamp,h=t.timestamp,m=(0,o.default)(s.clearChatAction,"pendingMutationValue.clearChatAction"),y=(0,o.default)(c.clearChatAction,"incomingMutationValue.clearChatAction");switch((0,E.compareMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange"))){case E.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case E.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesAreEqual:return _<=h?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,E.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange")),n=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{clearChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete s.id,yield(0,E.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]),o="1"===i[2],s="1"===i[3];return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteStarred:o,deleteMedia:s}),n),r.clearChat(a,t,o)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const M=new P;Object.freeze(M);var O=M;t.default=O},24900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(72441),s=r(45454),l=r(45606),c=r(35673),d=r(19380),u=r(76214),p=r(959),f=r(89835),_=r(66837),h=r(22954);class g extends f.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return(0,a.default)((function*(){const t=[],r=[],n=yield Promise.all(e.map((e=>{try{const a=e.indexParts,[,o]=a;o||(0,h.throwInvalidActionIndex)();const c=(0,s.createUserWid)(o);if("set"===e.operation){var n;const r=e.value.contactAction;if(!r)return __LOG__(3)`contact sync: malformed mutation`,{actionState:l.SyncActionState.Malformed};const a={id:o,name:r.fullName||"",shortName:r.firstName||(null!==(n=(0,p.getShortName)(r.fullName))&&void 0!==n?n:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return t.push(a),d.ContactCollection.add((0,i.default)((0,i.default)({},a),{},{id:c}),{merge:!0}),(0,_.syncNewContact)(c),{actionState:l.SyncActionState.Success}}if("remove"===e.operation){const e=d.ContactCollection.get(c);return null!=e&&e.setNotMyContact(),r.push(c),{actionState:l.SyncActionState.Success}}return __LOG__(3)`contact sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}})));if(yield(0,u.getContactTable)().bulkCreateOrMerge(t),r.length>0){const e=r.map((e=>(0,o.toPhoneUserJid)(e.user)));yield(0,c.setNotAddressBookContacts)(e)}return n}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},56928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=n(r(21084)),h=r(69951),g=r(45606),m=n(r(73407)),y=r(77772),E=r(57701),S=r(19937),v=n(r(11339)),T=r(76214),C=r(6684),A=r(13946),b=r(89835),P=r(22954),M=r(93824);class O extends b.SyncActionBase{constructor(){super(...arguments),this.version=6}validateSyncActionValue(e){const t=e.deleteChatAction;return(0,S.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return _.default.updatePrimaryAllowsAllMutationsFlag("other mutation"),Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,E.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][delete-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var r;const{indexParts:n,value:i}=e,[,a,s]=n;if(a&&s||(0,P.throwInvalidActionIndex)(),!c.default.isWid(a))return(0,M.uploadCriticalEventMetric)(v.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!t.validateSyncActionValue(i))return __LOG__(3)`[syncd][delete-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(r=i.deleteChatAction)||void 0===r?void 0:r.messageRange,"value.deleteChatAction?.messageRange"),u=(0,d.createWid)(a),p=u.toString();return(yield(0,T.getChatTable)().get(p))?t._applyMutation(u,l,"0"===s,i):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:p}}}return __LOG__(3)`[syncd][delete-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}deleteChat(e,t){return(0,a.default)((function*(){const n=h.ChatCollection.get(e);if(t){const i=yield(0,A.queryAndRemoveMessagesInMessageRange)(e,t);if((0,E.receiveReactionsEnabled)()&&i.length>0){const t=r(68819).getJobManager;yield t().waitUntilPersisted(C.jobSerializers.deleteReactions(e.toString(),i))}n&&n.deleteMessages(i)}else yield(0,y.deleteFromStorage)(e),n&&n.delete()}))()}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer();yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:r}),a);const o=yield(0,S.constructMessageRange)(e,!1);switch((0,S.compareMessageRanges)(o,t)){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:case S.MessageRangeEncloseType.RangesNotEnclosing:yield i.deleteChat(e,t);break;default:yield i.deleteChat(e)}return{actionState:g.SyncActionState.Success}}))()}getDeleteChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){let i=yield(0,S.constructForwardMovingMessageRange)(t);const a=n._constructDeleteChatIndex(t,r||!1),o=yield m.default.getPendingMutationsRowsByIndex(["index"],a);if(o.length){var c;const e=o.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(c=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).deleteChatAction)||void 0===c?void 0:c.messageRange;t&&(i=(0,S.mergeMessageRanges)(i,t))}const d={timestamp:e,deleteChatAction:{messageRange:i}};return{collection:g.CollectionName.RegularHigh,index:a,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,d).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.DeleteChat}}))()}_constructDeleteChatIndex(e,t){return JSON.stringify([g.Actions.DeleteChat,e.toString({legacy:!0}),t?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=n(e.binarySyncAction),c=n(t.binarySyncAction),_=e.timestamp,h=t.timestamp,m=(0,o.default)(s.deleteChatAction,"pendingMutationValue.deleteChatAction"),y=(0,o.default)(c.deleteChatAction,"incomingMutationValue.deleteChatAction");switch((0,S.compareMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange"))){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case S.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesAreEqual:return _<=h?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,S.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange")),n=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{deleteChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete s.id,yield(0,S.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]);return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:"1"===i[2]}),n),r.deleteChat(a,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const I=new O;Object.freeze(I);var w=I;t.default=w},41058:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(50073),s=r(381),l=r(92844),c=n(r(65212)),d=n(r(89867)),u=r(84902),p=r(60980),f=r(45606),_=r(57701),h=r(84886),g=n(r(11339)),m=r(76214),y=r(59871),E=r(6684),S=r(89835),v=r(22954),T=r(93824);class C extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return(0,i.default)((function*(){const t=[],n=new Map;yield(0,m.getMessageTable)().bulkGet(e.map((e=>{var t;const[,r,n,i,a]=e.indexParts;return r&&n&&i&&a&&d.default.isWid(r)?null===(t=(0,v.syncKeyToMsgKey)(r,n,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.set(e.id,e)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){const[,r,i,a,o]=e.indexParts;r&&i&&a&&o||(0,v.throwInvalidActionIndex)();const s=(0,v.syncKeyToMsgKey)(r,i,a,o);if(!s)return(0,T.uploadCriticalEventMetric)(g.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:f.SyncActionState.Malformed};const l=n.get(s.toString());if(!l)return{actionState:f.SyncActionState.Orphan,orphanModel:{modelId:s.toString(),modelType:f.SyncModelType.Msg}};t.push(l.id);const c=y.MsgCollection.get(s);return c?c.delete():__LOG__(3)`delete_message_for_me_sync: msg ${s} found in storage but not in collection`,{actionState:f.SyncActionState.Success}}return __LOG__(3)`delete_message_for_me_sync: operation not supported`,{actionState:f.SyncActionState.Unsupported}}catch(e){return{actionState:f.SyncActionState.Failed}}})));if(t.length>0&&(yield(0,h.removeMessagesFromHistory)(t),(0,_.receiveReactionsEnabled)())){const e=new Set;t.forEach((t=>e.add(c.default.fromString(t).remote.toString())));const n=Array.from(e.values()).join(",").toString(),i=r(68819).getJobManager;yield i().waitUntilPersisted(E.jobSerializers.deleteReactions(n,t))}return i}))()}resolveConflicts(e,t){var r,n;const i=e=>(0,u.decodeProtobuf)(s.SyncActionValueSpec,e),o=(0,a.default)(null===(r=i(e.binarySyncAction).deleteMessageForMeAction)||void 0===r?void 0:r.deleteMedia,"decodeValue(localMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia");return!(0,a.default)(null===(n=i(t.binarySyncAction).deleteMessageForMeAction)||void 0===n?void 0:n.deleteMedia,"decodeValue(remoteMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia")&&o?Promise.resolve(f.ConflictResolutionState.SkipRemote):Promise.resolve(f.ConflictResolutionState.SkipRemoteAndDropLocal)}getDeleteForMeMutations(e,t){const r=(0,l.unixTimeMs)();return e.map((e=>{const n={deleteMessageForMeAction:{deleteMedia:t,messageTimestamp:e.t},timestamp:r};return{collection:f.CollectionName.RegularHigh,index:JSON.stringify([f.Actions.DeleteMessageForMe,e.id.remote.toString({legacy:!0}),e.id.id,e.id.fromMe?"1":"0",e.isGroupMsg&&!e.id.fromMe?e.sender.toString({legacy:!0}):"0"]),binarySyncAction:(0,p.encodeProtobuf)(s.SyncActionValueSpec,n).readBuffer(),version:this.version,operation:o.SyncdMutationSyncdOperation.SET,timestamp:r,action:f.Actions.DeleteMessageForMe}}))}}const A=new C;Object.freeze(A);var b=A;t.default=b},12123:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(89867)),s=r(45454),l=r(68638),c=r(45606),d=r(82663),u=r(31912),p=r(905),f=n(r(11339)),_=r(89835),h=r(22954),g=r(93824);class m extends _.SyncActionBase{constructor(){super(...arguments),this.version=c.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,a.default)((function*(){const t=new Set,n=[],_=[],m=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var a;const{indexParts:m,value:y}=e,[,E,S]=m;E&&S||(0,h.throwInvalidActionIndex)();const v=null===(a=y.labelAssociationAction)||void 0===a?void 0:a.labeled;if(null==v)return __LOG__(3)`label jid sync: malformed mutation`,{actionState:c.SyncActionState.Malformed};if(!o.default.isWid(S))return(0,g.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const T=(0,s.createWid)(S),C=T.toString(),A={labelId:E,associationId:C,type:d.LabelAssociationType.Jid};if(v){let e=t.has(C);if(!e){(yield(0,l.getTable)().get(C))&&(t.add(C),e=!0)}const a=r(63183).Chat,o=e?null:new a({id:T});n.push(A),o&&((0,l.getTable)().create((0,i.default)((0,i.default)({},o.toJSON()),{},{id:C})),t.add(C)),o&&r(69951).ChatCollection.add(o),(0,p.addToLabelCollection)(C,[E],u.LabelItemParentType.Chat)}else _.push(A),(0,p.removeLabelFromCollection)(C,E,u.LabelItemParentType.Chat);return{actionState:c.SyncActionState.Success}}return __LOG__(3)`label jid sync: unsupported operation`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return yield(0,d.getTable)().bulkRemove(_.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,d.getTable)().bulkCreateOrReplace(n),m}))()}}const y=new m;Object.freeze(y);var E=y;t.default=E},35096:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(89867)),o=r(45606),s=r(82663),l=r(31912),c=r(905),d=n(r(11339)),u=r(76214),p=r(89835),f=r(22954),_=r(93824);function h(){return(h=(0,i.default)((function*(e){const t=new Set;return yield(0,u.getMessageTable)().bulkGet(e.map((e=>{var t;const[,,r,n,i,o]=e.indexParts;return r&&n&&i&&o&&a.default.isWid(r)?null===(t=(0,f.syncKeyToMsgKey)(r,n,i,o))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&t.add(e.id)})))),t}))).apply(this,arguments)}class g extends p.SyncActionBase{constructor(){super(...arguments),this.version=o.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,i.default)((function*(){const t=[],r=[],n=yield function(){return h.apply(this,arguments)}(e),i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:u}=e,[,p,h,g,m,y]=a;p&&h&&g&&m&&y||(0,f.throwInvalidActionIndex)();const E=null===(i=u.labelAssociationAction)||void 0===i?void 0:i.labeled;if(null==E)return __LOG__(3)`label message sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const S=(0,f.syncKeyToMsgKey)(h,g,m,y);if(!S)return(0,_.uploadCriticalEventMetric)(d.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};if(!n.has(S.toString()))return{actionState:o.SyncActionState.Orphan,orphanModel:{modelId:S.toString(),modelType:o.SyncModelType.Msg}};const v={labelId:p,associationId:S.toString(),type:s.LabelAssociationType.Message};return E?(t.push(v),(0,c.addToLabelCollection)(S.toString(),[p],l.LabelItemParentType.Msg)):(r.push(v),(0,c.removeLabelFromCollection)(S.toString(),p,l.LabelItemParentType.Msg)),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label message sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));return yield(0,s.getTable)().bulkRemove(r.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,s.getTable)().bulkCreateOrReplace(t),i}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},80056:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(45606),s=r(94337),l=r(16770),c=r(89835),d=r(22954);class u extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,a]=r;a||(0,d.throwInvalidActionIndex)();const c=n.labelEditAction;if(!c)return __LOG__(3)`label sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};if(c.deleted)return yield(0,s.getTable)().remove(a),l.LabelCollection.remove(a),{actionState:o.SyncActionState.Success};const{color:u,predefinedId:p}=c,f=null!==(t=c.name)&&void 0!==t?t:"";""===f&&__LOG__(3)`labelEditAction.name is empty`,null==u&&__LOG__(3)`labelEditAction.color is empty`;const _={id:a,name:f,colorIndex:u,predefinedId:p};return yield(0,s.getTable)().createOrReplace(_),l.LabelCollection.add((0,i.default)({},_),{merge:!0}),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const p=new u;Object.freeze(p);var f=p;t.default=f},79171:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),o=n(r(43725)),s=r(53558),l=r(89835);class c extends l.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{value:t}=e,r=t.localeSetting;if(!r)return __LOG__(3)`locale setting sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const n=r.locale;return yield o.default.setLocale(n,s.L10N_PRIORITY.PHONE),{actionState:a.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const d=new c;Object.freeze(d);var u=d;t.default=u},64294:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(64369)),d=n(r(89867)),u=r(45454),p=r(84902),f=r(60980),_=r(38342),h=r(69951),g=r(45606),m=r(19937),y=n(r(11339)),E=r(76214),S=r(89835),v=r(22954),T=r(93824);function C(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:g.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}}}}class A extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}_setRead(e,t){const n=h.ChatCollection.get(e);if(n){const e=r(9609);t?e.markSeen(n):e.markUnseen(n)}}_isChatMarkedUnreadByUser(e){return(0,a.default)((function*(){const t=yield(0,E.getChatTable)().get(e.toString());return(null==t?void 0:t.unreadCount)===c.default.MARKED_AS_UNREAD}))()}validateSyncActionValue(e){const t=e.markChatAsReadAction;return null!=(null==t?void 0:t.read)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var r,n;const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,v.throwInvalidActionIndex)(),!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][mark-chat-as-read]: malformed mutation`,{actionState:g.SyncActionState.Malformed};if(!d.default.isWid(s))return(0,T.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(r=a.markChatAsReadAction)||void 0===r?void 0:r.read,"value.markChatAsReadAction?.read"),c=(0,o.default)(null===(n=a.markChatAsReadAction)||void 0===n?void 0:n.messageRange,"value.markChatAsReadAction?.messageRange"),p=(0,u.createWid)(s),f=p.toString();return(yield(0,E.getChatTable)().get(f))?t._applyMutation(p,l,c,a):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:f}}}return __LOG__(3)`[syncd][mark-chat-as-read]: operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){yield(0,_.removeActiveMessageRange)(e.toString(),(0,_.getActiveRangeAction)("markChatAsRead"));const a=yield(0,m.constructMessageRange)(e,!1),o=(0,m.compareMessageRanges)(a,r),s=(0,f.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer();switch(o){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield(0,_.addActiveMessageRange)(e.toString(),(0,_.getActiveRangeAction)("markChatAsRead"),s),i._setRead(e,t),Promise.resolve(C(e,o));case m.MessageRangeEncloseType.RangesNotEnclosing:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return t&&(yield i._isChatMarkedUnreadByUser(e))&&i._setRead(e,t),Promise.resolve(C(e,o))}}))()}_constructMarkChatAsReadIndex(e){return JSON.stringify([g.Actions.MarkChatAsRead,e.toString({legacy:!0})])}getMarkChatAsReadMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,markChatAsReadAction:{read:t,messageRange:yield(0,m.constructMessageRange)(r,!0)}};return{collection:g.CollectionName.RegularLow,index:n._constructMarkChatAsReadIndex(r),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.MarkChatAsRead}}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,s;const c=e=>(0,p.decodeProtobuf)(l.SyncActionValueSpec,e),d=c(e.binarySyncAction),h=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(d.markChatAsReadAction,"pendingMutationValue.markChatAsReadAction"),v=(0,o.default)(h.markChatAsReadAction,"incomingMutationValue.markChatAsReadAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(n=v.read)&&void 0!==n&&n:null!==(s=S.read)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange")),d=(0,f.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},h),{},{markChatAsReadAction:{read:t,messageRange:c}})).readBuffer(),p=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:d});return delete p.id,yield(0,m.lockForMessageRangeSync)(["chat"],[p],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,u.createWid)(n[1]);return yield(0,_.addActiveMessageRange)(i.toString(),(0,_.getActiveRangeAction)("markChatAsRead"),d),r._setRead(i,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const b=new A;Object.freeze(b);var P=b;t.default=P},19937:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRangeEncloseType=void 0,t.compareMessageRanges=function(e,t){const r=E(e,t),n=E(t,e);if(r&&n)return y.RangesAreEqual;if(r)return y.RangeAEnclosesRangeB;if(n)return y.RangeBEnclosesRangeA;return y.RangesNotEnclosing},t.constructForwardMovingMessageRange=function(){return P.apply(this,arguments)},t.constructMessageRange=S,t.lockForMessageRangeSync=void 0,t.mergeMessageRanges=C,t.validateMessageRange=function(e){if(null==e)return(0,m.uploadCriticalEventMetric)(h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_UNSET),!1;for(const[t,r]of A)if(r(e))return(0,m.uploadCriticalEventMetric)(t),!1;for(const t of e.messages)for(const[e,r]of b)if(r(t))return(0,m.uploadCriticalEventMetric)(e),!1;return!0};var i=n(r(48926)),a=r(8243),o=r(381),s=n(r(89867)),l=r(45454),c=r(84902),d=r(38342),u=r(69702),p=r(45606),f=n(r(73407)),_=r(30986),h=n(r(11339)),g=r(38804),m=r(93824);const y=r(76672).Mirrored(["RangeAEnclosesRangeB","RangeBEnclosesRangeA","RangesAreEqual","RangesNotEnclosing"]);function E(e,t){const r=new Set(e.messages.map((e=>{var t;return null===(t=e.key)||void 0===t?void 0:t.id})));for(let e=0;e<t.messages.length;e++){var n;if(null==t.messages[e].timestamp)if(!r.has(null===(n=t.messages[e].key)||void 0===n?void 0:n.id))return!1}for(let n=0;n<t.messages.length;n++){var i,o,s;if(!r.has(null===(i=t.messages[n].key)||void 0===i?void 0:i.id)&&(0,a.numberOrThrowIfTooLarge)(null!==(o=e.lastMessageTimestamp)&&void 0!==o?o:0)<=(0,a.numberOrThrowIfTooLarge)(null!==(s=t.messages[n].timestamp)&&void 0!==s?s:0))return!1}return!0}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,r){let n=yield(0,_.getLastMessageTimestamp)(e);const i=yield(0,_.getLastSystemMessageTimestamp)(e),{messages:o,newLastMessageTimestamp:s}=yield(0,_.getAdditionalMessages)(e,n,r);if(null!=s&&(n=s),null==n){var l;n=null===(l=o.sort(_.timestampComparison)[o.length-1])||void 0===l?void 0:l.timestamp}const c={messages:o};if(null!=n&&(c.lastMessageTimestamp=n),null!=i&&(null==n||i>(0,a.numberOrThrowIfTooLarge)(n))&&(c.lastSystemMessageTimestamp=i),t&&null==c.lastMessageTimestamp){const t=yield(0,_.getFirstSystemMessageTimestamp)(e);null!=t&&(c.lastMessageTimestamp=t,t===i&&(c.lastSystemMessageTimestamp=void 0))}return c}))).apply(this,arguments)}function T(e,t,r){const n=new Map;return e.concat(t).forEach((e=>{var t,i,o;const s=null!==(t=null===(i=e.key)||void 0===i?void 0:i.id)&&void 0!==t?t:"";if((0,a.numberOrThrowIfTooLarge)(null!==(o=e.timestamp)&&void 0!==o?o:0)>=r){const t=n.get(s);var l,c;if(t)n.set(s,(0,a.numberOrThrowIfTooLarge)(null!==(l=t.timestamp)&&void 0!==l?l:0)<(0,a.numberOrThrowIfTooLarge)(null!==(c=e.timestamp)&&void 0!==c?c:0)?e:t);else n.set(s,e)}})),Array.from(n.values())}function C(e,t){var r,n;const i=(0,a.numberOrThrowIfTooLarge)(null!==(r=e.lastMessageTimestamp)&&void 0!==r?r:0),o=(0,a.numberOrThrowIfTooLarge)(null!==(n=t.lastMessageTimestamp)&&void 0!==n?n:0),s=Math.max(i,o),l={messages:T(e.messages,t.messages,s)};if(0!==s&&(l.lastMessageTimestamp=s),null!=e.lastSystemMessageTimestamp||null!=t.lastSystemMessageTimestamp){var c,d;const r=Math.max((0,a.numberOrThrowIfTooLarge)(null!==(c=e.lastSystemMessageTimestamp)&&void 0!==c?c:0),(0,a.numberOrThrowIfTooLarge)(null!==(d=t.lastSystemMessageTimestamp)&&void 0!==d?d:0));(null==s||r>s)&&(l.lastSystemMessageTimestamp=r)}return l}t.MessageRangeEncloseType=y;const A=[[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET,e=>{let{lastSystemMessageTimestamp:t,lastMessageTimestamp:r}=e;return null!=t&&null!=r&&(0,a.numberOrThrowIfTooLarge)(t)<(0,a.numberOrThrowIfTooLarge)(r)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGES_CROSS_LIMIT,e=>e.messages.filter((e=>null!=e.timestamp)).length>1e3]],b=[[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_UNSET,e=>null==e.key],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.fromMe)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.id)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID,e=>{var t;return!(0,l.isWidlike)(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET,e=>{var t,r,n;return s.default.isGroup(null===(t=e.key)||void 0===t?void 0:t.remoteJid)&&!(null===(r=e.key)||void 0===r?void 0:r.fromMe)&&null==(null===(n=e.key)||void 0===n?void 0:n.participant)}]];function P(){return(P=(0,i.default)((function*(e,t){var r;let n=yield S(e,!0,t);(yield(0,d.getActiveMessageRanges)(e.toString())).forEach((e=>{switch(e.action){case u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:case u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case u.ActiveRangeAction.ClearChatKeepStarredKeepMedia:case u.ActiveRangeAction.DeleteChatDeleteMedia:case u.ActiveRangeAction.DeleteChatKeepMedia:const t=e.actionValue.messageRange;t&&(n=C(n,t));break;case u.ActiveRangeAction.Archive:case u.ActiveRangeAction.MarkChatAsRead:}}));const i=yield M(e);return n.messages=T(n.messages,i,(0,a.numberOrThrowIfTooLarge)(null!==(r=n.lastMessageTimestamp)&&void 0!==r?r:0)),n=(0,_.fixMessageRange)(n),n}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=[];return(yield f.default.getSyncActionsRows(["action"],[p.Actions.DeleteMessageForMe])).forEach((r=>{const n=e.toString({legacy:!0}),i=JSON.parse(r.index);if(5!==i.length)__LOG__(2)`constructForwardMovingMessageRange: delete for me mutation index malformed ${r.index}`;else if(n===i[1]&&r.actionState===p.SyncActionState.Success){var a;const e=null===(a=(0,c.decodeProtobuf)(o.SyncActionValueSpec,r.binarySyncAction).deleteMessageForMeAction)||void 0===a?void 0:a.messageTimestamp;if(null==e)__LOG__(2)`constructForwardMovingMessageRange: deleteMessageForMeAction malformed`;else{const r={remoteJid:i[1],id:i[2],fromMe:"1"===i[3],participant:"0"!==i[4]?i[4]:void 0};t.push({key:r,timestamp:e})}}})),t}))).apply(this,arguments)}t.lockForMessageRangeSync=(e,t,r)=>(0,g.lockForSync)([...e,"message","active-message-ranges"],t,r)},70119:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),o=r(50073),s=r(381),l=r(92844),c=n(r(89867)),d=r(45454),u=r(60980),p=r(45606),f=n(r(11339)),_=r(76214),h=r(72472),g=r(89835),m=r(22954),y=r(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,i]=r;if(i||(0,m.throwInvalidActionIndex)(),!c.default.isWid(i))return(0,y.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};const o=n.muteAction,s=null===(t=n.muteAction)||void 0===t?void 0:t.muted,u=(0,a.maybeNumberOrThrowIfTooLarge)(null==o?void 0:o.muteEndTimestamp);if(null==s||s&&null==u)return __LOG__(3)`mute chat sync: malformed mutation`,{actionState:p.SyncActionState.Malformed};const g=(0,d.createWid)(i);if(!(yield(0,_.getChatTable)().get(g.toString())))return{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:g.toString()}};const E=null!=u?u:0,S=E>0&&E<(0,l.unixTimeMs)()?0:Math.floor(E/1e3);return yield(0,_.getChatTable)().merge(g.toString(),{muteExpiration:S}),h.MuteCollection.add({id:g,expiration:S},{merge:!0}),{actionState:p.SyncActionState.Success}}return __LOG__(3)`mute chat sync: operation not supported`,{actionState:p.SyncActionState.Unsupported}}catch(e){return{actionState:p.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}generateMuteMutation(e,t){const r=void 0!==t&&0!==t,n=(0,l.unixTimeMs)();let i=t;-1!==i&&(i*=1e3);const a={timestamp:n,muteAction:{muted:r,muteEndTimestamp:i}};return{collection:p.CollectionName.RegularHigh,index:JSON.stringify([p.Actions.Mute,e.toString({legacy:!0})]),operation:o.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,u.encodeProtobuf)(s.SyncActionValueSpec,a).readBuffer(),timestamp:n,action:p.Actions.Mute}}}const S=new E;Object.freeze(S);var v=S;t.default=v},34610:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(60980),l=r(86945),c=r(22683),d=r(45606),u=r(7293),p=r(36677),f=r(89835),_=r(38804),h=r(31515);class g extends f.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,l.getABPropConfigValue)("nux_sync"))return __LOG__(3)`NuxSync: nux_sync ab prop required`,e.map((()=>({actionState:d.SyncActionState.Unsupported})));const t=[],r=e.map((e=>{if("set"!==e.operation)return __LOG__(3)`NuxSync: operation not supported ${e}`,{actionState:d.SyncActionState.Malformed};const r=e.indexParts[1];return(0,h.isString)(r)?(t.push(r),{actionState:d.SyncActionState.Success}):(__LOG__(3)`NuxSync: malformed mutation ${e}`,{actionState:d.SyncActionState.Malformed})}));return t.length&&(__LOG__(2)`NuxSync: adding keys to local store ${t}`,(0,p.addToLocalNuxSyncList)(t)),r}))()}_createNuxMutation(e,t){return{collection:d.CollectionName.RegularLow,index:JSON.stringify([d.Actions.Nux,e]),binarySyncAction:(0,s.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:t}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:t,action:d.Actions.Nux}}markNuxAsSeen(e){var t=this;return(0,i.default)((function*(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!0===(0,l.getABPropConfigValue)("nux_sync")){(0,p.addToLocalNuxSyncList)([e]);const r=t._createNuxMutation(e,c.Clock.globalUnixTimeMilliseconds());yield(0,_.lockForSync)([],[r],(()=>Promise.resolve()))}}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},36014:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),o=n(r(45095)),s=r(50073),l=r(381),c=r(92844),d=n(r(89867)),u=r(45454),p=r(84902),f=r(60980),_=n(r(21084)),h=n(r(74362)),g=r(45606),m=n(r(73407)),y=r(9025),E=r(57701),S=n(r(11339)),v=r(76214),T=r(89835),C=r(38804),A=r(22954),b=r(93824);class P extends T.SyncActionBase{constructor(){super(...arguments),this.version=5}applyMutations(e){var t=this;return(0,i.default)((function*(){_.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const r=[];for(let n=0;n<e.length;n++)r.push(yield t.applyMutation(e[n]));return r}))()}applyMutation(e){var t=this;return(0,i.default)((function*(){if("remove"===e.operation)return __LOG__(3)`syncd: pin_chat_sync: REMOVE not supported`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if(!(0,E.pinChatSyncEnabled)())return __LOG__(3)`syncd: pin_chat_sync: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});const{indexParts:r,value:n,timestamp:i}=e,[,a]=r;try{if(a||(__LOG__(3)`syncd: pin_chat_sync: missing chatId in index`,(0,A.throwInvalidActionIndex)()),!d.default.isWid(a))return(0,b.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const e=(0,u.createWid)(a),{pinAction:r}=n;if(null==r)return __LOG__(3)`syncd: pin_chat_sync: missing pinAction`,Promise.resolve({actionState:g.SyncActionState.Malformed});const{pinned:o}=r;if(null==o)return __LOG__(3)`syncd: pin_chat_sync: missing pinned field`,Promise.resolve({actionState:g.SyncActionState.Malformed});if(null==(yield(0,v.getChatTable)().get(e.toString())))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}};if(!o)return yield t.applyUpdates([{wid:e,pinned:!1,timestamp:i}]),{actionState:g.SyncActionState.Success};const s=yield t.getLocalPins();if(s.some((t=>t.chatId.toString()===e.toString())))return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};if(s.length<3)return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};const l=s.reduce(((e,t)=>t.timestamp<e.timestamp?t:e)),c=[],p=l.timestamp<i?l.chatId:e;return p===l.chatId&&c.push({wid:l.chatId,pinned:!1,timestamp:i},{wid:e,pinned:!0,timestamp:i}),yield Promise.all([t.applyUpdates(c),t.createPendingUnpin(p,i)]),Promise.resolve({actionState:g.SyncActionState.Success})}catch(e){return{actionState:g.SyncActionState.Failed}}}))()}applyUpdates(e){return(0,i.default)((function*(){if(0===e.length)return;const t=e.map((e=>{let{wid:t,pinned:r,timestamp:n}=e;const i={id:t.toString(),pin:r?n:0};return r&&(i.archive=!1),i}));yield Promise.all(t.map((e=>(0,v.getChatTable)().merge(e.id,e)))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield(0,y.getExisting)(e.wid);null!=t&&(t.pin=e.pinned?e.timestamp:0,e.pinned&&(t.archive=!1))}));return function(){return e.apply(this,arguments)}}()))}))()}createPendingUnpin(e,t){var r=this;return(0,i.default)((function*(){yield m.default.appendPendingMutationsRows([r.getPinMutation(t,!1,e)])}))()}getLocalPins(){return(0,i.default)((function*(){const e=(0,v.getChatTable)().all().then((e=>e.filter((e=>null!=e.pin&&e.pin>0)).map((e=>[e.id,(0,o.default)(e.pin,"chatRow.pin")])))),t=m.default.getSyncActionsRows(["action"],[g.Actions.Pin]).then((e=>e.filter((e=>e.actionState===g.SyncActionState.Orphan)).map((e=>{var t;const r=JSON.parse(e.index);if(r.length<2)return null;const n=r[1],i=(0,p.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction);return null!=i.pinAction&&i.pinAction.pinned?[n,(0,a.numberOrThrowIfTooLarge)(null!==(t=i.timestamp)&&void 0!==t?t:0)]:null})).filter(Boolean))),[r,n]=yield Promise.all([e,t]);return[...r,...n].map((e=>{let[t,r]=e;return{chatId:(0,u.createWid)(t),timestamp:r}}))}))()}unpinAll(){var e=this;return(0,i.default)((function*(){const t=yield e.getLocalPins(),r=(0,c.unixTimeMs)(),n=t.map((t=>{let{chatId:n}=t;return e.getPinMutation(r,!1,n)}));return(0,C.lockForSync)(["chat"],n,(()=>Promise.resolve())).then((()=>e.applyUpdates(t.map((e=>{let{chatId:t}=e;return{wid:t,pinned:!1,timestamp:r}})))))}))()}getMutationsForPin(e,t,r){var n=this;return(0,i.default)((function*(){const i=[n.getPinMutation(e,t,r)];return t&&i.push(yield h.default.getArchiveChatMutation(e,!1,r)),i}))()}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}getPinMutation(e,t,r){return{collection:g.CollectionName.RegularLow,index:JSON.stringify([g.Actions.Pin,r.toString({legacy:!0})]),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,{timestamp:e,pinAction:{pinned:t}}).readBuffer(),version:this.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.Pin}}}const M=new P;Object.freeze(M);var O=M;t.default=O},44720:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(86945),s=r(45606),l=r(34771),c=r(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,o.getABPropConfigValue)("primary_feature_sync"))return __LOG__(3)`primary feature sync: operation not supported`,e.map((()=>({actionState:s.SyncActionState.Unsupported})));let t;const r=e.map((e=>{var r;if("set"!==e.operation)return __LOG__(3)`primary feature sync: operation not supported`,{actionState:s.SyncActionState.Malformed};return null==(null===(r=e.value.primaryFeature)||void 0===r?void 0:r.flags)?(__LOG__(3)`primary feature sync: malformed mutation`,{actionState:s.SyncActionState.Malformed}):((null==t||e.timestamp>t.timestamp)&&(t=e),{actionState:s.SyncActionState.Success})}));if(null!=t){var n;const e=(0,a.default)(null===(n=t.value.primaryFeature)||void 0===n?void 0:n.flags,"latestMutation.value.primaryFeature?.flags");l.PrimaryFeatures.setPrimaryFeatures(e)}return r}))()}}const u=new d;Object.freeze(u);var p=u;t.default=p},42339:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(60980),l=r(45606),c=r(58597),d=n(r(11339)),u=n(r(45723)),p=r(53006),f=r(89835);class _ extends f.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return(0,i.default)((function*(){return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{value:n}=e;let i=null===(t=n.pushNameSetting)||void 0===t?void 0:t.name;i||(__LOG__(3)`push name sync: empty pushname`,(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),i=""),(0,u.default)(i),(0,p.setPushnameLocally)(i),yield(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);const a=r(48277).default;return a.isSyncDCriticalDataSyncInProcess()&&(a.setSyncDCriticalSynced(),yield a.setSyncDCriticalDataSyncCompleted()),Promise.resolve({actionState:l.SyncActionState.Success})}return __LOG__(3)`push name sync: operation not supported`,Promise.resolve({actionState:l.SyncActionState.Unsupported})}catch(e){return(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}))()}getPushnameMutation(e,t){return{collection:l.CollectionName.CriticalBlock,index:JSON.stringify([l.Actions.SettingPushName]),binarySyncAction:(0,s.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:e,pushNameSetting:{name:t}}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:e,action:l.Actions.SettingPushName}}}const h=new _;Object.freeze(h);var g=h;t.default=g},60282:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),o=r(76214),s=r(99662),l=r(89835),c=r(22954);class d extends l.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{indexParts:t,value:r}=e,[,n]=t;n||(0,c.throwInvalidActionIndex)();const i=r.quickReplyAction;if(!i)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};if(i.deleted)return yield(0,o.getQuickReplyTable)().remove(n),s.QuickReplyCollection.remove(n),{actionState:a.SyncActionState.Success};const{shortcut:l,message:d}=i;if(!l||!d)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const u=i.keywords||[],p=i.count||0;return yield(0,o.getQuickReplyTable)().createOrReplace({id:n,shortcut:l,count:p,message:d,keywords:u}),s.QuickReplyCollection.add({id:n,shortcut:l,message:d,keywords:u,count:p},{merge:!0}),{actionState:a.SyncActionState.Success}}return __LOG__(3)`quick replies sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const u=new d;Object.freeze(u);var p=u;t.default=p},40108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(92844),l=r(60980),c=r(45606),d=n(r(73407)),u=r(837),p=r(89835);class f extends p.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const r=null===(t=e.value.keyExpiration)||void 0===t?void 0:t.expiredKeyEpoch;return null==r?(__LOG__(4,void 0,new Error)`sentinel mutation sync: malformed mutation`,{actionState:c.SyncActionState.Malformed}):(yield d.default.expireSyncKey(r),{actionState:c.SyncActionState.Success})}return __LOG__(3)`sentinel mutation sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}getSentinelMutations(){var e=this;return(0,i.default)((function*(){const t=(0,s.unixTimeMs)(),r=Array.from(c.CollectionName.members()),n={keyExpiration:{expiredKeyEpoch:(yield(0,u.getNewestKeyPair)()).keyEpoch},timestamp:t};return r.map((r=>({collection:r,index:JSON.stringify([c.Actions.Sentinel,r]),operation:a.SyncdMutationSyncdOperation.SET,version:e.version,binarySyncAction:(0,l.encodeProtobuf)(o.SyncActionValueSpec,n).readBuffer(),timestamp:t,action:c.Actions.Sentinel})))}))()}}const _=new f;Object.freeze(_);var h=_;t.default=h},21263:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(92844),l=n(r(89867)),c=r(60980),d=r(45606),u=r(84886),p=n(r(11339)),f=r(76214),_=r(59871),h=r(19011),g=r(89835),m=r(22954),y=r(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t,r,n,i]=e.indexArr;t&&r&&n&&i||(0,m.throwInvalidActionIndex)();const a=(0,m.syncKeyToMsgKey)(t,r,n,i);return{chatJid:t,messageKey:null==a?void 0:a.toString()}}applyMutations(e){return(0,i.default)((function*(){const t=[],r=[],n=new Set;yield(0,f.getMessageTable)().bulkGet(e.map((e=>{var t;const[,r,n,i,a]=e.indexParts;return r&&n&&i&&a&&l.default.isWid(r)?null===(t=(0,m.syncKeyToMsgKey)(r,n,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.add(e.id)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:o}=e,[,s,l,c,u]=a;s&&l&&c&&u||(0,m.throwInvalidActionIndex)();const f=null===(i=o.starAction)||void 0===i?void 0:i.starred;if(null==f)return __LOG__(3)`star message sync: malformed mutation`,{actionState:d.SyncActionState.Malformed};const g=(0,m.syncKeyToMsgKey)(s,l,c,u);if(!g)return(0,y.uploadCriticalEventMetric)(p.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:d.SyncActionState.Malformed};if(!n.has(g.toString()))return{actionState:d.SyncActionState.Orphan,orphanModel:{modelId:g.toString(),modelType:d.SyncModelType.Msg}};f?t.push(g.toString()):r.push(g.toString());const E=_.MsgCollection.get(g);return E?(E.star=f,E.star?(0,h.addStarredMsgs)([E]):(0,h.removeStarredMsgs)([E])):__LOG__(3)`star_message_sync: msg ${g} found in storage but not in collection`,{actionState:d.SyncActionState.Success}}return __LOG__(3)`star message sync: operation not supported`,{actionState:d.SyncActionState.Unsupported}}catch(e){return{actionState:d.SyncActionState.Failed}}})));return yield Promise.all([(0,u.starMessages)(t),(0,u.unstarMessages)(r)]),i}))()}getStarMessageMutations(e,t){const r=(0,s.unixTimeMs)();return e.map((e=>({collection:d.CollectionName.RegularHigh,index:(0,y.constructStarMsgKey)(e),operation:a.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,c.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:r,starAction:{starred:t}}).readBuffer(),timestamp:r,action:d.Actions.Star})))}}const S=new E;Object.freeze(S);var v=S;t.default=v},89835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionBase=void 0;var n=r(45606);t.SyncActionBase=class{getChatJidAndMessageKey(){}resolveConflicts(e,t){return t.timestamp>=e.timestamp?Promise.resolve(n.ConflictResolutionState.ApplyRemoteAndDropLocal):Promise.resolve(n.ConflictResolutionState.SkipRemote)}dropMutationDueToCrossIndexConflict(){return Promise.resolve(!1)}}},22954:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncKeyToMsgKey=function(e,t,r,n){let l;if(!a.default.isWid(e))return __LOG__(3)`syncKeyToMsgKey: invalid remote value: ${e.replace(d,"#")}`,null;if(!(0,o.createWid)(e).isUser()){if("0"===r&&!a.default.isWid(n))return __LOG__(3)`syncKeyToMsgKey: invalid participant value: ${n.replace(d,"#")}`,null;l="1"===r?(0,s.getMeUser)():(0,o.createWid)(n)}return new i.default({fromMe:"1"===r,remote:(0,o.createWid)(e),id:t,participant:l})},t.throwInvalidActionIndex=function(){throw new l.default.MdFatalError({mdFatalErrorCode:l.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX}).commit(),new c.SyncdFatalError("invalid action index")};var i=n(r(65212)),a=n(r(89867)),o=r(45454),s=r(99234),l=n(r(11339)),c=r(85156);const d=/\d(?=)/gm},11681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(92844),o=r(45606),s=r(76214);class l{static loadStatesFromDb(){var e=this;return(0,i.default)((function*(){(yield(0,s.getCollectionVersionTable)().all()).forEach((t=>e.collectionStates.set(t.collection,{collection:t.collection,state:t.state,finiteFailureStartTime:t.finiteFailureStartTime})))}))()}static persistToDb(){const e=[];return this.collectionStates.forEach((t=>e.push(t))),__LOG__(2)`syncd: state machine persistToDb. states:`,e.forEach((e=>{__LOG__(2)`syncd: ${e.collection}: ${e.state}`})),(0,s.getCollectionVersionTable)().bulkCreateOrMerge(e)}static clean(){this.collectionStates=new Map}static getCollectionState(e){const t=this.collectionStates.get(e);return t?t.state:(this.moveCollectionsToUpToDate([e]),o.CollectionSyncState.UpToDate)}static getCollectionsInStateDirty(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Dirty&&e.push(t.collection)})),e}static getCollectionsInStateRetry(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.FailingFiniteRetry&&e.push(t.collection)})),e}static getCollectionsInStateFatal(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Fatal&&e.push(t.collection)})),e}static getCollectionsInStateBlocked(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Blocked&&e.push(t.collection)})),e}static moveCollectionsToUpToDate(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})))}static moveCollectionsToDirty(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Dirty,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static moveCollectionsToFiniteRetry(e){e.forEach((e=>{var t,r;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:null!==(t=null===(r=this.collectionStates.get(e))||void 0===r?void 0:r.finiteFailureStartTime)&&void 0!==t?t:(0,a.unixTimeMs)()})}))}static moveCollectionsToFatal(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Fatal})))}static moveCollectionsToBlocked(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Blocked,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static getExpiredCollections(){const e=[];return this.collectionStates.forEach((t=>{if(t.state===o.CollectionSyncState.FailingFiniteRetry){let r;null==t.finiteFailureStartTime?(r=1/0,__LOG__(3)`Collection ${t.collection} is in finite retry state with no failure start time`):r=t.finiteFailureStartTime;r+o.FINITE_FAILURE_EXPIRY_DURATION<(0,a.unixTimeMs)()&&e.push(t.collection)}})),e}}t.default=l,l.collectionStates=new Map},45606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncModelType=t.SyncDataType=t.SyncActionState=t.MIN_PATCH_SIZE=t.MIN_INLINE_MUTATIONS=t.MAX_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.LABEL_ASSOCIATION_SYNC_VERSION=t.FINITE_FAILURE_EXPIRY_DURATION=t.DEFAULT_COLLECTION_VERSION=t.ConflictResolutionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.BACKOFF_MIN_TIMEOUT=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_BASE=t.Actions=void 0;var n=r(92844);t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;const i=2*n.DAY_MILLISECONDS;t.FINITE_FAILURE_EXPIRY_DURATION=i;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;const a=r(76672)({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature",Nux:"nux"});t.Actions=a;const o=r(76672)({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=o;const s=r(76672).Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=s;const l=r(76672).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=l;const c=r(76672).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=c;const d=r(76672)({Msg:"Msg",Chat:"Chat"});t.SyncModelType=d;const u=r(76672).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=u;const p=r(76672).Mirrored(["Patch","Snapshot"]);t.SyncDataType=p},58597:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logCriticalBootstrapStageIfNecessary=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(86945),s=r(49801),l=n(r(11339));function c(){return(c=(0,i.default)((function*(e){(yield(0,o.getABPropConfigValue)("md_app_state_critical_data_processing_logging"))&&r(48277).default.isSyncDCriticalDataSyncInProcess()&&new l.default.MdBootstrapAppStateCriticalDataProcessing({bootstrapAppStateDataStage:e,mdSessionId:yield s.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,a.unixTimeMs)()}).commit()}))).apply(this,arguments)}},73407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(899),o=(r(381),r(84902),r(76214)),s=r(99069);const l=new ArrayBuffer(a.KEY_LENGTH_BYTES);t.default=class{static getAllPendingMutationsRows(){return(0,o.getPendingMutationsTable)().all()}static performTransaction(e){return(0,s.getStorage)().lock(["collection-version","pending-mutations","sync-actions"],e)}static getPendingMutationsRows(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static getPendingMutationsRowsById(e){return(0,i.default)((function*(){return(yield(0,o.getPendingMutationsTable)().bulkGet(e)).filter(Boolean)}))()}static getPendingMutationsRowsByIndex(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static appendPendingMutationsRows(e){return(0,o.getPendingMutationsTable)().bulkCreate(e)}static bulkUpdatePendingMutationsKeyId(e){return(0,o.getPendingMutationsTable)().bulkCreateOrMerge(e)}static bulkRemovePendingMutations(e){return(0,o.getPendingMutationsTable)().bulkRemove(e)}static hasPendingMutationForCollection(e){return(0,o.getPendingMutationsTable)().equals(["collection"],e).then((e=>e.length>0))}static getCollectionVersion(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return null==t?void 0:t.version}))()}static getCollectionVersions(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().bulkGet(e);return new Map(e.map(((e,r)=>{var n;return[e,null===(n=t[r])||void 0===n?void 0:n.version]})))}))()}static setCollectionVersion(e,t,r){return(0,o.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:r})}static getLtHash(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return(null==t?void 0:t.ltHash)||l}))()}static getAllCollectionLtHashes(){return(0,i.default)((function*(){return(yield(0,o.getCollectionVersionTable)().all()).map((e=>({collection:e.collection,ltHash:e.ltHash})))}))()}static getSyncAction(e){return(0,o.getSyncActionsTable)().get(e)}static getSyncActionsRows(e,t){return(0,o.getSyncActionsTable)().anyOf(e,t)}static setSyncAction(e){return(0,o.getSyncActionsTable)().createOrReplace(e)}static setSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrReplace(e)}static updateSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrMerge(e)}static deleteSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkRemove(e)}static getSyncKey(e){return(0,o.getSyncKeysTable)().get(e)}static getAllSyncKeys(){return(0,o.getSyncKeysTable)().all()}static createSyncKey(e){return(0,o.getSyncKeysTable)().create(e)}static getSyncKeyData(e){return(0,o.getSyncKeysTable)().get(e)}static expireSyncKey(e){return(0,i.default)((function*(){(yield(0,o.getSyncKeysTable)().equals(["keyEpoch"],e)).forEach((e=>(0,o.getSyncKeysTable)().merge(e.keyId,{keyId:e.keyId,timestamp:0})))}))()}static getMissingKey(e){return(0,o.getMissingKeysTable)().get(e)}static getMissingKeyCount(){return(0,o.getMissingKeysTable)().count()}static bulkGetMissingKeys(e){return(0,o.getMissingKeysTable)().bulkGet(e)}static getAllMissingKeys(){return(0,o.getMissingKeysTable)().all()}static bulkRemoveMissingKeys(e){return(0,o.getMissingKeysTable)().bulkRemove(e)}static createOrUpdateMissingKeys(e){return(0,o.getMissingKeysTable)().bulkCreateOrMerge(e)}}},1377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkLtHash=function(){return O.apply(this,arguments)},t.computeLtHash=P,t.computeLtHashAndValidatePatch=function(){return S.apply(this,arguments)},t.computeLtHashAndValidateSnapshot=function(){return E.apply(this,arguments)},t.computeOutgoingSnapshotAndPatchMacs=function(){return b.apply(this,arguments)},t.logMacsInSnapshot=D;var i=n(r(48926)),a=r(899),o=r(7589),s=r(50073),l=r(62109),c=r(63109),d=r(85156),u=r(45606),p=n(r(73407)),f=r(68254),_=r(837),h=n(r(11339)),g=r(85156);function m(e,t){return`${e.slice(-16)}:${(0,c.arrayBufferToHexPadded)(t).slice(-16)}`}const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){const{mac:r,version:n,keyId:i,records:o}=t,s=yield(0,_.getKeyData)(i.id);if(!s)throw new g.SyncdMissingKeyError;const d=new Map(o.map((e=>[(0,c.arrayBufferToHexPadded)(e.index.blob),(0,l.valueMacFromIndexAndValueCipherText)(e.value.blob)])));__LOG__(2)`syncd:
${e} snapshot macsToAdd:
    ${Array.from(d.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}`;const u=yield a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(d.values())),{snapshotMacKey:p}=yield(0,l.generateEncryptionKeys)(s),f=(0,c.to64BitNetworkOrder)(n.version),h=(0,c.toUtf8)(e).buffer;return __LOG__(2)`syncd: validating snapshot mac for ${e} snapshot v${n.version}:
ltHash: ${(0,c.arrayBufferToHexPadded)(u)}
encoded version: ${(0,c.arrayBufferToHexPadded)(f)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(h)}
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(r)}`,yield v(e,r,p,u,f,h,!0,o.length,t.version.version),u}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r){const{version:n,mutations:i,snapshotMac:s,patchMac:u,keyId:f}=t,h=f.id,m=yield(0,_.getKeyData)(h);if(!m)throw new g.SyncdMissingKeyError;const{snapshotMacKey:y,patchMacKey:E}=yield(0,l.generateEncryptionKeys)(m),S=i.map((e=>({operation:e.operation,indexMac:e.record.index.blob,valueMac:(0,l.valueMacFromIndexAndValueCipherText)(e.record.value.blob)}))),T=yield P(e,S),A=(0,c.to64BitNetworkOrder)(n.version),b=(0,c.toUtf8)(e).buffer;__LOG__(2)`syncd: validating snapshot and patch mac for ${e} v${n.version}:
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(s)}
expected patchMAC: ${(0,c.arrayBufferToHexPadded)(u)}
encoded version: ${(0,c.arrayBufferToHexPadded)(A)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(b)}
key ID: ${(0,c.arrayBufferToHexPadded)(h)}`;try{yield C(e,u,E,s,S.map((e=>e.valueMac)),A,b,i.length,n.version),yield v(e,s,y,T,A,b,!1,i.length,n.version,r)}catch(t){if(yield D(e),t instanceof g.SyncdFatalError){var M;const t=null!==(M=yield p.default.getCollectionVersion(e))&&void 0!==M?M:0;if(t!==n.version-1){const r=t>n.version-1?"greater-than-expected":"less-than-expected";throw __LOG__(3,void 0,void 0,!0)`syncd: ${e} patch v${n.version} !== current ${e} version (v${t}) - 1`,SEND_LOGS(`syncd-version-check-error-local-version-${r}`),new d.SyncdVersionCheckError}const r=yield p.default.getLtHash(e);if((0,o.areBuffersEqual)(r,a.EMPTY_LT_HASH))throw __LOG__(3,void 0,void 0,!0)`syncd: empty local lthash found when processing ${e} patch v${n.version}`,SEND_LOGS("syncd-empty-lthash-on-mac-mismatch"),new d.SyncdRetryableError("empty lthash")}throw t}return T}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i,a,s,c,d,u){const p=yield(0,l.generateSnapshotMac)(r,n,i,a);if(!(0,o.areBuffersEqual)(p,t)){let t=s?h.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:h.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH;throw s||!0!==u||(t=h.default.MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES),yield(0,f.uploadFatalErrorMetric)(t,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate snapshot mac.`,SEND_LOGS("syncd: unable to validate snapshot mac."),new g.SyncdFatalError("unable to validate snapshot mac")}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i,a,s,c,d){const u=yield(0,l.generatePatchMac)(r,n,i,a,s);if(!(0,o.areBuffersEqual)(u,t))throw yield(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate patch mac.`,SEND_LOGS("syncd: unable to validate patch mac."),new g.SyncdFatalError("unable to validate patch mac")}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,n){const i=((yield p.default.getCollectionVersion(e))||u.DEFAULT_COLLECTION_VERSION)+1,{patchMacKey:a,snapshotMacKey:o}=yield(0,l.generateEncryptionKeys)(n),s=(0,c.to64BitNetworkOrder)(i),d=(0,c.toUtf8)(e).buffer,f=yield(0,l.generateSnapshotMac)(o,t,s,d),_=yield(0,l.generatePatchMac)(a,f,r.map((e=>e.valueMac)),s,d);return __LOG__(2)`syncd: computing snapshot and patch macs for outgoing patch ${e} v${i}:
encoded version: ${(0,c.arrayBufferToHexPadded)(s)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(d)}
snapshotMAC: ${(0,c.arrayBufferToHexPadded)(f)}
patchMAC: ${(0,c.arrayBufferToHexPadded)(_)}`,{snapshotMac:f,patchMac:_}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){const r=yield p.default.getLtHash(e),n=yield w(t.map((e=>e.indexMac))),i=new Map,o=new Map,l=new Map;t.forEach((t=>{const{indexMac:r,valueMac:a,operation:d}=t,u=y.decode(r),p=n.get(u);p?d===s.SyncdMutationSyncdOperation.REMOVE?o.set((0,c.arrayBufferToHexPadded)(r),p):l.set((0,c.arrayBufferToHexPadded)(r),p):d===s.SyncdMutationSyncdOperation.REMOVE&&(__LOG__(3,void 0,void 0,!0)`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e}:
${(0,c.arrayBufferToHexPadded)(r).slice(-16)}`,SEND_LOGS(`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e}`)),d===s.SyncdMutationSyncdOperation.SET&&i.set((0,c.arrayBufferToHexPadded)(r),a)}));const d=yield a.LT_HASH_ANTI_TAMPERING.subtractThenAdd(r,Array.from(i.values()),Array.from(o.values()).concat(Array.from(l.values())));return __LOG__(2)`syncd: computing ltHash for ${e}:
currentLtHash: ${(0,c.arrayBufferToHexPadded)(r)}
macsToAdd:
    ${Array.from(i.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
macsToRemove:
    ${Array.from(o.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
macsToOverwrite (also remove):
    ${Array.from(l.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
newLtHash: ${(0,c.arrayBufferToHexPadded)(d)}`,d}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=[];yield p.default.performTransaction((0,i.default)((function*(){const t=yield p.default.getAllCollectionLtHashes();yield Promise.all(t.map(function(){var t=(0,i.default)((function*(t){let{collection:r,ltHash:n}=t;const i=yield p.default.getSyncActionsRows(["collection"],[r]);e.push({collection:r,ltHash:n,mutations:i})}));return function(){return t.apply(this,arguments)}}()))}))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){let{collection:t,ltHash:r,mutations:n}=e;const i=yield I(n);(0,o.areBuffersEqual)(r,i)||(__LOG__(4,!0,new Error,!0)`syncd: failed LtHash check for ${t}`,SEND_LOGS("LtHash check failed"))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function I(e){const t=new Map(e.map((e=>[(0,c.arrayBufferToHexPadded)(e.indexMac),e.valueMac])));return a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(t.values()))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=yield p.default.getSyncActionsRows(["indexMac"],e);return new Map(t.map((e=>[y.decode(e.indexMac),e.valueMac])))}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e){const[t,r]=yield p.default.performTransaction((0,i.default)((function*(){return[yield p.default.getCollectionVersion(e),yield p.default.getSyncActionsRows(["collection"],[e])]})));if(__LOG__(2)`syncd: current snapshot ${e} v${t} with ${r.length} mutations:`,r.length>100)return;r.reduce(((e,t,r)=>(r%20==0&&e.push(""),e[e.length-1]+=m((0,c.arrayBufferToHexPadded)(t.indexMac),t.valueMac)+" | ",e)),[]).forEach((e=>__LOG__(2)`|${e}`))}))).apply(this,arguments)}},2161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.maxSupportedVersion=t.ActionHandlers=void 0;var i=n(r(6162)),a=n(r(21084)),o=n(r(74362)),s=n(r(28464)),l=n(r(29867)),c=r(45606),d=n(r(24900)),u=n(r(56928)),p=n(r(41058)),f=n(r(12123)),_=n(r(35096)),h=n(r(80056)),g=n(r(79171)),m=n(r(64294)),y=n(r(70119)),E=n(r(34610)),S=n(r(36014)),v=n(r(44720)),T=n(r(42339)),C=n(r(60282)),A=n(r(40108)),b=n(r(21263));const P=new Map([[c.Actions.Star,b.default],[c.Actions.Contact,d.default],[c.Actions.Mute,y.default],[c.Actions.LabelEdit,h.default],[c.Actions.LabelMessage,_.default],[c.Actions.LabelJid,f.default],[c.Actions.QuickReply,C.default],[c.Actions.LocaleSetting,g.default],[c.Actions.SettingPushName,T.default],[c.Actions.Archive,o.default],[c.Actions.MarkChatAsRead,m.default],[c.Actions.ClearChat,l.default],[c.Actions.DeleteMessageForMe,p.default],[c.Actions.Sentinel,A.default],[c.Actions.UnarchiveChatsSetting,s.default],[c.Actions.Pin,S.default],[c.Actions.DeleteChat,u.default],[c.Actions.AndroidUnsupportedActions,a.default],[c.Actions.PrimaryFeature,v.default],[c.Actions.Nux,E.default]]);t.ActionHandlers=P;t.maxSupportedVersion=()=>(0,i.default)(Array.from(P.values()).map((e=>e.version)))},29938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAppStateSyncResponse=function(){return U.apply(this,arguments)},t.applyIndividualMutations=function(){return G.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),o=n(r(89734)),s=r(8243),l=n(r(45095)),c=r(50073),d=r(381),u=r(92844),p=r(84902),f=r(2161),_=n(r(21084)),h=r(1377),g=r(45606),m=r(58597),y=n(r(73407)),E=r(58743),S=r(68254),v=r(84051),T=r(49801),C=n(r(11339)),A=r(59037),b=r(11540),P=r(85156),M=r(93824),O=r(6954),I=r(72466),w=n(r(89453)),R=n(r(78375)),D=r(35377),N=r(62274);const L=["indexMac","valueMac"],k=new ArrayBuffer(128);function G(){return(G=(0,a.default)((function*(e){if(0===e.length)return Promise.resolve();__LOG__(2)`syncd: start applyIndividualMutations`;const t=(0,O.syncActionsToDecryptedMutation)(e).reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.collection))&&void 0!==r?r:[];return n.push(t),e.set(t.collection,n),e}),new Map),r=Array.from(t.keys()).map(function(){var e=(0,a.default)((function*(e){__LOG__(2)`syncd: apply individual mutations for collection ${e}`;const r=t.get(e);if(void 0===r)return;const{setMutationsToPersist:n,pendingMutationsToDrop:o}=yield z(e,r,!0),s=n.map((e=>{const{indexMac:t,valueMac:r}=e;return(0,i.default)(e,L)}));__LOG__(2)`syncd: end apply individual mutations for collection ${e}`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.updateSyncActionRows(s),yield y.default.bulkRemovePendingMutations(o)}))),__LOG__(2)`syncd: end update db after apply individual mutations for collection ${e}`}));return function(){return e.apply(this,arguments)}}());yield Promise.all(r),__LOG__(2)`syncd: end applyIndividualMutations`}))).apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e,t){const{name:r,version:n,patches:i,snapshot:a,syncedPendingMutationsId:o,syncedEncryptedMutations:s}=e;__LOG__(2)`syncd: start applying collection ${r}`;try{const[l,c]=yield B(r,i,a,t),d=performance.now();if(null!=l)yield j(r,l,c,t),__LOG__(2)`syncd: ${r} snapshot and patches applied successfully`;else if(null!=c){const e=Math.min.apply(Math,c.map((e=>e.version.version))),n=null!=t&&e>t+1&&c.length>0;if(n){const n=yield y.default.getAllMissingKeys();__LOG__(2)`syncd: missing keys: [${n.map((e=>e.keyHex+":"+e.timestamp))}]`,__LOG__(3,void 0,void 0,!0)`syncd: has missing patches. collection: ${r}, localVersion: ${t},
minPatch: ${e}`,SEND_LOGS("syncd: has missing patches")}yield W(r,c,t,n),__LOG__(2)`syncd: ${r} patches applied successfully`}else null!=n?(yield F(r,n,o,s),__LOG__(2)`syncd: ${r} v${n} uploaded successfully`):((0,M.isBootstrap)(t)&&(yield y.default.setCollectionVersion(r,0,k)),__LOG__(2)`syncd: sync ${r} but there are no updates`);const p=Math.floor(performance.now()-d);return __LOG__(2)`syncd: applyAppStateSyncResponse: finished applying ${r} in ${p}ms`,(c||l)&&(0,M.isBootstrap)(t)&&!(0,M.isCriticalCollection)(r)&&new C.default.MdBootstrapDataApplied({mdBootstrapPayloadType:C.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapSource:C.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield T.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,u.unixTimeMs)(),mdBootstrapStepDuration:p,collection:(0,M.collectionNameToMetric)(r),usedSnapshot:null!=l}).commit(),yield(0,h.logMacsInSnapshot)(e.name),e}catch(e){const t=e.message;return e instanceof P.SyncdMissingKeyError?(__LOG__(3)`syncd: key error: ${r} missing keys`,{name:r,state:g.CollectionState.Blocked}):e instanceof P.SyncdFatalError?(__LOG__(4,void 0,new Error,!0)`syncd: fatal error: ${r} throws ${t}`,SEND_LOGS(`syncd: fatal error: ${String(r)} throws ${t}`),{name:r,state:g.CollectionState.ErrorFatal}):(__LOG__(3,void 0,void 0,!0)`syncd: retryable error: ${r} throws ${t}`,SEND_LOGS(`syncd: retryable error: ${String(r)} throws ${t}`),{name:r,state:g.CollectionState.ErrorRetry})}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e,t,r,n){yield(0,h.logMacsInSnapshot)(e);const i=n.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),o=yield(0,h.computeLtHash)(e,i),s=(0,O.encryptedUploadMutationsToSyncActions)(n.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),g.SyncActionState.Success);__LOG__(2)`syncd: _uploadSuccessful: write to db for ${e}`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.setSyncActionRows(s),yield y.default.bulkRemovePendingMutations(r),yield y.default.setCollectionVersion(e,t,o)}))),__LOG__(2)`syncd: end _uploadSuccessful for ${e}`}))).apply(this,arguments)}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,r,n){let i=Promise.resolve(),o=0;const l=(0,u.unixTimeMs)();if(null!=r){const t=w.default.validateExternalBlobReference(e,r);o+=(0,s.numberOrThrowIfTooLarge)(t.fileSizeBytes||0),__LOG__(2)`syncd: download snapshot for ${e}`,i=(0,A.downloadSnapshot)(e,t)}let c,d,p=Promise.resolve();if(null!=t){const r=t.map((t=>w.default.validatePatchProtobuf(e,t)));p=Promise.all(r.map(function(){var t=(0,a.default)((function*(t){let r=t.mutations||[];const n=t.externalMutations;return n&&(__LOG__(2)`syncd: download patch for ${e}`,r=yield(0,A.downloadExternalPatch)(e,n),__LOG__(2)`syncd: ${e}'s external patch downloaded`,o+=(0,s.numberOrThrowIfTooLarge)(n.fileSizeBytes||0)),{mutations:r,version:t.version,snapshotMac:t.snapshotMac,patchMac:t.patchMac,keyId:t.keyId,exitCode:t.exitCode,deviceIndex:t.deviceIndex}}));return function(){return t.apply(this,arguments)}}()))}try{[c,d]=yield Promise.all([i,p]),(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!0)}catch(t){throw(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!1),t}return[c,d]}))).apply(this,arguments)}function j(){return Y.apply(this,arguments)}function Y(){return(Y=(0,a.default)((function*(e,t,r,n){yield(0,h.logMacsInSnapshot)(e);try{__LOG__(2)`syncd: start validate ${e}'s snapshot`;const r=yield(0,h.computeLtHashAndValidateSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot validated`;const n=yield(0,E.tryDecryptSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot decrypted`,R.default.addMutationCount(t.records.length),(0,D.logMetricsForMutations)(n),(0,I.validateNoSameIndexForMultipleMutations)(e,n,g.SyncDataType.Snapshot);const i=t.version.version,{setMutationsToPersist:o,pendingMutationsToDrop:s}=yield z(e,n);__LOG__(2)`syncd: processed ${n.length} mutations in snapshot of collection ${e} v${i}`,__LOG__(2)`syncd: collection ${e}'s snapshot v${i} applied`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.setSyncActionRows(o),yield y.default.bulkRemovePendingMutations(s),yield y.default.setCollectionVersion(e,i,r)}))),__LOG__(2)`syncd: completed applying snapshot for ${e}`}catch(r){throw r instanceof P.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInSnapshot)(e,t)),r}if(r)return W(e,r,n)}))).apply(this,arguments)}function W(){return H.apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t,r,n){if(0===t.length)return __LOG__(2)`syncd: no patches for collection ${e}`,Promise.resolve();(0,I.validateNoDuplicatePatchVersionInCollection)(e,t);const i=(0,o.default)(t,(e=>e.version.version));try{for(let t=0;t<i.length;t++)yield V(e,i[t],r,n)}catch(t){throw t instanceof P.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInPatches)(e,i)),t}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,r,n){if(yield(0,h.logMacsInSnapshot)(e),t.exitCode){var i;const r=t.exitCode.code;switch(r){case 100:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA,e);break;case 101:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR,e);break;default:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN,e)}throw new P.SyncdFatalError(`received terminal patch with exit code:  ${String(r)} text: ${String(null===(i=t.exitCode)||void 0===i?void 0:i.text)}  `)}0===t.deviceIndex&&_.default.updatePrimaryAllowsAllMutationsFlag("device index");const o=t.mutations.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)).length,s=t.mutations.length-o;__LOG__(2)`syncd: applying patch ${e} v${t.version.version} from device ${t.deviceIndex}
SET count: ${o}
REMOVE count: ${s}`,0===o&&0===s&&(__LOG__(3,void 0,void 0,!0)`syncd: ${e}: empty patch found`,SEND_LOGS(`syncd: ${e}: empty patch found`));const l=yield(0,h.computeLtHashAndValidatePatch)(e,t,n);__LOG__(2)`syncd: completed computeLtHashAndValidatePatch for ${e} v${t.version.version}`;const d=yield(0,E.tryDecryptPatch)(e,t);(0,D.logMetricsForMutations)(d),R.default.addMutationCount(d.length),(0,I.validateNoSameIndexForMultipleMutations)(e,d,g.SyncDataType.Patch);const u=Z(d),p=u.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE));yield J(e,p),__LOG__(2)`syncd: completed _applyRemoveMutations for ${e} v${t.version.version}`;const f=u.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),{setMutationsToPersist:m,pendingMutationsToDrop:v}=yield z(e,f);__LOG__(2)`syncd: processed ${d.length} mutations in patch version ${t.version.version} of collection ${e}`;const T=t.version.version;yield y.default.performTransaction((0,a.default)((function*(){yield y.default.deleteSyncActionRows(p.map((e=>e.index))),yield y.default.setSyncActionRows(m),yield y.default.bulkRemovePendingMutations(v),yield y.default.setCollectionVersion(e,T,l)}))),__LOG__(2)`syncd: completed final transaction in _applyPatch for ${e} v${t.version.version}`}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,m.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ABOUT_TO_APPLY_MUTATIONS);const n=r?" (individual mutations)":"",i=[],a=(0,I.validateAndTypeSetMutations)(e,t),{supportedMutations:o,unsupportedMutations:s}=ee(e,a);s.forEach((e=>i.push((0,O.setMutationToSyncAction)(e,g.SyncActionState.Unsupported))));const{remoteMutationsToApply:c,pendingMutationsToDrop:u}=yield(0,b.resolveConflict)(e,o),f=o.filter((e=>!c.includes(e)));f.forEach((e=>i.push((0,O.setMutationToSyncAction)(e,g.SyncActionState.Skipped,e.actionName))));const _=te(c);for(let t=0;t<_.length;t++){const r=_[t][0].actionHandler,a=_[t].map((e=>{let t;return t=e.binarySyncData?(0,l.default)((0,p.decodeProtobuf)(d.SyncActionDataSpec,e.binarySyncData).value,"decodeProtobuf(SyncActionDataSpec, m.binarySyncData).value"):(0,p.decodeProtobuf)(d.SyncActionValueSpec,e.binarySyncAction),{operation:"set",indexParts:e.indexArr,value:t,timestamp:e.timestamp}}));__LOG__(2)`syncd: before apply mutation batch for ${e}. mutations count: ${a.length}  ${n}`;const o=yield r.applyMutations(a,{setMutationsPendingToPersist:i,allSupportedSetMutations:c});__LOG__(2)`syncd: after apply mutation batch for ${e}  ${n}`;for(let e=0;e<_[t].length;e++){var h,y;i.push((0,O.setMutationToSyncAction)(_[t][e],o[e].actionState,_[t][e].actionName,null===(h=o[e].orphanModel)||void 0===h?void 0:h.modelId,null===(y=o[e].orphanModel)||void 0===y?void 0:y.modelType))}}return(0,m.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.APPLIED_MUTATIONS),__LOG__(2)`syncd: completed apply set mutations for ${e}  ${n}`,{setMutationsToPersist:i,pendingMutationsToDrop:u}}))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t){const{supportedMutations:r}=X(t),n=te(r);__LOG__(2)`syncd: before apply remove mutations for ${e}`;for(let t=0;t<n.length;t++){const r=n[t][0].actionHandler;yield r.applyMutations(n[t].map((t=>({operation:"remove",indexParts:re(e,t.index)}))),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]})}__LOG__(2)`syncd: after apply remove mutations for ${e}`}))).apply(this,arguments)}function X(e){const t=[],r=[];return e.forEach((e=>{if(e.version>(0,f.maxSupportedVersion)())return void r.push(e);const n=re(e.collection,e.index),i=g.Actions.cast(n[0]);if(!i)return __LOG__(3)`syncd: invalid action ${n[0]}`,void r.push(e);const a=f.ActionHandlers.get(i);if(!a)return __LOG__(3)`syncd: no handler for action ${i}`,void r.push(e);t.push({collection:e.collection,index:e.index,indexMac:e.indexMac,keyId:e.keyId,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version,indexArr:n,actionName:i,actionHandler:a})})),{supportedMutations:t,unsupportedMutations:r}}function Z(e){const t=e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),r=new Set(t.map((e=>e.index)));return e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE)).forEach((e=>{r.has(e.index)||t.push(e)})),t}function ee(e,t){const r=[],n=[];return t.forEach((t=>{if(t.version>(0,f.maxSupportedVersion)())return void n.push(t);const i=re(e,t.index),a=g.Actions.cast(i[0]);if(!a)return __LOG__(3)`syncd: invalid action ${i[0]}`,void n.push(t);const o=f.ActionHandlers.get(a);if(!o)return __LOG__(3)`syncd: no handler for action ${a}`,void n.push(t);r.push({collection:t.collection,index:t.index,indexMac:t.indexMac,keyId:t.keyId,timestamp:t.timestamp,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,valueMac:t.valueMac,version:t.version,indexArr:i,actionName:a,actionHandler:o})})),{supportedMutations:r,unsupportedMutations:n}}function te(e){return e.reduce(((e,t)=>(0!==e.length&&t.actionName===e[e.length-1][0].actionName?e[e.length-1].push(t):e.push([t]),e)),[])}function re(e,t){try{const e=JSON.parse(t);if(e.length<1)throw new Error;return e}catch(t){throw(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX,e),new P.SyncdFatalError("invalid action index")}}},13815:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeExternalBlobReference=function(e,t){try{return(0,o.decodeProtobuf)(i.ExternalBlobReferenceSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("external blob reference protobuf deserialization failed")}},t.decodeSyncActionData=function(e,t){try{return(0,o.decodeProtobuf)(a.SyncActionDataSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("action data protobuf deserialization failed")}},t.decodeSyncdMutations=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdMutationsSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("mutations protobuf deserialization failed")}},t.decodeSyncdPatch=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdPatchSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("patch protobuf deserialization failed")}},t.decodeSyncdSnapshot=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdSnapshotSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("snapshot protobuf deserialization failed")}};var i=r(50073),a=r(381),o=r(84902),s=r(68254),l=n(r(11339)),c=r(85156)},58743:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.tryDecryptPatch=function(){return S.apply(this,arguments)},t.tryDecryptSnapshot=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(7589),o=r(50073),s=r(381),l=r(62109),c=r(32458),d=r(63109),u=r(60980),p=r(13815),f=r(68254),_=r(837),h=n(r(11339)),g=r(85156),m=n(r(16088));const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){return yield Promise.all(t.records.map((t=>v(e,o.SyncdMutationSyncdOperation.SET,t))))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield Promise.all(t.mutations.map((t=>v(e,t.operation,t.record))))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r){const n=r.keyId.id,i=yield(0,_.getKeyData)(n);if(!i){if(t===o.SyncdMutationSyncdOperation.REMOVE)throw new g.SyncdFatalError("no key data for remove mutations");throw new g.SyncdMissingKeyError}const{syncAction:a,indexMac:l,valueMac:c,indexValueBinary:d}=yield C(e,n,i,t,r),{index:p,value:f,version:h}=a,m=f?(0,u.encodeProtobuf)(s.SyncActionValueSpec,f).readBuffer():f;return{index:y.decode(p),action:null,binarySyncAction:m,version:h,keyId:n,operation:t,indexMac:l,valueMac:c,collection:e,binarySyncData:d}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i){const o=i.index.blob,s=i.value.blob,u=(0,l.valueMacFromIndexAndValueCipherText)(s),_=(0,d.split)(s,c.IV_LENGTH,s.byteLength-c.MAC_LENGTH-c.IV_LENGTH),y=_[0],E=_[1],S=_[2],v=yield(0,l.generateEncryptionKeys)(r),{indexKey:T,valueEncryptionKey:C,valueMacKey:A}=v,b=(0,d.combine)([y,E]),P=(0,l.generateAssociatedData)(n,t),M=yield(0,l.generateMac)(P,b,A);if(!(0,a.areBuffersEqual)(S,M))throw(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: valueMAC mismatch");const O=yield(0,l.decryptCipherText)(new Uint8Array(y),C,E),I=(0,p.decodeSyncActionData)(e,O),w=m.default.validateSyncActionDataProtobuf(e,I),R=yield(0,l.generateIndexMac)(T,w.index);if(!(0,a.areBuffersEqual)(o,R))throw(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: indexMAC mismatch");return{syncAction:w,indexMac:o,valueMac:u,indexValueBinary:O}}))).apply(this,arguments)}},59037:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadExternalPatch=function(){return g.apply(this,arguments)},t.downloadSnapshot=function(){return h.apply(this,arguments)};var a=i(r(81109)),o=i(r(48926)),s=r(15688),l=r(13815),c=r(26384),d=r(37115),u=r(68254),p=i(r(11339)),f=r(85156),_=i(r(89453));function h(){return(h=(0,o.default)((function*(e,t){try{const r=yield m(t),n=(0,l.decodeSyncdSnapshot)(e,r);return _.default.validateSnapshotProtobuf(e,n)}catch(r){if(__LOG__(2)`syncd: error downloading snapshot of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,r instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_EXPIRED,e),new f.SyncdFatalError("snapshot expired");throw r}}))).apply(this,arguments)}function g(){return(g=(0,o.default)((function*(e,t){try{const r=yield m(t);return(0,l.decodeSyncdMutations)(e,r).mutations.map((t=>_.default.validateMutationProtobuf(e,t)))}catch(r){if(__LOG__(2)`syncd: error downloading patch of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,r instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_PATCH_EXPIRED,e),new f.SyncdFatalError("external patch expired");throw r}}))).apply(this,arguments)}function m(e){const{mediaKey:t,directPath:r,fileSha256:i,fileEncSha256:o}=e,l={directPath:r,encFilehash:(0,s.encodeB64)(o),filehash:(0,s.encodeB64)(i),mediaKey:(0,s.encodeB64)(t),type:"md-app-state",userDownloadAttemptCount:0};return c.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new n).signal},l))}},11540:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resolveConflict=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(73407)),s=r(43402);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const r=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const r=t.get(e.index);if(r){const t=e.actionHandler;return{remoteMutationIndex:e.index,conflictResolutionState:yield t.resolveConflicts(r,e)}}}));return function(){return e.apply(this,arguments)}}())),n=new Map;return r.forEach((e=>{e&&n.set(e.remoteMutationIndex,e.conflictResolutionState)})),n}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=[];let n=[];const i=yield o.default.getPendingMutationsRows(["collection"],e),c=new Map(i.map((e=>[e.index,e]))),d=yield l(t,c);t.forEach((e=>{const t=d.get(e.index);if(t)switch(t){case a.ConflictResolutionState.SkipRemote:break;case a.ConflictResolutionState.ApplyRemoteAndDropLocal:r.push(e),n=n.concat(i.filter((t=>t.index===e.index)));break;case a.ConflictResolutionState.SkipRemoteAndDropLocal:n=n.concat(i.filter((t=>t.index===e.index)))}else r.push(e)}));const u=(0,s.sort)(r),p=[];for(let e=0;e<u.length;e++){const t=u[e].actionHandler;(yield t.dropMutationDueToCrossIndexConflict(u[e],c))||p.push(u[e])}return{remoteMutationsToApply:p,pendingMutationsToDrop:n.map((e=>e.id)).filter(Boolean)}}))).apply(this,arguments)}},43402:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._setDependency=function(e,t){l.set(e,t)},t.sort=function(e){const t=[],r=[];try{return e.forEach((n=>{t.push(n);const i=l.get(n.actionName);null!=i&&e.forEach((e=>{e!==n&&i.includes(e.actionName)&&function(e,t){const r=e.actionHandler.getChatJidAndMessageKey(e),n=t.actionHandler.getChatJidAndMessageKey(t);if(r&&n)return r.chatJid===n.chatJid&&(null==r.messageKey||null==n.messageKey||r.messageKey===n.messageKey);return!1}(e,n)&&(e.timestamp<n.timestamp?r.push([e,n]):r.push([n,e]))}))})),i.default.array(t,r)}catch(e){throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH,null),new s.SyncdFatalError("cyclic mutation dependency in patch")}};var i=n(r(94633)),a=(r(45606),r(68254)),o=n(r(11339)),s=r(85156);const l=new Map},6954:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedUploadMutationsToSyncActions=function(e,t){return e.map((e=>({index:e.index,action:e.action,binarySyncAction:e.binarySyncAction,actionState:t,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp})))},t.setMutationToSyncAction=function(e,t,r,n,i){return{index:e.index,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp,action:r,actionState:t,modelId:n,modelType:null!=i?i:void 0}},t.syncActionsToDecryptedMutation=function(e){return e.map((e=>({collection:e.collection,index:e.index,action:e.action,indexMac:e.indexMac,keyId:e.keyId,operation:n.SyncdMutationSyncdOperation.SET,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version})))};var n=r(50073)},72466:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.validateAndTypeSetMutations=function(e,t){return t.map((t=>{let r;if(t.binarySyncData){const e=t.binarySyncData;r=(0,s.decodeProtobuf)(o.SyncActionDataSpec,e).value}else t.binarySyncAction&&(r=(0,s.decodeProtobuf)(o.SyncActionValueSpec,t.binarySyncAction));if(!r)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE,e),new u.SyncdFatalError("missing action value");const n=(0,i.maybeNumberOrThrowIfTooLarge)(r.timestamp);if(null==n)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP,e),new u.SyncdFatalError("missing action timestamp");return{index:t.index,version:t.version,keyId:t.keyId,indexMac:t.indexMac,valueMac:t.valueMac,collection:t.collection,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,timestamp:n}}))},t.validateNoDuplicatePatchVersionInCollection=function(e,t){const r=new Set;t.forEach((t=>{const n=t.version.version;if(r.has(n))throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION,e),new u.SyncdFatalError("duplicate patch version in collection");r.add(n)}))},t.validateNoSameIndexForMultipleMutations=function(e,t,r){const n=new Set,i=new Set;t.forEach((t=>{let o=!1;if(t.operation===a.SyncdMutationSyncdOperation.SET&&(n.has(t.index)?o=!0:n.add(t.index)),t.operation===a.SyncdMutationSyncdOperation.REMOVE&&(i.has(t.index)?o=!0:i.add(t.index)),o)switch(r){case l.SyncDataType.Patch:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,e),new u.SyncdFatalError("same index for multiple mutations in patch");case l.SyncDataType.Snapshot:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,e),new u.SyncdFatalError("same index for multiple mutations in snapshot")}}))};var i=r(8243),a=r(50073),o=r(381),s=r(84902),l=r(45606),c=r(68254),d=n(r(11339)),u=r(85156)},89453:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(8243),a=r(68254),o=n(r(11339)),s=r(85156);class l{static validateSnapshotProtobuf(e,t){const{version:r,records:n,mac:c,keyId:d}=t,u=null==r?void 0:r.version;if(!r||null==u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION,e),new s.SyncdFatalError("missing snapshot version");const p=n.map((t=>l.validateRecordProtobuf(e,t)));if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing snapshot mac");const f=l.validateKeyIdProtobuf(e,d,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID);return{version:{version:(0,i.numberOrThrowIfTooLarge)(u)},records:p,mac:c,keyId:f}}static validatePatchProtobuf(e,t){const{version:r,mutations:n,externalMutations:c,snapshotMac:d,patchMac:u,keyId:p,exitCode:f,deviceIndex:_}=t,h=null==r?void 0:r.version;if(!r||null==h)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION,e),new s.SyncdFatalError("missing patch version");if(n&&n.length>0&&c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,e),new s.SyncdFatalError("patch with both inline and external mutations");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing patch snapshot mac");if(!u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC,e),new s.SyncdFatalError("missing patch mac");const g=l.validateKeyIdProtobuf(e,p,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID);if(c){const t=l.validateExternalBlobReference(e,c);return{version:{version:(0,i.numberOrThrowIfTooLarge)(h)},mutations:void 0,externalMutations:t,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:_}}const m=n.map((t=>l.validateMutationProtobuf(e,t)));return{version:{version:(0,i.numberOrThrowIfTooLarge)(h)},mutations:m,externalMutations:void 0,exitCode:f,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:_}}static validateExternalBlobReference(e,t){const{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}=t;if(!r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,e),new s.SyncdFatalError("missing external blob reference media key");if(!n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,e),new s.SyncdFatalError("missing external blob reference direct path");if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,e),new s.SyncdFatalError("missing external blob reference file SHA256");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,e),new s.SyncdFatalError("missing external blob reference file enc SHA256");return{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}}static validateMutationProtobuf(e,t){const{operation:r,record:n}=t;if(null==r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION,e),new s.SyncdFatalError("missing mutation operation");if(!n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD,e),new s.SyncdFatalError("missing mutation record");return{operation:r,record:l.validateRecordProtobuf(e,n)}}static validateRecordProtobuf(e,t){const{index:r,value:n,keyId:i}=t,c=null==r?void 0:r.blob,d=null==n?void 0:n.blob;if(!r||!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX,e),new s.SyncdFatalError("missing mutation index");if(!n||!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE,e),new s.SyncdFatalError("missing mutation value");return{index:{blob:c},value:{blob:d},keyId:l.validateKeyIdProtobuf(e,i,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID)}}static validateKeyIdProtobuf(e,t,r){const n=null==t?void 0:t.id;if(!t||!n)throw(0,a.uploadFatalErrorMetric)(r,e),new s.SyncdFatalError("missing mutation key id");return{id:n}}}t.default=l},16088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(68254),a=n(r(11339)),o=r(85156);t.default=class{static validateSyncActionDataProtobuf(e,t){const{index:r,value:n,padding:s,version:l}=t;if(!r)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX,e),new o.SyncdFatalError("missing action index");if(null==l)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION,e),new o.SyncdFatalError("missing action version");return{index:r,value:n,padding:s,version:l}}}},35377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMetricsForMutations=function(e){(0,o.logCriticalBootstrapStageIfNecessary)(s.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MUTATIONS_DECRYPTED),e.forEach(l)};var i=r(381),a=r(84902),o=r(58597),s=n(r(11339));function l(e){let t;const{binarySyncAction:r}=e;if(null==r)return;const n=(0,a.decodeProtobuf)(i.SyncActionValueSpec,r);n.archiveChatAction?t=n.archiveChatAction.messageRange:n.markChatAsReadAction?t=n.markChatAsReadAction.messageRange:n.clearChatAction?t=n.clearChatAction.messageRange:n.deleteChatAction&&(t=n.deleteChatAction.messageRange),null!=t&&new s.default.MdAppStateMessageRange({additionalMessagesCount:t.messages.length}).commit()}},62274:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitBootstrapAppStateDownloadMetric=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(8243),o=r(92844),s=r(45606),l=r(49801),c=n(r(11339));function d(){return(d=(0,i.default)((function*(e,t,r,n){const i=new c.default.MdBootstrapAppStateDataDownloaded({mdBootstrapPayloadType:[s.CollectionName.CriticalBlock,s.CollectionName.CriticalUnblockLow].includes(e)?c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdTimestamp:(0,o.unixTimeMs)(),mdBootstrapStepDuration:(0,o.unixTimeMs)()-t,mdBootstrapStepResult:n?c.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:c.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId()}),d=yield l.MdSyncFieldStatsMeta.getStorageEstimation();d.mdStorageQuotaBytes!==l.STORAGE_QUOTA_UNAVAILABLE&&(i.mdStorageQuotaUsedBytes=d.mdStorageQuotaUsedBytes,i.mdStorageQuotaBytes=d.mdStorageQuotaBytes);try{const e=(0,a.maybeNumberOrThrowIfTooLarge)(r);null!=e&&(i.mdBootstrapPayloadSize=e)}catch(e){}i.commit()}))).apply(this,arguments)}},65582:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(73407)),s=r(26442);function l(){return(l=(0,i.default)((function*(e,t){const r=e.keyIds;if(r){const e=r.map((e=>e.keyId)).filter(Boolean);if(__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}
\t for keyIds: [${e.map(a.arrayBufferToHex)}]`,e){const r=[],n=[];return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield o.default.getSyncKey(new Uint8Array(e));t?r.push(t):n.push(e)}));return function(){return e.apply(this,arguments)}}())),__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}: about to send key share
\t keys with keydata: [${r.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)))}]
\t keys without keydata: [${n.map((e=>(0,a.arrayBufferToHex)(e)))}]`,(0,s.sendAppStateSyncKeyShare)({type:"missing_key",keys:r,orphanKeys:n,peerDeviceId:t})}}}))).apply(this,arguments)}},82568:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyShare=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(8243),o=r(63109),s=r(58597),l=n(r(73407)),c=r(68254),d=r(4573),u=n(r(11339)),p=r(93932),f=r(38804);function _(){return(_=(0,i.default)((function*(e,t){(0,s.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_RECEIVED);const r=t.getDeviceId();__LOG__(2)`syncd: handling key share from device ${r} with ${e.keys.length} keys`;const n=[],_=e.keys;if(!_)return Promise.resolve();yield Promise.all(_.map(function(){var e=(0,i.default)((function*(e){var t;const i=null===(t=e.keyId)||void 0===t?void 0:t.keyId,s=e.keyData,p=null==s?void 0:s.keyData;if(!i)return void __LOG__(2)`syncd: received key with missing keyID from device ${r}`;const f=(0,o.arrayBufferToHex)(i);if(__LOG__(2)`syncd: received key share key id ${f} from device ${r} ${null!=p?"with":"without"} keyData`,6!==i.byteLength)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_ID}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`,SEND_LOGS(`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`),(0,c.handleFatalError)();if(n.push({keyId:i,keyData:p}),s){var _,h,g;const e=s.timestamp,t=null===(_=s.fingerprint)||void 0===_?void 0:_.currentIndex,n=null===(h=s.fingerprint)||void 0===h?void 0:h.rawId,o=null===(g=s.fingerprint)||void 0===g?void 0:g.deviceIndexes;if(!p||null==e||null==t||null==n||!o)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_DATA}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: invalid key share key data`,SEND_LOGS("syncd: fatal error: invalid key share key data"),(0,c.handleFatalError)();const m=new Uint8Array(i);(yield l.default.getSyncKey(m))||(yield l.default.createSyncKey({keyId:m,keyEpoch:(0,d.getKeyEpoch)(i),keyData:p,timestamp:(0,a.numberOrThrowIfTooLarge)(e),fingerprint:{rawId:n,currentIndex:t,deviceIndexes:o}}),__LOG__(2)`syncd: stored key share key id ${f} from device ${r}`)}}));return function(){return e.apply(this,arguments)}}())),n.some((e=>null!=e.keyData))||__LOG__(2)`syncd: key share from device ${r} has no keys with keydata.`,yield(0,p.updateMissingKeys)(n,t),(0,f.syncBlockedCollections)()}))).apply(this,arguments)}},84051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingKeysInPatches=function(){return _.apply(this,arguments)},t.handleMissingKeysInSnapshot=function(){return f.apply(this,arguments)},t.requestAllMissingKeys=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(7589),o=r(63109),s=r(93932),l=(r(45606),n(r(73407))),c=r(4573),d=r(65031),u=r(85156);const p=new ArrayBuffer(0);function f(){return(f=(0,i.default)((function*(e,t){const r=new Set,n=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.records.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("snapshot has empty key");const i=(0,o.arrayBufferToHex)(t);n.includes(i)||r.add(i)})),__LOG__(2)`syncd: collection ${e}'s snapshot has missing keys ${Array.from(r)}`,yield h(r)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const r=new Set,n=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("syncd: patch has empty key. patch device id: ${p.deviceIndex}");const i=(0,o.arrayBufferToHex)(t);n.includes(i)||(__LOG__(2)`syncd: handleMissingKeysInPatches: missing key: keyId: ${i}, patch version: ${e.version.version}, patch device id: ${e.deviceIndex}`,r.add(i))})),__LOG__(2)`syncd: collection ${e}'s patches has missing keys ${Array.from(r)}`,yield h(r)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if(!r(28237).OfflineMessageHandler.isResumeFromRestartComplete())return void __LOG__(2)`syncd: _handleMissingKeys: skipping due to resume from restart in progress`;const t=Array.from(e);__LOG__(2)`syncd: _handleMissingKeys: missing keys [${t}]`;const n=new Set((yield l.default.bulkGetMissingKeys(t)).filter(Boolean).map((e=>e.keyHex))),i=t.filter((e=>!n.has(e)));if(__LOG__(2)`syncd: _handleMissingKeys: missing keys after filter: [${i}]`,0===i.length)return Promise.resolve();const a=i.map((e=>(0,o.hexToUint8Array)(e).buffer)),c=yield m(a);yield(0,s.addMissingKeys)(a,c.map((e=>e.getDeviceId())))}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=yield(0,c.getPeerDevices)();return yield(0,d.sendAppStateSyncKeyRequest)(e,t),t}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();__LOG__(2)`syncd: requestAllMissingKeys: missing keys: [${e.map((e=>e.keyHex))}]`,0!==e.length&&(yield m(e.map((e=>e.keyId))))}))).apply(this,arguments)}},837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearSyncKeysCache=function(){m=new Map},t.getActiveKey=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return y.enqueue((()=>E(e)))},t.getKeyData=function(){return C.apply(this,arguments)},t.getNewestKeyPair=v;var i=n(r(48926)),a=n(r(22762)),o=n(r(63105)),s=n(r(6162)),l=r(15688),c=r(27870),d=r(63109),u=n(r(73407)),p=r(9108),f=r(4573),_=n(r(11339)),h=r(26442),g=r(13722);let m=new Map;const y=new c.PromiseQueue;function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=yield v(),r=yield(0,p.getMyDeviceList)();const{currentIndex:n,devices:i,rawId:a}=r;if(null==n)throw new Error("syncd: missing current index for own device");r={currentIndex:n,deviceIndexes:i.map((e=>e.keyIndex)),rawId:a};const o=(0,g.hasKeyExpired)(t),s=(0,g.hasADeviceBeenRemoved)(t,r);return e&&(o||s)?(t=(0,g.rotateKey)(t,r),__LOG__(2)`syncd: stored key rotation key id ${(0,d.arrayBufferToHex)(t.keyId.buffer)}`,yield u.default.createSyncKey(t),yield(0,h.sendAppStateSyncKeyShare)({type:"key_rotation",keys:[t]}),o&&(__LOG__(2)`syncd: key rotation due to key expiry`,new _.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:_.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.APP_STATE_SYNC_KEY_EXPIRY}).commit()),s&&(__LOG__(2)`syncd: key rotation due to device removal`,new _.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:_.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.DEVICE_DEREGISTERATION}).commit()),E(e)):{keyId:t.keyId.buffer,keyData:t.keyData}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield u.default.getAllSyncKeys(),t=(0,s.default)(e.map((e=>(0,f.getKeyEpoch)(e.keyId.buffer)))),r=(0,o.default)(e,(e=>(0,f.getKeyEpoch)(e.keyId.buffer)===t));return(0,a.default)(r,(e=>(0,f.getKeyDeviceId)(e.keyId.buffer)))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){var t;let r=m.get((0,l.encodeB64)(e));return r?r.keyData:(r=yield u.default.getSyncKeyData(new Uint8Array(e)),r&&m.set((0,l.encodeB64)(e),r),null===(t=r)||void 0===t?void 0:t.keyData)}))).apply(this,arguments)}},4573:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDeviceId=function(e){return new DataView(e).getUint16(0)},t.getKeyEpoch=function(e){return new DataView(e).getUint32(2)},t.getPeerDevices=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(9108),s=r(99234);function l(){return(l=(0,i.default)((function*(){const e=[],t=(0,s.assertGetMe)();try{const r=yield(0,o.getMyDeviceList)();r.devices.forEach((n=>{n.id!==t.getDeviceId()&&e.push((0,a.createDeviceWidFromUserAndDevice)(r.id,n.id))}))}catch(e){return __LOG__(3,void 0,void 0,!0)`syncd: getPeerDevices: error ${e}. Future key requests will only be sent to primary device.`,SEND_LOGS(e.toString()),[(0,a.createDeviceWidFromUserAndDevice)(t.user,0)]}return e}))).apply(this,arguments)}},65031:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyRequest=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(65212)),s=r(52407),l=r(58597),c=r(99234),d=n(r(11339)),u=r(17304),p=r(238);function f(){return(f=(0,i.default)((function*(e,t){const r={keyIds:e.map((e=>({keyId:e})))},n=t.map((e=>{const t=new o.default({fromMe:!0,remote:(0,c.assertGetMeUser)(),id:o.default.newId()});return new u.Msg({id:t,to:e,type:"protocol",subtype:"app_state_sync_key_request",appStateSyncKeyRequest:r})})),i=t.map((e=>e.getDeviceId())),f=e.map((e=>(0,a.arrayBufferToHex)(e)));__LOG__(2)`syncd: send key request key id ${f} to peer deviceIds ${i}`,yield(0,p.storePeerMessages)(n),yield Promise.all(n.map(s.encryptAndSendKeyMsg)),(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_REQUESTED)}))).apply(this,arguments)}},26442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyShare=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(65212)),s=r(52407),l=r(99234),c=r(4573),d=r(17304),u=r(238);function p(){return(p=(0,i.default)((function*(e){let t,r;if("key_rotation"===e.type?(t=f(e.keys),r=yield(0,c.getPeerDevices)()):"missing_key"===e.type&&(t=f(e.keys,e.orphanKeys),r=[e.peerDeviceId]),null==r)return Promise.resolve();const n=r,i=n.map((e=>{const r=new o.default({fromMe:!0,remote:(0,l.assertGetMeUser)(),id:o.default.newId()});return new d.Msg({id:r,to:e,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:t})})),p=n.map((e=>e.getDeviceId())),_=e.keys.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: send key share key id ${_} to peer deviceIds ${p} due to ${e.type}`,yield(0,u.storePeerMessages)(i),yield Promise.all(i.map(s.encryptAndSendKeyMsg))}))).apply(this,arguments)}function f(e,t){let r=e.map((e=>({keyId:{keyId:e.keyId.buffer},keyData:{keyData:e.keyData,fingerprint:{rawId:e.fingerprint.rawId,currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes},timestamp:e.timestamp}})));if(t){const e=t.map((e=>({keyId:{keyId:e},keyData:void 0})));r=r.concat(e)}return{keys:r}}},93932:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMissingKeys=function(){return T.apply(this,arguments)},t.setMissingKeyTimeout=g,t.updateMissingKeyDevices=function(){return h.apply(this,arguments)},t.updateMissingKeys=function(e,t){const r=t.getDeviceId(),n=[],a=[];return e.forEach((e=>{const t=e.keyData,r=(0,o.arrayBufferToHex)(e.keyId);t?n.push(r):a.push(r)})),__LOG__(2)`syncd: updateMissingKeys from device ${r}
\tkeys with keyData: ${n}
\tkeys without keyData: ${a}`,(0,f.getStorage)().lock(["missing-keys"],function(){var e=(0,i.default)((function*(){if(n.length>0&&(yield l.default.bulkRemoveMissingKeys(n),yield g()),a.length>0){const e=(yield l.default.bulkGetMissingKeys(a)).filter(Boolean);e.forEach((e=>e.deviceResponses.set(r,!1))),__LOG__(2)`syncd: updateMissingKeys: begin updating missing keys from device ${r}
\tmissingKeys: [${a}]`,yield l.default.createOrUpdateMissingKeys(e),__LOG__(2)`syncd: updateMissingKeys: finish updating missing keys from device ${r}`,yield S()}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(48926)),a=n(r(22762)),o=r(63109),s=r(92844),l=n(r(73407)),c=r(68254),d=r(4573),u=n(r(11339)),p=r(64551),f=r(99069);let _;function h(){return(h=(0,i.default)((function*(){const e=(yield(0,d.getPeerDevices)()).map((e=>e.getDeviceId()));return(0,f.getStorage)().lock(["missing-keys"],function(){var t=(0,i.default)((function*(){const t=yield l.default.getAllMissingKeys();if(0===t.length)return Promise.resolve();t.forEach((t=>{t.deviceResponses.forEach(((r,n)=>{e.includes(n)||t.deviceResponses.delete(n)}))})),yield l.default.createOrUpdateMissingKeys(t),yield S()}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){clearTimeout(_),_=null;const e=yield l.default.getAllMissingKeys();if(0===e.length)return;__LOG__(2)`syncd: _setMissingKeyTimeout: missing keys: ${e.map((e=>(0,o.arrayBufferToHex)(e.keyId)))}`;const t=(0,a.default)(e,(e=>e.timestamp)),r=p.ServerProps.syncdWaitForKeyTimeoutDays*s.DAY_MILLISECONDS-(-t.timestamp+(0,s.unixTimeMs)());__LOG__(2)`syncd: earliest missing key: ${(0,o.arrayBufferToHex)(t.keyId)}, timestamp=${t.timestamp}, timeoutMs=${r}`,_=setTimeout(y,r)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){0!==(yield l.default.getAllMissingKeys()).length&&(new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: timeout while waiting for missing key`,SEND_LOGS("syncd fatal error: timeout while waiting for missing key"),(0,c.handleFatalError)())}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();for(const t of e){let e=!0;for(const r of t.deviceResponses.values())if(null==r){e=!1;break}if(e)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: missing key on all clients`,SEND_LOGS("syncd: fatal error: missing key on all clients"),void(0,c.handleFatalError)()}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const r=()=>{const e=new Map;return t.forEach((t=>e.set(t,null))),e},n=e.map((e=>({keyHex:(0,o.arrayBufferToHex)(e),keyId:e,timestamp:(0,s.unixTimeMs)(),deviceResponses:r()})));yield l.default.createOrUpdateMissingKeys(n),yield g()}))).apply(this,arguments)}},13722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hasADeviceBeenRemoved=function(e,t){const r=e.fingerprint,{rawId:n,currentIndex:a,deviceIndexes:o}=t,s=new Set(r.deviceIndexes);for(let e=r.currentIndex+1;e<=a;e++)s.add(e);return r.rawId!==n||!(0,i.default)(s,new Set(o))},t.hasKeyExpired=function(e){const t=e.timestamp,r=Math.min(90,Math.max(1,d.ServerProps.syncdKeyMaxUseDays));return(0,o.unixTimeMs)()-t>r*o.DAY_MILLISECONDS},t.rotateKey=function(e,t){const{keyId:r,keyEpoch:n}=function(e){const t=(0,c.getKeyEpoch)(e.keyId.buffer)+1,r=(0,l.assertGetMe)().getDeviceId();return{keyId:new Uint8Array((0,a.concatArrayBuffers)((0,s.intToBytes)(2,r).buffer,(0,s.intToBytes)(4,t).buffer)),keyEpoch:t}}(e),i=self.crypto.getRandomValues(new Uint8Array(32)).buffer,d=function(e){const{currentIndex:t,deviceIndexes:r,rawId:n}=e;return{rawId:n,currentIndex:t,deviceIndexes:r}}(t),u=(0,o.unixTimeMs)();return{keyId:r,keyEpoch:n,keyData:i,fingerprint:d,timestamp:u}};var i=n(r(18446)),a=r(32428),o=r(92844),s=r(11365),l=r(99234),c=r(4573),d=r(64551)},28900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._generateMutationsToUpload=G,t.buildSyncIqNode=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=n(r(89734)),o=r(15688),s=r(7589),l=r(50073),c=r(31914),d=r(1377),u=n(r(18309)),p=r(45606),f=n(r(73407)),_=r(81122),h=r(66622),g=r(99234),m=n(r(52991)),y=r(837),E=r(4573),S=r(84527),v=r(2622),T=r(64551),C=n(r(78375));function A(){return(A=(0,i.default)((function*(e){const{collectionNodes:t,collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}=yield b(e);return{syncIqNode:(0,c.wap)("iq",{to:c.S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:(0,c.generateId)()},(0,c.wap)("sync",null,t)),collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){__LOG__(2)`syncd: start _buildCollectionNodes`;const t=[],r=function(){var e=(0,i.default)((function*(e,r){const n=yield f.default.getCollectionVersion(e);let i,a;if(null!=r&&r.length>0)if(null==n)__LOG__(2)`syncd: skipping ${e} in sync iq patch because initial full sync
is incomplete`,t.push(e);else{const{patchNode:t,encryptedMutations:n}=yield M(e,r);i=t,a=n}return{collection:e,version:n,patchNode:i,encryptedMutations:a}}));return function(){return e.apply(this,arguments)}}(),n=new Map,a=new Map,o=[];e.forEach(((e,t)=>o.push(r(t,e))));const s=(yield Promise.all(o)).map((e=>{const{collection:t,version:r,patchNode:i,encryptedMutations:o}=e;return o&&a.set(t,o),n.set(t,r),(0,c.wap)("collection",{name:(0,c.CUSTOM_STRING)(t),version:(0,c.INT)(null!=r?r:p.DEFAULT_COLLECTION_VERSION),return_snapshot:void 0===r?"true":"false"},i)}));return __LOG__(2)`syncd: end _buildCollectionNodes`,{collectionNodes:s,collectionWithEncryptedMutations:a,localCollectionVersions:n,collectionsToSkip:t}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const r=yield(0,y.getActiveKey)(!I(t)),n=(yield G(e,t,r)).map((e=>(0,h.encryptMutation)(e,r))),a=yield Promise.all(n),o=a.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),s=yield(0,d.computeLtHash)(e,o),{snapshotMac:l,patchMac:u}=yield(0,d.computeOutgoingSnapshotAndPatchMacs)(e,s,a,r.keyData),p=a.map((e=>k(e.keyId,e.operation,e.indexMac,e.indexAndValueCipherText))),f=L(p),_=function(){var e=(0,i.default)((function*(){const e=yield(0,S.uploadExternalPatch)(f);return D(yield w(e,f),r.keyId,l,u)}));return function(){return e.apply(this,arguments)}}();let g;(0,S.exceedInlineMutationCount)(p)?g=yield _():(g=N(p,r.keyId,l,u),(0,S.exceedPatchProtobufSize)(g)&&(g=yield _()));return{patchNode:(0,c.wap)("patch",null,g),encryptedMutations:a}}))).apply(this,arguments)}function I(e){return m.default.isLogoutInProgress&&e.some((e=>JSON.parse(e.index)[0]===p.Actions.Sentinel))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t){const{mediaKey:r,directPath:n,encFilehash:i,handle:a}=e;if(!a)throw new Error("Missing handle after uploading external patch to mms4");const s=yield(0,u.default)(t);return{mediaKey:(0,o.decodeB64)(r),directPath:n,handle:a,fileSizeBytes:t.byteLength,fileSha256:(0,o.decodeB64)(s),fileEncSha256:(0,o.decodeB64)(i)}}))).apply(this,arguments)}function D(e,t,r,n){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,_.encodeSyncdPatch)({keyId:{id:t},externalMutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function N(e,t,r,n){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,_.encodeSyncdPatch)({keyId:{id:t},mutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function L(e){return(0,_.encodeSyncdMutations)({mutations:e})}function k(e,t,r,n){return{operation:t,record:{keyId:{id:e},index:{blob:r},value:{blob:n}}}}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e,t,r){const n=yield f.default.getSyncActionsRows(["collection"],[e]);let i=t;const a=F(e,n,t,r.keyId);i=i.concat(a);const o=x(n,i,r.keyId);return C.default.addKeyRotationRemoveCount(o.length),i=i.concat(o),i}))).apply(this,arguments)}function F(e,t,r,n){let i=t.filter((e=>!r.map((e=>e.index)).includes(e.index)&&!(0,s.areBuffersEqual)(e.keyId,n)));i=(0,a.default)(i,(e=>(0,E.getKeyEpoch)(e.keyId)));const o=Math.min(5,Math.max(1,T.ServerProps.syncdAdditionalMutations));return i=i.slice(0,o),(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.SET)}function x(e,t,r){const n=t.map((e=>e.index)),i=e.filter((e=>n.includes(e.index))).filter((e=>!(0,s.areBuffersEqual)(e.keyId,r)));return(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.REMOVE)}},81122:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSyncActionData=function(e){try{return(0,o.encodeProtobuf)(a.SyncActionDataSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("action data protobuf serialization failed")}},t.encodeSyncdMutations=function(e){try{return(0,o.encodeProtobuf)(i.SyncdMutationsSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("mutations protobuf serialization failed")}},t.encodeSyncdPatch=function(e){try{return(0,o.encodeProtobuf)(i.SyncdPatchSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("patch protobuf serialization failed")}};var i=r(50073),a=r(381),o=r(60980),s=n(r(11339)),l=r(85156)},66622:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMutation=function(){return y.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(76100),s=r(50073),l=r(381),c=r(62109),d=r(32458),u=r(63109),p=r(84902),f=n(r(73407)),_=r(81122),h=r(837),g=n(r(11339)),m=r(85156);function y(){return(y=(0,a.default)((function*(e,t){const{index:r,operation:n}=e;let a=t.keyId,o=t.keyData;switch(n){case s.SyncdMutationSyncdOperation.SET:break;case s.SyncdMutationSyncdOperation.REMOVE:const e=yield f.default.getSyncAction(r);if(!e)throw new m.SyncdFatalError("no corresponding set mutation");const t=e.keyId;a=t,o=yield(0,h.getKeyData)(t)}const{indexMac:l,indexAndValueCipherText:d}=yield E(e,a,o),u=(0,c.valueMacFromIndexAndValueCipherText)(d);return(0,i.default)((0,i.default)({},e),{},{keyId:a,keyData:o,indexMac:l,indexAndValueCipherText:d,valueMac:u})}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){try{const{index:n,binarySyncAction:i,operation:a,version:s}=e,l=(0,o.stringToArrayBuffer)(n),p=yield(0,c.generateEncryptionKeys)(r),{indexKey:f,valueEncryptionKey:_,valueMacKey:h}=p,g=yield self.crypto.getRandomValues(new Uint8Array(d.IV_LENGTH)),m=v(l,i,(0,c.generatePadding)(l.byteLength,i.byteLength),s),y=yield(0,c.generateCipherText)(g,_,m),E=(0,c.generateAssociatedData)(a,t),S=yield(0,c.generateMac)(E,y,h),T=(0,u.combine)([y,S]);return{indexMac:yield(0,c.generateIndexMac)(f,l),indexAndValueCipherText:T}}catch(e){throw new g.default.MdFatalError({mdFatalErrorCode:g.default.MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED}).commit(),new m.SyncdFatalError("encryption failure")}}))).apply(this,arguments)}function v(e,t,r,n){return(0,_.encodeSyncActionData)({index:e,value:(0,p.decodeProtobuf)(l.SyncActionValueSpec,t),padding:r,version:n})}},84527:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exceedInlineMutationCount=function(e){const t=Math.min(2e3,Math.max(o.ServerProps.syncdInlineMutationsMaxCount,100));return e.length>t},t.exceedPatchProtobufSize=function(e){const t=1e3*Math.min(100,Math.max(o.ServerProps.syncdPatchProtobufMaxSize,10));return e.byteLength>t},t.uploadExternalPatch=function(e){return s.default.encryptAndUpload({blob:e,signal:(new n).signal,type:"md-app-state",uploadOrigin:a.default.UPLOAD_ORIGIN_TYPE.UNKNOWN,userUploadAttemptCount:0,forwardedFromWeb:!1,isViewOnce:!1})};var a=i(r(11339)),o=r(64551),s=i(r(54824))},34089:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(28900),o=n(r(73407)),s=r(83853);function l(){return(l=(0,i.default)((function*(e){const t=new Map,r=new Map;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const n=yield o.default.getPendingMutationsRows(["collection"],e),i=n.map((e=>e.id)).filter(Boolean);r.set(e,i);const a=(0,s.compactPatch)(n);t.set(e,a)}));return function(){return e.apply(this,arguments)}}()));const n=yield(0,a.buildSyncIqNode)(t);return{syncIqNode:n.syncIqNode,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n.collectionWithEncryptedMutations,localCollectionVersions:n.localCollectionVersions,collectionsToSkip:n.collectionsToSkip}}))).apply(this,arguments)}},2622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncActionsToPendingMutations=function(e,t){return e.map((e=>{let r=e.binarySyncAction;if(!r){const t=(0,i.decodeProtobuf)(n.SyncActionDataSpec,e.binarySyncData).value;r=(0,a.encodeProtobuf)(n.SyncActionValueSpec,t).readBuffer()}return{collection:e.collection,index:e.index,binarySyncAction:r,operation:t,version:e.version,timestamp:e.timestamp,action:e.action}}))};var n=r(381),i=r(84902),a=r(60980)},83853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compactPatch=function(e){return(0,i.default)(e.reverse(),(e=>e.index)).reverse()};var i=n(r(45578))},61107:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncResponseParser=void 0;var i=r(71914),a=r(45606),o=r(13815),s=n(r(11339)),l=r(85156);const c=new i.WapParser("syncResponseParser",(e=>{__LOG__(2)`syncd: start parsing syncd collections`;const t=[];return e.child("sync").mapChildrenWithTag("collection",(e=>{const r={},n=a.CollectionName.cast(e.attrString("name"));if(!n)throw new l.SyncdFatalError("invalid collection name");r.name=n,r.state=function(e,t){if(!e.hasAttr("type")||"error"!==e.attrString("type"))return e.hasAttr("has_more_patches")?(__LOG__(2)`syncd: collection ${t} got server code has_mode_patches`,a.CollectionState.SuccessHasMore):(__LOG__(2)`syncd: collection ${t} did not get server error`,a.CollectionState.Success);{const r=e.child("error"),n=r.attrString("code"),i=r.attrString("text");switch(__LOG__(2)`syncd: collection ${t} got server error: ${n}`,n){case"409":return e.hasAttr("has_more_patches")?a.CollectionState.ConflictHasMore:a.CollectionState.Conflict;case"400":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;case"404":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;default:return __LOG__(3,void 0,void 0,!0)`syncd: retryable error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: retryable error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorRetry}}}(e,r.name),e.hasAttr("version")&&(r.version=parseInt(e.attrString("version"),10)),e.hasChild("patches")&&(r.patches=e.child("patches").mapChildrenWithTag("patch",(e=>(0,o.decodeSyncdPatch)(n,e.contentBytes())))),e.hasChild("snapshot")&&(r.snapshot=(0,o.decodeExternalBlobReference)(n,e.child("snapshot").contentBytes())),t.push(r),null==r.version&&null==r.patches&&null==r.snapshot&&__LOG__(2)`syncd: collection ${n} has no version, patches or snapshot`,__LOG__(2)`syncd: successfully parsed collection ${n}`})),t}));t.syncResponseParser=c},23026:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.serverSync=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(29938),o=r(24747),s=r(45606),l=r(58597),c=n(r(73407)),d=n(r(11339)),u=n(r(34089)),p=r(61107),f=r(85156),_=n(r(78375));function h(){return(h=(0,i.default)((function*(e){let t=[],r=[...e],n=0;for(;(n<5||r.length>0&&n<500)&&0!==r.length;){const{doneCollections:e,refetchCollections:i}=yield g(r);r=i,t=t.concat(e),n++}return r.length>0&&(__LOG__(4,void 0,new Error,!0,["syncd"])`syncd: reached max iterations for collections: ${r}`,SEND_LOGS("syncd: max iteration"),t=t.concat(r.map((e=>({state:s.CollectionState.ErrorRetry,name:e}))))),t}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if(0===e.length)return{doneCollections:[],refetchCollections:[]};try{const{collectionDetails:t,localCollectionVersions:r,collectionsToUpload:n}=yield y(e);n.length>0&&__LOG__(2)`syncd: deferred local mutation upload for ${n}`,__LOG__(2)`syncd: local collection versions:`,r.forEach(((e,t)=>{__LOG__(2)`\n\t${t} v${null!=e?e:"(undefined)}"}`}));const o=[],l=[];t.forEach((e=>{switch(e.state){case s.CollectionState.ErrorRetry:case s.CollectionState.ErrorFatal:case s.CollectionState.Blocked:return void l.push(e);default:o.push(e)}e.state!==s.CollectionState.Conflict&&e.state!==s.CollectionState.ConflictHasMore||_.default.incConflict()})),__LOG__(2)`syncd: start apply collections: ${o.map((e=>e.name))}`;const d=yield Promise.all(o.map((e=>(0,a.applyAppStateSyncResponse)(e,r.get(e.name)))));__LOG__(2)`syncd: end apply collections: ${o.map((e=>e.name))}`;const u=[];return yield Promise.all(d.map(function(){var e=(0,i.default)((function*(e){if(e.state===s.CollectionState.Conflict){(yield c.default.hasPendingMutationForCollection(e.name))?u.push(e.name):(e.state=s.CollectionState.Success,l.push(e))}else e.state===s.CollectionState.ConflictHasMore||e.state===s.CollectionState.SuccessHasMore||e.state===s.CollectionState.Success&&n.some((t=>t===e.name))?u.push(e.name):l.push(e)}));return function(){return e.apply(this,arguments)}}())),{doneCollections:l,refetchCollections:u}}catch(t){if(t instanceof f.SyncdFatalError){__LOG__(4,void 0,new Error,!0)`syncd: fatal error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: fatal error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorFatal,name:e}))),refetchCollections:[]}}__LOG__(3,void 0,void 0,!0)`syncd: retryable error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: retryable error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorRetry,name:e,serverBackoff:t.errorBackoff}))),refetchCollections:[]}}}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const{syncIqNode:t,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n,localCollectionVersions:i,collectionsToSkip:a}=yield(0,u.default)(e);(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.REQUEST_BUILT),__LOG__(2)`syncd: sending sync request for collections: ${e.map((e=>{var t,n,a;return`\n\t${e} v${null!==(t=i.get(e))&&void 0!==t?t:"(undefined)"} ${(null!==(n=null===(a=r.get(e))||void 0===a?void 0:a.length)&&void 0!==n?n:0)>0&&null!=i.get(e)?" with local changes":""}`}))}`;const s=yield(0,o.sendIq)(t,p.syncResponseParser);if(__LOG__(2)`syncd: completed network operation for collections: ${e}`,(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_RECEIVED),s.success){(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_PARSED_VALID);const e=s.result;return __LOG__(2)`syncd: received sync response for collections: ${e.map((e=>{let t=`\n${e.name}`;return null!=e.version&&(t+=`\n\tupdated to version ${e.version}`),null!=e.snapshot&&(t+="\n\tcontains snapshot"),null!=e.patches&&(t+=`\n\tcontains ${e.patches.length} patches`),t}))}`,e.forEach((e=>{const t=r.get(e.name);t&&(e.syncedPendingMutationsId=t);const i=n.get(e.name);i&&(e.syncedEncryptedMutations=i)})),{collectionDetails:e,localCollectionVersions:i,collectionsToUpload:a}}const{errorCode:c,errorText:f,errorBackoff:_}=s;throw S(c,f,_)}))).apply(this,arguments)}function S(e,t,r){switch(e){case 400:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 404:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 405:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 406:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);default:return new f.SyncdRetryableError(t,r)}}},68254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleFatalError=function(){return m.apply(this,arguments)},t.uploadFatalErrorMetric=function(){return y.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=(r(45606),r(88102)),s=r(86945),l=r(65044),c=n(r(11339)),d=r(83578),u=r(93824),p=r(13983),f=r(89751),_=r(92844),h=r(52613);const g=(0,_.unixTime)();function m(){return(m=(0,a.default)((function*(e){__LOG__(2)`syncd: starting fatal flow for ${e}`;const t=(0,s.getABPropConfigValue)("should_deregister_on_syncd_fatal"),n=r(48277).default;let i=[];null!=e&&(i=e.map((e=>String(e)))),yield(0,h.asyncSleep)(5e3),__LOG__(2)`syncd: start notifying primary on fatal error`,yield(0,p.sendAppStateFatalExceptionNotification)(i),__LOG__(2)`syncd: end notifying primary on fatal error`,!1!==t?(__LOG__(4,!0,new Error)`syncd: Received fatal error and logged out`,l.Socket.logout(!1,d.LogoutReason.SyncdFailure)):n.isSyncDCriticalDataSyncInProcess()?(__LOG__(4,!0,new Error,!0)`syncd: critical sync failed during bootstrap`,SEND_LOGS("syncd: critical sync failed during bootstrap"),l.Socket.logout(!1,d.LogoutReason.SyncdErrorDuringBootstrap)):(__LOG__(4,!0,new Error)`syncd: Received fatal error and showed fatal flag`,(0,f.updateSyncdDisabledDueToFatalFlag)(!0),o.Cmd.handleFatalError())}))).apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t,n,a){const o=r(48277).default;let l={mdFatalErrorCode:e,collection:t?(0,u.collectionNameToMetric)(t):void 0,isBootstrap:o.isSyncDCriticalDataSyncInProcess()};null==n&&null==a||(yield(0,s.getABPropConfigValue)("md_app_state_gate_D34336913"))&&(l=(0,i.default)((0,i.default)({},l),{},{timeSinceRefreshMs:1e3*((0,_.unixTime)()-g),patchSnapshotMutationCount:n,patchVersion:a})),new c.default.MdFatalError(l).commit(!0)}))).apply(this,arguments)}},13983:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateFatalExceptionNotification=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=n(r(65212)),s=r(45454),l=r(52407),c=r(99234),d=r(17304),u=r(238);function p(){return(p=(0,i.default)((function*(e){const t={collectionNames:e,timestamp:(0,a.unixTimeMs)()},r=new o.default({fromMe:!0,remote:(0,c.getMeUser)(),id:o.default.newId()}),n=new d.Msg({id:r,to:(0,s.createDeviceWidFromUserAndDevice)((0,c.assertGetMe)().user,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:t});return yield(0,u.storePeerMessages)([n]),(0,l.encryptAndSendKeyMsg)(n)}))).apply(this,arguments)}},12600:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllOrphansAndUnsupported=function(){return g.apply(this,arguments)},t.checkOrphanChats=p,t.checkOrphanMessages=d,t.checkOrphanMutations=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(29938),o=r(89751),s=r(45606),l=n(r(73407));function c(){return(c=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();yield Promise.all([d(e),p(t)])}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Msg)}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Chat)}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();const r=yield l.default.getSyncActionsRows(["modelId","modelType","actionState"],e.map((e=>[e,t,s.SyncActionState.Orphan])));yield(0,a.applyIndividualMutations)(r)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){if((0,o.isSyncdDisabled)())return Promise.resolve();__LOG__(2)`syncd: start applyAllOrphansAndUnsupported`;const e=yield l.default.getSyncActionsRows(["actionState"],[s.SyncActionState.Orphan,s.SyncActionState.Unsupported]);yield(0,a.applyIndividualMutations)(e),__LOG__(2)`syncd: end applyAllOrphansAndUnsupported`}))).apply(this,arguments)}},37933:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(73407)),s=n(r(40108)),l=r(38804);function c(){return(c=(0,i.default)((function*(){const e=yield s.default.getSentinelMutations();return yield o.default.appendPendingMutationsRows(e),(0,l.markCollectionsForSync)(Array.from(a.CollectionName.members()))}))).apply(this,arguments)}},38804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SYNCD_INTERNAL_TABLES_TO_LOCK=void 0,t.initialize=function(){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,y.isSyncdDisabled)()?Promise.resolve():(function(){const e=6e4,t=(0,o.default)((0,a.default)((function*(){const e=yield(0,S.getSyncActionsTable)().count();v.default.setStoredMutationCount(e);const t=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Malformed);v.default.setInvalidActionCount(t.length);const r=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Unsupported);v.default.setUnsupportedActionCount(r.length);const n=yield d.default.getMissingKeyCount();v.default.setMissingKeyCount(n)})),e,{maxWait:3*e});E.Cmd.on(E.APP_STATE_SYNC_COMPLETED,t)}(),G(),l.default.loadStatesFromDb().then((()=>K())));return Promise.reject(new Error("This call is only supported in MD mode"))},t.lockForSync=function(e,t,r){const n=(0,f.getStorage)().lock([...e,...A],(e=>Promise.all([d.default.appendPendingMutationsRows(t),r(e)]))).then((()=>{D(t.map((e=>e.collection)))}));return Promise.resolve(n)},t.markCollectionsForSync=D,t.sanitizeActionInSyncActionsRow=G,t.syncBlockedCollections=function(){const e=l.default.getCollectionsInStateBlocked();return __LOG__(2)`syncd: sync blocked collections: ${e}`,l.default.moveCollectionsToDirty(e),O=new Set([...Array.from(O),...Array.from(M)]),__LOG__(2)`syncd: syncBlockedCollections:
\tmoving blocked collections to dirty: [${e}]
\tadding inflight collections to pending: [${Array.from(M)}]`,F()};var i=n(r(81109)),a=n(r(48926)),o=n(r(23279)),s=r(7293),l=n(r(11681)),c=r(45606),d=n(r(73407)),u=n(r(11339)),p=r(23026),f=r(99069),_=n(r(17072)),h=r(41796),g=r(12600),m=r(68254),y=r(89751),E=r(88102),S=r(76214),v=n(r(78375)),T=r(58052),C=r(58597);const A=["pending-mutations"];t.SYNCD_INTERNAL_TABLES_TO_LOCK=A;const b=36e5;let P,M=new Set,O=new Set,I=!1,w=0,R=0;if((0,h.isConnectedToPage)()){const e=r(8080).Stream,t=r(8080).StreamMode;(0,_.default)(e,"change:mode",(()=>e.mode===t.MAIN)).then((()=>{s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&!(0,y.isSyncdDisabled)()&&((0,g.applyAllOrphansAndUnsupported)(),__LOG__(2)`syncd: syncing pending mutations and blocked collections due to app resume`,function(){Y.apply(this,arguments)}())}))}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const r=null!=t?yield L(e,t):e;return __LOG__(2)`syncd: marking for sync: ${r}`,r.forEach((e=>{const t=l.default.getCollectionState(e);__LOG__(2)`syncd: ${e} state before sync: ${t}`,t===c.CollectionSyncState.UpToDate?l.default.moveCollectionsToDirty([e]):t===c.CollectionSyncState.Dirty&&(O=new Set([...Array.from(O),e]))})),yield l.default.persistToDb(),F()}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t){__LOG__(2)`syncd: start filter collections: ${e}`;const r=yield d.default.getCollectionVersions(e);return e.filter((e=>{const n=r.get(e);if(null==n)return __LOG__(2)`syncd: local version for ${e} missing; will mark for sync.`,!0;const i=t.get(e);return null==i?(__LOG__(2)`syncd: server version for ${e} missing; will mark for sync.`,!0):n<i?(__LOG__(2)`syncd: local version (${n}) for ${e} less than server version (${i}); will mark for sync.`,!0):(__LOG__(2)`syncd: local version (${n})for ${e} >= server version (${i}); will not mark for sync.`,!1)}))}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(){if(!(0,T.getMdSyncActionsActionSanitized)()){__LOG__(2)`syncd: sanitizing null 'action' property in sync-actions table`;const e=(yield(0,S.getSyncActionsTable)().all()).filter((e=>null==e.action)).map((e=>{const t=JSON.parse(e.index)[0];return c.Actions.cast(t)?(0,i.default)((0,i.default)({},e),{},{action:t}):(__LOG__(2)`syncd: invalid action ${t}`,(0,i.default)({},e))}));yield d.default.updateSyncActionRows(e),(0,T.setMdSyncActionsActionSanitized)(!0)}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(){if((0,y.isSyncdDisabled)())return Promise.resolve();const e=l.default.getCollectionsInStateDirty();__LOG__(2)`syncd: dirty collections: ${e}`;const t=new Set(e.filter((e=>!M.has(e))));if(0===t.size)return __LOG__(2)`syncd: no collections to sync`,Promise.resolve();let r=[];try{M=new Set([...Array.from(M),...Array.from(t)]),__LOG__(2)`syncd: initiate server sync`,r=yield(0,p.serverSync)(Array.from(t)),__LOG__(2)`syncd: server sync successful`;const e=r.filter((e=>e.state===c.CollectionState.ErrorRetry));e.length>0&&(R=e[0].serverBackoff||0,w=0),j(r)}catch(e){l.default.moveCollectionsToFiniteRetry(Array.from(t))}finally{l.default.persistToDb(),M=new Set(Array.from(M).filter((e=>!t.has(e)))),K(),E.Cmd.trigger(E.APP_STATE_SYNC_COMPLETED,r)}}))).apply(this,arguments)}function B(){if((0,y.isSyncdDisabled)())return;const e=new Set(l.default.getCollectionsInStateRetry());var t,r;0!==e.size&&(P=setTimeout((0,a.default)((function*(){try{I=!0,w+=1,__LOG__(2)`syncd: initiate server sync retry`;const t=yield(0,p.serverSync)(Array.from(e));__LOG__(2)`syncd: server sync retry successful`,j(t)}catch(t){l.default.moveCollectionsToFiniteRetry(Array.from(e))}finally{!function(){const e=l.default.getExpiredCollections();e.length>0&&(l.default.moveCollectionsToFatal(e),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: expired collections`,SEND_LOGS("syncd: fatal error: expired collections"),new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D}).commit())}(),l.default.persistToDb(),I=!1,K()}})),(t=w,r=R,Math.min(Math.max(2**t*1e3,r),b))))}function K(){if(__LOG__(2)`syncd: state machine tick`,l.default.getCollectionsInStateDirty().length>0&&(O=new Set(Array.from(O).filter((e=>M.has(e)))),F()),l.default.getCollectionsInStateRetry().length>0){if(I)return void __LOG__(2)`syncd: retry is in flight`;null!=P&&clearTimeout(P),B()}l.default.getCollectionsInStateFatal().length>0&&(0,m.handleFatalError)(l.default.getCollectionsInStateFatal())}function j(e){return e.forEach((e=>e.state!==c.CollectionState.Success||O.has(e.name)?e.state===c.CollectionState.ErrorRetry?((0,C.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ENTERED_RETRY_MODE),l.default.moveCollectionsToFiniteRetry([e.name])):e.state===c.CollectionState.ErrorFatal?l.default.moveCollectionsToFatal([e.name]):e.state!==c.CollectionState.Blocked||O.has(e.name)?void 0:l.default.moveCollectionsToBlocked([e.name]):l.default.moveCollectionsToUpToDate([e.name])))}function Y(){return(Y=(0,a.default)((function*(){__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections`;const e=yield d.default.getAllPendingMutationsRows(),t=l.default.getCollectionsInStateBlocked();l.default.moveCollectionsToDirty(t);const r=e.map((e=>e.collection)).concat(t);r.length>0&&(__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections: [${r}]`,D(r))}))).apply(this,arguments)}},89751:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isSyncdDisabled=function(){return"true"===(0,i.default)(a.default,"localStorage").getItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL)},t.updateSyncdDisabledDueToFatalFlag=function(e){(0,i.default)(a.default,"localStorage").setItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL,e.toString())};var i=n(r(45095)),a=n(r(92417)),o=r(72407)},85156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionCheckError=t.SyncdRetryableError=t.SyncdMissingKeyError=t.SyncdFatalError=void 0;class r extends Error{constructor(){super(...arguments),this.name="SyncdMissingKeyError"}}t.SyncdMissingKeyError=r;class n extends Error{constructor(e,t){super(e),this.name="SyncdRetryableError",this.backoff=t,this.message=e}}t.SyncdRetryableError=n;class i extends Error{constructor(e){super(e),this.name="SyncdFatalError",this.message=e}}t.SyncdFatalError=i;class a extends Error{constructor(){super(...arguments),this.name="SyncdVersionCheckError"}}t.SyncdVersionCheckError=a},93824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.collectionNameToMetric=function(e){switch(e){case s.CollectionName.CriticalBlock:return l.default.COLLECTION.CRITICAL_BLOCK;case s.CollectionName.CriticalUnblockLow:return l.default.COLLECTION.CRITICAL_UNBLOCK_LOW;case s.CollectionName.Regular:return l.default.COLLECTION.REGULAR;case s.CollectionName.RegularHigh:return l.default.COLLECTION.REGULAR_HIGH;case s.CollectionName.RegularLow:return l.default.COLLECTION.REGULAR_LOW}},t.constructMsgKeySegments=d,t.constructMuteChatKey=function(e){return JSON.stringify([s.Actions.Mute,e.id.remote.toString({legacy:!0})])},t.constructPinChatKey=function(e){return JSON.stringify([s.Actions.Pin,e.id.remote.toString({legacy:!0})])},t.constructStarMsgKey=function(e){return JSON.stringify([s.Actions.Star,...d(e)])},t.constructStarMsgKeyFromMsgKey=function(e){return JSON.stringify([s.Actions.Star,...u(e)])},t.extractParticipantForSync=p,t.getMsgKeyFromStarActionIndex=function(e){const t=JSON.parse(e);if(t.length<5)throw new Error("[sync-action] Star action index malformed, cannot create MsgKey");return new a.default({remote:(0,o.createWid)(t[1]),id:t[2],fromMe:"1"===t[3],participant:"0"===t[4]?void 0:(0,o.createWid)(t[4])})},t.isBootstrap=function(e){return null==e},t.isCriticalCollection=function(e){switch(e){case s.CollectionName.CriticalBlock:case s.CollectionName.CriticalUnblockLow:return!0;case s.CollectionName.Regular:case s.CollectionName.RegularHigh:case s.CollectionName.RegularLow:return!1}},t.logKeysInfoInIntern=function(){return f.apply(this,arguments)},t.uploadCriticalEventMetric=function(e){new l.default.MdCriticalEvent({mdCriticalEventCode:e}).commit()};var i=n(r(48926)),a=(r(63109),n(r(65212))),o=r(45454),s=r(45606),l=n(r(11339)),c=r(76214);function d(e){return u(e.id)}function u(e){const t=p(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function p(e){let t="0";return!e.participant||e.remote.isUser()||e.fromMe||(t=e.participant.toString({legacy:!0})),t}function f(){return(f=(0,i.default)((function*(){(yield(0,c.getSyncKeysTable)().all()).forEach((()=>{}))}))).apply(this,arguments)}},35047:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBucket=function(e){if(e<0)throw new Error("cannot convert negative number to a bucket");return 0===e?o.default.MUTATION_COUNT_BUCKET.ZERO:1===e?o.default.MUTATION_COUNT_BUCKET.ONE:e<10?o.default.MUTATION_COUNT_BUCKET.LT10:e<100?o.default.MUTATION_COUNT_BUCKET.LT100:e<500?o.default.MUTATION_COUNT_BUCKET.LT500:e<1e3?o.default.MUTATION_COUNT_BUCKET.LT1K:e<5e3?o.default.MUTATION_COUNT_BUCKET.LT5K:o.default.MUTATION_COUNT_BUCKET.GTE5K},t.generateActionStatCounts=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(11339)),s=r(34296);function l(){return(l=(0,i.default)((function*(){const e=new Map;return(yield(0,s.getTable)().all()).map((t=>{var r;const n=JSON.parse(t.index)[0],i=null!==(r=e.get(n))&&void 0!==r?r:{action:n,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(t.actionState){case a.SyncActionState.Success:case a.SyncActionState.Skipped:i.applied++;break;case a.SyncActionState.Malformed:i.invalid++;break;case a.SyncActionState.Orphan:i.orphan++;break;case a.SyncActionState.Unsupported:i.unsupported++;break;case a.SyncActionState.Failed:i.failed++}e.set(n,i)})),e}))).apply(this,arguments)}},78375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(57319),a=r(88102),o=n(r(11339));let s=new o.default.MdAppStateSyncDaily;const l=new i.ShiftTimer((function(){const e=function(e){const t=new o.default.MdAppStateSyncDaily;e.mutationCount>0&&(t.mutationCount=e.mutationCount);e.invalidActionCount>0&&(t.invalidActionCount=e.invalidActionCount);e.unsupportedActionCount>0&&(t.unsupportedActionCount=e.unsupportedActionCount);e.keyRotationRemoveCount>0&&(t.keyRotationRemoveCount=e.keyRotationRemoveCount);e.storedMutationCount>0&&(t.storedMutationCount=e.storedMutationCount);e.uploadConflictCount>0&&(t.uploadConflictCount=e.uploadConflictCount);e.unsetActionCount>0&&(t.unsetActionCount=e.unsetActionCount);e.missingKeyCount>0&&(t.missingKeyCount=e.missingKeyCount);return t}(s);c(),e.commit()}));function c(){s=new o.default.MdAppStateSyncDaily}function d(){l.onOrBefore(3e5)}a.Cmd.on("logout",(()=>{l.isScheduled()&&l.forceRunNow()}));var u={clear:c,addMutationCount:function(e){0!==e&&(void 0===s.mutationCount&&(s.mutationCount=0),s.mutationCount+=e,d())},setInvalidActionCount:function(e){s.invalidActionCount=e,d()},setUnsupportedActionCount:function(e){s.unsupportedActionCount=e,d()},incConflict:function(){void 0===s.uploadConflictCount&&(s.uploadConflictCount=0),s.uploadConflictCount++,d()},addKeyRotationRemoveCount:function(e){0!==e&&(void 0===s.keyRotationRemoveCount&&(s.keyRotationRemoveCount=0),s.keyRotationRemoveCount+=e,d())},setStoredMutationCount:function(e){s.storedMutationCount=e,d()},addUnsetActionCount:function(e){0!==e&&(void 0===s.unsetActionCount&&(s.unsetActionCount=0),s.unsetActionCount+=e,d())},setMissingKeyCount:function(e){s.missingKeyCount=e,d()}};t.default=u},49332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyStats=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(66423),s=n(r(96222)),l=r(99234),c=r(28307),d=r(57701),u=r(55975),p=r(14111),f=r(10435),_=n(r(11339)),h=r(76214),g=r(72472),m=r(28826),y=r(75861),E=r(7595);function S(){return(S=(0,a.default)((function*(){const e=v(),t=yield T(),r=yield P(),n=O(),a=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e),t),r),n),s=new _.default.Daily;s.set(a),s.commit(),(0,E.logDailyPrivateStatsTestEvents)();const l=o.DailyAggregatedStatsCollection.toArray().filter((e=>e.shouldBeSubmitted()));o.DailyAggregatedStatsCollection.remove(l),l.forEach((e=>{new _.default.PttDaily({eventTime:e.getEndTime(),pttCancelBroadcast:e.pttCancelBroadcast,pttCancelGroup:e.pttCancelGroup,pttCancelIndividual:e.pttCancelIndividual,pttDraftReviewBroadcast:e.pttDraftReviewBroadcast,pttDraftReviewGroup:e.pttDraftReviewGroup,pttDraftReviewIndividual:e.pttDraftReviewIndividual,pttFastplaybackBroadcast:e.pttFastplaybackBroadcast,pttFastplaybackGroup:e.pttFastplaybackGroup,pttFastplaybackIndividual:e.pttFastplaybackIndividual,pttLockBroadcast:e.pttLockBroadcast,pttLockGroup:e.pttLockGroup,pttLockIndividual:e.pttLockIndividual,pttOutOfChatBroadcast:e.pttOutOfChatBroadcast,pttOutOfChatGroup:e.pttOutOfChatGroup,pttOutOfChatIndividual:e.pttOutOfChatIndividual,pttPlaybackBroadcast:e.pttPlaybackBroadcast,pttPlaybackGroup:e.pttPlaybackGroup,pttPlaybackIndividual:e.pttPlaybackIndividual,pttRecordBroadcast:e.pttRecordBroadcast,pttRecordGroup:e.pttRecordGroup,pttRecordIndividual:e.pttRecordIndividual,pttSendBroadcast:e.pttSendBroadcast,pttSendGroup:e.pttSendGroup,pttSendIndividual:e.pttSendIndividual,pttPausedRecordBroadcast:e.pttPausedRecordBroadcast,pttPausedRecordGroup:e.pttPausedRecordGroup,pttPausedRecordIndividual:e.pttPausedRecordIndividual,pttStopTapBroadcast:e.pttStopTapBroadcast,pttStopTapGroup:e.pttStopTapGroup,pttStopTapIndividual:e.pttStopTapIndividual}).commit()}))}))).apply(this,arguments)}function v(){const e=p.deviceInfo.get();return{languageCode:e.lg,locationCode:e.lc,osBuildNumber:e.osBuild,simMcc:parseInt(e.mcc,10),simMnc:parseInt(e.mnc,10)}}function T(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(){const e=(0,l.getUserPrivacySettings)(),t={receiptsEnabled:"none"!==e.readReceipts};if((0,d.privacySettingsEnabled)()){var r,n,i,a;const o=yield(0,y.queryDisallowedLists)();t.privacySettingsAbout=A(e.about),t.privacySettingsAboutExceptNum="contact_blacklist"===e.about?b(null===(r=o.status)||void 0===r?void 0:r.disallowedList.length):null,t.privacySettingsGroups=A(e.groupAdd),t.privacySettingsGroupsExceptNum="contact_blacklist"===e.groupAdd?b(null===(n=o.groupadd)||void 0===n?void 0:n.disallowedList.length):null,t.privacySettingsLastSeen=A(e.lastSeen),t.privacySettingsLastSeenExceptNum="contact_blacklist"===e.lastSeen?b(null===(i=o.last)||void 0===i?void 0:i.disallowedList.length):null,t.privacySettingsProfilePhoto=A(e.profilePicture),t.privacySettingsProfilePhotoExceptNum="contact_blacklist"===e.profilePicture?b(null===(a=o.profile)||void 0===a?void 0:a.disallowedList.length):null}if((0,f.isDisappearingModeEnabled)()){var o;const e=(0,l.getMaybeMeUser)(),r=(0,c.getDisappearingModeSettingForUser)(e);t.defaultDisappearingDuration=null!==(o=null==r?void 0:r.duration)&&void 0!==o?o:0}return t}))).apply(this,arguments)}function A(e){if(null==e)return null;switch(e){case"all":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function b(e){return null==e?null:0===e?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0:e<5?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1:e<10?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5:e<15?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10:e<20?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15:e<30?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20:e<40?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30:e<50?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40:e<60?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50:e<70?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60:e<80?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70:e<90?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80:e<100?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(){const e=yield(0,h.getContactTable)().equals(["isAddressBookContact"],1).then((e=>e.length)),t=yield(0,s.default)(),r=yield u.LruMediaStore.count(),n=yield Promise.all([t,e,r]);let i=0,a=0;const o=n[0];return null!=o&&(i=o.available,a=o.quota),{addressbookWhatsappSize:I(n[1],10),storageAvailSize:I(i,100),storageTotalSize:I(a,100),mediaFolderFileCount:n[2]}}))).apply(this,arguments)}function O(){let e=_.default.NOTIFICATION_SETTING_TYPE.UNKNOWN;return null!=window.Notification&&(e=window.Notification.permission===m.PERMISSION_ALLOWED&&g.MuteCollection.getGlobalNotifications()?_.default.NOTIFICATION_SETTING_TYPE.ALLOWED:_.default.NOTIFICATION_SETTING_TYPE.BLOCKED),{osNotificationSetting:e}}function I(e,t){return Math.round(e/t)*t}},42862:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerTasks=function(){_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&((0,a.startScheduler)({scheduledTimeResolver:{get:e=>(0,T.getTaskScheduledTime)(String(e)),set:(e,t)=>(0,T.updateTaskScheduledTime)(String(e),t)}}),A.filter((e=>e!==C.LOG_DB_ROW_COUNTS||!1)).forEach((e=>{const t=function(e){switch(e){case C.MONITOR_DB_STORAGE:return function(){var e=(0,i.default)((function*(){return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case C.CLEAN_TC_TOKENS:return function(){var e=(0,i.default)((function*(e){if(e)__LOG__(2)`CleanTcToken skip first run`;else try{yield(0,u.pruneExpiredTcTokens)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired TcTokens with error: ${e}`}return o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.LOG_DAILY_STATS:return()=>(0,f.logDailyStats)().catch((e=>{__LOG__(4,!0,new Error)`Failed to log daily stats: ${e}`})).then((()=>o.DAY_SECONDS));case C.LOG_DB_ROW_COUNTS:break;case C.ROTATE_KEY:return function(){var e=(0,i.default)((function*(e){return e?__LOG__(2)`RotateKeyTask skip first run`:yield(0,h.getJobManager)().waitUntilCompleted(m.jobSerializers.rotateKey()),27*o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.SYNC_AB_PROPS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,c.syncABPropsTask)()),(0,l.getRefresh)()}));return function(){return e.apply(this,arguments)}}();case C.SYNC_CONTACTS:return function(){var e=(0,i.default)((function*(e){if(!e){try{yield(0,g.getNonAddressBookContactsAndMarkAllContactsDirty)()}catch(e){__LOG__(4,!0,new Error)`Failed to sync non-address book contacts with error: ${e}`}try{yield(0,p.contactSync)()}catch(e){__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}}return(0,S.getContactSyncRefreshSeconds)()}));return function(){return e.apply(this,arguments)}}();case C.REPORT_SYNCD_ACTION_STAT:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,y.reportSyncdStatsJob)()),o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.LT_HASH_CHECK:return function(){var e=(0,i.default)((function*(e){const t=(0,s.getABPropConfigValue)("lthash_check_hours");return 0===t?24*o.HOUR_SECONDS:(e||(yield(0,d.checkLtHash)()),t*o.HOUR_SECONDS)}));return function(){return e.apply(this,arguments)}}();case C.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,E.requestAllSyncdMissingKeysJob)()),6*o.HOUR_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var e=(0,i.default)((function*(e){const t=(0,s.getABPropConfigValue)("syncd_periodic_sync_days");return 0===t?(__LOG__(2)`syncd: syncdPeriodicSyncDays is 0, skipping sync`,o.DAY_SECONDS):(e||(yield(0,v.syncdSyncAllCollectionsJob)()),o.DAY_SECONDS*t)}));return function(){return e.apply(this,arguments)}}()}}(e);null!=t&&(0,a.registerTask)(e,t)})))};var i=n(r(48926)),a=r(2821),o=r(92844),s=r(86945),l=r(64971),c=r(89981),d=r(1377),u=r(48285),p=r(9995),f=r(49332),_=r(7293),h=r(68819),g=r(24872),m=r(6684),y=r(66101),E=r(4454),S=r(66837),v=r(5474),T=r(60998);const C=r(76672)({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections"}),A=[C.CLEAN_TC_TOKENS,C.LOG_DAILY_STATS,C.LOG_DB_ROW_COUNTS,C.ROTATE_KEY,C.SYNC_AB_PROPS,C.SYNC_CONTACTS,C.MONITOR_DB_STORAGE,C.REPORT_SYNCD_ACTION_STAT,C.LT_HASH_CHECK,C.REQUEST_ALL_SYNCD_MISSING_KEYS,C.SYNCD_SYNC_ALL_COLLECTIONS]},47473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByCountry=function(e){var t;return!!(0,i.countryGatingEnabled)()&&((null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===a.HostStorageEnumType.Facebook&&!(0,n.getFbBrandedNumber)(e.id.user))};var n=r(32990),i=r(57701),a=r(49714)},70768:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TosManager=t.TOS_3_ID=void 0;var a=i(r(48926)),o=r(13959),s=i(r(34342)),l=r(91903),c=r(99234),d=r(57701),u=r(72407),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(53055)),f=r(99684),_=r(77591);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}const g="20210210";t.TOS_3_ID=g;const m={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:(new n).signal};class y extends s.default{constructor(){super(...arguments),this._noticeIds=[g],this._refreshInterval=864e5}getState(e){const t=this._getStoreKey(e);return p._getUser(t)||"UNKNOWN"}setState(e,t){if((0,d.tosFetchEnabled)()){new Set(this._noticeIds).has(e)?(p._setUser(this._getStoreKey(e),t),this.trigger("change")):__LOG__(3)`ToS state manager unrecognized user notice id: ${e}`}}run(){var e=this;return(0,a.default)((function*(){if((0,d.tosFetchEnabled)()){try{yield(0,l.exponentialBackoff)(m,((t,r)=>e._query().catch((e=>{if(e instanceof _.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`ToS state manager query failed, retriable error: ${e.errorMessage}, failCount ${r}`,t(e)}throw e}))))}catch(e){if(__LOG__(4,!0,new Error,!0)`ToS state manager state pull failed, error: ${e}`,SEND_LOGS("ToS state manager run failed"),!(e instanceof _.ServerStatusCodeError&&500===e.statusCode))return}if(e._getNoticeIdsToRun().length>0){const t=(0,c.getMaybeMeUser)();yield(0,o.delayMs)(e._refreshInterval),(0,c.getMaybeMeUser)()===t&&e.run()}}}))()}_query(){var e=this;return(0,a.default)((function*(){if(!(0,c.getMaybeMeUser)())return;const t=e._getNoticeIdsToRun();if(t.length>0){const r=yield(0,f.queryTosState)(t);e._refreshInterval=1e3*r.refresh;const n=new Set(e._noticeIds);let i=!1;r.notice.filter((e=>n.has(e.id))).forEach((t=>{const r=t.state?"ACCEPTED":"NOT_ACCEPTED",n=e._getStoreKey(t.id);p._getUser(n)!==r&&(p._setUser(n,r),i=!0)})),p._setUser(u.KEYS.TOS_STATE_FETCH_ITERATION,(0,d.tosFetchIteration)()),i&&e.trigger("change")}}))()}_getNoticeIdsToRun(){const e=parseInt(p._getUser(u.KEYS.TOS_STATE_FETCH_ITERATION),10)||0;if((0,d.tosFetchIteration)()>e)return this._noticeIds;const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((e,r)=>"ACCEPTED"!==t[r]))}_getStoreKey(e){switch(e){case g:return u.KEYS.TOS_3}throw new Error("Unknown user notice id: "+e)}maybeUpdateServer(e){var t=this;return(0,a.default)((function*(){if((0,d.tosFetchEnabled)())try{const r=new Set(e);yield(0,l.exponentialBackoff)(m,((e,n)=>{const i=t._getAcceptedNoticeIds(r);return i.length>0?(0,f.updateTosState)(i).catch((t=>{if(t instanceof _.ServerStatusCodeError&&500===t.statusCode)return __LOG__(3)`ToS state manager server session state update failed, retriable error: ${t.errorMessage}, failCount ${n}`,e(t);throw t})):Promise.resolve()}))}catch(e){__LOG__(4,!0,new Error,!0)`ToS state manager server session state update failed, error: ${e}`,SEND_LOGS("ToS state manager server session state update failed")}}))()}_getAcceptedNoticeIds(e){if((0,c.getMaybeMeUser)()){const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((r,n)=>"ACCEPTED"===t[n]&&e.has(r)))}return[]}resetTosState(){}}const E=new y;t.TosManager=E},37894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByTos=l,t.shouldBlockByTosB2C=function(e,t){if((0,a.tos3GatingEnabledB2C)()&&l(e)&&t)return t.type!==n.MSG_TYPE.DEBUG&&t.type!==n.MSG_TYPE.E2E_NOTIFICATION&&t.type!==n.MSG_TYPE.NOTIFICATION_TEMPLATE&&!t.isSentByMe;return!1};var n=r(15461),i=r(32990),a=r(57701),o=r(49714),s=r(70768);function l(e){var t;if((0,a.tos3GatingEnabled)()&&("NOT_ACCEPTED"===s.TosManager.getState(s.TOS_3_ID)&&(null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===o.HostStorageEnumType.Facebook&&!(0,i.getFbBrandedNumber)(e.id.user)))return!0;return!1}},66577:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncBusinessProtocol=void 0,t.businessParser=function(e){e.assertTag("business");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("verified_name");return{verifiedName:r?(0,a.default)(r):null}};var i=r(31914),a=n(r(27874));t.USyncBusinessProtocol=class{getQueryElement(){return(0,i.wap)("business",null,(0,i.wap)("verified_name",null))}getUserElement(){return null}}},93967:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncContactProtocol=void 0,t.contactParser=function(e){e.assertTag("contact");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{type:e.attrString("type")}};var n=r(31914);t.USyncContactProtocol=class{getQueryElement(){return(0,n.wap)("contact",null)}getUserElement(e){const t=e.getPhone();return t?(0,n.wap)("contact",null,t):null}}},81051:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDeviceProtocol=void 0,t.deviceParser=function(e){e.assertTag("devices");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("key-index-list"),n=e.maybeChild("device-list"),i=null==r?null:{ts:r.attrTime("ts"),signedKeyIndexBytes:r.hasContent()?r.contentBytes():null,expectedTs:r.hasAttr("expected_ts")?r.attrTime("expected_ts"):void 0};return{deviceList:null==n?void 0:n.mapChildrenWithTag("device",(e=>({id:e.attrInt("id"),keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null}))),keyIndex:i}};var n=r(31914),i=r(86945);t.USyncDeviceProtocol=class{getQueryElement(){return(0,n.wap)("devices",{version:(0,n.CUSTOM_STRING)(String(2))})}getUserElement(e){const t=e.getDeviceHash(),r=e.getTs(),a=e.getExpectedTs();return t||null!=r||null!=a?(0,n.wap)("devices",{device_hash:t?(0,n.CUSTOM_STRING)(t):n.DROP_ATTR,ts:null!=r?(0,n.INT)(r):n.DROP_ATTR,expected_ts:(0,i.getABPropConfigValue)("adv_v2_m4_m5")&&null!=a?(0,n.INT)(a):n.DROP_ATTR}):null}}},3776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDisappearingModeProtocol=void 0,t.disappearingModeParser=function(e){e.assertTag("disappearing_mode");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.attrInt("duration",0),n=e.attrInt("t");return{duration:r,t:n}};var n=r(31914);t.USyncDisappearingModeProtocol=class{getQueryElement(){return(0,n.wap)("disappearing_mode",null)}getUserElement(){return null}}},35564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncFeaturesProtocol=void 0,t.featureParser=function(e){e.assertTag("feature");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r={};return Object.keys(i).forEach((t=>{const n=e.maybeChild(t);n&&(r[t]=n.attrString("value"))})),r};var n=r(31914);const i={document:(0,n.wap)("document",null),encrypt:(0,n.wap)("encrypt",null),encrypt_blist:(0,n.wap)("encrypt_blist",null),encrypt_contact:(0,n.wap)("encrypt_contact",null),encrypt_group_gen2:(0,n.wap)("encrypt_group_gen2",null),encrypt_image:(0,n.wap)("encrypt_image",null),encrypt_location:(0,n.wap)("encrypt_location",null),encrypt_url:(0,n.wap)("encrypt_url",null),encrypt_v2:(0,n.wap)("encrypt_v2",null),voip:(0,n.wap)("voip",null),multi_agent:(0,n.wap)("multi_agent",null)};t.USyncFeaturesProtocol=class{constructor(e){if(this.queries=e,0===e.length)throw new Error("must specify at least one query")}getQueryElement(){return(0,n.wap)("feature",null,this.queries&&this.queries.map((e=>i[e])))}getUserElement(){return null}}},52284:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncQuery=t.USYNC_SUPPORT_TYPE=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=n(r(89867)),c=r(66577),d=r(24747),u=r(93967),p=r(81051),f=r(3776),_=r(35564),h=r(60226),g=r(85880),m=r(39410);const y={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode"};t.USYNC_SUPPORT_TYPE=y;const E={feature:_.featureParser,devices:p.deviceParser,contact:u.contactParser,picture:h.pictureParser,status:g.statusParser,business:c.businessParser,disappearing_mode:f.disappearingModeParser};function S(e){const t=[];return e.forEachChildWithTag("user",(e=>{const r={};e.hasAttr("jid")&&(Object.keys(y).forEach((t=>{const n=y[t],i=e.maybeChild(n);i&&E[n]&&(r[n]=E[n](i))})),r.id=(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")),t.push(r))})),t}const v=new o.WapParser("usyncParser",(e=>{e.assertAttr("type","result");const t={error:{},refresh:{},list:[],sideList:[]},r=e.child("usync"),n=r.child("result"),i=r.child("list"),a=r.maybeChild("side_list");return Object.keys(y).forEach((e=>{const r=y[e],i=n.maybeChild(r);if(i){const e=i.maybeChild("error");e?t.error[r]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:i.hasAttr("refresh")&&(t.refresh[r]=i.attrInt("refresh",0))}})),t.list=S(i),a&&(t.sideList=S(a)),__LOG__(2)`usync query success!`,t}));t.USyncQuery=class{constructor(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}withMode(e){return this.mode=e,this}withContext(e){return this.context=e,this}withContactProtocol(){return this.protocols.push(new u.USyncContactProtocol),this}withBusinessProtocol(){return this.protocols.push(new c.USyncBusinessProtocol),this}withDeviceProtocol(){return this.protocols.push(new p.USyncDeviceProtocol),this}withDisappearingModeProtocol(){return this.protocols.push(new f.USyncDisappearingModeProtocol),this}withPictureProtocol(){return this.protocols.push(new h.USyncPictureProtocol),this}withStatusProtocol(){return this.protocols.push(new g.USyncStatusProtocol),this}withFeaturesProtocol(e){return this.protocols.push(new _.USyncFeaturesProtocol(e)),this}withUser(e){return this.users.push(e),this}_buildStanza(){if(0===this.protocols.length)throw new Error("a usync query must have at least one protocol");const e=this.users.filter((e=>{const t=e.getId();return(!t||!l.default.isServer(t))&&e.validate()}));0===e.length&&__LOG__(3)`Usync warning: a usync query must have at least one user`;const t=(0,a.wap)("query",null,this.protocols.map((e=>e.getQueryElement()))),r=e.map((e=>{const t=e.getId();return(0,a.wap)("user",{jid:t?(0,m.USER_JID)(t):a.DROP_ATTR},this.protocols.map((t=>t.getUserElement(e))))})),n=(0,a.wap)("list",null,r);return(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"usync",type:"get",id:(0,a.generateId)()},(0,a.wap)("usync",{sid:(0,a.generateId)(),index:"0",last:"true",mode:(0,a.CUSTOM_STRING)(this.mode),context:(0,a.CUSTOM_STRING)(this.context)},t,n))}execute(){var e=this;return(0,i.default)((function*(){const t=e._buildStanza(),r=yield(0,d.sendIq)(t,v);return r.success?r.result:{error:{all:{errorCode:r.errorCode,errorText:r.errorText,errorType:r.errorType}},refresh:{},list:[]}}))()}}},60226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncPictureProtocol=void 0,t.pictureParser=function(e){e.assertTag("picture");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{id:e.attrInt("id")}};var n=r(31914);t.USyncPictureProtocol=class{getQueryElement(){return(0,n.wap)("picture",null)}getUserElement(){return null}}},85880:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncStatusProtocol=void 0,t.statusParser=function(e){e.assertTag("status");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};if(!e.hasContent())return e.hasAttr("code")&&401===e.attrInt("code")?null:i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString();return 0!==e.contentString().length?e.contentString():i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString()};var n=r(31914),i=r(48360);t.USyncStatusProtocol=class{getQueryElement(){return(0,n.wap)("status",null)}getUserElement(){return null}}},79942:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncUser=void 0;var n=r(47685);t.USyncUser=class{withId(e){return this._id=e,this}withDeviceHash(e){return this._deviceHash=e,this}withTs(e){return this._ts=e,this}withExpectedTs(e){return this._expectedTs=e,this}withPhone(e){return this._phone=e,this}getDeviceHash(){return this._deviceHash}getPhone(){return this._phone}getId(){return this._id}getTs(){return this._ts}getExpectedTs(){return this._expectedTs}validate(){const{_id:e,_phone:t}=this;if(null==e&&null==t)throw new Error("user must have an id or a phone");if(e){const t=(0,n.validateWid)(e.toString());return t||__LOG__(3)`USync user created with invalid jid: ${e.toString()}`,t}return!0}}},36129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(8584);class i{static tag(e){return null==e?void 0:e[0]}static attr(e,t){return(null==t?void 0:t[1])?t[1][e]:void 0}static attrs(e){return e[1]}static child(e,t){const r=t[2];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;n++){const t=r[n];if(Array.isArray(t)&&t[0]===e)return t}}}static firstChild(e){const t=e[2];if(Array.isArray(t))return t[0]}static children(e,t){if(!t)return null==e?void 0:e[2];const r=e[2];return Array.isArray(r)?r.filter((e=>e[0]===t)):void 0}static dataStr(e){if(!e)return"";const t=e[2];return"string"==typeof t?t:t instanceof ArrayBuffer?new n.Binary(t).readString(t.byteLength):""}static toString(e,t){if(!e)return"undefined";const r=function(e,t){if(e){let r="";for(const n in e){r+=" "+n+"="+("string"==typeof e[n]?t?"...":'"'+e[n]+'"':e[n])}return r}return""}(e[1],t),n=function(e,t){if(e instanceof ArrayBuffer)return"<<bin:"+e.byteLength+">>";if("string"==typeof e)return t?"<<string:"+e.length+">>":e;if(Array.isArray(e))return e.map((e=>i.toString(e,t))).join("\n");return""}(e[2],t);return"<"+e[0]+r+(n?">\n"+n+"\n</"+e[0]+">":"/>")}}t.default=i},41090:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(21224),i={voipIndividualOutgoing:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3Create:n.WebFeaturesFlag.DEVELOPMENT,changeNumberV2:n.WebFeaturesFlag.FORCE_UPGRADE,queryStatusV3Thumbnail:n.WebFeaturesFlag.DEVELOPMENT,liveLocations:n.WebFeaturesFlag.FORCE_UPGRADE,queryVname:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualIncoming:n.WebFeaturesFlag.FORCE_UPGRADE,quickRepliesQuery:n.WebFeaturesFlag.FORCE_UPGRADE,payments:n.WebFeaturesFlag.FORCE_UPGRADE,labelsDisplay:n.WebFeaturesFlag.FORCE_UPGRADE,labelsEdit:n.WebFeaturesFlag.FORCE_UPGRADE,stickerPackQuery:n.WebFeaturesFlag.FORCE_UPGRADE,liveLocationsFinal:n.WebFeaturesFlag.FORCE_UPGRADE,mediaUpload:n.WebFeaturesFlag.FORCE_UPGRADE,vnameV2:n.WebFeaturesFlag.FORCE_UPGRADE,videoPlaybackUrl:n.WebFeaturesFlag.FORCE_UPGRADE,statusRanking:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualVideo:n.WebFeaturesFlag.DEVELOPMENT,thirdPartyStickers:n.WebFeaturesFlag.FORCE_UPGRADE,frequentlyForwardedSetting:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickers:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickersV2:n.WebFeaturesFlag.PRODUCTION,recentStickersV3:n.WebFeaturesFlag.PRODUCTION,groupsV4JoinPermission:n.WebFeaturesFlag.FORCE_UPGRADE,catalog:n.WebFeaturesFlag.FORCE_UPGRADE,starredStickers:n.WebFeaturesFlag.PRODUCTION,templateMessage:n.WebFeaturesFlag.PRODUCTION,templateMessageInteractivity:n.WebFeaturesFlag.DEVELOPMENT,ephemeralMessages:n.WebFeaturesFlag.PRODUCTION,e2ENotificationSync:n.WebFeaturesFlag.FORCE_UPGRADE,syncdRelease1:n.WebFeaturesFlag.PRODUCTION,userNotice:n.WebFeaturesFlag.PRODUCTION,syncdRelease11:n.WebFeaturesFlag.PRODUCTION,support:n.WebFeaturesFlag.PRODUCTION,groupUiiCleanup:n.WebFeaturesFlag.FORCE_UPGRADE,groupDogfoodingInternalOnly:n.WebFeaturesFlag.DEVELOPMENT,settingsSync:n.WebFeaturesFlag.PRODUCTION,ephemeral24HDuration:n.WebFeaturesFlag.DEVELOPMENT,archiveV2:n.WebFeaturesFlag.PRODUCTION,mdForceUpgrade:n.WebFeaturesFlag.FORCE_UPGRADE,disappearingMode:n.WebFeaturesFlag.PRODUCTION,externalMdOptInAvailable:n.WebFeaturesFlag.PRODUCTION,noDeleteMessageTimeLimit:n.WebFeaturesFlag.DEVELOPMENT};t.default=i},80208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSync=t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=t.DISAPPEARING_MODE_SETTINGS_KEY=t.ARCHIVE_SETTINGS_KEY=void 0;var i=n(r(41609));const a="archive";t.ARCHIVE_SETTINGS_KEY=a;const o="disappearing_mode";t.DISAPPEARING_MODE_SETTINGS_KEY=o;const s="md_opt_in_deadline";t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=s;const l={querySettings:function(e){return new Promise(((t,r)=>{const n=this.queryNode({type:"settings"},void 0),a=e?"query,settings,resume":"query,settings";this.binSend("sendEphemeral",n,r,{onSend:this.binWrap((e=>{this.BinaryProtocol.read(e).then((e=>{const r={settings:[],status:parseInt(this.N.attr("code",e),10)||200};if(__LOG__(2)`bin-recv: response,settings`,"response"===this.N.tag(e)&&"settings"===this.N.attr("type",e)){const t=this.N.children(e);if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=this.parseSetting(t[e]);(0,i.default)(n)||r.settings.push(n)}}t(r)})).catch(r)}),t),onDrop:this.wrap(r),serverCacheable:Boolean(e)},{debugString:a,metricName:"QUERY_SETTINGS"})}))},setArchiveSetting:function(e){return new Promise(((t,r)=>{const n=this.actionNode("set",[["archive_v2",{classic:e.toString()},void 0]]);this.binSend("send",n,r,{clientCacheable:!0,onSend:this.wrap(t),onDrop:this.wrap(r)},{debugString:"action,settings,archive",metrics:"SET_ARCHIVE_SETTING",ackRequest:!0})}))},parseSetting:function(e){switch(this.N.tag(e)){case"archive_v2":return{type:a,value:{classic:"true"===this.N.attr("classic",e),enabled:this.N.attr("enabled",e)&&"true"===this.N.attr("enabled",e)}};case"disappearing_mode":return{type:o,value:{duration:parseInt(this.N.attr("duration",e),10),settingTimestamp:parseInt(this.N.attr("t",e),10)}};case"md_opt_in_deadline":return{type:s,value:{timestamp:parseInt(this.N.attr("t",e),10)}};default:return}}};t.settingsSync=l},56891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.instance}});var i=r(86875);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},78144:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.default.isWid,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.createWid,o=t;switch(e){case"author":case"broadcast":case"chat":case"descOwner":case"from":case"gid":case"id":case"jid":case"owner":case"participant":case"quotedRemoteJid":case"quotedParticipant":case"remote":case"subjectOwner":case"s_o":case"to":case"wid":case"changeNumberNewJid":case"changeNumberOldJid":case"recipient":case"paymentMessageReceiverJid":case"parentGroup":case"revokeSender":r(t)&&(o=n(t));break;default:const i=parseInt(e,10);!isNaN(i)&&r(t)&&(o=n(t))}return o};var i=n(r(89867)),a=r(45454)},77113:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadProtoVersions=function(){return s.apply(this,arguments)},t.protoMap=void 0;var i=n(r(48926)),a=r(46582);const o={};function s(){return(s=(0,i.default)((function*(){const e=yield(0,a.requireLoadProtoVersions)();Object.assign(o,e)}))).apply(this,arguments)}t.protoMap=o},7353:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11865)),a=r(8584);const o={NEW:"REQUEST_STATE_NEW",SENT:"REQUEST_STATE_SENT",WEBDACKED:"REQUEST_STATE_WEBDACKED",WILL_RETRY:"REQUEST_STATE_WILL_RETRY"};class s{constructor(e){this.state=o.NEW,this.age=0,this.resends=0;const t=e.data;this.data=t,this.isToPhone=t instanceof ArrayBuffer,this.tag=e.tag,this.clientCacheable=!!e.clientCacheable,this.serverCacheable=!!e.serverCacheable,this.retryOn5xx=!!e.retryOn5xx,this.onSend=e.onSend,this.logOnSend=e.logOnSend,this.onDrop=e.onDrop,this.binaryOpts=e.binaryOpts,this.on5xx=e.on5xx,this.resendGuard=e.resendGuard,this.onTag=e.onTag,this.tagToCancel=e.tagToCancel,this.ephemeral=!!e.ephemeral,this.ignore=!!e.ignore,this.isCallOffer=!!e.isCallOffer,this.isWap4Bridge=!!e.isWap4Bridge}getTag(){return this.tag||(this.onSend?this.onSend.tag:void 0)}getName(){var e;return(null===(e=this.binaryOpts)||void 0===e?void 0:e.metricName)?this.binaryOpts.metricName.toLowerCase():`${this.data[0]}_${(0,i.default)(this.data[1])}`}toString(){const e=this.data;return this.binaryOpts?this.binaryOpts.debugString:Array.isArray(e)?0===e.length?"[]":1===e.length?`[${e[0]}]`:"query"===e[0]||"action"===e[0]?`[${e[0]}, ${e[1]}${e.length>2?", ...":""}]`:`Invalid request: ${e[0]}`:e instanceof Object?"{...}":`${String(e)}`}serialize(){const e=this.tag;if(this.binaryOpts){const t=this.binaryOpts,r=null!=t.metric?t.metric:0,n=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(!0===t.available?1:0)<<5|(!1===t.available?1:0)<<4|(null!=t.expires&&0!==t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return a.Binary.build(e,",",r,n,this.data).readBuffer()}const t="string"==typeof this.data?this.data:JSON.stringify(this.data);return`${String(e)},,${String(t)}`}}t.default=s,s.STATE=o},66934:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VoipSignaling=void 0,t.base64DecodeRecursively=function e(t){const r=t[2];Array.isArray(r)&&r.forEach((t=>{t&&(t[2]instanceof ArrayBuffer||"string"==typeof t[2]?t[2]=(0,a.decodeB64ToJsArray)(t[2]):t[2]&&e(t))}))};var i=n(r(78718)),a=r(15688),o=r(84902),s=r(60980),l=r(19380),c=r(24808),d=r(99234),u=n(r(36129)),p=r(45473),f=r(43067);const _={formatCallOffer:function(e,t,r){const n=r.payload,i={to:r.common.peer_jid,id:t,from:(0,d.getMaybeMeUser)().toString({legacy:!0})};let a,o;const l=n[2];l.forEach(((e,t)=>{switch(e[0]){case"enc":const i={call:{callKey:new Uint8Array(e[2])}},l={},d=n[1].retry_count;d&&(l.count=d);const u=["call",l,(0,f.cdataArrayBuffer)((0,s.encodeProtobuf)(c.MessageSpec,i))];a=u,o=t;break;default:(0,f.arrayToB64Recursively)(r.payload,!0)}})),l.splice(o,1),l.push(a),n[2]=l;return e.actionNode("relay",[["call",i,[n]]])},parseCallSignalingMsg:function(e){try{const t=l.ContactCollection.get(e.from),r={peer_jid:e.from.toString({legacy:!0}),isContact:null==t?void 0:t.isMyContact},n=["wrapper",{},e.data];switch(e.type){case"offer":{const t=h("offer",n);r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join(".")),this.parseCallOffer(t,r,!1);break}case"accept":{const t=h("accept",n);r.type=p.TYPE.ACCEPT,r.call_id=u.default.attr("call-id",t)||"",r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join("."));break}case"receipt":const t=e.data;switch(r.call_id=u.default.attr("call-id",t)||"",u.default.tag(t)){case"offer":r.type=p.TYPE.OFFER_RECEIPT;break;case"accept":r.type=p.TYPE.ACCEPT_RECEIPT;break;case"reject":default:return}break;case"terminate":const i=h("terminate",n);r.call_id=u.default.attr("call-id",i)||"",r.type=p.TYPE.TERMINATE;break;default:const a=function(e){const t=u.default.firstChild(e);if(!t)throw new Error("voip_signaling:Failed to get first child node");return t}(n);r.call_id=u.default.attr("call-id",a)}return(null==r?void 0:r.call_id)&&this.createCommonHeader(r),r}catch(e){return void __LOG__(3)`Error parsing voip signaling message`}},parseCallOffer:function(e,t,r){if(t.type=p.TYPE.OFFER,t.call_id=u.default.attr("call-id",e)||"",r){const r=h("call",e),i=u.default.children(r);if(i instanceof ArrayBuffer){var n;const e=(0,o.decodeProtobuf)(c.MessageSpec,i);(null===(n=e.call)||void 0===n?void 0:n.callKey)?this.receiveCallOfferKey(e.call.callKey,t):__LOG__(3)`voip_signaling:invalid messageProto.call`}else __LOG__(3)`voip_signaling:invalid serializedMessage`}else t.enc=this.parseRawE2EMaterial(e);const i=u.default.children(e,"video");t.video_count=Array.isArray(i)?i.length:void 0,t.isVideoCall=!!t.video_count,t.isGroupCall_DEPRECATED=!!t.group_info;const a=u.default.attr("t",e);a&&(t.t=a)},parseRawE2EMaterial:function(e){const t=u.default.child("enc",e);if(t)return(0,a.decodeB64ToJsArray)(u.default.dataStr(t));__LOG__(3)`voip_signaling:enc node not present`},receiveCallOfferKey:function(e,t){t&&(t[2]=Array.prototype.slice.call(new Uint8Array(e)))},createCommonHeader(e){e.common=(0,i.default)(e,["type","call_id","peer_jid"])}};function h(e,t){const r=u.default.child(e,t);if(!r)throw new Error(`voip_signaling:Failed to get child node ${e}`);return r}t.VoipSignaling=_},43067:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayToB64Recursively=o,t.cdataArrayBuffer=s,t.cdataB64=l,t.formatCallSignalingMsg=function(e,t){var r;const n=t.common.peer_jid;o(t.payload,!1);const i=t.payload;return["call",{from:null===(r=(0,a.getMaybeMeUser)())||void 0===r?void 0:r.toString({legacy:!0}),to:n,id:e},[i]]};var n=r(15688),i=r(8584),a=r(99234);function o(e,t){const r=e[2];Array.isArray(r)&&r.forEach((e=>{e&&(e[2]instanceof Array&&!(e[2][0]instanceof Array)?e[2]=t?s(new Uint8Array(e[2])):l(new Uint8Array(e[2])):e[2]&&o(e,t))}))}function s(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:e instanceof i.Binary?e.readBuffer():void 0}function l(e){return e instanceof Uint8Array||e instanceof ArrayBuffer?(0,n.encodeB64)(e):e instanceof i.Binary?(0,n.encodeB64)(e.readBuffer()):void 0}},86875:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.instance=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(15688),s=r(81484),l=r(81576),c=r(11141),d=r(87614),u=n(r(45095)),p=r(20461),f=r(31914),_=n(r(89867)),h=r(45454),g=r(84902),m=r(72549),y=r(9978),E=k(r(5087)),S=r(24808),v=k(r(64103)),T=n(r(41090)),C=r(7293),A=r(90667),b=r(6822),P=r(77113),M=n(r(84644)),O=k(r(17117)),I=r(31515),w=r(43067),R=r(21224),D=r(77591),N=r(65044);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(L=function(e){return e?r:t})(e)}function k(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=L(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}let G,U;function F(e){return function(){if(!G)return Promise.reject(new v.ProtoVersionUndefined(`wap:${e}:not connected to phone yet`));const t=G[e];return t?t.apply(G,arguments):Promise.reject(new Error(`wap:${e}:unsupported`))}}const x=F("sendPresenceUpdate"),B=F("sendChatstateUpdate");const K=new class{constructor(){this.setSharedSecret=(0,p.promiseWrapSync)(function(){var e=(0,a.default)((function*(e){__LOG__(2)`Wap:saveSharedSecret start`;const t=(0,u.default)((0,o.decodeB64ToJsArray)(e),"decodeB64ToJsArray(payload)"),r=t.slice(0,32),n=t.slice(64),i=O.get().keyPair,a=(0,u.default)(i,"keyPair").privKey,d=yield E.sharedSecret(r,a).then((e=>(0,l.extractAndExpand)(e,"",80))),p=new Uint8Array(d,0,32),f=new Uint8Array(d,32,32),_=new Uint8Array(d,64,16),h=new Uint8Array(r.concat(n)),g=yield(0,c.hmacSha256)(f,h),m=(0,o.encodeB64)(g),y=(0,o.encodeB64)(t.slice(32,64));if(y!==m)return void __LOG__(3)`Wap:saveSharedSecret hmac mismatch ${y} ${m}`;const S=yield(0,s.aesCbcDecrypt)(p,_,new Uint8Array(n)),v=new Uint8Array(S,0,32),T=new Uint8Array(S,32,32);O.setSecretKeys("0.1",v,T),__LOG__(2)`Wap:saveSharedSecret done`}));return function(){return e.apply(this,arguments)}}()),this.addContact=F("addContact"),this.groupMetadataFindFromPhone=F("groupMetadataFindFromPhone"),this.resyncMessages=F("resyncMessages"),this.resyncReceipts=F("resyncReceipts"),this.queryReceivedActions=F("queryReceivedActions"),this.addParticipants=F("addParticipants"),this.changeSubject=F("changeSubject"),this.createGroup=F("createGroup"),this.leaveGroup=F("leaveGroup"),this.removeParticipants=F("removeParticipants"),this.promoteParticipants=F("promoteParticipants"),this.demoteParticipants=F("demoteParticipants"),this.setGroupDescription=F("setGroupDescription"),this.setGroupProperty=F("setGroupProperty"),this.setGroupEphemeralDuration=F("setGroupEphemeralDuration"),this.requestMediaReupload=F("requestMediaReupload"),this.sendMedia=F("sendMedia"),this.mediaUpload=F("mediaUpload"),this.sendConversationSeen=F("sendConversationSeen"),this.sendConversationUnseen=F("sendConversationUnseen"),this.sendConversationClear=F("sendConversationClear"),this.sendConversationDelete=F("sendConversationDelete"),this.sendConversationArchive=F("sendConversationArchive"),this.sendConversationMute=F("sendConversationMute"),this.sendConversationNotSpam=F("sendConversationNotSpam"),this.sendConversationPin=F("sendConversationPin"),this.sendConversationDismissChangeNumber=F("sendConversationDismissChangeNumber"),this.sendMessagePlayed=F("sendMessagePlayed"),this.sendMessageDelete=F("sendMessageDelete"),this.sendMessageStarred=F("sendMessageStarred"),this.sendUnstarAll=F("sendUnstarAll"),this.sendSetPicture=F("sendSetPicture"),this.deletePicture=F("deletePicture"),this.sendSetStatus=F("sendSetStatus"),this.setPushname=F("setPushname"),this.statusQuery=F("statusQuery"),this.sendStatusSeen=F("sendStatusSeen"),this.statusQueryThumbnail=F("statusQueryThumbnail"),this.sendSetBlock=F("sendSetBlock"),this.sendSpamReport=F("sendSpamReport"),this.chatFindQuery=F("chatFindQuery"),this.contactFindQuery=F("contactFindQuery"),this.queryIdentity=F("queryIdentity"),this.queryVname=F("queryVname"),this.msgCreateRecord=F("msgCreateRecord"),this.msgFindQuery=F("msgFindQuery"),this.queryLinkPreview=F("queryLinkPreview"),this.queryVcard=F("queryVcard"),this.queryMsgInfo=F("queryMsgInfo"),this.recentEmojiQuery=F("recentEmojiQuery"),this.clearBPQueue=F("clearBPQueue"),this.parseWebMessageInfo=F("parseWebMessageInfo"),this.subscribeLiveLocation=F("subscribeLiveLocation"),this.unsubscribeLiveLocation=F("unsubscribeLiveLocation"),this.queryActiveLiveLocation=F("queryActiveLiveLocation"),this.disableLiveLocation=F("disableLiveLocation"),this.findGroupPendingInvitesFromPhone=F("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=F("acceptGroupV4Invite"),this.revokeGroupV4Invite=F("revokeGroupV4Invite"),this.sendCallOffer=F("sendCallOffer"),this.queryCall=F("queryCall"),this.sendCallEnd=F("sendCallEnd"),this.queryLabels=F("queryLabels"),this.queryNextLabelColor=F("queryNextLabelColor"),this.queryLabelPalette=F("queryLabelPalette"),this.addOrRemoveLabels=F("addOrRemoveLabels"),this.deleteLabel=F("deleteLabel"),this.createLabel=F("createLabel"),this.editLabel=F("editLabel"),this.queryQuickReplies=F("queryQuickReplies"),this.flushQuickReplyCounts=F("flushQuickReplyCounts"),this.queryStickerPacks=F("queryStickerPacks"),this.queryStickersInStickerPack=F("queryStickersInStickerPack"),this.queryRecentStickers=F("queryRecentStickers"),this.queryStarredStickers=F("queryStarredStickers"),this.queryVideoPlaybackUrl=F("queryVideoPlaybackUrl"),this.queryNoticeState=F("queryNoticeState"),this.querySettings=F("querySettings"),this.setArchiveSetting=F("setArchiveSetting"),this.queryDisappearingMode=F("queryDisappearingMode"),this.sendMdOptIn=F("sendMdOptIn")}isInitialized(){return!!U}setVersion(e,t,r){const n=e[0],a=e[1],o=[n,a,t,r].join("."),s=U!==o;if(__LOG__(2)`wap:setVersion ${o} set: ${String(s)}`,!s)return;const l=G;switch(n){case 0:switch(a){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:throw __LOG__(3)`wap:setVersion deprecated version: ${o}`,new v.DeprecatedProtocolVersion("wap_deprecated_version");case 17:G=(0,i.default)({},P.protoMap[a]),G.setSubProtocol(t);break;default:G=void 0}}if(!G)throw __LOG__(3)`wap:setVersion unknown version. attempting to update`,new v.UpdateImmediately("wap_unknown_version");U=o,G.supportsFeatureFlags&&this.processFeatureFlags(r),l&&G&&G.upgradeProtoVersion(l)}processFeatureFlags(e){if(!e)return;const t=(0,u.default)(G,"protoVersion"),r=t.implementedFeatures||{},n=(0,g.decodeProtobufWithUnknowns)(R.WebFeaturesSpec,(0,o.decodeB64)(e)),i=(0,g.getUnknownFields)(n);delete n.unsafeUnknownFields;for(const e in r)C.GK.setFeatureFromFlags(e,R.WebFeaturesFlag.FORCE_UPGRADE,R.WebFeaturesFlag.FORCE_UPGRADE);const a=Object.keys(R.WebFeaturesSpec.internalSpec),s=Object.keys(n);a.forEach((e=>{const t=(0,C.getProtobufFeatureName)(e);!s.includes(e)&&C.GK.supportsFeature(t)&&C.GK.setFeature(t,!1)}));for(const e in n){if(r[e])continue;const i=n[e],a=T.default[e];if(i===R.WebFeaturesFlag.FORCE_UPGRADE&&a!==R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:${e} phone value is ${i} and web value is ${a}. updating...`,new v.UpdateImmediately("wap_feature_force_upgrade");if(C.GK.setFeatureFromFlags(e,a,i),C.GK.supportsFeatureFromFlags(e)){const r=P.protoMap.features[e];r&&Object.assign(t,r)}}for(const e in i){const t=i[e];if("number"==typeof t&&R.WebFeaturesFlag.cast(t)===R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:unknown: ${e}: ${t}`,new v.UpdateImmediately("wap_feature_implemented_unknown")}}delete(){const e=G?G.delete.apply(G,arguments):void 0;return G=void 0,U=void 0,__LOG__(2)`wap:unsetVersion, which should only happen when logout`,e}cannotReachPhone(){G&&G.cannotReachPhone.apply(G,arguments)}handle(e,t,r,n){return(0,u.default)(G,"protoVersion").handle.apply(G,[e,t,r,n])}queryServerProps(){return N.Socket.sendEphemeral2({data:["query","props"],retryOn5xx:!1})}resyncPictures(e){const t=e.filter((e=>_.default.isWid(e.id)));return 0===t.length?Promise.resolve([]):N.Socket.sendEphemeral2({data:["query","resumePic",t],retryOn5xx:!0})}setRememberMe(e){return N.Socket.sendBasic({data:["admin","remember",!!e]})}queryMediaConnections(e){const t=new Date,r=N.Socket.send2({data:["query","mediaConn"]}).then((e=>{if(__LOG__(2,!0)`queryMediaConnections result: ${JSON.stringify(e)}`,200!==e.status){if(e.status>=400)throw new D.ServerStatusCodeError(e.status,"queryMediaConnections");throw new D.ServerStatusCodeError(e.status,"Invalid return status")}const{media_conn:r}=e;if(!(r&&r.auth&&r.ttl&&r.hosts&&Array.isArray(r.hosts)&&0!==r.hosts.length))throw __LOG__(2)`wap:queryMediaConnections mediaConn exists ${String(!!r)}`,r&&(__LOG__(2)`wap:queryMediaConnections mediaConn.auth exists ${String(!!r.auth)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.ttl exists ${String(!!r.ttl)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts exists ${String(!!r.hosts)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts isArray ${String(Array.isArray(r.hosts))}`,r.hosts&&__LOG__(2)`wap:queryMediaConnections mediaConn.hosts.length ${r.hosts.length}`),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("wap:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");const{auth:n,auth_ttl:a,ttl:o,max_buckets:s}=r;return{auth:n,authTTL:a,hosts:r.hosts.map((e=>{var t;const r=null===(t=e.rules)||void 0===t?void 0:t.map((e=>e.download_buckets?{downloadBuckets:e.download_buckets}:e));return(0,i.default)((0,i.default)({},e),{},{rules:r})})),queryStartTime:t,ttl:o,maxBuckets:s}}));return(0,M.default)(r,e)}acceptGroupInvite(e){return N.Socket.send2({data:["action","invite",e],retryOn5xx:!0})}revokeGroupInvite(e){return N.Socket.send2({data:["action","inviteReset",e],retryOn5xx:!0})}contactFindBroadcast(e){return N.Socket.send2({data:["query","contact",e],retryOn5xx:!0})}commonGroupsFind(e){return _.default.isServer(e)?Promise.resolve({status:200,groups:[]}):N.Socket.send2({data:["query","group","common",e]})}getCapabilities(e){return N.Socket.send2({data:["query","caps",e.filter(_.default.isUser)],retryOn5xx:!0})}queryExist(e){return _.default.isUser(e)?N.Socket.send2({data:["query","exist",e],retryOn5xx:!0}):Promise.resolve({status:400})}queryCtwaContext(e,t,r){return(0,a.default)((function*(){var n,i,a,o;const s={accountNumber:(0,h.createWid)(e).toString({legacy:!0}),code:t,expectedSourceUrl:r,id:(0,f.generateId)()},l=yield N.Socket.send2({data:["query","ctwa",s],retryOn5xx:!0});if(200!==l.status)throw new D.ServerStatusCodeError(l.status,`queryCtwaContext:fail ${l.status}`);const c={sourceId:l.data.source.id,sourceType:l.data.source.type,sourceUrl:l.data.source.url,description:l.data.body,title:l.data.headline,mediaType:(null===(n=l.data.video)||void 0===n?void 0:n.url)?S.ContextInfo$ExternalAdReplyInfoMediaType.VIDEO:S.ContextInfo$ExternalAdReplyInfoMediaType.IMAGE,isSuspiciousLink:l.data.source.url!==r,thumbnailUrl:null===(i=l.data.thumbnail)||void 0===i?void 0:i.url,mediaUrl:null===(a=l.data.video)||void 0===a?void 0:a.url};return(null===(o=l.data.thumbnail)||void 0===o?void 0:o.bytes)&&(c.thumbnail=l.data.thumbnail.bytes),c}))()}queryBusinessProfile(e,t){return(0,a.default)((function*(){const r=yield N.Socket.send2({data:["query","businessProfile",e.filter((e=>_.default.isUser(e.wid))),t],retryOn5xx:!0});switch(r.status){case 200:return r.profiles;default:throw new Error(`queryBusinessProfile:fail ${r} ${r.status}`)}}))()}queryMerchantCompliance(e){return(0,a.default)((function*(){const t=yield N.Socket.send2({data:["query","merchantCompliance",e.filter((e=>_.default.isUser(e.wid)))],retryOn5xx:!0});switch(t.status){case 200:return t.compliance_infos;default:throw new Error(`queryMerchantCompliance:fail ${t} ${t.status}`)}}))()}queryBusinessCategories(e){return(0,a.default)((function*(){const t={id:(0,f.generateId)(),query:e},r=yield N.Socket.send2({data:["query","businessCategories",t],retryOn5xx:!0});switch(r.status){case 200:const e=r.data.not_a_biz[0],t=e.id,n=r.data.categories.reduce(((t,r)=>(r.id!==e.id&&t.push({id:r.id,localized_display_name:r.name}),t)),[]);return n.unshift({id:t,localized_display_name:e.name,not_a_biz:!0}),{categories:n,notABizId:t};default:throw new Error(`queryBusinessCategories:fail ${r} ${r.status}`)}}))()}queryOrder(e,t,r,n){return(0,a.default)((function*(){const i={id:(0,f.generateId)(),orderId:e,imageWidth:t.toString(),imageHeight:r.toString(),token:n},a=yield N.Socket.send2({data:["query","order",i],retryOn5xx:!0});switch(a.status){case 200:const{data:e}=a;try{const{currency:t,subtotal:r,total:n,tax:i}=e.price,a=parseInt(e.creationTS,10);return{currency:t,createdAt:a,products:e.products.map((e=>{var t,r;return{id:e.id,price:e.price,thumbnailId:null===(t=e.image)||void 0===t?void 0:t.id,thumbnailUrl:null===(r=e.image)||void 0===r?void 0:r.url,currency:e.currency,name:e.name,quantity:parseInt(e.quantity||0,10)}})),subtotal:r,total:n,tax:i}}catch(e){throw new D.ServerStatusCodeError(a.status,`queryOrder:response malformed ${a.status}`)}case 404:throw new D.E404;default:throw new D.ServerStatusCodeError(a.status,`queryOrder:fail ${a.status}`)}}))()}createOrder(e,t){return(0,a.default)((function*(){const r={product:t.map((e=>({id:e.id,name:e.name,quantity:(0,I.isNumber)(e.quantity)?e.quantity.toString():void 0,price:(0,I.isNumber)(e.priceAmount1000)?e.priceAmount1000.toString():void 0,currency:e.currency}))),bizJID:e,id:(0,f.generateId)()},n=yield N.Socket.send2({data:["action","createOrder",r],retryOn5xx:!0});if(200===n.status)return n.data;throw new D.ServerStatusCodeError(n.status,`createOrder:fail wap action return status: ${n.status}`)}))()}refreshCart(e,t,r,n){return(0,a.default)((function*(){const i=t.map((e=>({id:e}))),a={id:(0,f.generateId)(),products:i,bizJID:_.default.user(e),imageDimensions:{width:r.toString(),height:n.toString()}},o=yield N.Socket.send2({data:["action","refreshOrder",a],retryOn5xx:!0});if(200===o.status)return o.data;throw new D.ServerStatusCodeError(o.status,`refreshCart:fail wap action return status: ${o.status}`)}))()}queryProductCatalog(e,t,r,n,i,o){return(0,a.default)((function*(){const a={catalogWid:e,afterCursor:t,limit:r,width:n,height:i,allowShopSource:o,type:"get_product_catalog_reh",stanza_id:(0,f.generateId)()},s=yield N.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(s.status){case 200:return"string"==typeof s.data||s.data instanceof String?JSON.parse(s.data):s.data;default:throw new D.ServerStatusCodeError(s.status,`queryProductCatalog:fail ${s.status}`)}}))()}queryProductList(e,t,r,n){return(0,a.default)((function*(){const i={catalogWid:e,product_ids:t,width:""+r,height:""+n,stanza_id:(0,f.generateId)()},a=yield N.Socket.send2({data:["action","getProductList",i],retryOn5xx:!0});switch(a.status){case 200:return a.data.data;default:throw new D.ServerStatusCodeError(a.status,`queryProductList:fail ${a.status}`)}}))()}queryProduct(e,t,r,n,i){return(0,a.default)((function*(){const a={catalogWid:e,productID:t,width:r,height:n,fetchComplianceInfo:i,type:"get_product_reh",stanza_id:(0,f.generateId)()},o=yield N.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(o.status){case 200:const e="string"==typeof o.data||o.data instanceof String?JSON.parse(o.data):o.data.product;return e.compliance_category===b.ProductComplianceCategory.CountryOriginExempt&&(e.compliance_info={country_code_origin:String(y.SyntheticCountryCode.NotApplicable)}),{data:e};case 404:case"not_found":return{error:"NOT_FOUND"};default:throw new D.ServerStatusCodeError(o.status,`queryProduct:fail ${o.status}`)}}))()}reportBusinessCatalogProduct(e,t,r){return(0,a.default)((function*(){const n={id:t,jid:e.toString(),reason:r,stanza_id:(0,f.generateId)()},i=yield N.Socket.send2({data:["action","reportProduct_reh",n],retryOn5xx:!0});if(200!==i.status)throw new D.ServerStatusCodeError(i.status,`reportBusinessCatalogProduct:fail ${i.status}`)}))()}deleteBusinessCatalogProduct(e){return(0,a.default)((function*(){const t=["action","deleteProduct_reh",{product_ids:e,stanza_id:(0,f.generateId)()}],r=yield N.Socket.send2({data:t,retryOn5xx:!0});if(200!==r.status)throw new D.ServerStatusCodeError(r.status,`deleteBusinessCatalogProduct:fail ${r.status}`);return{deletedCount:r.deletedCount}}))()}createBusinessCatalog(){return(0,a.default)((function*(){const e=["action","createCatalog_reh",{stanza_id:(0,f.generateId)()}],t=yield N.Socket.send2({data:e,retryOn5xx:!0});if(200!==t.status)throw new D.ServerStatusCodeError(t.status,`createBusinessCatalog:fail ${t.status}`)}))()}getComplianceInfoRequestParams(e){const{complianceInfo:t}=e,{isExempt:r,hasCountryCodeOrigin:n,hasImporterName:i,hasImporterAddress:a}=(0,m.scanComplianceInfoForMissingData)(t);if(r||!t||!(n||i||a))return;const o={compliance_info:{}};if(t.countryCodeOrigin&&(o.compliance_info.country_code_origin=t.countryCodeOrigin),t.importerName&&(o.compliance_info.importer_name=t.importerName),t.importerAddress){const e={};t.importerAddress.street1&&(e.street1=t.importerAddress.street1),t.importerAddress.street2&&(e.street2=t.importerAddress.street2),t.importerAddress.postalCode&&(e.postal_code=t.importerAddress.postalCode),t.importerAddress.city&&(e.city=t.importerAddress.city),t.importerAddress.region&&(e.region=t.importerAddress.region),t.importerAddress.countryCode&&(e.country_code=t.importerAddress.countryCode),Object.keys(e).length>0&&(o.compliance_info.importer_address=e)}return o}editBusinessCatalogProduct(e,t,r){var n=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({product_id:e.id,name:e.name,image_url:e.imageCdnUrl,url:e.url,additional_image_urls:e.additionalImageCdnUrl,width:t.toString(),height:r.toString(),stanza_id:(0,f.generateId)(),is_hidden:e.isHidden},n.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),e.description&&(s.description=e.description),e.retailerId&&(s.retailer_id=e.retailerId),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(y.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=b.ProductComplianceCategory.CountryOriginExempt);const l=yield N.Socket.send2({data:["action","editProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new D.CatalogEditServerError(l.status,(0,A.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}editBusinessComplianceWebd(e){return(0,a.default)((function*(){var t,r,n,i,a,o,s;const l={customer_care_details:{email:null===(t=e.customerCareDetails)||void 0===t?void 0:t.email,landline_number:null===(r=e.customerCareDetails)||void 0===r?void 0:r.landlineNumber,mobile_number:null===(n=e.customerCareDetails)||void 0===n?void 0:n.mobileNumber},grievance_officer_details:{email:null===(i=e.grievanceOfficerDetails)||void 0===i?void 0:i.email,landline_number:null===(a=e.grievanceOfficerDetails)||void 0===a?void 0:a.landlineNumber,mobile_number:null===(o=e.grievanceOfficerDetails)||void 0===o?void 0:o.mobileNumber,name:null===(s=e.grievanceOfficerDetails)||void 0===s?void 0:s.name},entity_name:e.entityName,entity_type:e.entityType,entity_type_custom:e.entityTypeCustom,is_registered:e.isRegistered},c=yield N.Socket.send2({data:["action","editBusinessCompliance",l],retryOn5xx:!0});switch(c.status){case 200:return c.compliance_infos;default:throw new Error(`editBusinessCompliance:fail ${c} ${c.status}`)}}))()}addBusinessCatalogProduct(e,t,r){var n=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({name:e.name,description:e.description||"",image_url:e.imageCdnUrl,url:e.url||"",additional_image_urls:e.additionalImageCdnUrl,retailer_id:e.retailerId||"",width:t.toString(),height:r.toString(),stanza_id:(0,f.generateId)(),is_hidden:e.isHidden},n.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(y.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=b.ProductComplianceCategory.CountryOriginExempt);const l=yield N.Socket.send2({data:["action","addProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new D.CatalogEditServerError(l.status,(0,A.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}productVisibilitySet(e){return(0,a.default)((function*(){const t={product_visibility:e.map((e=>[e.productId,e.isHidden])),stanza_id:(0,f.generateId)()},r=yield N.Socket.send2({data:["action","productVisibilitySet",t],retryOn5xx:!0});if(200!==r.status)throw new D.ServerStatusCodeError(r.status,`productVisibilitySet:fail ${r.status}`)}))()}appealCatalogProduct(e,t){return(0,a.default)((function*(){const r={id:e,reason:t,stanza_id:(0,f.generateId)()},n=yield N.Socket.send2({data:["action","appealProduct_reh",r],retryOn5xx:!0});if(200===n.status)return!0;throw new D.ServerStatusCodeError(n.status,`appealCatalogProduct:fail ${n.status}`)}))()}groupV4InviteRequestMetadataFind(e,t,r,n,i){return N.Socket.send2({data:["query","InvitedGroupMetadata",{from:e,admin:t,code:r,expiration:n,gid:i}],retryOn5xx:!1})}groupV4InviteGrpPicThumb(e,t,r,n){return N.Socket.send2({data:["query","AddRequestGrpProfilePicThumb",{admin:e,code:t,expiration:r,gid:n}],retryOn5xx:!0})}groupMetadataFind(e){return(0,a.default)((function*(){const t=yield N.Socket.send2({data:["query","GroupMetadata",e],retryOn5xx:!0});return t.status&&t.status>=400?Promise.reject(new D.ServerStatusCodeError(t.status)):t}))()}groupInviteInfo(e){return N.Socket.send2({data:["query","invite",e],retryOn5xx:!0})}groupInviteCode(e){return N.Socket.send2({data:["query","inviteCode",e],retryOn5xx:!0})}profilePicFind(e){return _.default.isServer(e)?Promise.resolve({status:400}):N.Socket.sendEphemeral2({data:["query","ProfilePicThumb",e],retryOn5xx:!0})}profilePicFindThumbFromPhone(){return G?G.profilePicFindThumbFromPhone.apply(G,arguments):Promise.reject(new v.ProtoVersionUndefined("wap:profilePicFindThumbFromPhone:not connected to phone"))}statusFind(e){return _.default.isServer(e)?Promise.resolve({status:""}):N.Socket.sendEphemeral2({data:["query","Status",e],retryOn5xx:!0})}sendPing(){return N.Socket.send2({data:["admin","test"],retryOn5xx:!0})}sendPresenceAvailable(){return x("available")}sendPresenceUnavailable(){return x("unavailable")}sendChatstateComposing(e){return B("composing",e)}sendChatstatePaused(e){return B("paused",e)}sendChatstateRecording(e){return B("recording",e)}subscribePresence(e){return N.Socket.send2({data:["action","presence","subscribe",e],retryOn5xx:!0})}downloadImage(){return Promise.reject(new Error("Image download is not yet implemented"))}logoutToken(){return(0,a.default)((function*(){const{encKey:e,macKey:t}=O.get(),r=yield(0,c.hmacSha256)((0,u.default)(t,"macKey"),new Uint8Array((0,u.default)(e,"encKey")));return(0,o.encodeB64)(r)}))()}sendGroupCallOffer(e){return this.sendCallSignalingMsg(e)}sendCallSignalingMsg(e,t){return(0,a.default)((function*(){const r=t||(0,d.randomHex)(8),n=(0,w.formatCallSignalingMsg)(r,e);if(!n)return Promise.reject(new Error("unknown call signaling msg type"));return yield N.Socket.send2({tag:r,data:["action","call",n],retryOn5xx:!0})}))()}};t.instance=K},97951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.attemptWithDirectConnectionRetry=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(15131)),o=r(884),s=r(77591);function l(){return(l=(0,i.default)((function*(e,t){if(!(yield(0,o.isCypherNeeded)(e)))return t();const r=function(){var r=(0,i.default)((function*(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=(yield a.default.getCypher(e,{forceRenew:r})).cypher;return t(n)}));return function(){return r.apply(this,arguments)}}();try{return yield r()}catch(e){return e instanceof s.ServerStatusCodeError&&421===e.statusCode?(__LOG__(2)`Received 421 from Direct Connection request. Renewing certificate and retrying.`,r(!0)):Promise.reject(e)}}))).apply(this,arguments)}},79235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessProfile=function(e,t){const r=(0,o.getBusinessProfileQueryVersion)();let n;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(n=t?Promise.all([(0,d.default)(e,r),(0,l.getMerchantCompliance)(e)]).then(f):(0,d.default)(e,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=t?Promise.all([u.default.queryBusinessProfile(e,r),u.default.queryMerchantCompliance(e)]).then(f):u.default.queryBusinessProfile(e,r);return(0,p.attachErrorLogger)(n,"Query business profile failed")},t.queryBusinessPublicKey=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){return(0,r(68819).getJobManager)().waitUntilCompleted(c.jobSerializers.getPublicKey(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.querySignedUserInfo=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){return(0,r(68819).getJobManager)().waitUntilCompleted(c.jobSerializers.getSignedUserInfo(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.updateCartEnabled=function(e){let t;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(t=(0,a.updateCartEnabled)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=Promise.reject(new Error("This feature is only available for MD."));return t};var i=n(r(81109)),a=r(8021),o=r(56149),s=r(7293),l=r(63442),c=r(6684),d=n(r(63638)),u=n(r(56891)),p=r(77591);function f(e){let[t,r]=e;return t.map(((e,t)=>(0,i.default)((0,i.default)({},e),{},{profile:(0,i.default)((0,i.default)({},e.profile),{},{legal_entity_details:r[t]})})))}},40346:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){let t;const r=(0,a.phaseOutNotABusiness)();(0,o.qplPointProfileCatsView)("datasource_start"),i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(t=(0,s.queryBusinessCategories)(e,r),t||(t=Promise.reject(new Error("BusinessCategory MD query not yet implemented")))):t=l.default.queryBusinessCategories(e);return t.then((e=>((0,o.qplPointProfileCatsView)("datasource_end"),e))),t};var i=r(7293),a=r(57701),o=r(90549),s=r(87117),l=n(r(56891))},56149:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIRECT_CONNECTION_FLAG=void 0,t.getBusinessProfileQueryVersion=function(){let e=247;(0,n.bizLinkedAccountsEnabled)()&&(e|=256);return i.ServerProps.webBizProfileOptions&e};var n=r(57701),i=r(64551);t.DIRECT_CONNECTION_FLAG=128},45741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createLabelAssociationMutations=T,t.editLabelAssociation=function(e,t){let r;if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){t.some((e=>e instanceof d.default))&&(__LOG__(4,void 0,new Error,!0)`contact model is invalid for editLabelAssociation`,SEND_LOGS("contact model is invalid for editLabelAssociation")),r=E(e,t.map((e=>e instanceof _.Msg?{labelAssociationType:f.LabelAssociationType.Message,modelId:e.id.toString(),mutationIndexSegments:(0,g.constructMsgKeySegments)(e)}:{labelAssociationType:f.LabelAssociationType.Jid,modelId:e.id.toString(),mutationIndexSegments:[e.id.toString({legacy:!0})]}))),r||(r=Promise.reject(new Error("Should not reach here")))}else r=m.default.addOrRemoveLabels(e,t).then((e=>{if(200!==e.status)throw new y.ServerStatusCodeError(e.status)}));return r},t.editLabelAssociationMD=E,t.editLocalLabelAssociationMD=S;var i=n(r(48926)),a=r(50073),o=r(381),s=r(92844),l=r(60980),c=r(45606),d=n(r(121)),u=r(7293),p=r(57701),f=r(82663),_=r(17304),h=r(38804),g=r(93824),m=n(r(56891)),y=r(77591);function E(e,t){return(0,p.canEditLabelAssociation)()?(0,h.lockForSync)(["label-association"],T(e,t),(()=>S(e,t))):Promise.reject(new Error("editLabelAssociation is not supported"))}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const r=[],n=[];e.forEach((e=>{let{id:i,type:a}=e;t.map((e=>{let{modelId:t,labelAssociationType:o}=e;"add"===a?r.push({labelId:i,associationId:t,type:o}):n.push([i,t,o])}))}));const i=(0,f.getTable)();yield Promise.all([i.bulkCreateOrReplace(r).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into label association table failed`,SEND_LOGS("bulkCreateOrReplace into label association table failed when saving label associations"),new Error("bulkCreateOrReplace into label association table failed")})),i.bulkRemove(n).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from label association table failed`,SEND_LOGS("bulkRemove from label association table failed while saving label associations"),new Error("bulkRemove form label association table failed")}))])}))).apply(this,arguments)}function T(e,t){const r=(0,s.unixTimeMs)(),n=[];return e.forEach((e=>{let{id:i,type:s}=e;t.forEach((e=>{let{labelAssociationType:t,mutationIndexSegments:d}=e;const u=t===f.LabelAssociationType.Message?c.Actions.LabelMessage:c.Actions.LabelJid;n.push({timestamp:r,collection:c.CollectionName.Regular,operation:a.SyncdMutationSyncdOperation.SET,index:JSON.stringify([u,i,...d]),version:c.LABEL_ASSOCIATION_SYNC_VERSION,binarySyncAction:(0,l.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:r,labelAssociationAction:{labeled:"add"===s}}).readBuffer(),action:u})}))})),n}},21374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e,t,r){let n;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(n=(0,s.addProductMD)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=A.default.addBusinessCatalogProduct(e,t,r);return n.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),n=n.then(O),n.catch((e=>{if(e instanceof b.ServerStatusCodeError&&406===e.statusCode||e instanceof b.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Add product failed, error: ${e}`,SEND_LOGS("Add product failed"),e}))},t.appealProduct=function(e,t){let r;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(r=(0,l.appealProductMD)(e,t),r||(r=Promise.reject(new Error("Should not reach here")))):r=A.default.appealCatalogProduct(e,t);return r.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_end"))),(0,b.attachErrorLogger)(r,"Appeal product failed")},t.createCatalog=function(){let e;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(e=(0,d.createProductCatalog)(),e||(e=Promise.reject(new Error("Should not reach here")))):e=A.default.createBusinessCatalog();return e.then((()=>{v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_end")})),(0,b.attachErrorLogger)(e,"Create catalog failed")},t.deleteProducts=function(e){let t;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(t=(0,u.deleteProductsMD)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=A.default.deleteBusinessCatalogProduct(e);return t=t.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_end"))),(0,b.attachErrorLogger)(t,"Delete product failed")},t.editProduct=function(e,t,r){let n;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(n=(0,p.default)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=A.default.editBusinessCatalogProduct(e,t,r);return n.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),n=n.then(O),n.catch((e=>{if(e instanceof b.ServerStatusCodeError&&406===e.statusCode||e instanceof b.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Edit product failed, error: ${e}`,SEND_LOGS("Edit product failed"),e}))},t.mapMsgToProductModel=function(e){let t;e.businessOwnerJid&&(t=(0,a.createWid)(e.businessOwnerJid));return{catalogWid:t,id:e.productId||"",url:e.url,name:e.title,description:e.description,imageCdnUrl:e.mediaData.renderableUrl,reviewStatus:"",currency:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,productMsgMediaData:e.mediaData,imageCount:null!=e.productImageCount&&0!==e.productImageCount?e.productImageCount:1,fetchedFromServer:!1,t:e.t,isHidden:!1}},t.mapProductResponseToModel=O,t.parseDateValue=M,t.productVisibilitySet=function(e){let t;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(t=(0,y.default)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=A.default.productVisibilitySet(e);return t.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_end"))),(0,b.attachErrorLogger)(t,"Product visibility change failed")},t.queryCatalog=function(e,t,r,n,i,a,o){let s;if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))s=(0,c.attemptWithDirectConnectionRetry)(e,(s=>(0,E.default)({catalogWid:e,afterCursor:t,limit:r,width:n,height:i,checkmarkCollectionId:a,allowShopSource:o,directConnectionEncryptedInfo:s}))),s||(s=Promise.reject(new Error("Should not reach here")));else{const a=e.toString({legacy:!0});s=A.default.queryProductCatalog(a,t,r,n,i,o)}return s.catch((e=>{if(e instanceof b.ServerStatusCodeError&&404===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Query catalog failed, error: ${e}`,SEND_LOGS("Query catalog failed"),e}))},t.queryProduct=function(e,t,r,n,i,a){let o;!0===a&&(0,h.qplPointProductView)("datasource_start"),o=f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(0,c.attemptWithDirectConnectionRetry)(e,(a=>(0,S.default)(e,t,r,n,i,a))):A.default.queryProduct(e.toString({legacy:!0}),t,r,n,i);return o.then((()=>!0===a&&(0,h.qplPointProductView)("datasource_end"))),(0,b.attachErrorLogger)(o,"Query product failed")},t.queryProductList=function(e,t,n,i,a){if((0,_.commerceFeaturesDisabledBySanctions)())return Promise.reject(new b.E451);let o;if(a&&(0,h.qplPointPLMDetailsView)("datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)){const a=r(68819).getJobManager;o=(0,c.attemptWithDirectConnectionRetry)(e,(r=>a().waitUntilCompleted(g.jobSerializers.queryProductList(e,t,r,n,i))))}else{const r=e.toString({legacy:!0});o=A.default.queryProductList(r,t,n,i)}return o.then((()=>a&&(0,h.qplPointPLMDetailsView)("datasource_end"))).catch((e=>{if(451===e.errorCode)throw new b.E451})),o},t.reportProduct=function(e,t,r){let n;v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_start"),f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(n=(0,C.default)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=A.default.reportBusinessCatalogProduct(e,t,r);return n.then((()=>v.QPL.markerPoint(T.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_end"))),(0,b.attachErrorLogger)(n,"Report product failed")};var i=n(r(81109)),a=r(45454),o=n(r(30381)),s=r(93306),l=r(27534),c=r(97951),d=r(90880),u=r(15814),p=n(r(21013)),f=r(7293),_=r(57701),h=r(90549),g=r(6684),m=r(6822),y=n(r(17728)),E=n(r(43077)),S=n(r(27678)),v=r(48870),T=r(27798),C=n(r(93374)),A=n(r(56891)),b=r(77591);function P(e){return null==e?null:f.GK.supportsFeature(f.GK.F.MD_BACKEND)?parseInt(e,10):10*parseInt(e,10)}function M(e){return e?o.default.utc(e,o.default.ISO_8601).valueOf():null}function O(e,t){var r,n;const a=(null===(r=e.capability_to_review_status[0])||void 0===r?void 0:r.value)||"APPROVED",o={catalogWid:t,id:e.id,isHidden:e.is_hidden||!1,url:e.url||"",name:e.name,description:e.description||"",availability:null!==(n=m.ProductAvailability.cast(e.availability))&&void 0!==n?n:m.ProductAvailability.UNKNOWN,additionalImageCdnUrl:e.additional_image_cdn_urls.map((e=>e[1].value)),additionalImageHashes:e.image_hashes_for_whatsapp.slice(1),imageCdnUrl:e.image_cdn_urls[1].value,imageHash:e.image_hashes_for_whatsapp[0],reviewStatus:a,currency:e.currency,priceAmount1000:P(e.price),salePriceAmount1000:P(e.sale_price),salePriceStartDate:M(e.sale_start_date),salePriceEndDate:M(e.sale_end_date),retailerId:e.retailer_id||"",productMsgMediaData:null,imageCount:e.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3,old:!1,canAppeal:e.whatsapp_product_can_appeal,checkmark:e.checkmark};return e.compliance_info&&(o.complianceInfo=function(e){const t={countryCodeOrigin:e.country_code_origin};e.importer_name&&(t.importerName=e.importer_name);e.importer_address&&(t.importerAddress=function(e){const t={street1:e.street1,city:e.city,countryCode:e.country_code};e.street2&&(t.street2=e.street2);e.postal_code&&(t.postalCode=e.postal_code);e.region&&(t.region=e.region);e.country_code&&(t.countryCode=e.country_code);return t}(e.importer_address));return t}(e.compliance_info)),(0,i.default)({},o)}},72639:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(t){const r=a.ContactCollection.gadd(e);(0,s.updateVerifiedInfo)(r,t.verifiedName)}}else l.default.queryVname(e).catch((0,i.filteredCatch)(c.WebdDrop,(()=>{})))};var i=r(50796),a=r(19380),o=r(7293),s=r(66167),l=n(r(56891)),c=r(77591)},76931:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendChatStateComposing=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.default)(e,"composing"),Promise.resolve();return o.default.sendChatstateComposing(e).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status)}))},t.sendChatStatePaused=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.default)(e,"paused"),Promise.resolve();return o.default.sendChatstatePaused(e).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status)}))},t.sendChatStateRecording=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.default)(e,"recording"),Promise.resolve();return o.default.sendChatstateRecording(e).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status)}))};var i=r(7293),a=n(r(88795)),o=n(r(56891)),s=r(77591)},91177:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearStorage=y,t.sendClear=function(e,t,n){let i;p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(i=(0,f.clearOrDeleteChatSyncEnabled)()?function(){return S.apply(this,arguments)}(e,t,n):function(){return v.apply(this,arguments)}(e,n),i||(i=Promise.reject(new Error("md:sendClear: should not reach here"))),i=i.then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0&&(0,f.receiveReactionsEnabled)()){const n=t.result,i=r(68819).getJobManager;return yield i().waitUntilPersisted(_.jobSerializers.deleteReactions(e.id.toString(),n)),t}return t}));return function(){return t.apply(this,arguments)}}())):i=g.default.sendConversationClear(e.id,t,!n).then((e=>{if(200!==e.status)throw new m.ServerStatusCodeError(e.status);return e}));return i};var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(381),l=r(92844),c=r(84902),d=r(38342),u=n(r(69048)),p=r(7293),f=r(57701),_=r(6684),h=r(13946),g=n(r(56891)),m=r(77591);function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return(0,h.queryAndRemoveMessagesInMessageRange)(e.id,r,{skipStarred:t,skipRecentSystemMessages:!1});const n=yield(0,h.getBoundsForChat)(e.id),a=yield(0,h.queryAndRemoveMessageHistory)(e.id);return null==n&&__LOG__(3)`_sendClearMD: Expected to receive boundaries for chat while clearing`,u.default.purgeRange((0,i.default)({chatId:e.id.toString()},(0,o.default)(n,"rowIdBounds"))),a}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,n){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937))]),o=r(29867).default,u=(0,l.unixTimeMs)(),p=yield o.getClearChatMutation(u,e.id,!n);let f;return yield i(["message"],[p],(0,a.default)((function*(){var t;yield(0,d.addActiveMessageRange)(e.id.toString(),(0,d.getActiveRangeAction)("clearChat",{deleteStarred:!n}),p.binarySyncAction);const r=null===(t=(0,c.decodeProtobuf)(s.SyncActionValueSpec,p.binarySyncAction).clearChatAction)||void 0===t?void 0:t.messageRange;f=yield y(e,n,r)}))),{_duplicate:null,result:f}}))).apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){return{_duplicate:null,result:yield y(e,t)}}))).apply(this,arguments)}},91829:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return m.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(48285),s=r(69951),l=r(90257),c=r(24606),d=r(28307),u=n(r(25868)),p=r(75888),f=r(7293),_=r(10435),h=r(5819),g=r(30849);function m(){return(m=(0,a.default)((function*(e,t,n){const{forceUsync:i=!1,firstIncomingMsg:a,nextPrivacyMode:m}=null!=n?n:{},S=e.isUser()&&i?yield(0,p.getOrQueryUsyncInfo)(e):null,v=null==S?e:S.wid;if(!e.equals(v)){const e=s.ChatCollection.get(v);if(null!=e)return e}let T=null;v.isUser()&&(0,_.isDisappearingModeEnabled)()&&(T=null==a||a.id.fromMe?(0,d.getDisappearingModeSettingForChat)(v):(0,d.getDisappearingModeSettingFromMsg)(a));const C=s.ChatCollection.gadd(y(v,null!=t?t:{},T)),A=S?(0,g.getPrivacyModeFromQueryExistResponse)(S):null,b=(0,g.comparePrivacyMode)(m,A)>0?m:A,P=(0,u.default)(v,b),M=null!=T?(0,l.genDisappearingModeSystemMsg)(v,T.duration,T.initiator===c.DisappearingModeInitiator.InitiatedByMe):null;if(f.GK.supportsFeature(f.GK.F.MD_BACKEND)){yield(0,o.createChat)(v,E(C));const e=!1,t=!1;return yield(0,h.handleSingleMsgMD)(P.from,P,e,t),null!=M&&(yield(0,h.handleSingleMsgMD)(M.from,M,e,t)),C}const O=r(26453).default;return O([{meta:{add:"relay"},chat:v,msg:P}]),null!=M&&O([{meta:{add:"relay"},chat:v,msg:M}]),C}))).apply(this,arguments)}function y(e,t,r){let n=(0,i.default)({id:e},t);return null!=r&&(n=(0,i.default)((0,i.default)({},n),{},{ephemeralDuration:r.duration,ephemeralSettingTimestamp:r.settingTimestamp,disappearingModeInitiator:r.initiator})),n}function E(e){return{id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:null!=e.changeNumberOldJid?e.changeNumberOldJid.toString():void 0,changeNumberNewJid:null!=e.changeNumberNewJid?e.changeNumberNewJid.toString():void 0,muteExpiration:e.muteExpiration,endOfHistoryTransferType:(e.endOfHistoryTransferType,e.endOfHistoryTransferType),ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingModeInitiator:(e.disappearingModeInitiator,e.disappearingModeInitiator)}}},77772:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFromStorage=function(e){return(0,E.getStorage)().lock(["chat","label-association","message"],(0,a.default)((function*(){const t=yield(0,y.getBoundsForChat)(e),[r,n,i]=yield Promise.all([(0,h.getChatTable)().remove(e.toString()),(0,y.queryAndRemoveMessageHistory)(e),v(e)]);return{chatBoundaries:t,deletedMsgIds:n}}))).then(function(){var t=(0,a.default)((function*(t){let{chatBoundaries:n,deletedMsgIds:a}=t;if(n){if(d.default.purgeRange((0,i.default)({chatId:e.toString()},n)),(0,f.receiveReactionsEnabled)()){const t=r(68819).getJobManager;yield t().waitUntilPersisted(g.jobSerializers.deleteReactions(e.toString(),a))}}else __LOG__(3)`sendConversationDelete: chat boundaries was null`}));return function(){return t.apply(this,arguments)}}())},t.sendConversationDelete=function(e,t,n){let i=Promise.resolve({status:400,_duplicate:!1});if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){if((0,f.clearOrDeleteChatSyncEnabled)())i=b(e,!0);else{const r=n();(t&&t.equals(r)||t===r)&&(i=b(e,!1))}i=i.then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0&&(0,f.receiveReactionsEnabled)()){const n=t.result,i=r(68819).getJobManager;return yield i().waitUntilPersisted(g.jobSerializers.deleteReactions(e.toString(),n)),t}return t}));return function(){return t.apply(this,arguments)}}())}else i=S.default.sendConversationDelete(e,t);return i};var i=n(r(81109)),a=n(r(48926)),o=r(381),s=r(92844),l=r(84902),c=r(38342),d=n(r(69048)),u=r(45741),p=r(7293),f=r(57701),_=r(82663),h=r(76214),g=r(6684),m=r(54598),y=r(13946),E=r(99069),S=n(r(56891));function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e){if(!(0,f.canEditLabelAssociation)())return;const{labelsToUpdate:t,modelRecords:r}=yield C(e);yield(0,u.editLocalLabelAssociationMD)(t,r)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e){return{labelsToUpdate:(yield(0,m.queryLocalLabelAssociation)([{associationId:e.toString(),type:_.LabelAssociationType.Jid}])).map((e=>{let{labelId:t}=e;return{id:t,type:"remove"}})),modelRecords:[{labelAssociationType:_.LabelAssociationType.Jid,modelId:e.toString(),mutationIndexSegments:[e.toString({legacy:!0})]}]}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[{lockForMessageRangeSync:i},{default:d}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937)),Promise.resolve().then(r.bind(r,36014))]),u=r(56928).default,p=(0,s.unixTimeMs)(),[_,g,m]=yield Promise.all([u.getDeleteChatMutation(p,e,!n),d.getPinMutation(p,!1,e),M(e)]),E=[...m];let S;return(0,f.pinChatSyncEnabled)()&&E.push(g),t&&E.push(_),yield i(["message","chat","label-association"],E,(0,a.default)((function*(){var r;t&&(yield(0,c.addActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("deleteChat",{deleteMedia:!n}),_.binarySyncAction));const i=null===(r=(0,l.decodeProtobuf)(o.SyncActionValueSpec,_.binarySyncAction).deleteChatAction)||void 0===r?void 0:r.messageRange;i&&(S=yield(0,y.queryAndRemoveMessagesInMessageRange)(e,i),yield Promise.all([(0,h.getChatTable)().remove(e.toString()),v(e)]))}))),{status:200,_duplicate:!1,result:S}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){if(!(0,f.canEditLabelAssociation)())return[];const{labelsToUpdate:t,modelRecords:r}=yield C(e);return(0,u.createLabelAssociationMutations)(t,r)}))).apply(this,arguments)}},11082:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(){return c.apply(this,arguments)},t.findLocal=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(68638),o=r(7293),s=r(64448),l=n(r(56891));function c(){return(c=(0,i.default)((function*(e,t){const r=performance.now(),n=yield l.default.chatFindQuery(e,(e=>{t.binarySize=e.binarySize}));return"preempted"!==n&&(t.timing=Math.ceil(performance.now()-r),t.size=n.length),n}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const t=yield(0,a.getTable)().get(e);if(t)return(0,s.hydrateWids)(t)}return null}))).apply(this,arguments)}},9025:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getExisting=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(69951),o=r(11082),s=r(7293);function l(){return(l=(0,i.default)((function*(e){const t=a.ChatCollection.get(e);if(t&&!t.stale)return t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,o.findLocal)(e.toString());if(t)return a.ChatCollection.gadd(t)}return null}))).apply(this,arguments)}},11902:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLastReceivedKey=function(){return Promise.resolve()}},45197:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendConversationMute=function(e,t,r){let n;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){{const r=l.default.generateMuteMutation(e,t);n=(0,s.lockForSync)(["chat"],[r],(r=>{let[n]=r;return n.merge(e.toString(),{muteExpiration:t})})).then((()=>({status:200,_duplicate:null})))}n||(n=Promise.reject(new Error("Should not reach here")))}else n=a.default.sendConversationMute(e,t,r).then((e=>{if(200!==e.status)throw new o.ServerStatusCodeError(e.status);return e}));return n};var i=r(7293),a=n(r(56891)),o=r(77591),s=r(38804),l=n(r(70119))},3060:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resyncMessages=function(){return c.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(7293),s=r(99069),l=n(r(56891));function c(){return(c=(0,a.default)((function*(e){const t=yield l.default.resyncMessages(e);if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&(!t.status||t.status<400)){const{data:e}=t,n=[],o=[];return e.forEach((e=>{r(69951).ChatCollection.get(e.id)?"clear"===e.type?n.push({id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid,muteExpiration:e.muteExpiration,ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp}):"delete"===e.type?o.push(e.id.toString()):n.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()})):n.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()}))})),(0,s.getStorage)().lock(["chat"],function(){var e=(0,a.default)((function*(e){let[t]=e;return yield t.bulkCreateOrMerge(n),t.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()).then((()=>t)).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get storage or bulk update chats failed`,SEND_LOGS("get storage or bulk update chats failedwhen re-sync messages"),new Error("get storage or bulk update chats failed")}))}return t}))).apply(this,arguments)}},97848:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markConversationSeen=function(e,t){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,d.getChatTable)().merge(e.toString(),{unreadCount:t}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark convestation seen"),new Error("update chat table failed")}));return Promise.resolve()},t.markConversationUnseen=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,d.getChatTable)().merge(e.toString(),{unreadCount:-1}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark conversation as unseen"),new Error("update chat table failed")}));return Promise.resolve()},t.sendConversationSeen=function(){return _.apply(this,arguments)},t.sendConversationUnseen=function(e,t){let n;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(n=Promise.all([Promise.resolve().then(r.bind(r,19937))]).then((t=>{let[{lockForMessageRangeSync:i}]=t;const s=r(64294).default,l=(0,a.unixTimeMs)();n=s.getMarkChatAsReadMutation(l,!1,e).then((t=>i([],[t],(()=>(0,o.addActiveMessageRange)(e.toString(),"markChatAsRead",t.binarySyncAction)))))})),n||(n=Promise.reject(new Error("Should not reach here")))):n=p.default.sendConversationUnseen(e,t).then((e=>{const{status:t}=e;if(200!==t)throw new f.ServerStatusCodeError(t)}));return n};var i=n(r(48926)),a=r(92844),o=r(38342),s=r(48285),l=r(64103),c=r(7293),d=r(76214),u=r(35099),p=n(r(56891)),f=r(77591);function _(){return(_=(0,i.default)((function*(e,t,n){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937))]),l=r(64294).default,c=(0,a.unixTimeMs)();if(-1===n){const t=yield l.getMarkChatAsReadMutation(c,!0,e.id),r=e.id.toString();i([],[t],(()=>(0,o.addActiveMessageRange)(e.id.toString(),"markChatAsRead",t.binarySyncAction))),yield(0,s.updateChatForMarkAsReadSync)(r)}else yield(0,u.markChatRead)(e,t);return{_duplicate:!1}}const i=yield p.default.sendConversationSeen(e.id,t,n),{status:l,_duplicate:d}=i;if(200!==l)throw new f.ServerStatusCodeError(l);return{_duplicate:d}}))).apply(this,arguments)}},86657:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeleteMsgs=function(e,t,n){let f;const _=[],h=[];if(e.forEach((e=>{_.push(e.id),h.push(String(e.rowId))})),o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const o=a.default.getDeleteForMeMutations(e,t),u=_.map((e=>e.toString()));if(f=(0,d.lockForSync)(["message","label-association"],o,(()=>(0,l.removeMessagesFromHistory)(u))).then(function(){var e=(0,i.default)((function*(e){if((0,s.receiveReactionsEnabled)()&&u.length>0){const e=r(68819).getJobManager;yield e().waitUntilPersisted(c.jobSerializers.deleteReactions(n.toString(),u))}return e}));return function(){return e.apply(this,arguments)}}()).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove messages from history failed`,SEND_LOGS("remove messages from history failed when send delete messages"),new Error("remove messages from history failed")})),!f)return Promise.reject(new Error("Not Supported for Non-MD"))}else f=u.default.sendMessageDelete(n,_,t).then((e=>{if(200!==e.status)throw new p.ServerStatusCodeError(e.status)}));return f};var i=n(r(48926)),a=n(r(41058)),o=r(7293),s=r(57701),l=r(84886),c=r(6684),d=r(38804),u=n(r(56891)),p=r(77591)},69694:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendStarMsgs=function(e,t,r){let n;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(n=d(t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=l.default.sendMessageStarred(e,t.map((e=>e.id)),r).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return n},t.sendUnstarAll=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=d(e,!1),r||(r=Promise.reject(new Error("Should not reach here")))):r=l.default.sendUnstarAll(t).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return r};var i=r(7293),a=r(84886),o=r(38804),s=n(r(78375)),l=n(r(56891)),c=r(77591);function d(e,t){t||s.default.addUnsetActionCount(e.length);const n=r(21263).default.getStarMessageMutations(e,t);return(0,o.lockForSync)(["message"],n,(()=>t?(0,a.starMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`star messages failed`,SEND_LOGS("star messages failed"),new Error("star messages failed")})):(0,a.unstarMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`unstar messages failed`,SEND_LOGS("unstar messages failed"),new Error("unstar messages failed")}))))}},58871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,n.getTable)().merge(e.toString(),t).catch((e=>{if(e instanceof i.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when update local"),new Error("update chat table failed")}));return Promise.resolve()};var n=r(68638),i=r(64103),a=r(7293)},30312:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendSetBlock=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(56375),o=r(7293),s=r(76214),l=n(r(56891)),c=r(77591);function d(){return(d=(0,i.default)((function*(e,t){let r;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){r=(e?(0,a.blockUser)(t):(0,a.unblockUser)(t)).then((e=>{if(e&&null!=e.errorCode)throw new c.ServerStatusCodeError(e.errorCode,e.errorText);return!0})),r||(r=Promise.reject(new Error("Should not reach here")))}else r=l.default.sendSetBlock(e,[{jid:t}]).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status);return!(e._duplicate||200!==e.status)}));const n=yield r;if(n&&o.GK.supportsFeature(o.GK.F.MD_BACKEND))try{const r=t.toString();return e?yield(0,s.getBlocklistTable)().createOrReplace({id:r}):yield(0,s.getBlocklistTable)().remove(t.toString()),n}catch(e){throw __LOG__(4,!0,new Error,!0)`send set block failed`,SEND_LOGS("Failed to send set block"),new Error("send set block failed")}return n}))).apply(this,arguments)}},45873:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setChecksum=function(e){n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.setContactChecksum)(e);return Promise.resolve()};var n=r(7293),i=r(50313)},8071:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFrequent=function(e){const t={};Object.keys(e).forEach((r=>{t[r]=e[r].map((e=>e.toString()))})),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.setFrequentContacts)(t);return Promise.resolve()};var n=r(7293),i=r(50313)},88129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactsToRemove=function(e){const t=[],i={};return e.forEach((e=>{e&&(i[e.id]=!0)})),n.ContactCollection.forEach((e=>{const{id:n}=e;!(e.isUser||e.isGroup&&!r(69951).ChatCollection.get(n))||i[n.toString()]||e.isPSA||t.push(e)})),t};var n=r(19380)},26707:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(){return u.apply(this,arguments)},t.sendSpamReport=function(e,t){let r;a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(r=(0,l.reportSpam)(e,t).then((e=>{if(null==e?void 0:e.errorCode)throw new d.ServerStatusCodeError(e.errorCode,e.errorText)})),r||(r=Promise.reject(new Error("Should not reach here")))):r=c.default.sendSpamReport(e.id).then((e=>{if(200!==e.status)throw new d.ServerStatusCodeError(e.status)}));return r};var i=n(r(48926)),a=r(7293),o=r(90101),s=r(76214),l=r(18701),c=n(r(56891)),d=r(77591);function u(){return(u=(0,i.default)((function*(e){let t;return t=a.GK.supportsFeature(a.GK.F.MD_BACKEND)?Promise.resolve():c.default.sendConversationNotSpam(e.id).then((e=>{if(200!==e.status)throw new d.ServerStatusCodeError(e.status)})),yield t,a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(e.isGroup&&e.groupMetadata&&(yield(0,o.persistGroupMetadata)(e.groupMetadata.id,{notAddedByContact:!1})),(0,s.getChatTable)().merge(e.id.toString(),{notSpam:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get chat table merge failed`,SEND_LOGS("get chat table merge failed when sending spam report"),new Error("get chat table merge failed")}))):Promise.resolve()}))).apply(this,arguments)}},27211:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,i.getTable)().merge((0,n.toPhoneUserJid)(e.user),t);return Promise.resolve()};var n=r(72441),i=r(4233),a=r(7293)},9995:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactSync=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(10058),s=r(7293),l=r(76214);function c(){return(c=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,l.getContactTable)().all();if(t.length>0){const r=t.map((e=>(0,a.createWid)(e.id)));return(0,o.syncContactListInChunksJob)(r,e)}}}))).apply(this,arguments)}},79583:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendCreateGroup=function(e,t,r,n,l,c,d,u){let p;if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)){if(p=(0,i.createGroup)(e,t,d,u).then((e=>({gid:e.wid,participants:e.participants.map((e=>({[e.wid.toString()]:{code:null!=e.error?e.error.toString():"200",invite_code:e.invite_code,invite_code_exp:e.invite_code_exp}})))}))),!p)return Promise.reject(new Error("queryGroupInvite: not supported when not build with MD_BACKEND"))}else p=o.default.createGroup(e,t,r,n,l,c,d).then((e=>{if(200===e.status)return e;throw new s.ServerStatusCodeError(e.status)}));return p};var i=r(26539),a=r(7293),o=n(r(56891)),s=r(77591)},90447:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markExited=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return(0,i.getTable)().merge(e.toString(),{isReadOnly:!0});return Promise.resolve()},t.sendExitGroup=function(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(t=(0,a.leaveGroups)([e]).then((()=>({_duplicate:null}))),!t)return Promise.reject(new Error("sendExitGroup: not supported when not build with MD_BACKEND"))}else t=s.default.leaveGroup(e).then((e=>{if(200!==e.status)throw new l.ServerStatusCodeError(e.status);return{_duplicate:e._duplicate}}));return t};var i=r(68638),a=r(12594),o=r(7293),s=n(r(56891)),l=r(77591)},64808:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendJoinGroupViaInviteV4=function(e,t,r,n){return(0,o.joinGroupViaInviteV4)(e,t,r,n)},t.sendQueryGroupInviteV4=function(){return s.apply(this,arguments)},t.sendRevokeGroupInviteV4=function(e,t){return(0,o.revokeGroupInviteV4)(e,t)};var i=n(r(81109)),a=n(r(48926)),o=r(82394);function s(){return(s=(0,a.default)((function*(e,t,r,n,a){const s=yield(0,o.queryGroupInviteV4)(e,t,r,n,a);return null!=s.groupMetadata?(0,i.default)({},s.groupMetadata):{status:s.status}}))).apply(this,arguments)}},10790:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.groupMetadataFindFromPhone=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("groupMetadataFindFromPhone: not supported in MD_BACKEND mode"));return u.default.groupMetadataFindFromPhone(e)},t.sendQueryGroup=function(){return f.apply(this,arguments)},t.sendQueryGroupInvite=function(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(t=(0,l.queryGroupInvite)(e).then((e=>(0,i.default)({status:200},e))),!t)return Promise.reject(new Error("queryGroup: not supported when not build with MD_BACKEND"))}else t=u.default.groupInviteInfo(e).then((e=>{if(200!==e.status)throw new p.ServerStatusCodeError(e.status);return e}));return t},t.updateSubject=_;var i=n(r(81109)),a=n(r(48926)),o=r(19380),s=r(7293),l=r(85057),c=r(61051),d=r(31515),u=n(r(56891)),p=r(77591);function f(){return(f=(0,a.default)((function*(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(__LOG__(2,void 0,void 0,void 0,["groups"])`querying server for groupMetadata of group id ${e.toString()}`,t=(0,c.queryGroupJob)(e,"interactive"),!t)return Promise.reject(new Error("queryGroup: not supported when not build with MD_BACKEND"))}else t=u.default.groupMetadataFind(e);try{const r=yield t;if(r.id)return _(e,r.subject),{id:r.id,owner:r.owner,creation:r.creation,desc:r.desc,descId:r.descId,descOwner:r.descOwner,descTime:r.descTime,restrict:r.restrict||!1,announce:r.announce||!1,noFrequentlyForwarded:r.noFrequentlyForwarded||!1,ephemeralDuration:r.ephemeralDuration||0,participants:r.participants,support:!0===r.support};__LOG__(3)`Store:GroupMetadata Unexpected server response`}catch(t){if(t instanceof p.ServerStatusCodeError&&t.status>=400)return{id:e,stale:!1};throw t}}))).apply(this,arguments)}function _(e,t){(0,d.isString)(t)&&o.ContactCollection.find(e).then((function(e){e.name||e.set({name:t})}))}},13194:(e,t,r)=>{"use strict";t.Z=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){let e=!1;return e=(0,a.isRegistered)(),e}return!!(0,n.getLoginTokens)().server};var n=r(99234),i=r(7293),a=r(58052)},90549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCartView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CART_VIEW,e)},t.qplPointOrderCreate=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,e)},t.qplPointOrderView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,e)},t.qplPointPLMDetailsView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,e)},t.qplPointProductView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,e)},t.qplPointProfileCatsView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,e)},t.qplPointProfileSave=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,e)};var n=r(48870),i=r(27798)},97563:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=s,t.updateLocalAndModel=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(7293),o=r(90981);function s(e,t){return a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(0,o.getTable)().merge(e.toString(),t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`updateLocal: failed to update in storage`,SEND_LOGS("message updateLocal failed"),e})):Promise.resolve()}function l(){return(l=(0,i.default)((function*(e,t){try{yield s(e,t);const n=r(59871).MsgCollection.get(e);n&&n.set(t)}catch(e){return Promise.reject(new Error(`[messaging] updateLocalAndModel: failed with error ${e}`))}}))).apply(this,arguments)}},25680:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getHighestAck=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(35470),o=r(7293),s=r(17972);function l(){return(l=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const t=yield s.MsgInfoCollection.find(e.id);if(!t)return __LOG__(2)`getHighestAck: no orphan ack found for ${e.id}`,null;let r=null,n=null;return 0===t.playedRemaining&&0!==t.played.length?(n=a.ACK.PLAYED,r=t.played):0===t.readRemaining&&0!==t.read.length?(n=a.ACK.READ,r=t.read):0===t.deliveryRemaining&&0!==t.delivery.length&&(n=a.ACK.RECEIVED,r=t.delivery),null==n||null==r?(__LOG__(2)`getHighestAck: orphan ack has 0 receipt for ${e.id}`,null):(__LOG__(2)`getHighestAck: orphan ack ${n} for ${e.id}`,{ack:n,t:Math.max(...r.map((e=>e.t))),to:e.to,from:e.from,deliveryPrivacyMode:t.deliveryPrivacyMode})}return Promise.reject(new Error("getHighestAck: not supported for non MD"))}))).apply(this,arguments)}},76581:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgFindByIds=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.getMsgsByMsgKey)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindByIds: failed to find msg in storage`,SEND_LOGS("msgFindByIdsMD failed"),e}));return Promise.resolve([])},t.msgFindQuery=function(e,t,r,n){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.msgFindQuery)(e,t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindQuery: failed to find msg in storage`,SEND_LOGS("msgFindQueryMD failed"),e}));return o.default.msgFindQuery(e,t,r,n)},t.queryVcard=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.queryVcard)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`queryVcard: failed to find vCard in storage`,SEND_LOGS("queryVcardMD failed"),e}));return o.default.queryVcard(e)};var i=r(7293),a=r(84886),o=n(r(56891))},28259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMsgInfo=function(){return u.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(15461),s=r(7293),l=r(47124),c=n(r(56891)),d=r(77591);function u(){return(u=(0,a.default)((function*(e){let t;const{id:r}=e;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(t=(0,l.queryMsgInfo)(e.id).catch((e=>{throw __LOG__(4,!0,new Error,!0)`sendQueryMsgInfo: failed to find msg info in storage`,SEND_LOGS("queryMsgInfo failed"),e})),t||(t=Promise.reject(new Error("Should not reach here")))):t=c.default.queryMsgInfo(r).then((e=>{if(e.status>=400)throw __LOG__(2)`model:MsgInfo:findQuery error ${e.status}`,new d.ServerStatusCodeError(e.status);return e}));const n=yield t;return(0,i.default)((0,i.default)({},n),{},{id:r,usePlayReceipt:e.type===o.MSG_TYPE.PTT||e.isViewOnce})}))).apply(this,arguments)}},7992:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterPresence=function(){n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.sendDeliveryReceiptsAfterPresence)()};var n=r(7293),i=r(16927)},90298:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageSendMetric=h,t.logSuccessfulMessageSend=g,t.sendMsgRecord=function(e){let t=Promise.resolve();if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const n=h(e);let i;e.isForwarded&&(i=function(e){const t={messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,isFrequentlyForwarded:Boolean(e.isFrequentlyForwarded)};null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration);if(!e.isGroupMsg){const n=(0,s.getMaybeMeUser)(),i=r(28307).getDisappearingModeSettingForUser,a=i(n);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}const n=e.getWamDisappearingModeInitiator();null!=n&&(t.disappearingChatInitiator=n);return new d.default.ForwardSend(t)}(e));const{encryptAndSendMsg:a}=r(95547);t=a(e).catch((t=>{throw __LOG__(3,void 0,void 0,void 0,["messaging"])`sendMsgRecord: MD send failure, msg: ${e.id.toString()}`,(0,p.updateLocalAndModel)(e.id,{isSendFailure:!0}),t})).then((t=>(null!=t.deviceCount&&(n.deviceSizeBucket=(0,u.default)(t.deviceCount)),g(n,e),i&&m(i),{t:parseInt(t.t,10),data:null})))}else t=f.default.msgCreateRecord(e).then((e=>{if(200!==e.status)throw new _.ServerStatusCodeError(e.status);return e}));return t};var i=n(r(81109)),a=r(92844),o=r(16116),s=r(99234),l=r(7293),c=r(42515),d=n(r(11339)),u=n(r(16786)),p=r(97563),f=n(r(56891)),_=r(77591);function h(e){const t=(0,i.default)({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,messageIsForward:Boolean(e.isForwarded),isViewOnce:Boolean(e.isViewOnce)},(0,c.getGroupMetricsFromChatWid)(e.to));if(null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration),!e.isGroupMsg){const n=(0,s.getMaybeMeUser)(),i=r(28307).getDisappearingModeSettingForUser,a=i(n);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}const n=e.getWamDisappearingModeInitiator();return null!=n&&(t.disappearingChatInitiator=n),new d.default.MessageSend(t)}function g(e,t){e.messageSendResult=d.default.MESSAGE_SEND_RESULT_TYPE.OK,e.messageSendResultIsTerminal=!1,m(e),(0,o.handleActivitiesForChatThreadLogging)([{activityType:"msgSend",chatId:t.id.remote,ts:(0,a.unixTime)(),isViewOnce:Boolean(t.isViewOnce)}])}function m(e){e.markMessageSendT(),e.commit()}},1985:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setPresenceAvailable=function(){l.GK.supportsFeature(l.GK.F.MD_BACKEND)?(0,c.default)("available"):u.default.sendPresenceAvailable().catch((0,i.filteredCatch)([p.WebdDrop,s.ProtoVersionUndefined],(()=>{})))},t.setPresenceUnavailable=function(){l.GK.supportsFeature(l.GK.F.MD_BACKEND)?(0,c.default)("unavailable"):u.default.sendPresenceUnavailable().catch((0,i.filteredCatch)([p.WebdDrop,s.ProtoVersionUndefined],(()=>{})))},t.subscribePresence=function(e,t){let r;if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){let n;n=e instanceof a.default?e:(0,o.createWid)(e),r=Promise.resolve((0,d.default)(n,t)),r||(r=Promise.reject(new Error("md:subscribePresence: not supported when not build with MD_BACKEND")))}else r=u.default.subscribePresence(e);return r};var i=r(50796),a=n(r(89867)),o=r(45454),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(7293),c=n(r(93167)),d=n(r(34083)),u=n(r(56891)),p=r(77591);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}},5018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.profilePicFind=v,t.profilePicFindThumbFromPhone=function(){return S.apply(this,arguments)},t.profilePicResync=function(){return C.apply(this,arguments)},t.requestDeletePicture=function(){return y.apply(this,arguments)},t.sendSetPicture=function(){return E.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(15688),s=n(r(45095)),l=r(94943),c=r(7293),d=r(76214),u=r(41601),p=r(17117),f=n(r(66612)),_=r(99069),h=r(2541),g=n(r(56891)),m=r(77591);function y(){return(y=(0,a.default)((function*(e){let t;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(t=(0,f.default)(e,null).then((()=>({_duplicate:!1,status:200}))),t||(t=Promise.reject(new Error("Should not reach here")))):t=g.default.deletePicture(e).then((e=>{if(e.status&&200!==e.status)throw new m.ServerStatusCodeError(e.status);return e}));const n=yield t;return n._duplicate?n:c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(0,d.getProfilePicThumbTable)().remove(e.toString()).then((()=>{(0,r(37638).changeProfilePicThumb)(e,u.PROFILE_PIC_COMMAND.REMOVE)})).then((()=>n)):n}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,n){let i;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=h.URL.parseDataURL(n).data,r=(0,o.decodeB64)(t);i=(0,f.default)(e,r).then((0,a.default)((function*(){const t=yield(0,l.getProfilePicFull)(e);return{_duplicate:!1,tag:t.tag,eurl:t.eurl,token:"",status:200}}))),i||(i=Promise.reject(new Error("Should not reach here")))}else i=g.default.sendSetPicture(e,t,n).then((e=>{if(200!==e.status)throw new m.ServerStatusCodeError(e.status);return e}));const s=yield i,p=yield A(e);if(s.token=p,s._duplicate)return s;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=e.toString();return(0,d.getProfilePicThumbTable)().createOrMerge(t,{id:t,tag:s.tag,eurl:s.eurl}).then((()=>{(0,r(37638).changeProfilePicThumb)(e,u.PROFILE_PIC_COMMAND.SET)})).then((()=>s))}return s}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const r=yield g.default.profilePicFindThumbFromPhone(e,t),n=yield A(e);if(r.token=n,c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const e=r.id.toString();return(0,d.getProfilePicThumbTable)().createOrMerge(e,{id:e,tag:r.tag,raw:r.raw}).then((()=>r))}return r}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e){let t;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(t=Promise.all([(0,l.getProfilePicFull)(e),(0,l.getProfilePicPreview)(e)]).then((e=>{const t=e[0],r=e[1];return{tag:t.tag,eurl:t.eurl,previewEurl:r.eurl,token:""}})),t||(t=Promise.reject(new Error("Should not reach here")))):t=g.default.profilePicFind(e).then((e=>{if(null!=e.status&&200!==e.status)throw new m.ServerStatusCodeError(e.status);return e}));const r=t=>(0,_.getStorage)().lock(["profile-pic-thumb"],function(){var r=(0,a.default)((function*(r){let[n]=r;return(yield n.get(e.toString()))?n.merge(e.toString(),t):n.create(t)}));return function(){return r.apply(this,arguments)}}()),n={id:e.toString(),tag:void 0,eurl:void 0,raw:void 0,previewEurl:void 0};try{const i=yield(0,s.default)(t,"serverPromise");return A(e).then((e=>(i.token=e,c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(n.tag=i.tag,n.eurl=i.eurl,n.raw=null,n.previewEurl=i.previewEurl,r(n).then((()=>i))):i)))}catch(e){if(!(e instanceof m.ServerStatusCodeError))throw e;if(!c.GK.supportsFeature(c.GK.F.MD_BACKEND))throw e;return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&404===e.status||!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&401===e.status?(n.tag="",n.raw=null):(n.tag=null,n.eurl=null,n.previewEurl=null),r(n).then((()=>{throw e}))}}))).apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{const t=yield v(e.id);return{id:e.id,eurl:t.eurl,tag:t.tag,token:t.token,previewEurl:t.previewEurl}}catch(t){if(t instanceof m.ServerStatusCodeError)switch(t.status){case 401:case 404:return{id:e.id,tag:"",token:""};default:return __LOG__(3)`ProfilePicThumb:resyncPictures error - ${t.status}, ${t.message}`,{id:e.id,token:""}}throw t}}));return function(){return e.apply(this,arguments)}}()));const t=yield g.default.resyncPictures(e);return Array.isArray(t)?Promise.all(t.map(function(){var e=(0,a.default)((function*(e){const t=yield A(e.id);return(0,i.default)((0,i.default)({},e),{},{token:t})}));return function(){return e.apply(this,arguments)}}())):"number"==typeof t.status&&t.status>=400?(423!==t.status&&429!==t.status&&__LOG__(3)`ProfilePicThumbStore:resyncPictures error ${t.status}`,Promise.reject(new m.ServerStatusCodeError(t.status))):(__LOG__(3)`ProfilePicThumbStore:resyncPictures unknown reply`,Promise.reject(new Error("ProfilePicThumbStore:resyncPictures unknown reply")))}))).apply(this,arguments)}function A(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return Promise.resolve("");const t=String(e),r=new ArrayBuffer(2*t.length),n=new Uint16Array(r);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return Promise.resolve().then((()=>(0,p.getSecurityToken)(r)))}},69722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExists=function(e){const t=`+${e.toString()}`;let r;if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return Promise.all([l.default.queryExist(t),(0,o.isDisappearingModeEnabled)()?l.default.queryDisappearingMode(e):Promise.resolve()]).then((e=>{let[t,r]=e,n=null;if(200===t.status&&(n={wid:t.jid,biz:t.biz||!1}),null!=n&&null!=r&&200===r.status){const e=r.duration,t=r.settingTimestamp;n=(0,i.default)({disappearingMode:{duration:e,settingTimestamp:t}},n)}return n}));r=(0,s.queryExist)(t),r||(r=Promise.reject(new Error("Should not reach queryExists MD")));return r},t.queryPhoneExists=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,s.queryExist)(e);return Promise.reject(new Error("Should Not Reach queryPhoneExists preMD"))};var i=n(r(81109)),a=r(7293),o=r(10435),s=r(71820),l=n(r(56891))},80469:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMediaConn=function(e){return(0,s.backoff)({delay:e=>{let{taskDuration:t}=e;const r=1e3*p();return Math.max(r-t,0)},signal:e},function(){var t=(0,a.default)((function*(t){let r;if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){if(r=(0,c.queryMediaConn)(e),!r)return Promise.reject(new Error("sendQueryMediaConn: not supported when not build with MD_BACKEND"))}else r=d.default.queryMediaConnections(e);try{const e=yield r;let{ttl:t,authTTL:n}=e;return null==n?(n=1e3*t,t=3e5):(n*=1e3,t*=1e3),(0,i.default)((0,i.default)({},e),{},{authTTL:n,ttl:t})}catch(e){if(e instanceof u.E507)throw e;if(e instanceof u.ServerStatusCodeError&&e.status>=500)return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())};var i=n(r(81109)),a=n(r(48926)),o=r(37178),s=r(77712),l=r(7293),c=r(78518),d=n(r(56891)),u=r(77591);const p=(0,o.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:9e5,jitter:.25})},8369:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){let e;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(e=(0,a.default)().then((e=>{if(e.success)return e.result;throw new s.ServerStatusCodeError(e.errorCode,e.errorText)})),e||(e=Promise.reject(new Error("Should not reach here")))):e=o.default.queryServerProps();return e};var i=r(7293),a=n(r(66501)),o=n(r(56891)),s=r(77591)},2223:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateQuickReply=function(e){let t=Promise.resolve();if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const{id:r,shortcut:n,count:a,message:o,keywords:s}=e;t=(0,i.getQuickReplyTable)().createOrReplace({id:r,shortcut:n,count:a,message:o,keywords:s})}return t};var n=r(7293),i=r(76214)},75250:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryReactions=function(){return u.apply(this,arguments)},t.updateHasReactionInParent=d;var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(7293),l=r(63374),c=r(97563);function d(e,t){const n=r(59871).MsgCollection.get(e);return n&&n.hasReaction!==t?(0,c.updateLocalAndModel)(n.id,{hasReaction:t}):Promise.resolve()}function u(){return(u=(0,a.default)((function*(e){let t;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(t=(0,l.getReactions)(e.id.toString()).catch((e=>{throw __LOG__(4,!0,new Error,!0)`getReactions: failed to find msg info in storage`,SEND_LOGS("getReactions failed"),e})),t||(t=Promise.reject(new Error("Should not reach here")))):t=Promise.reject(new Error("Not supported in non MD"));const r=yield t,n=r.reactions.map((e=>{const t=e.senders.map((e=>(0,i.default)((0,i.default)({},e),{},{id:o.default.fromString(e.msgKey)})));return(0,i.default)((0,i.default)({},e),{},{hasReactionByMe:e.hasReactionByMe,id:e.aggregateEmoji,senders:t})})),a=n.length>0;return yield d(e.id.toString(),a),(0,i.default)((0,i.default)({},r),{},{id:e.id,reactions:n})}))).apply(this,arguments)}},25224:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(7293),o=r(16258),s=r(3151),l=n(r(56891));function c(e){if(null!=e)switch(e){case o.MediaRetryNotificationResultType.SUCCESS:return 200;case o.MediaRetryNotificationResultType.NOT_FOUND:case o.MediaRetryNotificationResultType.DECRYPTION_ERROR:return 404;case o.MediaRetryNotificationResultType.GENERAL_ERROR:return 500}return 500}function d(){return(d=(0,i.default)((function*(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return s.RequestMediaReuploadManager.requestMediaReupload(e).then((e=>{let{result:t,directPath:r}=e;return{status:c(t),directPath:r,isMD:!0}}));const{status:t,url:r,mediaKey:n,mediaKeyTimestamp:i,encFilehash:o,directPath:d}=yield l.default.requestMediaReupload(e);return{isMD:!1,status:t,url:r,mediaKey:n,mediaKeyTimestamp:i,encFilehash:o,directPath:d}}))).apply(this,arguments)}},85195:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);t.Z=function(e,t){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND))return function(e,t){const r=new Uint8Array((0,o.decodeB64)(e)),n=(0,c.unixTime)();return E(t,function(){var e=(0,a.default)((function*(e){const i=yield(0,h.default)(r,n);if(null==i?void 0:i.errorCode){if(i.errorCode>=500)throw new g.ServerStatusCodeError(i.errorCode,i.errorText);e(t)}e(void 0)}));return function(){return e.apply(this,arguments)}}())}(e,t);return function(e,t){const r=new FormData;r.append("t",String((0,c.unixTime)())),r.append("v","2.2208.7");const n=(0,u.getLoginTokens)().server;n&&r.append("tok",n);return r.append("buffer",e),E(t,function(){var e=(0,a.default)((function*(e){const n=yield(0,d.default)(y,{method:"POST",body:r});if(200===n.status)e(void 0);else{if(n.status>=500)throw new g.ServerStatusCodeError(n.status);e(t)}}));return function(){return e.apply(this,arguments)}}())}(e,t)};var a=i(r(48926)),o=r(15688),s=r(13959),l=r(4352),c=r(92844),d=i(r(18561)),u=r(99234),p=r(7293),f=i(r(57220)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),h=i(r(13176)),g=r(77591);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}const y="https://web.whatsapp.com/wam";function E(e,t){return(0,l.promiseLoop)(function(){var r=(0,a.default)((function*(r,i,a){const o=(0,s.delayMs)(_.expBackoff(a,12e4,1e3,.1));try{return yield f.default.waitIfOffline({signal:(new n).signal}),yield t(r)}catch(t){return a>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,r(e)):o}}));return function(){return r.apply(this,arguments)}}())}},24569:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);t.Z=function(e,t){if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND)||!(0,d.getABPropConfigValue)("web_ps_v3_enabled"))return Promise.resolve(t);const r=new Uint8Array((0,o.decodeB64)(e));return i=t,f=function(){var e=(0,a.default)((function*(e){const{uploadedBufferKeys:n,metrics:i}=yield(0,c.upload_UNSAFE_INTERNAL_DO_NOT_USE)([{key:t,content:r}],p.getToken);i.map(m),0===n.length&&e(t),e(void 0)}));return function(){return e.apply(this,arguments)}}(),(0,l.promiseLoop)(function(){var e=(0,a.default)((function*(e,t,r){const a=(0,s.delayMs)(h.expBackoff(r,12e4,1e3,.1));try{return yield _.default.waitIfOffline({signal:(new n).signal}),yield f(e)}catch(t){return r>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,e(i)):a}}));return function(){return e.apply(this,arguments)}}());var i,f};var a=i(r(48926)),o=r(15688),s=r(13959),l=r(4352),c=r(14604),d=r(86945),u=r(7293),p=r(35065),f=i(r(11339)),_=i(r(57220)),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}function m(e){const{result:t,uploadTime:r,httpResponseCode:n}=e,i=function(e){switch(e){case"success":return f.default.PS_BUFFER_UPLOAD_RESULT.SUCCESS;case"error-server-other":return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_SERVER_OTHER;case"error-parsing":return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_PARSING;case"error-decoding":return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_DECODING;case"error-credential":return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_CREDENTIAL;case"error-other":return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_OTHER;default:return f.default.PS_BUFFER_UPLOAD_RESULT.ERROR_ACCESS_TOKEN}}(t);new f.default.PsBufferUpload({psBufferUploadResult:i,psBufferUploadT:r,psBufferUploadHttpResponseCode:n,applicationState:"visible"===document.visibilityState?f.default.APPLICATION_STATE.FOREGROUND:f.default.APPLICATION_STATE.BACKGROUND}).commit()}},51316:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(e){let t;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(t=(0,o.default)(e).then((e=>e.error?(__LOG__(3)`getStatus: failed ${e.error.errorCode} : ${e.error.errorText}`,{id:e.id,stale:!0,status:""}):{id:e.id,status:null!=e.status?e.status:""})),t||(t=Promise.reject(new Error("getAbout: invalid when build with MD_BACKEND")))):t=u.default.statusFind(e).then((t=>({id:e,status:null!=t.status?t.status:""}))).catch((0,a.filteredCatch)(p.WebdDrop,(()=>({id:e,stale:!0,status:""}))));return t},t.queryStatusAll=function(){let e=Promise.resolve();e=s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(0,d.queryStatusAllMD)():u.default.statusQuery();return e},t.queryStatusUpdate=function(e,t,r){let n=Promise.resolve();if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.resolve([]);return n=u.default.statusQuery(e,t,r,"after"),n},t.sendReadStatus=function(){return f.apply(this,arguments)},t.setMyStatus=function(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const n=r(68819).getJobManager;t=n().waitUntilCompleted(l.jobSerializers.setAbout(e)),t||(t=Promise.reject(new Error("setStatus: invalid when build with MD_BACKEND")))}else t=u.default.sendSetStatus(e);return t};var i=n(r(48926)),a=r(50796),o=n(r(66457)),s=r(7293),l=r(6684),c=r(35099),d=r(6331),u=n(r(56891)),p=r(77591);function f(){return(f=(0,i.default)((function*(e,t,r){let n;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(yield(0,c.markStatusRead)(e,r),n=!0,null==n)throw new Error("sendReadStatus: shouldn't reach here (md_backend was disabled)!")}else{n=200===(yield u.default.sendStatusSeen(e,t)).status}return n}))).apply(this,arguments)}},92486:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceiptBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(77723).Z;t=n(e),t||(t=Promise.reject(new Error("Should not reach here")))}else t=Promise.resolve(e);return t},t.sendCallEndBridge=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=Promise.resolve({}),r||(r=Promise.reject(new Error("Should not reach here")))):r=o.default.sendCallEnd(e,t);return r},t.sendCallOfferBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(26775).Z;t=n(e,a.TYPE.OFFER),t||(t=Promise.reject(new Error("Should not reach here")))}else t=e.payload[2].find((e=>"enc"===e[0]))?o.default.sendCallOffer(e):o.default.sendGroupCallOffer(e);return t},t.sendCallSignalingMsgBridge=function(e,t){let n;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const t=r(25662).Z;n=t(e),n||(n=Promise.reject(new Error("Should not reach here")))}else n=o.default.sendCallSignalingMsg(e,t);return n},t.sendEncRekeyBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(26775).Z;t=n(e,a.TYPE.ENC_REKEY),t||(t=Promise.reject(new Error("Should not reach here")))}else t=o.default.sendCallSignalingMsg(e);return t},t.sendQueryCallBridge=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=Promise.resolve({status:200}),r||(r=Promise.reject(new Error("Should not reach here")))):r=o.default.queryCall(e,t);return r};var i=r(7293),a=r(45473),o=n(r(56891))},15183:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),a=t.blocklist.map((e=>({id:e}))),o=r(32826).BlocklistCollection;n.GK.supportsFeature(n.GK.F.MD_BACKEND)?(0,i.getBlocklistTable)().clear().then((()=>Promise.all(a.map((e=>{let{id:t}=e;return(0,i.getBlocklistTable)().create({id:t.toString()})}))))).then((()=>o.set(a))):o.set(a)};var n=r(7293),i=r(76214)},70257:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),n=r(69951).ChatCollection,I=r(59871).MsgCollection;if(Array.isArray(t)){const e=[],s=[],l=[],d=[];t.forEach((function(t){if("c.us"===t.id)s.push(t);else{const r=!!n.get(t.id),i=["delete","clear","ephemeral","archive","unarchive","star","unstar","spam","modify_tag","pin","modify"].includes(t.type);i?r&&i?s.push(t):__LOG__(2)`Model:chat:handle received junk chat record: ${JSON.stringify(t)}`:e.push(t)}}));const f=e.find((e=>p.default.isPSA(e.id)));null!=f&&(f.name=A.default.t(1029));const _=r(19011).AllStarredMsgsCollection;let h;return s.forEach((function(e){const t=e.type;if("c.us"===e.id.toString()){switch(n.disableSortListener(),t){case"clear":__LOG__(2)`Model:chat:handle:clear:all before:${String(e.before)} kind:${String(e.kind)}`,n.forEach((function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)}));break;case"delete":__LOG__(2)`Model:chat:handle:delete:all`,n.toArray().forEach((function(e){e.isGroup?e.deleteMsgs(!0):l.push(e)}));break;case"archive":__LOG__(2)`Model:chat:handle:archive:all`,n.forEach((function(e){d.push({id:e.id,archive:!0,pin:void 0})}));break;case"unarchive":__LOG__(2)`Model:chat:handle:unarchive:all`,n.forEach((function(e){d.push({id:e.id,archive:!1})}));break;case"unstar":__LOG__(2)`Model:chat:handle:unstar:all`,_.delete(),n.forEach((function(e){e.unstarAll()}));break;default:__LOG__(3)`Model:chat:handle unknown ${JSON.stringify(e)}`}n.enableSortListener()}else{const r=n.get(e.id);if(!r)return;switch(t){case"ephemeral":if(null!=e.t){const t=r.getLastReceivedNonExpiredMsg(e.t);t&&(0,b.setLastReceivedKey)(r.id,t.id).then((()=>{r.lastReceivedKey=t.id}))}break;case"clear":case"star":case"unstar":if(e.keys){const r=e.keys.length,n="star"===t,i=[],a=[],o=[];let s=!1;for(let l=0;l<r;l++){let r,d,p,f,_;const h=e.keys[l];Array.isArray(h)?([r,d,p]=h,f=new u.default({fromMe:d,remote:e.id,id:r,participant:p}),_=I.get(f),_?"clear"===t?_.delete():(_.star=n,o.push(_)):n&&(s=!0)):!(0,c.default)(h)||"star"!==t&&"unstar"!==t||(f=h.id,_=I.get(h.id),_?(_.star=n,o.push(_)):a.push(h)),i.push(f&&f.toString())}"star"!==t&&"unstar"!==t||_.process(n,a,o,s),__LOG__(2)`model:Chat:handle:messages:${[t,e.id,i.join(),e.modifyTag].join()}`}else"clear"===t?("number"==typeof e.before?r.deleteMsgsOlderThan(e.before,e.star,e.kind):r.deleteMsgs(e.star,e.kind),__LOG__(2)`model:Chat:handle cleared chat:${[e.id,e.before,e.modifyTag,e.kind].join()}`):"unstar"===t&&(r.unstarAll(),__LOG__(2)`model:Chat:handle unstarred chat: ${e.id}`);isNaN(e.modifyTag)||d.push({id:e.id,modifyTag:e.modifyTag});break;case"delete":l.push(r),__LOG__(2)`model:Chat:handle deleted chat for ${String(e.id)}`;break;case"archive":d.push({id:e.id,archive:!0,pin:void 0});break;case"unarchive":d.push({id:e.id,archive:!1});break;case"spam":d.push({id:e.id,notSpam:e.notSpam});break;case"modify_tag":d.push({id:e.id,modifyTag:e.modifyTag});break;case"pin":d.push({id:e.id,pin:e.pin});break;case"modify":d.push({id:e.id,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid})}}})),h=E.GK.supportsFeature(E.GK.F.MD_BACKEND)?(0,P.getStorage)().lock(["chat"],function(){var t=(0,o.default)((function*(t){let[r]=t;try{return yield r.bulkCreateOrMerge(e.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString()})))),yield Promise.all(d.map((e=>{const{id:t}=e,n=(0,i.default)(e,M);r.merge(t.toString(),n)}))),r.bulkRemove(l.map((e=>e.id.toString())))}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ChatHandler: bulk handle error")}}));return function(){return t.apply(this,arguments)}}()):Promise.resolve(),h.then((()=>{n.add(e,{merge:!0}),d.forEach((e=>{const{id:t}=e,r=(0,i.default)(e,O),a=n.get(t);a&&a.set(r)})),l.forEach((e=>e.delete()))}))}if("leave"===t.cmd)t.gids.forEach((function(e){const t=n.get(e);t&&(0,m.localExitGroup)(t)}));else{if("preempt"===t.cmd){let e=Promise.resolve();E.GK.supportsFeature(E.GK.F.MD_BACKEND)&&(e=(0,f.getTable)().bulkCreateOrMerge(t.response.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString(),muteExpiration:0})))));const r=(0,S.getBridge)();return e.then((()=>r.sendAndReceive("chat_collection","add",{things:t.response,options:{merge:!0}}))).then((()=>{h.Conn.platform!==h.PLATFORMS.IPHONE&&h.Conn.platform!==h.PLATFORMS.SMBI||((0,l.default)(t.response)?r.fireAndForget("msg_collection","trigger",{name:d.COLLECTION_HAS_SYNCED}):setTimeout((()=>{r.fireAndForget("msg_collection","trigger",{name:d.COLLECTION_HAS_SYNCED})}),2500)),r.fireAndForget("chat_collection","trigger",{name:d.COLLECTION_HAS_SYNCED,args:{count:t.response.length,binarySize:t.binarySize}})}))}if("action"===t.cmd){const e=t.id,r=t.data;if("create"!==r[0]&&"introduce"!==r[0]){if(r.length<3)return void __LOG__(3)`model:chat: incorrect length of payload data for action ${JSON.stringify(t)}`;const e=t.data[0],n="unknown"===t.data[1]?null:t.data[1];let i;return i=e===v.GROUP_ACTIONS.RESTRICT||e===v.GROUP_ACTIONS.ANNOUNCE||e===v.GROUP_ACTIONS.NO_FORWARD?{action:e,value:t.data[2]}:e===v.GROUP_ACTIONS.EPHEMERAL?{action:e,duration:t.data[2]}:(0,a.default)({action:e},t.data[2]),(0,C.handleGroupActionWap)({chatId:t.id,author:n},i)}{const t=r[1],i=r[2],a=[...(0,s.default)(i.admins,(e=>({id:e,isAdmin:!0}))),...(0,s.default)(i.superadmins||[],(e=>({id:e,isAdmin:!0,isSuperAdmin:!0}))),...(0,s.default)(i.regulars,(e=>({id:e,isAdmin:!1})))];T.default.add({id:e,creation:i.creation,owner:t,participants:a,stale:!1,desc:i.desc,descId:i.descId,descTime:i.descTime,descOwner:i.descOwner,restrict:!!i.restrict,announce:!!i.announce},{merge:!0}),g.ContactCollection.add({id:e,name:i.subject},{merge:!0});const o=n.get(e);if(!o)return;const l=o.msgs.last();if(!l)return;if("gp2"===l.type&&"add"===l.subtype){const t=(0,y.getMaybeMeUser)();T.default.trigger(`group_participant_change_${t.toString()}`,e),p.default.equals(l.recipients[0],t)&&_.Cmd.alertNewMsg(l)}}}else __LOG__(3)`model:chat: unknown payload: ${JSON.stringify(t)}`}};var i=n(r(6479)),a=n(r(81109)),o=n(r(48926)),s=n(r(35161)),l=n(r(41609)),c=n(r(13218)),d=r(13042),u=n(r(65212)),p=n(r(89867)),f=r(68638),_=r(88102),h=r(17239),g=r(19380),m=r(5501),y=r(99234),E=r(7293),S=r(41796),v=r(36098),T=n(r(63928)),C=r(34648),A=n(r(43725)),b=r(11902),P=r(99069);const M=["id"],O=["id"]},32720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();switch(t.type){case"picture":(0,i.changeProfilePicThumb)(t.jid,t.tag);break;default:(0,n.handle)([t])}return Promise.resolve()};var n=r(98423),i=r(37638)},66405:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t;const n=e.shift();n.id="1";const u=r(56891).default,{protoVersion:p,binVersion:f,features:_}=n;if(p){l.GK.setVersion(p);const e=l.GK.setFeatures(_);t=!!e.KEY_PARTICIPANT,u.setVersion(p,f,null==_?void 0:_.FLAGS)}if(n.initial){l.GK.setPlatform(n.platform),(0,s.setLogoutToken)(n.browserToken),n.hasOwnProperty("is24h")&&a.Clock.setIs24Hour(n.is24h);const e=n.ref,t=n.serverToken,r=n.clientToken,i=n.connected;e&&i&&t&&(0,s.setRefTok)(e,t),(0,s.setLoginTokens)({client:r,server:t});const p=n.secret?u.setSharedSecret(n.secret):Promise.resolve();return Promise.all([(0,c.requireContactCollection)(),p]).then((e=>{let[t]=e;if("true"!==n.isResponse&&d.save(),n.wid){const e=n.wid;(0,s.setMe)(e),o.Conn.trigger("me_ready"),n.pushname&&(o.Conn.pushname=n.pushname,(0,s.setPushname)(n.pushname)),t.gadd(e)}o.Conn.set(n)}))}o.Conn.connected&&t&&(__LOG__(2)`models:Conn:participantChange:to:${String(l.GK.supportsFeature(l.GK.F.KEY_PARTICIPANT))}`,i.default.hardRefresh());return o.Conn.set(n),Promise.resolve()};var i=n(r(87045)),a=r(22683),o=r(17239),s=r(99234),l=r(7293),c=r(46582),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(17117));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}},78496:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();if(Array.isArray(t)){const r=e.shift();!function(e,t){const r=t&&"remove"===t.missing?(0,s.getContactsToRemove)(e):[];(0,l.mungePSAContact)(e),i.ContactCollection.add(e,{merge:!0}),r.forEach((e=>{e.unset("name"),e.unset("shortName")})),(null==t?void 0:t.checksum)&&(i.ContactCollection.setChecksum(t.checksum),__LOG__(2)`handle:Contact update checksum ${t.checksum}`);__LOG__(2)`handle:Contact updated ${e.map((e=>e.id)).join()}`}(t,r)}else"preempt"===t.cmd?function(e){(0,l.mungePSAContact)(e.response),i.ContactCollection.add(e.response,{merge:!0}),e.checksum&&(i.ContactCollection.setChecksum(e.checksum),__LOG__(2)`Store:Contact:handle update checksum ${e.checksum}`);i.ContactCollection.trigger(n.COLLECTION_HAS_SYNCED,{count:e.response.length,binarySize:e.binarySize})}(t):"frequent"===t.type?function(e){let t;delete e.type,t=o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(0,a.setFrequent)(e):Promise.resolve();t.then((()=>{i.ContactCollection.updateFrequentContacts(e)}))}(t):"sidelist"===t.type?function(e){const{notification:t,action:r,hash:n}=e,a=i.ContactCollection.resolveWidsFromHash(n);if(!a)return;"business"===t&&"profile"===r&&a.forEach((e=>{const t=i.ContactCollection.get(e);if(t)t.businessProfile&&t.businessProfile.markStale();else{const e=i.ContactCollection.getUserCount(),t=i.ContactCollection.contactHashLength();__LOG__(4,void 0,new Error,!0)`Hash: ${n} Users: ${e}, Hashes: ${t}`,SEND_LOGS("Stale wid in contact hash index")}}))}(t):__LOG__(3)`handle:Contact unknown: ${JSON.stringify(t)}`};var n=r(13042),i=r(19380),a=r(8071),o=r(7293),s=r(88129),l=r(76285)},67938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!Array.isArray(e))return __LOG__(4,void 0,new Error,!0)`ws2: Invalid message, not an array`,void SEND_LOGS("ws2:invalid-msg");const t=e.shift();switch(t){case"Blocklist":return void(0,i.default)(e);case"Contact":return void(0,l.default)(e);case"Props":case"ServerProps":return void r(64551).ServerProps.handle(e);case"Location":case"LiveLocation":return void r(85865).LiveLocationCollection.handle(e);case"Chat":return void(0,a.default)(e);case"Msg":return void(0,c.default)(e);case"Stream":return void(0,p.default)(e);case"Conn":return void(0,s.default)(e);case"Cmd":return void(0,o.default)(e);case"Presence":return void(0,u.default)(e);case"MsgInfo":return void(0,d.default)(e);case"BusinessProfile":return void r(93581).BusinessProfileCollection.handle(e);case"GroupMetadata":return void r(63928).default.handle(e);case"Label":return void r(16770).LabelCollection.handle(e);case"QuickReply":return void r(99662).QuickReplyCollection.handle(e);case"Call":return void r(31218).CallCollection.handle(e);case"Mute":return void r(72472).MuteCollection.handle(e);case"Status":return void r(46133).StatusCollection.handle(e);case"StatusV3":return void r(59387).StatusV3Collection.handle(e);default:__LOG__(4,void 0,new Error,!0)`ws2: Invalid type received: ${t}`,SEND_LOGS("ws2: Invalid type received")}};var i=n(r(15183)),a=n(r(70257)),o=n(r(32720)),s=n(r(66405)),l=n(r(78496)),c=n(r(26453)),d=n(r(74609)),u=n(r(82805)),p=n(r(80169))},26453:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let[t]=e;const n=r(59871).MsgCollection;function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,r){let i;i=d.default.isStatusV3(t.broadcast)?new c.default({from:t.from,to:t.broadcast,id:r,selfDir:t.self||"out"}):new c.default({from:t.from,to:e,id:r,participant:t.participant,selfDir:t.self||"out"});const a=n.get(i);a?yield(0,p.updateMsgAck)(a,t.broadcast,{from:t.from,to:e,ack:t.ack,t:t.t}):(__LOG__(2)`Msg:out of order ack`,n.preAck[i]=t)}))).apply(this,arguments)}if("ack"===t.cmd){const e=[t.to];if(d.default.isBroadcast(t.to)&&t.ack===s.ACK.SENT){const r=h.default.get(t.to);r&&Array.prototype.push.apply(e,(0,a.default)(r.participants.toArray(),"id"))}const r=e.map((e=>m(e,t.id)));return Promise.all(r)}if("acks"===t.cmd){const e=t.id.map((e=>m(t.to,e)));return Promise.all(e)}if(t.msg){if(!(t.chat instanceof d.default))return Promise.resolve();const e="update"===t.meta.add;return d.default.isStatusV3(t.chat)&&!r(59387).StatusV3Collection.handleUpdate(t.msg,t.meta.checksum,e)?Promise.resolve():(t.msg.recvFresh=!0,t.msg.isNewMsg=!0,n.processMultipleMessages(t.chat,[t.msg],{add:"after",update:e,isHistory:!1}).catch((0,o.filteredCatch)(g.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Msg: ${String(t.msg.id)} chat: ${String(t.chat)} Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler: error storing/processing single message")})))}if(t.msgs){const e=t.msgs.length;if(!e)return Promise.resolve();let r=null;if(!(t.chat instanceof d.default))return Promise.resolve();const i=t.meta;i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new c.default({fromMe:i.unreadFromMe,remote:t.chat,id:i.unreadId,participant:i.unreadParticipant}),r=new f.ChatMsgsCollection);for(let r=0;r<e;r++){t.msgs[r].invis=!0}return _.Conn.platform!==_.PLATFORMS.IPHONE&&_.Conn.platform!==_.PLATFORMS.SMBI||n.trigger(l.COLLECTION_HAS_SYNCED),n.trigger("handle:msg_history",{count:t.msgs.length,binarySize:t.binarySize}),n.processMultipleMessages(t.chat,t.msgs,i,r).catch((0,o.filteredCatch)(g.LogoutDrop,(()=>{}))).catch((r=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${e} Chat: ${String(t.chat)} Error: ${r.name}, message: ${r.message}, stack: ${r.stack}`,SEND_LOGS("msg_handler: error storing/processing multiple messages")}))}if(t.recent){const e=t.meta,r=t.binarySize;return delete t.recent,delete t.meta,delete t.binarySize,n.trigger(l.COLLECTION_HAS_SYNCED,{count:Object.keys(t).length,binarySize:r}),e.isHistory=!0,Promise.all(Object.keys(t).map((r=>{let i;try{i=(0,u.createWid)(r)}catch(e){return Promise.resolve()}const a=t[r];a.invis=!0;const s="last"===e.add&&e.resume?new f.ChatMsgsCollection:null;n.processMultipleMessages(i,[a],e,s).catch((0,o.filteredCatch)(g.LogoutDrop,(()=>{}))).catch((()=>{__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("msg_handler: error storing recent messages")}))})))}return __LOG__(2)`************** Msg else clause. something strange is going on`,Promise.resolve()};var i=n(r(48926)),a=n(r(35161)),o=r(50796),s=r(35470),l=r(13042),c=n(r(65212)),d=n(r(89867)),u=r(45454),p=r(78027),f=r(51612),_=r(17239),h=n(r(63928)),g=r(77591)},74609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),{from:r,to:i,ack:a,participant:o,t:s}=t;switch(t.cmd){case"ack":n.MsgInfoCollection.updateInfo(t.id,r,i,a,o,s);break;case"acks":t.id.forEach((e=>{n.MsgInfoCollection.updateInfo(e,r,i,a,o,s)}))}};var n=r(17972)},82805:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();return(0,i.default)(t)};var i=n(r(54248))},80169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e[0]){case"asleep":break;case"killsw":n.Updater.killServiceWorker();break;case"update":case"update_desktop":break;default:__LOG__(3)`Stream:handle unknown cmd ${e[0]}`}};var n=r(29898)},41796:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBridge=function(){return(0,i.default)(a,"_bridge")},t.isConnectedToPage=function(){return true},t.setBridge=function(e){a=e};var i=n(r(45095));let a=null},79736:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBridge=function(){return new n.DynamicRouter};var n=r(2486)},22854:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=r(99234),a=n(r(52991)),o=n(r(43610)),s=r(70818);var l={whoAmI(){const e=(0,i.getMaybeMeUser)().toString();return Promise.resolve(e)},logImpl:(e,t,r,n,i)=>(s.Logger.logImpl(e,t,r,n,i),Promise.resolve()),initFromStorage:()=>o.default.invoke("initFromStorage",[]),setLogoutState:e=>(a.default.isLogoutInProgress=e,o.default.invoke("setLogoutState",[e])),sendLogs:e=>r(85965).sendLogs(e),deleteDbEncKeyCache:()=>o.default.invoke("deleteDbEncKeyCache",[]),initDatabaseEncnKey:e=>o.default.invoke("initDatabaseEncnKey",[e]),generateFinalDbEncryptionAndFtsKey:e=>o.default.invoke("generateFinalDbEncryptionAndFtsKey",[e]),startBackendWorker:e=>o.default.invoke("startBackendWorker",[e])};t.Z=l},41208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new MessageChannel,r=t.port1,n=t.port2;s.default.respondTo(r),i.default.init(),o.default.setConnectionManager(i.default),i.default.connectVia(r),e.postMessage((0,a.buildHandshakePayload)(n),[n])};var i=n(r(82090)),a=r(3620),o=n(r(43610)),s=n(r(72601))},79038:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41208));const a=new(n(r(35474)).default);(0,i.default)(a);var o=a;t.default=o},82090:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(45095)),a=r(38284),o=r(88156),s=n(r(41143));var l=new class{init(){return this._port=null,this._deferred=new o.Resolvable,(0,a.promiseTimeout)(this._deferred.promise,5e3)}isConnected(){return null!=this._port}getPort(){return this._port}waitForConnection(){var e;return(0,i.default)(null===(e=this._deferred)||void 0===e?void 0:e.promise,"ConnectionManager Initialization Promise")}connectVia(e){if(this.isConnected())throw new Error("Connection already established");(0,s.default)(this._deferred,"ConnectionManager not initialized"),this._port=e,this._deferred.resolve()}};t.default=l},52991:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));const a={[i.default.WEBC_SCENARIO_TYPE.IDLE]:0,[i.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING]:3e5,[i.default.WEBC_SCENARIO_TYPE.OFFLINE_RESUME]:12e4};let o,s;const l={isLogoutInProgress:!1,getCurrentScenario(){var e;return null!==(e=s)&&void 0!==e?e:i.default.WEBC_SCENARIO_TYPE.IDLE},initOrUpdateTracking(e){o&&clearTimeout(o),s=e,s!==i.default.WEBC_SCENARIO_TYPE.IDLE&&(o=setTimeout((()=>{s=i.default.WEBC_SCENARIO_TYPE.IDLE,o=null}),a[e]))}};t.default=l},43610:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=n(r(41143)),s=r(12758),l=r(22068),c=r(23097);var d=new class{constructor(){this._pending=new Map,this._onResponseReceipt=e=>{const t=(0,c.unwrapResponsePayload)(e.data);if(null!=t){const{invocationId:e,result:r}=t;if(this._pending.has(e)){const{resolve:t}=(0,a.default)(this._pending.get(e),"this._pending.get(invocationId)");t(r),this._pending.delete(e)}}}}setConnectionManager(e){this._conn=e,e.waitForConnection().then((()=>{const t=(0,a.default)(e.getPort(),"Port obtained from ConnectionManager after connection");t.addEventListener("message",this._onResponseReceipt),t.start()}))}invoke(e,t){var r=this;return(0,i.default)((function*(){(0,o.default)(r._conn,"Connection has not been inited"),yield r._conn.waitForConnection(),(0,o.default)(r._conn,"Connection has not been inited");const n=(0,a.default)(r._conn.getPort(),"Port obtained from ConnectionManager after connection"),i=(0,l.genInvocationId)();return n.postMessage((0,s.buildInvocationPayload)({invocationId:i,method:e,args:t})),new Promise(((e,t)=>{r._pending.set(i,{resolve:e,reject:t})}))}))()}};t.default=d},72601:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(12758),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77303)),a=r(23097);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var s=new class{constructor(){this._onMessage=(e,t)=>{const r=t.data,o=(0,n.unwrapInvocationPayload)(r);if(null!=o){const{method:t,args:r,invocationId:n}=o;i.get()[t](...r).then((t=>{e.postMessage((0,a.buildResponsePayload)(n,t))}))}}}respondTo(e){e.addEventListener("message",(t=>this._onMessage(e,t))),e.start()}};t.default=s},22068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractInvocationId=function(e){if(null!=e&&"number"==typeof e)return e},t.genInvocationId=function(){return r++};let r=1},77303:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.get=s,t.log=void 0,t.sendLogs=function(e){return s().sendLogs(e)},t.set=function(e){o=e};var i=n(r(45095)),a=n(r(76589));let o;function s(){return(0,i.default)(o,"InvocationInterface was not inited")}const l=(0,n(r(98387)).default)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];const u=(0,a.default)(o,c,!t);let p;return r&&(p={name:r.name,stack:r.stack}),s().logImpl(e,u,p,n,i),u}}),((e,t,r,n,i)=>r||i?null:String(e)+String(Boolean(t))+String(Boolean(n))));t.log=l},3620:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildHandshakePayload=function(e){return{__command:a.HANDSHAKE_COMMAND,__port:e}},t.extractPortFromHandshakePayload=function(e){if(null!=e&&null!=e.__command&&e.__command===a.HANDSHAKE_COMMAND&&null!=e.__port){(0,i.default)(e.__port instanceof MessagePort,"Malformed connection payload");return e.__port}};var i=n(r(41143)),a=r(37557)},12758:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildInvocationPayload=function(e){let{invocationId:t,method:r,args:n}=e;return{__id:t,__command:o.INVOCATION_COMMAND,__method:r,__args:n}},t.unwrapInvocationPayload=function(e){if(null!=e&&e.__command===o.INVOCATION_COMMAND){(0,i.default)(e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.__method&&"string"==typeof e.__method&&e.__id&&e.__args&&Array.isArray(e.__args),"Malformed invocation message");const r=e,n=r.__method,o=r.__args;return{method:n,args:o,invocationId:t}}};var i=n(r(41143)),a=r(22068),o=r(37557)},23097:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildResponsePayload=function(e,t){return{__id:e,__command:o.RESPONSE_COMMAND,__result:t}},t.unwrapResponsePayload=function(e){if(null!=e&&e.__command===o.RESPONSE_COMMAND){(0,i.default)(null!=e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.hasOwnProperty("__result"),"Malformed response message");return{result:e.__result,invocationId:t}}};var i=n(r(41143)),a=r(22068),o=r(37557)},37557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_COMMAND=t.INVOCATION_COMMAND=t.HANDSHAKE_COMMAND=void 0;t.HANDSHAKE_COMMAND="@@handshake";t.INVOCATION_COMMAND="@@invoke";t.RESPONSE_COMMAND="@@response"},88102:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Revoke=t.CmdImpl=t.Cmd=t.APP_STATE_SYNC_COMPLETED=void 0;var a=i(r(48926)),o=i(r(81109)),s=i(r(23279)),l=r(89385),c=i(r(41143)),d=r(92200),u=i(r(34342)),p=r(7293),f=(i(r(11339)),r(31019));const _=r(76672).Mirrored(["Sender","Admin"]);t.Revoke=_;t.APP_STATE_SYNC_COMPLETED="app_state_sync_completed";class h extends u.default{constructor(){super(...arguments),this.isMainLoaded=!1,this.uiBusy=0,this.isMainStreamReadyMd=!1,this._clearUiBusy=(0,s.default)((()=>{this.uiBusy&&(__LOG__(2)`cmd:clearUIBusy uibusy timeout`,this.uiBusy=0,this._triggerIdleEvent())}),1e3,{maxWait:5e3}),this._triggerIdleEvent=function(e){let t;const r=()=>{if(t)return;t=new n;const{signal:r}=t;(0,d.documentFlushed)({signal:r}).then((()=>{r.aborted||(t=null,e())}),(e=>{if(e.name!==l.ABORT_ERROR)throw e}))};return r.cancel=()=>{t&&(t.abort(),t=null)},r}((()=>{(0,c.default)(0===this.uiBusy,`ui_idle triggered when uiBusy is ${this.uiBusy}`),0===this.uiBusy&&(this._clearUiBusy.cancel(),this.trigger("ui_idle"))}))}mainLoaded(){this.isMainLoaded=!0,this.trigger("main_loaded")}incrementProgress(){__LOG__(2)`Cmd: incrementProgress`,this.trigger("increment_progress")}initialLoadReady(){__LOG__(2)`Cmd: initialLoadReady`,this.trigger("initial_load_ready")}logSocketSummary(){this.trigger("log_socket_summary")}muteAll(e,t,r){this.trigger("mute_all",e,t,r)}muteAllCall(e,t){this.trigger("mute_all_call",e,t)}muteChat(e,t){this.trigger("mute_chat",(0,f.unproxy)(e),t)}muteChats(e,t,r){const n=e.map((e=>(0,f.unproxy)(e)));this.trigger("mute_chats",n,t,r)}deleteOrExitChat(e,t){this.trigger("delete_or_exit_chat",(0,f.unproxy)(e),t)}clearChat(e,t){this.trigger("clear_chat",(0,f.unproxy)(e),t)}archiveChat(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trigger("archive_chat",(0,f.unproxy)(e),t,r)}pinChat(e,t){this.trigger("pin_chat",(0,f.unproxy)(e),t)}pinChats(e,t){const r=e.map((e=>(0,f.unproxy)(e)));this.trigger("pin_chats",r,t)}markChatUnread(e,t){this.trigger("mark_chat_unread",(0,f.unproxy)(e),t)}msgInfoDrawer(e){this.trigger("msg_info_drawer",(0,f.unproxy)(e))}chatSearch(e){this.trigger("chat_search",(0,f.unproxy)(e))}chatInfoDrawer(e,t,r){this.trigger("chat_info_drawer",(0,f.unproxy)(e),t,r)}attachMediaDrawer(e){const t=(0,o.default)((0,o.default)({},e),{},{chat:(0,f.unproxy)(e.chat)});this.trigger("attach_media_drawer",t)}attachProduct(e){this.trigger("attach_product",e)}verificationDrawer(e){this.trigger("verification_drawer",e)}liveLocationDrawer(e,t){this.trigger("live_location_drawer",e,t)}expiredLocationDrawer(e){this.trigger("expired_location_drawer",e)}mediaViewerModal(e){const{msg:t,getZoomNode:r,currentTime:n,highlightedMsgIds:i}=e;this.trigger("media_viewer_modal",{msg:t,getZoomNode:r,currentTime:n,highlightedMsgIds:i})}openMediaViewerForAlbumMedia(e){this.trigger("open_media_viewer_for_album_media",e)}productImageViewerModal(e,t){this.trigger("product_image_viewer_modal",e,t)}ephemeralDrawer(e,t,r){this.trigger("ephemeral_drawer",e,t,r)}communityHome(e){this.trigger("open_community_home",e)}sendStarMsgs(e,t,r,n){this.trigger("send_star_msgs",(0,f.unproxy)(e),t,r,n)}sendUnstarMsgs(e,t,r,n){this.trigger("send_unstar_msgs",(0,f.unproxy)(e),t,r,n)}sendDeleteMsgs(e,t,r,n,i){this.trigger("send_delete_msgs",(0,f.unproxy)(e),t,r,n,i)}sendRevokeMsgs(e,t,r){this.trigger("send_revoke_msgs",(0,f.unproxy)(e),t,r)}addFavoriteSticker(e){this.trigger("add_favorite_sticker",e)}removeFavoriteSticker(e){this.trigger("remove_favorite_sticker",e)}_openChat(e,t){const r=(0,f.unproxy)(e);return new Promise((e=>{this.trigger("open_chat",r,t,e)})).catch((e=>{throw __LOG__(2)`Unexpected openChat error: ${String(e)}`,e}))}openChatAt(e,t){var r=this;const n=(0,f.unproxy)(e);if(!t)return this.openChatBottom(n);this.setUiBusy(!0,"open_chat_at");const i=this._openChat(n,t).then(function(){var e=(0,a.default)((function*(e){let n,i;const a=null==t.enableAnimation||t.enableAnimation;if(e)if(e.wasVisible)n=()=>r._scrollToFocusedMsg({pos:"offset",offset:e.offset}),i=()=>r._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.7,0,.3,1]});else switch(n=()=>r._scrollToFocusedMsg({pos:e.alignAt}),e.alignAt){case"top":case"bottom":i=()=>r._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.88,.64,.13,.99]});break;case"center":default:i=()=>Promise.resolve()}else n=()=>r._scrollToFocusedMsg({pos:"center"}),i=()=>Promise.resolve();return yield n(),i()}));return function(){return e.apply(this,arguments)}}()).then((()=>{this.flashFocusedMsg(t.highlightMentionMsg)})).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return i.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),i}openChatFromUnread(e){const t=(0,f.unproxy)(e);let r;if(t.unreadMsgAnchor&&(r={collection:t.unreadMsgAnchor.msgChunk,promise:Promise.resolve(),msg:t.unreadMsgAnchor,isUnreadDivider:t.shouldShowUnreadDivider}),r||t.unreadCount>0){this.setUiBusy(!0,"open_from_unread");const e=this._openChat(t,r).then((()=>this._scrollToFocusedMsg({pos:"top",offset:-120}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return e.finally((()=>{this.setUiBusy(!1,"open_from_unread")})),e}return this.openChatBottom(t)}openChatBottom(e){const t=(0,f.unproxy)(e);let r;this.setUiBusy(!0,"open_bottom"),t.msgs.length>0&&(r={collection:t.msgs,msg:t.msgs.last(),isUnreadDivider:!1});const n=this._openChat(t,r).then((()=>this._scrollChatToBottom())).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return n.finally((()=>{this.setUiBusy(!1,"open_bottom")})),n}scrollToPtt(e){const t=(0,f.unproxy)(e.chat),r={collection:e.chat.msgs,msg:e,key:e.id,highlightMsg:!1};this.setUiBusy(!0,"open_chat_at");const n=this._openChat(t,r).then((()=>this._scrollToFocusedMsg({pos:"center",animate:!0,duration:400,easing:[.7,0,.3,1]}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return n.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),n}_scrollToFocusedMsg(e){return new Promise((t=>{this.trigger("scroll_to_focused_msg",t,e)})).catch((e=>{__LOG__(3)`Unexpected scrollToFocusedMsg error: ${String(e)}`}))}_scrollChatToBottom(){return new Promise((e=>{this.trigger("scroll_chat_to_bottom",e)})).catch((e=>{__LOG__(3)`Unexpected scrollChatToBottom error: ${String(e)}`}))}flashFocusedMsg(e){setTimeout((()=>{this.trigger("flash_focused_msg"),e&&this.trigger("flash_mention_msg")}),0)}updateChatlistSelection(e){const t=(0,f.unproxy)(e);this.trigger("update_chatlist_selection",t)}closeChat(e){const t=(0,f.unproxy)(e);this.trigger("close_chat",t)}focusChatTextInput(e){const t=(0,f.unproxy)(e);t?this.trigger("focus_chat_text_input_"+t.id.toString()):this.trigger("focus_chat_text_input")}toggleQuickReplies(){this.trigger("quick_replies_toggle")}setChatCtwaContextLinkData(e,t){this.trigger("chat_set_ctwa_context_link_data_"+e.id.toString(),t)}addChatMsgSentLogAttributes(e,t){this.trigger("chat_add_sending_log_attributes_"+e.id.toString(),t)}focusShowMsg(e){this.trigger("focus_show_msg",e)}enterChatTextInput(e){const t=(0,f.unproxy)(e);this.trigger("enter_chat_text_input_"+t.id.toString())}focusNextChat(e){this.trigger("focus_next_chat",e)}focusPrevChat(e){this.trigger("focus_prev_chat",e)}focusChatList(){this.trigger("focus_chat_list")}focusChatSearch(){this.trigger("focus_chat_search")}pasteChatTextInput(e,t){const r=(0,f.unproxy)(e);this.trigger("paste_chat_text_input_"+r.id.toString(),t)}startGroupCall(e,t){const r=(0,f.unproxy)(e);this.trigger("voip_start_group_call",r,t)}closeStatusViewer(){this.trigger("close_status_viewer")}sendPasteToCompose(e,t){const r=(0,f.unproxy)(e);this.trigger("send_paste_to_compose_"+r.id.toString(),t)}openComposeBoxPanel(e){this.trigger("open_compose_box_panel",e)}login(e){this.trigger("login",e)}logout(){const e=p.GK.supportsFeature(p.GK.F.MD_BACKEND);p.GK.resetFeatures(),p.GK.setFeature(p.GK.F.MD_BACKEND,e),p.GK.setFeature(p.GK.F.MD_ADV,e),p.GK.setFeature(p.GK.F.MD_VOIP_GROUP,e&&!1),this.trigger("logout")}openContextMenu(e,t){this.trigger("open_context_menu",e,t)}closeContextMenu(e){this.trigger("close_context_menu",e)}openTooltip(e,t){this.trigger("open_tooltip",e,t)}closeTooltip(e){this.trigger("close_tooltip",e)}openToast(e,t){this.trigger("open_toast",e,t)}closeToast(e){this.trigger("close_toast",e)}alertNewMsg(e){this.trigger("alert_new_msg",e)}alertNewReactionMsg(e){this.trigger("alert_new_reaction_msg",e)}newMediaMsg(e){this.trigger("new_media_msg",e)}alertCall(e,t,r,n,i){this.trigger("alert_call",e,t,r,n,i)}cancelCall(e){this.trigger("cancel_call",e)}windowError(){}cannotReachPhone(){}sentPing(){}openModal(e,t){this.trigger("open_modal",e,t)}closeModal(e){this.trigger("close_modal",e)}openModalMedia(e,t){this.trigger("open_media",e,t)}closeModalMedia(){this.trigger("close_media")}setDrawerContext(e,t){this.trigger(`update_context_${e}`,t)}openDrawerRight(e,t,r,n,i){this.trigger("open_drawer_right",e,t,r,void 0,n,i)}openDrawerMid(e,t,r,n,i,a){this.trigger("open_drawer_mid",e,t,r,n,i,a)}openDrawerLeft(e,t,r,n,i){this.trigger("open_drawer_left",e,t,r,void 0,n,i)}existsDrawerRight(e){this.trigger("exists_drawer_right",e)}existsDrawerMid(e){this.trigger("exists_drawer_mid",e)}existsDrawerLeft(e){this.trigger("exists_drawer_left",e)}closeDrawerRight(){this.trigger("close_drawer_right")}closeDrawerMid(){this.trigger("close_drawer_mid")}closeDrawerLeft(){this.trigger("close_drawer_left")}onPanesWillChange(e){this.trigger("panes_will_change",e)}onPanesDidChange(e){this.trigger("panes_did_change",e)}openGroupInviteModal(e){this.trigger("open_group_invite_modal",e)}reactionChangeLastMessage(){this.trigger("reaction_changed_last_msg")}openGroupV4InviteRequestFlow(e,t,r,n){this.trigger("open_group_v4_invite_request_flow",e,t,r,n)}uiResize(){this.trigger("resize")}setUiBusy(e){let t=this.uiBusy||0;e?(++t,this._clearUiBusy(),this._triggerIdleEvent.cancel()):t&&--t,this.uiBusy=t,0===t&&(this._clearUiBusy.cancel(),this._triggerIdleEvent())}windowMouseDown(e){this.trigger("window_mousedown",e)}windowClick(e){this.trigger("window_click",e)}midnight(){this.trigger("midnight")}textsizeChange(e){this.trigger("textsize_change",e)}scrollMessages(){this.trigger("scroll_messages")}getConversationHeaderOffset(e){this.trigger("get_conversation_header_offset",e)}floaterEscapeOverlap(e,t){this.trigger("floater_escape_overlap",e,t)}autoplayPTT(e){this.trigger("sequential_playback_ptt",e)}refreshMessages(){this.trigger("refresh_messages")}readyForMainStreamModeLegacy(){this.trigger("main_stream_mode_ready_legacy")}storageInitializationError(){this.trigger("storage_initialization_error")}restartBackend(){this.trigger("md_restart_backend")}downgradeWebclient(){this.trigger("md_downgrade_webclient")}upgradeToMDInternal(){this.trigger("upgrade_to_md")}upgradeToMDProd(){this.trigger("upgrade_to_md_prod")}refreshQR(){this.trigger("md_refresh_qr")}setSocketState(e){this.trigger("set_socket_state",e)}socketStreamDisconnected(){this.trigger("socket_stream_disconnected")}openSocketStream(){this.trigger("open_socket_stream")}readyForMainStreamMode(){this.isMainStreamReadyMd=!0,this.trigger("main_stream_mode_ready")}onInitialChatHistorySynced(){this.trigger("on_initial_chat_synced")}onRecentChatHistorySynced(){this.trigger("on_recent_chat_history_synced")}onFullChatHistorySynced(){this.trigger("on_full_chat_history_synced")}onHistorySyncChunkProcessed(e){this.trigger("new_history_sync_chunk_processed",e)}handleOfflineProgressUpdate(){this.trigger("offline_progress_update")}criticalSyncDone(){this.trigger("on_critical_sync_done")}onTemporaryBan(e){this.trigger("account_temporarily_banned",e)}onStartingLogout(){this.trigger("starting_logout")}handleFatalError(){this.trigger("handle_fatal_error")}merchantDetailsDrawer(e){this.trigger("merchant_details_drawer",e)}showMerchantDetailsEntityTypePopup(e,t){this.trigger("show_merchant_details_entity_type_popup",e,t)}showCountrySelector(e,t,r,n){this.trigger("show_country_selector_popup",e,t,r,n)}toggleStickerMaker(){this.trigger("toggle_sticker_maker")}onAccountSyncForPrivacy(e){this.trigger("account_sync_for_privacy",e)}openStickerPack(e){this.trigger("open_sticker_pack",e)}onStatusViewerOpen(){this.trigger("status_viewer_open")}triggerStorageAlert(){}abPropsUpdate(){this.trigger("ab_props_update")}}t.CmdImpl=h;const g=new h;t.Cmd=g},35470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EDIT_ATTR=t.ACK_STRING=t.ACK=void 0;t.ACK={MD_DOWNGRADE:-7,INACTIVE:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4,PEER:5};t.EDIT_ATTR={SENDER_REVOKE:7,ADMIN_REVOKE:8};t.ACK_STRING={SENDER:"sender",DELIVERY:"delivery",READ:"read",PLAYED:"played",INACTIVE:"inactive",READ_SELF:"read-self",PLAYED_SELF:"played-self"}},13042:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_SIZE=t.MSG_PRELOAD_THRESHOLD=t.COLLECTION_HAS_SYNCED=void 0;t.COLLECTION_HAS_SYNCED="collection_has_synced";t.PAGE_SIZE=50;t.MSG_PRELOAD_THRESHOLD=20},64369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={IMG_THUMB_MAX_EDGE:100,DOC_THUMB_MAX_EDGE:480,VIDEO_THUMB_MAX_EDGE:480,MAX_PORTRAIT_MEDIA_CAPTION_LENGTH:500,MAX_FILES:30,MEDIA_EDITOR_OUTLINE_TENSION:.4,MMS_THUMBNAIL_UPLOAD_TIMEOUT:3e3,FREQUENTLY_FORWARDED_SENTINEL:127,MAX_SMB_LABEL_COUNT:20,WA_COMMERCE_POLICY_URL:"https://www.whatsapp.com/policies/commerce-policy",MAX_TXT_MSG_SIZE:65536,GROUP_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:100,BUSINESS_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:200,TEMPLATE_URL_START:64,TEMPLATE_URL_END:32,SQUELCH_RESET_VALUE:-1,MAX_CAPTION_LENGTH:1024,REACTION_CONTENT_MAX_LENGTH:30,MAX_CART_MESSAGE_LENGTH:1024,MAX_PUSHNAME_LENGTH:25,KEY_BUNDLE_TYPE:"",NEW_MSG_SENT:"new_msg_sent",ONE_BY_ONE_TRANS_GIF:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",VOIP_LOG_COLOR:"#aa6627",VOIP_MAX_GROUP_CALL_PARTICIPANTS:8,WAM_SYS_INFO_INIT_DELAY:5e3,MARKED_AS_UNREAD:-1};t.default=r},15461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYSTEM_MESSAGE_TYPES=t.MSG_TYPE=void 0;t.MSG_TYPE={NOTIFICATION:"notification",NOTIFICATION_TEMPLATE:"notification_template",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",PROTOCOL:"protocol",CHAT:"chat",LOCATION:"location",PAYMENT:"payment",VCARD:"vcard",CIPHERTEXT:"ciphertext",MULTI_VCARD:"multi_vcard",REVOKED:"revoked",OVERSIZED:"oversized",GROUPS_V4_INVITE:"groups_v4_invite",HSM:"hsm",TEMPLATE_BUTTON_REPLY:"template_button_reply",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",ORDER:"order",LIST:"list",INTERACTIVE:"interactive",LIST_RESPONSE:"list_response",BUTTONS_RESPONSE:"buttons_response",REACTION:"reaction",NATIVE_FLOW:"native_flow",UNKNOWN:"unknown"};t.SYSTEM_MESSAGE_TYPES=["notification","notification_template","group_notification","gp2","broadcast_notification","e2e_notification","call_log","protocol"]},68387:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITY_WITH_ERROR=t.VISIBILITY=t.ALL_NONE_WITH_ERROR=t.ALL_NONE=void 0;var i=n(r(81109));const a={all:"all",contacts:"contacts",contact_blacklist:"contact_blacklist",none:"none"};t.VISIBILITY=a;const o=(0,i.default)((0,i.default)({},a),{},{error:"error"});t.VISIBILITY_WITH_ERROR=o;const s={all:"all",none:"none"};t.ALL_NONE=s;const l=(0,i.default)((0,i.default)({},s),{},{error:"error"});t.ALL_NONE_WITH_ERROR=l},15411:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMPLATE_BUTTON_SUBTYPE=void 0;t.TEMPLATE_BUTTON_SUBTYPE={QUICK_REPLY:"quick_reply",CALL:"call",URL:"url"}},54392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYBOARD_EVENT_KEY_VALUE=void 0;t.KEYBOARD_EVENT_KEY_VALUE={UNIDENTIFIED:"Unidentified",ALT:"Alt",ALT_GRAPH:"AltGraph",CAPS_LOCK:"CapsLock",CONTROL:"Control",FN:"Fn",FN_LOCK:"FnLock",HYPER:"Hyper",META:"Meta",NUM_LOCK:"NumLock",SCROLL_LOCK:"ScrollLock",SHIFT:"Shift",SUPER:"Super",SYMBOL:"Symbol",SYMBOL_LOCK:"SymbolLock",OS:"OS",ENTER:"Enter",TAB:"Tab",SPACE:" ",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down",END:"End",HOME:"Home",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",BACKSPACE:"Backspace",CLEAR:"Clear",COPY:"Copy",CR_SEL:"CrSel",CRSEL:"Crsel",CUT:"Cut",DELETE:"Delete",ERASE_EOF:"EraseEof",EX_SEL:"ExSel",EXSEL:"Exsel",INSERT:"Insert",PASTE:"Paste",REDO:"Redo",UNDO:"Undo"}},83578:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutReason=void 0;const n=r(76672)({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",ClientFatalError:"client_fatal_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change"});t.LogoutReason=n},95770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM=t.IS_MMS_URL_SEARCH_PARAM=void 0;t.IS_MMS_URL_SEARCH_PARAM="__wa-mms";t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM="mms-type"},38839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpamFlow=void 0;const n=r(76672)({Chat:"chat",Account:"account_info",Group:"group_info",Block:"block_dialog",Dropdown:"overflow_menu",MediaViewer:"media_viewer",MessageMenu:"message_menu"});t.SpamFlow=n},47343:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBroadcastEphemeralSetting=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(92844),l=r(84902),c=r(28286);const d=new Uint8Array(32);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=yield self.crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]),n=yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:d,info:t},r,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return self.crypto.subtle.exportKey("raw",n)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r){const n=e.slice(0,12),i=e.slice(12,44),a=yield self.crypto.subtle.importKey("raw",i,"AES-GCM",!1,["decrypt"]);return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(n),additionalData:r},a,t)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,r,n,i){const d=e.toString({legacy:!0}),p=t.toString({legacy:!0}),_=r.toString({legacy:!0}),h=o.Binary.build(`Ephemeral ${p} ${d}`).readByteArray(),g=new Uint8Array(i),m=(0,a.decodeB64)(n),y=o.Binary.build(_).readBuffer(),E=yield u(g,h),S=yield f(E,m,y),{duration:v,timestamp:T}=(0,l.decodeProtobuf)(c.EphemeralSettingSpec,S);if(null==v||null==T)throw new Error("ephSetting decoded into malformed proto");return{ephemeralDuration:v,ephemeralSettingTimestamp:(0,s.castLongIntToUnixTime)(T)}}))).apply(this,arguments)}},24606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisappearingModeInitiator=void 0;const n=r(76672)({ChangedInChat:"chat",InitiatedByMe:"me",InitiatedByOther:"other"});t.DisappearingModeInitiator=n},24175:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEphemeralSystemMessage=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(65212)),o=r(15461),s=r(22683),l=r(99234),c=r(7293);function d(){return(d=(0,i.default)((function*(e,t){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const n=r(5819).handleSingleMsgMD,i={id:new a.default({id:a.default.newId(),remote:e.id,fromMe:!1}),from:e.id,to:(0,l.getMaybeMeUser)(),t:s.Clock.globalUnixTime(),type:o.MSG_TYPE.PROTOCOL,subtype:"ephemeral_setting",ephemeralDuration:t,isNewMsg:!0};yield n(e.id,i,!1,!1)}}))).apply(this,arguments)}},28307:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingModeSettingForChat=function(e){const t=c((0,o.getMaybeMeUser)()),r=c(e);if(!t&&!r)return null;if(t&&r)return r.duration<t.duration?r:t;return null!=r?r:t},t.getDisappearingModeSettingForUser=c,t.getDisappearingModeSettingFromMsg=function(e){var t;if(null==e)return null;const r=c((0,o.getMaybeMeUser)());let n=e.disappearingModeInitiator;if(null!=r&&null==e.disappearingModeInitiator)return r;if(null==r&&e.disappearingModeInitiator===a.DisappearingModeInitiator.InitiatedByMe)n=a.DisappearingModeInitiator.ChangedInChat;else if(null!=e.disappearingModeInitiator&&e.disappearingModeInitiator===a.DisappearingModeInitiator.ChangedInChat)return null;if(null==n)return null;const i=e.ephemeralDuration,s=null!==(t=e.ephemeralSettingTimestamp)&&void 0!==t?t:0;if(null==i||0===i)return null;if(null!=r&&r.settingTimestamp>s)return r;return{duration:i,settingTimestamp:s,initiator:n}};var i=r(19380),a=r(24606),o=r(99234),s=r(7293),l=n(r(68132));function c(e){var t;const r=(0,o.getMaybeMeUser)().toString()===e.toString(),n=i.ContactCollection.get(e);if(!n)return null;let c=n.disappearingModeDuration,d=n.disappearingModeSettingTimestamp;return!s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&r&&(c=l.default.disappearingMode.duration,d=l.default.disappearingMode.settingTimestamp),null==c||0===c?null:(__LOG__(2)`disappearing mode setting fetched for ${e.toString()}: duration=${c} settingTimestamp=${d}`,{duration:c,settingTimestamp:null!==(t=d)&&void 0!==t?t:0,initiator:r?a.DisappearingModeInitiator.InitiatedByMe:a.DisappearingModeInitiator.InitiatedByOther})}},6901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEphemeralExpirationTimestamp=function(e,t,r,n,i){if("ephemeral_setting"===n)return null;if(null==e||0===e)return null;if(i&&null!=t)return t+e;return r+e}},14777:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEphemeralDurationAllowed=function(e){return!(e<0)&&(0===e||n.ServerProps.getEphemeralMessagesAllowedValues().includes(e))};var n=r(64551)},76290:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUpdateEphemeralSetting=function(e){const{oldDuration:t,oldSettingTimestamp:r,newDuration:i,newSettingTimestamp:a,chatId:o}=e;if(a>r)return!0;if(a<r)return!1;if(t===i)return!1;if((0,n.getMaybeMeUser)().isLessThan(o))return!1;return!0};var n=r(99234)},67811:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKED_REACTION_TEXT=t.MAX_REACTIONS_DISPLAY_AGGREGATES=void 0,t.canHaveReactions=E,t.canReactToMessage=function(e){var t;if(!e.canReply())return!1;if(!(0,p.sendReactionsEnabled)())return!1;if(!E(e.type))return!1;if((null===(t=e.chat.groupMetadata)||void 0===t?void 0:t.announce)&&!(0,p.reactionsAnnouncementOnly)())return!1;return!0},t.canRevokeReaction=function(){return(0,p.sendReactionsEnabled)()},t.createReactionsRowFromOffline=function(){return S.apply(this,arguments)},t.getReactionAggregates=m,t.getReactionEmojisAndSum=function(e){let t=[],r=0;if(0===e.length)return{numberOfSenderReactions:r,reactionArrayEmojis:t};if(1!==e.length)return function(e){let t=[],r=0;const n=m(e),i=n.slice(0,3);return t=i.map((e=>e.reactionByMe?e.reactionByMe.reactionText:e.reactionAggregate)),r=n.reduce(((e,t)=>e+t.reactionSenders.length),0),{numberOfSenderReactions:r,reactionArrayEmojis:t}}(e);{const n=e[0],i=n.reactions.slice(0,3);t=i.map((e=>(e.hasReactionByMe&&n.reactionByMe,e.hasReactionByMe&&n.reactionByMe?n.reactionByMe.reactionText:e.aggregateEmoji))),r=n.reactions.reduce(((e,t)=>e+t.senders.length),0)}return{numberOfSenderReactions:r,reactionArrayEmojis:t}},t.isReactionByMe=y,t.lastMessageReactionChange=function(e){const t=r(59871).MsgCollection;e.forEach((e=>{const r=t.get(e);(null==r?void 0:r.isLastMessage())&&c.Cmd.reactionChangeLastMessage()}))},t.reactionBubbleAriaLabelOneReaction=function(e,t){return l.fbt._("{name} reacted with {reactionContent}",[l.fbt._param("name",e),l.fbt._param("reactionContent",t)],{hk:"2Vcjyz"})},t.reactionBubbleAriaLabelString=function(e,t){const r=t.join(f.default.t(407));if(1===e)return l.fbt._("reaction {reactions_content}",[l.fbt._param("reactions_content",r)],{hk:"2ksvWq"});return l.fbt._({"*":"Reactions {reactions_content} {num_sender_reactions} in total",_1:"Reactions {reactions_content} 1 in total"},[l.fbt._plural(e,"num_sender_reactions"),l.fbt._param("reactions_content",r)],{hk:"3KYY1f"})},t.shouldShowReactionBubble=function(e,t){if(!(0,p.receiveReactionsEnabled)())return!1;if(!E(e.type))return!1;if(t===h.ReactionBubbleType.NON_CONVERSATION)return!1;if(t===h.ReactionBubbleType.MEDIA_ITEM&&e.type===o.MSG_TYPE.STICKER)return!1;return!0},t.webMsgInfoReactionTypeToReactionsRow=function(e){let{id:t,reactionTimestamp:r,reactionText:n,reactionParentKey:i,sender:a,unread:o}=e;const l=(0,s.toUserWid)(a);return{msgKey:t.toString(),parentMsgKey:i.toString(),senderUserJid:l.toString(),reactionText:null!=n?n:"",timestamp:r,orphan:0,read:!o}};var i=n(r(48926)),a=n(r(81109)),o=r(15461),s=r(45454),l=r(48360),c=r(88102),d=r(70449),u=r(99234),p=r(57701),f=n(r(43725)),_=r(84886),h=r(94270),g=r(26704);t.REVOKED_REACTION_TEXT="";function m(e){const t=new Map;e.forEach((e=>{let r=null;if(e.reactionByMe){const a=e.reactionByMe.reactionText;r=d.EmojiUtil.getEmojiAggregate(a);const o=t.get(r);if(o){var n,i;const t=(null===(n=o.reactionByMe)||void 0===n?void 0:n.timestamp)||0,r=(null===(i=e.reactionByMe)||void 0===i?void 0:i.timestamp)||0;(o.reactionByMe&&t<r||!o.reactionByMe)&&(o.reactionByMe=e.reactionByMe)}}e.reactions.forEach((r=>{const n=r.aggregateEmoji,i=r.senders.toArray(),a=t.get(n);if(a){const e=a.reactionSenders.concat(i);a.reactionSenders=e,t.set(n,a)}else{const a=r.hasReactionByMe?e.reactionByMe:null;t.set(n,{reactionByMe:a,reactionSenders:i,reactionAggregate:n})}}))}));return Array.from(t.values()).map((e=>{const t=e.reactionSenders.sort(((e,t)=>y(e.senderUserJid)&&!y(t.senderUserJid)?-1:y(t.senderUserJid)&&!y(e.senderUserJid)?1:t.timestamp-e.timestamp));return(0,a.default)((0,a.default)({},e),{},{reactionSenders:t})})).sort(((e,t)=>e.reactionByMe&&t.reactionByMe?t.reactionSenders.length===e.reactionSenders.length?t.reactionByMe.timestamp-e.reactionByMe.timestamp:t.reactionSenders.length-e.reactionSenders.length:e.reactionByMe?-1:t.reactionByMe?1:t.reactionSenders.length===e.reactionSenders.length?t.reactionSenders[0].timestamp-e.reactionSenders[0].timestamp:t.reactionSenders.length-e.reactionSenders.length))}function y(e){return e===(0,u.getMaybeMeUser)().toString()}function E(e){return!(!(0,p.receiveReactionsEnabled)()||e===o.MSG_TYPE.UNKNOWN||e===o.MSG_TYPE.CIPHERTEXT||e===o.MSG_TYPE.REVOKED||e===o.MSG_TYPE.DEBUG||e===o.MSG_TYPE.GP2||e===o.MSG_TYPE.NOTIFICATION||e===o.MSG_TYPE.NOTIFICATION_TEMPLATE||e===o.MSG_TYPE.E2E_NOTIFICATION||e===o.MSG_TYPE.CALL_LOG)}function S(){return(S=(0,i.default)((function*(e){const t=[],r=[];e.forEach((e=>{e.msg&&r.push(e.msg.reactionParentKey.toString())}));const n=yield(0,_.getMsgsByMsgKey)(r),i=new Map;return n.forEach((e=>{i.set(e.id.toString(),e)})),e.forEach((e=>{var r,n;const a=e.msg,l=null===(r=e.receiptInfo)||void 0===r?void 0:r.author;if(!l||!a)return void __LOG__(3)`createReactionsRowFromOffline: sender or reactionMsg are null`;const c=i.get(a.reactionParentKey.toString());let d,u=0;if(c||(u=1,d=g.OrphanReactionsReasonType.ParentMsgMissing),(null==c?void 0:c.type)===o.MSG_TYPE.CIPHERTEXT&&(u=1,d=g.OrphanReactionsReasonType.ParentMsgPlaceholder),c&&c.type!==o.MSG_TYPE.CIPHERTEXT&&!E(c.type))return void __LOG__(3)`createReactionsRowFromOffline: reactions not allowed for this message type ${c.type}`;const p=(0,s.toUserWid)(l),f={msgKey:a.id.toString(),parentMsgKey:a.reactionParentKey.toString(),senderUserJid:p.toString(),reactionText:null!==(n=a.reactionText)&&void 0!==n?n:"",timestamp:a.reactionTimestamp,orphan:u,orphanReason:d,read:!1};t.push(f)})),t}))).apply(this,arguments)}t.MAX_REACTIONS_DISPLAY_AGGREGATES=3},64603:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TcTokenMode=void 0,t.getTcTokenDuration=s,t.isTokenExpired=function(e,t){return e<l(t)},t.shouldSendNewToken=function(e){if(null==e)return!0;const t=(0,i.getABPropConfigValue)("tctoken_duration_sender"),r=Math.floor(a.Clock.globalUnixTime()/t),n=Math.floor(e/t);return r>n},t.tokenExpirationCutoff=l;var n=r(92844),i=r(86945),a=r(22683);const o=r(76672)({Sender:"sender",Receiver:"receiver"});function s(e){const t=e===o.Receiver?"tctoken_duration":"tctoken_duration_sender";return(0,n.castToUnixTime)(Math.min((0,i.getABPropConfigValue)(t),15552e3))}function l(e){const t=e===o.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender",r=(0,i.getABPropConfigValue)(t),l=s(e),c=Math.floor(a.Clock.globalUnixTime()/l);return(0,n.castToUnixTime)((c-(r-1))*l)}t.TcTokenMode=o},69048:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(81109)),o=n(r(45095)),s=n(r(51998)),l=r(6663),c=n(r(79038));var d=new class{constructor(){this._pendingMap=new Map}_ensureWorkerInited(){this._worker||(c.default.onerror=e=>{this._onWorkerError(e)},c.default.onmessageerror=e=>{this._onMessageError(e)},c.default.onmessage=e=>{const t=e.data;this._onWorkerResponse(t)},this._worker=c.default)}_onMessageError(){}_onWorkerError(e){__LOG__(3)`FTS:client: worker error: ${e}`}_onWorkerResponse(e){const{reqId:t}=e,r=this._pendingMap.get(t);r&&(e.error?(__LOG__(3)`FTS:client: worker completed job ${r.command.operation} with error`,r.reject(new Error("FTS worker error"))):r.resolve(e.result),this._untrackInvocation(t))}startIndexer(){return this._runCommand({operation:"start-indexer"})}indexFull(){return this._runCommand({operation:"run"})}index(){return this._runCommand({operation:"consume"})}purge(e){return this._runCommand({operation:"purge",ids:e})}purgeRange(e){return this._runCommand((0,a.default)({operation:"purge-range"},e))}reInit(){return this._runCommand({operation:"re-init"})}clearInitializationPromises(){return this._runCommand({operation:"clear-init"})}search(e,t){var r=this;return(0,i.default)((function*(){const n=yield r._runCommand({operation:"find",query:e,queryOptions:t});return r._coerceToSearchResult(n)}))()}_coerceToSearchResult(e){var t=this;return(0,i.default)((function*(){if(Array.isArray(e)||"boolean"==typeof e)return{canceled:!1,eof:!0,status:404,messages:[]};const{resolved:r,unresolved:n}=yield(0,l.resolveMsgIds)(e.messages),{eof:i,status:a}=e;return n.length>0&&t.purge(n),{canceled:!1,eof:i,status:a,messages:r}}))()}_runCommand(e){this._ensureWorkerInited();const t=(0,s.default)();return new Promise(((r,n)=>{this._pendingMap.set(t,{resolve:r,reject:n,command:e}),this._message({command:e,reqId:t})})).finally((()=>{this._untrackInvocation(t)}))}_untrackInvocation(e){this._pendingMap.delete(e)}_message(e){(0,o.default)(this._worker,"this._worker").postMessage(e)}};t.default=d},6663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveMsgIds=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const t=e.map((e=>+e.id)),r=new Map(e.map((e=>[+e.id,e])));return(0,i.getTable)().anyOf(["rowId"],t).then((e=>{const t=[];e.forEach((e=>{const n=(0,a.hydrateMessage)(e),i=r.get(n.rowId);null!=i&&i.id===String(n.rowId)&&i.timestamp===n.t&&i.chatId===n.id.remote.toString()&&(t.push(n),r.delete(n.rowId))}));const n=Array.from(r.keys(),(e=>String(e)));return t.sort(((e,t)=>t.t-e.t)),{resolved:t,unresolved:n}}))}return Promise.resolve({resolved:[],unresolved:[]})};var n=r(7293),i=r(90981),a=r(12896)},80872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FTS_TYPING_DELAY=t.FTS_TTL=t.FTS_NUM_RESULTS=t.FTS_MIN_CHARS=void 0;t.FTS_MIN_CHARS=2;t.FTS_TTL=6e4;t.FTS_TYPING_DELAY=300;t.FTS_NUM_RESULTS=30},51998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return r++};let r=0},7293:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.GK=t.FEATURE_CHANGE_EVENT=void 0,t.getProtobufFeatureName=S;var i=n(r(23279)),a=n(r(18446)),o=n(r(14176)),s=n(r(66678)),l=n(r(44908)),c=n(r(85564)),d=n(r(11865)),u=n(r(82492)),p=n(r(17204)),f=n(r(34342)),_=(n(r(23082)),r(21224));const h=(0,p.default)(Object.keys(_.WebFeaturesSpec.internalSpec).map((e=>[S(e),!1]))),g=!1,m={RESEND_ICON:!1,DELETE_MSG_CLEAR_MEDIA:!0,DEBUG_COMMANDS:false,MD_BACKEND:g,MD_ADV:g,MD_E2E:!1,MD_VOIP_GROUP:g,WEB_WORKER_COMPATIBLE:g,CATALOG_MANAGER:!1,WEB_VOIP_VOICE_CALL:!1,WEB_VOIP_VIDEO_CALL:!1,MEDIA_AUTO_DOWNLOAD:!1,DOWNLOAD_STATUS_THUMB_MMS:!1,MEDIA_EXISTENCE_CHECK:!1,LOG_INCOMING_MSG_MISSING_REQUIRED_PROPERTIES:!0,LOG_OUTGOING_MSG_MISSING_REQUIRED_PROPERTIES:!0,HIGH_QUALITY_VIDEO_THUMBNAILS:!0,YOUTUBE_VIDEO_PREVIEW_WITHOUT_BLUR:!1,DROP_LAST_NAME_MENTIONS:!1,PTT_WAVEFORM_SEND:!0,FORMAT_BULLETED_MSG:!1,A11Y_BLOCK:!1,LARGE_STICKERS:!0,STICKER_MEDIA_VIEWER:!0,PIP_VIDEO_REDESIGN:false,NEW_CHAT_INFO:!0,DOWNLOAD_HOST_SWITCHING_ENABLED:!0,DOWNLOAD_MEDIA_CACHE:!0,SKIP_COMPLIANCE_PHONE_CHECK:!1,STATUS_MEDIA_CONTROLS:!0,UPLOAD_HOST_SWITCHING_ENABLED:!0,RICH_STATUS_REPLIES:!0,CACHE_MEDIA_ENCRYPTION_KEY:!0},y=[[(0,u.default)(m,h),{},{},{},{ARCHIVE_BROADCAST:!0},{RECENT_EMOJI_SYNC:!0},{},{},{},{},{},{STARRED_GIFS:!1,INDEX_RECEIVED_VCARD:!1},{STATUS_V3_UI_SENDING:!1},{MEDIAS_COUNT:!1},{},{VOIP_VOICE_CALL:!0},{DESKTOP_VOIP_VOICE_CALL:!0,DESKTOP_VOIP_VIDEO_CALL:!0,DESKTOP_VOIP_GROUP_VOICE_CALL:!1,DESKTOP_VOIP_GROUP_VIDEO_CALL:!1}]],E={KEY_PARTICIPANT:!1,RICH_TEXT:!0};function S(e){return(0,d.default)(e).toUpperCase()}const v="feature_change";t.FEATURE_CHANGE_EVENT=v;class T extends f.default{constructor(){super(),this.FEATURE_CHANGE_EVENT=v,this.silenceChangeEvents=!0,this.triggerFeaturesChangedDebounced=(0,i.default)((()=>{this.trigger(v)}),50),this.features={};const e=(0,c.default)((0,c.default)(y).map(Object.keys)).concat(Object.keys(E));this.F=(0,p.default)((0,l.default)(e).map((e=>[e,e]))),this.setVersion([0,0]),this.silenceChangeEvents=!1}setVersion(e){if(this.proto&&this.proto.length===e.length&&this.proto[0]===e[0]&&this.proto[1]===e[1])return;this.proto=e;const t=y.slice(0,e[0]+1),r=y.slice(e[0]+1,y.length),n=t[e[0]],i=n.slice(0,e[1]+1),l=n.slice(e[1]+1,n.length);t[e[0]]=i,r.unshift(l);const d=(0,s.default)(this.features);this.features=(0,u.default)((0,o.default)((0,u.default)({},...(0,c.default)(t)),(e=>!e)),this.features||{});const f=(0,u.default)({},...(0,c.default)(r));this.features=(0,o.default)(this.features,((e,t)=>!!f[t])),this.VF=(0,p.default)(Object.keys((0,u.default)({},...(0,c.default)(t))).map((e=>[e,e]))),(0,a.default)(d,this.features)||this.triggerFeaturesChanged()}setPlatform(e){let t=!1;switch(e){case"iphone":t=!1!==this.features.RECENT_EMOJI_SYNC||!1!==this.features.ARCHIVE_BROADCAST||!0!==this.features.RESEND_ICON||!1!==this.features.DELETE_MSG_CLEAR_MEDIA,this.features.RECENT_EMOJI_SYNC=!1,this.features.ARCHIVE_BROADCAST=!1,this.features.RESEND_ICON=!0,this.features.DELETE_MSG_CLEAR_MEDIA=!1;break;case"symbian":case"s40":case"bb":t=!1!==this.features.CHAT_MARK_UNSEEN,this.features.CHAT_MARK_UNSEEN=!1}t&&this.triggerFeaturesChanged()}setFeatureFromFlags(e,t,r){let n=!1;switch(r){case _.WebFeaturesFlag.FORCE_UPGRADE:switch(t){case _.WebFeaturesFlag.FORCE_UPGRADE:n=!0;break;case _.WebFeaturesFlag.PRODUCTION:case _.WebFeaturesFlag.DEVELOPMENT:case _.WebFeaturesFlag.NOT_STARTED:n=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${r} and web value is ${t}.`,SEND_LOGS("wap_feature_unreachable_code")}break;case _.WebFeaturesFlag.PRODUCTION:switch(t){case _.WebFeaturesFlag.FORCE_UPGRADE:n=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${r} and web value is ${t}.`,SEND_LOGS("wap_feature_unexpected");break;case _.WebFeaturesFlag.PRODUCTION:n=!0;break;case _.WebFeaturesFlag.DEVELOPMENT:case _.WebFeaturesFlag.NOT_STARTED:n=!1}break;case _.WebFeaturesFlag.DEVELOPMENT:switch(t){case _.WebFeaturesFlag.FORCE_UPGRADE:case _.WebFeaturesFlag.PRODUCTION:case _.WebFeaturesFlag.DEVELOPMENT:case _.WebFeaturesFlag.NOT_STARTED:n=!1}break;case _.WebFeaturesFlag.NOT_STARTED:n=!1}const i=S(e);return this.setFeature(i,n)}setFeature(e,t){let r;r=!!t;const n=this.features[e]!==r;return this.features[e]=r,n&&this.triggerFeaturesChanged(),n}setFeatures(e){const t={},r=(0,u.default)({},E,e);for(const e in r)e in this.VF||(t[e]=this.setFeature(e,r[e]));return t}supportsFeature(e){return!!this.features[e]}supportsFeatureFromFlags(e){const t=S(e);return this.supportsFeature(t)}supportsAllFeatures(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.every((e=>!!this.features[e]))}supportsAnyFeature(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.some((e=>!!this.features[e]))}resetFeatures(){this.proto=[0,0],this.features={},this.triggerFeaturesChanged()}lt(e){const t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>t[1]}lte(e){const t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>=t[1]}gt(e){const t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}gte(e){const t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<=t[1]}triggerFeaturesChanged(){this.silenceChangeEvents||this.triggerFeaturesChangedDebounced()}overwriteDebugGKs(){}isThirdPartyStickersEnabled(){return this.supportsAllFeatures(this.F.THIRD_PARTY_STICKERS,this.F.MEDIA_UPLOAD)}isRecentStickersEnabled(){return this.supportsAnyFeature(this.F.RECENT_STICKERS_V_2,this.F.RECENT_STICKERS_V_3)&&this.supportsFeature(this.F.MEDIA_UPLOAD)}isStarredStickersEnabled(){return this.supportsFeature(this.F.STARRED_STICKERS)&&this.isRecentStickersEnabled()}isCatalogManagerEnabled(){return this.supportsAllFeatures(this.F.CATALOG_MANAGER,this.F.MD_BACKEND)}isHighQualityVideoThumbnailsEnabled(){const{UA:e}=r(65127);return!e.isGecko&&this.supportsFeature(this.F.HIGH_QUALITY_VIDEO_THUMBNAILS)}isNewChatInfoEnabled(){return!1}isMediaGalleryFixEnabled(){return this.supportsFeature(this.F.MD_BACKEND)}}const C=new T;t.GK=C},57701:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adminRevokeHistorySyncConsumerEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("admin_revoke_history_sync_consumer");return!1},t.adminRevokeReceiverEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("admin_revoke_receiver");return!1},t.adminRevokeSenderEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("admin_revoke_sender");return!1},t.archiveV2Supported=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("sync_archive_v2_setting");return l.GK.supportsFeature(l.GK.F.ARCHIVE_V_2)},t.bannedShopsEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("banned_shops_ux_enabled");return!1},t.bizLinkedAccountsEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_abprop_business_profile_refresh_linked_account_enabled");return!1},t.blockCatalogCreationECommerceComplianceIndia=function(e){var t;return f(null==e?void 0:e.id.user,(()=>(0,n.getABPropConfigValue)("web_abprop_block_catalog_creation_ecommerce_compliance_india")),(()=>u.ServerProps.blockCatalogCreationEcommerceComplianceIndia))&&(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===i.COMMERCE_EXPERIENCE_TYPES.NONE},t.btmThreadsLoggingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("btm_threads_logging_enabled");return!1},t.buttonsMessagesEnabled=function(){return u.ServerProps.webButtonsMessage},t.cadminSelfDemoteEnabled=function(){return!1},t.canAppealCollections=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("smb_collections_appeal_flow_enabled");return u.ServerProps.webCollectionsAppealEnabled},t.canDisplayLabel=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return o.Conn.isSMB;return l.GK.supportsFeature(l.GK.F.LABELS_DISPLAY)},t.canEditLabel=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return!1;return l.GK.supportsFeature(l.GK.F.LABELS_EDIT)},t.canEditLabelAssociation=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return o.Conn.isSMB;return l.GK.supportsFeature(l.GK.F.LABELS_EDIT)},t.canManageCollections=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("smb_collections_enabled");return u.ServerProps.webCollectionsManagement},t.canSeeBizProfileV3=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("business_profile_refresh_m1_enabled");return u.ServerProps.webBizProfileV3Enabled},t.canSeeECommerceComplianceIndiaCountryOriginExemptBusinessJourney=function(e){return f(e,(()=>(0,n.getABPropConfigValue)("smb_ecommerce_compliance_india_m4_5")),(()=>u.ServerProps.smbEcommerceComplianceIndiaM4_5))},t.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney=function(e){return f(e,(()=>(0,n.getABPropConfigValue)("smb_ecommerce_compliance_india_m4")),(()=>u.ServerProps.smbEcommerceComplianceIndiaM4))},t.canSeeECommerceComplianceIndiaSoftEnforcement=function(e){return p(e)},t.canSeeSMBUpsell=function(){return u.ServerProps.webSMBUpsellInBizProfile},t.canSeeStatusV3OnContact=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_abprop_business_profile_refresh_status_enabled");return u.ServerProps.webBizProfileV3M2},t.canSendQuickReply=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return o.Conn.isSMB;return l.GK.supportsFeature(l.GK.F.QUICK_REPLIES_QUERY)},t.canToggleCartOnOff=function(){return l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&u.ServerProps.webCartOnOffToggle},t.canViewCollections=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("consumer_collections_enabled");return u.ServerProps.webCollectionsDisplay},t.cartPropEnabled=function(){return u.ServerProps.webCart},t.clearOrDeleteChatSyncEnabled=function(){if(u.ServerProps.syncdClearChatDeleteChatEnabled&&(o.Conn.platform===o.PLATFORMS.ANDROID||o.Conn.platform===o.PLATFORMS.SMBA)&&(0,c.getPrimaryAllowsAllMutations)())return!0;return!1},t.commerceFeaturesDisabledBySanctions=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("commerce_sanctioned");return!1},t.communitiesEnabled=g,t.communityCreationEnabled=function(){return!1},t.countryGatingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("country_client_gating_enabled");return!1},t.forwardingLimitToGroupsEnabled=function(){return u.ServerProps.webForwardingLimitToGroups||!1},t.graphQLForCatalogM1Enabled=function(){return l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&(0,n.getABPropConfigValue)("graphql_privacy_imp_m1")},t.hideUnsupportedCurrency=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("smb_hide_unsupported_currency_price");return!1},t.hyperlinkedPhoneNumbersEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("hyperlinked_phone_numbers_enabled");return!1},t.identityStoreCacheEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_identity_store_cache");return!1},t.interactiveNativeFlowMessagesEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return!(0,n.getABPropConfigValue)("interactive_message_native_flow_killswitch");return!1},t.mdMigrationExperience=function(){return o.Conn.isSMB&&u.ServerProps.webMdMigrationExperience},t.mediaUploadPrekeysFetchEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("media_upload_prekeys_fetch_enabled");return!1},t.moreReactionsOption=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return!1;return!1},t.nativeFlowMessagesEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("nfm_rendering_enabled");return!1},t.newComposeBoxInputEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_new_compose_box_input");return!1},t.orderDetailsCustomItemEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("order_details_custom_item_enabled");return!1},t.orderDetailsFromCartEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("order_details_from_cart_enabled");return!1},t.orderDetailsFromCatalogEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("order_details_from_catalog_enabled");return!1},t.orderManagementEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("order_management_enabled");return!1},t.parseWMIReaction=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("reaction_history_sync")||h();return!1},t.paymentBackgroundEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&u.ServerProps.webPaymentBackgroundEnabled)return!0;return!1},t.phaseOutNotABusiness=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("smb_phase_out_not_a_business");return!1},t.pinChatSyncEnabled=function(){if(u.ServerProps.syncdPinChatEnabled)return!!(o.Conn.platform!==o.PLATFORMS.ANDROID&&o.Conn.platform!==o.PLATFORMS.SMBA||(0,c.getPrimaryAllowsAllMutations)());return!1},t.privacyAllowContactsExceptEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("privacy_allow_contacts_except")&&d.PrimaryFeatures.contactExcept;return!1},t.privacySettingsEnabled=function(){return l.GK.supportsFeature(l.GK.F.MD_BACKEND)},t.proactivePrekeysFetchGroupSizeLimit=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_proactive_prekeys_fetch_group_size_limit")||0;return 0},t.productListMessageFallbackEnabled=function(){return u.ServerProps.webProductListMessageFallback},t.productListMessagesEnabled=function(){return u.ServerProps.webProductListMessage},t.quickRepliesV2Enabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return o.Conn.isSMB&&(0,n.getABPropConfigValue)("smb_quick_replies_v2_enabled");return!1},t.reactionsAnnouncementOnly=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("reactions_announcement_only");return!1},t.receiveReactionsEnabled=h,t.rotateSenderKeyIfSentEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_rotate_sender_key_if_sent");return!1},t.sendKeyDistributionMsgMinGroupSize=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_send_invisible_msg_min_group_size");return 0},t.sendKeyDistributionMsgToNewGroups=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_send_invisible_msg_to_new_groups");return!1},t.sendReactionsEnabled=_,t.shopsInteractiveMessageEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_shop_storefront_message");return!1},t.smartFiltersEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return o.Conn.isSMB&&(0,n.getABPropConfigValue)("smart_filters_enabled")||!o.Conn.isSMB&&(0,n.getABPropConfigValue)("smart_filters_enabled_consumer");return!1},t.smbBizProfileLoggingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&o.Conn.isSMB)return(0,n.getABPropConfigValue)("smb_biz_profile_logging_enabled");return!1},t.smbClickToChatLoggingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&o.Conn.isSMB)return(0,n.getABPropConfigValue)("smb_click_to_chat_logging_enabled");return!1},t.smbStatusLoggingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&o.Conn.isSMB)return(0,n.getABPropConfigValue)("smb_status_logging_enabled");return!1},t.tos3GatingEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&!o.Conn.isSMB)return(0,n.getABPropConfigValue)("tos_3_client_gating_enabled");return!1},t.tos3GatingEnabledB2C=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&!o.Conn.isSMB)return(0,n.getABPropConfigValue)("tos_3_client_gating_biz_initiated_enabled");return!1},t.tosFetchEnabled=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&!o.Conn.isSMB)return(0,n.getABPropConfigValue)("tos_client_state_fetch_enabled");return!1},t.tosFetchIteration=function(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("tos_client_state_fetch_iteration");return 0},t.web2FAEnabled=function(){return l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&(0,n.getABPropConfigValue)("web_2fa")},t.webGDPRRequestAccountInfoEnabled=function(){return l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&(0,n.getABPropConfigValue)("web_gdpr_request_account_info_enabled")},t.webMediaAutoDownloadEnabled=function(){return l.GK.supportsFeature(l.GK.F.MEDIA_AUTO_DOWNLOAD)&&u.ServerProps.webMediaAutoDownloadEnabled};var n=r(86945),i=r(93170),a=r(30066),o=r(17239),s=r(79502),l=r(7293),c=r(58052),d=r(34771),u=r(64551);function p(e){return(0,s.getCountryShortcodeByPhone)(e||"")===a.COMPLIANCE_INFO_CODES.INDIA||l.GK.supportsFeature(l.GK.F.SKIP_COMPLIANCE_PHONE_CHECK)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!1;return!!p(e)&&(l.GK.supportsFeature(l.GK.F.MD_BACKEND)?t():r())}function _(){return!!l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&((0,n.getABPropConfigValue)("reactions_send")&&d.PrimaryFeatures.reactionsSend)}function h(){return!!l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&((0,n.getABPropConfigValue)("reactions_receive")||_())}function g(){return!1}},9978:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyntheticCountryCode=void 0,t.bubbleCountryOnListOfCountries=p,t.formatCountriesOfOrigin=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=u(e,!0);if(""===t)return r;return p(r,t)},t.getCountries=function(){return f.apply(this,arguments)},t.getCountryName=function(){return c.apply(this,arguments)},t.unshiftNotApplicableToListOfCountries=u;var i=n(r(48926)),a=r(48360),o=(n(r(56720)),n(r(43725))),s=r(53558);const l={countrySeparator:{borderBottom:"bajl15op"}};function c(){return(c=(0,i.default)((function*(e){if(!e)return;return(yield _(o.default.getLocale()))[e.toUpperCase()]}))).apply(this,arguments)}const d=r(76672)({NotApplicable:"NOT_APPLICABLE"});function u(e,t){const r=[...e];return r.unshift([String(d.NotApplicable),a.fbt._("Not Applicable",null,{hk:"2k1klN"}),a.fbt._("Item is a service or non-physical good",null,{hk:"3uDBY7"}),...!0===t?[l.countrySeparator]:[]]),r}function p(e,t,r){const n=e.findIndex((e=>{let[r]=e;return r===t})),[i,a]=[...e[n]],o=[...e];return o.splice(n,1),o.unshift([i,a,null,...r?[l.countrySeparator]:[]]),o}function f(){return(f=(0,i.default)((function*(){const e=yield _(o.default.getLocale());return Object.keys(e).filter((e=>!e.includes("@"))).map((t=>[t,e[t]])).sort(((e,t)=>{let[,r]=e,[,n]=t;return String(r).localeCompare(String(n))}))}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=(yield r.e(5211).then(r.t.bind(r,1820,19))).default.includes(e)?e:s.DEFAULT_LOCALE;return(yield r(29127)(`./${t}.json`)).default}))).apply(this,arguments)}t.SyntheticCountryCode=d},68609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={"zh-HK":"zh-TW",pa:"pa-IN"};t.default=r},70210:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={pt:"pt_br",pt_ao:"pt",pt_ch:"pt",pt_cv:"pt",pt_fr:"pt",pt_gq:"pt",pt_gw:"pt",pt_lu:"pt",pt_mo:"pt",pt_mz:"pt",pt_pt:"pt",pt_st:"pt",pt_tl:"pt",zh_hans:"zh_cn",zh_hant:"zh_tw",zh_sg:"zh_cn",tl:"fil",in:"id",iw:"he",mo:"ro",jw:"jv",ji:"yi"};t.default=r},17588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={af:"af",ar:"ar",ar_xb:"ar-XB",az:"az",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fil:"fil",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",kk:"kk",kn:"kn",ko:"ko",lt:"lt",lv:"lv",mk:"mk",ml:"ml",mr:"mr",ms:"ms",nb:"nb",nl:"nl",pa:"pa",pl:"pl",pt:"pt",pt_br:"pt-BR",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tr:"tr",uk:"uk",ur:"ur",uz:"uz",vi:"vi",zh_cn:"zh-CN",zh_hk:"zh-HK",zh_tw:"zh-TW"};t.default=r},71473:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_AUTO_DOWNLOAD_SIZE=t.AutoDownloadQueue=t.AUTO_DOWNLOAD_TYPES=t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=void 0,t.shouldAutoDownloadMedia=m,t.shouldTrustMedia=g,t.validateMediaSize=y;var i=n(r(48926)),a=n(r(30844)),o=r(15461),s=n(r(61516)),l=r(99234),c=r(78986),d=n(r(11339)),u=r(54676);const p=r(76672)({MEDIA:"media",MMS_THUMBNAIL:"mms_thumbnail"});t.AUTO_DOWNLOAD_TYPES=p;const f=33554432;t.MAX_AUTO_DOWNLOAD_SIZE=f;const _=524288;t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=_;const h=512e3;function g(e){return e.isTrusted()}function m(e){switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return(0,l.getAutoDownloadAudio)();case o.MSG_TYPE.STICKER:case o.MSG_TYPE.IMAGE:return(0,l.getAutoDownloadPhotos)();case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<h?(0,l.getAutoDownloadPhotos)():(0,l.getAutoDownloadVideos)();case o.MSG_TYPE.DOCUMENT:return(0,l.getAutoDownloadDocuments)()}return!1}function y(e){switch(e.type){case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.VIDEO:case o.MSG_TYPE.DOCUMENT:return e.size<=f;case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return e.size<_;case o.MSG_TYPE.STICKER:return!0}return!1}const E=new class{constructor(){this._downloaderQueue=new a.default(5,{photos:2,videos:1,audio:1,documents:1,mms_thumbnail:4})}getEnqueuedTasksCount(){return this._downloaderQueue.getEnqueuedTasksCount()}clearQueue(){this._downloaderQueue.clearQueue()}enqueue(e,t){if(this.getEnqueuedTasksCount()>=32)return!1;if(t===p.MEDIA&&g(e)&&e.isNewMsg&&m(e)&&y(e))switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return this._enqueueMedia({message:e,group:"audio"}),!0;case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.STICKER:return this._enqueueMedia({message:e,group:"photos"}),!0;case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<h?(this._enqueueMedia({message:e,group:"photos"}),!0):(this._enqueueMedia({message:e,group:"videos"}),!0);case o.MSG_TYPE.DOCUMENT:return this._enqueueMedia({message:e,group:"documents"}),!0}if(t===p.MMS_THUMBNAIL){if(e.type===o.MSG_TYPE.DOCUMENT||(0,u.typeIsUrl)(e))return this._enqueueMmsThumbnail({message:e,group:"mms_thumbnail"}),!0;if(e.type===o.MSG_TYPE.IMAGE||e.type===o.MSG_TYPE.VIDEO)return this._enqueueStatusV3Thumbnail({message:e,group:"mms_thumbnail"}),!0}return!1}_enqueueMedia(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){m(r)&&(yield r.downloadMedia({downloadEvenIfExpensive:!1,rmrReason:d.default.WEBC_RMR_REASON_CODE.OTHER,isUserInitiated:!1,isAutoDownload:!0}))})),{group:n,priority:-r.t})}))()}_enqueueMmsThumbnail(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,s.default)({msg:r})})),{group:n,priority:-r.t})}))()}_enqueueStatusV3Thumbnail(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,c.downloadStatusV3Thumbnail)({msg:r})})),{group:n,priority:-r.t})}))()}};t.AutoDownloadQueue=E},99140:(e,t)=>{"use strict";function r(e){if(!e)return e;const t=e.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,""),r=t.split(".");if(1===r.length)return t;for(let e=r.length-1;e>0;e--){const t=r[e].trim();if(t.length)return r.slice(0,e).join(".")+"."+t}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.cleanFilename=r,t.cleanIncomingFilename=function(e){if(!e)return e;const t=r(e);if(e!==t&&t){const e=t.split("."),r=e.length>=2&&e.pop();["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"].includes(r)&&__LOG__(2,!0)`cleanIncomingFilename:extension: ${r||""}`}return t}},56406:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=function(){return!!P.canPlayOgg},t.decodeWebpToRGBANoOpaque=x,t.fetchMedia=function(){return X.apply(this,arguments)},t.gatherAndSetMetadata=function(){return Z.apply(this,arguments)},t.gatherAndSetMetadataNoOpaque=function(){return ee.apply(this,arguments)},t.getImageWidthHeight=function(e){return Q(function(){var t=(0,a.default)((function*(t){t(e);const r=new Image;return yield new Promise(((t,n)=>{r.onload=t,r.onabort=()=>{n(new Error("getImageWidthHeight onabort"))},r.onerror=()=>{n(new Error("getImageWidthHeight onerror"))},r.src=e.url()})),{width:r.naturalWidth,height:r.naturalHeight}}));return function(){return t.apply(this,arguments)}}())},t.getImageWidthHeightNoOpaque=U,t.getRawDocumentMimetype=z,t.getResizedThumbData=function(e,t){return new Promise((r=>{const n=new Image;n.setAttribute("crossorigin","anonymous"),n.onload=()=>{const e=t.map((e=>{let{width:t,height:r,minWidth:i,minHeight:a,imageFormat:o,imageFormatOptions:s,keepAspectRatio:l}=e;if(null!=i&&n.width<i||null!=a&&n.height<a)return null;const c=document.createElement("canvas"),d=c.getContext("2d");let u,p,f=0,_=0;if(n.height>n.width){u=t,p=n.height/n.width*t,_=-(p-r)/2}else{p=r,u=n.width/n.height*r,f=-(u-t)/2}return l?(c.width=u,c.height=p):(c.width=t,c.height=r),d.drawImage(n,f,_,u,p),{dataUrl:c.toDataURL(o,s).replace("data:image/jpeg;base64,",""),width:c.width,height:c.height}}));r(e)},n.src=e}))},t.opaqueDataToArrayBuffer=function(e){return Q((t=>{t(e);const r=e.getBlob();if(r)return F(r);const n=(0,l.default)(e.getBase64(),"b64 should be defined");return(0,o.decodeB64)(n)}))},t.parseWebpNoOpaque=K,t.processRawAudioVideo=function(){return $.apply(this,arguments)},t.processRawDocument=function(){return J.apply(this,arguments)},t.processRawImage=function(){return H.apply(this,arguments)},t.processRawSticker=function(){return V.apply(this,arguments)},t.shouldUseLruMediaStore=function(e){const t=e===M.MEDIA_TYPES.STICKER||e===M.MEDIA_TYPES.IMAGE,r=e===M.MEDIA_TYPES.AUDIO||e===M.MEDIA_TYPES.DOCUMENT||e===M.MEDIA_TYPES.GIF||e===M.MEDIA_TYPES.PPIC||e===M.MEDIA_TYPES.PRODUCT||e===M.MEDIA_TYPES.PTT||e===M.MEDIA_TYPES.VIDEO||e===M.MEDIA_TYPES.TEMPLATE||e===M.MEDIA_TYPES.THUMBNAIL_DOCUMENT||e===M.MEDIA_TYPES.THUMBNAIL_IMAGE||e===M.MEDIA_TYPES.THUMBNAIL_LINK||e===M.MEDIA_TYPES.THUMBNAIL_VIDEO;return(t||r)&&(0,v.getRememberMe)()},t.shouldUseMediaCache=function(e){return e===M.MEDIA_TYPES.STICKER||e===M.MEDIA_TYPES.IMAGE||e===M.MEDIA_TYPES.PRODUCT||e===M.MEDIA_TYPES.PTT||e===M.MEDIA_TYPES.AUDIO},t.videoWidthHeightDuration=function(e){return Q((t=>(t(e),P.videoWidthHeightDuration(e.forceToBlob()))))},t.videoWidthHeightDurationNoOpaque=Y;var i=n(r(81109)),a=n(r(48926)),o=r(15688),s=r(50796),l=n(r(45095)),c=r(18412),d=r(67602),u=n(r(64369)),p=n(r(11854)),f=r(61498),_=n(r(97769)),h=r(35718),g=r(99140),m=n(r(16185)),y=G(r(55216)),E=G(r(64103)),S=r(1063),v=r(99234),T=n(r(75203)),C=r(7293),A=G(r(36638)),b=r(21921),P=G(r(97692)),M=r(61596),O=r(58668),I=r(43257),w=n(r(34949)),R=r(92108),D=r(64551),N=r(2541),L=r(78521);function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(k=function(e){return e?r:t})(e)}function G(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=k(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function U(e){return new Promise(((t,r)=>{const n=new Image,i=window.URL.createObjectURL(e);n.onload=()=>{const e={width:n.naturalWidth,height:n.naturalHeight};window.URL.revokeObjectURL(i),t(e)},n.onabort=()=>{window.URL.revokeObjectURL(i),r(new Error("getImageWidthHeight onabort"))},n.onerror=()=>{window.URL.revokeObjectURL(i),r(new Error("getImageWidthHeight onerror"))},n.src=i}))}function F(e){return(0,S.blobToArrayBuffer)(e).catch((e=>{throw __LOG__(3)`MediaUtils error: ${e}`,e}))}function x(){return B.apply(this,arguments)}function B(){return(B=(0,a.default)((function*(e){const t=yield F(e);return(0,m.default)(t)}))).apply(this,arguments)}function K(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e){const t=yield F(e);return(0,R.parseWebp)(t)}))).apply(this,arguments)}function Y(e){return P.videoWidthHeightDuration(e)}function W(e,t){return Q(function(){var r=(0,a.default)((function*(r){r(e);const n=yield P.transcode(e.forceToBlob(),t).then((e=>w.default.createFromData(e,e.type)));return r(n),n.autorelease(),n}));return function(){return r.apply(this,arguments)}}())}function H(){return(H=(0,a.default)((function*(e,t){const{transparency:r,minDimension:n}=null!=t?t:{},i=e.forceToBlob(),{width:a,height:o,images:s}=yield A.rotateAndResize(i,D.ServerProps.imageMaxEdge,A.BLOB|A.CANVAS,{transparency:r,minDimension:n}),{images:l}=yield A.rotateAndResize(s.canvas,u.default.IMG_THUMB_MAX_EDGE,A.DATA_URL|A.CANVAS),c=(0,h.getResizedDataUrl)(l.canvas,"image/jpeg",2e4),d=c?N.URL.parseDataURL(c).data:null;return d||__LOG__(2)`processRawImage: Failed to reach max thumbnail size, preview will be null`,{type:O.OUTWARD_TYPES.IMAGE,mediaBlob:s.blob,mimetype:s.blob.type,fullWidth:a,fullHeight:o,preview:d}}))).apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e){const t=e.forceToBlob(),{width:r,height:n,images:i}=yield A.rotateAndResize(t,D.ServerProps.imageMaxEdge,A.BLOB,{transparency:!0}),a=yield A.toWebpSticker(i.blob),o=yield w.default.createFromData(a,a.type);return{type:O.OUTWARD_TYPES.STICKER,mediaBlob:o,mimetype:a.type,fullWidth:r,fullHeight:n}}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,r,n,a){var o;const s=e.forceToBlob(),l=yield(0,b.checkAndRepair)(s,!!n);if(!l)throw __LOG__(3)`processRawAudioVideo bad video file ${s.type}`,new E.InvalidMediaFileType;const c=l.type,d=l.file,p=n||l.isGif;switch((0,S.typeFromMimetype)(c)){case S.FILETYPE.VIDEO:if(t)throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: ptt became video"),new E.InvalidMediaFileType;const e={type:O.OUTWARD_TYPES.VIDEO,mediaBlob:d,mimetype:c,isGif:p,gifAttribution:p?a||0:void 0};if(r&&null!=r.duration&&null!=r.fullHeight&&0!==r.fullHeight&&null!=r.fullWidth&&0!==r.fullWidth&&r.preview)return(0,i.default)((0,i.default)({},e),{},{fullWidth:r.fullWidth,fullHeight:r.fullHeight,preview:r.preview,duration:r.duration.toString()});const{duration:n,thumbs:[s,l]}=yield A.generateVideoThumbsAndDuration({file:d,maxDimensions:[u.default.IMG_THUMB_MAX_EDGE,u.default.VIDEO_THUMB_MAX_EDGE],debugHint:"processRawAudioVideo"}),f=yield w.default.createFromBase64Jpeg(N.URL.parseDataURL(l.url).data);return(0,i.default)((0,i.default)({},e),{},{fullWidth:s.fullWidth,fullHeight:s.fullHeight,preview:N.URL.parseDataURL(s.url).data,fullPreviewData:f,duration:n.toString()});case S.FILETYPE.AUDIO:const _=null!==(o=null==r?void 0:r.duration)&&void 0!==o?o:yield(0,S.getAudioDuration)(d);return{type:t?O.OUTWARD_TYPES.PTT:O.OUTWARD_TYPES.AUDIO,mediaBlob:d,mimetype:c,duration:_.toString(),waveform:null==r?void 0:r.waveform};default:throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: audio/video became other"),new Error(`audio/video became ${c}`)}}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){const r=e.type;if(r){if("*"===I.DOC_MIMES||I.DOC_MIMES.includes(r))return r;throw new E.InvalidMediaFileType(`disallowed mimetype ${r}`)}{const r=Math.min(I.MIMETYPE_DETERMINING_LENGTH,e.size),i=yield F(e.slice(0,r)),a=new Uint8Array(i);var n;if((0,I.isMsCompoundFileBinaryFormat)(a.subarray(0,8)))return null!=t&&null!==(n=(0,S.getMimeTypeForFilepath)(t))&&void 0!==n?n:I.MSCFB_MIME;const o=(0,_.default)(a);if(null==o?void 0:o.mime){const e=(0,I.isAllowedDocumentMimetype)(o.mime,t,!0);if(e)return e}else if(t){const e=(0,S.getMimeTypeForFilepath)(t);if(e)return e}throw new E.InvalidMediaFileType(`type: ${String(e.type)} name: ${String(t)}`)}}))).apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t,r,n){var i,a;const o=e.forceToBlob(),s=(0,g.cleanFilename)(o.name||t||null),l=yield z(o,s),c=r?(0,S.blobToText)(o):null,[d,u]=yield Promise.all([y.enrich(o,l),c]),p=null!==(i=null==d||null===(a=d.microThumbnail)||void 0===a?void 0:a.dataUrl)&&void 0!==i?i:null==d?void 0:d.thumbUrl,f=p?N.URL.parseDataURL(p).data:null;return{type:O.OUTWARD_TYPES.DOCUMENT,mediaBlob:yield w.default.createFromData(o,l),mimetype:l,filename:s||void 0,documentPreview:d,preview:f,fullPreviewData:null==d?void 0:d.fullPreviewData,fullPreviewSize:d?{width:d.width,height:d.height}:null,pageCount:null!=n?n:null==d?void 0:d.pdfPages,isVcardOverMmsDocument:r,parsedVcards:u?(0,L.parseMultiVcard)(u):null}}))).apply(this,arguments)}function Q(e){const t=[];return(0,c.promiseCallSync)(e,null,(function(e){e.retain(),t.push(e)})).finally((()=>{for(let e=0;e<t.length;e++)t[e].autorelease()}))}function X(){return(X=(0,a.default)((function*(e){const t=yield(0,T.default)(e,"GET",null,p.default.RESP_TYPE.ARRAY_BUFFER);return t?Promise.resolve({result:t.response,status:t.status}):Promise.resolve(null)}))).apply(this,arguments)}function Z(){return(Z=(0,a.default)((function*(e,t){let r,n;t.retain();try{switch(e.type){case O.TYPE.VIDEO:const i=t.forceToBlob(),{thumbs:[a],duration:o}=yield A.generateVideoThumbsAndDuration({file:i,maxDimensions:[u.default.VIDEO_THUMB_MAX_EDGE],debugHint:"gatherAndSetMetadata"});let s;C.GK.isHighQualityVideoThumbnailsEnabled()&&(s=yield w.default.createFromBase64Jpeg(N.URL.parseDataURL(a.url).data)),r={mediaBlob:t,renderableUrl:t.url(),fullWidth:a.fullWidth,fullHeight:a.fullHeight,duration:void 0!==o?`${Math.ceil(o)}`:void 0,durationFloat:o,fullPreviewData:s};break;case O.TYPE.AUDIO:const l=yield W(t);l.retain(),r={mediaBlob:l,renderableUrl:l.url()},n=()=>l.autorelease();break;default:e.type!==O.TYPE.IMAGE&&e.type!==O.TYPE.STICKER||(__LOG__(4,void 0,new Error,!0)`object type: ${e.type||""}`,SEND_LOGS("Entering gatherAndSetMetadata (with OpaqueData) unexpectedly")),r={mediaBlob:t,renderableUrl:t.url()}}e.consolidate(r)}catch(r){if(!(r instanceof E.MediaUnsupportedError))throw r;e.consolidate({mediaBlob:t,renderableUrl:t.url()})}finally{t.autorelease(),null!=n&&n()}}))).apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e,t){const r=yield Promise.resolve().then((()=>{switch(e.type){case O.TYPE.VIDEO:return Y(t).then((e=>({fullWidth:e.width,fullHeight:e.height,duration:void 0!==e.duration?`${Math.ceil(e.duration)}`:void 0,durationFloat:e.duration})));case O.TYPE.IMAGE:return null!=e.contentInfo.fullHeight&&null!=e.contentInfo.fullWidth&&e.size===t.size?null:U(t).then((e=>({fullWidth:e.width,fullHeight:e.height,size:t.size})));case O.TYPE.STICKER:return(0,f.detectWebpSupport)().then((e=>e?(0,d.promiseProps)({widthHeight:U(t),webpData:K(t)}).then((e=>({fullWidth:e.widthHeight.width,fullHeight:e.widthHeight.height,animationDuration:e.webpData.animationDuration,firstFrameLength:e.webpData.firstFrameLength,singleLoopDuration:e.webpData.singleLoopDuration,emojis:e.webpData.emojis,isAnimated:e.webpData.animationDuration>0,size:t.size,isFirstParty:e.webpData.isFirstParty,isFromStickerMaker:e.webpData.isFromStickerMaker,stickerPackId:e.webpData.stickerPackId,stickerPackName:e.webpData.stickerPackName,stickerPackPublisher:e.webpData.stickerPackPublisher}))):K(t).then(function(){var e=(0,a.default)((function*(e){let{animationDuration:r,firstFrameLength:n,singleLoopDuration:i,emojis:a,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}=e;if(r>0)return{animationDuration:r,firstFrameLength:n,singleLoopDuration:i,emojis:a,isAnimated:!0,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d};const u=yield x(t);return{animationDuration:r,rgbaBuffer:u.rgbaBuffer,rgbaWidth:u.width,rgbaHeight:u.height,emojis:a,isAnimated:!1,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}}));return function(){return e.apply(this,arguments)}}())));case O.TYPE.AUDIO:default:return{}}})).catch((0,s.filteredCatch)(E.MediaUnsupportedError,(t=>{throw e.consolidate({}),t})));null!=r&&e.consolidate(r)}))).apply(this,arguments)}},34949:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(15688),a=n(r(45095)),o=r(57319),s=r(1063);let l=[];const c=new o.ShiftTimer((function(){const e=l;l=[];for(let t=0;t<e.length;t++){const r=e[t];r._inAutoreleasePool=!1,0!==r._retainCount||r.released||(r.released=!0,r._releaseImpl())}}));class d{constructor(){this._retainCount=1,this._inAutoreleasePool=!1,this.released=!1,this._b64=void 0,this._blob=void 0,this._url=void 0,this._mimetype=void 0,this._released=void 0}retain(){if(this.released)throw __LOG__(3)`OpaqueData:retain called on released OpaqueData`,new Error("OpaqueData:retain called on released OpaqueData");this._retainCount++}autorelease(){this.released?__LOG__(3)`OpaqueData:autorelease called on released object`:0===this._retainCount?__LOG__(3)`OpaqueData:autorelease too many release calls`:1===this._retainCount?(this._retainCount=0,this._inAutoreleasePool||(this._inAutoreleasePool=!0,l.push(this),c.onOrBefore(1e3))):this._retainCount--}autoreleaseWhenPromiseCompletes(e){const t=()=>{this.autorelease()};e.then(t,t)}throwIfReleased(e){if(this.released)throw __LOG__(4,void 0,new Error)`${e} called on released OpaqueData`,new Error(`${e} called on released OpaqueData`);0===this._retainCount&&__LOG__(4,void 0,new Error)`${e} called on unretained OpaqueData`}url(){return this.throwIfReleased("OpaqueData:url"),null!=this._url&&""!==this._url?this._url:null!=this._b64&&""!==this._b64?(this._url=`data:image/jpeg;base64,${this._b64}`,this._url):(this._url=window.URL.createObjectURL((0,a.default)(this._blob,"this._blob")),this._url)}getBlob(){return this._blob}getBase64(){return this._b64}validate(){return!0===this._released?Promise.resolve(!1):this._blob?(0,s.validateBlob)(this._blob):Promise.resolve(!0)}size(){return this.throwIfReleased("OpaqueData:size"),this._blob?this._blob.size:null!=this._b64?(0,i.sizeWhenB64Decoded)(this._b64):(__LOG__(4,void 0,new Error,!0)`OpaqueData:size returned 0`,SEND_LOGS("opaque-data-size-0"),0)}formData(){return this.throwIfReleased("OpaqueData:formData"),this.forceToBlob()}type(){return this.throwIfReleased("OpaqueData:type"),null!=this._mimetype&&""!==this._mimetype?this._mimetype:"undefined"}forceToBlob(){this.throwIfReleased("OpaqueData:forceToBlob");const e=this._blob;if(e)return e;const t=this._b64;if(null!=t&&""!==t){this._b64=void 0,this._url=void 0;const e=this._mimetype;return this._blob=new Blob([(0,i.decodeB64)(t)],null!=e&&""!==e?{type:e}:void 0)}throw new Error("OpaqueData:forceToBlob no b64 or blob")}_releaseImpl(){this._mimetype=void 0;this._blob?(this._blob=void 0,null!=this._url&&""!==this._url&&(window.URL.revokeObjectURL(this._url),this._url=void 0)):(this._b64=void 0,this._url=void 0)}isBlobEqual(e){return e?this._blob===e._blob:!this._blob}}t.default=d,d.createFromBase64Jpeg=e=>new Promise((t=>{const r=new d;return r._b64=e,r._mimetype="image/jpeg",t(r)})),d.createFromData=(e,t)=>new Promise((r=>{const n=new d;return n._blob=e instanceof Blob&&e.type===t?e:new Blob([e],{type:t}),n._mimetype=t,r(n)}))},61516:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var a=i(r(48926)),o=r(89385),s=r(15688),l=i(r(45095)),c=r(15461),d=r(26384),u=i(r(92360)),p=r(61596),f=i(r(34949)),_=i(r(28245));function h(){return(h=(0,a.default)((function*(e){const{msg:t,isPreload:r,signal:i}=e,{thumbnailSha256:a,thumbnailEncSha256:h,thumbnailDirectPath:g,mediaKey:m,mediaKeyTimestamp:y}=t;if(null==g||null==h||null==a||null==m||null==y)return;if(!(t.type!==c.MSG_TYPE.DOCUMENT&&t.type!==c.MSG_TYPE.INTERACTIVE||(0,p.getMsgMediaType)(t)!==p.MEDIA_TYPES.DOCUMENT||null!=t.thumbnailHeight&&null!=t.thumbnailWidth))return;const E=t.asUrl;if(!E||null!=E.thumbnailHeight&&null!=E.thumbnailWidth){__LOG__(2)`media.downloadMmsThumbnail: start`;try{const e=yield d.downloadManager.downloadAndDecrypt({directPath:g,encFilehash:h,filehash:a,mediaKey:m,mediaKeyTimestamp:y,type:(0,u.default)(t),signal:i||(new n).signal,userDownloadAttemptCount:0,isPreload:r});if(E)E.thumbnailHQ=(0,s.encodeB64)(e);else{const r=(0,l.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),n={fullPreviewData:yield f.default.createFromData(e,"image/jpeg")};t.type===c.MSG_TYPE.DOCUMENT&&(n.fullPreviewSize={height:(0,l.default)(t.thumbnailHeight,"msg.thumbnailHeight"),width:(0,l.default)(t.thumbnailWidth,"msg.thumbnailWidth")}),r.consolidate(n)}__LOG__(2)`media.downloadMmsThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadMmsThumbnail aborted`;__LOG__(3,!0)`media.downloadMmsThumbnail: error\n${(0,_.default)(e)}`}}}))).apply(this,arguments)}},92360:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.type){case n.MSG_TYPE.DOCUMENT:return a.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case n.MSG_TYPE.VIDEO:return a.MEDIA_TYPES.THUMBNAIL_VIDEO;case n.MSG_TYPE.IMAGE:return a.MEDIA_TYPES.THUMBNAIL_IMAGE;case n.MSG_TYPE.CHAT:return a.MEDIA_TYPES.THUMBNAIL_LINK;case n.MSG_TYPE.INTERACTIVE:{const{interactiveHeader:t}=e;if(null!=(null==t?void 0:t.mediaType))switch(t.mediaType){case i.InteractiveMessageHeaderMediaType.DOCUMENT:return a.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case i.InteractiveMessageHeaderMediaType.VIDEO:return a.MEDIA_TYPES.THUMBNAIL_VIDEO}break}}throw new Error("getThumbnailTypeForMsg: Unsupported msg type")};var n=r(15461),i=r(34535),a=r(61596)},46220:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e?(0,a.unproxy)(e).isGroup?i.default.UPLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL:i.default.UPLOAD_ORIGIN_TYPE.UNKNOWN};var i=n(r(11339)),a=r(31019)},84866:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBlobCacheImpl=t.MediaBlobCache=void 0;var i=n(r(23493)),a=r(42430),o=r(88297),s=r(58668);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25e7;if(this._filehashesToCleanUp=new Set,this.getOrCreateURL=e=>{if(this._filehashToUrl[e])return this.touch(e),this._filehashToUrl[e];const t=this.get(e);if(!t)throw new Error(`There is no blob matching filehash: ${e}.`);const r=window.URL.createObjectURL(t);return this._filehashToUrl[e]=r,r},this.revokeURL=(e,t)=>{if(t){if(this._filehashToUrl[e]!==t)throw new Error("The url provided does not match the filehash.");delete this._filehashToUrl[e],window.URL.revokeObjectURL(t)}},this._scheduleCleanup=(0,i.default)((()=>{this._filehashesToCleanUp.forEach((e=>{window.URL.revokeObjectURL(this._filehashToUrl[e]),delete this._filehashToUrl[e]})),this._filehashesToCleanUp.clear()}),0,{leading:!1}),null!=e&&e<0)throw new Error("Size limit cannot be a negative number.");this._usageCounts={},this._filehashToUrl={},this._lruCache=new a.LruCache({sizeLimit:e,getSize:e=>e.size,onEvict:e=>{this._filehashToUrl[e]&&0===this._getUsageCount(e)&&(this.revokeURL(e,this._filehashToUrl[e]),(0,o.getOrCreateMediaObject)(e).consolidate({downloadStage:s.DOWNLOAD_STAGE.INIT,progressiveStage:null}))},shouldEvict:e=>0===this._getUsageCount(e)})}get(e){return this._lruCache.get(e)}has(e){return this._lruCache.has(e)}touch(e){this.get(e)}put(e,t){this._lruCache.put(e,t)}clear(){this._scheduleCleanup.flush(),this._usageCounts={},Object.keys(this._filehashToUrl).forEach((e=>{this._filehashToUrl[e]&&this.revokeURL(e,this._filehashToUrl[e])})),this._filehashToUrl={},this._lruCache.clear()}increaseUsageCount(e){this._usageCounts[e]=this._getUsageCount(e)+1,this._filehashesToCleanUp.delete(e)}decreaseUsageCount(e){const t=this._getUsageCount(e);if(t<=0)throw new Error("Cannot decrease the usageCount to a negative number.");this._usageCounts[e]=t-1,0===this._usageCounts[e]&&(delete this._usageCounts[e],this._filehashesToCleanUp.add(e),this._scheduleCleanup())}_getUsageCount(e){return this._usageCounts[e]||0}}t.MediaBlobCacheImpl=l;const c=new l;t.MediaBlobCache=c},45554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaKeyCache=void 0,t.shouldUseMediaKeyCache=function(){if(a.GK.supportsAllFeatures(a.GK.F.MD_BACKEND,a.GK.F.CACHE_MEDIA_ENCRYPTION_KEY))return(0,i.getABPropConfigValue)("web_abprop_document_resume_upload");return!1};var n=r(42430),i=r(86945),a=r(7293);const o={sizeLimit:10,getSize:()=>1};const s=new n.LruCache(o);t.MediaKeyCache=s},45987:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanJPEG=function(e){const t=new n.Binary(e),r=new n.Binary(e),K=new n.Binary;let j,Y=!1,W=!1,H=!1,V=!1;const $={version:257,densityUnits:0,xDensity:1,yDensity:1};if(255!==t.readUint8()||t.readUint8()!==y)throw new Error("SOI marker not at the start of the file.");r.advance(2);let z;for(;null!=z||t.size();){if(void 0===z){const e=t.readUint8();if(255!==e)throw new Error(`0x${e.toString(16)} is not a marker prefix.`);z=t.readUint8()}switch(z){case C:if(W)j=t.readUint16(),r.advance(j+2),t.advance(t.size()-r.size());else{if(j=t.readUint16(),"JFIF\0"!==t.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");V=!0,$.version=t.readUint16(),$.densityUnits=t.readUint8(),$.xDensity=t.readUint16(),$.yDensity=t.readUint16(),r.advance(j+2),t.advance(t.size()-r.size()),W=!0}break;case S:if(!H&&!V)throw new Error("Missing magic bytes marker.");let e,n;t.advance(t.readUint16()-2);let y=t.readUint8();for(;t.size();){if(n=t.readUint8(),e=255===y&&!B.includes(n),e){z=n;break}y=n}K.writeByteArray(r.readByteArray(r.size()-t.size()-2));continue;case A:if(j=t.readUint16(),!H&&"Exif\0\0"!==t.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");H=!0,r.advance(j+2),t.advance(t.size()-r.size());break;case G:case x:if(!H&&!V)throw new Error("Missing magic bytes marker.");j=t.readUint16(),r.advance(j+2),t.advance(t.size()-r.size());break;case E:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=!0,K.writeByteArray(r.readByteArray(2));break;case i:case a:case o:case s:case c:case d:case u:case p:case f:case _:case h:case g:case m:case v:case l:case T:if(!H&&!V)throw new Error("Missing magic bytes marker.");j=t.readUint16(),K.writeByteArray(r.readByteArray(2+j)),t.advance(t.size()-r.size());break;case b:case P:case M:case O:case I:case w:case R:case D:case N:case L:case k:case U:case F:throw new Error(`Received unexpected APP marker 0x${z.toString(16)}`);default:throw new Error(`Did not understand marker: 0x${z.toString(16)}`)}if(z=void 0,Y)break}if(!Y)throw new Error("No EOI tag found.");const q=function(e){const t=new n.Binary;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}($);return new Blob([q,K.readByteArray()],{type:"image/jpeg"})};var n=r(8584);const i=192,a=193,o=194,s=195,l=196,c=197,d=198,u=199,p=201,f=202,_=203,h=205,g=206,m=207,y=216,E=217,S=218,v=219,T=221,C=224,A=225,b=226,P=227,M=228,O=229,I=230,w=231,R=232,D=233,N=234,L=235,k=236,G=237,U=238,F=239,x=254,B=[0,208,209,210,211,212,213,214,215]},84979:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(36982));const o={ignoreSearch:!0,ignoreMethod:!0,ignoreVary:!0};class s extends a.default{constructor(e){super(),this._encodeKey=e=>{const t=encodeURIComponent(e);return`https://_media_cache_v2_.whatsapp.com/${encodeURIComponent(this.storeName)}_${t}`},this.storeName=e}doGet(e){const t=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.match(t,o).then((e=>e?e.arrayBuffer():null))):(__LOG__(3)`Unable to get. This error can occur if abstract method doGet gets called.`,Promise.reject(new Error("Unable to get")))}doPut(e,t){const r=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.put(r,new Response(t)).then((()=>t))):(__LOG__(3)`Unable to put. This error can occur if abstract method doPut gets called.`,Promise.reject(new Error("Unable to put in cache")))}doDel(e){var t=this;return(0,i.default)((function*(){const r=t._encodeKey(e);if(!t.cacheStore)return __LOG__(3)`Unable to delete. This error can occur if abstract method doDel gets called.`,Promise.reject(new Error("Unable to delete"));yield t.cacheStore.delete(r,o)}))()}doClear(){return Promise.resolve(caches.delete(this.storeName).then((e=>{e||__LOG__(2)`Tried to delete a non-existent cache: ${this.storeName}`})))}doOpen(){return caches.open(this.storeName).then((e=>{this.cacheStore=e})).catch((e=>{throw this.cacheStore=null,__LOG__(3)`Unable to open cache: ${this.storeName}, error: ${e}`,e}))}doClose(){return this.cacheStore=null,Promise.resolve()}}t.default=s},48520:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(36982)),o=n(r(91481)),s=r(29830);class l extends a.default{constructor(){super(),this._store=new o.default(s.initialize,s.IdbArrayBufferTable)}doGet(e){var t=this;return(0,i.default)((function*(){const r=yield t._store.get(e);return r?r.data:null}))()}doQueryByIndex(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doGetAll(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doPut(e,t){var r=this;return(0,i.default)((function*(){return(yield r._store.put(e,{id:e,data:t})).data}))()}doDel(e){return this._store.del(e)}doCount(){return this._store.count()}clear(){return this._store.clear()}doOpen(){return Promise.resolve()}doClose(){return Promise.resolve()}}t.default=l},25289:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(36982));class a extends i.default{get(){return Promise.resolve()}queryByIndex(){return Promise.resolve([])}getAll(){return Promise.resolve([])}put(e,t){return Promise.resolve(t)}del(){return Promise.resolve()}count(){return Promise.resolve(0)}clear(){return Promise.resolve()}}t.default=a},55975:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStore=t.LruMediaStore=void 0;var i=n(r(48926)),a=n(r(51463)),o=r(86945),s=n(r(84979)),l=n(r(48520)),c=n(r(25289)),d=r(64103),u=r(7293),p=n(r(2680)),f=n(r(71058)),_=n(r(28245));class h{constructor(){this._getBackingStore=(0,a.default)((0,i.default)((function*(){try{const e=function(){const e=function(){if(null!=p.default&&"caches"in self)return new s.default("lru-media-array-buffer-cache");return null!=p.default?new l.default("media_lru_buffer"):null}();return null==e?null:new f.default({maxSize:u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(0,o.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?void 0:Number.MAX_SAFE_INTEGER,arrayBufferStore:e})}();if(null!=e)return yield e.open(),e}catch(e){if("SecurityError"===e.name)__LOG__(3)`There was a security error attempting to open the media storage. \
This likely indicates a permissions error. Falling back to dummy \
(no-op) storage.`;else{if(e instanceof d.DbOnLogoutAbort)throw e;__LOG__(4,!0,new Error,!0)`Failed to initialize media store! Falling back to dummy (no-op) storage. Error:
${(0,_.default)(e)}`,SEND_LOGS("Failed to initialize media store")}}return new c.default})))}get(e){var t=this;return(0,i.default)((function*(){return(yield t._getBackingStore()).get(e)}))()}queryByIndex(e,t){var r=this;return(0,i.default)((function*(){return(yield r._getBackingStore()).queryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).getAll()}))()}put(e,t){var r=this;return(0,i.default)((function*(){return(yield r._getBackingStore()).put(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){const r=yield t._getBackingStore();yield r.del(e)}))()}count(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).count()}))()}clear(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.clear()}))()}open(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.open()}))()}close(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.close()}))()}}t.MediaStore=h;const g=new h;t.LruMediaStore=g},71058:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(27870),s=n(r(36982)),l=n(r(86128)),c=r(86945),d=n(r(96222)),u=r(7293),p=n(r(37804));class f extends s.default{constructor(e){var t;super(),t=this,this._queueMap=new o.PromiseQueueMap,this._isInitialized=!1,this.updateMaxSizeInterval=null,this._dispose=e=>this._bufferStore.del(e),this.doPut=(e,r)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(r.byteLength>t.getMaxSize())return r;if(r.byteLength>3e7)return r;const n={id:e,timestamp:(new Date).getTime(),size:r.byteLength};try{return u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(0,c.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield t._updateMaxSize()),yield t._metaInfoStore.putObject(n),t._bufferStore.put(e,r)}catch(e){if(e instanceof l.default.AbortError&&e.message.includes("QuotaExceededError"))return __LOG__(2)`LruMediaStore: encounter QuotaExceededError, thus shrink the size of LruMediaStore`,void t.setMaxSize((0,a.default)(t.getCurrentSize(),"_this.getCurrentSize()")/2);throw e}}))),this.doDel=e=>this._isInitialized?this._queueMap.enqueue(e,(()=>this._metaInfoStore.del(e))):Promise.resolve(),this._updateMaxSize=function(){var e=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=yield(0,d.default)();if(null==r)return void t._clearStoreForThisSession();const n=t.getCurrentSize();if(null==n)return;const i=r.available,a=t._calculateTargetedBufferSize(r.quota);if(i>a)return void(e&&t.setMaxSize(i));const o=u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(0,c.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?2:1,s=a*o-i;n<s?t._clearStoreForThisSession():t.setMaxSize(n-s)}));return function(){return e.apply(this,arguments)}}();const{maxSize:r,arrayBufferStore:n}=e;this._bufferStore=n,this._isInitialized=null!=r,this._metaInfoStore=new p.default(null!=r?r:0,this._dispose),this.updateMaxSizeInterval=setInterval(this._updateMaxSize,6e4)}doGet(e){var t=this;return(0,i.default)((function*(){const r=yield t._bufferStore.get(e);return null!=r&&t.put(e,r),r}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._bufferStore.clear(),e._metaInfoStore.clear()}))()}doCount(){return this._metaInfoStore.count()}doOpen(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.open(),e._bufferStore.open()]),!e._isInitialized&&u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(0,c.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield e._updateMaxSize(!0),e._isInitialized=!0)}))()}doClose(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.close(),e._bufferStore.close()])}))()}getCurrentSize(){return this._metaInfoStore.getCurrentSize()}getMaxSize(){return this._metaInfoStore.getMaxSize()}setMaxSize(e){return this._metaInfoStore.setMaxSize(e)}_calculateTargetedBufferSize(e){const t=Math.floor(.01*e);return t<1e8?1e8:t>5e8?5e8:t}_clearStoreForThisSession(){this.setMaxSize(0),this.updateMaxSizeInterval&&(clearInterval(this.updateMaxSizeInterval),this.updateMaxSizeInterval=null)}}t.default=f},37804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(91481)),a=r(29830),o=n(r(3459));class s extends o.default{constructor(e,t){super(new i.default(a.initialize,a.IdbMetaInfoTable),{primaryIndex:a.metaInfoPrimaryIndex,dateIndex:a.metaInfoDateIndex,sizeIndex:a.metaInfoSizeIndex,maxSize:e,dispose:t})}}t.default=s},91481:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(36982));class o extends a.default{constructor(e,t){super(),this._initialize=e,this._table=t}doGet(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.get(e)}))()}doQueryByIndex(e,t){var r=this;return(0,i.default)((function*(){return yield r._initialize(),r._table.all({limit:t.limit,index:[e]})}))()}doGetAll(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.all()}))()}doPut(e,t){var r=this;return(0,i.default)((function*(){return yield r._initialize().then((()=>r._table.createOrReplace(t))),t}))()}doDel(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.remove(e)}))()}doCount(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.count()}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.clear(!0)}))()}doOpen(){return this._initialize()}doClose(){return Promise.resolve()}}t.default=o},3459:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(4352),s=r(27870),l=r(57319),c=n(r(36982)),d=r(86945),u=r(7293);class p extends c.default{constructor(e,t){var r;if(super(),r=this,this._queueMap=new s.PromiseQueueMap,this._purgeCount=0,this._optimizationEnabled=!1,this._purge=()=>{if(this._pendingPurgePromise)return this._pendingPurgePromise;const e=this.open().then((()=>(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e){const t=()=>{r._pendingPurgePromise=null,e()},n=r.getCurrentSize();if(null==n||n<=r._maxSize)return void t();const a=yield r.queryOneByIndex(r._dateIndex),o=r.getCurrentSize(),s=r._maxSize;if(null==o||o<=s)return void t();if(null==a)return(0,i.default)((function*(){const e=yield r.count();__LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: No row returned but currentSize (${o}) > maxSize (${s}). Row count is ${e} (may be out of date).`,SEND_LOGS("size-lru-store-invalid-empty")}))(),Promise.reject(new Error("Query returned no result but currentSize > maxSize"));const l=a[r._primaryIndex];return r.del(l)}));return function(){return e.apply(this,arguments)}}())));return this._pendingPurgePromise=e},this._purgeOptimized=(e,t)=>{this._purgeCount++;const n=Promise.resolve().then((0,i.default)((function*(){var n;const i=yield r._store.get(e),a=null==i?0:r._getSize(i),o=null!==(n=r.getCurrentSize())&&void 0!==n?n:0,s=r.getMaxSize(),l=o+(t-a);if(l<=s)return;const c=yield r.count(),d=yield r.doQueryByIndex(r._dateIndex,{limit:c}),u=[];let p=l;for(const t of d)if(t[r._primaryIndex]!==e&&(p-=r._getSize(t),u.push(t[r._primaryIndex]),p<=s))break;if(p>s)throw __LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: Adjusted size is too big even after removal of all items.`,SEND_LOGS("size-lru-store-invalid-empty"),new Error("Above max limit after purge");yield Promise.all(u.map((e=>r.del(e)))),0==--r._purgeCount&&(r._pendingPurgePromiseOptimized=null)})));return null!=this._pendingPurgePromiseOptimized?(this._pendingPurgePromiseOptimized=this._pendingPurgePromiseOptimized.finally((()=>n)),this._pendingPurgePromiseOptimized):(this._pendingPurgePromiseOptimized=n,n)},this._schedulePurge=()=>{this._purgeTimer.debounce(2e3)},this.doPut=(e,t)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(t[r._primaryIndex]!==e)throw new Error("The key you provide does not match.");const n=yield r._store.get(e),i=null==n?0:r._getSize(n),o=r._getSize(t);r._optimizationEnabled&&(yield r._purgeOptimized(e,o));const s=yield r._store.put(e,t);return r._currentSize=(0,a.default)(r.getCurrentSize(),"_this.getCurrentSize()")+(o-i),r._optimizationEnabled||r._schedulePurge(),s}))),this.doDel=e=>this._queueMap.enqueue(e,(0,i.default)((function*(){const t=yield r._store.get(e);if(null!=t){try{yield r._dispose(e,t)}catch(e){throw __LOG__(3,void 0,void 0,!0)`SizeLRUObjectStore: _dispose error: ${e.message}`,SEND_LOGS("size-lru-store-dispose-error"),e}yield r._store.del(e),r._currentSize=(0,a.default)(r.getCurrentSize(),"_this.getCurrentSize()")-r._getSize(t)}}))),this._store=e,this._primaryIndex=t.primaryIndex,this._dateIndex=t.dateIndex,this._sizeIndex=t.sizeIndex,t.maxSize<0)throw new Error("Cannot set max size to a negative number");this._maxSize=Math.floor(t.maxSize),this._dispose=t.dispose,this._purgeTimer=new l.ShiftTimer((()=>{this._purge().catch((e=>{__LOG__(3)`Error while purging: ${e.message}`}))})),this._optimizationEnabled=u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(0,d.getABPropConfigValue)("web_lru_cache_optimization")}getCurrentSize(){return this._currentSize}getMaxSize(){return this._maxSize}setMaxSize(e){return e<0?Promise.reject(new Error("Cannot set size to a negative number")):(this._maxSize=Math.floor(e),this._purgeTimer.cancel(),this._purge().catch((e=>{__LOG__(3)`Error while purging during setMaxSize: ${e.message}`})))}putObject(e){const t=e[this._primaryIndex];return this.put(t,e)}_getSize(e){const t=e[this._sizeIndex];return"number"!=typeof t||t<0?(__LOG__(3)`Invalid size in index ${this._sizeIndex}: ${t}`,0):t}doGet(e){return this._store.get(e)}queryOneByIndex(e){var t=this;return(0,i.default)((function*(){const r=yield t._store.queryByIndex(e,{limit:1});return 0===r.length?null:r[0]}))()}doQueryByIndex(e,t){return this._store.queryByIndex(e,t)}doGetAll(){return this._store.getAll()}doClear(){var e=this;return(0,i.default)((function*(){e._purgeTimer.cancel(),yield e._store.clear(),e._currentSize=0}))()}doCount(){return this._store.count()}doOpen(){var e=this;return(0,i.default)((function*(){if(yield e._store.open(),null!=e._currentSize)return;const t=yield e._store.doGetAll();e._currentSize=t.reduce(((t,r)=>t+e._getSize(r)),0)}))()}doClose(){return this._currentSize=null,this._store.close()}}t.default=p},78986:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0});var i={MediaPrep:!0,checkExistence:!0,clearMediaForChat:!0,downloadMsg:!0,downloadProgressiveJpegThumbnail:!0,downloadStatusV3Thumbnail:!0,downloadVideoThumbnail:!0,forwardMediaMsg:!0,manuallySetMedia:!0,prepRawMedia:!0,resumeUploadMsg:!0};Object.defineProperty(t,"MediaPrep",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"checkExistence",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"clearMediaForChat",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"downloadMsg",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"downloadProgressiveJpegThumbnail",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"downloadStatusV3Thumbnail",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"downloadVideoThumbnail",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"forwardMediaMsg",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"manuallySetMedia",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"prepRawMedia",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"resumeUploadMsg",{enumerable:!0,get:function(){return T.default}});var a=r(74025);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=r(39287);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=r(79019);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=r(96575);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=r(85046);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=r(4007);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=r(48086);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var p=n(r(94995)),f=n(r(16389)),_=n(r(48714)),h=n(r(93628)),g=n(r(42454)),m=n(r(65403)),y=n(r(11679)),E=n(r(37461)),S=n(r(79373)),v=n(r(40674)),T=n(r(23127))},21921:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkAndRepair=function(e,t){const r=new i.default.WebcMediaAnalyzed;let n=!1;return function(e){let t;return new Promise(((r,n)=>{__LOG__(2)`MediaAnalyzer:sendMessageToWorker`,t=o||new a.default,o=void 0,t.onmessage=e=>{try{e.data&&"log"===e.data.type?__LOG__(2)`(via Milan) ${e.data.msg}`:r(e.data)}catch(e){n(e)}},t.onerror=e=>{n(new Error(`Milan.onerror = ${(null==e?void 0:e.message)?e.message:e}`))},t.postMessage(e)})).finally((()=>{t&&(t.terminate(),o=new a.default)}))}({type:"prep",file:e,asGif:t}).then((e=>{let{type:t,result:r,error:i,filename:a,file:o}=e;switch(t){case"result":return __LOG__(2)`MediaAnalyzer:checkAndRepair approved file`,n=!!r,r;case"parsingError":return __LOG__(2)`trouble parsing file ${o} (fossil ${a}) ${String(i)}`,o&&(__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got parsing error! ${String(i)}`,SEND_LOGS("media-parsing-error")),void __LOG__(2)`MediaAnalyzer:checkAndRepair rejected file (${String(i)})`}})).catch((e=>{__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got error! ${String(e)}`,SEND_LOGS("media-detection-error")})).finally((()=>{if(r){let t;if(e.name){const r=e.name.split(".");r.length>1&&(t=r[r.length-1])}r.set({webcMediaSupported:n,webcMediaExtensions:t}),r.markWebcMediaAnalyzeT(),r.commit()}}))};var i=n(r(11339)),a=n(r(91528));let o},74025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDownloadMedia=i,t.cancelDownloadMsg=function(e){e.mediaObject?i(e.mediaObject):e.mediaObject||(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelDownloadMsg msg without mediaObject"))};var n=r(9329);function i(e){(0,n.cancelDownloadMedia)(e)}},39287:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadMedia=i,t.cancelUploadMsg=function(e){e.mediaObject?i(e.mediaObject):(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelUploadMsg msg without mediaObject"))};var n=r(70996);function i(e){(0,n.cancelUploadMedia)(e)}},16389:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(61596),o=r(9329);function s(){return(s=(0,i.default)((function*(e){if(yield e.waitForPhoneUpload(),!e.mediaObject)return __LOG__(4,void 0,new Error,!0)`checkExistence msg without mediaObject, id: ${e.id.toString()} type: ${e.type}`,void SEND_LOGS("media-fault: checkExistence msg without mediaObject");yield(0,o.checkExistence)({mimetype:e.mimetype,mediaObject:e.mediaObject,mediaType:(0,a.getMsgMediaType)(e)})}))).apply(this,arguments)}},48714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){n.clearMediaForChat(e)};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(88297));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},60953:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.consolidateMediaUpdate=function(e,t){if(e.isUnsentPhoneMsg()){e.mediaObject&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: consolidateMediaUpdate unsent message"));const t=_(e);if(t.hasOwnProperty("preview")){const r=t.preview;delete t.preview,r&&p.default.createFromBase64Jpeg(r).then((t=>{(null==e?void 0:e.mediaData)&&e.isUnsentPhoneMsg()&&(e.mediaData.preview=t)}))}e.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:e.phoneUploading?c.MEDIA_DATA_STAGE.REMOTE_UPLOADING:c.MEDIA_DATA_STAGE.REMOTE_NEED_UPLOAD}))}else h(e,e,t)},t.consolidateMediaUpdateWithValues=h;var i=n(r(81109)),a=r(15461),o=n(r(64328)),s=r(21009),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(88297)),c=r(58668),d=r(61596),u=r(9329),p=n(r(34949));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function _(e){const t={};return c.MAPPED_MSG_PROPS.forEach((r=>{const n=e[r],i=c.MSG_TO_MEDIA[r];t[i]=n})),t.type===a.MSG_TYPE.INTERACTIVE&&(t.type=(0,s.getInteractiveMsgMediaType)(e)),t}function h(e,t,r){const n=_(t);let i=e.mediaObject;const a=t.filehash;if(i)a&&a!==i.filehash&&(__LOG__(2)`media:msg ${e.id.toString()} ${i.filehash?"changed":"added"} filehash`,l.disassociateMediaFromMsg(i,e),i=l.getOrCreateMediaObject(a),e.mediaObject=i,l.associateMediaWithMsg(i,e));else{i=a?l.getOrCreateMediaObject(a):new s.MediaObject;const t=e.mediaData;void 0!==t.aspectRatio&&(n.aspectRatio=t.aspectRatio),e.mediaObject=i,l.associateMediaWithMsg(i,e)}let p=!1;const{deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:y,streamingSidecar:E,firstFrameSidecar:S,directPath:v,scansSidecar:T,scanLengths:C,staticUrl:A}=t;if(f||m){let e,r;try{e=(0,d.msgToMediaType)(t)}catch(t){e=~d.MEDIA_TYPE_VALUES.indexOf(y)?y:null}p=!i.entries.has({encFilehash:m,deprecatedMms3Url:f}),p?h&&e&&m?r=i.entries.addEntry({deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:C,debugHint:"consolidate",staticUrl:A}):p=!1:h&&(r=i.entries.updateEntry({deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:C,staticUrl:A})),r||(p=!1),p&&i.downloadStage===c.DOWNLOAD_STAGE.ERROR_MISSING&&(n.downloadStage=c.DOWNLOAD_STAGE.INIT)}if(i.consolidate(n)||i.notifyMsgsAsync(),p&&i.downloadStage===c.DOWNLOAD_STAGE.NEED_POKE){let n;try{n=(0,d.getMsgMediaType)(e)}catch(r){if(!t.type)throw r;n=(0,d.msgToMediaType)({type:t.type,isGif:e.isGif})}(0,u.downloadMedia)({mimetype:t.mimetype,mediaObject:i,downloadEvenIfExpensive:!1,mediaType:n,rmrReason:r,downloadOrigin:(0,o.default)(e)})}}},93628:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{msg:t,isUserClick:r,mode:n,downloadEvenIfExpensive:l,rmrReason:c,rmrData:d,isAutoDownload:u}=e,{mediaObject:p}=t;if(p){return p.getPendingProcess("fromDisk").then((0,i.default)((function*(){r&&p.userDownloadAttemptCount++,yield(0,s.downloadMedia)({mimetype:t.mimetype,mediaObject:p,downloadEvenIfExpensive:l,mediaType:(0,o.getMsgMediaType)(t),rmrReason:c,rmrData:d,downloadOrigin:(0,a.default)(t),isVcardOverMmsDocument:t.isVcardOverMmsDocument,mode:n,isAutoDownload:u,isViewOnce:Boolean(t.isViewOnce)}),p.userDownloadAttemptCount=0})))}return __LOG__(4,void 0,new Error,!0)`id: ${t.id.toString()} type: ${t.type}`,SEND_LOGS("media-fault: downloadMsg msg without mediaObject"),Promise.resolve()};var i=n(r(48926)),a=n(r(64328)),o=r(61596),s=(n(r(11339)),r(9329))},42454:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var a=i(r(48926)),o=r(89385),s=i(r(45095)),l=r(26384),c=r(61596),d=i(r(34949)),u=i(r(28245));function p(){return(p=(0,a.default)((function*(e){const{msg:t,isPreload:r,signal:i}=e;__LOG__(2)`media.downloadProgressiveJpegThumbnail: start`;try{const e=(0,s.default)(t.scanLengths,"msg.scanLengths"),a=(0,s.default)(t.scansSidecar,"msg.scansSidecar"),o=(0,s.default)(t.mediaObject,"msg.mediaObject"),u=(0,s.default)(o.filehash,"mediaObject.filehash"),{encFilehash:p,directPath:f}=t,_=yield l.downloadManager.downloadAndDecrypt({directPath:f,encFilehash:p,filehash:u,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:c.MEDIA_TYPES.IMAGE,signal:i||(new n).signal,userDownloadAttemptCount:0,progressiveJpegOpts:{mimetype:"image/jpeg",scansSidecar:a,scanLengths:e,scanCount:1},isPreload:r});o.consolidate({fullPreviewData:yield d.default.createFromData(_,"image/jpeg")}),__LOG__(2)`media.downloadProgressiveJpegThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadProgressiveJpegThumbnail aborted`;__LOG__(3,void 0,void 0,!0)`media.downloadProgressiveJpegThumbnail: error\n${(0,u.default)(e)}`,SEND_LOGS("download-pjpeg-thumbnail-failed")}}))).apply(this,arguments)}},65403:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(15461),o=n(r(61516)),s=n(r(42454));function l(){return(l=(0,i.default)((function*(e){const{msg:t,isPreload:r,signal:n}=e,{encFilehash:i,thumbnailSha256:l,thumbnailEncSha256:c,thumbnailDirectPath:d}=t;t.type===a.MSG_TYPE.IMAGE&&t.scanLengths&&t.scansSidecar&&i?yield(0,s.default)({msg:t,signal:n,isPreload:r}):l&&c&&d&&(yield(0,o.default)({msg:t,signal:n,isPreload:r}))}))).apply(this,arguments)}},11679:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var a=i(r(48926)),o=i(r(45095)),s=i(r(64369)),l=r(26384),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(36638)),d=r(61596),u=i(r(34949)),p=i(r(28245)),f=r(2541);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function h(){return(h=(0,a.default)((function*(e){const{msg:t}=e,{encFilehash:r,filehash:i,directPath:a}=t;if(!r||!i||!a)return;const{fullPreviewData:_,fullWidth:h,fullHeight:g}=t.mediaData;if(!_||null==h||null==g){__LOG__(2)`media.downloadVideoThumbnail: start`;try{const e=Math.max(parseInt(t.mediaData.duration,10),1),p={video:{size:t.mediaData.size,duration:e},secondsToDownload:1},_=yield l.downloadManager.downloadAndDecrypt({directPath:a,encFilehash:r,filehash:i,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:d.MEDIA_TYPES.VIDEO,signal:(new n).signal,userDownloadAttemptCount:0,partialVideoOpts:p,isPreload:!0}),h=new Blob([_],{type:"video/mp4"}),{thumbs:[g]}=yield c.generateVideoThumbsAndDuration({file:h,maxDimensions:[s.default.VIDEO_THUMB_MAX_EDGE],debugHint:"downloadVideoThumbnail",throwOnBlack:!0}),m=yield u.default.createFromBase64Jpeg(f.URL.parseDataURL(g.url).data),y=(0,o.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),E={fullPreviewData:m,fullWidth:g.fullWidth,fullHeight:g.fullHeight};y.consolidate(E),__LOG__(2)`media.downloadVideoThumbnail: success`}catch(e){if(e instanceof c.BlackVideoThumbnailError)return void __LOG__(2)`media.downloadVideoThumbnail: black thumbnail was generated, fallback to blurred thumbnail`;__LOG__(3,!0)`media.downloadVideoThumbnail: error\n${(0,p.default)(e)}`}}}))).apply(this,arguments)}},37461:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=n(r(94995)),s=r(58668),l=n(r(11339)),c=n(r(34949));function d(){return(d=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2)`Prepping media msg`;const a=e.mediaObject;if(!a)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: forwardMediaMsg msg without mediaObject"),Promise.reject(new Error("non initialized media"));const d=e.mediaData.toJSON();null!=d.preview&&(d.preview=a.contentInfo._preview),d.mediaBlob instanceof c.default&&d.mediaBlob.retain();const u={mimetype:d.mimetype},p=d.isGif?(0,i.default)((0,i.default)({},u),{},{isGif:!0}):u;d.type===s.OUTWARD_TYPES.PTT&&(d.type=s.OUTWARD_TYPES.AUDIO);const f={businessOwnerJid:e.businessOwnerJid,productId:e.productId,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount,title:e.title,description:e.description},_=yield new o.default(d.type,Promise.resolve(d)).sendToChat(t,{forwardedFromWeb:!0,caption:d.type===s.OUTWARD_TYPES.DOCUMENT||d.type===s.OUTWARD_TYPES.PRODUCT?e.caption:void 0,footer:d.type===s.OUTWARD_TYPES.PRODUCT?e.footer:void 0,addEvenWhilePreparing:!0,placeholderProps:p,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:n,productMsgOptions:f});if(d.type===s.OUTWARD_TYPES.STICKER){var h,g,m;new l.default.StickerSend({stickerSendOrigin:l.default.STICKER_SEND_ORIGIN_TYPE.FORWARD,stickerIsAnimated:Boolean(null===(h=e.mediaData)||void 0===h?void 0:h.isAnimated),stickerIsFirstParty:Boolean(null===(g=e.mediaData)||void 0===g?void 0:g.isFirstParty),stickerIsFromStickerMaker:Boolean(null===(m=e.mediaData)||void 0===m?void 0:m.isFromStickerMaker)}).commit();r(49264).RecentStickerCollectionMd.addStickerWithMediaData(d,e.id.id)}return _}))).apply(this,arguments)}},64328:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.asProduct?i.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:e.isStatusV3?i.default.DOWNLOAD_ORIGIN_TYPE.STATUS_USER:e.isGroupMsg?i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL};var i=n(r(11339))},79373:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{msg:t,media:r,rmrReason:n}=e;const l=t.mediaObject;if(!l)return;s.default.createFromData(r,t.mimetype).then((e=>{(0,o.manuallySetMedia)({mimetype:t.mimetype,mediaObject:l,mediaBlob:e,mediaType:(0,a.getMsgMediaType)(t),rmrReason:n,downloadOrigin:(0,i.default)(t)})}))};var i=n(r(64328)),a=r(61596),o=(n(r(11339)),r(9329)),s=n(r(34949))},79019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaMetadata=function(e){const t=e.mediaObject;if(!t)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata msg without mediaObject"),new Error("msg.mediaMetadata with no mediaObject");const r=t.entries.getEntryByEncFilehash({encFilehash:e.encFilehash,deprecatedMms3Url:e.deprecatedMms3Url});if(!r)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata no entry"),new Error("msg.mediaMetadata with entry mismatch");const n=e.mediaData;return{url:r.deprecatedMms3Url,directPath:r.directPath,encFilehash:r.encFilehash,mediaKey:r.mediaKey,mediaKeyTimestamp:r.mediaKeyTimestamp,filehash:e.filehash,type:n.type,mimetype:n.mimetype,filename:n.filename,duration:n.duration,width:n.fullWidth,height:n.fullHeight,firstFrameLength:n.firstFrameLength,isAnimated:n.isAnimated,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth,waveform:e.waveform,staticUrl:e.staticUrl}}},96575:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterMsg=function(e){e.off(null,p);const t=e.mediaObject;t&&a.disassociateMediaFromMsg(t,e)},t.prepareMsg=function(e){const t=e.mediaObject;if(t)return t.resolveWhenConsolidated();const r=e.mediaData,n=r.preview;if(n instanceof c.default&&void 0===r.aspectRatio&&(void 0===r.fullWidth||void 0===r.fullHeight))return(0,s.getImageWidthHeight)(n).then((t=>{let{width:r,height:n}=t;e.mediaObject||e.mediaData.set({aspectRatio:r/n})}));return Promise.resolve()},t.registerMsg=function(e){e.mimetype||e.type!==o.OUTWARD_TYPES.IMAGE||(e.mimetype="image/jpeg");e.mimetype||e.type!==o.OUTWARD_TYPES.STICKER||(e.mimetype="image/webp");e.on(u,p),(0,i.consolidateMediaUpdate)(e,l.default.WEBC_RMR_REASON_CODE.MSG_INIT)},t.registerMsgEarly=function(e,t){e.isUnsentPhoneMsg()&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: registerMsgEarly msg without mediaObject"));const r={};for(let n=0;n<o.MEDIA_MSG_PROPS.length;n++){const i=o.MEDIA_MSG_PROPS[n],a=t[i];r[i]=void 0!==a?a:e[i]}r.mimetype||r.type!==o.OUTWARD_TYPES.IMAGE||(t.mimetype=r.mimetype="image/jpeg");e.on(u,p),(0,i.consolidateMediaUpdateWithValues)(e,r,l.default.WEBC_RMR_REASON_CODE.MSG_UPDATE);const n={};for(let e=0;e<o.MSG_SPECIFIC_FIELDS.length;e++){const t=o.MSG_SPECIFIC_FIELDS[e];n[t]=r[o.MEDIA_TO_MSG[t]]}e.mediaData.set(n)};var i=r(60953),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(88297)),o=r(58668),s=r(56406),l=n(r(11339)),c=n(r(34949));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}const u=`change:phoneUploading change:ack ${o.MEDIA_MSG_PROPS.map((e=>`change:${e}`)).join(" ")}`;function p(e){(0,i.consolidateMediaUpdate)(e,l.default.WEBC_RMR_REASON_CODE.MSG_UPDATE)}},40674:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;__LOG__(2)`Prepping raw media`,r=t.isPtt?a.OUTWARD_TYPES.PTT:t.asDocument?a.OUTWARD_TYPES.DOCUMENT:t.asGif?a.OUTWARD_TYPES.VIDEO:t.isAudio?a.OUTWARD_TYPES.AUDIO:t.asSticker?a.OUTWARD_TYPES.STICKER:a.OUTWARD_TYPES.UNKNOWN;const n=Promise.resolve(e).then((e=>(e.autoreleaseWhenPromiseCompletes(n),(0,o.default)(e,t))));return new i.default(r,n)};var i=n(r(94995)),a=r(58668),o=n(r(27989))},85046:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadProductImage=function(){return d.apply(this,arguments)};var a=i(r(48926)),o=r(1063),s=i(r(11105)),l=r(61596),c=i(r(11339));function d(){return(d=(0,a.default)((function*(e,t){const r=yield(0,o.blobToArrayBuffer)(e.forceToBlob()).then((e=>s.default.unencryptedUpload({file:e,hash:t,signal:(new n).signal,type:l.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE,uploadOrigin:c.default.UPLOAD_ORIGIN_TYPE.PRODUCT_CATALOG,isViewOnce:!1})));return new URL(r.directPath,"https://mmg.whatsapp.net").toString()}))).apply(this,arguments)}},23127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const{mediaObject:r}=e;if(!r)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: resumeUploadMsg msg without mediaObject"),Promise.resolve();r.userUploadAttemptCount++;const{filehash:n}=r,p=(0,s.shouldUseMediaKeyCache)()&&null!=n&&null!==(t=s.MediaKeyCache.get(n))&&void 0!==t?t:void 0;e.ack=a.ACK.CLOCK;const f=(0,c.uploadMedia)({mimetype:e.mimetype,mediaObject:r,mediaKeyInfo:p,mediaType:(0,l.getMsgMediaType)(e),forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,o.default)(e.chat),isViewOnce:Boolean(e.isViewOnce)}).then(function(){var t=(0,i.default)((function*(t){let{mediaEntry:i}=t;if((0,s.shouldUseMediaKeyCache)()&&null!=n&&s.MediaKeyCache.delete(n),!i)throw new Error("upload failed: media entry was not created");r.userUploadAttemptCount=0;const a={deprecatedMms3Url:i.deprecatedMms3Url,directPath:i.directPath,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,filehash:r.filehash,encFilehash:i.encFilehash,size:r.size,streamingSidecar:i.sidecar,firstFrameSidecar:i.firstFrameSidecar};return yield(0,u.default)(e,a),e}));return function(){return t.apply(this,arguments)}}());return(0,d.resendMsgToChat)(e.chat,f).catch((()=>{e.ack=a.ACK.FAILED}))};var i=n(r(48926)),a=r(35470),o=n(r(46220)),s=r(45554),l=r(61596),c=r(70996),d=r(75887),u=(r(13705),n(r(2603)))},4007:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterSticker=function(e){const{mediaObject:t}=e;t&&c.disassociateMediaFromSticker(t,e)},t.deregisterStickerPackIcon=function(e){const{mediaObject:t}=e;t&&c.disassociateMediaFromStickerPack(t,e)},t.downloadStickerOrStickerPackIcon=function(){return m.apply(this,arguments)},t.prepSticker=function(e){__LOG__(2)`Prepping sticker`;const t=e.mediaObject,r=e.mediaData.toJSON();if(r.fullWidth=125,r.fullHeight=125,!t)return __LOG__(4,void 0,new Error,!0)`id: ${e.id}`,SEND_LOGS("media-fault: prepSticker sticker without mediaObject"),new l.default(r.type,Promise.reject(new Error("non initialized media")));return new l.default(r.type,Promise.resolve(r))},t.registerSticker=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker with no filehash`,void SEND_LOGS("sticker-filehash-error");const t=c.getOrCreateMediaObject(e.filehash);return c.associateMediaWithSticker(t,e),t}(e),u.MEDIA_TYPES.STICKER)},t.registerStickerPackIcon=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker pack with no filehash`,void SEND_LOGS("sticker-pack-filehash-error");const t=c.getOrCreateMediaObject(e.filehash);return c.associateMediaWithStickerPack(t,e),t}(e),u.MEDIA_TYPES.IMAGE)};var a=i(r(48926)),o=r(26384),s=r(7293),l=i(r(94995)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(88297)),d=r(58668),u=r(61596),p=i(r(11339)),f=r(9329),_=r(64551);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function g(e,t,r){const n=function(e){const t={};return d.MAPPED_STICKER_PROPS.forEach((r=>{const n=e[r],i=d.MSG_TO_MEDIA[r];t[i]=n})),t}(e);if(e.mediaData.set(n),!t)return;e.mediaObject=t;const{deprecatedMms3Url:i,encFilehash:a}=e;if((a||i)&&!t.entries.has({encFilehash:a,deprecatedMms3Url:i})){t.entries.addEntry({deprecatedMms3Url:i,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,encFilehash:a,type:r,directPath:e.directPath,debugHint:"setMediaObjectValues"})&&t.downloadStage===d.DOWNLOAD_STAGE.ERROR_MISSING&&(n.downloadStage=d.DOWNLOAD_STAGE.INIT)}t.consolidate(n)}function m(){return(m=(0,a.default)((function*(e,t){if(e.isPlaceholder||e.isCreateButton)return e.mediaData.mediaStage=d.MEDIA_DATA_STAGE.PREPARING,Promise.resolve();const i=e.mediaObject;if(!i)return Promise.reject(new Error("media-fault: downloadStickerOrStickerPackIcon sticker/stickerPack without mediaObject"));if(i.downloadStage===d.DOWNLOAD_STAGE.RESOLVED)return Promise.resolve();const a="STICKER"===t?p.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_STICKER:p.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_ICON;let l=!1;yield i.getPendingProcess("fromDisk").then((()=>{if(!s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&!e.deprecatedMms3Url||!e.filehash||!e.mediaKey||!e.encFilehash)return l=!0,o.downloadManager.rmr({mediaObject:i,signal:(new n).signal,rmrReason:a})})).then((()=>(0,f.downloadMedia)({mimetype:e.mimetype,mediaObject:e.mediaObject,downloadEvenIfExpensive:!0,mediaType:(0,u.msgToMediaType)({type:e.type,isGif:!1}),rmrReason:a,downloadOrigin:p.default.DOWNLOAD_ORIGIN_TYPE.STICKER_PICKER,shouldThrow:!0}))),s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&l&&_.ServerProps.webServerStickerPanel&&r(49264).RecentStickerCollectionMd.updateStickerMediaData(e.filehash,i.entries.getDownloadEntry())}))).apply(this,arguments)}},48086:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoStreamingInfo=function(e){const t=e.mediaObject;return t?t.videoStreamingInfo(e.id.toString()):null};r(21009)},2320:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(11290),o=r(99140),s=r(84866),l=r(58668);class c extends a.BaseModel{constructor(){super(...arguments),this.type=(0,a.prop)(l.OUTWARD_TYPES.UNKNOWN),this.directPath=(0,a.prop)(),this.mediaKey=(0,a.prop)(),this.mediaKeyTimestamp=(0,a.prop)(),this.encFilehash=(0,a.prop)(),this.mediaStage=(0,a.prop)(l.MEDIA_DATA_STAGE.INIT),this.size=(0,a.prop)(),this.loadedSize=(0,a.prop)(),this.filehash=(0,a.prop)(),this.mimetype=(0,a.prop)(),this.mediaBlob=(0,a.prop)(),this.renderableUrl=(0,a.prop)(),this.fullHeight=(0,a.prop)(),this.fullWidth=(0,a.prop)(),this.aspectRatio=(0,a.prop)(),this.rgbaBuffer=(0,a.prop)(),this.rgbaHeight=(0,a.prop)(),this.rgbaWidth=(0,a.prop)(),this.animationDuration=(0,a.prop)(0),this.animatedAsNewMsg=(0,a.prop)(!1),this.isAnimated=(0,a.prop)(),this.isFirstParty=(0,a.prop)(),this.isFromStickerMaker=(0,a.prop)(),this.stickerPackId=(0,a.prop)(),this.stickerPackName=(0,a.prop)(),this.stickerPackPublisher=(0,a.prop)(),this.singleLoopDuration=(0,a.prop)(),this.firstFrameLength=(0,a.prop)(),this.firstFrameSidecar=(0,a.prop)(),this.emojis=(0,a.prop)(),this.progressiveStage=(0,a.prop)(),this.isViewOnce=(0,a.prop)(!1),this.staticUrl=(0,a.prop)(),this.preview=(0,a.prop)(),this.sidecar=(0,a.prop)(),this.duration=(0,a.prop)(),this.durationFloat=(0,a.prop)(),this.isGif=(0,a.prop)(),this.gifAttribution=(0,a.prop)(),this.streamable=(0,a.derived)(this._isStreamable,["isGif","isViewOnce","mediaStage","sidecar","type","_swStreamingSupported"]),this._swStreamingSupported=(0,a.prop)(!1),this._listeningToSwSupport=(0,a.prop)(!1),this.filename=(0,a.prop)(),this.pageCount=(0,a.prop)(),this.documentPreview=(0,a.prop)(),this.isVcardOverMmsDocument=(0,a.prop)(!1),this.parsedVcards=(0,a.prop)(),this.fullPreviewSize=(0,a.prop)(),this.fullPreviewData=(0,a.prop)(),this.subtype=(0,a.prop)(),this.waveform=(0,a.prop)()}initialize(){super.initialize()}set(e,t,r){let n,a=r;return"string"==typeof e?n={[e]:t}:(n=e,a=t),n=function(e){if(e.filename&&e.type===d.TYPE.DOCUMENT){const t=(0,o.cleanFilename)(e.filename);return(0,i.default)((0,i.default)({},e),{},{filename:t,caption:t})}return e}(n),super.set(n,a)}_isStreamable(){return this.isStreamable()}isStreamable(){return this.isStreamableType()&&this.listenToServiceWorkerSupport()&&!this.isViewOnce}_updateStreamingSupported(e){this._swStreamingSupported=e}listenToServiceWorkerSupport(){if(this._listeningToSwSupport)return this._swStreamingSupported;{const e=r(92658).default;this.listenTo(e,"change:streamingSupported",this._updateStreamingSupported),this._swStreamingSupported=Boolean(e.streamingSupported)}return this._listeningToSwSupport=!0,this._swStreamingSupported}isStreamableType(){let e=!1;return e=this.type===l.OUTWARD_TYPES.VIDEO&&!this.isGif&&(this.mediaStage===l.MEDIA_DATA_STAGE.INIT||this.mediaStage===l.MEDIA_DATA_STAGE.FETCHING||this.mediaStage===l.MEDIA_DATA_STAGE.DECRYPTING||this.mediaStage===l.MEDIA_DATA_STAGE.RESOLVED)&&null!=this.fullWidth&&null!=this.fullHeight&&Boolean(this.sidecar&&this.sidecar.byteLength>0),e}isDownloadable(){return!this.isViewOnce&&(null!=this.renderableUrl||s.MediaBlobCache.has(this.filehash)||this.mediaStage===l.MEDIA_DATA_STAGE.EXISTS||this.mediaStage===l.MEDIA_DATA_STAGE.PROGRESSIVE_READY)}}c.Proxy="mediaData";const d=(0,a.defineModel)(c);d.TYPE=l.OUTWARD_TYPES;var u=d;t.default=u},80923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntryList=t.MediaEntry=void 0;var i=n(r(48926)),a=r(20177),o=r(61070),s=r(92844),l=n(r(21081)),c=r(46640),d=n(r(22283)),u=n(r(87798));const p="PROBABLY_ON_SERVER",f="PROBABLY_OFF_SERVER",_="UNKNOWN";class h{constructor(e){this.useBackupUrl=!1,this._encFilehashPromise=null,this.deprecatedMms3Url=e.deprecatedMms3Url,this.mediaKey=e.mediaKey,this.mediaKeyTimestamp=e.mediaKeyTimestamp,this.encFilehash=e.encFilehash,this.serverStatus=_,this.sidecar=e.sidecar,this.directPath=e.directPath,this.firstFrameSidecar=e.firstFrameSidecar,this.type=e.type,this.scansSidecar=e.scansSidecar,this.scanLengths=e.scanLengths,this.staticUrl=e.staticUrl}url(e){var t=this;return(0,i.default)((function*(){const{useFallback:r,forceHashUrl:n}=e||{},{encFilehash:i}=t;if(!i)return Promise.reject(new Error("media_entry: encFilehash does not exist"));const{selectedHost:a,fallbackHost:o}=yield c.mediaHosts.getHostsInfo({operation:d.default.DOWNLOAD,encFilehash:i,type:t.type}),s=r&&o?o:a;return(0,l.default)({directPath:n?null:t.directPath,encFilehash:i,hostname:s.hostname,type:t.type})}))()}canReuseMediaKey(){if(null==this.directPath)return!1;const e=(0,s.castToUnixTime)(this.mediaKeyTimestamp);return(0,o.isMediaKeyReusable)(e)}markWhetherOnServer(e){this.serverStatus=e?p:f}}t.MediaEntry=h;function g(e){e.entries.sort(((e,t)=>{const r=m(t)-m(e);return 0===r?t.mediaKeyTimestamp-e.mediaKeyTimestamp:r}))}function m(e){let t=0;switch(e.serverStatus){case p:t+=200;break;case f:break;case _:t+=100}return e.encFilehash?t+=20:e._encFilehashPromise&&(t+=10),t}t.MediaEntryList=class{constructor(){this.entries=[]}_updateEntry(e){let{foundEntry:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:u,staticUrl:p}=e;if(r&&!(0,a.b64Equal)(t.mediaKey,r)){const e=t.mediaKey.replace("=","").split("\n")[0],n=r.replace("=","").split("\n")[0];return __LOG__(4,void 0,new Error,!0)`media-fault: mediaKey changed for the same MMS3 url. type:${t.type}. equal?:${e===n}. Debug:\n${JSON.stringify({before:{hasDirectPath:Boolean(t.directPath),hasEncFilehash:Boolean(t.encFilehash),hasMediaKey:Boolean(t.mediaKey),hasDeprecatedMms3Url:Boolean(t.deprecatedMms3Url)},after:{hasDirectPath:Boolean(s),hasEncFilehash:Boolean(i),hasDeprecatedMms3Url:Boolean(u)}},null,2)}`,SEND_LOGS("media-key-mismatch-same-mms3-url"),null}return null!=n&&(t.mediaKeyTimestamp=n),o&&(t.sidecar=o),l&&(t.firstFrameSidecar=l),c&&(t.scansSidecar=c),(null==d?void 0:d.length)&&(t.scanLengths=d),p&&(t.staticUrl=p),t.directPath=s,t}updateEntry(e){let{deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u}=e;const p=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t});if(p)return this._updateEntry({foundEntry:p,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u})}addEntry(e){const{deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u,debugHint:p}=e;null==i&&(__LOG__(4,void 0,new Error,!0)`Media type ${a} from ${p} is missing encFilehash`,SEND_LOGS(`media-entry-missing-upload-hash-${a}-${p}`));const f=this.entries,_=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t}),g=_?this._updateEntry({foundEntry:_,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u}):null;if(g)return g;if(!r)return null;const m=new h({deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u});return f.push(m),m}_getKey(e){let{encFilehash:t,deprecatedMms3Url:r}=e;return null==t?`mms3:${r}`:t}has(e){return null!=this.getEntryByEncFilehash(e)}getEntryByEncFilehash(e){const t=this._getKey(e);return this.entries.find((e=>this._getKey(e)===t))}getUploadEntry(){return g(this),this.entries.find((e=>(0,u.default)(e.mediaKeyTimestamp)))||null}getDownloadEntry(){g(this);const e=this.entries[0];return e&&e.serverStatus!==f?e:null}}},21009:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaObject=void 0,t.consolidate=S,t.getInteractiveMsgMediaType=v,t.webMediaTypeToWamMediaType=function(e){switch(e){case"VIDEO":return 3;case"IMAGE":return 2;case"AUDIO":return 4;case"STICKER":return 16;case"DOCUMENT":return 8;case"PRODUCT":return 18;default:throw new Error(`web media type is invalid: ${e}`)}};var i=n(r(81109)),a=n(r(48926)),o=r(57319),s=r(35470),l=r(15461),c=n(r(28011)),d=r(7293),u=r(34535),p=r(80923),f=r(61596),_=r(58668),h=r(56406),g=(n(r(11339)),n(r(34949))),m=n(r(25224)),y=r(64551),E=r(22104);function S(e,t){const r=e.contentInfo;let n=!1;const i=function(e){switch(e){case _.OUTWARD_TYPES.IMAGE:case _.OUTWARD_TYPES.PRODUCT:return _.TYPE.IMAGE;case _.OUTWARD_TYPES.VIDEO:return _.TYPE.VIDEO;case _.OUTWARD_TYPES.STICKER:return _.TYPE.STICKER;case _.OUTWARD_TYPES.AUDIO:case _.OUTWARD_TYPES.PTT:return _.TYPE.AUDIO;case _.OUTWARD_TYPES.DOCUMENT:default:return}}(t.type,t.subtype);i&&!e.type&&(e.type=i,n=!0);const{downloadStage:a,uploadStage:o}=t;a&&a!==e.downloadStage&&(e.downloadStage=a,n=!0),o&&o!==e.uploadStage&&(e.uploadStage=o,n=!0),t.resolvedPreview&&!r.preview&&(t.resolvedPreview.retain(),r.preview=t.resolvedPreview,n=!0),void 0!==t.progressiveStage&&t.progressiveStage!==e.progressiveStage&&(e.progressiveStage=t.progressiveStage,n=!0);const s=t.mediaBlob;s&&!s.isBlobEqual(e.mediaBlob)&&(e.mediaBlob&&e.clearBlob(),s.retain(),e.mediaBlob=s,e.size=s.size(),n=!0),null!=t.size&&(null==e.size||t.size<e.size)&&(e.size=t.size,n=!0);const{loadedSize:l}=t;null!=l&&l!==e.loadedSize&&(e.loadedSize=l,n=!0),t.filehash&&!e.filehash&&(e.filehash=t.filehash,n=!0),t.parsedVcards&&t.parsedVcards!==e.parsedVcards&&(e.parsedVcards=t.parsedVcards,n=!0);const c=e.contentFields();for(let i=0;i<c.length;i++){const a=c[i];switch(a){case"preview":t.preview&&!r._preview&&(e.runProcessIfNotRunBefore("preview",b,t.preview),r._preview=t.preview,n=!0);break;case"fullWidth":case"fullHeight":case"aspectRatio":{const e=t[a];null!=e&&0!==e&&r[a]!==e&&(r[a]=e,n=!0);break}case"animationDuration":case"singleLoopDuration":{const e=t[a];null!=e&&e!==r[a]&&(r[a]=e,n=!0);break}default:const i=t[a];void 0!==i&&void 0===r[a]&&(r[a]=i,n=!0)}}return null!=r.aspectRatio&&0!==r.aspectRatio||(null!=r.fullWidth&&0!==r.fullWidth&&null!=r.fullHeight&&0!==r.fullHeight?(r.aspectRatio=r.fullWidth/r.fullHeight,n=!0):r.preview&&e.runProcessIfNotRunBefore("aspectRatio",M,r.preview)),n}function v(e){var t;if(null!=(null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType))switch(e.interactiveHeader.mediaType){case u.InteractiveMessageHeaderMediaType.DOCUMENT:return _.OUTWARD_TYPES.DOCUMENT;case u.InteractiveMessageHeaderMediaType.VIDEO:return _.OUTWARD_TYPES.VIDEO;case u.InteractiveMessageHeaderMediaType.IMAGE:return _.OUTWARD_TYPES.IMAGE}}function T(e,t,r){for(let n=0;n<r.length;n++){const i=r[n];e[i]=t[i]}}function C(e,t){return t.filehash?e.id.fromMe&&e.ack<s.ACK.SENT?(e.local||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: unsent media system message not local")),function(e){switch(e.uploadStage){case _.UPLOAD_STAGE.INIT:case _.UPLOAD_STAGE.PREPARING:return _.MEDIA_DATA_STAGE.PREPARING;case _.UPLOAD_STAGE.UPLOADING:return _.MEDIA_DATA_STAGE.UPLOADING;case _.UPLOAD_STAGE.NEED_UPLOAD:return _.MEDIA_DATA_STAGE.NEED_UPLOAD;case _.UPLOAD_STAGE.ERROR_MISSING:return _.MEDIA_DATA_STAGE.ERROR_MISSING;case _.UPLOAD_STAGE.ERROR_TOO_LARGE:return _.MEDIA_DATA_STAGE.ERROR_TOO_LARGE;case _.UPLOAD_STAGE.UPLOADED:return _.MEDIA_DATA_STAGE.SENDING;case _.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE:return _.MEDIA_DATA_STAGE.ERROR_FILE_NOT_READABLE}}(t)):A(t):_.MEDIA_DATA_STAGE.PREPARING}function A(e){switch(e.downloadStage){case _.DOWNLOAD_STAGE.INIT:return _.MEDIA_DATA_STAGE.INIT;case _.DOWNLOAD_STAGE.EXISTS:return _.MEDIA_DATA_STAGE.EXISTS;case _.DOWNLOAD_STAGE.PREPARING:return _.MEDIA_DATA_STAGE.PREPARING;case _.DOWNLOAD_STAGE.REUPLOADING:return _.MEDIA_DATA_STAGE.REUPLOADING;case _.DOWNLOAD_STAGE.FETCHING:return _.MEDIA_DATA_STAGE.FETCHING;case _.DOWNLOAD_STAGE.PROCESSING:return _.MEDIA_DATA_STAGE.DECRYPTING;case _.DOWNLOAD_STAGE.NEED_POKE:return _.MEDIA_DATA_STAGE.NEED_POKE;case _.DOWNLOAD_STAGE.ERROR_MISSING:return _.MEDIA_DATA_STAGE.ERROR_MISSING;case _.DOWNLOAD_STAGE.ERROR_UNSUPPORTED:return _.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED;case _.DOWNLOAD_STAGE.RESOLVED:return _.MEDIA_DATA_STAGE.RESOLVED;case _.DOWNLOAD_STAGE.PROGRESSIVE_READY:return _.MEDIA_DATA_STAGE.PROGRESSIVE_READY}}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e){const t=yield g.default.createFromBase64Jpeg(e);return t.autorelease(),{resolvedPreview:t}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){const{width:t,height:r}=yield(0,h.getImageWidthHeight)(e);return{aspectRatio:t/r}}))).apply(this,arguments)}t.MediaObject=class{constructor(){this._msgs=[],this._notifyTimer=new o.ShiftTimer((()=>{!function(e){const t={};T(t,e,_.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const r=e._msgs,n=r.length;for(let i=0;i<n;i++){const[n,a]=r[i];if(null!=n&&!a){if(n.type!==l.MSG_TYPE.CIPHERTEXT){t.mediaStage=C(n,e);for(let e=0;e<_.MSG_SPECIFIC_FIELDS.length;e++){const r=_.MSG_SPECIFIC_FIELDS[e];t[r]=n.get(_.MEDIA_TO_MSG[r])}t.type===l.MSG_TYPE.INTERACTIVE&&(t.type=v(n))}else{delete t.mediaStage;for(let e=0;e<_.MSG_SPECIFIC_FIELDS.length;e++)delete t[_.MSG_SPECIFIC_FIELDS[e]]}n.mediaData.set(t)}}for(let e=r.length-1;e>=0;e--)r[e][1]&&r.splice(e,1);const i=e._callOnConsolidate;!e._pendingChanges&&i&&(e._callOnConsolidate=null,i.forEach((e=>{e()})));e._saveMedia&&e._saveMedia(e)}(this),function(e){const t={};T(t,e,_.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const r=A(e);e._stickers=e._stickers.filter((e=>{let[t,r]=e;return!r})),e._stickers.forEach((e=>{let[n,a]=e;n.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:r}))})),e._stickerPacks=e._stickerPacks.filter((e=>{let[t,r]=e;return!r})),e._stickerPacks.forEach((e=>{let[n,a]=e;n.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:r}))})),!e._pendingChanges&&e._callOnConsolidate&&(e._callOnConsolidate.forEach((e=>{e()})),e._callOnConsolidate=null);e._saveMedia&&e._saveMedia(e)}(this)})),this._callOnConsolidate=null,this._keyedProcesses=null,this._pendingChangesCount=0,this._saveMedia=null,this._stickers=[],this._stickerPacks=[],this.entries=new p.MediaEntryList,this.downloadStage=_.DOWNLOAD_STAGE.INIT,this.uploadStage=_.UPLOAD_STAGE.INIT,this.userUploadAttemptCount=0,this.userDownloadAttemptCount=0,this.downloadPromise=null,this.uploadPromise=null,this.mediaBlob=null,this.size=void 0,this.loadedSize=void 0,this.filehash=void 0,this.contentInfo={},this.progressiveStage=void 0,this.parsedVcards=null}consolidate(e){return!!S(this,e)&&(this.notifyMsgsAsync(),!0)}clearBlob(){const e=this.mediaBlob;e&&(this.mediaBlob=null,e.autorelease())}contentFields(){const e=this.type||_.TYPE.DOCUMENT;return _.FIELDS[e]}resolveWhenConsolidated(){return this._notifyTimer.ts||this._pendingChanges?new Promise((e=>{this._callOnConsolidate?this._callOnConsolidate.push(e):this._callOnConsolidate=[e]})):Promise.resolve()}notifyMsgsAsync(){this._notifyTimer.debounce(0)}addMsg(e){const t=this._msgs;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-media-msg"))}t.push([e,!1]),this.notifyMsgsAsync()}removeMsg(e){const t=this._msgs;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}hasAssociatedMsgsOrStickers(){const e=this._msgs;for(let t=0;t<e.length;t++)if(!e[t][1])return!0;return this.hasAssociatedStickers()||this.hasAssociatedStickerPacks()}associatedMsgs(){const e=this._msgs,t=[];for(let r=0;r<e.length;r++){const[n,i]=e[r];i||t.push(n)}return t}rmr(e){var t=this;return(0,a.default)((function*(){const n=t.associatedStickers();if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){if(n.length>0&&y.ServerProps.webServerStickerPanel){if(0===t.associatedMsgs().filter((e=>null!=e)).length){return r(49264).RecentStickerCollectionMd.removeAndSave(n.map((e=>e.id))),n.forEach((e=>{e.delete()})),Promise.resolve(200)}}}else{if(n.length>0)return(0,E.rmrSticker)(t.entries,t._stickers,n[0]).then((e=>e.status));const e=t.associatedStickerPacks();if(e.length>0)return(0,E.rmrStickerPack)(t.entries,t._stickerPacks,e[0]).then((e=>e.status))}const[i]=t._msgs.find((e=>{let[t,r]=e;return!r&&!t.isUnsentPhoneMsg()}))||[null];if(i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject with no msg")),!i)return Promise.reject(new Error("rmr called on MediaObject with no msg"));e.onMsgSelect(i);const a=yield(0,m.default)(i);if(200===a.status){const e=i.mediaData.type;if("unknown"===e)return Promise.reject(new Error("rmr called on MediaData with unknown type"));const r=a.isMD?t.entries.updateEntry({deprecatedMms3Url:i.deprecatedMms3Url,encFilehash:i.encFilehash,directPath:a.directPath}):t.entries.addEntry({deprecatedMms3Url:a.url,mediaKey:a.mediaKey||i.mediaKey,mediaKeyTimestamp:a.mediaKeyTimestamp,encFilehash:a.encFilehash,type:e,directPath:a.directPath,debugHint:"rmr"});r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr entry can not be found")),null==r||r.markWhetherOnServer(!0)}return a.status}))()}msgProps(e){const t={};T(t,this,_.FIELDS.RAW),T(t,this.contentInfo,this.contentFields()),T(t,e,_.MSG_SPECIFIC_FIELDS),t.preview=this.contentInfo._preview;const r={};for(const e in t){const n=_.MEDIA_TO_MSG[e];n&&(r[n]=t[e])}return r}delete(){this._saveMedia=null;const{cancelDownloadMedia:e,cancelUploadMedia:t}=r(78986);e(this),t(this),this.clearBlob()}runProcessIfNotRunBefore(e,t,r){let n=this._keyedProcesses;n||(n=this._keyedProcesses={}),n.hasOwnProperty(e)||(this._pendingChangesCount++,n[e]=Promise.resolve(r).then(t).then((e=>{this.consolidate(e)})).finally((()=>{this._pendingChangesCount--,0===this._pendingChangesCount&&this.notifyMsgsAsync()})))}getPendingProcess(e){return 0!==this._pendingChangesCount&&this._keyedProcesses&&this._keyedProcesses.hasOwnProperty(e)?this._keyedProcesses[e]:Promise.resolve()}videoStreamingInfo(e){var t=this;return(0,a.default)((function*(){if(t.type!==_.TYPE.VIDEO)return __LOG__(4,void 0,new Error,!0)`type: ${String(t.type)}`,void SEND_LOGS("media-fault: media streaming info request for non-video type");const r=t.entries.getDownloadEntry();if(!r||!r.sidecar)return null;const[n,a]=yield Promise.all([(0,c.default)(f.MEDIA_TYPES.VIDEO,r.mediaKey),r.url()]);return{cryptoKeys:(0,i.default)((0,i.default)({},n),{},{cipherKey:n.encKey,sidecar:r.sidecar}),streamData:{clientUrl:a,size:t.size,msgKey:e}}}))()}addStickerPack(e){const t=this._stickerPacks;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-pack-add"))}t.push([e,!1]),this.notifyMsgsAsync()}addSticker(e){const t=this._stickers;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-add"))}t.push([e,!1]),this.notifyMsgsAsync()}removeSticker(e){const t=this._stickers;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}removeStickerPack(e){const t=this._stickerPacks;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}hasAssociatedStickers(){return this._stickers.some((e=>{let[t,r]=e;return!r}))}hasAssociatedStickerPacks(){return this._stickerPacks.some((e=>{let[t,r]=e;return!r}))}associatedStickers(){return this._stickers.reduce(((e,t)=>{let[r,n]=t;return n?e:e.concat(r)}),[])}associatedStickerPacks(){return this._stickerPacks.reduce(((e,t)=>{let[r,n]=t;return n?e:e.concat(r)}),[])}toJSON(){return{mediaBlob:this.mediaBlob,size:this.size,filehash:this.filehash,type:this.type,contentInfo:this.contentInfo,downloadStage:this.downloadStage,uploadStage:this.uploadStage}}}},22104:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.rmrSticker=function(){return d.apply(this,arguments)},t.rmrStickerPack=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=n(r(78403)),o=n(r(45095)),s=r(7293),l=r(61596),c=n(r(56891));function d(){return(d=(0,i.default)((function*(e,t,r){if(r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without sticker")),s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield c.default.mediaUpload("sticker",r.id),i=n.sticker;if(200===n.status&&i){const r=0;t.forEach((e=>{let[t,n]=e;n||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrSticker:same-direct-path-after-rmr")),i.mediaKey=(0,o.default)((0,a.default)(i.mediaKey),"sanitizeBase64(nextSticker.mediaKey)"),t.deprecatedMms3Url=i.url,t.filehash=i.filehash,t.width=i.width,t.height=i.height,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=r,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const n=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:r,encFilehash:i.encFilehash,type:l.MEDIA_TYPES.STICKER,directPath:i.directPath,debugHint:"rmrSticker"});n&&n.markWhetherOnServer(!0)}return n}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,r){if(r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without stickerPack")),s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield c.default.mediaUpload("sticker-pack",r.id),i=n.stickerPack;if(200===n.status&&i){const r=0;t.forEach((e=>{let[t,n]=e;n||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrStickerPack:same-direct-path-after-rmr")),t.url=i.url,t.filehash=i.filehash,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=r,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const n=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:r,encFilehash:i.encFilehash,type:l.MEDIA_TYPES.IMAGE,directPath:i.directPath,debugHint:"rmrStickerPack"});n&&n.markWhetherOnServer(!0)}return n}))).apply(this,arguments)}},94995:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(18412),s=r(35470),l=n(r(65212)),c=r(15461),d=n(r(41143)),u=r(35718),p=r(22683),f=r(99234),_=n(r(92360)),h=n(r(46220)),g=r(7293),m=x(r(36638)),y=r(84866),E=n(r(2320)),S=r(45554),v=x(r(88297)),T=r(58668),C=r(61596),A=r(56406),b=n(r(11339)),P=r(9329),M=r(70996),O=n(r(34949)),I=n(r(15554)),w=r(75887),R=r(13705),D=r(64551),N=r(31019),L=r(28080),k=n(r(2603)),G=n(r(74460)),U=r(2541);function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(F=function(e){return e?r:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=F(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function B(e,t){return"product"===t.type?b.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:(0,N.unproxy)(e).isGroup?b.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:b.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL}function K(e){return D.ServerProps.webUploadDocumentThumbMmsEnabled&&e===C.MEDIA_TYPES.DOCUMENT}function j(e,t,n){var o;__LOG__(2)`Media:sendToChat chat ${t.id.toString()}`;const{caption:E,footer:N}=n,L=n.quotedMsg?n.quotedMsg.msgContextInfo(t.id):{},F=(0,f.getMeUser)(),x=n.productMsgOptions||{};let j,Y,W,H;!t.isUser&&g.GK.supportsFeature(g.GK.F.MD_BACKEND)&&(j=F),t.isEphemeralSettingOn()&&(Y=t.getEphemeralSetting());const V=t.getEphemeralSettingTimestamp();null!=V&&(W=V);const $=t.getDisappearingModeInitiator();null!=$&&(H=$);const z=(0,i.default)({t:p.Clock.globalUnixTime(),from:F,isNewMsg:!0,to:t.id,self:"out",type:null!==(o=n.type)&&void 0!==o?o:e._baseType,ack:s.ACK.CLOCK,local:!0,id:new l.default({from:F,to:t.id,id:l.default.newId(),participant:j,selfDir:"out"}),caption:E,footer:N,quotedMsg:L.quotedMsg,quotedParticipant:L.quotedParticipant,quotedStanzaID:L.quotedStanzaID,quotedRemoteJid:L.quotedRemoteJid,mentionedJidList:n.mentionedJidList,isForwarded:n.isForwarded,forwardingScore:n.forwardingScore,multicast:n.multicast,forwardedFromWeb:n.forwardedFromWeb,ctwaContext:n.ctwaContext,ephemeralDuration:Y,ephemeralSettingTimestamp:W,disappearingModeInitiator:H},x),q=e.waitForPrep().then((e=>{const t=e.mediaBlob;return!t||t instanceof O.default?e:O.default.createFromData(t,t.type).then((t=>(e.mediaBlob=t,e)))})).then((e=>{const r=e.filehash;r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: sendToChat filehash undefined"));const i=v.getOrCreateMediaObject(r),a=i.mediaBlob;a&&(a.retain(),e.mediaBlob instanceof O.default&&e.mediaBlob.autorelease(),e.mediaBlob=a),e.mediaBlob instanceof O.default&&(e.renderableUrl=e.mediaBlob.url()),i.consolidate(e.toJSON()),e.mediaBlob instanceof O.default&&e.mediaBlob.autorelease();if((0,A.shouldUseMediaCache)((0,C.castToV4)(i.type))&&e.mediaBlob instanceof O.default){const t=e.mediaBlob.formData();y.MediaBlobCache.put(r,t)}(0,P.downloadMedia)({mimetype:e.mimetype,mediaObject:i,downloadEvenIfExpensive:!0,mediaType:(0,C.msgToMediaType)({type:e.type,isGif:e.isGif}),rmrReason:b.default.WEBC_RMR_REASON_CODE.SEND_TO_CHAT,downloadOrigin:B(t,z),mode:"manual"});const o=i.msgProps(e);return o.caption=E,E||e.type!==T.OUTWARD_TYPES.DOCUMENT||(o.caption=e.filename),D.ServerProps.viewOnceWrite&&n.isViewOnce&&(o.isViewOnce=!0),o}));let J,Q,X;function Z(){return ee.apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e){J=e;const{mediaObject:r}=e;r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: incorrect media object for created msg")),(0,d.default)(r,"msg is missing mediaObject");const n=(0,C.msgToMediaType)(e),a=r.entries.getUploadEntry(),o=a?{key:a.mediaKey,timestamp:a.mediaKeyTimestamp}:(0,I.default)();let{fullPreviewData:s,fullPreviewSize:l}=r.contentInfo,p=e.body;if(K(n)&&!s&&r.contentInfo.preview){const e=yield m.base64ImageToCanvas(r.contentInfo.preview.url()),t=yield(0,u.generateMicroThumb)(e,1300,{mimetype:"image/jpeg",maxAttempts:10});s=r.contentInfo.preview,l={width:t.width,height:t.height},p=U.URL.parseDataURL(t.dataUrl).data}const f=s&&l&&K(n),g=e.safe(),y=s&&f&&g.type===c.MSG_TYPE.DOCUMENT?(0,G.default)({thumbnail:s,mediaKeyInfo:o,mediaType:(0,_.default)(g),uploadOrigin:(0,h.default)(t),forwardedFromWeb:Boolean(e.forwardedFromWeb),isViewOnce:Boolean(e.isViewOnce)}):Promise.resolve(null),E=(0,M.uploadMedia)({mimetype:e.mimetype,mediaObject:r,mediaType:n,forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,h.default)(t),mediaKeyInfo:o,isViewOnce:Boolean(e.isViewOnce)}),{filehash:v}=r;(0,S.shouldUseMediaKeyCache)()&&null!=v&&S.MediaKeyCache.put(v,o);const[{kind:T,mediaEntry:A},b]=yield Promise.all([E,y]),P=null==b?void 0:b.mediaEntry;if(Q=T,!A)throw new Error("upload failed: media entry was not created");(0,S.shouldUseMediaKeyCache)()&&null!=v&&S.MediaKeyCache.delete(v);let O={};if(f){if(!(P&&b&&l)){const e={thumbnailResultEntry:P,uploadThumbnailResult:b,fullPreviewSize:l};throw __LOG__(4,void 0,new Error,!0)`upload failed: thumbnail data incomplete\nDebug info:${JSON.stringify(e)}`,SEND_LOGS("mms-thumbnail-data-incomplete"),new Error("upload failed: thumbnail data incomplete")}O={thumbnailDirectPath:P.directPath,thumbnailSha256:b.filehash,thumbnailEncSha256:P.encFilehash,thumbnailHeight:l.height,thumbnailWidth:l.width}}return(0,k.default)(J,(0,i.default)({deprecatedMms3Url:A.deprecatedMms3Url,directPath:A.directPath,mediaKey:A.mediaKey,mediaKeyTimestamp:A.mediaKeyTimestamp,filehash:r.filehash,encFilehash:A.encFilehash,size:r.size,streamingSidecar:A.sidecar,firstFrameSidecar:A.firstFrameSidecar,body:p},O))}))).apply(this,arguments)}if(n.addEvenWhilePreparing){const e=n.placeholderProps||{};X=(0,w.addAndSendMsgToChat)(t,(0,i.default)((0,i.default)({},e),z),(e=>(J=e,q.then((e=>(0,k.default)(J,e))).then((()=>Z(J))))))[1]}else{const e=q.then((e=>{const t=n.useBasePropsType?z.type:e.type;return(0,i.default)((0,i.default)((0,i.default)({},z),e),{},{type:t})}));X=(0,w.addAndSendMsgToChat)(t,e,Z)[1]}return X.then((e=>({result:e,error:null}))).catch((e=>({result:null,error:e}))).then((e=>{var t,n;let{result:i,error:a}=e;if(i===R.SendMsgResult.OK)return J.type===T.OUTWARD_TYPES.STICKER&&(g.GK.supportsFeature(g.GK.F.MD_BACKEND)?D.ServerProps.webServerStickerPanel&&r(49264).RecentStickerCollectionMd.addStickerWithMediaData(J.mediaData,J.id.toString()):r(91692).RecentStickerCollection.addStickerWithMediaData(J.mediaData)),R.SendMsgResult.OK;const o=null===(t=J)||void 0===t||null===(n=t.mediaObject)||void 0===n?void 0:n.uploadStage;if(J&&(J.ack=s.ACK.FAILED),Q===M.UploadMediaResultKind.CANCELLATION)return __LOG__(2)`Media:sendToChat canceled`,R.SendMsgResult.ERROR_CANCELLED;if(__LOG__(3)`Media:sendToChat error\nresult: ${i}\nuploadStage: ${o}\nuploadResultKind: ${Q}\nerror: ${String(a)}`,null!=o)switch(o){case T.UPLOAD_STAGE.NEED_UPLOAD:case T.UPLOAD_STAGE.ERROR_TOO_LARGE:return R.SendMsgResult.ERROR_UPLOAD;case T.UPLOAD_STAGE.ERROR_MISSING:return R.SendMsgResult.ERROR_EXPIRED}return Q===M.UploadMediaResultKind.ERROR?R.SendMsgResult.ERROR_UPLOAD:null!=i?i:R.SendMsgResult.ERROR_UNKNOWN}))}t.default=class{constructor(e,t){this._baseType=e,this._mediaData=new E.default({mediaStage:T.MEDIA_DATA_STAGE.PREPARING}),this._prepwork=t.then((e=>{if(this._mediaData.set(e),!e.filehash)return e.mediaBlob||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: no hash or blob")),(0,L.getHash)(e.mediaBlob).then((e=>{this._mediaData.filehash=e}))}),(e=>{throw this._mediaData.mediaStage=T.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED,e}))}sendToChat(e,t){return(0,o.promiseCallSync)(j,null,this,e,t)}waitForPrep(){var e=this;return(0,a.default)((function*(){return yield e._prepwork,e._mediaData}))()}}},88297:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.associateMediaWithMsg=function(e,t){e.addMsg(t)},t.associateMediaWithSticker=function(e,t){e.addSticker(t)},t.associateMediaWithStickerPack=function(e,t){e.addStickerPack(t)},t.clearMediaForChat=function(){},t.delistAndDeleteAllMedia=function(){const e=s;s={};for(const t in e)e[t].delete()},t.disassociateMediaFromMsg=function(e,t){if(t.mediaObject=null,e.removeMsg(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete s[r];r&&(0,o.shouldUseLruMediaStore)((0,a.msgToMediaType)(t))&&n.LruMediaStore.del(r);e.delete()},t.disassociateMediaFromSticker=function(e,t){if(t.mediaObject=null,e.removeSticker(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete s[r];r&&n.LruMediaStore.del(r);e.delete()},t.disassociateMediaFromStickerPack=function(e,t){if(t.mediaObject=null,e.removeStickerPack(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete s[r];r&&n.LruMediaStore.del(r);e.delete()},t.getOrCreateMediaObject=function(e){if(s.hasOwnProperty(e))return s[e];return s[e]=new i.MediaObject};var n=r(55975),i=r(21009),a=r(61596),o=r(56406);let s={}},58668:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_STAGE=t.TYPE=t.OUTWARD_TYPES=t.MSG_TO_MEDIA=t.MSG_SPECIFIC_FIELDS=t.MEDIA_TO_MSG=t.MEDIA_MSG_PROPS=t.MEDIA_DATA_STAGE=t.MAPPED_STICKER_PROPS=t.MAPPED_MSG_PROPS=t.MAPPED_MEDIA_PROPS=t.FIELDS=t.DOWNLOAD_STAGE=void 0;const n=Object.freeze({preview:"body",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",fullHeight:"height",fullWidth:"width",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",sidecar:"streamingSidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl"});t.MEDIA_TO_MSG=n;const i=Object.freeze({body:"preview",directPath:"directPath",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",height:"fullHeight",width:"fullWidth",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",streamingSidecar:"sidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl",stickerPackId:"stickerPackId",stickerPackName:"stickerPackName",stickerPackPublisher:"stickerPackPublisher"});t.MSG_TO_MEDIA=i;const a=Object.keys(i);t.MAPPED_MSG_PROPS=a;const o=Object.keys(n);t.MAPPED_MEDIA_PROPS=o;t.MAPPED_STICKER_PROPS=["filehash","height","mimetype","size","type","width","stickerPackId","stickerPackName","stickerPackPublisher"];const s=[...a,"deprecatedMms3Url","encFilehash","streamable"];t.MEDIA_MSG_PROPS=s;const l=Object.freeze({VIDEO:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","duration","durationFloat","isViewOnce","fullPreviewData","staticUrl"]),AUDIO:Object.freeze(["duration","waveform"]),IMAGE:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","isViewOnce","fullPreviewData","staticUrl"]),PRODUCT:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview"]),STICKER:Object.freeze(["animationDuration","singleLoopDuration","emojis","firstFrameLength","firstFrameSidecar","isAnimated","isFirstParty","isFromStickerMaker","stickerPackId","stickerPackName","stickerPackPublisher","fullWidth","fullHeight","preview","rgbaBuffer","rgbaWidth","rgbaHeight","aspectRatio"]),STICKER_PACK:Object.freeze([]),DOCUMENT:Object.freeze(["aspectRatio","pageCount","preview","isVcardOverMmsDocument","parsedVcards","fullPreviewData","fullPreviewSize"]),RAW:Object.freeze(["mediaBlob","size","loadedSize","filehash","progressiveStage"])});t.FIELDS=l;t.MSG_SPECIFIC_FIELDS=["type","filename","caption","isGif","gifAttribution","mimetype","pageCount","sidecar","subtype","isViewOnce"];const c=r(76672).Mirrored(["INIT","EXISTS","PREPARING","REUPLOADING","FETCHING","PROCESSING","NEED_POKE","ERROR_MISSING","ERROR_UNSUPPORTED","PROGRESSIVE_READY","RESOLVED"]);t.DOWNLOAD_STAGE=c;const d=r(76672).Mirrored(["INIT","PREPARING","UPLOADING","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","UPLOADED"]);t.UPLOAD_STAGE=d;const u=r(76672).Mirrored(["INIT","EXISTS","PREPARING","UPLOADING","SENDING","REUPLOADING","FETCHING","DECRYPTING","RESOLVED","NEED_POKE","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","ERROR_UNSUPPORTED","PROGRESSIVE_READY","REMOTE_UPLOADING","REMOTE_NEED_UPLOAD"]);t.MEDIA_DATA_STAGE=u;t.OUTWARD_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",UNKNOWN:"unknown"};const p=Object.freeze({VIDEO:"VIDEO",IMAGE:"IMAGE",AUDIO:"AUDIO",STICKER:"STICKER",DOCUMENT:"DOCUMENT",PRODUCT:"PRODUCT"});t.TYPE=p},71644:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){try{const t=e?JSON.parse(e):i.default,r={};return o(t,r,"",""),r}catch(e){return null}};var i=n(r(47466)),a=r(31515);function o(e,t,r,n){let i=e;if(Array.isArray(i)||(0,a.isString)(i)){(0,a.isString)(i)&&(i=[i]);for(let e=0;e<i.length;e++){const o=i[e];(0,a.isString)(o)&&(t[o]=n+r)}}else if("object"==typeof i)for(const e in i)o(i[e],t,e,n+r)}},43257:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_MIMES=t.MSCFB_MIME=t.MSCFB_HEADER=t.MIMETYPE_DETERMINING_LENGTH=t.MIMETYPES=t.IMAGE_MIMES=t.EXT_TO_MIME=t.DOC_MIMES=t.DOCUMENT_MIMETYPES=void 0,t.getExtension=function(e){const t=u[e];return t?"."+(t.ext||e.split("/")[1]).toLowerCase():""},t.getMediaMimeType=function(e,t){const r=t.subarray(0,262),n=(0,o.default)(r);if(n)return n.mime;if("image"===e)return"image/jpeg";throw new l.MediaEncryptionError("unknown mime decrypt error for type:"+e)},t.isAllowedDocumentMimetype=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(const n in h){const i=u[n];if(null==i)continue;const{signatureMimetype:a,ext:o}=i;if((r?a:n)===e&&o&&(null==t?void 0:t.toLowerCase().endsWith(o.toLowerCase())))return n}if(r)return e;return null!=e?e:"application/octet-stream"},t.isMsCompoundFileBinaryFormat=function(e){return(0,a.default)(e,d)},t.previewType=function(e){const t=u[e];return null==t?void 0:t.previewType};var i=n(r(35937)),a=n(r(63438)),o=n(r(97769)),s=n(r(71644)),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}t.MIMETYPE_DETERMINING_LENGTH=262;const d=new Uint8Array([208,207,17,224,161,177,26,225]);t.MSCFB_HEADER=d;t.MSCFB_MIME="application/x-cfb";const u={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!0},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/rtf"},"text/vcard":{ext:"VCF",msgType:"vcard"},"application/zip":{ext:"ZIP",icon:"icon-doc-generic",msgType:"document"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio",ext:"AAC"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio",ext:"OGG"},"audio/wav":{msgType:"audio",ext:"wav"},"video/mp4":{msgType:"video",ext:"MP4"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"},"image/png":{msgType:"image"}},p=u;t.MIMETYPES=p;const f=(0,i.default)(p,(e=>"document"===(null==e?void 0:e.msgType)));t.DOCUMENT_MIMETYPES=f;t.DOC_MIMES="*";t.IMAGE_MIMES="image/*";t.VIDEO_MIMES="video/mp4,video/3gpp,video/quicktime";const _=(0,s.default)();t.EXT_TO_MIME=_;const h=(0,i.default)(u,(e=>"document"===(null==e?void 0:e.msgType)&&!0===e.canSend&&null!=e.ext))},691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_PROGRESS_THROTTLE_WAIT_MS=void 0;t.FILE_PROGRESS_THROTTLE_WAIT_MS=100},61596:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_TYPE_VALUES=t.MEDIA_TYPES=void 0,t.castToV4=function(e){let t;if(null==e)t=s.DOCUMENT;else{if(!(e in s))throw new Error(`castToV4: unexpected mmsv3 type ${e}`);t=s[e]}return t},t.getMsgMediaType=function(e){return c({type:e.type,interactiveHeader:e.interactiveHeader,isGif:e.type===a.MSG_TYPE.VIDEO&&e.isGif})},t.msgToMediaType=c;var i=n(r(52628)),a=r(15461),o=r(34535);const s=Object.freeze({AUDIO:"audio",DOCUMENT:"document",GIF:"gif",IMAGE:"image",NATIVE_FLOW:"native_flow",PPIC:"ppic",PRODUCT:"product",PTT:"ptt",STICKER:"sticker",VIDEO:"video",TEMPLATE:"template",THUMBNAIL_DOCUMENT:"thumbnail-document",THUMBNAIL_IMAGE:"thumbnail-image",THUMBNAIL_VIDEO:"thumbnail-video",THUMBNAIL_LINK:"thumbnail-link",HISTORY_SYNC:"md-msg-hist",MD_APP_STATE:"md-app-state",PRODUCT_CATALOG_IMAGE:"product-catalog-image",PAYMENT_BG_IMAGE:"payment-bg-image"});t.MEDIA_TYPES=s;const l=(0,i.default)(s);function c(e){let{type:t,isGif:r,interactiveHeader:n}=e;switch(t){case a.MSG_TYPE.IMAGE:return s.IMAGE;case a.MSG_TYPE.VIDEO:return r?s.GIF:s.VIDEO;case a.MSG_TYPE.AUDIO:return s.AUDIO;case a.MSG_TYPE.PTT:return s.PTT;case a.MSG_TYPE.DOCUMENT:return s.DOCUMENT;case a.MSG_TYPE.STICKER:return s.STICKER;case a.MSG_TYPE.PRODUCT:return s.PRODUCT;case a.MSG_TYPE.NATIVE_FLOW:return s.NATIVE_FLOW;case a.MSG_TYPE.INTERACTIVE:if(null!=(null==n?void 0:n.mediaType))switch(n.mediaType){case o.InteractiveMessageHeaderMediaType.DOCUMENT:return s.DOCUMENT;case o.InteractiveMessageHeaderMediaType.VIDEO:return s.VIDEO;case o.InteractiveMessageHeaderMediaType.IMAGE:return s.IMAGE}}throw new Error(`msg is not a media msg: ${t}, isGif=${String(r)}`)}t.MEDIA_TYPE_VALUES=l},22283:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.default=r},18309:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,n.sha256Base64)(e)};var n=r(73045)},7407:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const a=16*Math.ceil(e/16),o=t.slice(0,i.IV_LENGTH+a);return(0,n.hmacSha256)(r,o,i.HMAC_LENGTH)};var n=r(11141),i=r(71940)},71940:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.IV_LENGTH=t.HMAC_LENGTH=void 0,t.calculateStreamingSidecar=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(98913)),o=r(32428),s=r(11141);const l=65536;t.IV_LENGTH=16;function c(){return(c=(0,i.default)((function*(e,t){const r=e instanceof ArrayBuffer?e.byteLength:e.buffer.byteLength,n=Math.ceil((r-16)/l),i=(0,a.default)(n,(r=>{const n=r*l,i=e.slice(n,n+16+l);return(0,s.hmacSha256)(t,i,10)})),c=yield Promise.all(i);return(0,o.concatArrayBuffers)(...c)}))).apply(this,arguments)}t.HMAC_LENGTH=10},28011:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(81576),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(61596);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function d(){return(d=(0,i.default)((function*(e,t){const r=u(e);let n;try{n=(0,a.decodeB64)(t)}catch(e){}if(!t||!r||!n)throw new s.MediaEncryptionError(`createKeys fail: !!mediakey: ${!!t} info: ${r} type: ${e}`);const i=yield(0,o.extractAndExpand)(n,r,112);if(!i||i.byteLength<112)throw new s.MediaEncryptionError("computeMediaKeys: hkdf error");return{iv:i.slice(0,16),encKey:i.slice(16,48),macKey:i.slice(48,80),refKey:i.slice(80,112)}}))).apply(this,arguments)}function u(e){switch(e){case l.MEDIA_TYPES.AUDIO:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.DOCUMENT:return"WhatsApp Document Keys";case l.MEDIA_TYPES.GIF:return"WhatsApp Video Keys";case l.MEDIA_TYPES.IMAGE:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PPIC:throw new Error("Cannot create media keys for profile pics");case l.MEDIA_TYPES.PRODUCT:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PTT:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.STICKER:return"WhatsApp Image Keys";case l.MEDIA_TYPES.VIDEO:return"WhatsApp Video Keys";case l.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return"WhatsApp Document Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_IMAGE:return"WhatsApp Image Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_VIDEO:return"WhatsApp Video Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_LINK:return"WhatsApp Link Thumbnail Keys";case l.MEDIA_TYPES.TEMPLATE:throw new Error("Cannot create media keys for template");case l.MEDIA_TYPES.HISTORY_SYNC:return"WhatsApp History Keys";case l.MEDIA_TYPES.MD_APP_STATE:return"WhatsApp App State Keys";case l.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE:throw new Error("Cannot create media keys for product catalog image");case l.MEDIA_TYPES.PAYMENT_BG_IMAGE:return"WhatsApp Payment Background Keys"}}},74994:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(95024),o=r(81484),s=r(11141),l=r(46269),c=r(60977),d=n(r(18309)),u=r(64103),p=r(23125);const f=10;function _(){return(_=(0,i.default)((function*(e){let{mediaKeys:t,ciphertextHmac:r,expectedPlaintextHash:n,debugString:_}=e;if(yield Promise.resolve(),__LOG__(2)`decryptMedia: [${_}] start`,r.byteLength<f)throw new u.MediaDecryptionError(`ciphertext too short: ${r.byteLength}`);const{iv:h,encKey:g,macKey:m}=t,y=(0,l.castTypedArrays)(Uint8Array,r);try{return yield(0,s.hmacSha256)(m,(0,c.concatTypedArrays)(Uint8Array,[new Uint8Array(h),(0,p.isPerformanceExperimentEnabled)()?y.subarray(0,-10):y.slice(0,-10)]),f).then((e=>{const t=y.buffer.slice(-10);if(!(0,a.arrayBuffersDeepEqual)(e,t))throw new u.MediaDecryptionError("decryptMedia: hmac mismatch");return(0,o.aesCbcDecrypt)(g,h,y.subarray(0,-10))})).then(function(){var e=(0,i.default)((function*(e){if(null==n)return e;if((yield(0,d.default)(e))!==n)throw new u.MediaDecryptionError("decryptMedia: plaintext hash mismatch");return __LOG__(2)`decryptMedia: [${_}] success`,e}));return function(){return e.apply(this,arguments)}}())}catch(e){if(__LOG__(3)`decryptMedia: [${_}] error`,e instanceof u.MediaDecryptionError)throw e;throw new u.MediaDecryptionError(`decryption error: ${String(e)}; stack: ${e.stack}`)}}))).apply(this,arguments)}},80733:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPartialMedia=t.decrypt=t.cleanupCiphertextAndIv=t.HMAC_SIZE=t.BLOCK_SIZE=void 0;var i=n(r(48926)),a=r(60977);t.BLOCK_SIZE=16;t.HMAC_SIZE=10;const o=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,iv:r,mediaKeys:n}=e,{encKey:i}=n;try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(i),"AES-CBC",!1,["decrypt"]).catch((e=>{throw __LOG__(2)`decryptPartialMedia:decrypt importKey error: ${String(e)}`,e}));return self.crypto.subtle.decrypt({name:"AES-CBC",iv:r},e,t)}catch(e){throw __LOG__(2)`decryptPartialMedia:decrypt decrypt error: ${String(e)}`,e}}));return function(){return e.apply(this,arguments)}}();t.decrypt=o;const s=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,mediaKeys:r}=e,{encKey:n}=r,i={name:"AES-CBC",iv:(t instanceof Uint8Array?t:new Uint8Array(t)).slice(-16)};try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(n),"AES-CBC",!1,["encrypt"]).catch((e=>{__LOG__(2)`decryptPartialMedia:getEncryptedPadding importKey error: ${String(e)}`})),t=new Uint8Array([]);return self.crypto.subtle.encrypt(i,e,t)}catch(e){return void __LOG__(2)`decryptPartialMedia:getEncryptedPadding encrypt error: ${String(e)}`}}));return function(){return e.apply(this,arguments)}}(),l=e=>{const{serverRangeStart:t,ciphertext:r,mediaKeys:n}=e;let i=r instanceof Uint8Array?r:new Uint8Array(r);const o=i.byteLength%16==0;let l;return 0===t?l=new Uint8Array(n.iv):(l=i.slice(0,16),i=i.slice(16)),o||(i=i.slice(0,i.byteLength-10)),o?s({ciphertext:i,mediaKeys:n}).then((e=>(i=(0,a.concatTypedArrays)(Uint8Array,[i,new Uint8Array(e)]),{ciphertext:i,iv:l}))):Promise.resolve({ciphertext:i,iv:l})};t.cleanupCiphertextAndIv=l;const c=function(){var e=(0,i.default)((function*(e){let{mediaKeys:t,ciphertext:r}=e;const{ciphertext:n,iv:i}=yield l({serverRangeStart:0,ciphertext:r,mediaKeys:t});return o({ciphertext:n,iv:i,mediaKeys:t})}));return function(){return e.apply(this,arguments)}}();t.decryptPartialMedia=c},83899:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{mediaKey:t,plaintext:r,type:n}=e;return new Promise(((e,i)=>{if(t.slice(0,10),__LOG__(2)`encryptMedia: start`,!n)throw new _.MediaEncryptionError('encryptMedia: missing "type"');if(!t)throw new _.MediaEncryptionError('encryptMedia: missing "mediaKey"');(0,f.default)(n,t).then((e=>(0,m.isPerformanceExperimentEnabled)()?function(){return v.apply(this,arguments)}(r,n,e):function(){return y.apply(this,arguments)}(r,n,e))).then((t=>{__LOG__(2)`encryptMedia: success`,e(t)})).catch((e=>{if(__LOG__(3)`encryptMedia: error`,e instanceof _.MediaEncryptionError)throw e;throw new _.MediaEncryptionError(`encryption error: ${String(e)}; stack: ${e.stack}`)})).catch(i)}))};var i=n(r(48926)),a=r(32428),o=r(81484),s=r(11141),l=r(67602),c=r(60977),d=n(r(18309)),u=n(r(7407)),p=r(71940),f=n(r(28011)),_=r(64103),h=r(61596),g=r(92108),m=r(23125);function y(){return(y=(0,i.default)((function*(e,t,r){let{iv:n,encKey:i,macKey:c}=r;const f=yield(0,o.aesCbcEncrypt)(i,e,n),_=f.slice(n.byteLength),m=yield(0,s.hmacSha256)(c,f,10);let y=Promise.resolve();if(t===h.MEDIA_TYPES.VIDEO||t===h.MEDIA_TYPES.AUDIO){const e=(0,a.concatArrayBuffers)(f,m);y=(0,p.calculateStreamingSidecar)(e,c)}let E=Promise.resolve();if(t===h.MEDIA_TYPES.STICKER){const{firstFrameLength:t}=(0,g.parseWebp)(e);if(null!=t){const e=(0,a.concatArrayBuffers)(f,m);E=(0,u.default)(t,e,c)}}const S=(0,a.concatArrayBuffers)(_,m);return(0,l.promiseProps)({ciphertextHmac:S,hash:(0,d.default)(S),sidecar:y,firstFrameSidecar:E})}))).apply(this,arguments)}function E(e){let{ivCiphertext:t,signature:r,macKey:n}=e;const i=(0,a.concatArrayBuffers)(t,r);return{sidecar:(0,p.calculateStreamingSidecar)(i,n),firstFrameSidecar:Promise.resolve()}}const S=new Map([[h.MEDIA_TYPES.VIDEO,E],[h.MEDIA_TYPES.AUDIO,E],[h.MEDIA_TYPES.STICKER,function(e){let{plaintext:t,ivCiphertext:r,signature:n,macKey:i}=e;const{firstFrameLength:o}=(0,g.parseWebp)(t);return{sidecar:Promise.resolve(),firstFrameSidecar:null!=o?(0,u.default)(o,(0,a.concatArrayBuffers)(r,n),i):Promise.resolve()}}]]);function v(){return(v=(0,i.default)((function*(e,t,r){var n,i;let{iv:a,encKey:u,macKey:p}=r;const f=(0,m.shouldEncryptInChunks)(e.byteLength)?yield(0,o.aesCbcEncryptWithChunking)(u,e,a):yield(0,o.aesCbcEncrypt)(u,e,a),_=new Uint8Array(f).subarray(a.byteLength),h=yield(0,s.hmacSha256)(p,f,10),{sidecar:g=Promise.resolve(),firstFrameSidecar:y=Promise.resolve()}=null!==(n=null===(i=S.get(t))||void 0===i?void 0:i({plaintext:e,ivCiphertext:f,signature:h,macKey:p}))&&void 0!==n?n:{},E=(0,c.concatTypedArrays)(Uint8Array,[_,new Uint8Array(h)]).buffer;return(0,l.promiseProps)({ciphertextHmac:E,hash:(0,d.default)(E),sidecar:g,firstFrameSidecar:y})}))).apply(this,arguments)}},27126:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStreamer=t.EOI_TAG=void 0,t.getProgressiveMediaCacheKey=E;var i=n(r(48926)),a=r(71610),o=r(76100),s=r(95024),l=r(81484),c=r(11141),d=r(40265),u=r(60977),p=r(69830),f=r(84866);class _ extends((0,d.customError)("ChunkValidationError")){constructor(e){super(`Chunk ${e} does not match sidecar`)}}const h=16,g=new Uint8Array([2,2]),m=new Uint8Array([255,217]);t.EOI_TAG=m;function y(){return(y=(0,i.default)((function*(e,t){const{encKey:r}=t;return(yield(0,l.aesCbcEncrypt)(r,g,new Uint8Array(e.slice(-16)))).slice(-16)}))).apply(this,arguments)}function E(e,t){return`${e}-progressive-${t}`}t.ImageStreamer=class{constructor(e){this._alignedScanLengths=[],this._increasingScanLengths=[],this._lastDecryptedChunk=0,this._downloadedBytes=new ArrayBuffer(0);const{cryptoKeys:t,scanLengths:r,scansSidecar:n,filehash:i,mimetype:a,debugString:o,onProgressiveUpdate:s}=e;this._cryptoKeys=t,this._scanLengths=r,this._scansSideCar=n,this._filehash=i,this._mimetype=a,this._nextChunkIV=this._cryptoKeys.iv,this._decryptedChunks=new Array(r.length),this._onProgressiveUpdate=s,this._debugString=o}_validateSidecar(e,t){var r=this;return(0,i.default)((function*(){0===t&&(r._nextChunkIV=r._cryptoKeys.iv);const{macKey:n}=r._cryptoKeys,i=r._scansSideCar.slice(10*t,10*t+10),a=r._nextChunkIV;r._nextChunkIV=e.slice(-16);const o=(0,u.concatTypedArrays)(Uint8Array,[new Uint8Array(a),new Uint8Array(e)]),l=yield(0,c.hmacSha256)(n,o,10);if(!(0,s.arrayBuffersDeepEqual)(l,i))throw new _(t)}))()}_cleanupCipherTextAndIV(e,t){var r=this;return(0,i.default)((function*(){let n=e;const i=n.byteLength%h==0;let a;if(0===t)a=r._cryptoKeys.iv;else{const e=r._increasingScanLengths[t-1];a=r._downloadedBytes.slice(e-h,e)}if(i||(n=n.slice(0,n.byteLength-10)),i){const e=yield function(){return y.apply(this,arguments)}(n,r._cryptoKeys);return{cipherText:(0,u.concatTypedArrays)(Uint8Array,[new Uint8Array(n),new Uint8Array(e)]),iv:a}}return{cipherText:n,iv:a}}))()}_getLastFullyLoadedChunkIndex(e){let t=0;for(let r=0;r<this._alignedScanLengths.length;r++)if(t+=this._alignedScanLengths[r],e<t)return r;return this._alignedScanLengths.length}_handleChunk(e,t){var r=this;return(0,i.default)((function*(){yield r._validateSidecar(e,t);const{cipherText:n,iv:i}=yield r._cleanupCipherTextAndIV(e,t),a=yield(0,l.aesCbcDecrypt)(r._cryptoKeys.encKey,i,n),o=yield(0,p.removeEncryptedPadding)(a,g.buffer);return __LOG__(2)`ImageStreamer: [${r._debugString}] Successfully decrypted chunk ${t} of ${r._scanLengths.length} total`,o}))()}_generateBlobFromFullyLoadedChunks(e){var t=this;return(0,i.default)((function*(){var r;const n=yield Promise.all(t._decryptedChunks.slice(0,e)),i=t._scanLengths.slice(0,e).reduce(((e,t)=>e+t),0),a=(0,u.concatTypedArrays)(Uint8Array,n.map((e=>new Uint8Array(e)))).slice(0,i),o=(0,s.arrayBuffersDeepEqual)(m.buffer,a.slice(-m.length).buffer)?a:(0,u.concatTypedArrays)(Uint8Array,[a,m]),l=[o],c=t._mimetype?new Blob(l,{type:t._mimetype}):new Blob(l),d=E(t._filehash,e);return f.MediaBlobCache.put(d,c),__LOG__(2)`ImageStreamer: [${t._debugString}] Generated progressive image using ${e} chunks of ${t._scanLengths.length} total`,null===(r=t._onProgressiveUpdate)||void 0===r||r.call(t,e),t._lastDecryptedChunk=e,o.buffer}))()}_decryptFullyLoadedChunks(e,t){var r=this;return(0,i.default)((function*(){for(let n=0;n<t;n++)if(!r._decryptedChunks[n]){const t=0===n?0:r._increasingScanLengths[n-1],i=e.slice(t,t+r._alignedScanLengths[n]);yield Promise.all(r._decryptedChunks),r._decryptedChunks[n]||(r._decryptedChunks[n]=r._handleChunk(i,n))}}))()}handleProgress(e,t){var r=this;return(0,i.default)((function*(){if(!r._alignedScanLengths.length){r._alignedScanLengths=(0,a.alignChunkLengthsToMultipleOfAesBlockSize)(r._scanLengths,e);for(let e=0;e<r._alignedScanLengths.length;e++){const t=r._alignedScanLengths[e],n=0===e?t:r._increasingScanLengths[e-1]+t;r._increasingScanLengths.push(n)}}const n="string"==typeof t?t.length:t.byteLength,i=r._getLastFullyLoadedChunkIndex(n);if(i<=r._lastDecryptedChunk)return null;try{const e="string"==typeof t?yield(0,o.largeStringToArrayBuffer)(t):t;return r._downloadedBytes=e,yield r._decryptFullyLoadedChunks(r._downloadedBytes,i),yield r._generateBlobFromFullyLoadedChunks(i)}catch(e){__LOG__(3)`ImageStreamer:handleProgress error: ${e}`;const t=`${e.message}, [${r._debugString}]scanLengths length: ${r._scanLengths.length}, scansSidecar byteLength: ${r._scansSideCar.byteLength}.`;e instanceof _?(__LOG__(2)`ImageStreamer:chunk validation error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:chunk validation error`,SEND_LOGS("ImageStreamer:chunk validation error")):(__LOG__(2)`ImageStreamer:handleProgress error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:handleProgress error`,SEND_LOGS("ImageStreamer:handleProgress error"))}}))()}}},15554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),{key:(0,n.encodeB64)(e),timestamp:i.Clock.globalUnixTime()}};var n=r(15688),i=r(22683)},95987:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const r=(0,a.generateMediaEventId)(),n=new o.default.MediaDownload2({mediaId:r,connectionType:o.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e.type),overallMmsVersion:4,networkStack:o.default.NETWORK_STACK_TYPE.NATIVE,overallDownloadMode:(0,a.getMetricOverallDownloadModeType)(e.type),overallAttemptCount:e.userDownloadAttemptCount,overallDownloadOrigin:e.downloadOrigin,overallBackendStore:null!==(t=(0,a.getMetricBackendStore)(e.directPath))&&void 0!==t?t:void 0,isViewOnce:e.isViewOnce});return i.downloadUploadCrashLogger.mark(r,i.ProgressType.DOWNLOAD_STARTED),{mediaId:r,handleDownloadSuccess:e=>{n.set({overallMediaSize:e,overallDownloadResult:o.default.MEDIA_DOWNLOAD_RESULT_TYPE.OK,overallIsFinal:!0,downloadHttpCode:200}),i.downloadUploadCrashLogger.mark(r,i.ProgressType.DOWNLOAD_FINISHED,{overallMediaSize:e})},handleDownloadHostFound:e=>{let{hostName:t,hostClass:r,failCount:i}=e;n.set({overallDomain:t,overallConnectionClass:r,overallRetryCount:i})},handleDownloadError:(e,t)=>{n.set({overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(e),overallIsFinal:t});const r=(0,a.getStatusCode)(e);null!=r&&(n.downloadHttpCode=r),n.markOverallCumT(),n.commit(),(0,a.logErrorUnknownDetails)(n,e)},handleDownloadAttemptSuccess:e=>{n.set({overallT:e})},handleDownloadAttemptError:e=>{let{err:t,overallT:r,failCount:i}=e;const s=new o.default.MediaDownload2(n);s.set({mediaId:(0,a.generateMediaEventId)(),overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(t),overallIsFinal:!1,overallT:r,overallRetryCount:i});const l=(0,a.getStatusCode)(t);null!=l&&(n.downloadHttpCode=l),n.markOverallCumT(),s.commit(),(0,a.logErrorUnknownDetails)(s,t)},handleDownloadAndDecryptSuccess:()=>{n.markOverallCumT(),n.commit()},markDecryptionEnd:()=>{n.markOverallDecryptT()},markDecryptionStart:()=>{n.startOverallDecryptT()}}};var i=r(22200),a=r(29992),o=n(r(11339))},47235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadAndDecryptCache=void 0,t.getLRUStoreKey=l;var i=n(r(48926)),a=r(55975),o=r(56406),s=n(r(28245));function l(e){var t,r;const n=null===(t=e.progressiveJpegOpts)||void 0===t?void 0:t.scanCount,i=null===(r=e.progressiveJpegOpts)||void 0===r?void 0:r.scanLengths;if(null!=n&&i)return`${e.filehash}-${n}/${i.length}-scans`;if(e.partialVideoOpts){const{secondsToDownload:t}=e.partialVideoOpts;return`${e.filehash}-${t}-seconds`}return e.filehash}t.DownloadAndDecryptCache=class{get(e,t){return(0,i.default)((function*(){if(!(0,o.shouldUseLruMediaStore)(t.type))return null;try{return yield a.LruMediaStore.get(l(t))}catch(e){return __LOG__(3,!0)`downloadManager.asyncCache.get error:\n${(0,s.default)(e)}`,null}}))()}set(e,t,r){return(0,i.default)((function*(){if((0,o.shouldUseLruMediaStore)(r.type))try{yield a.LruMediaStore.put(l(r),t)}catch(e){__LOG__(3,!0)`downloadManager.asyncCache.set error:\n${(0,s.default)(e)}`}}))()}}},26384:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadManager=void 0;var a=i(r(81109)),o=i(r(48926)),s=i(r(30844)),l=i(r(45095)),c=i(r(67643)),d=i(r(95987)),u=i(r(28011)),p=i(r(74994)),f=r(80733),_=r(47235),h=r(22200),g=r(37115),m=i(r(56747)),y=r(27126),E=r(21009),S=r(61596),v=r(58668),T=i(r(58596)),C=i(r(11339)),A=i(r(39436)),b=r(47524),P=i(r(28245));const M=1,O=2,I=e=>{switch(e){case S.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return O;case S.MEDIA_TYPES.VIDEO:default:return M}};function w(){return R.apply(this,arguments)}function R(){return(R=(0,o.default)((function*(e){const{directPath:t,encFilehash:r,filehash:i,mediaKey:a,onDecryptStart:o,downloadOrigin:s,staticUrl:c,type:_,mode:E,progressiveJpegOpts:S,partialVideoOpts:v,onProgress:T,userDownloadAttemptCount:C,isViewOnce:b}=e,{handleDownloadSuccess:M,handleDownloadHostFound:O,handleDownloadError:I,handleDownloadAttemptSuccess:w,handleDownloadAttemptError:R,handleDownloadAndDecryptSuccess:D,markDecryptionStart:N,markDecryptionEnd:L,mediaId:k}=(0,d.default)({directPath:t,downloadOrigin:s,type:_,userDownloadAttemptCount:C,isViewOnce:b}),U=e.signal||(new n).signal,F=i.slice(0,10);__LOG__(2)`downloadManager.download: [${F}] start`;try{const e=null==S?void 0:S.scanCount,n=null!=e&&e===(null==S?void 0:S.scanLengths.length)?null:e;let s=null;const d=(0,m.default)({partialVideoOpts:v,progressiveJpegOpts:S,scanCount:n}),g=null==n&&S?(e,t)=>{var r;null===(r=s)||void 0===r||r.handleProgress(e.total,t)}:null,[C,b,P]=yield Promise.all([(0,u.default)(_,a).then((e=>(S&&(s=new y.ImageStreamer({cryptoKeys:e,scanLengths:S.scanLengths,scansSidecar:S.scansSidecar,mimetype:S.mimetype,filehash:i,debugString:F,onProgressiveUpdate:S.onProgressiveUpdate})),e))),G({scanCount:n,directPath:t,encFilehash:r,type:_,signal:U}),A.default.download({directPath:t,encFilehash:r,staticUrl:c,type:_,signal:U,mode:E,byteRange:d,onResponseText:g,onDownloadHostFound:O,onDownloadAttemptSuccess:w,onDownloadAttemptError:R,debugString:F,onProgress:T})]);let I;var x;if(o&&o(),M(P.byteLength),h.downloadUploadCrashLogger.mark(k,h.ProgressType.DOWNLOAD_DECRYPTION_STARTED),N(),null!=n)I=(0,l.default)(yield null===(x=s)||void 0===x?void 0:x.handleProgress(b,P),"yield imageStreamer?.handleProgress(encryptedFileSize, ciphertextHmac)");else I=v?yield(0,f.decryptPartialMedia)({mediaKeys:C,ciphertext:P}):yield(0,p.default)({mediaKeys:C,ciphertextHmac:P,expectedPlaintextHash:i,debugString:F});return L(),h.downloadUploadCrashLogger.mark(k,h.ProgressType.DOWNLOAD_DECRYPTION_FINISHED),__LOG__(2)`downloadManager.download: [${F}] success`,D(),I}catch(t){throw t instanceof g.MediaNotFoundError?(I(t,Boolean(e.isFinalRmrRetry)),__LOG__(2,!0)`downloadManager.download: [${F}] expected error\n${(0,P.default)(t)}`):(I(t,!0),__LOG__(3,!0)`downloadManager.download: [${F}] error\n${(0,P.default)(t)}`),h.downloadUploadCrashLogger.mark(k,h.ProgressType.DOWNLOAD_ERROR),t}}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,o.default)((function*(e){var t,r;const{mediaObject:n}=e,i=null!==(t=null===(r=n.filehash)||void 0===r?void 0:r.slice(0,10))&&void 0!==t?t:"";n.filehash,n.type,__LOG__(2)`downloadManager.rmr: [${i}] start`,n.consolidate({downloadStage:v.DOWNLOAD_STAGE.REUPLOADING});const o=performance.now(),s=new C.default.WebcMediaRmr((0,a.default)((0,a.default)({},e.rmrData),{},{webcRmrReason:e.rmrReason})),l=(0,b.getEffectiveNetworkType)();null!=l&&(s.webcBrowserNetworkType=l),n.type&&(s.messageMediaType=(0,E.webMediaTypeToWamMediaType)(n.type)),null!=n.size&&(s.webcMediaSize=n.size);try{const e=yield n.rmr({onMsgSelect:function(e){null==s.webcChatType&&e.chat&&(s.webcChatType=e.chat.getWebcChatType()),null==s.webcMessageT&&(s.webcMessageT=e.t),s.messageMediaType=e.getWamMediaType()}});if(s.webcRmrStatusCode=e,__LOG__(2)`downloadManager.rmr: [${i}] status ${e}`,404===e)throw new g.MediaNotOnPhone;if(200!==e)throw new g.ServerStatusCodeError(e)}catch(e){throw s.webcMediaRmrError=!0,e instanceof g.MediaNotOnPhone?(__LOG__(2,!0)`downloadManager.rmr: [${i}] error MediaNotOnPhone\n${(0,P.default)(e)}`,e):(__LOG__(3,!0)`downloadManager.rmr: [${i}] error ${e.status||e.message}\n${e.stack}`,new g.MediaNeedsReupload)}finally{s.webcMediaRmrT=Math.ceil(performance.now()-o),s.commit()}}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,o.default)((function*(e){const{directPath:t,encFilehash:r,signal:i,type:a}=e;yield A.default.checkExistence({directPath:t,encFilehash:r,type:a,signal:i||(new n).signal})}))).apply(this,arguments)}function G(e){const{scanCount:t,directPath:r,encFilehash:n,type:i,signal:a}=e;return null==t?Promise.resolve(null):A.default.getEncryptedMediaSize({directPath:(0,l.default)(r,"directPath is required for partial downloads"),encFilehash:(0,l.default)(n,"encFilehash is required for partial downloads"),signal:a,type:i})}const U=new class{constructor(){this.preloader=new s.default(10,{thumbnail:4}),this.downloadAndDecrypt=(0,c.default)((e=>(0,_.getLRUStoreKey)(e)),new _.DownloadAndDecryptCache,(e=>!0===e.isPreload?this.preloader.enqueue((()=>w(e)),{priority:-I(e.type),group:"thumbnail",signal:e.signal}):w(e))),this.rmr=(0,T.default)((e=>e.mediaObject.filehash||""),D),this.checkExistence=(0,T.default)((e=>e.encFilehash),L),h.downloadUploadCrashLogger.init()}};t.downloadManager=U},37115:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return i.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return i.HttpStatusCodeError}}),Object.defineProperty(t,"LogoutDrop",{enumerable:!0,get:function(){return n.LogoutDrop}}),Object.defineProperty(t,"MMSForbiddenError",{enumerable:!0,get:function(){return i.MMSForbiddenError}}),Object.defineProperty(t,"MMSThrottleError",{enumerable:!0,get:function(){return i.MMSThrottleError}}),Object.defineProperty(t,"MMSUnauthorizedError",{enumerable:!0,get:function(){return i.MMSUnauthorizedError}}),Object.defineProperty(t,"MediaDecryptionError",{enumerable:!0,get:function(){return a.MediaDecryptionError}}),Object.defineProperty(t,"MediaNeedsReupload",{enumerable:!0,get:function(){return a.MediaNeedsReupload}}),Object.defineProperty(t,"MediaNotFoundError",{enumerable:!0,get:function(){return i.MediaNotFoundError}}),t.MediaNotOnPhone=void 0,Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return o.NoMediaHostsError}}),Object.defineProperty(t,"ServerStatusCodeError",{enumerable:!0,get:function(){return n.ServerStatusCodeError}}),Object.defineProperty(t,"WebdDrop",{enumerable:!0,get:function(){return n.WebdDrop}});var n=r(77591),i=r(27856),a=r(64103),o=r(40859);class s extends n.ServerStatusCodeError{constructor(){super(404),this.name="MediaNotOnPhone"}}t.MediaNotOnPhone=s},56747:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{partialVideoOpts:t,progressiveJpegOpts:r,scanCount:a}=e;if(r&&null!=a)return{start:0,end:(0,n.alignChunkLengthsToMultipleOfAesBlockSize)(r.scanLengths).slice(0,a).reduce(((e,t)=>e+t),0)};if(t){const{video:{size:e,duration:r},secondsToDownload:n}=t,a=Math.max(e*n/r,131072);return{start:0,end:Math.ceil(a/i.BLOCK_SIZE)*i.BLOCK_SIZE-1}}return null};var n=r(71610),i=r(80733)},40859:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),t.NoMediaHostsError=void 0;var n=r(40265),i=r(89385);class a extends((0,n.customError)("NoMediaHostsError")){}t.NoMediaHostsError=a},46640:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={mediaHosts:!0};Object.defineProperty(t,"mediaHosts",{enumerable:!0,get:function(){return i.mediaHosts}});var i=r(82828);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},51320:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THRESHOLD=void 0,t.maybeSwitchHost=function(e,t,r,o){let{selectedHost:s,fallbackHost:l}=t,{selectedHost:c,fallbackHost:d}=r;if(o<i)return{changed:!1,host:e};switch(e.type){case n.HOST_TYPE.PRIMARY:if(!e.equals(c))return{changed:!0,host:c};break;case n.HOST_TYPE.FALLBACK:if(!s.equals(c))return{changed:!0,host:c};if(a(e,l,d)||a(e,s.fallback,c.fallback))return{changed:!0,host:s}}return{changed:!1,host:e}};var n=r(17930);const i=52428800;function a(e,t,r){return e.equals(t)&&null!=r&&null!=t&&!t.equals(r)}t.THRESHOLD=i},17930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHost=t.HOST_TYPE=void 0;var i=n(r(81109)),a=r(61596);const o=new Set(a.MEDIA_TYPE_VALUES),s=Object.freeze({PRIMARY:"primary",FALLBACK:"fallback"});t.HOST_TYPE=s;class l{constructor(e){this.hostname=e.hostname,this.ips=e.ips||[],this.type=e.type,this.class=e.class;const{downloadBuckets:t,supportedDownloadTypes:r,supportedUploadTypes:n}=function(e){var t,r;const n=e||[];let i,a,s;for(const e of n){if(e.download){var l;i=null!==(l=i)&&void 0!==l?l:new Set;for(const t of e.download)i.add(t)}if(e.upload){var c;a=null!==(c=a)&&void 0!==c?c:new Set;for(const t of e.upload)a.add(t)}e.downloadBuckets&&(s=e.downloadBuckets.map((e=>parseInt(e,10))))}return{supportedDownloadTypes:null!==(t=i)&&void 0!==t?t:o,supportedUploadTypes:null!==(r=a)&&void 0!==r?r:o,downloadBuckets:s}}(e.rules);this.downloadBuckets=t,this._supportedDownloadTypes=r,this._supportedUploadTypes=n,this.fallback=null!=e.fallback?new l((0,i.default)((0,i.default)((0,i.default)({},e),e.fallback),{},{type:"fallback",fallback:void 0})):null}equals(e){return this.hostname===(null==e?void 0:e.hostname)}isFallback(){return this.type===s.FALLBACK}supportsDownloadMediaType(e){return this._supportedDownloadTypes.has(e)}supportsUploadMediaType(e){const t="product-catalog-image"===e?"product":e;return this._supportedUploadTypes.has(t)}}t.MediaHost=l},82828:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mediaHosts=t.FETCH_STATE=void 0;var a=i(r(6479)),o=i(r(48926)),s=r(89385),l=r(40859),c=r(17930),d=i(r(58596)),u=r(97237),p=r(80469),f=r(70426),_=r(77591);const h=["forceRefresh"],g=["name","message","stack"];t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};const m=new class{constructor(){var e=this;this._locked=!1,this._fetch=(0,d.default)((()=>"all"),function(){var t=(0,o.default)((function*(t){let{signal:r}=t;try{const t=yield(0,p.sendQueryMediaConn)(r);e._err=null,e._data={auth:t.auth,authExpirationTime:new Date(t.queryStartTime.getTime()+t.authTTL),authTTL:t.authTTL,hosts:t.hosts.map((e=>new c.MediaHost(e))),hostsRefreshTime:new Date(t.queryStartTime.getTime()+t.ttl),queryStartTime:t.queryStartTime,maxBuckets:t.maxBuckets}}catch(t){const i=t;var n;if(i instanceof _.E507)return e._data=e._previousData,e._previousData=null,e._locked=!0,void setTimeout((0,o.default)((function*(){yield e._refreshIfStale({signal:r}),e._locked=!1})),null!==(n=i.backoff)&&void 0!==n?n:void 0);if(e._data=null,e._err=i,i.name===s.ABORT_ERROR)return void __LOG__(2)`mediaHosts.sendQueryMediaConn aborted`;__LOG__(3,!0)`mediaHosts.sendQueryMediaConn error: ${function(e){const{name:t,message:r,stack:n}=e,i=(0,a.default)(e,g),o=(0,u.normalizeStack)(e),s=o.slice(o.indexOf("\n")+1),l=0===Object.keys(i).length?"":" "+JSON.stringify(i,((e,t)=>e&&"object"==typeof t?String(t):t));return`${e.name||"Error"}: ${e.message}${l}\n${s}`}(i)}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error fetching mms hosts")}}));return function(){return t.apply(this,arguments)}}()),this._reset()}getHostsInfo(e){var t=this;let{directPath:r,encFilehash:i,operation:a,type:s,signal:c,forceRefresh:d=!1}=e;return(0,o.default)((function*(){if(!t._locked){const e={signal:c||(new n).signal,forceRefresh:d};yield t._refreshIfStale(e)}if(!t._data)throw new l.NoMediaHostsError("no fetched data");const{auth:e,hosts:o,maxBuckets:u}=t._data,{selectedHost:p,fallbackHost:_}=(0,f.routeSelection)({directPath:r,encFilehash:i,hosts:o,operation:a,type:s,maxBuckets:u});if(!p)throw new l.NoMediaHostsError("no selected host");return{auth:e,selectedHost:p,fallbackHost:_}}))()}_isExpiredOrMissing(){if(!this._data)return!0;const e=this._data;return new Date>=e.authExpirationTime}_needsRefresh(){if(!this._data)return!0;const e=this._data;if(new Date>=e.hostsRefreshTime)return!0;const{authTTL:t,queryStartTime:r}=e,n=Math.floor(.8*t),i=new Date(r.getTime()+n);return new Date>=i}_refreshIfStale(e){var t=this;let{forceRefresh:r}=e,n=(0,a.default)(e,h);return(0,o.default)((function*(){return t._isExpiredOrMissing()||r?(t._reset(),yield t._fetch(n),!0):!!t._needsRefresh()&&(t._fetch(n),!1)}))()}_reset(){this._previousData=this._data,this._data=null,this._err=null}};t.mediaHosts=m},70426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OPERATIONS=void 0,t.routeSelection=function(e){var t,r;let n,{encFilehash:c,directPath:d,hosts:u,operation:p,type:f,maxBuckets:_}=e;if(!u.length)return{selectedHost:null,fallbackHost:null};if(p===l.DOWNLOAD){const e=d?d.match(/&_nc_hot=([0-9]+)/):null,t=parseInt(null==e?void 0:e[1],10),r=Number.isNaN(t)?null:(0,a.unixTime)()-t,{mmsHotContentTimespan:l,mmsVCacheAggregationEnabled:p}=s.ServerProps;let h;null!=l&&l>0&&(f===o.MEDIA_TYPES.STICKER||null!=r&&r<=l)?h=1:p&&null!=_&&(h=(0,i.default)(c,_)+100);const g=function(e){const t=new Map;return e.forEach((e=>{var r;null===(r=e.downloadBuckets)||void 0===r||r.forEach((r=>{t.set(r,e)}))})),t}(u),m=null==h?null:g.get(h),y=g.get(0);(null==m?void 0:m.supportsDownloadMediaType(f))?n=m:(null==y?void 0:y.supportsDownloadMediaType(f))&&(n=y)}const h=u.find((e=>e.isFallback()));return n=null!==(t=n)&&void 0!==t?t:u.find((e=>p===l.UPLOAD?e.supportsUploadMediaType(f):e.supportsDownloadMediaType(f))),{selectedHost:null!==(r=n)&&void 0!==r?r:null,fallbackHost:null!=h?h:null}};var i=n(r(13353)),a=r(92844),o=r(61596),s=r(64551);const l={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.OPERATIONS=l},27856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return n.AbortError}}),Object.defineProperty(t,"HttpInvalidResponseError",{enumerable:!0,get:function(){return n.HttpInvalidResponseError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return n.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return n.HttpStatusCodeError}}),t.MediaTooLargeError=t.MediaNotFoundError=t.MediaInvalidError=t.MMSUnauthorizedError=t.MMSThrottleError=t.MMSForbiddenError=void 0,Object.defineProperty(t,"MmsDownloadFilehashMismatchError",{enumerable:!0,get:function(){return n.MmsDownloadFilehashMismatchError}}),Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return i.NoMediaHostsError}});var n=r(49347),i=r(40859);class a extends n.HttpStatusCodeError{constructor(e){super(404,e),this.name="MediaNotFoundError"}}t.MediaNotFoundError=a;class o extends n.HttpStatusCodeError{constructor(e){super(413,e),this.name="MediaTooLargeError"}}t.MediaTooLargeError=o;class s extends n.HttpStatusCodeError{constructor(e){super(415,e),this.name="MediaInvalidError"}}t.MediaInvalidError=s;class l extends n.HttpStatusCodeError{constructor(e){super(401,e),this.name="MMSUnauthorizedError"}}t.MMSUnauthorizedError=l;class c extends n.HttpStatusCodeError{constructor(e){super(403,e),this.name="MMSForbiddenError"}}t.MMSForbiddenError=c;class d extends n.HttpStatusCodeError{constructor(e){super(507,e),this.name="MMSThrottleError"}}t.MMSThrottleError=d},21081:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{directPath:t,encFilehash:r,hostname:n,type:l,mode:c,byteRange:d}=e;if(t)return function(e){let{directPath:t,encFilehash:r,hostname:n,query:a}=e;const o=new URL(t,`https://${n}`);if(o.hostname!==n)throw __LOG__(4,void 0,new Error,!0)`url.hostname: ${o.hostname}, hostname: ${n}, directPath: ${t}`,SEND_LOGS("malicious directPath"),new Error("malicious directPath");const l=o.searchParams||new s.default(o.search);return l.set("hash",(0,i.default)(r)),Object.keys(a).forEach((e=>{const t=a[e];null!=t&&l.set(e,t)})),`https://${o.host}${o.pathname}?${l.toString()}`}({encFilehash:r,hostname:n,directPath:t,query:{mode:c,bytestart:null==d?void 0:d.start.toString(),byteend:null==d?void 0:d.end.toString(),[o.MMS_URL_MEDIA_TYPE_SEARCH_PARAM]:l,[o.IS_MMS_URL_SEARCH_PARAM]:""}});return(0,a.default)({hostname:n,type:l,encFilehash:r,query:{mode:c,[o.IS_MMS_URL_SEARCH_PARAM]:""}})};var i=n(r(27194)),a=n(r(43311)),o=r(95770),s=n(r(23082))},43311:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{hostname:t,type:r,encFilehash:n,query:l}=e;const c=(0,a.default)(s[r],"MEDIA_TYPE_TO_PATH[type]"),d=new URL(`https://${t}${c}/${(0,i.default)(n)}`),u={};l&&Object.keys(l).forEach((e=>{null!=l[e]&&(u[e]=l[e])}));let p=new o.default(u).toString();p&&(p=`?${p}`);return`https://${d.host}${d.pathname}${p}`};var i=n(r(27194)),a=n(r(45095)),o=n(r(23082));const s={audio:"/mms/audio",document:"/mms/document",gif:"/mms/gif",image:"/mms/image",ppic:"/pps/photo",product:"/mms/image",ptt:"/mms/ptt",sticker:"/mms/sticker","thumbnail-document":"/mms/thumbnail-document","thumbnail-link":"/mms/thumbnail-link",video:"/mms/video","md-app-state":"/mms/md-app-state","product-catalog-image":"/product/image"}},42594:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r;let{auth:n,encFilehash:o,hostname:s,query:l,type:c,byteRange:d}=e;const u=null==l?void 0:l.final_hash;return(0,a.default)({encFilehash:o,hostname:s,type:c,query:{auth:n,token:(0,i.default)(o),resume:null==l||null===(t=l.resume)||void 0===t?void 0:t.toString(10),stream:null==l||null===(r=l.stream)||void 0===r?void 0:r.toString(10),final_hash:null!=u?(0,i.default)(u):void 0,bytestart:null==d?void 0:d.start.toString(10),byteend:null==d?void 0:d.end.toString(10)}})};var i=n(r(27194)),a=n(r(43311))},39436:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(27276));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},5489:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e instanceof n.MMSThrottleError)return!1;return e instanceof n.NoMediaHostsError||e instanceof n.HttpNetworkError||e instanceof n.MMSUnauthorizedError||e instanceof n.HttpStatusCodeError&&e.status>=500};var n=r(27856)},87206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={minTimeout:1e3,retries:3}},79306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(27856),o=n(r(19242)),s=r(36823);function l(){return(l=(0,i.default)((function*(e){const t={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsCheckIfUploadExists: start`;try{const t=yield(0,o.default)(e);if("complete"!==t.resume)throw new a.MediaNotFoundError("mmsCheckIfUploadExists");const{directPath:r,url:n,handle:i}=t;if(!r)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing directPath");if(!n)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing url");return __LOG__(2)`mmsCheckIfUploadExists: success`,{directPath:r,url:n,handle:i}}catch(e){throw(0,s.mmsLogError)("mmsCheckIfUploadExists",e,t),e}}))).apply(this,arguments)}},27276:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(81109)),o=i(r(48926)),s=i(r(45095)),l=r(91903),c=i(r(5489)),d=r(46640),u=r(61596),p=i(r(87206)),f=i(r(79306)),_=i(r(87439)),h=r(84062),g=i(r(19242)),m=r(36823),y=i(r(72702)),E=i(r(57220)),S=i(r(22283)),v=r(74641),T=i(r(86243)),C=i(r(18586)),A=i(r(66717)),b=r(29908);function P(){return(P=(0,o.default)((function*(e){const{encFilehash:t,signal:r,type:n}=e;let i=!1;const s={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsClient.checkIfUploadExists: start`;try{let e=null;const s=yield(0,l.exponentialBackoff)((0,a.default)((0,a.default)({},p.default),{},{signal:r}),function(){var a=(0,o.default)((function*(a,o){__LOG__(2)`mmsClient.checkIfUploadExists: attempt #${o+1}`,yield E.default.waitIfOffline({signal:r});try{const{auth:a,selectedHost:s,fallbackHost:l}=yield d.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:t,type:n,signal:r}),c=(0,A.default)({selectedHost:s,fallbackHost:l,lastHostUsed:e,attemptCount:o,lastFetchMadeProgress:i});return e=c,yield(0,f.default)({auth:a,encFilehash:t,hostname:c.hostname,type:n,signal:r,onProgress:()=>{i=!0}})}catch(e){if((0,c.default)(e))return a(e);throw e}}));return function(){return a.apply(this,arguments)}}());return __LOG__(2)`mmsClient.checkIfUploadExists: success`,s}catch(e){throw(0,m.mmsLogError)("mmsClient.checkIfUploadExists",e,s),e}}))).apply(this,arguments)}function M(){return(M=(0,o.default)((function*(e){const{encFilehash:t,type:r,onUploadAttemptSuccess:n}=e;__LOG__(2)`mmsClient.upload: start`;try{if((0,b.shouldUseStreamingUpload)(e.ciphertextHmac.byteLength,e.type)){const t=new b.UploadStreamer(e);return yield t.upload()}const{response:t,retryStartTime:r}=yield k(e);return n(Date.now()-r),__LOG__(2)`mmsClient.upload: success`,(0,s.default)(t,"response")}catch(e){throw(0,m.mmsLogError)("mmsClient.upload",e,{encFilehash:t,type:r},!1),e}}))).apply(this,arguments)}function O(){return(O=(0,o.default)((function*(e){const{directPath:t,encFilehash:r,type:n,debugString:i,staticUrl:a,onDownloadAttemptSuccess:o}=e;__LOG__(2)`mmsClient.download: [${i}] start`;try{const{response:t,retryStartTime:r}=yield R(e);return o(Date.now()-r),__LOG__(2)`mmsClient.download: [${i}] success`,t}catch(e){throw(0,m.mmsLogError)("mmsClient.download",e,{directPath:t,encFilehash:r,type:n,staticUrl:a}),e}}))).apply(this,arguments)}function I(e,t){const{directPath:r,encFilehash:n,type:i,signal:s}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,l.exponentialBackoff)((0,a.default)((0,a.default)({},p.default),{},{signal:s}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const t=yield function(){return w.apply(this,arguments)}({operation:S.default.DOWNLOAD,directPath:r,encFilehash:n,type:i,signal:s,failCount:a});return yield e(t)}catch(e){if((0,c.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}function w(){return(w=(0,o.default)((function*(e){const{failCount:t,operation:r,directPath:n,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l}=yield d.mediaHosts.getHostsInfo({operation:r,directPath:n,encFilehash:i,type:a,signal:o});return(t>=2&&l?l:s).hostname}))).apply(this,arguments)}function R(){return D.apply(this,arguments)}function D(){return(D=(0,o.default)((function*(e){let{debugString:t,signal:r,directPath:i,encFilehash:u,staticUrl:f,type:_,onDownloadHostFound:g,mode:m,byteRange:y,onDownloadAttemptError:E,onResponseText:b,onProgress:P}=e,M=Date.now(),O=!1,I=null;const w=yield(0,l.exponentialBackoff)((0,a.default)((0,a.default)({},p.default),{},{signal:r}),function(){var e=(0,o.default)((function*(e,a){M=Date.now(),__LOG__(2)`mmsClient.download: [${t}] attempt #${a+1}`;const s=e=>d.mediaHosts.getHostsInfo({operation:S.default.DOWNLOAD,directPath:i,encFilehash:u,type:_,signal:r,forceRefresh:e});try{const{selectedHost:e,fallbackHost:l}=yield s();let c=(0,A.default)({selectedHost:e,fallbackHost:l,attemptCount:a,lastHostUsed:I,lastFetchMadeProgress:O});I=c,g({hostName:c.hostname,hostClass:c.class,failCount:a});let d=0,p=null;const E={selectedHost:e,fallbackHost:l},S=e=>{if(null!=e&&null==p){const t=e.get("Content-Length"),r=parseInt(t,10);p=Number.isNaN(r)?null:r}};return yield(0,C.default)(function(){var e=(0,o.default)((function*(e){let{retry:a,failCount:o}=e;const l=e=>{null==P||P(e),O=!0,e.lengthComputable&&(d=e.loaded)};d=0;const g=new n,{signal:C}=g,A=yield(0,T.default)([r,C],(e=>{const r=(0,h.mms4Download)({directPath:i,encFilehash:u,staticUrl:f,hostname:c.hostname,type:_,signal:e,mode:m,byteRange:y,debugString:t,onHeadersReceived:S,onProgress:l,onResponseText:b}).then((e=>({kind:"download-completed",arrayBuffer:e}))),n=(0,v.shouldPollDownloadHosts)(_,p)?(0,v.pollMediaHosts)({connectionBlock:E,getHost:()=>c,getMediaHosts:()=>s(!0),getRemainingBytes:()=>null!=p?p-d:null,signal:e}).then((e=>({kind:"host-changed",host:e}))):null;return Promise.race([r,n].filter(Boolean)).finally((()=>g.abort()))}));return"host-changed"===A.kind?(c=A.host,I=c,a()):A.arrayBuffer}));return function(){return e.apply(this,arguments)}}())}catch(t){O=!1;const r=(0,c.default)(t);if(!r||a===p.default.retries||E({err:t,overallT:Date.now()-M,failCount:a}),r)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}());return{response:(0,s.default)(w,"response"),retryStartTime:M}}))).apply(this,arguments)}function N(){return L.apply(this,arguments)}function L(){return(L=(0,o.default)((function*(e){let{auth:t,encFilehash:r,hostname:n,type:i,signal:a,byteLength:o}=e;if(!(0,v.shouldPollUploadHosts)(i,o))return 0;const{resume:s}=yield(0,g.default)({auth:t,encFilehash:r,hostname:n,type:i,signal:a});if("complete"===s)return 0;const l=parseInt(s,10);return Number.isNaN(l)?(__LOG__(4,void 0,new Error,!0)`mmsClient.upload: offset is NaN, resume=${s}`,SEND_LOGS("upload-offset-is-NaN"),0):l>=o?0:l}))).apply(this,arguments)}function k(){return G.apply(this,arguments)}function G(){return(G=(0,o.default)((function*(e){const{ciphertextHmac:t,encFilehash:r,type:i,signal:s,onUploadHostFound:u,onUploadAttemptError:f,onProgress:_}=e;let h=!1,g=Date.now(),m=null;return{response:yield(0,l.exponentialBackoff)((0,a.default)((0,a.default)({},p.default),{},{signal:s}),function(){var e=(0,o.default)((function*(e,a){const l=e=>d.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:r,type:i,signal:s,forceRefresh:e});g=Date.now(),__LOG__(2)`mmsClient.upload: attempt #${a+1}`;try{yield E.default.waitIfOffline({signal:s});const{auth:e,selectedHost:c,fallbackHost:d}=yield l(),p={selectedHost:c,fallbackHost:d};let f=(0,A.default)({selectedHost:c,fallbackHost:d,attemptCount:a,lastHostUsed:m,lastFetchMadeProgress:h});return m=f,u({hostName:f.hostname,hostClass:f.class,failCount:a}),yield(0,C.default)(function(){var a=(0,o.default)((function*(a){let{retry:o}=a;const c=yield N({auth:e,encFilehash:r,byteLength:t.byteLength,hostname:f.hostname,type:i,signal:s}),d=new n,{signal:u}=d,g=yield(0,T.default)([s,u],(n=>{const a=(0,v.shouldPollUploadHosts)(i,t.byteLength)?(0,v.pollMediaHosts)({connectionBlock:p,getHost:()=>f,getMediaHosts:()=>l(!0),getRemainingBytes:()=>t.byteLength,signal:n}).then((e=>({kind:"host-changed",host:e}))):null,o=(0,y.default)({auth:e,ciphertextHmac:c>0?new Uint8Array(t).subarray(c):t,hostname:f.hostname,encFilehash:r,type:i,signal:s,onProgress:e=>{h=!0,null==_||_(e,c)},byteRange:c>0?{start:c,end:t.byteLength}:void 0}).then((e=>({kind:"upload-completed",value:e})));return Promise.race([o,a].filter(Boolean)).finally((()=>d.abort()))}));return"host-changed"===g.kind?(f=g.host,m=f,o()):g.value}));return function(){return a.apply(this,arguments)}}())}catch(t){h=!1;const r=(0,c.default)(t);if(!r||a===p.default.retries||f(t,Date.now()-g),r)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}()),retryStartTime:g}}))).apply(this,arguments)}function U(){return(U=(0,o.default)((function*(e){const{failCount:t,operation:r,directPath:n,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l,auth:c}=yield d.mediaHosts.getHostsInfo({operation:r,directPath:n,encFilehash:i,type:a,signal:o});return{hostname:(t>=2&&l?l:s).hostname,auth:c}}))).apply(this,arguments)}var F={download:function(){return O.apply(this,arguments)},upload:function(){return M.apply(this,arguments)},checkExistence:function(e){return I((t=>(0,h.mmsCheckExistence)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},getEncryptedMediaSize:function(e){return I((t=>(0,h.mmsGetEncryptedMediaSize)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},checkIfUploadExists:function(){return P.apply(this,arguments)},deleteMdHistorySyncBlob:function(e){const{directPath:t,encFilehash:r}=e;return function(e,t){const{directPath:r,encFilehash:n,type:i,signal:s,operation:d}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,l.exponentialBackoff)((0,a.default)((0,a.default)({},p.default),{},{signal:s}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const{hostname:t,auth:o}=yield function(){return U.apply(this,arguments)}({operation:d,directPath:r,encFilehash:n,type:i,signal:s,failCount:a});return yield e(t,o)}catch(e){if((0,c.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}(((e,n)=>(0,_.default)({directPath:t,hostname:e,encFilehash:r,auth:n})),(0,a.default)((0,a.default)({},e),{},{type:u.MEDIA_TYPES.IMAGE,operation:S.default.UPLOAD}))}};t.default=F},87439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=n(r(27194)),s=r(49347),l=n(r(18561)),c=n(r(43311)),d=r(61596);function u(){return(u=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,auth:i}=e,u=t.split("?")[0],p=(new TextEncoder).encode(u),f=(0,a.encodeB64UrlSafe)(p),_=(0,c.default)({encFilehash:r,hostname:n,type:d.MEDIA_TYPES.IMAGE,query:{token:(0,o.default)(r),d_md:f,auth:i}}),h=yield(0,l.default)(_,{method:"DELETE"});if(!h.ok)throw new s.HttpStatusCodeError(h.status,"MMS Delete error")}))).apply(this,arguments)}},84062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mms4Download=function(e){let{directPath:t,encFilehash:r,staticUrl:n,hostname:o,type:s,signal:l,onProgress:d,onResponseText:p,onHeadersReceived:f,mode:_,byteRange:h,debugString:g}=e;const m=n||(0,c.default)({directPath:t,encFilehash:r,hostname:o,type:s,mode:_,byteRange:h});return function(){return u.apply(this,arguments)}({url:m,signal:l,onHeadersReceived:f,onProgress:d,onResponseText:p,ciphertextValidator:h?null:function(){var e=(0,i.default)((function*(e){return(yield(0,a.default)(e))===r}));return function(){return e.apply(this,arguments)}}(),debugString:g,debug:{encFilehash:r,type:s,url:m}})},t.mmsCheckExistence=function(){return p.apply(this,arguments)},t.mmsGetEncryptedMediaSize=function(){return f.apply(this,arguments)},t.validateMmsResponse=_;var i=n(r(48926)),a=n(r(18309)),o=r(27856),s=r(64103),l=r(61181),c=n(r(21081)),d=r(36823);function u(){return(u=(0,i.default)((function*(e){let{url:t,signal:r,onHeadersReceived:n,onProgress:i,onResponseText:a,debug:s,debugString:c,ciphertextValidator:u}=e;__LOG__(2)`mmsDownload: [${c}] start`;try{const e=yield(0,l.extendedFetch)(t,{signal:r,onProgress:i,onResponseText:a,onHeadersReceived:n});yield _({response:e,functionName:"mmsDownload",url:t});const s=yield e.arrayBuffer();if(u&&!(yield u(s)))throw __LOG__(3)`download hash mismatch error. downloaded size: ${s.byteLength}`,new o.MmsDownloadFilehashMismatchError({url:t});return __LOG__(2)`mmsDownload: [${c}] success`,s}catch(e){throw(0,d.mmsLogError)("mmsDownload",e,s),e}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a}=e;yield g({directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:"mmsCheckExistence"})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a}=e,o=(yield g({directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:"mmsGetEncryptedMediaSize"})).headers.get("content-length");if(!o)throw new s.UnableToGetContentLengthError;return parseInt(o,10)}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const{response:t,url:r,functionName:n}=e;if(!t.ok)switch(t.status){case 401:throw new o.MMSUnauthorizedError(n,{url:r});case 403:if((yield t.text()).includes("URL signature expired"))throw new o.MediaNotFoundError(n,{url:r,status:t.status});throw new o.MMSForbiddenError(n,{url:r});case 404:case 410:throw new o.MediaNotFoundError(n,{url:r,status:t.status});case 507:throw new o.MMSThrottleError(n,{url:r});default:throw new o.HttpStatusCodeError(t.status,n,{url:r})}}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:o}=e,s=(0,c.default)({directPath:t,encFilehash:r,hostname:n,type:i,mode:"auto"}),d=yield(0,l.extendedFetch)(s,{method:"HEAD",signal:a});return yield _({response:d,functionName:o,url:s}),d}))).apply(this,arguments)}},19242:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(27856),o=r(61181),s=n(r(42594)),l=r(36823);function c(){return(c=(0,i.default)((function*(e){const{auth:t,encFilehash:r,hostname:n,signal:i,type:c,onProgress:d}=e,u=(0,s.default)({auth:t,encFilehash:r,hostname:n,query:{resume:1},type:c});__LOG__(2)`mmsGetUploadProgress: start`;try{const e=yield(0,o.extendedFetch)(u,{method:"post",signal:i,onProgress:d});if(!e.ok)switch(e.status){case 401:throw new a.MMSUnauthorizedError("mmsGetUploadProgress",{url:u});case 404:throw new a.MediaNotFoundError("mmsGetUploadProgress",{url:u});default:throw new a.HttpStatusCodeError(e.status,"mmsGetUploadProgress",{url:u})}const t=yield e.json();if(!t.resume)throw new a.HttpInvalidResponseError("mmsGetUploadProgress: missing resume",{url:u});return __LOG__(2)`mmsGetUploadProgress: success`,{directPath:t.direct_path,resume:t.resume,url:t.url,handle:t.handle}}catch(e){throw(0,l.mmsLogError)("mmsUpload",e,{encFilehash:r,type:c,url:u}),e}}))).apply(this,arguments)}},36823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mmsLogError=function(e,t){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t instanceof i.MediaNotFoundError&&r?__LOG__(2)`${e}: expected error`:"object"==typeof t&&(null==t?void 0:t.name)===n.ABORT_ERROR?__LOG__(2)`${e}: canceled`:__LOG__(3)`${e}: error`};var n=r(89385),i=r(27856)},72702:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(27856),o=r(61181),s=n(r(42594)),l=r(36823);function c(){return(c=(0,i.default)((function*(e){const{auth:t,ciphertextHmac:r,encFilehash:n,hostname:i,type:c,signal:d,onProgress:u,byteRange:p}=e,f=(0,s.default)({auth:t,encFilehash:n,hostname:i,type:c,byteRange:p});__LOG__(2)`mmsUpload: start`;try{const e=yield(0,o.extendedFetch)(f,{method:"post",body:r,signal:d,onProgress:u}).then((e=>{if(!e.ok)switch(e.status){case 401:throw new a.MMSUnauthorizedError("mmsUpload",{url:f});case 413:throw new a.MediaTooLargeError("mmsUpload",{url:f});case 415:throw new a.MediaInvalidError("mmsUpload: hash mismatch",{url:f});case 507:throw new a.MMSThrottleError("mmsUpload",{url:f});default:throw new a.HttpStatusCodeError(e.status,"mmsUpload",{url:f})}return e.json()})).then((e=>{if(!e.direct_path)throw new a.HttpInvalidResponseError("mmsUpload: missing direct_path");if(!e.url)throw new a.HttpInvalidResponseError("mmsUpload: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUpload: success`,e}catch(e){throw(0,l.mmsLogError)("mmsUpload",e,{encFilehash:n,type:c,url:f},!1),e}}))).apply(this,arguments)}},41486:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mmsUploadStream=function(e){let{auth:t,encFilehash:r,type:n,hostname:i,byteStart:a,byteEnd:l,chunk:d,signal:u,onProgress:p}=e;const f=(0,s.default)({auth:t,encFilehash:r,type:n,hostname:i,query:{stream:1},byteRange:{start:a,end:l}});return(0,o.extendedFetch)(f,{method:"post",body:d,signal:u,onProgress:p}).then((e=>{e.ok||c(e.status,"mmsUploadStream",f)}))},t.mmsUploadStreamFinalize=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(27856),o=r(61181),s=n(r(42594)),l=r(36823);function c(e,t,r){switch(e){case 401:throw new a.MMSUnauthorizedError(t,{url:r});case 413:throw new a.MediaTooLargeError(t,{url:r});case 415:throw new a.MediaInvalidError(`${t}: hash mismatch`,{url:r});case 507:throw new a.MMSThrottleError("mmsUploadStreamFinalize",{url:r});default:throw new a.HttpStatusCodeError(e,t,{url:r})}}function d(){return(d=(0,i.default)((function*(e){let{auth:t,encFilehash:r,type:n,hostname:i,finalHash:d,signal:u}=e;const p=(0,s.default)({auth:t,encFilehash:r,type:n,hostname:i,query:{stream:1,final_hash:d}});__LOG__(2)`mmsUploadStreamFinalize: start`;try{const e=yield(0,o.extendedFetch)(p,{method:"post",signal:u}).then((e=>(e.ok||c(e.status,"mmsUploadStreamFinalize",p),e.json()))).then((e=>{if(null==e.direct_path||""===e.direct_path)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing direct_path");if(null==e.url||""===e.url)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUploadStreamFinalize: success`,e}catch(e){throw(0,l.mmsLogError)("mmsUpload",e,{encFilehash:r,type:n,url:p},!1),e}}))).apply(this,arguments)}},74641:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_POLLING_INTERVAL=void 0,t.pollMediaHosts=function(){return u.apply(this,arguments)},t.shouldPollDownloadHosts=function(e,t){return c.ServerProps.downloadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&(null!=t?t:0)>o.THRESHOLD},t.shouldPollUploadHosts=function(e,t){return c.ServerProps.uploadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&t>o.THRESHOLD};var i=n(r(48926)),a=r(13959),o=r(51320),s=r(61596),l=n(r(18586)),c=r(64551);const d=3e5;function u(){return(u=(0,i.default)((function*(e){let t=e.connectionBlock;return yield(0,a.delayMs)(d,e.signal),(0,l.default)((r=>{let{retry:n}=r;return new Promise((r=>e.getMediaHosts().then((i=>{let{selectedHost:a,fallbackHost:s}=i;const l={selectedHost:a,fallbackHost:s},c=e.getRemainingBytes();if(null==c)return n(d);const{changed:u,host:p}=(0,o.maybeSwitchHost)(e.getHost(),t,l,c);return t=l,u?r(p):n(d)}))))}),e.signal)}))).apply(this,arguments)}t.SERVER_POLLING_INTERVAL=d},66717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{selectedHost:t,fallbackHost:r,attemptCount:n,lastHostUsed:i,lastFetchMadeProgress:a}=e;if(a&&i)return i;if(n<=1)return t;if(3===n&&r)return r;if((null==i?void 0:i.equals(t))&&null!=t.fallback)return t.fallback;return null!=r?r:t}},29908:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadStreamer=void 0,t.shouldUseStreamingUpload=function(e,t){return v.ServerProps.streamingUploadChunkSize>0&&t===p.MEDIA_TYPES.DOCUMENT&&e>v.ServerProps.streamingUploadChunkSize};var a=i(r(6479)),o=i(r(81109)),s=i(r(48926)),l=r(27856),c=r(91903),d=i(r(5489)),u=r(82828),p=r(61596),f=i(r(87206)),_=r(41486),h=i(r(57220)),g=r(74641),m=i(r(86243)),y=i(r(18586)),E=r(70426),S=i(r(66717)),v=r(64551);const T=["auth"];function C(e,t){return(0,d.default)(e)&&t<f.default.retries}t.UploadStreamer=class{constructor(e){this._retryStartTime=Date.now(),this._lastUploadedChunkIndex=0,this._config=e,this._payload=new Uint8Array(e.ciphertextHmac),this._debugString=e.encFilehash.slice(0,10),this._chunkSize=0===v.ServerProps.streamingUploadChunkSize?this._payload.byteLength:v.ServerProps.streamingUploadChunkSize}upload(){var e=this;return(0,s.default)((function*(){__LOG__(2)`uploadStreamer: [${e._debugString}] start upload`,yield h.default.waitIfOffline({signal:e._config.signal});const t=Math.ceil(e._payload.byteLength/e._chunkSize);for(let r=0;r<t;r++){__LOG__(2)`uploadStreamer: [${e._debugString}] uploading chunk ${r+1}/${t}`;const n=r*e._chunkSize,i=n+e._chunkSize,a=e._payload.subarray(n,i);yield e._uploadChunkWithBackoff(a,n)}const r=yield e._finalizeWithBackoff();return e._config.onUploadAttemptSuccess(Date.now()-e._retryStartTime),r}))()}_resetRetryStartTime(){this._retryStartTime=Date.now()}_getAttemptTime(){return Date.now()-this._retryStartTime}_getRemainingBytes(){return this._payload.byteLength-this._lastUploadedChunkIndex*this._chunkSize}_uploadChunkWithBackoff(e,t){var r=this;return(0,c.exponentialBackoff)((0,o.default)((0,o.default)({},f.default),{},{signal:this._config.signal}),function(){var n=(0,s.default)((function*(n,i){try{yield r._uploadChunk(e,t,i)}catch(e){if(C(e,i))return r._config.onUploadAttemptError(e,r._getAttemptTime()),r._resetRetryStartTime(),n(e);throw e}}));return function(){return n.apply(this,arguments)}}())}_finalizeWithBackoff(){var e=this;return(0,c.exponentialBackoff)((0,o.default)((0,o.default)({},f.default),{},{signal:this._config.signal}),function(){var t=(0,s.default)((function*(t,r){try{return yield e._finalize(r)}catch(n){if(function(e,t){return!(e instanceof l.HttpStatusCodeError&&e.status>=500)&&C(e,t)}(n,r))return e._config.onUploadAttemptError(n,e._getAttemptTime()),e._resetRetryStartTime(),t(n);throw n}}));return function(){return t.apply(this,arguments)}}())}_uploadChunk(e,t,r){var i=this;return(0,s.default)((function*(){let o=null,l=!1;yield h.default.waitIfOffline({signal:i._config.signal});const c=yield i._getMediaHosts(r),{auth:d}=c,u=(0,a.default)(c,T);let p=o=(0,S.default)({selectedHost:u.selectedHost,fallbackHost:u.fallbackHost,lastHostUsed:o,lastFetchMadeProgress:l,attemptCount:r});const f=e=>{var r,n;l=!0,null===(r=(n=i._config).onProgress)||void 0===r||r.call(n,e,t)};return(0,y.default)(function(){var a=(0,s.default)((function*(a){let{retry:s}=a;const l=new n,{signal:c}=l,h=yield(0,m.default)([c,i._config.signal],(n=>{const a=(0,g.shouldPollUploadHosts)(i._config.type,i._payload.byteLength)?(0,g.pollMediaHosts)({connectionBlock:u,signal:n,getHost:()=>p,getMediaHosts:()=>i._getMediaHosts(r,!0),getRemainingBytes:()=>i._getRemainingBytes()}).then((e=>({host:e,kind:"host-changed"}))):null,o=(0,_.mmsUploadStream)({auth:d,encFilehash:i._config.encFilehash,type:i._config.type,hostname:p.hostname,byteStart:t,byteEnd:t+e.byteLength,chunk:e,signal:n,onProgress:f}).then((()=>({kind:"upload-completed"})));return Promise.race([o,a].filter(Boolean)).finally((()=>l.abort()))}));if("host-changed"===h.kind)return o=p,p=h.host,s()}));return function(){return a.apply(this,arguments)}}())}))()}_finalize(e){var t=this;return(0,s.default)((function*(){yield h.default.waitIfOffline({signal:t._config.signal});const{auth:r,selectedHost:n}=yield t._getMediaHosts(e);return __LOG__(2)`uploadStreamer: [${t._debugString}] finalizing`,(0,_.mmsUploadStreamFinalize)({auth:r,hostname:n.hostname,encFilehash:t._config.encFilehash,finalHash:t._config.encFilehash,type:t._config.type,signal:t._config.signal})}))()}_getMediaHosts(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.default)((function*(){const n=yield u.mediaHosts.getHostsInfo({operation:E.OPERATIONS.UPLOAD,encFilehash:t._config.encFilehash,type:t._config.type,signal:t._config.signal,forceRefresh:r});return t._config.onUploadHostFound({failCount:e,hostName:n.selectedHost.hostname,hostClass:n.selectedHost.class}),n}))()}}},51127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,s){const l=(0,a.generateMediaEventId)(),c=new o.default.MediaUpload2({mediaId:l,connectionType:o.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e),overallMmsVersion:4,overallAttemptCount:r,networkStack:o.default.NETWORK_STACK_TYPE.NATIVE,overallUploadMode:(0,a.getMetricOverallUploadModeType)(e),overallIsForward:n,overallUploadOrigin:t,isViewOnce:s});return{handleArrayBufferCreated:function(e){c.set({overallMediaSize:e})},handleCheckExistingError:function(e){e instanceof i.HttpStatusCodeError&&c.set({resumeHttpCode:e.status})},handleCheckExistingSuccess:function(){c.set({overallUploadResult:o.default.MEDIA_UPLOAD_RESULT_TYPE.DUPLICATE,overallIsFinal:!0,resumeHttpCode:200}),c.markOverallCumT(),c.commit()},handleUploadHostFound:function(e){let{hostName:t,hostClass:r,failCount:n}=e;c.set({overallDomain:t,overallConnectionClass:r,overallRetryCount:n})},handleUploadSuccess:function(){c.set({resumeHttpCode:404,overallUploadResult:o.default.MEDIA_UPLOAD_RESULT_TYPE.OK,overallIsFinal:!0,uploadHttpCode:200,finalizeHttpCode:200}),c.markOverallCumT(),c.commit()},handleUploadError:function(e){c.set({overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!0});const t=(0,a.getStatusCode)(e);null!=t&&(c.uploadHttpCode=t,c.finalizeHttpCode=t),c.markOverallCumT(),c.commit(),(0,a.logErrorUnknownDetails)(c,e)},handleUploadAttemptSuccess:function(e){c.set({overallT:e})},handleUploadAttemptError:function(e,t,r){const n=new o.default.MediaUpload2(c);n.set({mediaId:(0,a.generateMediaEventId)(),overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!1,overallT:t,overallRetryCount:r});const i=(0,a.getStatusCode)(e);null!=i&&(c.uploadHttpCode=i),c.markOverallCumT(),n.commit(),(0,a.logErrorUnknownDetails)(c,e)},mediaId:l,handleEncryptionStart:function(){c.startOverallEncryptT()},handleEncryptionSuccess:function(){c.markOverallEncryptT()}}};var i=r(27856),a=r(29992),o=n(r(11339))},60363:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return n.AbortError}}),Object.defineProperty(t,"FileNotReadableError",{enumerable:!0,get:function(){return i.FileNotReadableError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return n.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return n.HttpStatusCodeError}}),Object.defineProperty(t,"MMSUnauthorizedError",{enumerable:!0,get:function(){return n.MMSUnauthorizedError}}),Object.defineProperty(t,"MediaEncryptionError",{enumerable:!0,get:function(){return i.MediaEncryptionError}}),Object.defineProperty(t,"MediaInvalidError",{enumerable:!0,get:function(){return n.MediaInvalidError}}),Object.defineProperty(t,"MediaNotFoundError",{enumerable:!0,get:function(){return n.MediaNotFoundError}}),Object.defineProperty(t,"MediaTooLargeError",{enumerable:!0,get:function(){return n.MediaTooLargeError}}),Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return a.NoMediaHostsError}});var n=r(27856),i=r(64103),a=r(40859)},11105:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=n(r(54824))},54824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(89385),o=r(50796),s=r(92844),l=n(r(51127)),c=r(22200),d=n(r(83899)),u=r(27856),p=r(1063),f=n(r(58596)),_=(n(r(11339)),n(r(39436))),h=r(23125),g=n(r(15554)),m=r(64551),y=n(r(23082));function E(e){let{mediaKey:t,mediaKeyTimestamp:r}=e;if(null!=t&&null!=r)return{mediaKey:t,mediaKeyTimestamp:r};const{key:n,timestamp:i}=(0,g.default)();return{mediaKey:n,mediaKeyTimestamp:i}}var S=new class{constructor(){var e=this;this.checkIfAlreadyUploaded=(0,f.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{encFilehash:t,type:r}=e;__LOG__(2)`uploadManager.checkIfAlreadyUploaded: start`;try{const t=yield _.default.checkIfUploadExists(e).catch((0,o.filteredCatch)(u.MediaNotFoundError,(()=>null)));return __LOG__(2)`uploadManager.checkIfAlreadyUploaded: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.checkIfAlreadyUploaded: canceled`:__LOG__(3)`uploadManager.checkIfAlreadyUploaded: error`,e}}));return function(){return e.apply(this,arguments)}}()),this._memoizedUpload=(0,f.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{ciphertextHmac:t,encFilehash:r,type:n,signal:i,onUploadHostFound:a,onUploadAttemptSuccess:o,onUploadAttemptError:s,onUploadSuccess:l,onProgress:c}=e,d=yield _.default.upload({ciphertextHmac:t,encFilehash:r,type:n,signal:i,onUploadHostFound:a,onUploadAttemptSuccess:o,onUploadAttemptError:s,onProgress:c});return l(),d}));return function(){return e.apply(this,arguments)}}()),this._getExistingOrUpload=(0,f.default)((e=>e.encFilehash),function(){var t=(0,i.default)((function*(t){const{ciphertextHmac:r,encFilehash:n,signal:i,type:o,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onProgress:f}=t;__LOG__(2)`uploadManager._getExistingOrUpload: start`;try{const t=yield e.checkIfAlreadyUploaded({encFilehash:n,type:o,signal:i}).catch((e=>{throw l(e),e})).then((t=>t?(s(),t):e._memoizedUpload({ciphertextHmac:r,encFilehash:n,type:o,signal:i,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onCheckExistingSuccess:s,onCheckExistingError:l,onProgress:f})));return __LOG__(2)`uploadManager._getExistingOrUpload: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager._getExistingOrUpload: canceled`:__LOG__(3)`uploadManager._getExistingOrUpload: error`,e}}));return function(){return t.apply(this,arguments)}}()),c.downloadUploadCrashLogger.init()}encryptAndUpload(e){var t=this;return(0,i.default)((function*(){const{blob:r,signal:n,type:o,userUploadAttemptCount:s,forwardedFromWeb:u,uploadOrigin:f,onProgress:_,isViewOnce:g}=e;__LOG__(2)`uploadManager.encryptAndUpload: start`;const{handleCheckExistingSuccess:y,handleCheckExistingError:S,handleUploadHostFound:T,handleUploadAttemptSuccess:C,handleUploadAttemptError:A,handleUploadSuccess:b,handleArrayBufferCreated:P,handleUploadError:M,mediaId:O,handleEncryptionStart:I,handleEncryptionSuccess:w}=(0,l.default)(o,f,s,u,g);c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_ENCRYPTION_STARTED);try{let a;if((0,h.isPerformanceExperimentEnabled)()){const i=E(e);a=Promise.resolve(r).then((e=>{c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:r instanceof Blob?r.size:r.byteLength});const t=e instanceof Blob?(0,p.blobToArrayBuffer)(e):e;return c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),t})).then((e=>(P(e.byteLength),I(),(0,d.default)({type:o,plaintext:e,mediaKey:i.mediaKey})))).then((r=>{let{hash:a,ciphertextHmac:s,sidecar:l,firstFrameSidecar:d}=r;w(),c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_ENCRYPTION_FINISHED);return(e.mediaKey?t._getExistingOrUpload:t._memoizedUpload)({ciphertextHmac:s,encFilehash:a,type:o,signal:n,onCheckExistingSuccess:y,onCheckExistingError:S,onUploadHostFound:T,onUploadAttemptSuccess:C,onUploadAttemptError:A,onUploadSuccess:b,onProgress:_}).then((e=>({directPath:u&&m.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(e.directPath):e.directPath,encFilehash:a,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,sidecar:l,firstFrameSidecar:d,url:e.url,handle:e.handle})))}))}else{c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:r instanceof Blob?r.size:r.byteLength});const s=r instanceof Blob?(0,p.blobToArrayBuffer)(r):Promise.resolve(r);c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),a=s.then(function(){var r=(0,i.default)((function*(r){P(r.byteLength);const{mediaKey:i,mediaKeyTimestamp:a}=E(e);I();const{ciphertextHmac:s,hash:l,sidecar:p,firstFrameSidecar:f}=yield(0,d.default)({type:o,plaintext:r,mediaKey:i});w(),c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_ENCRYPTION_FINISHED);const _=e.mediaKey?t._getExistingOrUpload:t._memoizedUpload,h=yield _({ciphertextHmac:s,encFilehash:l,type:o,signal:n,onCheckExistingSuccess:y,onCheckExistingError:S,onUploadHostFound:T,onUploadAttemptSuccess:C,onUploadAttemptError:A,onUploadSuccess:b});return{directPath:u&&m.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(h.directPath):h.directPath,encFilehash:l,mediaKey:i,mediaKeyTimestamp:a,sidecar:p,firstFrameSidecar:f,url:h.url,handle:h.handle}}));return function(){return r.apply(this,arguments)}}())}const s=yield a;return __LOG__(2)`uploadManager.encryptAndUpload: success`,c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_FINISHED),s}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.encryptAndUpload: canceled`:__LOG__(3)`uploadManager.encryptAndUpload: error`,c.downloadUploadCrashLogger.mark(O,c.ProgressType.UPLOAD_ERROR),M(e),e}}))()}unencryptedUpload(e){const{file:t,hash:r,type:n,signal:i,uploadOrigin:a,isViewOnce:o}=e,{handleCheckExistingSuccess:s,handleCheckExistingError:c,handleUploadHostFound:d,handleUploadAttemptSuccess:u,handleUploadAttemptError:p,handleUploadSuccess:f}=(0,l.default)(n,a,0,!1,o);return this._getExistingOrUpload({ciphertextHmac:t,encFilehash:r,type:n,signal:i,onCheckExistingSuccess:s,onCheckExistingError:c,onUploadHostFound:d,onUploadAttemptSuccess:u,onUploadAttemptError:p,onUploadSuccess:f})}};function v(e){const[t,r]=e.split("?"),n=new y.default(r),i=(0,s.unixTime)();return n.set("_nc_hot",String(i)),`${t}?${n.toString()}`}t.default=S},22200:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadUploadCrashLogger=t.ProgressType=void 0;var i=n(r(92417)),a=r(64551);const o=r(76672).Mirrored(["DOWNLOAD_STARTED","DOWNLOAD_FINISHED","DOWNLOAD_DECRYPTION_STARTED","DOWNLOAD_DECRYPTION_FINISHED","DOWNLOAD_ERROR","UPLOAD_STARTED","UPLOAD_FINISHED","UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED","UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED","UPLOAD_ENCRYPTION_STARTED","UPLOAD_ENCRYPTION_FINISHED","UPLOAD_ERROR"]);t.ProgressType=o;const s="DownloadUploadCrashLoggerLikelyCrashed",l=new Set([o.DOWNLOAD_DECRYPTION_FINISHED,o.DOWNLOAD_ERROR,o.UPLOAD_FINISHED,o.UPLOAD_ERROR]);const c=new class{constructor(){this.hasPerformedInit=!1,this._clearAllStorage=()=>{null===i.default||void 0===i.default||i.default.removeItem(s)}}_getStorage(){const e=null===i.default||void 0===i.default?void 0:i.default.getItem(s);return e?JSON.parse(e):{}}_commitStorage(){null===i.default||void 0===i.default||i.default.setItem(s,JSON.stringify(this.storage))}_shouldLog(){return!0===a.ServerProps.webLogUploadDownloadCrashes}init(){!this.hasPerformedInit&&this._shouldLog()&&(window.addEventListener("beforeunload",this._clearAllStorage),this.storage=this._getStorage(),Object.entries(this.storage).forEach((e=>{let[t,{progressType:r,metadata:n}]=e;var i,a;__LOG__(3,void 0,void 0,!0)`downloadUploadCrashLogger.likelyCrashedDuring${a=r,a.toLowerCase().replace(/(?:^|_)(\w)/g,((e,t)=>t.toLocaleUpperCase()))}WithID${t}${n?`AndData => ${i=n,Object.entries(i).map((e=>{let[t,r]=e;return`${t}: ${String(r)}`})).join(", ")}`:""}`,SEND_LOGS("download-upload-manager-likely-crashed")})),this._clearAllStorage(),this.hasPerformedInit=!0)}reset(){this._shouldLog()&&(window.removeEventListener("beforeunload",this._clearAllStorage),this._clearAllStorage(),this.hasPerformedInit=!1)}mark(e,t,r){this._shouldLog()&&(l.has(t)?delete this.storage[String(e)]:this.storage[String(e)]={progressType:t,metadata:r},this._commitStorage())}};t.downloadUploadCrashLogger=c},23125:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargeFilesEnabled=o,t.isPerformanceExperimentEnabled=function(){if(o())return!0;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_abprop_large_files_encryption_optimization");return!1},t.shouldEncryptInChunks=function(e){return o()&&e>a.DEFAULT_MAX_FILE_SIZE_BYTES};var n=r(86945),i=r(7293),a=r(64551);function o(){return a.ServerProps.maxFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES||a.ServerProps.maxElectronFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES}},9329:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"MediaDecryptionError",{enumerable:!0,get:function(){return f.MediaDecryptionError}}),Object.defineProperty(t,"MediaNotOnPhone",{enumerable:!0,get:function(){return f.MediaNotOnPhone}}),t.NoEntryAfterRMR=t.MissingEncFilehash=void 0,t.cancelDownloadMedia=function(e){const{downloadPromise:t}=e;if(null==t)return;const r=N.get(t);if(null==r)return;N.delete(t),r()},t.checkExistence=function(){return x.apply(this,arguments)},t.downloadMedia=U,t.manuallySetMedia=function(){return L.apply(this,arguments)};var a=i(r(48926)),o=i(r(23493)),s=r(89385),l=r(40265),c=r(50796),d=i(r(45095)),u=r(691),p=r(26384),f=r(37115),_=O(r(64103)),h=r(1063),g=r(84866),m=O(r(97692)),y=r(61596),E=r(58668),S=r(56406),v=i(r(11339)),T=r(43257),C=i(r(34949)),A=i(r(86243)),b=r(64551),P=r(78521);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(M=function(e){return e?r:t})(e)}function O(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=M(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class I extends((0,l.customError)("NoEntryAfterRMR")){}t.NoEntryAfterRMR=I;class w extends((0,l.customError)("MissingEncFilehash")){}t.MissingEncFilehash=w;const R=3,D=4,N=new WeakMap;function L(){return(L=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,mediaBlob:n,mediaType:i,rmrReason:a,downloadOrigin:o}=e;r.mediaBlob||(yield(0,S.gatherAndSetMetadata)(r,n),yield U({mimetype:t,mediaObject:r,downloadEvenIfExpensive:!1,mediaType:i,rmrReason:a,downloadOrigin:o}))}))).apply(this,arguments)}function k(){return G.apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e){const{mimetype:t}=e,r=b.ServerProps.webLargeFilesUi?(0,o.default)((t=>{e.mediaObject.consolidate({loadedSize:t.loaded})}),u.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,n=yield p.downloadManager.downloadAndDecrypt({directPath:e.directPath,encFilehash:e.encFilehash,filehash:e.objFilehash,isFinalRmrRetry:e.isFinalRmrRetry,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,signal:e.signal,staticUrl:e.staticUrl,type:e.mediaType,onDecryptStart:()=>{e.mediaObject.consolidate({downloadStage:E.DOWNLOAD_STAGE.PROCESSING})},onProgress:r,userDownloadAttemptCount:e.mediaObject.userDownloadAttemptCount,downloadOrigin:e.downloadOrigin,mode:e.mode,progressiveJpegOpts:B({scanLengths:e.scanLengths,scansSidecar:e.scansSidecar,mimetype:t,mediaObject:e.mediaObject}),isViewOnce:e.isViewOnce}),i=null!=t&&""!==t?t:(0,T.getMediaMimeType)(e.mediaType,new Uint8Array(n));return new Blob([n],{type:i})}))).apply(this,arguments)}function U(){return F.apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,downloadEvenIfExpensive:i,mediaType:o,signal:l,rmrReason:u,rmrData:v,downloadOrigin:T,shouldThrow:b,isVcardOverMmsDocument:M,mode:O,isAutoDownload:R,isFinalRmrRetry:D,isViewOnce:L}=e;if(!r)return;const G=r.filehash;if(!G)return;if(r.downloadPromise)return r.downloadPromise;if(r.downloadStage===E.DOWNLOAD_STAGE.ERROR_MISSING)return;if(r.downloadStage===E.DOWNLOAD_STAGE.PREPARING)return;if(r.mediaBlob){return(yield r.mediaBlob.validate())?void r.consolidate({downloadStage:E.DOWNLOAD_STAGE.RESOLVED}):(r.clearBlob(),r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}),void r.notifyMsgsAsync())}const F=g.MediaBlobCache.get(G);let x,B;const K=new n;return(0,A.default)([K.signal,l].filter(Boolean),(e=>{const l=function(){var n=(0,a.default)((function*(){if(F)B=F;else{if(x=r.entries.getDownloadEntry(),!x){if(!i)return void r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE});if(yield p.downloadManager.rmr({mediaObject:r,signal:e,rmrReason:u,rmrData:v}),x=r.entries.getDownloadEntry(),!x)throw new I}r.consolidate({downloadStage:E.DOWNLOAD_STAGE.FETCHING}),x=(0,d.default)(x,"entry");const{encFilehash:n,scansSidecar:a,scanLengths:s,directPath:l,mediaKey:c,mediaKeyTimestamp:f,staticUrl:_}=x;if(!n)throw x.markWhetherOnServer(!1),new w;const h=yield k({directPath:l,encFilehash:n,objFilehash:G,isFinalRmrRetry:D,mediaKey:c,mediaKeyTimestamp:f,signal:e,staticUrl:_,mediaType:o,mediaObject:r,downloadOrigin:T,mode:O,scanLengths:s,mimetype:t,scansSidecar:a,isViewOnce:L});B=o===y.MEDIA_TYPES.PTT||o===y.MEDIA_TYPES.AUDIO?yield m.transcode(h):h}if("text/vcard"===B.type&&M)try{const e=yield(0,h.blobToText)(B);if(e){const t=(0,P.parseMultiVcard)(e);t.length>0?r.consolidate({parsedVcards:t}):(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("vcard_over_mms:Failed to parse vcard over mms contents"))}}catch(e){__LOG__(4,void 0,new Error,!0)`Failed to retrieve blob text contents ${String(e)}`,SEND_LOGS(`vcard_over_mms:blobToText failed with error: ${String(e)}`)}if((0,S.shouldUseMediaCache)(o))R||(g.MediaBlobCache.put(G,B),yield(0,S.gatherAndSetMetadataNoOpaque)(r,B));else{const e=yield C.default.createFromData(B,B.type);yield(0,S.gatherAndSetMetadata)(r,e)}return r.consolidate({downloadStage:E.DOWNLOAD_STAGE.RESOLVED}),r.downloadPromise=null,r.resolveWhenConsolidated()}));return function(){return n.apply(this,arguments)}}()().catch((0,c.filteredCatch)(f.MediaNotFoundError,function(){var e=(0,a.default)((function*(e){if(!x)throw e;if(x.markWhetherOnServer(!1),!i)throw e;return yield p.downloadManager.rmr({mediaObject:r,signal:(new n).signal,rmrReason:u,rmrData:v}),r.downloadPromise=null,U({mimetype:t,mediaObject:r,downloadEvenIfExpensive:!1,mediaType:o,rmrReason:u,rmrData:v,downloadOrigin:T,isFinalRmrRetry:!0,isVcardOverMmsDocument:M,mode:O,isAutoDownload:R})}));return function(){return e.apply(this,arguments)}}())).catch((0,c.filteredCatch)(_.MediaUnsupportedError,(e=>{if(r.consolidate({downloadStage:E.DOWNLOAD_STAGE.ERROR_UNSUPPORTED}),__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media unsupported error:"),b)throw e}))).catch((0,c.filteredCatch)(f.MediaNotOnPhone,(e=>{if(r.consolidate({downloadStage:E.DOWNLOAD_STAGE.ERROR_MISSING}),b)throw e}))).catch((0,c.filteredCatch)([I,w],(e=>{if(r.consolidate({downloadStage:E.DOWNLOAD_STAGE.ERROR_MISSING}),__LOG__(3)`Unexpected download error: ${e.name}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS(`unexpected download error: ${e.name}`),b)throw e}))).catch((0,c.filteredCatch)(f.MediaDecryptionError,(e=>{if(r.consolidate({downloadStage:E.DOWNLOAD_STAGE.ERROR_MISSING}),b)throw e}))).catch((e=>{if(r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}),e instanceof _.MediaLoadError){if(__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media load error:"),b)throw e}else if(e instanceof _.TranscodeBlobTooLargeError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: transcode blob too large"),b)throw e}else if(e instanceof _.UnableToPlayVideoError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: unable to play video"),b)throw e}else if(e.name!==s.ABORT_ERROR){if(__LOG__(2)`downloadMedia: error`,b)throw e}else if(b)throw e})).finally((()=>{r.downloadPromise=null}));return N.set(l,(()=>{K.abort()})),r.downloadPromise=l,l}))}))).apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,mediaType:i}=e;const{filehash:a}=r;if(!a)return;if(r.downloadStage!==E.DOWNLOAD_STAGE.INIT)return;if(yield K(r))return;const o=g.MediaBlobCache.get(a),s=new n;if(o)return void(r.downloadStage===E.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:E.DOWNLOAD_STAGE.EXISTS}));const l=r.entries.getDownloadEntry();if(!l)return void(r.downloadStage===E.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}));const{encFilehash:c}=l;if(!c)return l.markWhetherOnServer(!1),void(r.downloadStage===E.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}));try{yield p.downloadManager.checkExistence({directPath:l.directPath,encFilehash:c,signal:s.signal,type:i}),r.downloadStage===E.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:E.DOWNLOAD_STAGE.EXISTS})}catch(e){r.downloadStage===E.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}),__LOG__(2)`checkExistence: error`}}))).apply(this,arguments)}function B(e){const{scanLengths:t,scansSidecar:r,mimetype:n,mediaObject:i}=e;if(!function(e,t){return!!(e&&t&&e.length>=2&&10*e.length===t.byteLength)}(t,r))return null;const a=new v.default.WebcProgressiveImage({webcFirstRenderScans:0});return{mimetype:n,scansSidecar:(0,d.default)(r,"scansSidecar"),scanLengths:(0,d.default)(t,"scanLengths"),onProgressiveUpdate:e=>{i.downloadStage!==E.DOWNLOAD_STAGE.RESOLVED&&(i.consolidate({downloadStage:E.DOWNLOAD_STAGE.PROGRESSIVE_READY,progressiveStage:e}),a.webcFirstRenderScans||(a.webcFirstRenderScans=e,a.markWebcFirstRenderT()),e>=R&&!a.webcMidQualityT&&a.markWebcMidQualityT(),e!==D||a.webcFullQualityT||(a.markWebcFullQualityT(),a.commit()))}}}function K(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e){if(!e.mediaBlob)return!1;return(yield e.mediaBlob.validate())?(e.consolidate({downloadStage:E.DOWNLOAD_STAGE.RESOLVED}),!0):(e.clearBlob(),e.consolidate({downloadStage:E.DOWNLOAD_STAGE.NEED_POKE}),e.notifyMsgsAsync(),!1)}))).apply(this,arguments)}},70996:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadMediaResultKind=void 0,t.cancelUploadMedia=function(e){const{uploadPromise:t}=e;if(null==t)return;const r=b.get(t);if(null==r)return;b.delete(t),r()},t.getBlobFromMediaObject=w,t.getOrDownloadBlob=O,t.uploadMedia=function(e){let{mimetype:t,mediaObject:r,mediaType:i,forwardedFromWeb:o,uploadOrigin:d,mediaKeyInfo:u,isViewOnce:E}=e;if(r.uploadPromise)return r.uploadPromise;const S=new n,{signal:v}=S,T=Promise.resolve().then((()=>{r.consolidate({uploadStage:g.UPLOAD_STAGE.UPLOADING})})).then((()=>O({mediaObject:r,mimetype:t,mediaType:i,abortSignal:v,uploadOrigin:d}))).then(function(){var e=(0,a.default)((function*(e){const t=r.entries.getUploadEntry();t&&u&&(0,c.default)(t.mediaKey===u.key,"uploadEntry.mediaKey and mediaKeyInfo.mediaKey should be the same");const n=yield function(){return M.apply(this,arguments)}({blob:e,forwardedFromWeb:o,mediaKeyInfo:u,mediaObject:r,mediaType:i,signal:v,uploadEntry:t,uploadOrigin:d,isViewOnce:E});if(!n)throw new Error("could not create media entry");if((i===m.MEDIA_TYPES.PTT||i===m.MEDIA_TYPES.AUDIO)&&!y.canPlayOgg())if(y.shouldUseMediaCache(i)){const e=r.filehash;if(e&&r.mediaBlob)return h.transcode(r.mediaBlob.formData()).then((t=>{_.MediaBlobCache.put(e,t)})).then((()=>n))}else if(r.mediaBlob)return y.gatherAndSetMetadata(r,r.mediaBlob).then((()=>n));return n}));return function(){return e.apply(this,arguments)}}()).then((e=>{if(v.aborted)throw new f.AbortError;return r.consolidate({uploadStage:g.UPLOAD_STAGE.UPLOADED}),__LOG__(2)`MediaAlgo.uploadMedia: success`,{kind:P.SUCCESS,mediaEntry:e}})).catch((e=>{throw e.name===s.ABORT_ERROR?__LOG__(2)`MediaAlgo.uploadMedia: canceled`:__LOG__(3)`MediaAlgo.uploadMedia: error`,e})).finally((()=>{delete r.uploadPromise})).catch((0,l.filteredCatch)(f.FileNotReadableError,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE}),{kind:P.ERROR})))).catch((0,l.filteredCatch)(p.MediaNotOnPhone,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_MISSING}),{kind:P.ERROR})))).catch((0,l.filteredCatch)(f.MediaTooLargeError,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_TOO_LARGE}),{kind:P.ERROR})))).catch((e=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.NEED_UPLOAD}),e.name===s.ABORT_ERROR?{kind:P.CANCELLATION}:{kind:P.ERROR})));return b.set(T,(()=>{S.abort()})),r.uploadPromise=T,T};var a=i(r(48926)),o=i(r(23493)),s=r(89385),l=r(50796),c=i(r(41143)),d=r(691),u=i(r(51127)),p=r(37115),f=r(60363),_=r(84866),h=A(r(97692)),g=r(58668),m=r(61596),y=A(r(56406)),E=i(r(11339)),S=r(9329),v=r(64551),T=i(r(11105));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(C=function(e){return e?r:t})(e)}function A(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=C(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const b=new WeakMap;const P={SUCCESS:"success",CANCELLATION:"cancellation",ERROR:"error",TIMEOUT:"timeout"};function M(){return(M=(0,a.default)((function*(e){let{blob:t,forwardedFromWeb:r,mediaKeyInfo:n,mediaObject:i,mediaType:a,signal:s,uploadEntry:l,uploadOrigin:c,isViewOnce:p}=e;if(null==l?void 0:l.canReuseMediaKey())return(0,u.default)(a,c,0,r,p).handleCheckExistingSuccess(),l;const f=n?n.key:null==l?void 0:l.mediaKey,_=n?n.timestamp:null==l?void 0:l.mediaKeyTimestamp,h=v.ServerProps.webLargeFilesUi?(0,o.default)(((e,t)=>{const r=e.loaded+t;Number.isFinite(r)&&i.consolidate({loadedSize:r})}),d.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,{directPath:g,encFilehash:m,mediaKey:y,mediaKeyTimestamp:E,url:S,sidecar:C,firstFrameSidecar:A}=yield T.default.encryptAndUpload({blob:t,mediaKey:f,mediaKeyTimestamp:_,type:a,signal:s,userUploadAttemptCount:i.userUploadAttemptCount,forwardedFromWeb:r,uploadOrigin:c,onProgress:h,isViewOnce:p});return i.entries.addEntry({deprecatedMms3Url:S,mediaKey:y,mediaKeyTimestamp:E,encFilehash:m,type:a,sidecar:C,directPath:g,firstFrameSidecar:A,debugHint:"upload"})}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){let{mediaObject:t,mimetype:r,mediaType:n,abortSignal:i,uploadOrigin:a}=e;const o=w(t);if(o)return o;if(yield(0,S.downloadMedia)({mimetype:r,mediaObject:t,downloadEvenIfExpensive:!0,mediaType:n,signal:i,rmrReason:E.default.WEBC_RMR_REASON_CODE.UPLOAD,downloadOrigin:a===E.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL?E.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL:E.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP,mode:"manual"}),t.downloadStage===g.DOWNLOAD_STAGE.ERROR_MISSING)throw new p.MediaNotOnPhone;const s=w(t);if(s)return s;throw new Error("cant upload media w/out mediaBlob after download")}))).apply(this,arguments)}function w(e){const t=e.mediaBlob;return t?t.formData():e.filehash?_.MediaBlobCache.get(e.filehash):void 0}t.UploadMediaResultKind=P},27989:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=Promise.resolve().then((()=>{var r;const n=e.size();let c;c=t.asDocument?a.FILETYPE.DOCUMENT:t.asSticker?a.FILETYPE.STICKER:(0,a.typeFromMimetype)(e.type());const d=null!==(r=t.isVcardOverMmsDocument)&&void 0!==r&&r;if(n>function(e,t){if(e===a.FILETYPE.DOCUMENT)return t?1024*l.ServerProps.vcardMaxSizeKb:(0,l.getMaxFilesSizeServerProp)();return l.ServerProps.media}(c,d))throw new o.default(e);if(n<=0)throw new i.MediaFileEmpty;let u;switch(null!=t.gifAttribution?u=t.gifAttribution:t.asGif&&(u=0),c){case"image":return s.processRawImage(e,{minDimension:t.minDimension,transparency:t.transparency});case"sticker":return s.processRawSticker(e);case"video":case"audio":return s.processRawAudioVideo(e,!!t.isPtt,t.precomputedFields,t.asGif,u,e.type());case"document":return s.processRawDocument(e,t.filename,d,t.documentPageCount);default:throw new Error("Received unsupported mediaType: "+c)}}));return e.retain(),e.autoreleaseWhenPromiseCompletes(r),r};var i=d(r(64103)),a=r(1063),o=n(r(97390)),s=d(r(56406)),l=r(64551);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},3151:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RequestMediaReuploadManagerImpl=t.RequestMediaReuploadManager=void 0;var i=n(r(48926)),a=n(r(45095)),o=n(r(27184));class s{constructor(){var e=this;this._rmrRequests=new Map,this.requestMediaReupload=function(){var t=(0,i.default)((function*(t){const r=t.id.id,n=e._rmrRequests.get(r);if(n)return(0,a.default)(n.request,"existingRequest.request");const i=new Promise(((n,i)=>{e._rmrRequests.set(r,{resolve:n,reject:i,msg:t})}));return(0,a.default)(e._rmrRequests.get(r),"_this._rmrRequests.get(msgId)").request=i,yield(0,o.default)(t),i}));return function(){return t.apply(this,arguments)}}(),this.resolveMediaReupload=e=>{let{msgId:t,result:r,directPath:n}=e;const i=this._rmrRequests.get(t);null!=i?(i.resolve({result:r,directPath:n}),this._rmrRequests.delete(t)):__LOG__(3)`resolveMediaReupload: msgId (${t}) is not found in _rmrRequests`},this.getMediaKey=e=>{var t;return null===(t=this._rmrRequests.get(e))||void 0===t?void 0:t.msg.mediaKey}}}t.RequestMediaReuploadManagerImpl=s;const l=new s;t.RequestMediaReuploadManager=l},2603:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(97563);function o(){return(o=(0,i.default)((function*(e,t){yield(0,a.updateLocal)(e.id,t),e.set(t)}))).apply(this,arguments)}},74460:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(89385),s=r(40265),l=r(38284),c=r(21009),d=(n(r(11339)),r(70996)),u=n(r(84644)),p=r(28080);function f(){return(f=(0,a.default)((function*(e){const{thumbnail:t,mediaType:r,mediaKeyInfo:n,uploadOrigin:f,forwardedFromWeb:_,timeout:h,signal:g,isViewOnce:m}=e,y=new c.MediaObject;try{return null==h?yield E():yield(0,l.promiseTimeout)(E(),h)}catch(e){const t=e;if(t instanceof s.TimeoutError)return(0,d.cancelUploadMedia)(y),{kind:d.UploadMediaResultKind.TIMEOUT};throw t}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(){try{const e=yield(0,u.default)((0,p.getHash)(t),g);y.filehash=e,y.mediaBlob=t;const a=yield(0,u.default)((0,d.uploadMedia)({mimetype:"image/jpeg",mediaObject:y,mediaType:r,forwardedFromWeb:_,uploadOrigin:f,mediaKeyInfo:n,isViewOnce:m}),g);return a.kind===d.UploadMediaResultKind.SUCCESS?(0,i.default)((0,i.default)({},a),{},{filehash:e}):{kind:a.kind}}catch(e){const t=e;if("object"==typeof t&&(null==t?void 0:t.name)===o.ABORT_ERROR)return(0,d.cancelUploadMedia)(y),{kind:d.UploadMediaResultKind.CANCELLATION}}}))).apply(this,arguments)}}))).apply(this,arguments)}},87798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n.Clock.globalUnixTime()-e<i.ServerProps.mmsMediaKeyTTL+Math.floor(86400*Math.random())};var n=r(22683),i=r(64551)},65212:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(87614),a=n(r(89867)),o=r(45454),s=n(r(5030)),l=r(99234),c=r(7293);class d{constructor(e){let t=e;if(!t)throw new Error("MsgKey error: obj is null/undefined");t.id instanceof d&&(t=t.id,__LOG__(3)`MsgKey error: id is already a MsgKey`);const r=t.from&&t.to&&t.id,n=void 0!==t.fromMe&&t.remote&&t.id;let i,o,s,u,p,f,_;const h=(0,l.getMaybeMeUser)();if(!h)throw new Error("MsgKey error: me is undefined");if(r&&n)throw __LOG__(3)`Unclear constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: unclear which constructor to use");if(!r&&!n)throw __LOG__(3)`No matching constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: don't have a matching constructor");if(r){if(({from:i,to:o,id:s,participant:u,selfDir:p}=t),!(i instanceof a.default)||!(o instanceof a.default)||u&&!(u instanceof a.default))throw __LOG__(3)`Incorrect Wid MsgKey: from:${String(i)} to:${String(o)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");p=a.default.equals(i,o)?p:void 0,a.default.equals(i,o)&&a.default.equals(i,h)?(f="out"===p,_=h):a.default.equals(i,h)?(f=!0,_=o):a.default.equals(o,h)?(f=!1,_=i):a.default.equals(i,o)&&(a.default.isGroup(i)||a.default.isBroadcast(i))?(f=!0,_=i):__LOG__(3)`MsgKey case error: ${[i,o,s,h].join()}`,void 0!==f&&(this.fromMe=f),_&&(this.remote=_),s&&(this.id=s)}else if(n){if(({fromMe:f,remote:_,id:s,participant:u}=t),!(_ instanceof a.default)||u&&!(u instanceof a.default))throw __LOG__(3)`Incorrect Wid MsgKey: remote:${String(_)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");a.default.equals(h,_)&&(p=f?"out":"in"),void 0!==f&&(this.fromMe=f),_&&(this.remote=_),s&&(this.id=s)}const g=[this.fromMe,this.remote,this.id];void 0!==p&&(this.self=p,g.push(this.self));c.GK.supportsAnyFeature(c.GK.F.KEY_PARTICIPANT,c.GK.F.MD_BACKEND)&&void 0!==u&&(this.participant=u,g.push(this.participant)),this._serialized=g.join("_")}toString(){return this._serialized}clone(){return new d({fromMe:this.fromMe,remote:this.remote,id:this.id,participant:this.participant})}equals(e){return e instanceof d&&this.toString()===e.toString()}static fromString(e){const{fromMe:t,remote:r,id:n,participant:i}=(0,s.default)(e);return new d({fromMe:t,remote:(0,o.createWid)(r),id:n,participant:i?(0,o.createWid)(i):void 0})}static newId(){return"3EB0"+(0,i.randomHex)(8)}}t.default=d},5030:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e||!(0,n.isString)(e))throw new Error("MsgKey fromString error: str is null or not a string");const t=e.split("_");let r;t.length<3?__LOG__(3)`MsgKey error: cannot create MsgKey from ${e}`:4===t.length?"out"!==t[3]&&"in"!==t[3]&&(r=t[3]):5===t.length&&(r=t[4]);return{fromMe:"true"===t[0],remote:t[1],id:t[2],participant:r}};var n=r(31515)},61653:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NuxKeyTypes=t.NUX=t.CoolOffPeriodKeys=void 0;n(r(11339));t.NUX={SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community"};t.NuxKeyTypes={COOL_OFF_NUX:{INCOMPLETE_BUSINESS_PROFILE_BANNER:"incomplete_business_profile_banner",PRODUCT_CATALOG_BANNER:"product_catalog_banner",COLLECTIONS:"collections_banner",CART_INTERSTITIAL:"cart_interstitial"},VIEW_COUNT_NUX:{SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community"}};t.CoolOffPeriodKeys={DEFAULT:"default_cool_off_banners_key",CATALOG:"catalog_banners_key"}},36677:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUX_SYNC_KEY_LIST=void 0,t.addToLocalNuxSyncList=function(e){const t=new Set((0,n.getNuxSyncList)());t.add(...e),(0,n.setNuxSyncList)(Array.from(t))},t.nuxExistsInNuxSync=function(e){return(0,n.getNuxSyncList)().includes(e)};var n=r(99234);const i=r(76672).Mirrored([]);t.NUX_SYNC_KEY_LIST=i},59182:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(39930));let a;if("undefined"!=typeof self)a=self;else{if(void 0===r.g)throw new Error("Couldn't get global object");a=r.g}var o="AbortController"in a?a.AbortController:class{constructor(){this.signal=new i.default}abort(){const e=new Event("abort");this.signal.dispatchEvent(e)}};t.default=o},39930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(90120)),a=class extends i.default{constructor(){super(),this.aborted=!1}dispatchEvent(e){return"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}toString(){return"[object AbortSignal]"}};t.default=a},90120:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));t.default=class{constructor(){this._emitter=new i.default}addEventListener(e,t){this._emitter.on(e,t,this)}removeEventListener(e,t){this._emitter.off(e,t,this)}dispatchEvent(e){return this._emitter.trigger(e.type),!0}}},61438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADVSignedKeyIndexListSpec=t.ADVSignedDeviceIdentitySpec=t.ADVSignedDeviceIdentityHMACSpec=t.ADVKeyIndexListSpec=t.ADVDeviceIdentitySpec=void 0;var n=r(1390);const i={};t.ADVKeyIndexListSpec=i;const a={};t.ADVSignedKeyIndexListSpec=a;const o={};t.ADVDeviceIdentitySpec=o;const s={};t.ADVSignedDeviceIdentitySpec=s;const l={};t.ADVSignedDeviceIdentityHMACSpec=l,i.internalSpec={rawId:[1,n.TYPES.UINT32],timestamp:[2,n.TYPES.UINT64],currentIndex:[3,n.TYPES.UINT32],validIndexes:[4,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},a.internalSpec={details:[1,n.TYPES.BYTES],accountSignature:[2,n.TYPES.BYTES]},o.internalSpec={rawId:[1,n.TYPES.UINT32],timestamp:[2,n.TYPES.UINT64],keyIndex:[3,n.TYPES.UINT32]},s.internalSpec={details:[1,n.TYPES.BYTES],accountSignatureKey:[2,n.TYPES.BYTES],accountSignature:[3,n.TYPES.BYTES],deviceSignature:[4,n.TYPES.BYTES]},l.internalSpec={details:[1,n.TYPES.BYTES],hmac:[2,n.TYPES.BYTES]}},98263:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompanionPropsSpec=t.CompanionPropsPlatformType=t.CompanionProps$AppVersionSpec=void 0;var n=r(1390);const i=r(76672)({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12});t.CompanionPropsPlatformType=i;const a={};t.CompanionPropsSpec=a;const o={};t.CompanionProps$AppVersionSpec=o,a.internalSpec={os:[1,n.TYPES.STRING],version:[2,n.TYPES.MESSAGE,o],platformType:[3,n.TYPES.ENUM,i],requireFullSync:[4,n.TYPES.BOOL]},o.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},24808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message$StickerMessageSpec=t.Message$SenderKeyDistributionMessageSpec=t.Message$SendPaymentMessageSpec=t.Message$RequestPaymentMessageSpec=t.Message$ReactionMessageSpec=t.Message$ProtocolMessageType=t.Message$ProtocolMessageSpec=t.Message$ProductMessageSpec=t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessageServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessageOrderSurface=t.Message$OrderMessageOrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessageListType=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListMessageSpec=t.Message$ListMessageListType=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessageAttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSurface=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotificationHistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessageGroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessagePreviewType=t.Message$ExtendedTextMessageInviteLinkGroupType=t.Message$ExtendedTextMessageFontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageType=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessageHeaderType=t.Message$ButtonsMessage$ButtonType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfoMediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfoMediaType=t.ActionLinkSpec=void 0,t.TemplateButtonSpec=t.TemplateButton$URLButtonSpec=t.TemplateButton$QuickReplyButtonSpec=t.TemplateButton$CallButtonSpec=t.PollUpdateMessageSpec=t.PollUpdateMessageContentSpec=t.PollUpdateMessageContent$PollVoteMessageSpec=t.PollCreationMessageSpec=t.PollCreationMessage$OptionSpec=t.PointSpec=t.PaymentBackgroundType=t.PaymentBackgroundSpec=t.PaymentBackground$MediaDataSpec=t.MoneySpec=t.MessageSpec=t.MessageContextInfoSpec=t.Message$VideoMessageSpec=t.Message$VideoMessageAttribution=t.Message$TemplateMessageSpec=t.Message$TemplateMessage$HydratedFourRowTemplateSpec=t.Message$TemplateMessage$FourRowTemplateSpec=t.Message$TemplateButtonReplyMessageSpec=t.Message$StickerSyncRMRMessageSpec=t.Message$StickerMessageSpec=t.Message$SenderKeyDistributionMessageSpec=t.Message$SendPaymentMessageSpec=t.Message$RequestPaymentMessageSpec=t.Message$ReactionMessageSpec=t.Message$ProtocolMessageType=t.Message$ProtocolMessageSpec=t.Message$ProductMessageSpec=t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessageServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessageOrderSurface=t.Message$OrderMessageOrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessageListType=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListMessageSpec=t.Message$ListMessageListType=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessageAttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSurface=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotificationHistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessageGroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessagePreviewType=t.Message$ExtendedTextMessageInviteLinkGroupType=t.Message$ExtendedTextMessageFontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageType=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessageHeaderType=t.Message$ButtonsMessage$ButtonType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfoMediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfoMediaType=t.ActionLinkSpec=void 0;var n=r(1390),i=r(93890);const a=r(76672)({UNKNOWN:0,DISPLAY_TEXT:1});t.Message$ButtonsResponseMessageType=a;const o=r(76672)({UNKNOWN:0,RESPONSE:1,NATIVE_FLOW:2});t.Message$ButtonsMessage$ButtonType=o;const s=r(76672)({UNKNOWN:0,EMPTY:1,TEXT:2,DOCUMENT:3,IMAGE:4,VIDEO:5,LOCATION:6});t.Message$ButtonsMessageHeaderType=s;const l=r(76672)({DEFAULT:0,PARENT:1});t.Message$GroupInviteMessageGroupType=l;const c=r(76672)({UNKNOWN_SURFACE:0,FB:1,IG:2,WA:3});t.Message$InteractiveMessage$ShopMessageSurface=c;const d=r(76672)({UNKNOWN:0,SINGLE_SELECT:1});t.Message$ListResponseMessageListType=d;const u=r(76672)({UNKNOWN:0,SINGLE_SELECT:1,PRODUCT_LIST:2});t.Message$ListMessageListType=u;const p=r(76672)({CATALOG:1});t.Message$OrderMessageOrderSurface=p;const f=r(76672)({INQUIRY:1});t.Message$OrderMessageOrderStatus=f;const _=r(76672)({UNKNOWN:0,FBPAY:1,NOVI:2,UPI:3});t.Message$PaymentInviteMessageServiceType=_;const h=r(76672)({GREGORIAN:1,SOLAR_HIJRI:2});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=h;const g=r(76672)({MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=g;const m=r(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.Message$HistorySyncNotificationHistorySyncType=m;const y=r(76672)({REVOKE:0,EPHEMERAL_SETTING:3,EPHEMERAL_SYNC_RESPONSE:4,HISTORY_SYNC_NOTIFICATION:5,APP_STATE_SYNC_KEY_SHARE:6,APP_STATE_SYNC_KEY_REQUEST:7,MSG_FANOUT_BACKFILL_REQUEST:8,INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:9,APP_STATE_FATAL_EXCEPTION_NOTIFICATION:10});t.Message$ProtocolMessageType=y;const E=r(76672)({NONE:0,GIPHY:1,TENOR:2});t.Message$VideoMessageAttribution=E;const S=r(76672)({DEFAULT:0,PARENT:1});t.Message$ExtendedTextMessageInviteLinkGroupType=S;const v=r(76672)({NONE:0,VIDEO:1});t.Message$ExtendedTextMessagePreviewType=v;const T=r(76672)({SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5});t.Message$ExtendedTextMessageFontType=T;const C=r(76672)({IMAGE:0,PDF:1});t.Message$InvoiceMessageAttachmentType=C;const A=r(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$ExternalAdReplyInfoMediaType=A;const b=r(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$AdReplyInfoMediaType=b;const P=r(76672)({UNKNOWN:0,DEFAULT:1});t.PaymentBackgroundType=P;const M=r(76672)({CHANGED_IN_CHAT:0,INITIATED_BY_ME:1,INITIATED_BY_OTHER:2});t.DisappearingModeInitiator=M;const O={};t.MessageSpec=O;const I={};t.Message$StickerSyncRMRMessageSpec=I;const w={};t.Message$ReactionMessageSpec=w;const R={};t.Message$ButtonsResponseMessageSpec=R;const D={};t.Message$ButtonsMessageSpec=D;const N={};t.Message$ButtonsMessage$ButtonSpec=N;const L={};t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=L;const k={};t.Message$ButtonsMessage$Button$ButtonTextSpec=k;const G={};t.Message$FutureProofMessageSpec=G;const U={};t.Message$DeviceSentMessageSpec=U;const F={};t.Message$GroupInviteMessageSpec=F;const x={};t.Message$InteractiveResponseMessageSpec=x;const B={};t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=B;const K={};t.Message$InteractiveResponseMessage$BodySpec=K;const j={};t.Message$InteractiveMessageSpec=j;const Y={};t.Message$InteractiveMessage$NativeFlowMessageSpec=Y;const W={};t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=W;const H={};t.Message$InteractiveMessage$CollectionMessageSpec=H;const V={};t.Message$InteractiveMessage$ShopMessageSpec=V;const $={};t.Message$InteractiveMessage$FooterSpec=$;const z={};t.Message$InteractiveMessage$BodySpec=z;const q={};t.Message$InteractiveMessage$HeaderSpec=q;const J={};t.Message$ListResponseMessageSpec=J;const Q={};t.Message$ListResponseMessage$SingleSelectReplySpec=Q;const X={};t.Message$ListMessageSpec=X;const Z={};t.Message$ListMessage$ProductListInfoSpec=Z;const ee={};t.Message$ListMessage$ProductListHeaderImageSpec=ee;const te={};t.Message$ListMessage$ProductSectionSpec=te;const re={};t.Message$ListMessage$ProductSpec=re;const ne={};t.Message$ListMessage$SectionSpec=ne;const ie={};t.Message$ListMessage$RowSpec=ie;const ae={};t.Message$OrderMessageSpec=ae;const oe={};t.Message$ProductMessageSpec=oe;const se={};t.Message$ProductMessage$ProductSnapshotSpec=se;const le={};t.Message$ProductMessage$CatalogSnapshotSpec=le;const ce={};t.Message$TemplateButtonReplyMessageSpec=ce;const de={};t.Message$TemplateMessageSpec=de;const ue={};t.Message$TemplateMessage$HydratedFourRowTemplateSpec=ue;const pe={};t.Message$TemplateMessage$FourRowTemplateSpec=pe;const fe={};t.Message$StickerMessageSpec=fe;const _e={};t.Message$LiveLocationMessageSpec=_e;const he={};t.Message$PaymentInviteMessageSpec=he;const ge={};t.Message$CancelPaymentRequestMessageSpec=ge;const me={};t.Message$DeclinePaymentRequestMessageSpec=me;const ye={};t.Message$RequestPaymentMessageSpec=ye;const Ee={};t.Message$SendPaymentMessageSpec=Ee;const Se={};t.Message$HighlyStructuredMessageSpec=Se;const ve={};t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=ve;const Te={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=Te;const Ce={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=Ce;const Ae={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=Ae;const be={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=be;const Pe={};t.Message$ContactsArrayMessageSpec=Pe;const Me={};t.Message$InitialSecurityNotificationSettingSyncSpec=Me;const Oe={};t.Message$AppStateFatalExceptionNotificationSpec=Oe;const Ie={};t.Message$AppStateSyncKeyRequestSpec=Ie;const we={};t.Message$AppStateSyncKeyShareSpec=we;const Re={};t.Message$AppStateSyncKeyDataSpec=Re;const De={};t.Message$AppStateSyncKeyFingerprintSpec=De;const Ne={};t.Message$AppStateSyncKeyIdSpec=Ne;const Le={};t.Message$AppStateSyncKeySpec=Le;const ke={};t.Message$HistorySyncNotificationSpec=ke;const Ge={};t.Message$ProtocolMessageSpec=Ge;const Ue={};t.Message$ChatSpec=Ue;const Fe={};t.Message$CallSpec=Fe;const xe={};t.Message$VideoMessageSpec=xe;const Be={};t.Message$AudioMessageSpec=Be;const Ke={};t.Message$DocumentMessageSpec=Ke;const je={};t.Message$ExtendedTextMessageSpec=je;const Ye={};t.Message$LocationMessageSpec=Ye;const We={};t.Message$ContactMessageSpec=We;const He={};t.Message$InvoiceMessageSpec=He;const Ve={};t.Message$ImageMessageSpec=Ve;const $e={};t.Message$SenderKeyDistributionMessageSpec=$e;const ze={};t.ContextInfoSpec=ze;const qe={};t.ContextInfo$ExternalAdReplyInfoSpec=qe;const Je={};t.ContextInfo$AdReplyInfoSpec=Je;const Qe={};t.MessageContextInfoSpec=Qe;const Xe={};t.DeviceListMetadataSpec=Xe;const Ze={};t.InteractiveAnnotationSpec=Ze;const et={};t.PointSpec=et;const tt={};t.LocationSpec=tt;const rt={};t.TemplateButtonSpec=rt;const nt={};t.TemplateButton$CallButtonSpec=nt;const it={};t.TemplateButton$URLButtonSpec=it;const at={};t.TemplateButton$QuickReplyButtonSpec=at;const ot={};t.HydratedTemplateButtonSpec=ot;const st={};t.HydratedTemplateButton$HydratedCallButtonSpec=st;const lt={};t.HydratedTemplateButton$HydratedURLButtonSpec=lt;const ct={};t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=ct;const dt={};t.MoneySpec=dt;const ut={};t.PaymentBackgroundSpec=ut;const pt={};t.PaymentBackground$MediaDataSpec=pt;const ft={};t.DisappearingModeSpec=ft;const _t={};t.ActionLinkSpec=_t;const ht={};t.PollCreationMessageSpec=ht;const gt={};t.PollCreationMessage$OptionSpec=gt;const mt={};t.PollUpdateMessageSpec=mt;const yt={};t.PollUpdateMessageContentSpec=yt;const Et={};t.PollUpdateMessageContent$PollVoteMessageSpec=Et,O.internalSpec={conversation:[1,n.TYPES.STRING],senderKeyDistributionMessage:[2,n.TYPES.MESSAGE,$e],imageMessage:[3,n.TYPES.MESSAGE,Ve],contactMessage:[4,n.TYPES.MESSAGE,We],locationMessage:[5,n.TYPES.MESSAGE,Ye],extendedTextMessage:[6,n.TYPES.MESSAGE,je],documentMessage:[7,n.TYPES.MESSAGE,Ke],audioMessage:[8,n.TYPES.MESSAGE,Be],videoMessage:[9,n.TYPES.MESSAGE,xe],call:[10,n.TYPES.MESSAGE,Fe],chat:[11,n.TYPES.MESSAGE,Ue],protocolMessage:[12,n.TYPES.MESSAGE,Ge],contactsArrayMessage:[13,n.TYPES.MESSAGE,Pe],highlyStructuredMessage:[14,n.TYPES.MESSAGE,Se],fastRatchetKeySenderKeyDistributionMessage:[15,n.TYPES.MESSAGE,$e],sendPaymentMessage:[16,n.TYPES.MESSAGE,Ee],liveLocationMessage:[18,n.TYPES.MESSAGE,_e],requestPaymentMessage:[22,n.TYPES.MESSAGE,ye],declinePaymentRequestMessage:[23,n.TYPES.MESSAGE,me],cancelPaymentRequestMessage:[24,n.TYPES.MESSAGE,ge],templateMessage:[25,n.TYPES.MESSAGE,de],stickerMessage:[26,n.TYPES.MESSAGE,fe],groupInviteMessage:[28,n.TYPES.MESSAGE,F],templateButtonReplyMessage:[29,n.TYPES.MESSAGE,ce],productMessage:[30,n.TYPES.MESSAGE,oe],deviceSentMessage:[31,n.TYPES.MESSAGE,U],messageContextInfo:[35,n.TYPES.MESSAGE,Qe],listMessage:[36,n.TYPES.MESSAGE,X],viewOnceMessage:[37,n.TYPES.MESSAGE,G],orderMessage:[38,n.TYPES.MESSAGE,ae],listResponseMessage:[39,n.TYPES.MESSAGE,J],ephemeralMessage:[40,n.TYPES.MESSAGE,G],invoiceMessage:[41,n.TYPES.MESSAGE,He],buttonsMessage:[42,n.TYPES.MESSAGE,D],buttonsResponseMessage:[43,n.TYPES.MESSAGE,R],paymentInviteMessage:[44,n.TYPES.MESSAGE,he],interactiveMessage:[45,n.TYPES.MESSAGE,j],reactionMessage:[46,n.TYPES.MESSAGE,w],stickerSyncRmrMessage:[47,n.TYPES.MESSAGE,I],interactiveResponseMessage:[48,n.TYPES.MESSAGE,x],pollCreationMessage:[49,n.TYPES.MESSAGE,ht],pollUpdateMessage:[50,n.TYPES.MESSAGE,mt]},I.internalSpec={filehash:[1,n.FLAGS.REPEATED|n.TYPES.STRING],rmrSource:[2,n.TYPES.STRING],requestTimestamp:[3,n.TYPES.INT64]},w.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],text:[2,n.TYPES.STRING],groupingKey:[3,n.TYPES.STRING],senderTimestampMs:[4,n.TYPES.INT64]},R.internalSpec={selectedButtonId:[1,n.TYPES.STRING],selectedDisplayText:[2,n.TYPES.STRING],contextInfo:[3,n.TYPES.MESSAGE,ze],type:[4,n.TYPES.ENUM,a],__oneofs__:{response:["selectedDisplayText"]}},D.internalSpec={text:[1,n.TYPES.STRING],documentMessage:[2,n.TYPES.MESSAGE,Ke],imageMessage:[3,n.TYPES.MESSAGE,Ve],videoMessage:[4,n.TYPES.MESSAGE,xe],locationMessage:[5,n.TYPES.MESSAGE,Ye],contentText:[6,n.TYPES.STRING],footerText:[7,n.TYPES.STRING],contextInfo:[8,n.TYPES.MESSAGE,ze],buttons:[9,n.FLAGS.REPEATED|n.TYPES.MESSAGE,N],headerType:[10,n.TYPES.ENUM,s],__oneofs__:{header:["text","documentMessage","imageMessage","videoMessage","locationMessage"]}},N.internalSpec={buttonId:[1,n.TYPES.STRING],buttonText:[2,n.TYPES.MESSAGE,k],type:[3,n.TYPES.ENUM,o],nativeFlowInfo:[4,n.TYPES.MESSAGE,L]},L.internalSpec={name:[1,n.TYPES.STRING],paramsJson:[2,n.TYPES.STRING]},k.internalSpec={displayText:[1,n.TYPES.STRING]},G.internalSpec={message:[1,n.TYPES.MESSAGE,O]},U.internalSpec={destinationJid:[1,n.TYPES.STRING],message:[2,n.TYPES.MESSAGE,O],phash:[3,n.TYPES.STRING]},F.internalSpec={groupJid:[1,n.TYPES.STRING],inviteCode:[2,n.TYPES.STRING],inviteExpiration:[3,n.TYPES.INT64],groupName:[4,n.TYPES.STRING],jpegThumbnail:[5,n.TYPES.BYTES],caption:[6,n.TYPES.STRING],contextInfo:[7,n.TYPES.MESSAGE,ze],groupType:[8,n.TYPES.ENUM,l]},x.internalSpec={body:[1,n.TYPES.MESSAGE,K],nativeFlowResponseMessage:[2,n.TYPES.MESSAGE,B],contextInfo:[15,n.TYPES.MESSAGE,ze],__oneofs__:{interactiveResponseMessage:["nativeFlowResponseMessage"]}},B.internalDefaults={version:1},B.internalSpec={name:[1,n.TYPES.STRING],paramsJson:[2,n.TYPES.STRING],version:[3,n.TYPES.INT32]},K.internalSpec={text:[1,n.TYPES.STRING]},j.internalSpec={header:[1,n.TYPES.MESSAGE,q],body:[2,n.TYPES.MESSAGE,z],footer:[3,n.TYPES.MESSAGE,$],shopStorefrontMessage:[4,n.TYPES.MESSAGE,V],collectionMessage:[5,n.TYPES.MESSAGE,H],nativeFlowMessage:[6,n.TYPES.MESSAGE,Y],contextInfo:[15,n.TYPES.MESSAGE,ze],__oneofs__:{interactiveMessage:["shopStorefrontMessage","collectionMessage","nativeFlowMessage"]}},Y.internalDefaults={messageVersion:1},Y.internalSpec={buttons:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,W],messageParamsJson:[2,n.TYPES.STRING],messageVersion:[3,n.TYPES.INT32]},W.internalSpec={name:[1,n.TYPES.STRING],buttonParamsJson:[2,n.TYPES.STRING]},H.internalDefaults={messageVersion:1},H.internalSpec={bizJid:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING],messageVersion:[3,n.TYPES.INT32]},V.internalDefaults={messageVersion:1},V.internalSpec={id:[1,n.TYPES.STRING],surface:[2,n.TYPES.ENUM,c],messageVersion:[3,n.TYPES.INT32]},$.internalSpec={text:[1,n.TYPES.STRING]},z.internalSpec={text:[1,n.TYPES.STRING]},q.internalSpec={title:[1,n.TYPES.STRING],subtitle:[2,n.TYPES.STRING],documentMessage:[3,n.TYPES.MESSAGE,Ke],imageMessage:[4,n.TYPES.MESSAGE,Ve],jpegThumbnail:[6,n.TYPES.BYTES],videoMessage:[7,n.TYPES.MESSAGE,xe],hasMediaAttachment:[5,n.TYPES.BOOL],__oneofs__:{media:["documentMessage","imageMessage","jpegThumbnail","videoMessage"]}},J.internalSpec={title:[1,n.TYPES.STRING],listType:[2,n.TYPES.ENUM,d],singleSelectReply:[3,n.TYPES.MESSAGE,Q],contextInfo:[4,n.TYPES.MESSAGE,ze],description:[5,n.TYPES.STRING]},Q.internalSpec={selectedRowId:[1,n.TYPES.STRING]},X.internalSpec={title:[1,n.TYPES.STRING],description:[2,n.TYPES.STRING],buttonText:[3,n.TYPES.STRING],listType:[4,n.TYPES.ENUM,u],sections:[5,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ne],productListInfo:[6,n.TYPES.MESSAGE,Z],footerText:[7,n.TYPES.STRING],contextInfo:[8,n.TYPES.MESSAGE,ze]},Z.internalSpec={productSections:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,te],headerImage:[2,n.TYPES.MESSAGE,ee],businessOwnerJid:[3,n.TYPES.STRING]},ee.internalSpec={productId:[1,n.TYPES.STRING],jpegThumbnail:[2,n.TYPES.BYTES]},te.internalSpec={title:[1,n.TYPES.STRING],products:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,re]},re.internalSpec={productId:[1,n.TYPES.STRING]},ne.internalSpec={title:[1,n.TYPES.STRING],rows:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ie]},ie.internalSpec={title:[1,n.TYPES.STRING],description:[2,n.TYPES.STRING],rowId:[3,n.TYPES.STRING]},ae.internalSpec={orderId:[1,n.TYPES.STRING],thumbnail:[2,n.TYPES.BYTES],itemCount:[3,n.TYPES.INT32],status:[4,n.TYPES.ENUM,f],surface:[5,n.TYPES.ENUM,p],message:[6,n.TYPES.STRING],orderTitle:[7,n.TYPES.STRING],sellerJid:[8,n.TYPES.STRING],token:[9,n.TYPES.STRING],totalAmount1000:[10,n.TYPES.INT64],totalCurrencyCode:[11,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,ze]},oe.internalSpec={product:[1,n.TYPES.MESSAGE,se],businessOwnerJid:[2,n.TYPES.STRING],catalog:[4,n.TYPES.MESSAGE,le],body:[5,n.TYPES.STRING],footer:[6,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,ze]},se.internalSpec={productImage:[1,n.TYPES.MESSAGE,Ve],productId:[2,n.TYPES.STRING],title:[3,n.TYPES.STRING],description:[4,n.TYPES.STRING],currencyCode:[5,n.TYPES.STRING],priceAmount1000:[6,n.TYPES.INT64],retailerId:[7,n.TYPES.STRING],url:[8,n.TYPES.STRING],productImageCount:[9,n.TYPES.UINT32],firstImageId:[11,n.TYPES.STRING],salePriceAmount1000:[12,n.TYPES.INT64]},le.internalSpec={catalogImage:[1,n.TYPES.MESSAGE,Ve],title:[2,n.TYPES.STRING],description:[3,n.TYPES.STRING]},ce.internalSpec={selectedId:[1,n.TYPES.STRING],selectedDisplayText:[2,n.TYPES.STRING],contextInfo:[3,n.TYPES.MESSAGE,ze],selectedIndex:[4,n.TYPES.UINT32]},de.internalSpec={fourRowTemplate:[1,n.TYPES.MESSAGE,pe],hydratedFourRowTemplate:[2,n.TYPES.MESSAGE,ue],contextInfo:[3,n.TYPES.MESSAGE,ze],hydratedTemplate:[4,n.TYPES.MESSAGE,ue],__oneofs__:{format:["fourRowTemplate","hydratedFourRowTemplate"]}},ue.internalSpec={documentMessage:[1,n.TYPES.MESSAGE,Ke],hydratedTitleText:[2,n.TYPES.STRING],imageMessage:[3,n.TYPES.MESSAGE,Ve],videoMessage:[4,n.TYPES.MESSAGE,xe],locationMessage:[5,n.TYPES.MESSAGE,Ye],hydratedContentText:[6,n.TYPES.STRING],hydratedFooterText:[7,n.TYPES.STRING],hydratedButtons:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ot],templateId:[9,n.TYPES.STRING],__oneofs__:{title:["documentMessage","hydratedTitleText","imageMessage","videoMessage","locationMessage"]}},pe.internalSpec={documentMessage:[1,n.TYPES.MESSAGE,Ke],highlyStructuredMessage:[2,n.TYPES.MESSAGE,Se],imageMessage:[3,n.TYPES.MESSAGE,Ve],videoMessage:[4,n.TYPES.MESSAGE,xe],locationMessage:[5,n.TYPES.MESSAGE,Ye],content:[6,n.TYPES.MESSAGE,Se],footer:[7,n.TYPES.MESSAGE,Se],buttons:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,rt],__oneofs__:{title:["documentMessage","highlyStructuredMessage","imageMessage","videoMessage","locationMessage"]}},fe.internalSpec={url:[1,n.TYPES.STRING],fileSha256:[2,n.TYPES.BYTES],fileEncSha256:[3,n.TYPES.BYTES],mediaKey:[4,n.TYPES.BYTES],mimetype:[5,n.TYPES.STRING],height:[6,n.TYPES.UINT32],width:[7,n.TYPES.UINT32],directPath:[8,n.TYPES.STRING],fileLength:[9,n.TYPES.UINT64],mediaKeyTimestamp:[10,n.TYPES.INT64],firstFrameLength:[11,n.TYPES.UINT32],firstFrameSidecar:[12,n.TYPES.BYTES],isAnimated:[13,n.TYPES.BOOL],pngThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze]},_e.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],accuracyInMeters:[3,n.TYPES.UINT32],speedInMps:[4,n.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[5,n.TYPES.UINT32],caption:[6,n.TYPES.STRING],sequenceNumber:[7,n.TYPES.INT64],timeOffset:[8,n.TYPES.UINT32],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze]},he.internalSpec={serviceType:[1,n.TYPES.ENUM,_],expiryTimestamp:[2,n.TYPES.INT64]},ge.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec]},me.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec]},ye.internalSpec={noteMessage:[4,n.TYPES.MESSAGE,O],currencyCodeIso4217:[1,n.TYPES.STRING],amount1000:[2,n.TYPES.UINT64],requestFrom:[3,n.TYPES.STRING],expiryTimestamp:[5,n.TYPES.INT64],amount:[6,n.TYPES.MESSAGE,dt],background:[7,n.TYPES.MESSAGE,ut]},Ee.internalSpec={noteMessage:[2,n.TYPES.MESSAGE,O],requestMessageKey:[3,n.TYPES.MESSAGE,i.MessageKeySpec],background:[4,n.TYPES.MESSAGE,ut]},Se.internalSpec={namespace:[1,n.TYPES.STRING],elementName:[2,n.TYPES.STRING],params:[3,n.FLAGS.REPEATED|n.TYPES.STRING],fallbackLg:[4,n.TYPES.STRING],fallbackLc:[5,n.TYPES.STRING],localizableParams:[6,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ve],deterministicLg:[7,n.TYPES.STRING],deterministicLc:[8,n.TYPES.STRING],hydratedHsm:[9,n.TYPES.MESSAGE,de]},ve.internalSpec={default:[1,n.TYPES.STRING],currency:[2,n.TYPES.MESSAGE,be],dateTime:[3,n.TYPES.MESSAGE,Te],__oneofs__:{paramOneof:["currency","dateTime"]}},Te.internalSpec={component:[1,n.TYPES.MESSAGE,Ae],unixEpoch:[2,n.TYPES.MESSAGE,Ce],__oneofs__:{datetimeOneof:["component","unixEpoch"]}},Ce.internalSpec={timestamp:[1,n.TYPES.INT64]},Ae.internalSpec={dayOfWeek:[1,n.TYPES.ENUM,g],year:[2,n.TYPES.UINT32],month:[3,n.TYPES.UINT32],dayOfMonth:[4,n.TYPES.UINT32],hour:[5,n.TYPES.UINT32],minute:[6,n.TYPES.UINT32],calendar:[7,n.TYPES.ENUM,h]},be.internalSpec={currencyCode:[1,n.TYPES.STRING],amount1000:[2,n.TYPES.INT64]},Pe.internalSpec={displayName:[1,n.TYPES.STRING],contacts:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,We],contextInfo:[17,n.TYPES.MESSAGE,ze]},Me.internalSpec={securityNotificationEnabled:[1,n.TYPES.BOOL]},Oe.internalSpec={collectionNames:[1,n.FLAGS.REPEATED|n.TYPES.STRING],timestamp:[2,n.TYPES.INT64]},Ie.internalSpec={keyIds:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Ne]},we.internalSpec={keys:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Le]},Re.internalSpec={keyData:[1,n.TYPES.BYTES],fingerprint:[2,n.TYPES.MESSAGE,De],timestamp:[3,n.TYPES.INT64]},De.internalSpec={rawId:[1,n.TYPES.UINT32],currentIndex:[2,n.TYPES.UINT32],deviceIndexes:[3,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},Ne.internalSpec={keyId:[1,n.TYPES.BYTES]},Le.internalSpec={keyId:[1,n.TYPES.MESSAGE,Ne],keyData:[2,n.TYPES.MESSAGE,Re]},ke.internalSpec={fileSha256:[1,n.TYPES.BYTES],fileLength:[2,n.TYPES.UINT64],mediaKey:[3,n.TYPES.BYTES],fileEncSha256:[4,n.TYPES.BYTES],directPath:[5,n.TYPES.STRING],syncType:[6,n.TYPES.ENUM,m],chunkOrder:[7,n.TYPES.UINT32],originalMessageId:[8,n.TYPES.STRING]},Ge.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],type:[2,n.TYPES.ENUM,y],ephemeralExpiration:[4,n.TYPES.UINT32],ephemeralSettingTimestamp:[5,n.TYPES.INT64],historySyncNotification:[6,n.TYPES.MESSAGE,ke],appStateSyncKeyShare:[7,n.TYPES.MESSAGE,we],appStateSyncKeyRequest:[8,n.TYPES.MESSAGE,Ie],initialSecurityNotificationSettingSync:[9,n.TYPES.MESSAGE,Me],appStateFatalExceptionNotification:[10,n.TYPES.MESSAGE,Oe],disappearingMode:[11,n.TYPES.MESSAGE,ft]},Ue.internalSpec={displayName:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING]},Fe.internalSpec={callKey:[1,n.TYPES.BYTES],conversionSource:[2,n.TYPES.STRING],conversionData:[3,n.TYPES.BYTES],conversionDelaySeconds:[4,n.TYPES.UINT32]},xe.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],fileSha256:[3,n.TYPES.BYTES],fileLength:[4,n.TYPES.UINT64],seconds:[5,n.TYPES.UINT32],mediaKey:[6,n.TYPES.BYTES],caption:[7,n.TYPES.STRING],gifPlayback:[8,n.TYPES.BOOL],height:[9,n.TYPES.UINT32],width:[10,n.TYPES.UINT32],fileEncSha256:[11,n.TYPES.BYTES],interactiveAnnotations:[12,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Ze],directPath:[13,n.TYPES.STRING],mediaKeyTimestamp:[14,n.TYPES.INT64],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze],streamingSidecar:[18,n.TYPES.BYTES],gifAttribution:[19,n.TYPES.ENUM,E],viewOnce:[20,n.TYPES.BOOL],thumbnailDirectPath:[21,n.TYPES.STRING],thumbnailSha256:[22,n.TYPES.BYTES],thumbnailEncSha256:[23,n.TYPES.BYTES],staticUrl:[24,n.TYPES.STRING]},Be.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],fileSha256:[3,n.TYPES.BYTES],fileLength:[4,n.TYPES.UINT64],seconds:[5,n.TYPES.UINT32],ptt:[6,n.TYPES.BOOL],mediaKey:[7,n.TYPES.BYTES],fileEncSha256:[8,n.TYPES.BYTES],directPath:[9,n.TYPES.STRING],mediaKeyTimestamp:[10,n.TYPES.INT64],contextInfo:[17,n.TYPES.MESSAGE,ze],streamingSidecar:[18,n.TYPES.BYTES],waveform:[19,n.TYPES.BYTES]},Ke.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],title:[3,n.TYPES.STRING],fileSha256:[4,n.TYPES.BYTES],fileLength:[5,n.TYPES.UINT64],pageCount:[6,n.TYPES.UINT32],mediaKey:[7,n.TYPES.BYTES],fileName:[8,n.TYPES.STRING],fileEncSha256:[9,n.TYPES.BYTES],directPath:[10,n.TYPES.STRING],mediaKeyTimestamp:[11,n.TYPES.INT64],contactVcard:[12,n.TYPES.BOOL],thumbnailDirectPath:[13,n.TYPES.STRING],thumbnailSha256:[14,n.TYPES.BYTES],thumbnailEncSha256:[15,n.TYPES.BYTES],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze],thumbnailHeight:[18,n.TYPES.UINT32],thumbnailWidth:[19,n.TYPES.UINT32]},je.internalSpec={text:[1,n.TYPES.STRING],matchedText:[2,n.TYPES.STRING],canonicalUrl:[4,n.TYPES.STRING],description:[5,n.TYPES.STRING],title:[6,n.TYPES.STRING],textArgb:[7,n.TYPES.FIXED32],backgroundArgb:[8,n.TYPES.FIXED32],font:[9,n.TYPES.ENUM,T],previewType:[10,n.TYPES.ENUM,v],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze],doNotPlayInline:[18,n.TYPES.BOOL],thumbnailDirectPath:[19,n.TYPES.STRING],thumbnailSha256:[20,n.TYPES.BYTES],thumbnailEncSha256:[21,n.TYPES.BYTES],mediaKey:[22,n.TYPES.BYTES],mediaKeyTimestamp:[23,n.TYPES.INT64],thumbnailHeight:[24,n.TYPES.UINT32],thumbnailWidth:[25,n.TYPES.UINT32],inviteLinkGroupType:[26,n.TYPES.ENUM,S]},Ye.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],name:[3,n.TYPES.STRING],address:[4,n.TYPES.STRING],url:[5,n.TYPES.STRING],isLive:[6,n.TYPES.BOOL],accuracyInMeters:[7,n.TYPES.UINT32],speedInMps:[8,n.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[9,n.TYPES.UINT32],comment:[11,n.TYPES.STRING],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze]},We.internalSpec={displayName:[1,n.TYPES.STRING],vcard:[16,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,ze]},He.internalSpec={note:[1,n.TYPES.STRING],token:[2,n.TYPES.STRING],attachmentType:[3,n.TYPES.ENUM,C],attachmentMimetype:[4,n.TYPES.STRING],attachmentMediaKey:[5,n.TYPES.BYTES],attachmentMediaKeyTimestamp:[6,n.TYPES.INT64],attachmentFileSha256:[7,n.TYPES.BYTES],attachmentFileEncSha256:[8,n.TYPES.BYTES],attachmentDirectPath:[9,n.TYPES.STRING],attachmentJpegThumbnail:[10,n.TYPES.BYTES]},Ve.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],caption:[3,n.TYPES.STRING],fileSha256:[4,n.TYPES.BYTES],fileLength:[5,n.TYPES.UINT64],height:[6,n.TYPES.UINT32],width:[7,n.TYPES.UINT32],mediaKey:[8,n.TYPES.BYTES],fileEncSha256:[9,n.TYPES.BYTES],interactiveAnnotations:[10,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Ze],directPath:[11,n.TYPES.STRING],mediaKeyTimestamp:[12,n.TYPES.INT64],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,ze],firstScanSidecar:[18,n.TYPES.BYTES],firstScanLength:[19,n.TYPES.UINT32],experimentGroupId:[20,n.TYPES.UINT32],scansSidecar:[21,n.TYPES.BYTES],scanLengths:[22,n.FLAGS.REPEATED|n.TYPES.UINT32],midQualityFileSha256:[23,n.TYPES.BYTES],midQualityFileEncSha256:[24,n.TYPES.BYTES],viewOnce:[25,n.TYPES.BOOL],thumbnailDirectPath:[26,n.TYPES.STRING],thumbnailSha256:[27,n.TYPES.BYTES],thumbnailEncSha256:[28,n.TYPES.BYTES],staticUrl:[29,n.TYPES.STRING]},$e.internalSpec={groupId:[1,n.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,n.TYPES.BYTES]},ze.internalSpec={stanzaId:[1,n.TYPES.STRING],participant:[2,n.TYPES.STRING],quotedMessage:[3,n.TYPES.MESSAGE,O],remoteJid:[4,n.TYPES.STRING],mentionedJid:[15,n.FLAGS.REPEATED|n.TYPES.STRING],conversionSource:[18,n.TYPES.STRING],conversionData:[19,n.TYPES.BYTES],conversionDelaySeconds:[20,n.TYPES.UINT32],forwardingScore:[21,n.TYPES.UINT32],isForwarded:[22,n.TYPES.BOOL],quotedAd:[23,n.TYPES.MESSAGE,Je],placeholderKey:[24,n.TYPES.MESSAGE,i.MessageKeySpec],expiration:[25,n.TYPES.UINT32],ephemeralSettingTimestamp:[26,n.TYPES.INT64],ephemeralSharedSecret:[27,n.TYPES.BYTES],externalAdReply:[28,n.TYPES.MESSAGE,qe],entryPointConversionSource:[29,n.TYPES.STRING],entryPointConversionApp:[30,n.TYPES.STRING],entryPointConversionDelaySeconds:[31,n.TYPES.UINT32],disappearingMode:[32,n.TYPES.MESSAGE,ft],actionLink:[33,n.TYPES.MESSAGE,_t],groupSubject:[34,n.TYPES.STRING],parentGroupJid:[35,n.TYPES.STRING]},qe.internalSpec={title:[1,n.TYPES.STRING],body:[2,n.TYPES.STRING],mediaType:[3,n.TYPES.ENUM,A],thumbnailUrl:[4,n.TYPES.STRING],mediaUrl:[5,n.TYPES.STRING],thumbnail:[6,n.TYPES.BYTES],sourceType:[7,n.TYPES.STRING],sourceId:[8,n.TYPES.STRING],sourceUrl:[9,n.TYPES.STRING],containsAutoReply:[10,n.TYPES.BOOL],renderLargerThumbnail:[11,n.TYPES.BOOL],showAdAttribution:[12,n.TYPES.BOOL]},Je.internalSpec={advertiserName:[1,n.TYPES.STRING],mediaType:[2,n.TYPES.ENUM,b],jpegThumbnail:[16,n.TYPES.BYTES],caption:[17,n.TYPES.STRING]},Qe.internalSpec={deviceListMetadata:[1,n.TYPES.MESSAGE,Xe],deviceListMetadataVersion:[2,n.TYPES.INT32]},Xe.internalSpec={senderKeyHash:[1,n.TYPES.BYTES],senderTimestamp:[2,n.TYPES.UINT64],senderKeyIndexes:[3,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32],recipientKeyHash:[8,n.TYPES.BYTES],recipientTimestamp:[9,n.TYPES.UINT64],recipientKeyIndexes:[10,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},Ze.internalSpec={polygonVertices:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,et],location:[2,n.TYPES.MESSAGE,tt],__oneofs__:{action:["location"]}},et.internalSpec={xDeprecated:[1,n.TYPES.INT32],yDeprecated:[2,n.TYPES.INT32],x:[3,n.TYPES.DOUBLE],y:[4,n.TYPES.DOUBLE]},tt.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],name:[3,n.TYPES.STRING]},rt.internalSpec={quickReplyButton:[1,n.TYPES.MESSAGE,at],urlButton:[2,n.TYPES.MESSAGE,it],callButton:[3,n.TYPES.MESSAGE,nt],index:[4,n.TYPES.UINT32],__oneofs__:{button:["quickReplyButton","urlButton","callButton"]}},nt.internalSpec={displayText:[1,n.TYPES.MESSAGE,Se],phoneNumber:[2,n.TYPES.MESSAGE,Se]},it.internalSpec={displayText:[1,n.TYPES.MESSAGE,Se],url:[2,n.TYPES.MESSAGE,Se]},at.internalSpec={displayText:[1,n.TYPES.MESSAGE,Se],id:[2,n.TYPES.STRING]},ot.internalSpec={quickReplyButton:[1,n.TYPES.MESSAGE,ct],urlButton:[2,n.TYPES.MESSAGE,lt],callButton:[3,n.TYPES.MESSAGE,st],index:[4,n.TYPES.UINT32],__oneofs__:{hydratedButton:["quickReplyButton","urlButton","callButton"]}},st.internalSpec={displayText:[1,n.TYPES.STRING],phoneNumber:[2,n.TYPES.STRING]},lt.internalSpec={displayText:[1,n.TYPES.STRING],url:[2,n.TYPES.STRING]},ct.internalSpec={displayText:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING]},dt.internalSpec={value:[1,n.TYPES.INT64],offset:[2,n.TYPES.UINT32],currencyCode:[3,n.TYPES.STRING]},ut.internalSpec={id:[1,n.TYPES.STRING],fileLength:[2,n.TYPES.UINT64],width:[3,n.TYPES.UINT32],height:[4,n.TYPES.UINT32],mimetype:[5,n.TYPES.STRING],placeholderArgb:[6,n.TYPES.FIXED32],textArgb:[7,n.TYPES.FIXED32],subtextArgb:[8,n.TYPES.FIXED32],mediaData:[9,n.TYPES.MESSAGE,pt],type:[10,n.TYPES.ENUM,P]},pt.internalSpec={mediaKey:[1,n.TYPES.BYTES],mediaKeyTimestamp:[2,n.TYPES.INT64],fileSha256:[3,n.TYPES.BYTES],fileEncSha256:[4,n.TYPES.BYTES],directPath:[5,n.TYPES.STRING]},ft.internalSpec={initiator:[1,n.TYPES.ENUM,M]},_t.internalSpec={url:[1,n.TYPES.STRING],buttonTitle:[2,n.TYPES.STRING]},ht.internalSpec={encKey:[1,n.TYPES.BYTES],name:[2,n.TYPES.STRING],options:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,gt],selectableOptionsCount:[4,n.TYPES.UINT32]},gt.internalSpec={optionName:[1,n.TYPES.STRING]},mt.internalSpec={pollCreationMessageKey:[1,n.TYPES.MESSAGE,i.MessageKeySpec],encPayload:[2,n.TYPES.BYTES],encIv:[3,n.TYPES.BYTES]},yt.internalSpec={voteMessage:[1,n.TYPES.MESSAGE,Et],__oneofs__:{update:["voteMessage"]}},Et.internalSpec={selectedOptions:[1,n.FLAGS.REPEATED|n.TYPES.BYTES],senderTimestampMs:[2,n.TYPES.INT64]}},28286:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralSettingSpec=void 0;var n=r(1390);const i={};t.EphemeralSettingSpec=i,i.internalSpec={duration:[1,n.TYPES.SFIXED32],timestamp:[2,n.TYPES.SFIXED64]}},73027:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WallpaperSettingsSpec=t.PushnameSpec=t.MediaVisibility=t.HistorySyncSpec=t.HistorySyncMsgSpec=t.HistorySyncHistorySyncType=t.GroupParticipantSpec=t.GroupParticipantRank=t.GlobalSettingsSpec=t.ConversationSpec=t.ConversationEndOfHistoryTransferType=t.AutoDownloadSettingsSpec=void 0;var n=r(1390),i=r(21224),a=r(24808);const o=r(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.HistorySyncHistorySyncType=o;const s=r(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1});t.ConversationEndOfHistoryTransferType=s;const l=r(76672)({REGULAR:0,ADMIN:1,SUPERADMIN:2});t.GroupParticipantRank=l;const c=r(76672)({DEFAULT:0,OFF:1,ON:2});t.MediaVisibility=c;const d={};t.HistorySyncSpec=d;const u={};t.ConversationSpec=u;const p={};t.HistorySyncMsgSpec=p;const f={};t.PushnameSpec=f;const _={};t.GroupParticipantSpec=_;const h={};t.WallpaperSettingsSpec=h;const g={};t.GlobalSettingsSpec=g;const m={};t.AutoDownloadSettingsSpec=m,d.internalSpec={syncType:[1,n.FLAGS.REQUIRED|n.TYPES.ENUM,o],conversations:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,u],statusV3Messages:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,i.WebMessageInfoSpec],chunkOrder:[5,n.TYPES.UINT32],progress:[6,n.TYPES.UINT32],pushnames:[7,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f],globalSettings:[8,n.TYPES.MESSAGE,g],threadIdUserSecret:[9,n.TYPES.BYTES],threadDsTimeframeOffset:[10,n.TYPES.UINT32]},u.internalSpec={id:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],messages:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,p],newJid:[3,n.TYPES.STRING],oldJid:[4,n.TYPES.STRING],lastMsgTimestamp:[5,n.TYPES.UINT64],unreadCount:[6,n.TYPES.UINT32],readOnly:[7,n.TYPES.BOOL],endOfHistoryTransfer:[8,n.TYPES.BOOL],ephemeralExpiration:[9,n.TYPES.UINT32],ephemeralSettingTimestamp:[10,n.TYPES.INT64],endOfHistoryTransferType:[11,n.TYPES.ENUM,s],conversationTimestamp:[12,n.TYPES.UINT64],name:[13,n.TYPES.STRING],pHash:[14,n.TYPES.STRING],notSpam:[15,n.TYPES.BOOL],archived:[16,n.TYPES.BOOL],disappearingMode:[17,n.TYPES.MESSAGE,a.DisappearingModeSpec],unreadMentionCount:[18,n.TYPES.UINT32],markedAsUnread:[19,n.TYPES.BOOL],participant:[20,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_],tcToken:[21,n.TYPES.BYTES],tcTokenTimestamp:[22,n.TYPES.UINT64],contactPrimaryIdentityKey:[23,n.TYPES.BYTES],pinned:[24,n.TYPES.UINT32],muteEndTime:[25,n.TYPES.UINT64],wallpaper:[26,n.TYPES.MESSAGE,h],mediaVisibility:[27,n.TYPES.ENUM,c],tcTokenSenderTimestamp:[28,n.TYPES.UINT64],suspended:[29,n.TYPES.BOOL]},p.internalSpec={message:[1,n.TYPES.MESSAGE,i.WebMessageInfoSpec],msgOrderId:[2,n.TYPES.UINT64]},f.internalSpec={id:[1,n.TYPES.STRING],pushname:[2,n.TYPES.STRING]},_.internalSpec={userJid:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],rank:[2,n.TYPES.ENUM,l]},h.internalSpec={filename:[1,n.TYPES.STRING],opacity:[2,n.TYPES.UINT32]},g.internalSpec={lightThemeWallpaper:[1,n.TYPES.MESSAGE,h],mediaVisibility:[2,n.TYPES.ENUM,c],darkThemeWallpaper:[3,n.TYPES.MESSAGE,h],autoDownloadWiFi:[4,n.TYPES.MESSAGE,m],autoDownloadCellular:[5,n.TYPES.MESSAGE,m],autoDownloadRoaming:[6,n.TYPES.MESSAGE,m],showIndividualNotificationsPreview:[7,n.TYPES.BOOL],showGroupNotificationsPreview:[8,n.TYPES.BOOL]},m.internalSpec={downloadImages:[1,n.TYPES.BOOL],downloadAudio:[2,n.TYPES.BOOL],downloadVideo:[3,n.TYPES.BOOL],downloadDocuments:[4,n.TYPES.BOOL]}},82348:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgRowOpaqueDataSpec=t.MsgOpaqueDataSpec=void 0;var n=r(1390);const i={};t.MsgRowOpaqueDataSpec=i;const a={};t.MsgOpaqueDataSpec=a,i.internalSpec={currentMsg:[1,n.TYPES.MESSAGE,a],quotedMsg:[2,n.TYPES.MESSAGE,a]},a.internalSpec={body:[1,n.TYPES.STRING],caption:[3,n.TYPES.STRING],lng:[5,n.TYPES.DOUBLE],isLive:[6,n.TYPES.BOOL],lat:[7,n.TYPES.DOUBLE],paymentAmount1000:[8,n.TYPES.INT32],paymentNoteMsgBody:[9,n.TYPES.STRING],canonicalUrl:[10,n.TYPES.STRING],matchedText:[11,n.TYPES.STRING],title:[12,n.TYPES.STRING],description:[13,n.TYPES.STRING],futureproofBuffer:[14,n.TYPES.BYTES],clientUrl:[15,n.TYPES.STRING],loc:[16,n.TYPES.STRING]}},16258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerErrorReceiptSpec=t.MediaRetryNotificationSpec=t.MediaRetryNotificationResultType=void 0;var n=r(1390);const i=r(76672)({GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2,DECRYPTION_ERROR:3});t.MediaRetryNotificationResultType=i;const a={};t.MediaRetryNotificationSpec=a;const o={};t.ServerErrorReceiptSpec=o,a.internalSpec={stanzaId:[1,n.TYPES.STRING],directPath:[2,n.TYPES.STRING],result:[3,n.TYPES.ENUM,i]},o.internalSpec={stanzaId:[1,n.TYPES.STRING]}},93890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var n=r(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,n.TYPES.STRING],fromMe:[2,n.TYPES.BOOL],id:[3,n.TYPES.STRING],participant:[4,n.TYPES.STRING]}},91344:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedNameCertificateSpec=t.VerifiedNameCertificate$DetailsSpec=t.LocalizedNameSpec=t.BizIdentityInfoVerifiedLevelValue=t.BizIdentityInfoSpec=t.BizIdentityInfoHostStorageType=t.BizIdentityInfoActualActorsType=t.BizAccountPayloadSpec=t.BizAccountLinkInfoSpec=t.BizAccountLinkInfoHostStorageType=t.BizAccountLinkInfoAccountType=void 0;var n=r(1390);const i=r(76672)({ENTERPRISE:0});t.BizAccountLinkInfoAccountType=i;const a=r(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizAccountLinkInfoHostStorageType=a;const o=r(76672)({SELF:0,BSP:1});t.BizIdentityInfoActualActorsType=o;const s=r(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizIdentityInfoHostStorageType=s;const l=r(76672)({UNKNOWN:0,LOW:1,HIGH:2});t.BizIdentityInfoVerifiedLevelValue=l;const c={};t.LocalizedNameSpec=c;const d={};t.VerifiedNameCertificateSpec=d;const u={};t.VerifiedNameCertificate$DetailsSpec=u;const p={};t.BizAccountPayloadSpec=p;const f={};t.BizAccountLinkInfoSpec=f;const _={};t.BizIdentityInfoSpec=_,c.internalSpec={lg:[1,n.TYPES.STRING],lc:[2,n.TYPES.STRING],verifiedName:[3,n.TYPES.STRING]},d.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES],serverSignature:[3,n.TYPES.BYTES]},u.internalSpec={serial:[1,n.TYPES.UINT64],issuer:[2,n.TYPES.STRING],verifiedName:[4,n.TYPES.STRING],localizedNames:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,c],issueTime:[10,n.TYPES.UINT64]},p.internalSpec={vnameCert:[1,n.TYPES.MESSAGE,d],bizAcctLinkInfo:[2,n.TYPES.BYTES]},f.internalSpec={whatsappBizAcctFbid:[1,n.TYPES.UINT64],whatsappAcctNumber:[2,n.TYPES.STRING],issueTime:[3,n.TYPES.UINT64],hostStorage:[4,n.TYPES.ENUM,a],accountType:[5,n.TYPES.ENUM,i]},_.internalSpec={vlevel:[1,n.TYPES.ENUM,l],vnameCert:[2,n.TYPES.MESSAGE,d],signed:[3,n.TYPES.BOOL],revoked:[4,n.TYPES.BOOL],hostStorage:[5,n.TYPES.ENUM,s],actualActors:[6,n.TYPES.ENUM,o],privacyModeTs:[7,n.TYPES.UINT64],featureControls:[8,n.TYPES.UINT64]}},84331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseCertificateSpec=t.NoiseCertificate$DetailsSpec=t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientPayload$WebInfoWebSubPlatform=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgentReleaseChannel=t.ClientPayload$UserAgentPlatform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSourceDNSResolutionMethod=t.ClientPayload$CompanionRegDataSpec=void 0;var n=r(1390);const i=r(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=r(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSourceDNSResolutionMethod=a;const o=r(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=o;const s=r(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=s;const l=r(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=r(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfoWebSubPlatform=c;const d=r(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgentReleaseChannel=d;const u=r(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const f={};t.HandshakeMessage$ClientFinishSpec=f;const _={};t.HandshakeMessage$ServerHelloSpec=_;const h={};t.HandshakeMessage$ClientHelloSpec=h;const g={};t.NoiseCertificateSpec=g;const m={};t.NoiseCertificate$DetailsSpec=m;const y={};t.ClientPayloadSpec=y;const E={};t.ClientPayload$CompanionRegDataSpec=E;const S={};t.ClientPayload$DNSSourceSpec=S;const v={};t.ClientPayload$WebInfoSpec=v;const T={};t.ClientPayload$WebInfo$WebdPayloadSpec=T;const C={};t.ClientPayload$UserAgentSpec=C;const A={};t.ClientPayload$UserAgent$AppVersionSpec=A,p.internalSpec={clientHello:[2,n.TYPES.MESSAGE,h],serverHello:[3,n.TYPES.MESSAGE,_],clientFinish:[4,n.TYPES.MESSAGE,f]},f.internalSpec={static:[1,n.TYPES.BYTES],payload:[2,n.TYPES.BYTES]},_.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},h.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},g.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES]},m.internalSpec={serial:[1,n.TYPES.UINT32],issuer:[2,n.TYPES.STRING],expires:[3,n.TYPES.UINT64],subject:[4,n.TYPES.STRING],key:[5,n.TYPES.BYTES]},y.internalSpec={username:[1,n.TYPES.UINT64],passive:[3,n.TYPES.BOOL],userAgent:[5,n.TYPES.MESSAGE,C],webInfo:[6,n.TYPES.MESSAGE,v],pushName:[7,n.TYPES.STRING],sessionId:[9,n.TYPES.SFIXED32],shortConnect:[10,n.TYPES.BOOL],connectType:[12,n.TYPES.ENUM,o],connectReason:[13,n.TYPES.ENUM,s],shards:[14,n.FLAGS.REPEATED|n.TYPES.INT32],dnsSource:[15,n.TYPES.MESSAGE,S],connectAttemptCount:[16,n.TYPES.UINT32],device:[18,n.TYPES.UINT32],regData:[19,n.TYPES.MESSAGE,E],product:[20,n.TYPES.ENUM,i],fbCat:[21,n.TYPES.BYTES],fbUserAgent:[22,n.TYPES.BYTES],oc:[23,n.TYPES.BOOL],lc:[24,n.TYPES.INT32],iosAppExtension:[30,n.TYPES.ENUM,l],fbAppId:[31,n.TYPES.UINT64],fbDeviceId:[32,n.TYPES.BYTES],pull:[33,n.TYPES.BOOL]},E.internalSpec={eRegid:[1,n.TYPES.BYTES],eKeytype:[2,n.TYPES.BYTES],eIdent:[3,n.TYPES.BYTES],eSkeyId:[4,n.TYPES.BYTES],eSkeyVal:[5,n.TYPES.BYTES],eSkeySig:[6,n.TYPES.BYTES],buildHash:[7,n.TYPES.BYTES],companionProps:[8,n.TYPES.BYTES]},S.internalSpec={dnsMethod:[15,n.TYPES.ENUM,a],appCached:[16,n.TYPES.BOOL]},v.internalSpec={refToken:[1,n.TYPES.STRING],version:[2,n.TYPES.STRING],webdPayload:[3,n.TYPES.MESSAGE,T],webSubPlatform:[4,n.TYPES.ENUM,c]},T.internalSpec={usesParticipantInKey:[1,n.TYPES.BOOL],supportsStarredMessages:[2,n.TYPES.BOOL],supportsDocumentMessages:[3,n.TYPES.BOOL],supportsUrlMessages:[4,n.TYPES.BOOL],supportsMediaRetry:[5,n.TYPES.BOOL],supportsE2EImage:[6,n.TYPES.BOOL],supportsE2EVideo:[7,n.TYPES.BOOL],supportsE2EAudio:[8,n.TYPES.BOOL],supportsE2EDocument:[9,n.TYPES.BOOL],documentTypes:[10,n.TYPES.STRING],features:[11,n.TYPES.BYTES]},C.internalSpec={platform:[1,n.TYPES.ENUM,u],appVersion:[2,n.TYPES.MESSAGE,A],mcc:[3,n.TYPES.STRING],mnc:[4,n.TYPES.STRING],osVersion:[5,n.TYPES.STRING],manufacturer:[6,n.TYPES.STRING],device:[7,n.TYPES.STRING],osBuildNumber:[8,n.TYPES.STRING],phoneId:[9,n.TYPES.STRING],releaseChannel:[10,n.TYPES.ENUM,d],localeLanguageIso6391:[11,n.TYPES.STRING],localeCountryIso31661Alpha2:[12,n.TYPES.STRING],deviceBoard:[13,n.TYPES.STRING]},A.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},78155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientPayload$WebInfoWebSubPlatform=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgentReleaseChannel=t.ClientPayload$UserAgentPlatform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSourceDNSResolutionMethod=t.ClientPayload$CompanionRegDataSpec=t.CertChainSpec=t.CertChain$NoiseCertificateSpec=t.CertChain$NoiseCertificate$DetailsSpec=void 0;var n=r(1390);const i=r(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=r(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSourceDNSResolutionMethod=a;const o=r(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=o;const s=r(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=s;const l=r(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=r(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfoWebSubPlatform=c;const d=r(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgentReleaseChannel=d;const u=r(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const f={};t.HandshakeMessage$ClientFinishSpec=f;const _={};t.HandshakeMessage$ServerHelloSpec=_;const h={};t.HandshakeMessage$ClientHelloSpec=h;const g={};t.CertChainSpec=g;const m={};t.CertChain$NoiseCertificateSpec=m;const y={};t.CertChain$NoiseCertificate$DetailsSpec=y;const E={};t.ClientPayloadSpec=E;const S={};t.ClientPayload$CompanionRegDataSpec=S;const v={};t.ClientPayload$DNSSourceSpec=v;const T={};t.ClientPayload$WebInfoSpec=T;const C={};t.ClientPayload$WebInfo$WebdPayloadSpec=C;const A={};t.ClientPayload$UserAgentSpec=A;const b={};t.ClientPayload$UserAgent$AppVersionSpec=b,p.internalSpec={clientHello:[2,n.TYPES.MESSAGE,h],serverHello:[3,n.TYPES.MESSAGE,_],clientFinish:[4,n.TYPES.MESSAGE,f]},f.internalSpec={static:[1,n.TYPES.BYTES],payload:[2,n.TYPES.BYTES]},_.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},h.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},g.internalSpec={leaf:[1,n.TYPES.MESSAGE,m],intermediate:[2,n.TYPES.MESSAGE,m]},m.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES]},y.internalSpec={serial:[1,n.TYPES.UINT32],issuerSerial:[2,n.TYPES.UINT32],key:[3,n.TYPES.BYTES],notBefore:[4,n.TYPES.UINT64],notAfter:[5,n.TYPES.UINT64]},E.internalSpec={username:[1,n.TYPES.UINT64],passive:[3,n.TYPES.BOOL],userAgent:[5,n.TYPES.MESSAGE,A],webInfo:[6,n.TYPES.MESSAGE,T],pushName:[7,n.TYPES.STRING],sessionId:[9,n.TYPES.SFIXED32],shortConnect:[10,n.TYPES.BOOL],connectType:[12,n.TYPES.ENUM,o],connectReason:[13,n.TYPES.ENUM,s],shards:[14,n.FLAGS.REPEATED|n.TYPES.INT32],dnsSource:[15,n.TYPES.MESSAGE,v],connectAttemptCount:[16,n.TYPES.UINT32],device:[18,n.TYPES.UINT32],regData:[19,n.TYPES.MESSAGE,S],product:[20,n.TYPES.ENUM,i],fbCat:[21,n.TYPES.BYTES],fbUserAgent:[22,n.TYPES.BYTES],oc:[23,n.TYPES.BOOL],lc:[24,n.TYPES.INT32],iosAppExtension:[30,n.TYPES.ENUM,l],fbAppId:[31,n.TYPES.UINT64],fbDeviceId:[32,n.TYPES.BYTES],pull:[33,n.TYPES.BOOL]},S.internalSpec={eRegid:[1,n.TYPES.BYTES],eKeytype:[2,n.TYPES.BYTES],eIdent:[3,n.TYPES.BYTES],eSkeyId:[4,n.TYPES.BYTES],eSkeyVal:[5,n.TYPES.BYTES],eSkeySig:[6,n.TYPES.BYTES],buildHash:[7,n.TYPES.BYTES],companionProps:[8,n.TYPES.BYTES]},v.internalSpec={dnsMethod:[15,n.TYPES.ENUM,a],appCached:[16,n.TYPES.BOOL]},T.internalSpec={refToken:[1,n.TYPES.STRING],version:[2,n.TYPES.STRING],webdPayload:[3,n.TYPES.MESSAGE,C],webSubPlatform:[4,n.TYPES.ENUM,c]},C.internalSpec={usesParticipantInKey:[1,n.TYPES.BOOL],supportsStarredMessages:[2,n.TYPES.BOOL],supportsDocumentMessages:[3,n.TYPES.BOOL],supportsUrlMessages:[4,n.TYPES.BOOL],supportsMediaRetry:[5,n.TYPES.BOOL],supportsE2EImage:[6,n.TYPES.BOOL],supportsE2EVideo:[7,n.TYPES.BOOL],supportsE2EAudio:[8,n.TYPES.BOOL],supportsE2EDocument:[9,n.TYPES.BOOL],documentTypes:[10,n.TYPES.STRING],features:[11,n.TYPES.BYTES]},A.internalSpec={platform:[1,n.TYPES.ENUM,u],appVersion:[2,n.TYPES.MESSAGE,b],mcc:[3,n.TYPES.STRING],mnc:[4,n.TYPES.STRING],osVersion:[5,n.TYPES.STRING],manufacturer:[6,n.TYPES.STRING],device:[7,n.TYPES.STRING],osBuildNumber:[8,n.TYPES.STRING],phoneId:[9,n.TYPES.STRING],releaseChannel:[10,n.TYPES.ENUM,d],localeLanguageIso6391:[11,n.TYPES.STRING],localeCountryIso31661Alpha2:[12,n.TYPES.STRING],deviceBoard:[13,n.TYPES.STRING]},b.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},21224:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebNotificationsInfoSpec=t.WebMessageInfoStubType=t.WebMessageInfoStatus=t.WebMessageInfoSpec=t.WebMessageInfoBizPrivacyStatus=t.WebFeaturesSpec=t.WebFeaturesFlag=t.UserReceiptSpec=t.StatusPSASpec=t.ReactionSpec=t.PollUpdateSpec=t.PollAdditionalMetadataSpec=t.PhotoChangeSpec=t.PaymentInfoTxnStatus=t.PaymentInfoStatus=t.PaymentInfoSpec=t.PaymentInfoCurrency=t.NotificationMessageInfoSpec=t.MediaDataSpec=void 0;var n=r(1390),i=r(24808),a=r(93890);const o=r(76672)({E2EE:0,FB:2,BSP:1,BSP_AND_FB:3});t.WebMessageInfoBizPrivacyStatus=o;const s=r(76672)({UNKNOWN:0,REVOKE:1,CIPHERTEXT:2,FUTUREPROOF:3,NON_VERIFIED_TRANSITION:4,UNVERIFIED_TRANSITION:5,VERIFIED_TRANSITION:6,VERIFIED_LOW_UNKNOWN:7,VERIFIED_HIGH:8,VERIFIED_INITIAL_UNKNOWN:9,VERIFIED_INITIAL_LOW:10,VERIFIED_INITIAL_HIGH:11,VERIFIED_TRANSITION_ANY_TO_NONE:12,VERIFIED_TRANSITION_ANY_TO_HIGH:13,VERIFIED_TRANSITION_HIGH_TO_LOW:14,VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:15,VERIFIED_TRANSITION_UNKNOWN_TO_LOW:16,VERIFIED_TRANSITION_LOW_TO_UNKNOWN:17,VERIFIED_TRANSITION_NONE_TO_LOW:18,VERIFIED_TRANSITION_NONE_TO_UNKNOWN:19,GROUP_CREATE:20,GROUP_CHANGE_SUBJECT:21,GROUP_CHANGE_ICON:22,GROUP_CHANGE_INVITE_LINK:23,GROUP_CHANGE_DESCRIPTION:24,GROUP_CHANGE_RESTRICT:25,GROUP_CHANGE_ANNOUNCE:26,GROUP_PARTICIPANT_ADD:27,GROUP_PARTICIPANT_REMOVE:28,GROUP_PARTICIPANT_PROMOTE:29,GROUP_PARTICIPANT_DEMOTE:30,GROUP_PARTICIPANT_INVITE:31,GROUP_PARTICIPANT_LEAVE:32,GROUP_PARTICIPANT_CHANGE_NUMBER:33,BROADCAST_CREATE:34,BROADCAST_ADD:35,BROADCAST_REMOVE:36,GENERIC_NOTIFICATION:37,E2E_IDENTITY_CHANGED:38,E2E_ENCRYPTED:39,CALL_MISSED_VOICE:40,CALL_MISSED_VIDEO:41,INDIVIDUAL_CHANGE_NUMBER:42,GROUP_DELETE:43,GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:44,CALL_MISSED_GROUP_VOICE:45,CALL_MISSED_GROUP_VIDEO:46,PAYMENT_CIPHERTEXT:47,PAYMENT_FUTUREPROOF:48,PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:49,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:50,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:51,PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:52,PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:53,PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:54,PAYMENT_ACTION_SEND_PAYMENT_REMINDER:55,PAYMENT_ACTION_SEND_PAYMENT_INVITATION:56,PAYMENT_ACTION_REQUEST_DECLINED:57,PAYMENT_ACTION_REQUEST_EXPIRED:58,PAYMENT_ACTION_REQUEST_CANCELLED:59,BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:60,BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:61,BIZ_INTRO_TOP:62,BIZ_INTRO_BOTTOM:63,BIZ_NAME_CHANGE:64,BIZ_MOVE_TO_CONSUMER_APP:65,BIZ_TWO_TIER_MIGRATION_TOP:66,BIZ_TWO_TIER_MIGRATION_BOTTOM:67,OVERSIZED:68,GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:69,GROUP_V4_ADD_INVITE_SENT:70,GROUP_PARTICIPANT_ADD_REQUEST_JOIN:71,CHANGE_EPHEMERAL_SETTING:72,E2E_DEVICE_CHANGED:73,VIEWED_ONCE:74,E2E_ENCRYPTED_NOW:75,BLUE_MSG_BSP_FB_TO_BSP_PREMISE:76,BLUE_MSG_BSP_FB_TO_SELF_FB:77,BLUE_MSG_BSP_FB_TO_SELF_PREMISE:78,BLUE_MSG_BSP_FB_UNVERIFIED:79,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:80,BLUE_MSG_BSP_FB_VERIFIED:81,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:82,BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:83,BLUE_MSG_BSP_PREMISE_UNVERIFIED:84,BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:85,BLUE_MSG_BSP_PREMISE_VERIFIED:86,BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:87,BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:88,BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:89,BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:90,BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:91,BLUE_MSG_SELF_FB_TO_BSP_PREMISE:92,BLUE_MSG_SELF_FB_TO_SELF_PREMISE:93,BLUE_MSG_SELF_FB_UNVERIFIED:94,BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:95,BLUE_MSG_SELF_FB_VERIFIED:96,BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:97,BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:98,BLUE_MSG_SELF_PREMISE_UNVERIFIED:99,BLUE_MSG_SELF_PREMISE_VERIFIED:100,BLUE_MSG_TO_BSP_FB:101,BLUE_MSG_TO_CONSUMER:102,BLUE_MSG_TO_SELF_FB:103,BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:104,BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:105,BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:106,BLUE_MSG_UNVERIFIED_TO_VERIFIED:107,BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:108,BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:109,BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:110,BLUE_MSG_VERIFIED_TO_UNVERIFIED:111,BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:112,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:113,BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:114,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:115,BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:116,BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:117,E2E_IDENTITY_UNAVAILABLE:118,GROUP_CREATING:119,GROUP_CREATE_FAILED:120,GROUP_BOUNCED:121,BLOCK_CONTACT:122,EPHEMERAL_SETTING_NOT_APPLIED:123,SYNC_FAILED:124,SYNCING:125,BIZ_PRIVACY_MODE_INIT_FB:126,BIZ_PRIVACY_MODE_INIT_BSP:127,BIZ_PRIVACY_MODE_TO_FB:128,BIZ_PRIVACY_MODE_TO_BSP:129,DISAPPEARING_MODE:130,E2E_DEVICE_FETCH_FAILED:131,ADMIN_REVOKE:132,GROUP_INVITE_LINK_GROWTH_LOCKED:133,COMMUNITY_LINK_PARENT_GROUP:134,COMMUNITY_LINK_SIBLING_GROUP:135,COMMUNITY_LINK_SUB_GROUP:136});t.WebMessageInfoStubType=s;const l=r(76672)({ERROR:0,PENDING:1,SERVER_ACK:2,DELIVERY_ACK:3,READ:4,PLAYED:5});t.WebMessageInfoStatus=l;const c=r(76672)({UNKNOWN:0,PENDING_SETUP:1,PENDING_RECEIVER_SETUP:2,INIT:3,SUCCESS:4,COMPLETED:5,FAILED:6,FAILED_RISK:7,FAILED_PROCESSING:8,FAILED_RECEIVER_PROCESSING:9,FAILED_DA:10,FAILED_DA_FINAL:11,REFUNDED_TXN:12,REFUND_FAILED:13,REFUND_FAILED_PROCESSING:14,REFUND_FAILED_DA:15,EXPIRED_TXN:16,AUTH_CANCELED:17,AUTH_CANCEL_FAILED_PROCESSING:18,AUTH_CANCEL_FAILED:19,COLLECT_INIT:20,COLLECT_SUCCESS:21,COLLECT_FAILED:22,COLLECT_FAILED_RISK:23,COLLECT_REJECTED:24,COLLECT_EXPIRED:25,COLLECT_CANCELED:26,COLLECT_CANCELLING:27,IN_REVIEW:28});t.PaymentInfoTxnStatus=c;const d=r(76672)({UNKNOWN_STATUS:0,PROCESSING:1,SENT:2,NEED_TO_ACCEPT:3,COMPLETE:4,COULD_NOT_COMPLETE:5,REFUNDED:6,EXPIRED:7,REJECTED:8,CANCELLED:9,WAITING_FOR_PAYER:10,WAITING:11});t.PaymentInfoStatus=d;const u=r(76672)({UNKNOWN_CURRENCY:0,INR:1});t.PaymentInfoCurrency=u;const p=r(76672)({NOT_STARTED:0,FORCE_UPGRADE:1,DEVELOPMENT:2,PRODUCTION:3});t.WebFeaturesFlag=p;const f={};t.WebMessageInfoSpec=f;const _={};t.PaymentInfoSpec=_;const h={};t.WebNotificationsInfoSpec=h;const g={};t.NotificationMessageInfoSpec=g;const m={};t.WebFeaturesSpec=m;const y={};t.MediaDataSpec=y;const E={};t.PhotoChangeSpec=E;const S={};t.StatusPSASpec=S;const v={};t.UserReceiptSpec=v;const T={};t.ReactionSpec=T;const C={};t.PollUpdateSpec=C;const A={};t.PollAdditionalMetadataSpec=A,f.internalDefaults={status:l.PENDING},f.internalSpec={key:[1,n.FLAGS.REQUIRED|n.TYPES.MESSAGE,a.MessageKeySpec],message:[2,n.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,n.TYPES.UINT64],status:[4,n.TYPES.ENUM,l],participant:[5,n.TYPES.STRING],messageC2STimestamp:[6,n.TYPES.UINT64],ignore:[16,n.TYPES.BOOL],starred:[17,n.TYPES.BOOL],broadcast:[18,n.TYPES.BOOL],pushName:[19,n.TYPES.STRING],mediaCiphertextSha256:[20,n.TYPES.BYTES],multicast:[21,n.TYPES.BOOL],urlText:[22,n.TYPES.BOOL],urlNumber:[23,n.TYPES.BOOL],messageStubType:[24,n.TYPES.ENUM,s],clearMedia:[25,n.TYPES.BOOL],messageStubParameters:[26,n.FLAGS.REPEATED|n.TYPES.STRING],duration:[27,n.TYPES.UINT32],labels:[28,n.FLAGS.REPEATED|n.TYPES.STRING],paymentInfo:[29,n.TYPES.MESSAGE,_],finalLiveLocation:[30,n.TYPES.MESSAGE,i.Message$LiveLocationMessageSpec],quotedPaymentInfo:[31,n.TYPES.MESSAGE,_],ephemeralStartTimestamp:[32,n.TYPES.UINT64],ephemeralDuration:[33,n.TYPES.UINT32],ephemeralOffToOn:[34,n.TYPES.BOOL],ephemeralOutOfSync:[35,n.TYPES.BOOL],bizPrivacyStatus:[36,n.TYPES.ENUM,o],verifiedBizName:[37,n.TYPES.STRING],mediaData:[38,n.TYPES.MESSAGE,y],photoChange:[39,n.TYPES.MESSAGE,E],userReceipt:[40,n.FLAGS.REPEATED|n.TYPES.MESSAGE,v],reactions:[41,n.FLAGS.REPEATED|n.TYPES.MESSAGE,T],quotedStickerData:[42,n.TYPES.MESSAGE,y],futureproofData:[43,n.TYPES.BYTES],statusPsa:[44,n.TYPES.MESSAGE,S],pollUpdates:[45,n.FLAGS.REPEATED|n.TYPES.MESSAGE,C],pollAdditionalMetadata:[46,n.TYPES.MESSAGE,A]},_.internalSpec={currencyDeprecated:[1,n.TYPES.ENUM,u],amount1000:[2,n.TYPES.UINT64],receiverJid:[3,n.TYPES.STRING],status:[4,n.TYPES.ENUM,d],transactionTimestamp:[5,n.TYPES.UINT64],requestMessageKey:[6,n.TYPES.MESSAGE,a.MessageKeySpec],expiryTimestamp:[7,n.TYPES.UINT64],futureproofed:[8,n.TYPES.BOOL],currency:[9,n.TYPES.STRING],txnStatus:[10,n.TYPES.ENUM,c],useNoviFiatFormat:[11,n.TYPES.BOOL],primaryAmount:[12,n.TYPES.MESSAGE,i.MoneySpec],exchangeAmount:[13,n.TYPES.MESSAGE,i.MoneySpec]},h.internalSpec={timestamp:[2,n.TYPES.UINT64],unreadChats:[3,n.TYPES.UINT32],notifyMessageCount:[4,n.TYPES.UINT32],notifyMessages:[5,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f]},g.internalSpec={key:[1,n.TYPES.MESSAGE,a.MessageKeySpec],message:[2,n.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,n.TYPES.UINT64],participant:[4,n.TYPES.STRING]},m.internalSpec={labelsDisplay:[1,n.TYPES.ENUM,p],voipIndividualOutgoing:[2,n.TYPES.ENUM,p],groupsV3:[3,n.TYPES.ENUM,p],groupsV3Create:[4,n.TYPES.ENUM,p],changeNumberV2:[5,n.TYPES.ENUM,p],queryStatusV3Thumbnail:[6,n.TYPES.ENUM,p],liveLocations:[7,n.TYPES.ENUM,p],queryVname:[8,n.TYPES.ENUM,p],voipIndividualIncoming:[9,n.TYPES.ENUM,p],quickRepliesQuery:[10,n.TYPES.ENUM,p],payments:[11,n.TYPES.ENUM,p],stickerPackQuery:[12,n.TYPES.ENUM,p],liveLocationsFinal:[13,n.TYPES.ENUM,p],labelsEdit:[14,n.TYPES.ENUM,p],mediaUpload:[15,n.TYPES.ENUM,p],mediaUploadRichQuickReplies:[18,n.TYPES.ENUM,p],vnameV2:[19,n.TYPES.ENUM,p],videoPlaybackUrl:[20,n.TYPES.ENUM,p],statusRanking:[21,n.TYPES.ENUM,p],voipIndividualVideo:[22,n.TYPES.ENUM,p],thirdPartyStickers:[23,n.TYPES.ENUM,p],frequentlyForwardedSetting:[24,n.TYPES.ENUM,p],groupsV4JoinPermission:[25,n.TYPES.ENUM,p],recentStickers:[26,n.TYPES.ENUM,p],catalog:[27,n.TYPES.ENUM,p],starredStickers:[28,n.TYPES.ENUM,p],voipGroupCall:[29,n.TYPES.ENUM,p],templateMessage:[30,n.TYPES.ENUM,p],templateMessageInteractivity:[31,n.TYPES.ENUM,p],ephemeralMessages:[32,n.TYPES.ENUM,p],e2ENotificationSync:[33,n.TYPES.ENUM,p],recentStickersV2:[34,n.TYPES.ENUM,p],recentStickersV3:[36,n.TYPES.ENUM,p],userNotice:[37,n.TYPES.ENUM,p],support:[39,n.TYPES.ENUM,p],groupUiiCleanup:[40,n.TYPES.ENUM,p],groupDogfoodingInternalOnly:[41,n.TYPES.ENUM,p],settingsSync:[42,n.TYPES.ENUM,p],archiveV2:[43,n.TYPES.ENUM,p],ephemeralAllowGroupMembers:[44,n.TYPES.ENUM,p],ephemeral24HDuration:[45,n.TYPES.ENUM,p],mdForceUpgrade:[46,n.TYPES.ENUM,p],disappearingMode:[47,n.TYPES.ENUM,p],externalMdOptInAvailable:[48,n.TYPES.ENUM,p],noDeleteMessageTimeLimit:[49,n.TYPES.ENUM,p]},y.internalSpec={localPath:[1,n.TYPES.STRING]},E.internalSpec={oldPhoto:[1,n.TYPES.BYTES],newPhoto:[2,n.TYPES.BYTES],newPhotoId:[3,n.TYPES.UINT32]},S.internalSpec={campaignId:[44,n.FLAGS.REQUIRED|n.TYPES.STRING],campaignExpirationTimestamp:[45,n.TYPES.UINT64]},v.internalSpec={userJid:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],receiptTimestamp:[2,n.TYPES.INT64],readTimestamp:[3,n.TYPES.INT64],playedTimestamp:[4,n.TYPES.INT64],pendingDeviceJid:[5,n.FLAGS.REPEATED|n.TYPES.STRING],deliveredDeviceJid:[6,n.FLAGS.REPEATED|n.TYPES.STRING]},T.internalSpec={key:[1,n.TYPES.MESSAGE,a.MessageKeySpec],text:[2,n.TYPES.STRING],groupingKey:[3,n.TYPES.STRING],senderTimestampMs:[4,n.TYPES.INT64],unread:[5,n.TYPES.BOOL]},C.internalSpec={pollUpdateMessageKey:[1,n.TYPES.MESSAGE,a.MessageKeySpec],pollUpdateMessage:[2,n.TYPES.MESSAGE,i.PollUpdateMessageContentSpec]},A.internalSpec={pollInvalidated:[1,n.TYPES.BOOL]}},19991:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(86945),i=r(64971);var a={isQplEnabled:function(){return(0,n.getABPropConfigValue)("qpl_enabled")},getUploadIntervalInSeconds:function(){return 60*(0,n.getABPropConfigValue)("qpl_upload_delay")},getEventSampling:function(){return(0,n.getABPropConfigValue)("qpl_sampling_as_string")},getInitialUploadDelayInSeconds:function(){return 60*(0,n.getABPropConfigValue)("qpl_initial_upload_delay")},isBusinessTeamQPLEnabled:function(){return(0,n.getABPropConfigValue)("btm_qpl_enabled")},getAbPropKey:function(){return(0,i.getABKey)()||"abkey"}};t.default=a},74152:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l&&!0!==t?__LOG__(3,void 0,void 0,void 0,["qpl"])`QPL Config has already been initialized`:(s=new Map,c=e,_(),l={isQplEnabled:d,uploadInterval:u,getEventDetails:f,uploadDelay:p,getAbPropKey:c.getAbPropKey});return l};var n=r(30433),i=r(27798);const a={sampleRate:0,samplingMethod:1},o=[i.QuickLogMarkerId.WHATSAPP_CART_ADD,i.QuickLogMarkerId.WHATSAPP_CART_VIEW,i.QuickLogMarkerId.WHATSAPP_CATALOG_COLLECTIONS_VIEW,i.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,i.QuickLogMarkerId.WHATSAPP_CATALOG_LOAD_MORE,i.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,i.QuickLogMarkerId.WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW,i.QuickLogMarkerId.WHATSAPP_COLLECTION_APPEAL,i.QuickLogMarkerId.WHATSAPP_COLLECTION_EDIT,i.QuickLogMarkerId.WHATSAPP_COLLECTION_RENAME,i.QuickLogMarkerId.WHATSAPP_COLLECTION_VIEW_ALL,i.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,i.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,i.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,i.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,i.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_IMAGES_LOAD,i.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,i.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,i.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,i.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,i.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,i.QuickLogMarkerId.WHATSAPP_PROFILE_VIEW];let s,l,c;function d(){return c.isQplEnabled()}function u(){return c.getUploadIntervalInSeconds()}function p(){return c.getInitialUploadDelayInSeconds()}function f(e){const t=s.get(e);return t?!c.isBusinessTeamQPLEnabled()&&o.includes(e)?a:t:a}function _(){try{let e=c.getEventSampling();0===e.indexOf("json:")&&(e=e.slice(5));const t=JSON.parse(e);t.sampling.forEach((e=>{const t=e[0],r=e[1],n=Math.max(e[2],0);s.set(t,{sampleRate:n,samplingMethod:r})}))}catch(e){(0,n.errorParsingConfig)(e)}}},16215:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return JSON.stringify(e)+"\n"+t.map((function(e){return JSON.stringify((0,i.default)((0,i.default)({},{wa_ab_key2:r}),e))})).join("\n")};var i=n(r(81109))},30433:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.annotationKeyTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${r}`}).commit()},t.annotationSizeLimitExceeded=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${r}`}).commit()},t.errorParsingConfig=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.errorUploadingChunk=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.maxPointCountExceeded=function(e,t){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}`}).commit()},t.maxStorageEventCountReached=function(){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED}).commit()},t.pointDataTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, data: ${r}`}).commit()},t.pointNameTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, pointName: ${r}`}).commit()};var i=n(r(11339));let a=0},37726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startQPL=function(){const e=(0,o.config)(i.default);e.isQplEnabled()&&((0,d.start)({isQplEnabled:e.isQplEnabled,sendEvents:t=>(0,s.sendEventsOverNetwork)(t,e.getAbPropKey()),uploadInterval:e.uploadInterval(),startUploadDelay:e.uploadDelay()}),l.QPL.init((e=>{c.QuickLogMarkerId.cast(e.marker_id);return(0,a.add)([e]),Promise.resolve()}),{debug:()=>{},warn:()=>{}},e.getEventDetails,e.isQplEnabled))};var i=n(r(19991)),a=r(63719),o=r(74152),s=r(11675),l=r(48870),c=r(27798),d=r(33994)},92006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markerEnded=function(e,t){const r=`${e}|${t}`;i.delete(r),a.delete(r)},t.validateAnnotations=function(e,t,r){const a=`${e}|${t}`,o=i.get(a)||0;let s=0;function l(r,i){return s+=i,!(s+o>1e3)||((0,n.annotationSizeLimitExceeded)(e,t,r),!1)}function c(r){for(let i=0;i<r.length;i++)return!(r[i].length>50)||((0,n.annotationKeyTooLong)(e,t,r[i]),!1)}if(null==r?void 0:r.bool){const e=Object.keys(r.bool);if(!l("bool",e.length)||!c(e))return!1}if(null==r?void 0:r.int){const e=Object.keys(r.int);if(!l("int",e.length)||!c(e))return!1}if(null==r?void 0:r.double){const e=Object.keys(r.double);if(!l("double",e.length)||!c(e))return!1}if(null==r?void 0:r.bool_array){const e=Object.keys(r.bool_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.bool_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.int_array){const e=Object.keys(r.int_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.int_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.double_array){const e=Object.keys(r.double_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.double_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.string){const e=Object.keys(r.string);for(let t=0;t<e.length;t++)if(!l(e[t],r.string[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.string_array){const e=Object.keys(r.string_array);for(let t=0;t<e.length;t++){const n=r.string_array[e[t]];for(let r=0;r<n.length;r++)if(!l(e[t],n[r].length))return!1}if(!c(e))return!1}return i.set(a,o+s),!0},t.validatePoints=function(e,t,r){if(r.length>50)return(0,n.pointNameTooLong)(e,t,r),!1;const i=`${e}|${t}`,o=a.get(i)||0;if(o+1>1e3)return(0,n.maxPointCountExceeded)(e,t),!1;return a.set(i,o+1),!0};var n=r(30433);r(27798);const i=new Map,a=new Map},11675:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventsOverNetwork=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=n(r(11854)),s=n(r(16215)),l=r(1063),c=r(77591);const d="https://graph.whatsapp.net/wa_qpl_data",u="1063127757113399|745146ffa34413f9dbb5469f5370b7af",p="167028690535322";let f;function _(){return(_=(0,i.default)((function*(e,t){const r=new FormData;r.append("access_token",u),r.append("app_id",p),void 0===f&&(f=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()),r.append("user_id",f),r.append("upload_time",(0,a.unixTime)().toString()),r.append("batch_info",JSON.stringify({}));const n={app_version:"2.2208.7",app_build_number:parseInt("354741050",10)||0};r.append("batches[]",(0,l.createFile)([(0,s.default)(n,e,t)],"qpldata.txt"),"qpldata.txt");const i=yield o.default.post(d,r);if(__LOG__(2,void 0,void 0,void 0,["qpl"])`qpl_networkSendEventsOverNetwork, completed XHR`,200!==i.status)throw new c.ServerStatusCodeError(i.status,`Failed call to QPL endpoint: ${d}, response: ${i.responseText}`)}))).apply(this,arguments)}},48870:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogActionType=t.QPLMarkerType=t.QPL=void 0;var i=r(92006),a=n(r(60407)),o=r(27798);let s;const l=r(76672)({SUCCESS:2,FAIL:3,CANCEL:4});t.QuickLogActionType=l;const c=r(76672)({REGULAR:1,USER_FLOW:2});t.QPLMarkerType=c;class d{static clearInstance(){s=null,d.activeMarkers.clear(),d.markerInstanceHelper.clear()}static getNextMarkerInstanceValue(e){d.markerInstanceHelper.get(e)||d.markerInstanceHelper.set(e,d.instanceKeyGenerator());const t=d.markerInstanceHelper.get(e),r=void 0!==t?t.next().value:0;return void 0!==r?r:0}static*instanceKeyGenerator(){let e=0;for(;;)yield e++}static init(e,t,r,n){s&&__LOG__(4,void 0,new Error)`QPL already initialized`,s=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:t,sendEvent:e,quickLogConfigHelper:{getEventDetails:r,isKillswitchOn:()=>!n()}})}static getInstance(){return s||(__LOG__(3)`Attempt to use QPL logger prior to initialization`,s=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:{debug:()=>{},warn:()=>{}},sendEvent:()=>{},quickLogConfigHelper:{getEventDetails:()=>({sampleRate:1,samplingMethod:1}),isKillswitchOn:()=>!0}})),s}static logActiveQplMarkers(){0===d.activeMarkers.size||d.activeMarkers.forEach(((e,t)=>{const r=o.QuickLogMarkerId.getName(t);e<1||__LOG__(3)`QPL [${r}] There are currently ${e} active markers remaining. You need to call markerEnd`}))}static markerStart(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o.QuickLogMarkerId.getName(e);const n=d.activeMarkers.get(e)||0;n>0&&__LOG__(4,void 0,new Error)`QPL [${o.QuickLogMarkerId.getName(e)}] markerStart is currently opened ${n+1} time(s)`,d.activeMarkers.set(e,n+1),d.getInstance().markerStart(e,r),t&&(0,i.validateAnnotations)(e,r,t)&&d.getInstance().markerAnnotate(e,t,{instanceKey:r})}static markerStartClosePrevious(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;o.QuickLogMarkerId.getName(t);const a=d.activeMarkers.get(t)||0;a>0&&d.markerEnd(t,e,n-1),d.activeMarkers.set(t,a+1),d.getInstance().markerStart(t,n),r&&(0,i.validateAnnotations)(t,n,r)&&d.getInstance().markerAnnotate(t,r,{instanceKey:n})}static markerAnnotate(e,t,r){o.QuickLogMarkerId.getName(e),t&&JSON.stringify(t),r&&JSON.stringify(r),d.tryLogErrorMessage(e,"markerAnnotate"),(0,i.validateAnnotations)(e,(null==r?void 0:r.instanceKey)||0,t)&&d.getInstance().markerAnnotate(e,t,r)}static markerPoint(e,t,r){o.QuickLogMarkerId.getName(e),r&&JSON.stringify(r),d.tryLogErrorMessage(e,"markerPoint"),(0,i.validatePoints)(e,(null==r?void 0:r.instanceKey)||0,t)&&d.getInstance().markerPoint(e,t,r)}static markerEnd(e,t,r){o.QuickLogMarkerId.getName(e),l.getName(t),String(r),d.tryLogErrorMessage(e,"markerEnd"),d.deactivateMarker(e),d.getInstance().markerEnd(e,t,r),(0,i.markerEnded)(e,r||0)}static markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o.QuickLogMarkerId.getName(e),d.tryLogErrorMessage(e,"markerDrop"),d.deactivateMarker(e),d.getInstance().markerDrop(e,t),(0,i.markerEnded)(e,t)}static getActiveMarkerIDs(e){return d.getInstance().getActiveMarkerIDs(e)}static getMarker(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.getInstance().getMarker(e,t)}static tryLogErrorMessage(e,t){(d.activeMarkers.get(e)||0)<1&&__LOG__(3)`QPL [${o.QuickLogMarkerId.getName(e)}] calling ${t} without a markerStart`}static deactivateMarker(e){const t=d.activeMarkers.get(e)||0,r=Math.max(0,t-1);0===r?d.activeMarkers.delete(e):d.activeMarkers.set(e,r)}}t.QPL=d,d.activeMarkers=new Map,d.markerInstanceHelper=new Map},27798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogMarkerId=void 0;const n=r(76672)({WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW:774768970,WHATSAPP_PRODUCT_APPEAL:774769273,WHATSAPP_CATALOG_CREATE:774769395,WHATSAPP_CATALOG_LOAD_MORE:774769641,WHATSAPP_ORDER_VIEW:774769843,WHATSAPP_PROFILE_VIEW:774770248,WHATSAPP_CATALOG_VIEW:774771408,WHATSAPP_PRODUCT_DELETE:774774122,WHATSAPP_CART_VIEW:774774619,WHATSAPP_CART_ADD:774774794,WHATSAPP_PROFILE_SAVE:774775117,WHATSAPP_PRODUCT_VIEW:774775607,WHATSAPP_COLLECTION_APPEAL:774776895,WHATSAPP_PLM_DETAILS_VIEW:774777097,WHATSAPP_COLLECTION_EDIT:774777483,WHATSAPP_ORDER_CREATE:774777518,WHATSAPP_PROFILE_CATS_VIEW:774777556,WHATSAPP_PRODUCT_SET_VISIBLE:774778628,WHATSAPP_PRODUCT_IMAGES_LOAD:774778674,WHATSAPP_PRODUCT_SAVE:774779113,WHATSAPP_PRODUCT_MESSAGE_SEND:774779800,WHATSAPP_COLLECTION_VIEW_ALL:774780089,WHATSAPP_CATALOG_COLLECTIONS_VIEW:774781666,WHATSAPP_PRODUCT_REPORT:774782053,WHATSAPP_COLLECTION_RENAME:774782934,WHATSAPP_WEB_TEST_EVENT:891422769,CHAT_OPEN:891425633});t.QuickLogMarkerId=n},33994:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(){return m.apply(this,arguments)};var a=i(r(48926)),o=r(13959),s=r(63719),l=r(91903),c=r(30433),d=r(77591);const u={minTimeout:1e3,maxTimeout:1e4,retries:5,signal:(new n).signal},p=100,f=4,_=6e4,h=9e5;let g;function m(){return(m=(0,a.default)((function*(e){var t,r,n,i,a;g||(g={sendEvents:e.sendEvents,isQplEnabled:e.isQplEnabled,startUploadDelay:1e3*(null!==(t=e.startUploadDelay)&&void 0!==t?t:300),uploadInterval:1e3*(null!==(r=e.uploadInterval)&&void 0!==r?r:86400),uploadRetryDelayMin:1e3*(null!==(n=e.uploadRetryDelayMin)&&void 0!==n?n:_),uploadRetryDelayMax:1e3*(null!==(i=e.uploadRetryDelayMax)&&void 0!==i?i:h),uploadRetryMaxAttemptsCount:null!==(a=e.uploadRetryMaxAttemptsCount)&&void 0!==a?a:f},yield(0,o.delayMs)(g.startUploadDelay),S())}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(){const e=g.uploadRetryDelayMin+Math.floor(Math.random()*(g.uploadRetryDelayMax-g.uploadRetryDelayMin));yield(0,o.delayMs)(e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(g.isQplEnabled())try{const e=yield(0,s.rowCount)();let t=0;for(;t<e;){const e=yield(0,s.getFromBottom)(p);yield T(e);const r=e[0].id||0,n=e[e.length-1].id||0;yield(0,s.deleteRange)(r,n),t+=e.length}yield(0,o.delayMs)(g.uploadInterval||0),S()}catch(t){e<g.uploadRetryMaxAttemptsCount?(yield y(),S(e+1)):(__LOG__(4,!0,new Error,!0)`QPL Uploader, error during upload session, error: ${t}`,SEND_LOGS("QPL Uploader upload session failed"),(0,c.errorUploadingChunk)(t),yield(0,o.delayMs)(g.uploadInterval||0),S())}}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e){yield(0,l.exponentialBackoff)(u,((t,r)=>(e[0].id,e[e.length-1].id,g.sendEvents(e).catch((e=>{if(e instanceof d.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`QPL Uploader uploadChunk, retriable error: ${e.errorMessage}, failCount ${r}`,t(e)}throw e})))))}))).apply(this,arguments)}},68106:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=-1;for(let r=0,i=e.length;r<i;r++)t=t>>>8^n[255&(t^e.charCodeAt(r))];return~t};let n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0!==r.g.Int32Array&&(n=new Int32Array(n))},60407:(e,t,r)=>{"use strict";var n=r(95318),i=n(r(81109)),a=n(r(68106));function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0});const s=Object.freeze({TRUST_CLIENT_REPORTED_SAMPLE_RATE:1}),l=Object.freeze({API_CALL:27787270,CRASH_RESILIENCE:27787276,LOCKLESS_IS_MARKER_ON_ACCURACY:27787269,LOCKLESS_MARKER_START:27787266,LOCKLESS_QUEUE_SIZE:27787265,LOCKLESS_STARTED_MARKERS_MAP_COLLISIONS:27787273,LOSS_TRACKING_MARKER_RECEIVED:27787272,LOSS_TRACKING_MARKER_STARTED:27787271,QPL_CONFIG_LOAD:27799150,QPL_CONFIG_SAVE:27791744,QPL_HEARTBEAT_HARDCODED_CONFIG:27792138,QPL_HEARTBEAT_SEVER_CONFIG:27803336,USAGE:27791726,ZERO_SAMPLE_RATE_DUE_MISSING_CONFIG:27787268,ZERO_SAMPLE_RATE_DUE_MISSING_EVENT_IN_CONFIG:27787267}),c=Object.freeze({REGULAR:1,USER_FLOW:2});function d(e,t){const r=t-e;if(0===r)return"0";const[n,i]=r.toFixed(6).split(".",2);return"0"===n?i.replace(/^0+/,""):n+i}function u(e,t,r,n){const a=t[e];if(!a||0===Object.entries(a).length)return null;const o={};return Object.keys(a).forEach((e=>{const t=a[e];null==t||0===t.length?delete a[e]:o[e]=n?n(t):t})),{[e]:(0,i.default)((0,i.default)({},null==r?void 0:r[e]),o)}}function p(e,t){if(null==e)return t;const r=(0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)({},t),u("string",e,t)),u("int",e,t,Math.trunc)),u("double",e,t)),u("bool",e,t)),u("string_array",e,t)),u("int_array",e,t,(e=>e.map(Math.trunc)))),u("double_array",e,t)),u("bool_array",e,t));return Object.keys(r).forEach((e=>{const t=r[e];null!=t&&0!==Object.entries(t).length||delete r[e]})),0!==Object.entries(r).length?r:null}function f(e,t){if(!t)return e;const r={};return t.string&&(r.annotations=t.string),t.int&&(r.annotations_int=t.int),t.double&&(r.annotations_double=t.double),t.bool&&(r.annotations_bool=t.bool),t.string_array&&(r.annotations_string_array=t.string_array),t.int_array&&(r.annotations_int_array=t.int_array),t.double_array&&(r.annotations_double_array=t.double_array),t.bool_array&&(r.annotations_bool_array=t.bool_array),(0,i.default)((0,i.default)({},e),r)}const _=new Map([[1,"random_sampling"],[3,"per_user"]]);function h(e,t){return 0!==e&&(e<=1||("string"==typeof t?0==(r=t,((0,a.default)(r)>>>0)%e):Math.random()*e<=1));var r}class g{constructor(e){let t;o(this,"_settings",void 0),o(this,"_nextListenerId",1),o(this,"_defaultSampleRate",100),o(this,"_listeners",new Map),o(this,"_listenersWithMarker",new Map),o(this,"_debuggingId",void 0),o(this,"_logger",void 0),o(this,"_markerSampleRate",{}),o(this,"activeMarkers",new Map),this._settings=e,this._logger=e.logger,this._listenersWithMarker=null!==(t=e.listenersWithMarker)&&void 0!==t?t:new Map}getMarker(e,t){const r=this._getMarkerInstances(e);if(!r)return null;const n=r.get(t);return n||null}_getMarkerInstances(e){let t;return(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())?null:this.activeMarkers.get(e)}addMarker(e,t,r){let n=this.activeMarkers.get(e);n||(n=new Map,this.activeMarkers.set(e,n)),n.set(t,r)}deleteMarker(e,t){let r;null===(r=this.activeMarkers.get(e))||void 0===r||r.delete(t)}markerStart(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentTimestamp(),{cancelOnUnload:i=!1,trackedForLoss:a=!1,type:o=c.REGULAR,samplingBasis:s=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())return;this.getMarker(e,r)&&this._logger.warn(`Duplicate QPL markerId: ${e} & instanceKey: ${r}`);const[d,u,p]=this._getSamplingPolicy(e,s),f={passesSampling:d,timestamp:n,sampleRate:u,samplingMethod:p,points:[],cancelOnUnload:i,trackedForLoss:a,type:o};this._listeners.forEach((t=>{t.onMarkerStart(e,r,n)})),this._listenersWithMarker.forEach((t=>{t.onMarkerStartWithMarker(e,r,n,f)})),d&&this.addMarker(e,r,f),d&&!0===a&&this._uploadEvent({marker_id:l.LOSS_TRACKING_MARKER_STARTED,action_id:0,sample_rate:1,annotations_int:{tracked_marker_id:e},marker_type:c.REGULAR})}markerAnnotate(e,t){let{instanceKey:r=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((n=>{Object.keys(t).forEach((i=>{const a=t[i];a&&Object.keys(a).forEach((t=>{n.onAnnotation(e,r,t,a[t])}))}))}));const n=this.getMarker(e,r);n&&(n.annotations=p(t,n.annotations))}markerPoint(e,t){let{instanceKey:r=0,data:n,timestamp:i=this.currentTimestamp()}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((a=>{let o;return a.onMarkerPoint(e,r,t,null==n||null===(o=n.string)||void 0===o?void 0:o.__key,i)}));const a=this.getMarker(e,r);if(!a)return;const o={name:t,timeSinceStart:Math.trunc(i-a.timestamp)},s=p(n);s&&(o.data=s),a.points.push(o)}markerEnd(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.currentTimestamp();this._listeners.forEach((i=>i.onMarkerEnd(t,e,r,n)));const a=this.getMarker(e,r);if(a){if(a.passesSampling){if(!0!==a.timestampIsApproximate){const o=a.type===c.USER_FLOW?a.points:function(e){return Array.from(new Set(e.map((e=>e.name)))).map((t=>e.find((e=>e.name===t)))).filter(Boolean)}(a.points),l=function(e,t){return!0===t?(0,i.default)((0,i.default)({},e),{},{tracked_for_loss:!0}):e}(f({marker_id:e,action_id:t,instance_id:r,sample_rate:a.sampleRate,method:_.get(a.samplingMethod),duration_ns:d(a.timestamp,n),points:o,metadata:{application_analytics:{time_since_qpl_module_init:n-this._settings.moduleLoadTimestamp}},marker_type:a.type,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE},a.annotations),a.trackedForLoss);this._uploadEvent(l)}this._debuggingId===e&&this._settings.onDebuggingIdEnded&&this._settings.onDebuggingIdEnded()}this.deleteMarker(e,r)}}markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.deleteMarker(e,t);const r=this.currentTimestamp();this._listeners.forEach((n=>{n.onMarkerDrop&&n.onMarkerDrop(e,t,r)}))}markEvent(e,t,r){let n,{timestamp:i=this.currentTimestamp(),annotations:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(n=this._settings.quickLogConfigHelper)||void 0===n?void 0:n.isKillswitchOn())return;const[o,l,d]=this._getSamplingPolicy(e);if(!o)return;const u=p("function"==typeof a?a():a),h={marker_id:e,action_id:0,instance_id:0,sample_rate:l,method:_.get(d),da_type:t,da_level:r,metadata:{application_analytics:{time_since_qpl_module_init:i-this._settings.moduleLoadTimestamp}},marker_type:c.REGULAR,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE};this._uploadEvent(f(h,u))}dropAllMarkers(){this.activeMarkers.clear()}setAlwaysOnSampleRate(e,t){this._markerSampleRate[e]=t}currentTimestamp(){return this._settings.performanceNow()}enableDebug(e){this._debuggingId=parseInt(e,10)}disableDebug(){this._debuggingId=null}addListener(e){const t=this._nextListenerId++;return this._listeners.set(t,e),{dispose:()=>{this._listeners.delete(t)}}}_getSamplingPolicy(e,t){let r,n,i,a,o;if(this._settings.unsampleAllEvents&&this._settings.unsampleAllEvents()||this._debuggingId===e)return[!0,1,1];const s=null!==(r=null===(n=this._settings.quickLogConfigHelper)||void 0===n?void 0:n.getEventDetails(e))&&void 0!==r?r:{sampleRate:0,samplingMethod:1};if(null==this._markerSampleRate[e]&&0!==s.sampleRate&&3===s.samplingMethod){let e;return[!0,null!==(e=s.sampleRate)&&void 0!==e?e:1,3]}const l=null!==(i=null!==(a=this._markerSampleRate[e])&&void 0!==a?a:s.sampleRate)&&void 0!==i?i:this._defaultSampleRate,c=null!==(o=s.samplingMethod)&&void 0!==o?o:1;return[h(l,t),l,c]}_uploadEvent(e){const t=this._settings.decorateEventBeforeUpload?this._settings.decorateEventBeforeUpload(e):e;this._settings.sendEvent(e,t)}getActiveMarkerIDs(e){let{type:t}=e;const r=new Set;return this.activeMarkers.forEach(((e,n)=>{e.forEach((e=>{e.type===t&&r.add(n)}))})),Array.from(r)}forEachMarkerInstance(e,t){const r=this._getMarkerInstances(e);if(r)for(const e of r.keys())t(e)}}var m,y;o(g,"normalizeAnnotations",p),function(e){e[e.REGULAR=1]="REGULAR",e[e.USER_FLOW=2]="USER_FLOW"}(t.QPLMarkerType||(t.QPLMarkerType={})),(m=t.QuickLogActionType||(t.QuickLogActionType={}))[m.SUCCESS=2]="SUCCESS",m[m.FAIL=3]="FAIL",m[m.CANCEL=4]="CANCEL",(y=t.QPLDataEventLevel||(t.QPLDataEventLevel={}))[y.FATAL=1]="FATAL",y[y.ERROR=3]="ERROR",y[y.CRITICAL=4]="CRITICAL",y[y.WARN=5]="WARN",y[y.INFO=7]="INFO",y[y.DEBUG=9]="DEBUG",t.default=g},99234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UserPrefsEvent=void 0,Object.defineProperty(t,"_setAllKeyValues",{enumerable:!0,get:function(){return E._setAllKeyValues}}),t.assertGetMe=w,t.assertGetMeUser=function(){return(0,d.default)(R(),"meUser")},Object.defineProperty(t,"clearAllLocalState",{enumerable:!0,get:function(){return E.clearAllLocalState}}),Object.defineProperty(t,"clearAllTemporaryStorageData",{enumerable:!0,get:function(){return E.clearAllTemporaryStorageData}}),t.clearDeprecatedKeys=N,t.clearTokens=function(){C.forEach((e=>{E._set(e,void 0)}))},t.deleteComposeContents=function(e){E._clearUserSessionItem(x(e))},t.getAutoDownloadAudio=function(){var e;return null===(e=E._getUser(y.KEYS.AUTO_DOWNLOAD_AUDIO))||void 0===e||e},t.getAutoDownloadDocuments=function(){var e;return null!==(e=E._getUser(y.KEYS.AUTO_DOWNLOAD_DOCUMENTS))&&void 0!==e&&e},t.getAutoDownloadPhotos=function(){var e;return null===(e=E._getUser(y.KEYS.AUTO_DOWNLOAD_PHOTOS))||void 0===e||e},t.getAutoDownloadVideos=function(){var e;return null!==(e=E._getUser(y.KEYS.AUTO_DOWNLOAD_VIDEOS))&&void 0!==e&&e},t.getBrowserId=function(){return E._get(y.KEYS.BROWSER_ID)},t.getCollapseMuted=function(){return E._getUser(y.KEYS.GLOBAL_COLLAPSE_MUTED)},Object.defineProperty(t,"getCollection",{enumerable:!0,get:function(){return E.getCollection}}),t.getComposeContents=function(e){return E._getUserSession(x(e))},t.getContactChecksum=function(){return E._getUser(y.KEYS.CONTACT_CHECKSUM)},t.getDailyStatsStartTime=j,t.getForcedMdUpgradeComplete=function(){return E._get(y.KEYS.FORCED_MD_UPGRADE_COMPLETE,S.default)},t.getGeocoderLocation=function(){return E._getUser(y.KEYS.GEOCODER_LOCATION)},t.getGlobalCallRingtone=function(){return!E._getUser(y.KEYS.GLOBAL_MUTE_CALL_RINGTONE)},t.getGlobalNotifications=function(){return!E._getUser(y.KEYS.GLOBAL_MUTE_NOTIFICATIONS)},t.getGlobalPreviews=function(){return!E._getUser(y.KEYS.GLOBAL_MUTE_PREVIEWS)},t.getGlobalSecurityNotifications=function(){var e;return null===(e=!E._getUser(y.KEYS.SECURITY_NOTIFICATIONS))||void 0===e||e},t.getGlobalSounds=function(){return!E._getUser(y.KEYS.GLOBAL_MUTE_SOUNDS)},t.getGroupParticipantAssignedColor=function(e){return E._getUser(y.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString())},t.getHistorySyncEarliestDate=function(){const e=E._get(y.KEYS.HISTORY_SYNC_EARLIEST_DATE);if(!e)return B((0,u.unixTime)());return e},t.getIgnoreNondirectGroupMsg=function(){return E._getUser(y.KEYS.IGNORE_NONDIRECT_GROUP_MSG)},t.getLangPref=function(){return E._get(y.KEYS.LANG)},t.getLastChatMuteDuration=function(){return E._getUser(y.KEYS.LAST_CHAT_MUTE_DURATION)},t.getLastComposeBoxPanel=function(){return E._getUser(y.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL)},t.getLastMobilePlatform=function(){return E._get(y.KEYS.MOBILE_PLATFORM)},t.getLastStatusUsage=function(){return E._getUser(y.KEYS.LAST_STATUS_USAGE)},t.getLoginTokens=D,t.getLogoutToken=function(){return E._getPS(y.KEYS.LOGOUT_TOKEN)},t.getMapsOverQuota=function(){return E._get(y.KEYS.GMAPS_OVER_LIMIT)},t.getMaybeMeUser=function(){const e=I();return e?(0,f.toUserWid)(e):void 0},t.getMe=I,t.getMeUser=R,t.getMutex=function(){return E._getPSIgnoringCache(y.KEYS.WHATSAPP_MUTEX)},t.getNUX=L,t.getNewChatInfo=function(){var e;const t=r(7293).GK;return null!==(e=E._getUser(y.KEYS.NEW_CHAT_INFO))&&void 0!==e?e:t.supportsFeature(t.F.NEW_CHAT_INFO)},t.getNoTakeover=function(){return E._getTS(y.KEYS.NO_TAKEOVER)},t.getNoticeBannerClosedAt=function(){return E._getUser(y.KEYS.NOTICE_BANNER_CLOSED_AT)},t.getNoticeId=function(){return E._getUser(y.KEYS.NOTICE_ID)},t.getNuxSyncList=function(){var e;return null!==(e=E._get(y.KEYS.NUX_LIST))&&void 0!==e?e:[]},t.getOldLogoutCreds=function(){return E._getPS(y.KEYS.OLD_LOGOUT_CREDS)||[]},t.getOutgoingMessageSound=function(){return E._getUser(y.KEYS.OUTGOING_MESSAGE_SOUND)},t.getPrimaryFeatures=function(){var e;return null!==(e=E._get(y.KEYS.PRIMARY_FEATURES))&&void 0!==e?e:[]},t.getPsKillSwitchToken=function(){return E._get(y.KEYS.PS_KILLSWITCH_TOKEN)},t.getPttPlaybackRate=function(){var e;return null!==(e=E._get(y.KEYS.PTT_PLAYBACK_RATE))&&void 0!==e?e:1},t.getPushname=function(){return E._getUser(y.KEYS.LAST_PUSHNAME)},Object.defineProperty(t,"getRememberMe",{enumerable:!0,get:function(){return E.getRememberMe}}),t.getSecretBundle=function(){let e=E._get(y.KEYS.SECRET_BUNDLE);if(!e)return __LOG__(3)`UserPrefs:Attempted to load non-existent secret bundle!`,null;"string"==typeof e&&(e=JSON.parse(e));return(0,s.default)(e,c.decodeB64)},t.getSeenGroupDesc=function(e){return E._getUser(e.toString())},t.getShouldPreemptivelyCleanupLogs=function(){return!1!==E._get(y.KEYS.LOG_PREEMPT_CLEAN_UP)},t.getShowMdUpgradeCompleteMsg=function(){return E._get(y.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,S.default)},t.getSmbLabelPalette=function(){return E._getUser(y.KEYS.SMB_LABEL_COLOR_PALETTE)},t.getStorageAlert=function(){return _.STORAGE_ALERT_TYPE.NO_ALERT},t.getStorageDismissState=function(){return{lowQuotaDismissed:!0,highQuotaDismissed:!0}},t.getSystemThemeMode=function(){return E._get(y.KEYS.SYSTEM_THEME_MODE)},t.getTheme=function(){return E._get(y.KEYS.THEME)},t.getUnknownId=function(){let e=E._get(y.KEYS.UNKNOWN_ID);e||(e="unknown"+Math.floor(1e10*Math.random()),G(e));return e},t.getUnreadMentionCountEnabled=function(){return E._get(y.KEYS.UNREAD_MENTION_COUNT_ENABLED)},t.getUserPrivacySettings=function(){var e;return null!==(e=E._getUser(y.KEYS.USER_PRIVACY_SETTINGS))&&void 0!==e?e:{}},t.getVersion=function(){return E._get(y.KEYS.PROTO_VERSION)},t.getVideoVolumeSettings=function(){return{volume:E._get(y.KEYS.VIDEO_VOLUME),muted:!!E._get(y.KEYS.VIDEO_MUTE)}},t.getWamBuffer=function(){return E._get(y.KEYS.WAM_BUFFER,void 0,!0)},t.getWamInfo=function(){return E._get(y.KEYS.WAM_INFO)},t.initDailyStatsStartTime=function(){j()},t.knowsPhone=function(){const e=D();return!(!e.client||!e.server)},t.localTakeoverSuccess=function(){const e=E.getRememberMe()?{}:(0,o.default)(E._getAllKeyValues(),v.LS_ONLY_KEYS);e.wa_tab_src=b,(0,d.default)(g.default,"localStorage").setItem(y.KEYS.LOCAL_TAKEOVER_OK,JSON.stringify(e)),(0,d.default)(g.default,"localStorage").removeItem(y.KEYS.LOCAL_TAKEOVER_OK)},t.markUserSentMessageToChat=function(e){const t=K(e),r=E._getUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(r))return __LOG__(3)`UserPrefs:markUserSentMessageToChat value in store is not an array`,E._setUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO,[t]),!1;const n=!r.includes(t);n&&(r.push(t),E._setUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO,r));return __LOG__(2)`UserPrefs:markUserSentMessageToChat`,n},t.mdOptedIn=function(){return E._get(y.KEYS.MD_OPTED_IN,m.default)},t.mutexFilter=function(e){if(e.key!==y.KEYS.WHATSAPP_MUTEX)return!1;if(!(e.newValue||"").includes(b))return!0;return!1},t.parseMutex=function(e){const t=e?JSON.parse(e):"";return t?t.toString().split(/:/).pop():t},t.parseTakeover=function(e){const t=e?JSON.parse(e):{};if((0,a.default)(t))return delete t.wa_tab_src,t;return{}},t.removeMutex=function(){E._setPS(y.KEYS.WHATSAPP_MUTEX)},t.removeNUX=function(e){E._setUser(e)},t.removeUserSentMessageToChat=function(e){const t=E._getUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(t))return __LOG__(3)`UserPrefs:removeUserSentMessageToChat value in store is not an array`,void E._setUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO,[]);const r=K(e);t.includes(r)&&E._setUser(y.KEYS.CHATS_USER_SENT_MESSAGE_TO,(0,i.default)(t,r));__LOG__(2)`UserPrefs:removeUserSentMessageToChat`},t.setAutoDownloadAudio=function(e){E._setUser(y.KEYS.AUTO_DOWNLOAD_AUDIO,e)},t.setAutoDownloadDocuments=function(e){E._setUser(y.KEYS.AUTO_DOWNLOAD_DOCUMENTS,e)},t.setAutoDownloadPhotos=function(e){E._setUser(y.KEYS.AUTO_DOWNLOAD_PHOTOS,e)},t.setAutoDownloadVideos=function(e){E._setUser(y.KEYS.AUTO_DOWNLOAD_VIDEOS,e)},t.setBrowserId=function(e){E._set(y.KEYS.BROWSER_ID,e)},t.setCollapseMuted=function(e){E._setUser(y.KEYS.GLOBAL_COLLAPSE_MUTED,e)},Object.defineProperty(t,"setCollection",{enumerable:!0,get:function(){return E.setCollection}}),t.setComposeContents=function(e,t){E._setUserSession(x(e),t)},t.setContactChecksum=function(e){E._setUser(y.KEYS.CONTACT_CHECKSUM,e)},t.setForcedMdUpgradeComplete=function(e){E._set(y.KEYS.FORCED_MD_UPGRADE_COMPLETE,e,S.default)},t.setGeocoderLocation=function(e){E._setUser(y.KEYS.GEOCODER_LOCATION,e)},t.setGlobalCallRingtone=function(e){E._setUser(y.KEYS.GLOBAL_MUTE_CALL_RINGTONE,!e)},t.setGlobalNotifications=function(e){E._setUser(y.KEYS.GLOBAL_MUTE_NOTIFICATIONS,!e)},t.setGlobalPreviews=function(e){E._setUser(y.KEYS.GLOBAL_MUTE_PREVIEWS,!e)},t.setGlobalSecurityNotifications=function(e){E._setUser(y.KEYS.SECURITY_NOTIFICATIONS,!e)},t.setGlobalSounds=function(e){E._setUser(y.KEYS.GLOBAL_MUTE_SOUNDS,!e)},t.setGroupParticipantAssignedColor=function(e,t){E._setUser(y.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString(),t)},t.setHistorySyncEarliestDate=B,t.setIgnoreNondirectGroupMsg=function(e){E._setUser(y.KEYS.IGNORE_NONDIRECT_GROUP_MSG,e)},t.setLangPref=function(e){E._set(y.KEYS.LANG,e)},t.setLastChatMuteDuration=function(e){E._setUser(y.KEYS.LAST_CHAT_MUTE_DURATION,e)},t.setLastComposeBoxPanel=function(e){E._setUser(y.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL,e)},t.setLastMobilePlatform=function(e){E._set(y.KEYS.MOBILE_PLATFORM,e)},t.setLastStatusUsage=function(){E._setUser(y.KEYS.LAST_STATUS_USAGE,Date.now())},t.setLoginTokens=function(e){const t=e.client,r=e.server;t&&r&&!(0,l.default)(t)&&(__LOG__(2)`UserPrefs:setLoginTokens`,E._set(y.KEYS.CLIENT_TOKEN,t),E._set(y.KEYS.SERVER_TOKEN,r))},t.setLogoutToken=function(e){E._setPS(y.KEYS.LOGOUT_TOKEN,e)},t.setMapsOverQuota=function(e){E._set(y.KEYS.GMAPS_OVER_LIMIT,e)},t.setMdOptedIn=function(e){E._set(y.KEYS.MD_OPTED_IN,e,m.default)},t.setMe=function(e){const t=r(7293).GK;t.supportsFeature(t.F.MD_BACKEND)?E._set(y.KEYS.LAST_WID_MD,e):E._set(y.KEYS.LAST_WID,e)},t.setMutex=function(e){const t=e?b+":"+e:e;E._setPS(y.KEYS.WHATSAPP_MUTEX,t)},t.setNUX=k,t.setNewChatInfo=function(e){E._setUser(y.KEYS.NEW_CHAT_INFO,e),O.handleNewChatInfoChange(e)},t.setNoTakeover=function(e){E._setTS(y.KEYS.NO_TAKEOVER,e)},t.setNoticeBannerClosedAt=function(e){E._setUser(y.KEYS.NOTICE_BANNER_CLOSED_AT,e)},t.setNoticeId=function(e){E._setUser(y.KEYS.NOTICE_ID,e)},t.setNuxSyncList=function(e){E._set(y.KEYS.NUX_LIST,e)},t.setOldLogoutCreds=function(e){E._setPS(y.KEYS.OLD_LOGOUT_CREDS,e)},t.setOutgoingMessageSound=function(e){E._setUser(y.KEYS.OUTGOING_MESSAGE_SOUND,e)},t.setPrimaryFeatures=function(e){E._set(y.KEYS.PRIMARY_FEATURES,e)},t.setPsKillSwitchToken=function(e){E._set(y.KEYS.PS_KILLSWITCH_TOKEN,e)},t.setPttPlaybackRate=function(e){E._set(y.KEYS.PTT_PLAYBACK_RATE,e)},t.setPushname=function(e){E._setUser(y.KEYS.LAST_PUSHNAME,e)},t.setRefTok=function(e,t){N(),E.setRefTokCookies(e,t)},Object.defineProperty(t,"setRememberMe",{enumerable:!0,get:function(){return E.setRememberMe}}),t.setSecretBundle=function(e){return E._set(y.KEYS.SECRET_BUNDLE,(0,s.default)(e,c.encodeB64))},t.setSeenGroupDesc=function(e){E._setUser(e.toString(),!0)},t.setShouldPreemptivelyCleanupLogs=function(e){E._set(y.KEYS.LOG_PREEMPT_CLEAN_UP,e)},t.setShowMdUpgradeCompleteMsg=function(e){E._set(y.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,e,S.default)},t.setSmbLabelPalette=function(e){E._set(y.KEYS.SMB_LABEL_COLOR_PALETTE,e)},t.setStorageAlert=function(){},t.setStorageDismissState=function(){},t.setSystemThemeMode=function(e){E._set(y.KEYS.SYSTEM_THEME_MODE,e)},t.setTheme=function(e){E._set(y.KEYS.THEME,e)},t.setUnknownId=G,t.setUnreadMentionCountEnabled=function(e){E._set(y.KEYS.UNREAD_MENTION_COUNT_ENABLED,e)},t.setUserPrivacySettings=function(e){E._setUser(y.KEYS.USER_PRIVACY_SETTINGS,e)},t.setVersion=function(e){null!=e&&E._set(y.KEYS.PROTO_VERSION,e)},t.setVideoMutedSetting=F,t.setVideoVolumeSetting=U,t.setVideoVolumeSettings=function(e,t){U(e),F(t)},t.setWamBuffer=function(e){E._set(y.KEYS.WAM_BUFFER,e,void 0,!0)},t.setWamInfo=function(e){E._set(y.KEYS.WAM_INFO,e)},t.shouldShowNUX=function(e){const t=L(e);return!t||t.views<t.maxViews},t.takeoverFilter=function(e){if(e.key!==y.KEYS.LOCAL_TAKEOVER_OK)return!1;if(!(e.newValue||"").includes(b))return!0;return!1},t.thisTabId=void 0,Object.defineProperty(t,"updatePreservedUserKeys",{enumerable:!0,get:function(){return E.updatePreservedUserKeys}}),t.viewNUX=function(e){const t=L(e);if(!t)throw new Error("UserPrefs:viewNUX key "+e+" does not exist");k(e,{views:t.views+1,maxViews:t.maxViews})};var i=n(r(82569)),a=n(r(13218)),o=n(r(57557)),s=n(r(66604)),l=n(r(52353)),c=r(15688),d=n(r(45095)),u=r(92844),p=n(r(89867)),f=r(45454),_=r(60764),h=n(r(34342)),g=n(r(92417)),m=(r(61653),n(r(99304))),y=r(72407),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(53055)),S=n(r(97920)),v=r(70499);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}const C=[y.KEYS.LOGOUT_TOKEN,y.KEYS.CLIENT_TOKEN,y.KEYS.SERVER_TOKEN,y.KEYS.SECRET_BUNDLE],A=[y.KEYS.VERSION],b="x"+Math.round(1e9*Math.random()),P=b;t.thisTabId=P;class M extends h.default{constructor(){super(...arguments),this.NEW_CHAT_INFO_CHANGE="NEW_CHAT_INFO_CHANGE"}handleNewChatInfoChange(e){this.trigger(this.NEW_CHAT_INFO_CHANGE,e)}handleNuxChange(e){this.trigger(e)}}const O=new M;function I(){const e=r(7293).GK;let t=null;return t=e.supportsFeature(e.F.MD_BACKEND)?E._get(y.KEYS.LAST_WID_MD):E._get(y.KEYS.LAST_WID),t&&p.default.isWid(t)?(0,f.createWid)(t):t}function w(){return(0,d.default)(I(),"me")}function R(){return(0,f.toUserWid)(w())}function D(){return{client:E._get(y.KEYS.CLIENT_TOKEN),server:E._get(y.KEYS.SERVER_TOKEN)}}function N(){A.forEach((function(e){m.default.removeItem(e)}))}function L(e){return E._getUser(e)}function k(e,t){E._setUser(e,t)}function G(e){return E._set(y.KEYS.UNKNOWN_ID,e)}function U(e){E._set(y.KEYS.VIDEO_VOLUME,e)}function F(e){E._set(y.KEYS.VIDEO_MUTE,e)}function x(e){return`${y.KEYS.COMPOSE_CONTENTS_PREFIX}${e.toString()}`}function B(e){const t=90*u.DAY_SECONDS,r=(u.YEAR_SECONDS,e-t);return E._set(y.KEYS.HISTORY_SYNC_EARLIEST_DATE,r),r}function K(e){return`${e.toString()}_`}function j(){const e=E._get(y.KEYS.DAILY_STATS_START_TIME);if("number"==typeof e)return e;const t=Date.now();return E._set(y.KEYS.DAILY_STATS_START_TIME,t),t}t.UserPrefsEvent=O},50313:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactChecksum=function(){return n._getUser(a)},t.getFrequentContacts=function(){return n._getUser(o)},t.getGKFeatures=function(){return n._getUser(s)},t.getGKProto=function(){return n._getUser(l)},t.getHistoryInitialSyncBoundry=function(){const e=n._getUser(c);try{return JSON.parse(e)}catch(e){return null}},t.getInitialGroupPhash=function(e){const t=n._getUser(d);try{return JSON.parse(t)[e]}catch(e){return null}},t.setContactChecksum=function(e){n._setUser(a,e)},t.setFrequentContacts=function(e){n._setUser(o,e)},t.setGKFeatures=function(e){n._setUser(s,e)},t.setGKProto=function(e){n._setUser(l,e)},t.setHistoryInitialSyncBoundry=function(e){n._setUser(c,JSON.stringify(e))},t.setInitialGroupPhash=function(e){n._setUser(d,JSON.stringify(e))};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(53055));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}const a="contact_checksum",o="frequent_contacts",s="gk_features",l="gk_proto",c="history_initial_sync_boundry",d="initial_group_phash"},58052:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegistrationInfo=function(){const e=[_,g,m,y,E,b];l.GK.supportsFeature(l.GK.F.MD_BACKEND)?e.push(u.KEYS.LAST_WID_MD):e.push(u.KEYS.LAST_WID);e.map((e=>{d._set(e,void 0)}))},t.getADVSecretKey=function(){return d._get(T)},t.getAllCriticalDataSynced=function(){return!!d._get(S,c.default)},t.getArchiveV2EnabledSetting=function(){return d._get(I)},t.getBlocklistHash=function(){return d._get(C)},t.getChatThreadLoggingLastUploadedStartTs=function(){return d._get(L)},t.getChatThreadLoggingOffset=function(){return d._get(D)},t.getChatThreadLoggingSecretB64=function(){return d._get(N)},t.getHistorySyncStatus=U,t.getInitialHistorySyncComplete=function(){return!!d._get(E,c.default)},t.getIsCommunityDiscovered=function(){return!!d._get(k)},t.getLastHistorySycnedChunk=function(){return d._get(M)},t.getMdInternVersion=function(){return},t.getMdSyncActionsActionSanitized=function(){return d._get(R)},t.getNoiseInfo=G,t.getNoiseInfoIv=function(){return d._get(h)},t.getPrimaryAllowsAllMutations=function(){return!!d._get(w)},t.getRoutingInfo=function(){const e=d._get(y,c.default);if(!e)return null;const{domain:t,edgeRouting:r}=e;return{domain:t,edgeRouting:r?(0,o.decodeB64)(r):null}},t.getShouldCheckContactSyncStatus=function(){return!!d._get(A)},t.getUnarchiveChatsSetting=function(){return d._get(O)},t.getUpgradeMdWamFlag=function(){return!!d._get(P)},t.getWebEncSalt=function(){return d._get(b,c.default)},t.isRegistered=function(){return!(!G()||!s.getMe())},t.setADVSecretKey=function(e){return d._set(T,e)},t.setAllCriticalDataSynced=function(){return d._set(S,!0)},t.setArchiveV2EnabledSetting=function(e){d._set(I,e)},t.setBlocklistHash=function(e){return d._set(C,e)},t.setChatThreadLoggingLastUploadedStartTs=function(e){d._set(L,e)},t.setChatThreadLoggingOffset=function(e){d._set(D,e)},t.setChatThreadLoggingSecretB64=function(e){d._set(N,e)},t.setHistorySyncStatus=function(e){var t;const r=null!==(t=U())&&void 0!==t?t:{};d._set(v,(0,i.default)((0,i.default)({},r),e),void 0,void 0,!1)},t.setInitialHistorySyncComplete=function(){return d._set(E,"true",void 0,void 0,!1)},t.setIsCommunityDiscovered=function(e){d._set(k,e)},t.setLastHistorySycnedChunk=function(e,t){if(null==e||null==t)return;d._set(M,`${e}_${t}`,void 0,void 0,!1)},t.setMdInternVersion=function(){},t.setMdSyncActionsActionSanitized=function(e){d._set(R,e)},t.setNoiseInfo=function(e){const t={recoveryToken:e.recoveryToken,pubKey:e.staticKeyPair.pubKey,privKey:e.staticKeyPair.privKey};return d._set(_,(0,a.default)(t,o.encodeB64),void 0,void 0,!1)},t.setNoiseInfoIv=function(e){d._set(h,e,void 0,void 0,!1)},t.setPrimaryAllowsAllMutations=function(){return d._set(w,!0)},t.setRoutingInfo=function(e){const{domain:t,edgeRouting:r}=e,n={domain:t,edgeRouting:r?(0,o.encodeB64)(r):null};return d._set(y,n,c.default)},t.setShouldCheckContactSyncStatus=function(){return d._set(A,!0)},t.setUnarchiveChatsSetting=function(e){d._set(O,e)},t.setUpgradeMdWamFlag=function(e){return d._set(P,e)},t.setWebEncSalt=function(e){return d._set(b,e,void 0,void 0,!1)};var i=n(r(81109)),a=n(r(66604)),o=r(15688),s=f(r(99234)),l=r(7293),c=n(r(99304)),d=f(r(53055)),u=r(72407);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const _="WANoiseInfo",h="WANoiseInfoIv",g="WAMeInfo",m="WADeviceId",y="WARoutingInfo",E="WaInitialHistorySynced",S="critical_data_synced",v="WAHistorySyncStatus",T="WaADVSecretKey",C="WABlocklistHash",A="WAShouldCheckContactSyncStatus",b="WebEncKeySalt",P="MdUpgradeWamFlag",M="MdHistoryLastChunkProcessed",O="WAUnarchiveChatsSetting",I="WAArchiveV2EnabledSetting",w="WASyncdPrimaryAllowsAllMutations",R="MdSyncActionsActionSanitized",D="ChatThreadLoggingOffset",N="ChatThreadLoggingSecret",L="ChatThreadLoggingLastUploadedStartTs",k="WAIsCommunityDiscovered";function G(){const e=d._get(_);if(!e)return null;const t=(0,a.default)(e,o.decodeB64);return{recoveryToken:t.recoveryToken,staticKeyPair:{pubKey:t.pubKey,privKey:t.privKey}}}function U(){return d._get(v)}},72407:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYS=void 0;t.KEYS={STORAGE_TEST:"storage_test",CLIENT_TOKEN:"WAToken1",SERVER_TOKEN:"WAToken2",SECRET:"WASecretKey",SECRET_BUNDLE:"WASecretBundle",SECURITY_NOTIFICATIONS:"WASecurityNotifications",BROWSER_ID:"WABrowserId",GEOCODER_LOCATION:"WAGeocoderLocation",GROUP_ASSIGNED_COLOR:"WAGroupAssignedColor-17",GMAPS_OVER_LIMIT:"WAGmapsOverLimit",GLOBAL_MUTE_SOUNDS:"WAGlobalSounds",GLOBAL_MUTE_CALL_RINGTONE:"WAGlobalCallRingtone",OUTGOING_MESSAGE_SOUND:"WAOutgoingMessageSound",GLOBAL_MUTE_NOTIFICATIONS:"WAGlobalNotifications",GLOBAL_MUTE_IN_APP_NOTIFICATIONS:"WAGlobalInAppNotifications",GLOBAL_MUTE_PREVIEWS:"WAGlobalPreviews",GLOBAL_COLLAPSE_MUTED:"WAGlobalCollapseMuted",NOTIFICATION_SOUND:"WANotificationSound",AUTO_DOWNLOAD_PHOTOS:"WAAutoDownloadPhotos",AUTO_DOWNLOAD_AUDIO:"WAAutoDownloadAudio",AUTO_DOWNLOAD_VIDEOS:"WAAutoDownloadVideos",AUTO_DOWNLOAD_DOCUMENTS:"WAAutoDownloadDocuments",LANG:"WALangPref",LAST_ACTIVE_EMOJI_TAB:"WALastActiveEmojiTab",LAST_SELECTED_COMPOSE_BOX_PANEL:"WALastActiveComposeBoxPanel",LAST_CHAT_MUTE_DURATION:"WALastChatMuteDuration",UNKNOWN_ID:"WAUnknownID",VERSION:"WAVersion",LOAD_RETRY_GENERATION:"WALoadRetryGeneration",WHATSAPP_MUTEX:"whatsapp-mutex",LAST_WID:"last-wid",LAST_WID_MD:"last-wid-md",SAVE_TO_CAMERA_ROLL:"save_to_camera_roll",SMB_LABEL_COLOR_PALETTE:"smb_label_color_palette",LAST_PUSHNAME:"last-pushname",PROTO_VERSION:"WAProtoVersion",PTT_PLAYBACK_RATE:"WAPttPlaybackRate",LOGOUT_DIRTY_BIT:"post-logout",UNREAD_MENTION_COUNT_ENABLED:"WAUnreadMentionCountEnabled",NEW_CHAT_INFO:"WANewChatInfo",DAILY_STATS_START_TIME:"WADailyStatsStartTime",PRIMARY_FEATURES:"WAPrimaryFeatures",TOS_STATE_FETCH_ITERATION:"ToSStateFetchIteration",NUX_LIST:"WANuxList",LOG_PREEMPT_CLEAN_UP:"WALogPreemptiveCleanUp",PRESERVED_USER_KEYS:"preserved_user_keys",EMOJI_VARIANT_COLLECTION:"emoji_variant_collection",RECENT_EMOJI_COLLECTION:"recent_emoji_collection",CHAT_PREFERENCE_COLLECTION:"chat_preference",LAST_STATUS_USAGE:"last-status-usage",MD_OPTED_IN:"md-opted-in",SHOW_MD_UPGRADE_COMPLETE_MSG:"show-md-upgrade-complete-msg",FORCED_MD_UPGRADE_COMPLETE:"forced-md-upgrade-complete",MOBILE_PLATFORM:"mobile-platform",REMEMBER_ME:"remember-me",LOGOUT_TOKEN:"logout-token",OLD_LOGOUT_CREDS:"old-logout-cred",NO_TAKEOVER:"no-takeover",WHATSAPP_LS_VERSION:"ver",WAM_BUFFER:"wam-buffer",WAM_INFO:"wam-info",TIME_SPENT_EVENT:"WaTimeSpentEvent",VIDEO_VOLUME:"video-volume",VIDEO_MUTE:"video-mute",CONTACT_CHECKSUM:"contact-checksum",USER_PRIVACY_SETTINGS:"user-privacy-settings",IS_SMB:"is-smb",COMPOSE_CONTENTS_PREFIX:"compose-contents_",THEME:"theme",SYSTEM_THEME_MODE:"system-theme-mode",ABPROPS:"abprops",HISTORY_SYNC_EARLIEST_DATE:"history-sync-earliest-date",CHATS_USER_SENT_MESSAGE_TO:"chats-user-sent-message-to",SYNCD_DISABLED_DUE_TO_FATAL:"syncd_disabled_due_to_fatal",SYNCD_FIRST_CLEAR_OR_DELETE:"syncd-first-clear-or-delete",CONTACT_SYNC_REFRESH:"contact-sync-refresh-seconds",TOS_3:"TOS_STATE_20210210",NOTICE_BANNER_CLOSED_AT:"notice-banner-closed-at",NOTICE_ID:"notice-id",LOG_CURSOR:"debugCursor",LOCAL_TAKEOVER_OK:"local-takeover-ok",PS_KILLSWITCH_TOKEN:"ps-killswitch-token",STORAGE_DISMISS_STATE:"storage-dismiss-state",STORAGE_ALERT_FLAG:"storage-alert-flag"}},53055:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._clearUserSessionItem=function(e){const t=w();if(!t)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const r=(0,_.default)(G(t.toString(),e));y.default.removeItem(r)},t._get=L,t._getAllKeyValues=function(){const e=N();return(0,s.default)(Object.keys(e).map((function(t){return[t,e.getItem(t)]})))},t._getKeys=T,t._getMe=w,t._getPS=M,t._getPSIgnoringCache=function(e){return L(e,h.default,!1,!0)},t._getTS=function(e){return L(e,y.default)},t._getUser=R,t._getUserSession=function(e){const t=w();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return L((0,_.default)(G(t.toString(),e)),y.default)},t._set=k,t._setAllKeyValues=function(e){const t=N();Object.keys(e).forEach((function(r){null!=e[r]&&t.setItem(r,e[r])}))},t._setKeys=C,t._setPS=O,t._setTS=function(e,t){k(e,t,y.default)},t._setUser=D,t._setUserSession=function(e,t){const r=w();if(!r)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;k((0,_.default)(G(r.toString(),e)),t,y.default)},t._storage=N,t.clearAllLocalState=function(){return P.apply(this,arguments)},t.clearAllTemporaryStorageData=function(){y.default.clear(b())},t.getCollection=function(e){return R(e)},t.getRememberMe=I,t.setCollection=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null==w()||r||D(e,t)},t.setRefTokCookies=function(e,t){if(void 0===self.document)return;u.setCookie({name:"ref",value:e,path:m.PP_REF,domain:d.COOKIE_DOMAIN,secure:!0}),u.setCookie({name:"tok",value:t,path:m.PP_TOK,domain:d.COOKIE_DOMAIN,secure:!0})},t.setRememberMe=function(e){const t=!!e;if(t===I())return;__LOG__(2)`UserPrefs:setRememberMe: ${String(t)}`;const r=N();O(g.KEYS.REMEMBER_ME,t);const n=N();if(r!==n){(0,a.default)(Object.keys(r.dataStore),E.LS_ONLY_KEYS.concat(E.LS_PRESERVE_KEYS)).forEach((function(e){const t=r.getItem(e);null!=t&&(n.setItem(e,t),r.removeItem(e))}))}t||f.Logger.clearLogs()},t.updatePreservedUserKeys=function(){var e;const t=w(),r=null!==(e=M(g.KEYS.PRESERVED_USER_KEYS))&&void 0!==e?e:[];if(null!=t){const e=E.LS_PRESERVE_USER_KEYS.map((e=>(0,_.default)(G(t.toString(),e))));O(g.KEYS.PRESERVED_USER_KEYS,(0,o.default)(r,e))}};var i=n(r(48926)),a=n(r(91966)),o=n(r(93386)),s=n(r(17204)),l=n(r(2525)),c=n(r(7287)),d=r(57932),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=S(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64418)),p=n(r(78144)),f=r(70818),_=n(r(64084)),h=n(r(99304)),g=r(72407),m=r(41601),y=n(r(97920)),E=r(70499);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(S=function(e){return e?r:t})(e)}function v(){void 0!==self.document&&(u.setCookie({name:"ref",expirationDate:0,domain:d.COOKIE_DOMAIN,path:m.PP_REF}),u.setCookie({name:"tok",expirationDate:0,domain:d.COOKIE_DOMAIN,path:m.PP_TOK}))}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,c.default)(t,t.map((t=>e.getItem(t,r))))}function C(e,t){(0,l.default)(t,(function(t,r){e.setItem(r,t)}))}function A(){var e;const t=null!==(e=M(g.KEYS.PRESERVED_USER_KEYS))&&void 0!==e?e:[],r=[...E.LS_PRESERVE_KEYS,...t];return T(h.default,r,!0)}function b(){return T(y.default,E.TS_PRESERVE_KEYS,!0)}function P(){return(P=(0,i.default)((function*(){const e=A(),t=[y.default.clear(b()),h.default.clear(e)];t.push(f.Logger.clearLogs()),v(),yield Promise.all(t)}))).apply(this,arguments)}function M(e){return L(e,h.default)}function O(e,t){k(e,t,h.default)}function I(){let e=M(g.KEYS.REMEMBER_ME);const t=r(7293).GK;return t.supportsFeature(t.F.MD_BACKEND)&&!1===e&&(e=!0,O(g.KEYS.REMEMBER_ME,!0)),null===e&&(e=!0,O(g.KEYS.REMEMBER_ME,!0)),!!e}function w(){return r(99234).getMaybeMeUser()}function R(e){const t=w();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return L((0,_.default)(G(t.toString(),e)))}function D(e,t){const r=w();if(!r)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;k((0,_.default)(G(r.toString(),e)),t)}function N(){return I()?h.default:y.default}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N(),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null==e)throw new Error("_get called with no key");const i=t.getItem(e,n);if(r||null==i)return i;try{return JSON.parse(i,p.default)}catch(r){return __LOG__(2,void 0,void 0,!0)`userPrefs:_get(${e}) '${r}' ${i}`,SEND_LOGS("userprefs-parse-error"),void t.removeItem(e)}}function k(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N(),n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Error("_set called with no key");if(null==t)r.removeItem(e);else if(n){if("string"!=typeof t)throw new Error("_set: expecting string because isRawString is true");r.setItem(e,t)}else r.setItem(e,JSON.stringify(t),i)}function G(e,t){return[e,t].join(":")}},70499:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TS_PRESERVE_KEYS=t.LS_PRESERVE_USER_KEYS=t.LS_PRESERVE_KEYS=t.LS_ONLY_KEYS=void 0;var n=r(72407);const i=[n.KEYS.LOG_CURSOR,n.KEYS.WHATSAPP_MUTEX,n.KEYS.REMEMBER_ME,n.KEYS.WHATSAPP_LS_VERSION];t.LS_ONLY_KEYS=i;const a=[n.KEYS.LANG,n.KEYS.WHATSAPP_MUTEX,n.KEYS.REMEMBER_ME,n.KEYS.OLD_LOGOUT_CREDS,n.KEYS.MD_OPTED_IN,n.KEYS.PRESERVED_USER_KEYS,n.KEYS.THEME,n.KEYS.SYSTEM_THEME_MODE,n.KEYS.MD_INTERN_VERSION_STR];t.LS_PRESERVE_KEYS=a;const o=[n.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,n.KEYS.FORCED_MD_UPGRADE_COMPLETE];t.TS_PRESERVE_KEYS=o;const s=[n.KEYS.EMOJI_VARIANT_COLLECTION,n.KEYS.RECENT_EMOJI_COLLECTION,n.KEYS.CHAT_PREFERENCE_COLLECTION,n.KEYS.GLOBAL_MUTE_NOTIFICATIONS,n.KEYS.OUTGOING_MESSAGE_SOUND,n.KEYS.GLOBAL_MUTE_PREVIEWS,n.KEYS.GLOBAL_COLLAPSE_MUTED,n.KEYS.GLOBAL_MUTE_SOUNDS,n.KEYS.AUTO_DOWNLOAD_PHOTOS,n.KEYS.AUTO_DOWNLOAD_VIDEOS,n.KEYS.AUTO_DOWNLOAD_AUDIO,n.KEYS.AUTO_DOWNLOAD_DOCUMENTS,n.KEYS.TOS_3];t.LS_PRESERVE_USER_KEYS=s},72441:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"asChatJid",{enumerable:!0,get:function(){return n.asChatJid}}),Object.defineProperty(t,"asMulticastJid",{enumerable:!0,get:function(){return n.asMulticastJid}}),Object.defineProperty(t,"asPhoneChatJid",{enumerable:!0,get:function(){return n.asPhoneChatJid}}),Object.defineProperty(t,"asStatusJid",{enumerable:!0,get:function(){return n.asStatusJid}}),Object.defineProperty(t,"authorAsUserJid",{enumerable:!0,get:function(){return n.authorAsUserJid}}),Object.defineProperty(t,"authorToUserId",{enumerable:!0,get:function(){return n.authorToUserId}}),t.defaultDeviceJidForUser=void 0,Object.defineProperty(t,"defaultLidDeviceJidForLidUserJid",{enumerable:!0,get:function(){return n.defaultLidDeviceJidForLidUserJid}}),Object.defineProperty(t,"defaultPhoneDeviceJidForUser",{enumerable:!0,get:function(){return n.defaultPhoneDeviceJidForUser}}),Object.defineProperty(t,"extractDeviceIDParts",{enumerable:!0,get:function(){return n.extractDeviceIDParts}}),Object.defineProperty(t,"extractDeviceId",{enumerable:!0,get:function(){return n.extractDeviceId}}),Object.defineProperty(t,"extractFromJid",{enumerable:!0,get:function(){return n.extractFromJid}}),Object.defineProperty(t,"extractJidFromJidWithType",{enumerable:!0,get:function(){return n.extractJidFromJidWithType}}),Object.defineProperty(t,"extractPhoneUserJid",{enumerable:!0,get:function(){return n.extractPhoneUserJid}}),Object.defineProperty(t,"extractUserId",{enumerable:!0,get:function(){return n.extractUserId}}),Object.defineProperty(t,"extractUserJid",{enumerable:!0,get:function(){return n.extractUserJid}}),Object.defineProperty(t,"fullFormDeviceJidString",{enumerable:!0,get:function(){return n.fullFormDeviceJidString}}),t.getGroupCallDomain=void 0,Object.defineProperty(t,"getGroupDomain",{enumerable:!0,get:function(){return n.getGroupDomain}}),Object.defineProperty(t,"getServerDomain",{enumerable:!0,get:function(){return n.getServerDomain}}),t.getUserDomain=void 0,Object.defineProperty(t,"groupIdFromJid",{enumerable:!0,get:function(){return n.groupIdFromJid}}),Object.defineProperty(t,"interpretAndValidateJid",{enumerable:!0,get:function(){return n.interpretAndValidateJid}}),Object.defineProperty(t,"interpretAsDeviceId",{enumerable:!0,get:function(){return n.interpretAsDeviceId}}),Object.defineProperty(t,"interpretAsGroupJid",{enumerable:!0,get:function(){return n.interpretAsGroupJid}}),Object.defineProperty(t,"interpretAsNumber",{enumerable:!0,get:function(){return n.interpretAsNumber}}),Object.defineProperty(t,"interpretAsPhoneUserJid",{enumerable:!0,get:function(){return n.interpretAsPhoneUserJid}}),Object.defineProperty(t,"interpretAsUserJid",{enumerable:!0,get:function(){return n.interpretAsUserJid}}),Object.defineProperty(t,"isPrimaryDevice",{enumerable:!0,get:function(){return n.isPrimaryDevice}}),Object.defineProperty(t,"maybeSanitizeLogLineText",{enumerable:!0,get:function(){return n.maybeSanitizeLogLineText}}),Object.defineProperty(t,"parseJidParts",{enumerable:!0,get:function(){return n.parseJidParts}}),Object.defineProperty(t,"phoneNumberFromJid",{enumerable:!0,get:function(){return n.phoneNumberFromJid}}),Object.defineProperty(t,"sanitizeJidForLogging",{enumerable:!0,get:function(){return n.sanitizeJidForLogging}}),Object.defineProperty(t,"stripAgentIdFromPhoneDeviceJid",{enumerable:!0,get:function(){return n.stripAgentIdFromPhoneDeviceJid}}),Object.defineProperty(t,"switchOnChatJidType",{enumerable:!0,get:function(){return n.switchOnChatJidType}}),Object.defineProperty(t,"switchOnJidType",{enumerable:!0,get:function(){return n.switchOnJidType}}),Object.defineProperty(t,"switchOnMsgrChatJidType",{enumerable:!0,get:function(){return n.switchOnMsgrChatJidType}}),Object.defineProperty(t,"switchOnMulticastJidType",{enumerable:!0,get:function(){return n.switchOnMulticastJidType}}),Object.defineProperty(t,"switchOnPhoneChatJidType",{enumerable:!0,get:function(){return n.switchOnPhoneChatJidType}}),Object.defineProperty(t,"switchOnPhoneJidType",{enumerable:!0,get:function(){return n.switchOnPhoneJidType}}),Object.defineProperty(t,"toBroadcastJid",{enumerable:!0,get:function(){return n.toBroadcastJid}}),t.toDeviceJid=void 0,Object.defineProperty(t,"toGroupJid",{enumerable:!0,get:function(){return n.toGroupJid}}),Object.defineProperty(t,"toPhoneDeviceJid",{enumerable:!0,get:function(){return n.toPhoneDeviceJid}}),Object.defineProperty(t,"toPhoneUserJid",{enumerable:!0,get:function(){return n.toPhoneUserJid}}),t.toUserJid=void 0,Object.defineProperty(t,"unsafeCoerceToDeviceId",{enumerable:!0,get:function(){return n.unsafeCoerceToDeviceId}}),Object.defineProperty(t,"unsafeCoerceToDeviceJid",{enumerable:!0,get:function(){return n.unsafeCoerceToDeviceJid}}),Object.defineProperty(t,"unsafeCoerceToGroupJid",{enumerable:!0,get:function(){return n.unsafeCoerceToGroupJid}}),Object.defineProperty(t,"unsafeCoerceToUserJid",{enumerable:!0,get:function(){return n.unsafeCoerceToUserJid}}),Object.defineProperty(t,"userIdFromJid",{enumerable:!0,get:function(){return n.userIdFromJid}});var n=r(52230);const i=(0,n.createJidUtils)({platform:"whatsapp"}),a=i.toUserJid;t.toUserJid=a;const o=i.toDeviceJid;t.toDeviceJid=o;const s=i.getUserDomain;t.getUserDomain=s;const l=i.getGroupCallDomain;t.getGroupCallDomain=l;const c=i.defaultDeviceJidForUser;t.defaultDeviceJidForUser=c},36982:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));t.default=class{open(){return this._openPromise?this._openPromise:this._closePromise?(this._openPromise=this._closePromise.catch((e=>{throw this._openPromise=null,e})).then((()=>(this._openPromise=null,this.open()))),this._openPromise):(this._openPromise=this.doOpen().catch((e=>{throw this._openPromise=null,e})).then((()=>{this._openPromise=null})),this._openPromise)}close(){return this._closePromise?this._closePromise:this._openPromise?(this._closePromise=this._openPromise.catch((e=>{throw this._closePromise=null,e})).then((()=>(this._closePromise=null,this.close()))),this._closePromise):(this._closePromise=this.doClose().catch((e=>{throw this._closePromise=null,e})).then((()=>{this._closePromise=null})),this._closePromise)}get(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doGet(e)}))()}queryByIndex(e,t){var r=this;return(0,i.default)((function*(){return yield r.open(),r.doQueryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doGetAll()}))()}put(e,t){var r=this;return(0,i.default)((function*(){return yield r.open(),r.doPut(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doDel(e)}))()}count(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doCount()}))()}clear(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doClear()}))()}doGet(){throw new Error("Not implemented")}doQueryByIndex(){throw new Error("Not implemented")}doGetAll(){throw new Error("Not implemented")}doPut(){throw new Error("Not implemented")}doDel(){throw new Error("Not implemented")}doCount(){throw new Error("Not implemented")}doClear(){throw new Error("Not implemented")}doOpen(){throw new Error("Not implemented")}doClose(){throw new Error("Not implemented")}}},57932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COOKIE_DOMAIN=void 0;t.COOKIE_DOMAIN=".web.whatsapp.com"},64418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.getCookie=function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:void 0},t.setCookie=function(e){e.session&&delete e.expirationDate;const t=[];["name","value","domain","path","secure","session","expirationDate"].forEach((r=>{const n=e[r];if(void 0!==n&&"value"!==r)switch(r){case"expirationDate":const i=new Date(e.expirationDate);t.push(`expires=${i.toUTCString()}`);break;case"secure":t.push("secure");break;case"name":const a=e.value||"";t.push(`${String(n)}=${a}`);break;default:t.push(`${r}=${String(n)}`)}})),document.cookie=t.join(";")}},61498:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.detectWebpSupport=function(){return s.apply(this,arguments)},t.getCachedWebpSupport=function(){return o};var i=n(r(48926));const a=(0,r(38284).promiseTimeout)(new Promise((e=>{Modernizr.on("webp",e)})).then((e=>!(!e||!e.valueOf()))),5e3).catch((()=>!1));let o=null;function s(){return(s=(0,i.default)((function*(){if(o)return Promise.resolve(o);const e=yield a;return o=e,e}))).apply(this,arguments)}},92658:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(38284),a=n(r(25613)),o=n(r(64237)),s=n(r(34342)),l=r(65127);const c="Modernizr"in window;class d extends s.default{constructor(){super(),this.supported=c?Modernizr.serviceworker:"serviceWorker"in navigator,this._checkAlive=()=>{var e;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;return Boolean(t)},this._checkStreamingSupport=()=>{var e;if(!this.supported||!this.alive||l.UA.isSafari)return void(this._streamingSupported=!1);if(this._streamingSupportedPromise)return this._streamingSupported;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;t&&(this._streamingSupportedPromise=(0,i.promiseTimeout)(a.default.request(t,o.default.STREAMING_SUPPORTED),100).catch((()=>!1)).then((e=>(delete this._streamingSupportedPromise,this.streamingSupported=e,e))))},this._setSupported=e=>{this.supported=e},c&&Modernizr.on("serviceworker",this._setSupported);const e=this;Object.defineProperty(this,"streamingSupported",{get:()=>(e._checkStreamingSupport(),e._streamingSupported),set(t){t!==e._streamingSupported&&e.trigger("change:streamingSupported",t),e._streamingSupported=t}}),Object.defineProperty(this,"alive",{get:()=>e._checkAlive()})}}var u=new d;t.default=u},67924:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JS_HALT_EVENT=t.CLOCK_CHANGE_BACKWARDS_EVENT=t.BaseJsHaltDetector=void 0;var i=n(r(34342));const a="js_halt";t.JS_HALT_EVENT=a;const o="clock_change_backwards";t.CLOCK_CHANGE_BACKWARDS_EVENT=o;class s extends i.default{constructor(e,t){super(),this._interval=e,this._threshold=t}startDetection(){if(this._intervalId)return;let e=Date.now();this._intervalId=setInterval((()=>{const t=Date.now(),r=t-e-this._interval;r>this._threshold?this.trigger(a,r):r<-this._threshold&&this.trigger(o,r),e=t}),this._interval),__LOG__(2)`JsHaltDetector:detection started`}stopDetection(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null,__LOG__(2)`JsHaltDetector:detection stopped`)}restartDetection(){this.stopDetection(),this.startDetection(),__LOG__(2)`JsHaltDetector:detection restarted`}}t.BaseJsHaltDetector=s},85553:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CLOCK_CHANGE_BACKWARDS_EVENT",{enumerable:!0,get:function(){return n.CLOCK_CHANGE_BACKWARDS_EVENT}}),t.DEFAULT_THRESHOLD=t.DEFAULT_INTERVAL=void 0,Object.defineProperty(t,"JS_HALT_EVENT",{enumerable:!0,get:function(){return n.JS_HALT_EVENT}}),t.jsHaltDetector=void 0;var n=r(67924);t.DEFAULT_THRESHOLD=3e3;t.DEFAULT_INTERVAL=1e4;const i=new n.BaseJsHaltDetector(1e4,3e3);t.jsHaltDetector=i,i.startDetection()},28195:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));t.default=class{constructor(e){let{name:t,handler:r=null,interval:n=3600,restingInterval:i=18e3,sleepWhileResting:a=!1,randomIntervalExtension:o=0}=e;if(this._running=!1,this._slowDown=!1,this._name=t,this._interval=1e3*n,this._restingInterval=1e3*i,this._sleepWhileResting=a,this._randomIntervalExtension=1e3*o,this._rest(),"function"==typeof r)this.poll(r);else if(null!=r)throw new Error("Poll handler must be a function or null")}_getRandomExtension(){return Math.ceil(Math.random()*this._randomIntervalExtension)}_getInterval(){return(this._slowDown?this._restingInterval:this._interval)+this._getRandomExtension()}_rest(){document.addEventListener("visibilitychange",(()=>{this._lock||(document.hidden?this._sleepWhileResting?(__LOG__(2)`LazyPoll[${this._name}]: Inactive paused`,this._pause()):(__LOG__(2)`LazyPoll[${this._name}]: Inactive slowing down`,this._slowDown=!0):this._callback&&(__LOG__(2)`LazyPoll[${this._name}]: Active Resuming`,this._resume()))}),!1)}_isDue(){if(!this._lastPoll)return!0;return Date.now()-this._lastPoll>=this._getInterval()}_pause(){clearTimeout(this._timer),this._running=!1}_resume(){this._slowDown=!1,this._running=!0,this._cycle()}_cycle(){var e=this;return(0,i.default)((function*(){e._running&&(e._isDue()&&(__LOG__(2)`LazyPoll[${e._name}]: Polling...`,yield e._callback(),e._lastPoll=Date.now()),clearTimeout(e._timer),e._timer=setTimeout((()=>e._cycle()),e._getInterval()))}))()}poll(e){null==this._callback?(this._callback=e,this._running=!0,this._cycle()):this.resume()}pause(){__LOG__(2)`LazyPoll[${this._name}]: Manually Paused`,this._lock=!0,this._pause()}resume(){__LOG__(2)`LazyPoll[${this._name}]: Manually Resumed`,this._lock=!1,this._resume()}}},11854:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=n(r(84644)),o=r(2541);const s={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT"};function l(e,t){for(const r in t)e.setRequestHeader(r,t[r])}function c(e,t,r,n,c,d,u){const p=new XMLHttpRequest,f=new Promise(((n,i)=>{if(p.onload=function(e){4===p.readyState?n(p):(__LOG__(4,void 0,new Error)`xhr.request:onload`,i(e))},p.onerror=e=>{__LOG__(4,void 0,new Error)`xhr.request:onerror`,i(e)},p.ontimeout=e=>{__LOG__(4,void 0,new Error)`xhr.request:ontimeout`,i(e)},d&&(p.onprogress=d),p.onabort=e=>{__LOG__(4,void 0,new Error)`xhr.request:onabort`,i(e)},r instanceof FormData)p.open(t||s.POST,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send(r);else if(r instanceof Object){const n=o.URL.build(e,r);p.open(t||s.GET,n,!0),c&&(p.responseType=c),u&&l(p,u),p.send()}else p.open(t||s.GET,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send()})),_=(0,a.default)(f,n).cancellable();return _.catch((0,i.catchAbort)((()=>{p.abort()}))).catch((()=>{})),_}var d={head:function(e,t){return c(e,s.HEAD,null,t)},get:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return c(e,s.GET,null,n,t,void 0,r)},post:function(e,t,r){return c(e,s.POST,t,r)},request:c,VERB:s,RESP_TYPE:{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",JSON:"json"}};t.default=d},49347:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),Object.defineProperty(t,"HttpInvalidResponseError",{enumerable:!0,get:function(){return a.HttpInvalidResponseError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"HttpTimedOutError",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"MmsDownloadFilehashMismatchError",{enumerable:!0,get:function(){return a.MmsDownloadFilehashMismatchError}});var i=r(89385),a=r(73188),o=n(r(23907)),s=n(r(17971)),l=n(r(16490))},73188:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MmsDownloadFilehashMismatchError=t.HttpInvalidResponseError=void 0;var n=r(40265);class i extends((0,n.customError)("HttpInvalidResponseError")){constructor(e,t){super(e)}}t.HttpInvalidResponseError=i;t.MmsDownloadFilehashMismatchError=class extends i{constructor(e){super("mmsDownload: filehash mismatch",e),this.name="MmsDownloadFilehashMismatchError"}}},23907:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("HttpNetworkError")){}t.default=i},17971:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("HttpStatusCodeError")){constructor(e,t,r){super(`${t}: ${e}`),this.status=e}}t.default=i},16490:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23907));class a extends i.default{constructor(){super(...arguments),this.name="HttpTimedOutError"}}t.default=a},61181:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extendedFetch=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _(e,t).catch((e=>{if(e.name===o.ABORT_ERROR)throw new o.AbortError;if(e instanceof l.HttpNetworkError)throw e;throw new l.HttpNetworkError(e.message)}))},t.sharedFetch=_;var i=n(r(48926)),a=n(r(81109)),o=r(89385),s=r(76100),l=r(49347),c=r(25241),d=n(r(66335)),u=n(r(16566)),p=r(64551);const f=r(76672)({UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((r,n)=>{var o;if(null===(o=t.signal)||void 0===o?void 0:o.aborted)return void n(new c.DOMException("AbortError"));const _=new XMLHttpRequest;if(t.signal){const e=t.signal;e.addEventListener("abort",(function t(){e.removeEventListener("abort",t),_.onreadystatechange=()=>{},_.abort(),n(new c.DOMException("AbortError"))}))}const{onProgress:h,onResponseText:g}=t;var m;(null!=h||g)&&((p.ServerProps.webLargeFilesUi&&"post"===(null===(m=t.method)||void 0===m?void 0:m.toLowerCase())?_.upload:_).onprogress=e=>{g&&g(e,_.responseText),h&&h(e)});const{onHeadersReceived:y}=t;_.onreadystatechange=()=>{if(_.readyState===f.UNSENT)n(new Error("fetch error: not sent"));else if(_.readyState===f.HEADERS_RECEIVED&&null!=y)y(new d.default((0,u.default)(_.getAllResponseHeaders())));else if(_.readyState===f.DONE){if(null==_.status)return void n(new Error("fetch error: no status"));if(0===_.status||_.status>=12e3)return void n(new Error(`fetch error: unexpected status ${_.status}`));r(S())}},_.onerror=()=>n(new Error("fetch error: error")),_.ontimeout=()=>{n(new l.HttpTimedOutError("fetch error: timedout"))},_.withCredentials="include"===t.credentials,null!=t.timeout&&(_.timeout=t.timeout),_.open(t.method||"get",e.toString(),!0);const E=new d.default(t.headers||{});for(const e of E.keys()){const t=E.get(e);null!=t&&_.setRequestHeader(e,t)}function S(){const e=new d.default((0,u.default)(_.getAllResponseHeaders()));return(0,a.default)((0,a.default)({ok:200<=_.status&&_.status<300,statusText:_.statusText,status:_.status,url:_.responseURL},function(){if(g)return{text:()=>Promise.resolve(_.responseText),json:()=>Promise.resolve(JSON.parse(_.responseText)),arrayBuffer:()=>(0,s.largeStringToArrayBuffer)(_.responseText)};return{text:()=>v(),json:(e=(0,i.default)((function*(){const e=yield v();return JSON.parse(e)})),function(){return e.apply(this,arguments)}),arrayBuffer:()=>_.response};var e}()),{},{blob:()=>Promise.resolve(new Blob([_.response],{type:e.get("content-type")||""})),clone:S,headers:e})}function v(){return Promise.resolve(String.fromCharCode(...Array.from(new Uint8Array(_.response))))}g?_.overrideMimeType("text/plain; charset=x-user-defined"):_.responseType="arraybuffer",_.send(t.body||null)}))}},16566:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(e||"").trim().toLowerCase().split("\n").reduce(((e,t)=>{if(!t.trim())return e;const r=t.indexOf(":"),n=t.substr(0,r).trim(),i=t.substr(r+1).trim().replace(/;$/,"");return e[n]?Array.isArray(e[n])?e[n].push(i):e[n]+=`, ${i}`:e[n]=i,e}),{})}},70740:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e,a)};var i=n(r(14176));const a=e=>null==e},25613:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));class a{constructor(e){this.onMessage=e=>{if(!e.data||!e.data.action)return;const t=e.data;if(!e.ports||0===e.ports.length)return;const r=e.ports;if(!a.isSW()&&window.navigator.serviceWorker&&e.source!==window.navigator.serviceWorker.controller)return;("function"==typeof e.waitUntil?t=>e.waitUntil(t):()=>{})(Promise.resolve(this.requestHandler(t)).then((e=>{r[0].postMessage(e)})).catch((e=>{r[0].postMessage({error:e&&e.toString()})})))},this.requestHandler=e}init(){const e=a.isSW()?self:window.navigator.serviceWorker;try{if(!e)return;e.addEventListener("message",this.onMessage)}catch(e){}}static isSW(){return"undefined"==typeof window}static getRequestor(e){return a.isSW()?"string"==typeof e?self.clients.get(e):Promise.resolve(e):window.navigator.serviceWorker?window.navigator.serviceWorker.ready.then((()=>window.navigator.serviceWorker?window.navigator.serviceWorker.controller:null)):Promise.resolve(null)}static broadcast(e,t){return(0,i.default)((function*(){if(!a.isSW())throw new Error("Broadcast called from non-serviceworker.");const r=yield self.clients.matchAll();return 0===r.length?Promise.reject(new Error("No clients available.")):Promise.all(r.map((r=>a.request(r,e,t))))}))()}static request(e,t,r){const n=new MessageChannel;return new Promise(((i,o)=>(n.port1.onmessage=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.error)?o(e.data.error):i(e.data)},a.getRequestor(e).then((e=>{if(!e)return o(new Error("No ServiceWorker controlling this client."));e.postMessage({action:t,message:r,version:"2.2208.7"},[n.port2])})))))}}t.default=a},64237:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={REQUEST_STREAMING_INFO:"GET_STREAMING_INFO",REQUEST_RMR:"REQUEST_RMR",SEND_STREAMING_CHUNK:"SEND_STREAMING_CHUNK",EXP_BACKOFF:"EXP_BACKOFF",LOG:"LOG",UPLOAD_LOGS:"UPLOAD_LOGS",REQUEST_DOCUMENT_DOWNLOAD:"REQUEST_DOCUMENT_DOWNLOAD",SET_L10N:"SET_L10N",STREAMING_SUPPORTED:"STREAMING_SUPPORTED",REMOVE_PP:"REMOVE_PP",LOGOUT:"LOGOUT",CLEAN_ASSETS:"CLEAN_ASSETS",PRELOAD_LAZY_LOADED_BUNDLES:"PRELOAD_LAZY_LOADED_BUNDLES",ACTIVE_TAB:"ACTIVE_TAB"};t.default=r},38125:(e,t,r)=>{"use strict";var n=r(95318),i=n(r(25613)),a=n(r(64237)),o=n(r(92658)),s=r(88102),l=r(70818),c=r(46582),d=r(27838),u=r(62583),p=r(8080),f=r(65044);if(o.default.supported){const e=function(){try{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&e.controller.addEventListener("error",(e=>{f.Socket.state!==u.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker controller error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker, error: ${e}`}};try{const t=navigator.serviceWorker;t&&t.addEventListener("controllerchange",(()=>{e(),f.Socket.state===u.SOCKET_STATE.UNLAUNCHED&&(p.Stream.needsUpdate=!0)}))}catch(e){__LOG__(3)`Unable to add "controllerchange" event listener to service worker container, error: ${e}`}try{const e=navigator.serviceWorker;e&&e.addEventListener("error",(e=>{f.Socket.state!==u.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker container error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker container, error: ${e}`}e();const t=function(e,t){e.buffer.forEach((e=>{var r;const n=null!==(r=e.message[0])&&void 0!==r?r:"",i=function(e){switch(e){case"info":return 1;case"log":return 2;case"warn":return 3;case"error":return 4}throw new Error(`Invalid level: ${e}`)}(e.level.match(/^(.*?)(?:Verbose)?$/i)[1]);l.Logger.logImpl(i,`ServiceWorker (${t}): ${n}`,e.error,e.attachedToSendLogs,e.extraTags)}))};new i.default((e=>{let{action:n,message:i,version:o}=e;switch(n){case a.default.REQUEST_STREAMING_INFO:case a.default.EXP_BACKOFF:case a.default.REQUEST_RMR:case a.default.SEND_STREAMING_CHUNK:return(0,c.requireHandleVideoStreamingRequest)().then((e=>e({action:n,message:i})));case a.default.LOG:if(f.Socket.state===u.SOCKET_STATE.UNLAUNCHED)return;return i&&t(i,o),{test:!0};case a.default.UPLOAD_LOGS:i&&t(i,o);return r(85965).upload({reason:"Requested by Service Worker"}).then((()=>{}));case a.default.ACTIVE_TAB:return{isActive:(0,d.getIsTabActive)()};default:return Promise.reject(new Error(`Invalid Action: ${n}`))}})).init(),s.Cmd.on("logout",(()=>{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&i.default.request(e.controller,a.default.LOGOUT).catch((()=>{}))}))}},47734:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,i.randomHex)(16).substr(0,64);return __LOG__(2)`voip:generateCallId: ${e}`,e};var i=r(87614);n(r(64369))},83938:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Promise.resolve(!1)}},22007:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateICELiteAnswerSDP=function(e,t,r,i,a,o,s){const l=(_=e,_.ip.join(".")),c=e.port+1,d=t,u=r,p=a,f=(0,n.encodeB64)(o);var _;let h=`v=0\no=- ${(new Date).getTime()} 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0${s?" 1":""}\na=ice-lite\na=msid-semantic: WMS g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\nm=audio ${c} RTP/SAVP 111\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=setup:active\na=mid:0\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:111 opus/48000/2\na=fmtp:111 useinbandfec=1\na=fmtp:111 maxplaybackrate=16000; sprop-maxcapturerate=16000\na=rtcp-fb:111 goog-remb\na=ssrc:${i} cname:noAs9WOptAnM/+QP\n`;s&&(h+=`m=video ${c} RTP/SAVP 102\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=mid:1\na=extmap:3 urn:3gpp:video-orientation\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=rtcp-rsize\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:102 VP8/90000\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:102 goog-remb\na=ssrc:${p} cname:rcpcNyS/Kejuq2+Y\na=ssrc:${p} msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=ssrc:${p} mslabel:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\na=ssrc:${p} label:df375ff4-7ed5-459d-b991-76c8e47ffc52\n`);return{type:"answer",sdp:h}},t.modifyOfferSDP=function(e,t,r,i,a){let o=e;if(o=o.replace(/a=crypto:[1-9].*\r\n/g,""),o=o.replace(/a=crypto:0.*/g,`a=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${(0,n.encodeB64)(i)}`),o=o.replace(/a=rtcp-fb.*transport-cc.*\r\n/g,""),o=o.replace(/a=extmap:3.*draft-holmer-rmcat.*\r\n/g,""),a){const e=o.search(/m=video/g);let n=o.substring(0,e),i=o.substring(e);n=n.replace(/ssrc:\S+/g,`ssrc:${t}`),i=i.replace(/ssrc:\S+/g,`ssrc:${r}`),i=i.replace(/a=extmap:13 urn:3gpp:video-orientation/g,"a=extmap:3 urn:3gpp:video-orientation"),o=n+i}else o=o.replace(/ssrc:\S+/g,`ssrc:${t}`);return o};var n=r(15688)},84356:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Voip=void 0,t.checkVoipCapability=function(){return Promise.resolve(!1)};var i=n(r(48926)),a=r(15688),o=r(81576),s=r(11141),l=r(22683),c=r(99234),d=n(r(47734)),u=n(r(72451)),p=r(97048),f=r(46582),_=r(56981),h=r(22007),g=n(r(69594)),m=n(r(89345)),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(45473)),E=r(49835),S=r(24746),v=n(r(91932));function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}let C=null,A=new v.default;const b={init:()=>(__LOG__(2)`voip:init`,Promise.resolve(!1)),updateAudioVideoSwitch:()=>{},cleanup:()=>{},refresh:()=>{},callStart:(e,t)=>{if(!g.default.isVoiceCallEnabled()&&!g.default.isVideoCallEnabled())throw new Error("voip:callStart: calling not enabled");if(A.getState()!==E.WEB_CALL_STATES.NONE)throw new Error("Call cannot be started because there is already a call in progress");__LOG__(2)`voip:callStart: ${e.toString()} video: ${t.toString()}`,function(){O.apply(this,arguments)}(e,t)},groupCallStart:()=>{},sendGroupCallInvite:()=>{},endCall:(P=(0,i.default)((function*(){const e=A;A.getState()===E.WEB_CALL_STATES.ACTIVE&&(yield function(){return Y.apply(this,arguments)}(A.callId,A.peerJid),(yield(0,f.requireCallCollection)()).remove(e.callId)),e.pc.close(),e.localStream.getTracks().forEach((e=>e.stop())),e.remoteAudioStream&&e.remoteAudioStream.getTracks().forEach((e=>e.stop())),e.remoteVideoStream&&e.remoteVideoStream.getTracks().forEach((e=>e.stop())),A=new v.default})),function(){return P.apply(this,arguments)}),callEndByHandledRemotely:()=>{},acceptCall:()=>{},rejectCall:()=>{},rejectCallWithoutCallCtx:()=>{},resendEncRekeyRetry:()=>{},processMissedIncomingCallMaxRetry:()=>{},mute:()=>{},videoTurnCameraOn:()=>{},videoTurnCameraOff:()=>{},videoStreamPause:()=>{},videoStreamResume:()=>{},videoRequestUpgrade:()=>{},videoAcceptUpgrade:()=>{},videoRejectUpgrade:()=>{},videoCancelUpgrade:()=>{},handleIncomingSignalingMessage:(e,t)=>(0,i.default)((function*(){const r=y.TYPE_NAME[e.type];__LOG__(2)`voip:handleIncomingSignalingMsg: type: "${r}" msg: `;const[n,i]=yield Promise.all([(0,f.requireCallCollection)(),(0,f.requireVoipCommonDisabled)()]),a=n.get(e.call_id);if(null==a?void 0:a.canHandleLocally)switch(e.type){case y.TYPE.OFFER:const r=e.peer_jid,i=e.t;if(r){const{isVideo:e,callId:n,randomBytes:a,key:o,token:s,relay:l}=function(e){const t=e[1]["call-id"];let r=null,n=null,i=null,a=null,o=!1;for(const t of e[2])__LOG__(2)`voip:offer: offerChild: `,"enc"===t[0]?a=new Uint8Array(t[2]):"video"===t[0]?o=!0:"relay"===t[0]&&([r,n,i]=$(t));if(null==r||null==n||null==i)throw new Error("Error parsing relay attributes in Offer");if(null==a)throw new Error("No random byte source found in Offer");return{callId:t,token:r,key:n,relay:i,randomBytes:a,isVideo:o}}(t.payload);yield function(e,t,r){const n=S.AUDIO_CODECS.DEFAULT,i=r?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,a=n.concat(i),o=["preaccept",{"call-id":e,"call-creator":t},a.concat([S.CAPABILITIES.DEFAULT,S.ENCOPT.DEFAULT])];return(0,_.sendCallSignalingMsg)({common:{type:"preaccept",call_id:e,peer_jid:t},payload:o})}(n,r.toString({legacy:!0}),e),function(){I.apply(this,arguments)}(e,n,r,a,o,s,l,i)}break;case y.TYPE.OFFER_RECEIPT:case y.TYPE.ACCEPT_RECEIPT:case y.TYPE.MUTE:case y.TYPE.VIDEO_STATE:break;case y.TYPE.ACCEPT:A.getState()===E.WEB_CALL_STATES.OUTGOING_CALLING&&A.setState(E.WEB_CALL_STATES.ACTIVE);break;case y.TYPE.REJECT:A.getState()===E.WEB_CALL_STATES.OUTGOING_CALLING&&(A.pc.close(),A.localStream.getTracks().forEach((e=>e.stop())),A=new v.default);break;case y.TYPE.TERMINATE:A.getState()===E.WEB_CALL_STATES.ACTIVE&&(A.pc.close(),A.localStream.getTracks().forEach((e=>e.stop())),n.remove(A.callId),A=new v.default)}else i.handleIncomingSignalingMessage(e,t)}))(),isInitialized:()=>!0,registerVideoCallback:()=>{},cleanupVideoBuffer:()=>{},updateNetworkMedium:()=>{},registerWebRTCCallback:e=>{C=e},notifyDeviceIdentityChangedOrDeleted:()=>{},getNumParticipantsFromCallOffer:()=>Promise.resolve(-1)};var P;function M(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),e.buffer}function O(){return(O=(0,i.default)((function*(e,t){if(!u.default)throw new Error("Unable to request Media Devices.");const r=yield(0,u.default)({audio:!0,video:t}),n=(0,d.default)();(yield(0,f.requireCallCollection)()).add({id:n,peerJid:e,offerTime:l.Clock.globalUnixTime(),isVideo:t,outgoing:!0,webClientShouldHandle:!0,canHandleLocally:!0});const i=M(),a=(0,c.assertGetMe)(),o=B(),{token:s,key:p,relay:_}=yield H(i,a,e.toString({legacy:!0}),n,t);r.getTracks().forEach((e=>o.addTrack&&o.addTrack(e,r))),A.localStream=r,o.onnegotiationneeded=()=>w(o,n,a,e,i,p,s,_,t,!0),o.ontrack=e=>D(e)}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,r,n,i,a,o,s){(yield(0,f.requireCallCollection)()).add({id:t,peerJid:r,offerTime:s,isVideo:e,outgoing:!1,webClientShouldHandle:!0,canHandleLocally:!0});const l=(0,c.assertGetMe)();if(p.CallUi.set({from:l,to:r,type:e?"video":"voice"}),m.default.openVoipWindow(),yield K(t,r.toString({legacy:!0}),e),!u.default)throw new Error("Unable to request Media Devices.");const d=yield(0,u.default)({audio:!0,video:e}),_=B();d.getTracks().forEach((e=>_.addTrack&&_.addTrack(e,d))),A.localStream=d,_.onnegotiationneeded=()=>w(_,t,l,r,n.buffer,i,a,o,e,!1),_.ontrack=e=>D(e)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t,r,n,i,a,o,s,l,c){const[d,u]=yield x(t,r,n,i),[p,f,_,g]=yield G(t,r,n),m=yield e.createOffer();__LOG__(2,!0)`voip:original-offer: ${m.sdp}`,yield q(s,t,r.toString({legacy:!0}),n.toString({legacy:!0}),E.RELAY_INFO.RELAY_LATENCY),m.sdp&&(m.sdp=(0,h.modifyOfferSDP)(m.sdp,p,f,d,l)),__LOG__(2,!0)`voip:modified-offer: ${m.sdp}`,yield e.setLocalDescription(m),__LOG__(2,!0)`voip:localDescription: `;const y=(0,h.generateICELiteAnswerSDP)(s,o,a,_,g,u,l);__LOG__(2,!0)`voip:generated-answer: ${y.sdp}`,A.setState(c?E.WEB_CALL_STATES.OUTGOING_CALLING:E.WEB_CALL_STATES.INCOMING_CALLING),e.setRemoteDescription(y),A.pc=e,A.answer=y,A.callId=t,A.peerJid=n.toString({legacy:!0}),C&&C({type:E.WEB_CALL_EVENTS.MEDIA_READY,data:A.localStream})}))).apply(this,arguments)}function D(e){if(__LOG__(2)`voip:received-track`,!C)throw new Error("No Track callback registered.");"audio"===e.track.kind&&(A.remoteAudioStream=e.streams[0],C({type:E.WEB_CALL_EVENTS.AUDIO_TRACK_RECEIVED,data:e.streams[0]})),"video"===e.track.kind&&(A.remoteVideoStream=e.streams[0],C({type:E.WEB_CALL_EVENTS.VIDEO_TRACK_RECEIVED,data:e.streams[0]}))}function N(e,t,r,n){const i=new TextDecoder;return(0,o.extractWithSaltAndExpand)(e,t,i.decode(r),n)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t,r){const n=new TextEncoder,i=n.encode(e).buffer,a=n.encode(t).buffer,o=new Uint32Array([r]).buffer,s=yield N(i,o,a,32);return new Uint32Array(s)[0]}))).apply(this,arguments)}function G(e,t,r){const n=L(e,t.toString({legacy:!0,formatFull:!0}),0),i=L(e,r.toString({legacy:!0}),0),a=L(e,t.toString({legacy:!0,formatFull:!0}),2),o=L(e,r.toString({legacy:!0}),2);return Promise.all([n,a,i,o])}function U(){return F.apply(this,arguments)}function F(){return(F=(0,i.default)((function*(e,t){const r=new TextEncoder;return(yield N(e,s.DEFAULT_SALT.buffer,r.encode(t).buffer,46)).slice(0,30)}))).apply(this,arguments)}function x(e,t,r,n){const i=U(n,t.toString({legacy:!0,formatFull:!0})),a=U(n,r.toString({legacy:!0}));return Promise.all([i,a])}function B(){return new RTCPeerConnection({sdpSemantics:"unified-plan"},{mandatory:{},optional:[{DtlsSrtpKeyAgreement:!1},{RtpDataChannels:!1}]})}function K(e,t,r){const n=S.AUDIO_CODECS.DEFAULT,i=r?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,a=["accept",{"call-id":e,"call-creator":t},n.concat(i).concat([["net",{medium:"3"},null],S.ENCOPT.DEFAULT])];return(0,_.sendCallSignalingMsg)({common:{type:"accept",call_id:e,peer_jid:t},payload:a})}function j(e){return["terminate",{"call-id":e},null]}function Y(){return(Y=(0,i.default)((function*(e,t){const r=j(e),n=r[0];yield(0,_.sendCallSignalingMsg)({common:{type:n,call_id:e,peer_jid:t},payload:r})}))).apply(this,arguments)}function W(e,t,r,n){const i=S.AUDIO_CODECS.DEFAULT,a=n?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,o=i.concat(a);return["offer",{"call-id":t,"call-creator":r.toString({legacy:!0})},o.concat([["net",{medium:"3"},null],S.CAPABILITIES.DEFAULT,["enc",{count:"0"},Array.from(new Uint8Array(e))],S.ENCOPT.DEFAULT])]}function H(){return V.apply(this,arguments)}function V(){return(V=(0,i.default)((function*(e,t,r,n,i){const a=W(e,n,t,i),o=a[0];__LOG__(2)`voip:send:offer: payload:`;const s=yield(0,_.sendCallOffer)({common:{type:o,call_id:n,peer_jid:r},payload:a});if(!(null==s?void 0:s.status))throw new Error("Error receiving Offer Ack.");switch(s.status){case 200:if(s.payload){__LOG__(2)`voip:recv:offerAck:`;let e=null,t=null,r=null;for(const n of s.payload[2])"relay"===n[0]&&([e,t,r]=$(n));if(null==e||null==t||null==r)throw new Error("Error parsing relay attributes in Offer Ack");return{token:e,key:t,relay:r}}throw new Error("Error receiving Offer Ack: No Payload");case 409:throw new Error("Error receiving Offer Ack: Phone Busy");default:throw new Error(`Error receiving Offer Ack: Unknown status:${status}`)}}))).apply(this,arguments)}function $(e){let t=null,r=null,n=null;const i=new TextDecoder;for(const o of e[2])if("token"===o[0])t=new Uint8Array(o[2]),t=(0,a.encodeB64)(t),__LOG__(2)`voip:relay token: `;else if("key"===o[0])r=new Uint8Array(o[2]),r=i.decode(r),__LOG__(2)`voip:relay key: `;else if("te2"===o[0]){const e=new Uint8Array(o[2]);if(6===e.length){const t=new DataView(e.buffer);n={ip:[t.getUint8(0),t.getUint8(1),t.getUint8(2),t.getUint8(3)],port:t.getUint16(4)},__LOG__(2)`voip:relay address: `}}if(null==t)throw new Error("Could not extract relay token");if(null==r)throw new Error("Could not extract relay key");if(null==n)throw new Error("Could not extract relay address");return[t,r,n]}function z(e,t,r,n){const i=new ArrayBuffer(6),a=new DataView(i);a.setUint8(0,e.ip[0]),a.setUint8(1,e.ip[1]),a.setUint8(2,e.ip[2]),a.setUint8(3,e.ip[3]),a.setUint16(4,e.port);return[n,{"call-id":t,"call-creator":r},[["te",{latency:"10"},Array.from(new Int8Array(i))]]]}function q(){return J.apply(this,arguments)}function J(){return(J=(0,i.default)((function*(e,t,r,n,i){const a=z(e,t,r,i),o=a[0];yield(0,_.sendCallSignalingMsg)({common:{type:o,call_id:t,peer_jid:n},payload:a})}))).apply(this,arguments)}t.Voip=b},69594:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(7293);var i={isVoiceCallEnabled:function(){let e=!1;return e=n.GK.supportsFeature(n.GK.F.WEB_VOIP_VOICE_CALL),e},isVideoCallEnabled:function(){let e=!1;return e=n.GK.supportsFeature(n.GK.F.WEB_VOIP_VIDEO_CALL),e},isGroupCallEnabled:function(){let e=!1;return e=!1,false},isStatefulEnumerationEnabled:function(){let e=!1;return n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(e=getABPropConfigValue("web_abprop_stateful_enumeration_enabled")),e}};t.default=i},45473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_STR=t.TYPE_NAME=t.TYPE=t.ENC_RETRY_RECEIPT_ATTRS=void 0;t.TYPE={NONE:0,OFFER:1,OFFER_RECEIPT:2,ACCEPT:3,REJECT:4,TERMINATE:5,TRANSPORT:6,OFFER_ACK:7,OFFER_NACK:8,RELAY_LATENCY:9,RELAY_ELECTION:10,INTERRUPTION:11,MUTE:12,PREACCEPT:13,ACCEPT_RECEIPT:14,VIDEO_STATE:15,NOTIFY:16,GROUP_INFO:17,ENC_REKEY:18,PEER_STATE:19,VIDEO_STATE_ACK:20,FLOW_CONTROL:21,WEB_CLIENT:22,ACCEPT_ACK:23,GROUP_UPDATE:24,OFFER_NOTICE:25,MAX:26};t.TYPE_STR={OFFER:"offer",ACCEPT:"accept",ENC_REKEY:"enc_rekey",REJECT:"reject",RECEIPT:"receipt",OFFER_NOTICE:"offer_notice"};t.TYPE_NAME=["NONE","OFFER","OFFER_RECEIPT","ACCEPT","REJECT","TERMINATE","TRANSPORT","OFFER_ACK","OFFER_NACK","RELAY_LATENCY","RELAY_ELECTION","INTERRUPTION","MUTE","PREACCEPT","ACCEPT_RECEIPT","VIDEO_STATE","NOTIFY","GROUP_INFO","ENC_REKEY","PEER_STATE","VIDEO_STATE_ACK","FLOW_CONTROL","WEB_CLIENT","ACCEPT_ACK","GROUP_UPDATE","OFFER_NOTICE","MAX"];t.ENC_RETRY_RECEIPT_ATTRS={SINGLE_PARTICIPANT:"enc",GROUP_CALL:"enc_rekey_retry"}},32968:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playEndCallTone=function(){}},49835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CALL_STATES=t.WEB_CALL_EVENTS=t.WAVideoCodecScheme=t.WACallState=t.WACallEvent=t.WACallEndReason=t.VoipSettingsType=t.VideoUpgradeRequestEndedReason=t.VideoState=t.VOIP_WINDOW_IPC_EVENTS=t.RENDERER_IPC_EVENTS=t.RELAY_INFO=t.PlatformTypeMapping=t.ParticipantState=t.MAIN_IPC_EVENTS=t.CallNetworkMedium=t.CALL_UI_STATES=t.CALL_STATES=t.CALL_RESULT_TYPE=t.CALL_LOG_RESULT_TYPE=t.CALL_LOG_RESULT=void 0;t.WACallEvent={WANone:0,CallOfferSent:1,CallOfferReceived:2,CallOfferAckedWithRelayInfo:3,CallOfferNacked:4,CallOfferReceiptReceived:5,CallAcceptFailed:6,CallAcceptSent:7,CallAcceptReceived:8,CallPreacceptReceived:9,CallTerminateReceived:10,CallRejectReceived:11,CallOfferResend:12,AudioStreamStarted:13,P2PNegotiationSuccess:14,RelayCreateSuccess:15,CallStateChanged:16,P2PNegotiationFailed:17,MediaStreamError:18,AudioInitError:19,NoSamplingRatesForAudioRecord:20,SendOfferFailed:21,HandleOfferFailed:22,SendAcceptFailed:23,HandlePreAcceptFailed:24,HandleAcceptFailed:25,WillCreateSoundPort:26,SoundPortCreateFailed:27,TransportCandSendFailed:28,P2PTransportCreateFailed:29,P2PTransportMediaCreateFailed:30,P2PTransportStartFailed:31,P2PTransportRestartSuccess:32,MissingRelayInfo:33,ErrorGatheringHostCandidates:34,MediaStreamStartError:35,RelayLatencySendFailed:36,RelayElectionSendFailed:37,CallEnding:38,CallCaptureBufferFilled:39,CallCaptureEnded:40,RxTimeout:41,TxTimeout:42,RxTrafficStarted:43,RxTrafficStopped:44,RTCPPacketReceived:45,RTCPByeReceived:46,RelayBindsFailed:47,SoundPortCreated:48,AudioDriverRestart:49,Echo:50,SelfVideoStateChanged:51,PeerVideoStateChanged:52,VideoPortCreated:53,VideoPortCreateFailed:54,VideoDecodeStarted:55,VideoRenderStarted:56,VideoCaptureStarted:57,VideoPreviewFailed:58,VideoPreviewReady:59,VideoPreviewShouldMinimize:60,VideoStreamCreateError:61,VideoRenderFormatChanged:62,VideoCodecMismatch:63,VideoDecodePaused:64,VideoDecodeResumed:65,VideoEncodeFatalError:66,VideoDecodeFatalError:67,BatteryLevelLow:68,PeerBatteryLevelLow:69,GroupInfoChanged:70,FieldstatsReady:71,PendingCallInfoChanged:72,MuteStateChanged:73,InterruptionStateChanged:74,RxTrafficStateForPeerChanged:75,HandleAcceptReceiptFailed:76,GroupParticipantLeft:77,AudioRouteChangeRequest:78,HandleAcceptAckFailed:79,CallMissed:80,WeakWiFiSwitchedToCellular:81,CallAutoConnect:82,RejectedDecryptionFailure:83,PeerDeviceOrientationChanged:84,HandleOfferAckFailed:85,PendingCallAutoRejected:86,FDLeakDetected:87,RestartCamera:88,AudioTestReplayFinished:89,SyncDevices:90,VideoCodecStateChanged:91,CallFatal:92,UpdateJoinableCallLog:93,WAMax:94};t.WAVideoCodecScheme={VideoCodecSchemeNone:0,VideoCodecSchemeH26X:1,VideoCodecSchemeVPX:2,VideoCodecSchemeVPXH26X:3};t.WACallEndReason={WACallEndReasonUnknown:0,WACallEndReasonEndButtonTapped:1,WACallEndReasonEndButtonTappedOnBusy:2,WACallEndReasonReject:3,WACallEndReasonRejectUnavailable:4,WACallEndReasonRejectBlocked:5,WACallEndReasonTimeout:6,WACallEndReasonPeerUnavailable:7,WACallEndReasonRejectedByPeer:8,WACallEndReasonTimedoutByPeer:9,WACallEndReasonTerminatedByPeer:10,WACallEndReasonFailed:11,WACallEndReasonHandledRemotely:12};t.WACallState={WACallStateNone:0,WACallStateCalling:1,WACallStatePreacceptReceived:2,WACallStateReceivedCall:3,WACallStateAcceptSent:4,WACallStateAcceptReceived:5,WACallStateCallActive:6,WACallStateCallActiveElseWhere:7,WACallStateReceivedCallWithoutOffer:8};t.CALL_UI_STATES={NONE:"NONE",OUTGOING_RING:"OUTGOING_RING",INCOMING_RING:"INCOMING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED"};t.CALL_STATES={INCOMING_RING:"INCOMING_RING",OUTGOING_RING:"OUTGOING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",CONNECTION_LOST:"CONNECTION_LOST",ACTIVE:"ACTIVE",HANDLED_REMOTELY:"HANDLED_REMOTELY",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED",NOT_ANSWERED:"NOT_ANSWERED"};t.WEB_CALL_STATES={OUTGOING_CALLING:"OUTGOING_CALLING",INCOMING_CALLING:"INCOMING_CALLING",ACTIVE:"ACTIVE",NONE:"NONE"};t.WEB_CALL_EVENTS={MEDIA_READY:"MEDIA_STREAM_READY",AUDIO_TRACK_RECEIVED:"AUDIO_TRACK_RECEIVED",VIDEO_TRACK_RECEIVED:"VIDEO_TRACK_RECEIVED"};t.VOIP_WINDOW_IPC_EVENTS={INIT:"VOIP_WINDOW_INIT",UPDATE:"VOIP_WINDOW_UPDATE",REJECT:"VOIP_WINDOW_REJECT",ACCEPT:"VOIP_WINDOW_ACCEPT",IGNORE:"VOIP_WINDOW_IGNORE",END:"VOIP_WINDOW_END",RESET:"VOIP_WINDOW_RESET",TOGGLE_MUTE:"VOIP_WINDOW_TOGGLE_MUTE",TOGGLE_CAMERA:"VOIP_WINDOW_TOGGLE_CAMERA",OPEN_IN_CALL_MENU:"OPEN_IN_CALL_MENU",CLOSE_IN_CALL_MENU:"CLOSE_IN_CALL_MENU",TOGGLE_DEBUG_INFO:"TOGGLE_DEBUG_INFO",GROUP_CALL_INVITE:"GROUP_CALL_INVITE",UPGRADE_REQUEST:"UPGRADE_REQUEST",UPGRADE_ACCEPT:"UPGRADE_ACCEPT",UPGRADE_REJECT:"UPGRADE_REJECT",UPGRADE_CANCEL:"UPGRADE_CANCEL",INITIATE_WINDOW_MOVE:"INITIATE_WINDOW_MOVE",CLOSE_WINDOW_CLICK:"CLOSE_WINDOW_CLICK",MINIMIZE_WINDOW_CLICK:"MINIMIZE_WINDOW_CLICK",MAXIMIZE_WINDOW_CLICK:"MAXIMIZE_WINDOW_CLICK",UNMAXIMIZE_WINDOW_CLICK:"UNMAXIMIZE_WINDOW_CLICK",WINDOW_MAXIMIZED:"WINDOW_MAXIMIZED",WINDOW_UNMAXIMIZED:"WINDOW_UNMAXIMIZED",WINDOW_TITLE_DBL_CLICK:"WINDOW_TITLE_DBL_CLICK",WINDOW_ESC_PRESS:"WINDOW_ESC_PRESS",WINDOW_ALWAYS_ON_TOP_CHANGED:"WINDOW_ALWAYS_ON_TOP_CHANGED",L10N_UPDATE:"L10N_UPDATE"};t.MAIN_IPC_EVENTS={EVENT:"VOIP_MAIN_WINDOW_EVENT",SIGNALING:"VOIP_MAIN_WINDOW_SIGNALING",LOGGING:"VOIP_MAIN_WINDOW_LOGGING",LOG_PATH:"VOIP_MAIN_WINDOW_LOG_PATH",AV_EVENT:"AV_DEVICE_INFO_CHANGED",AV_LOG:"AV_MAIN_WINDOW_LOGGING",AV_DEVICE_CHANGE_TOAST:"AV_DEVICE_CHANGE_TOAST",AV_DEVICE_STATUS_CHANGE:"AV_DEVICE_STATUS_CHANGE"};t.RENDERER_IPC_EVENTS={ENABLE_VOIP_FEATURES:"voip:ENABLE_VOIP_FEATURES",ENABLE_VOIP_GROUP_FEATURES:"voip:ENABLE_VOIP_GROUP_FEATURES",REQUEST_NUM_PARTICIPANTS:"voip:REQUEST_NUM_PARTICIPANTS"};t.CALL_RESULT_TYPE={INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23};t.CALL_LOG_RESULT={0:"invalid",1:"canceled",2:"missed",3:"unavailable",4:"reject",5:"connected"};t.CALL_LOG_RESULT_TYPE={INVALID:0,CANCELED:1,MISSED:2,UNAVAILABLE:3,REJECT:4,CONNECTED:5};t.VoipSettingsType={voipSettingsNone:0,voipSettingsAudio:1,voipSettingsVideo:2};t.VideoState={VideoStateDisabled:0,VideoStateEnabled:1,VideoStatePaused:2,VideoStateUpgradeRequest:3,VideoStateUpgradeAccept:4,VideoStateUpgradeReject:5,VideoStateStopped:6,VideoStateUpgradeRejectByTimeout:7,VideoStateUpgradeCancel:8,VideoStateUpgradeCancelByTimeout:9,VideoStateError:20};t.VideoUpgradeRequestEndedReason={EndedByUser:0,EndedByTimeout:1};t.ParticipantState={ParticipantStateInvalid:0,ParticipantConnected:1,ParticipantIncoming:2,ParticipantRinging:3,ParticipantRejected:4,ParticipantTerminated:5,ParticipantTimedout:6,ParticipantCreatingCall:7,ParticipantInvisible:8,ParticipantVisible:9,ParticipantCancelOffer:10};t.CallNetworkMedium={CallNetworkMediumCellular:1,CallNetworkMediumWifi:2,CallNetworkMediumNone:3};t.PlatformTypeMapping={0:"unknown",1:"android",2:"iphone",3:"wp",4:"ios_tablet",5:"kaios",6:"windows",7:"portal",8:"mac_os_electron",9:"windows_electron"};t.RELAY_INFO={RELAY_ELECTION:"relayelection",RELAY_LATENCY:"relaylatency"}},24746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_CODECS=t.ENCOPT=t.CAPABILITIES=t.AUDIO_CODECS=void 0;t.CAPABILITIES={DEFAULT:["capability",{ver:"1"},[1,4,255,131,207,4]]};t.ENCOPT={DEFAULT:["encopt",{keygen:"2"},null]};t.AUDIO_CODECS={DEFAULT:[["audio",{enc:"opus",rate:"16000"},null],["audio",{enc:"opus",rate:"8000"},null]],RATE_16K:[["audio",{enc:"opus",rate:"16000"},null]]};t.VIDEO_CODECS={NONE:[],DEFAULT:[["video",{orientation:"0",screen_width:"1920",screen_height:"1080",device_orientation:"0",enc:"vp8",dec:"vp8"},null]]}},91214:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitDeviceLinkEvent=function(){return h.apply(this,arguments)},t.initDeviceLinkEvent=function(e,t,r){u=new c.default.MdLinkDeviceCompanion,p={regStartTime:r,accountSignature:e,identityKey:t}},t.setDeviceLinkPairStage=function(e){if(!u)return;u.set({mdLinkDeviceCompanionStage:e})};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(73045),l=r(92844),c=n(r(11339)),d=r(58052);let u=null,p=null;function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const r=new o.Binary;r.writeBuffer(e),r.write("_".charCodeAt(0)),r.writeBuffer(t);const n=r.readByteArray(),i=yield(0,s.sha256)(n);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=(0,d.getUpgradeMdWamFlag)();if(!u||!p)return;const r=u,n=p,i=yield f(p.accountSignature,p.identityKey),a=(0,l.unixTime)()-n.regStartTime;r.set({mdDurationS:a,mdSessionId:i,mdTimestampS:n.regStartTime,mdWasUpgraded:t,mdLinkDeviceCompanionErrorCode:null==e?0:e}),r.commit(),u=null,p=null,(0,d.setUpgradeMdWamFlag)(!1)}))).apply(this,arguments)}},68271:(e,t)=>{"use strict";function r(){let e={},t={},r={};const n={},i=Object.getOwnPropertyNames(window),a=Object.getOwnPropertyNames(document),o=Array.prototype.slice.call(window.document.documentElement.attributes);function s(e,t){const r={};return e.map((e=>{r[e]=!!t.includes(e)})),r}return t=s(["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"],i),e=s(["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],a),r=s(["selenium","webdriver","driver"],o),t.wd=window.navigator.webdriver,n.wKeys=t,n.dKeys=e,n.dElKeys=r,n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={getAutoToolsProperties:()=>({data:r()})};t.default=n},7902:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(68271)),a=n(r(11339));var o=new class{constructor(){this.logToWam()}logToWam(){const e=i.default.getAutoToolsProperties(),t={webcDocumentWebdriverEvaluate:e.data.dKeys.__webdriver_evaluate,webcDocumentSeleniumEvaluate:e.data.dKeys.__selenium_evaluate,webcDocumentWebdriverScriptFunction:e.data.dKeys.__webdriver_script_function,webcDocumentWebdriverScriptFunc:e.data.dKeys.__webdriver_script_func,webcDocumentWebdriverScriptFn:e.data.dKeys.__webdriver_script_fn,webcDocumentFxdriverEvaluate:e.data.dKeys.__fxdriver_evaluate,webcDocumentDriverUnwrapped:e.data.dKeys.__driver_unwrapped,webcDocumentWebdriverUnwrapped:e.data.dKeys.__webdriver_unwrapped,webcDocumentDriverEvaluate:e.data.dKeys.__driver_evaluate,webcDocumentSeleniumUnwrapped:e.data.dKeys.__selenium_unwrapped,webcDocumentFxdriverUnwrapped:e.data.dKeys.__fxdriver_unwrapped,webcDocumentElementAttrSelenium:e.data.dElKeys.selenium,webcDocumentElementAttrWebdriver:e.data.dElKeys.webdriver,webcDocumentElementAttrDriver:e.data.dElKeys.driver,webcWindowPhantom:e.data.wKeys._phantom,webcWindowNightmare:e.data.wKeys.__nightmare,webcWindowSelenium:e.data.wKeys._selenium,webcWindowCallphantom:e.data.wKeys.callPhantom,webcWindowCallselenium:e.data.wKeys.callSelenium,webcWindowSeleniumIdeRecorder:e.data.wKeys._Selenium_IDE_Recorder,webcWindowNavigatorWebdriver:!0===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.TRUE:!1===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.FALSE:a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.UNDEFINED};new a.default.WebcFingerprint(t).commit()}};t.default=o},42515:(e,t,r)=>{"use strict";function n(e){const t=e.participants.length,r=e.cachedDeviceCount;if(t>32){const e={participantCount:t};return null!=r&&(e.deviceCount=r),e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetricsFromChatWid=function(e){if(!e.isGroup())return;const t=r(63928).default.get(e);if(null!=t)return n(t)},t.getGroupMetricsFromGroupMetadata=n},50047:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logLabelOperationEvent=function(e,t,r){const n={labelOperation:e};null!=t&&Object.assign(n,{labelCount:t});r&&Object.assign(n,{labelTarget:r});new i.default.LabelEvent(n).commit()};var i=n(r(11339))},88353:(e,t,r)=>{"use strict";t.I=void 0;var n=r(15688),i=r(8584),a=r(87278),o=r(55021);const s=r(11339).default;t.I=class{constructor(e,t,r,n){this.bufferKey=e,this.buffer=new i.Binary(void 0,!0),this.buffer.writeString("WAM");const a=(0,o.getWamProtocolVersion)();this.buffer.writeUint8(a),a>=5&&(this.buffer.writeUint8(1),this.buffer.writeUint16(t),"regular"===this.bufferKey?this.buffer.writeUint8(0):this.buffer.writeUint8(2),this.psIdStore=r),this.eventsWritten=0,this.prevGlobals={},this.dirtyGlobals={},this.unsavedPortion=null,this.saveKey=String(1e9*Math.random()|0),n&&this._setAll(n)}size(){return this.buffer.size()}set(e,t){this.dirtyGlobals[String(e)]=t,this.unsavedPortion&&this.unsavedPortion.set(e,t)}write(e){const t=this.buffer;var r;(this.set(47,e.commitTime),this.set(3433,e.sequenceNumber),"private"===e.wamChannel)&&this.set(6005,null===(r=this.psIdStore)||void 0===r?void 0:r.getLatestPrivateStatsIdValueFromKey(this.bufferKey).toString());this._flushGlobals();const n=e.all,i=Object.keys(n);let o=-1,l=!1;for(let e=0;e<i.length;e++){null!=n[i[e]]&&(o=e,l=!0)}(0,a.writeEvent)(t,e.id,-e.weight,l);for(let r=0;r<=o;r++){const c=i[r],d=s.METRICS.getEvent(e.$className,c).id;let u=n[c];null!=u&&("boolean"==typeof u&&(u=u?1:0),l=r<o,(0,a.writeField)(t,d,u,l))}this.eventsWritten++,this.unsavedPortion&&this.unsavedPortion.write(e)}stringBuffer(){return this.eventsWritten>0?(0,n.encodeB64)(this.buffer.peek((e=>e.readByteArray()))):""}getBuffer(){return this.buffer}_setAll(e){const t="regular"===this.bufferKey?"regular":"private";for(const r in e){const n=e[r],i=s.METRICS.getGlobal(r).channels.includes(t);void 0!==n&&i&&this.set(s.METRICS.getGlobal(r).id,n)}}_flushGlobals(){const e=this.dirtyGlobals,t=this.prevGlobals;for(const r in e){let n=e[r];if("boolean"==typeof n)n=n?1:0;else if(void 0===n)n=null;else if(Number.isNaN(n))continue;if(n!==t[r]){t[r]=n;const e=parseInt(r,10);(0,a.writeGlobalAttribute)(this.buffer,e,n)}}this.dirtyGlobals={}}upgradeWamHeaderFromV3ToV5(e){if(!r(86945).getABPropConfigValue("web_wam_v5_enabled")||this.buffer.size()<4)return this.buffer;const[t,n]=this.buffer.peek((e=>[e.readString(3),e.readUint8()]));if(3===n){const r=new i.Binary(void 0,!0);r.writeString(t),r.writeUint8(5),r.writeUint8(1),r.writeUint16(e),"regular"===this.bufferKey?r.writeUint8(0):r.writeUint8(2);const n=this.buffer.peek((e=>e.readByteArray())).slice(4);r.write(n),this.buffer=r}return this.buffer}}},87278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeEvent=function(e,t,r,n){return i(e,t,r,n?1:5)},t.writeField=function(e,t,r,n){return i(e,t,r,n?2:6)},t.writeGlobalAttribute=function(e,t,r){return i(e,t,r,0)};var n=r(8584);function i(e,t,r,i){if(null==r)0===i&&a(e,t,i);else if("number"==typeof r&&r===(0|r))0===r?a(e,t,16|i):1===r?a(e,t,32|i):-128<=r&&r<128?(a(e,t,48|i),e.writeInt8(r)):-32768<=r&&r<32768?(a(e,t,64|i),e.writeInt16(r)):(a(e,t,80|i),e.writeInt32(r));else if("number"==typeof r)a(e,t,112|i),e.writeFloat64(r);else if("string"==typeof r){const o=(0,n.numUtf8Bytes)(r);o<256?(a(e,t,128|i),e.writeUint8(o)):o<65536?(a(e,t,144|i),e.writeUint16(o)):(a(e,t,160|i),e.writeUint32(o)),e.writeString(r)}}function a(e,t,r){t<256?(e.writeUint8(r),e.writeUint8(t)):(e.writeUint8(8|r),e.writeUint16(t))}},34894:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));const a={document:i.default.MEDIA_TYPE.DOCUMENT,video:i.default.MEDIA_TYPE.VIDEO,gif:i.default.MEDIA_TYPE.GIF,image:i.default.MEDIA_TYPE.PHOTO,audio:i.default.MEDIA_TYPE.AUDIO};t.default=class{constructor(e,t,r){this.mediaPickerSentUnchanged=0,this.mediaPickerDeleted=0,this.mediaPickerChanged=new Set,this.mediaPickerCroppedRotated=new Set,this.mediaPickerDrawing=new Set,this.mediaPickerStickers=new Set,this.mediaPickerText=new Set,this.mediaPickerLikeDoc=0,this.mediaPickerNotLikeDoc=0,this.mediaPickerT=0,this.t0=Date.now(),this.mediaType=a[t],this.mediaPickerOrigin=r,this.medias=new Set,this.medias.add(e),this.changeTypes={mediaPickerCroppedRotated:this.mediaPickerCroppedRotated,mediaPickerDrawing:this.mediaPickerDrawing,mediaPickerStickers:this.mediaPickerStickers,mediaPickerText:this.mediaPickerText}}onAdd(e){this.medias.add(e),"document"===this.mediaType?this.mediaPickerLikeDoc++:this.mediaPickerNotLikeDoc++}onChange(e,t){this.mediaPickerChanged.add(e),this.changeTypes[t].add(e)}onDelete(e){if(this.medias.delete(e),this.mediaPickerDeleted++,0===this.medias.size)return this.onCancel()}onSend(){return this.mediaPickerSent=this.medias.size,this.mediaPickerSentUnchanged=this.mediaPickerSent-this.mediaPickerChanged.size,this.dataPreflight()}onCancel(){return this.mediaPickerSent=0,this.mediaPickerSentUnchanged=0,this.dataPreflight()}onPause(){this.mediaPickerT+=Date.now()-(this.t0||0),this.t0=null}onResume(){this.t0=null!=this.t0?this.t0:Date.now()}dataPreflight(){let e=this.mediaPickerSentUnchanged;return isNaN(e)&&(e=0,__LOG__(4,void 0,new Error,!0)`mediaPickerSentUnchange mediaPickerSent: ${null!=this.mediaPickerSent&&0!==this.mediaPickerSent?this.mediaPickerSent:"undefined"}, mediaPickerChanged: ${this.mediaPickerChanged.size||"undefined"}`,SEND_LOGS("mediaPickerSentUnchange is not a number")),{mediaPickerSent:this.mediaPickerSent,mediaPickerSentUnchanged:e,mediaPickerT:this.mediaPickerT+(Date.now()-(this.t0||0)),mediaType:this.mediaType,mediaPickerOrigin:this.mediaPickerOrigin,mediaPickerChanged:this.mediaPickerChanged.size,mediaPickerCroppedRotated:this.mediaPickerCroppedRotated.size,mediaPickerDrawing:this.mediaPickerDrawing.size,mediaPickerStickers:this.mediaPickerStickers.size,mediaPickerText:this.mediaPickerText.size,mediaPickerLikeDoc:this.mediaPickerLikeDoc,mediaPickerNotLikeDoc:this.mediaPickerNotLikeDoc,mediaPickerDeleted:this.mediaPickerDeleted}}}},90535:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerStatsLogger=t.MediaPickerChangeTypes=void 0;var i=n(r(81109)),a=n(r(34894)),o=n(r(11339));t.MediaPickerChangeTypes={mediaPickerCroppedRotated:"mediaPickerCroppedRotated",mediaPickerDrawing:"mediaPickerCroppedRotated",mediaPickerStickers:"mediaPickerCroppedRotated",mediaPickerText:"mediaPickerCroppedRotated"};t.MediaPickerStatsLogger=class{constructor(){this.mediaByTypeAndOrigin=new Map,this.mediaEventReverseIndex=new Map,this.chatRecipients=null}pauseTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onPause()}))}resumeTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onResume()}))}_getKey(e,t){return`${e}_${t}`}_commitLog(e){new o.default.MediaPicker((0,i.default)((0,i.default)({},e),{},{chatRecipients:this.chatRecipients})).commit()}_processNewMedia(e,t,r){const n=this._getKey(t,r),i=this.mediaByTypeAndOrigin.get(n);if(i)i.onAdd(e),this.mediaEventReverseIndex.set(e,i);else{const i=new a.default(e,t,r);this.mediaByTypeAndOrigin.set(n,i),this.mediaEventReverseIndex.set(e,i)}}logChange(e,t){const r=this.mediaEventReverseIndex.get(e);r&&r.onChange(e,t)}logDelete(e){const t=this.mediaEventReverseIndex.get(e);t&&t.onDelete(e)}logSend(e){this.mediaByTypeAndOrigin.forEach((t=>{this._commitLog((0,i.default)((0,i.default)({},t.onSend()),{},{isViewOnce:e.isViewOnce}))}))}logCancel(){this.mediaByTypeAndOrigin.forEach((e=>{this._commitLog(e.onCancel())}))}logAdd(e,t,r){this.mediaEventReverseIndex.get(e)||this._processNewMedia(e,t,r)}}},29992:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateMediaEventId=function(){return 1+Math.floor(Number.MAX_SAFE_INTEGER*Math.random())},t.getMetricBackendStore=function(e){if(!e)return s.default.BACKEND_STORE_TYPE.NON_DIRECT_PATH;switch(e.slice(0,2).toLowerCase()){case"/v":return s.default.BACKEND_STORE_TYPE.EVERSTORE;case"/o":return s.default.BACKEND_STORE_TYPE.OIL}return __LOG__(4,void 0,new Error,!0)`Unrecognized direct path type`,SEND_LOGS("unrecognized-direct-path-type"),null},t.getMetricDownloadErrorResultType=function(e){if(e instanceof o.MMSThrottleError)return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof a.NoMediaHostsError)return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e instanceof o.HttpNetworkError)return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_NETWORK;if(e instanceof o.HttpStatusCodeError)switch(e.status){case 404:case 410:return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_TOO_OLD;case 416:return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANNOT_RESUME;case 401:return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_INVALID_URL;case 429:case 507:return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;default:return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN}if(e.name===i.ABORT_ERROR)return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof o.MmsDownloadFilehashMismatchError)return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_ENC_HASH_MISMATCH;return s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getMetricMediaType=function(e){switch(e){case"audio":return s.default.MEDIA_TYPE.AUDIO;case"document":case"thumbnail-document":return s.default.MEDIA_TYPE.DOCUMENT;case"gif":return s.default.MEDIA_TYPE.GIF;case"image":case"thumbnail-image":return s.default.MEDIA_TYPE.PHOTO;case"ppic":return s.default.MEDIA_TYPE.PROFILE_PIC;case"product":return s.default.MEDIA_TYPE.PRODUCT_IMAGE;case"ptt":return s.default.MEDIA_TYPE.PTT;case"sticker":return s.default.MEDIA_TYPE.STICKER;case"video":case"thumbnail-video":return s.default.MEDIA_TYPE.VIDEO;case"template":return s.default.MEDIA_TYPE.TEMPLATE;case"md-msg-hist":return s.default.MEDIA_TYPE.MD_HISTORY_SYNC;case"md-app-state":return s.default.MEDIA_TYPE.MD_APP_STATE;case"product-catalog-image":return s.default.MEDIA_TYPE.PRODUCT_IMAGE;case"thumbnail-link":return s.default.MEDIA_TYPE.URL;case"payment-bg-image":return s.default.MEDIA_TYPE.NONE;default:throw new Error(`webMediaType is invalid: ${e}`)}},t.getMetricOverallDownloadModeType=function(e){if(l(e))return s.default.MEDIA_DOWNLOAD_MODE_TYPE.THUMBNAIL;return s.default.MEDIA_DOWNLOAD_MODE_TYPE.FULL},t.getMetricOverallUploadModeType=function(e){if(l(e))return s.default.MEDIA_UPLOAD_MODE_TYPE.THUMBNAIL;return s.default.MEDIA_UPLOAD_MODE_TYPE.REGULAR},t.getMetricUploadErrorResultType=function(e){if(e instanceof o.MMSUnauthorizedError)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_NO_PERMISSIONS;if(e instanceof o.MediaTooLargeError)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_BAD_MEDIA;if(e instanceof o.MMSThrottleError)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof o.HttpStatusCodeError&&e.status>=500)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_SERVER;if(e instanceof a.NoMediaHostsError)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e.name===i.ABORT_ERROR)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof o.HttpNetworkError)return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UPLOAD;return s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getStatusCode=function(e){if(e instanceof o.HttpStatusCodeError)return e.status},t.logErrorUnknownDetails=function(e,t){if(null==t)return;let r;e.overallDownloadResult===s.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN?r=s.default.WEBC_MEDIA_OPERATION_CODE.DOWNLOAD:e.overallUploadResult===s.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN&&(r=s.default.WEBC_MEDIA_OPERATION_CODE.UPLOAD);if(null==r)return;new s.default.WebcMediaErrorUnknownDetails({mediaId:e.mediaId,webcMediaOperation:r,webcMediaErrorName:t.name}).commit()};var i=r(89385),a=r(40859),o=r(27856),s=n(r(11339));function l(e){switch(e){case"thumbnail-document":case"thumbnail-image":case"thumbnail-video":case"thumbnail-link":return!0}return!1}},30097:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfReporter=void 0;var i=r(42515),a=n(r(11339)),o=n(r(57362));t.MessageSendPerfReporter=class{constructor(e,t,r){this._messageIsInvisible=!1,this._messageIsFirstUserMessage=!1,this._startTime=Date.now(),this._stagesMap=new Map,this._mediaType=t,this._messageType=r,this._cacheGroupMetadata(e)}setFetchedPrekeyCount(e){this._fetchedPrekeyCount=e}setSenderKeyDistributionCount(e){this._senderKeyDistributionCount=e}setMessageIsInvisible(e){this._messageIsInvisible=e}setMessageIsFirstUserMessage(e){this._messageIsFirstUserMessage=e}startRenderedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}postRenderedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}startSavedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}postSavedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}startPrekeysFetchStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}postPrekeysFetchStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}startWrittenWireStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}postWrittenWireStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}startWaitingToEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}postWaitingToEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}startReadyToSendStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}postReadyToSendStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}startClientEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}postClientEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}_start(e){const t=new a.default.AndroidMessageSendPerf({sendStage:e});return this._stagesMap.set(e,t),t}_post(e){const t=this._stagesMap.get(e)||this._start(e);if(t.mediaType=this._mediaType,t.messageType=this._messageType,t.messageIsInvisible=this._messageIsInvisible,t.messageIsFirstUserMessage=this._messageIsFirstUserMessage,t.durationRelative=Date.now()-this._startTime,t.fetchPrekeys=null!=this._fetchedPrekeyCount&&this._fetchedPrekeyCount>0,this._groupMetadata){t.groupSizeBucket=(0,o.default)(this._groupMetadata.participants.length),null!=this._groupMetadata.cachedDeviceSizeBucket&&(t.deviceSizeBucket=this._groupMetadata.cachedDeviceSizeBucket),Object.assign(t,(0,i.getGroupMetricsFromGroupMetadata)(this._groupMetadata));const e=this._groupMetadata.cachedDeviceCount||0;e>0&&(null!=this._fetchedPrekeyCount&&(t.fetchPrekeysPercentage=Math.round(this._fetchedPrekeyCount/e*100)),null!=this._senderKeyDistributionCount&&(t.senderKeyDistributionCountPercentage=Math.round(this._senderKeyDistributionCount/e*100)))}null!=t.fetchPrekeysPercentage&&t.fetchPrekeysPercentage>=50||t.messageIsFirstUserMessage?t.weight=0:null!=t.senderKeyDistributionCountPercentage&&t.senderKeyDistributionCountPercentage>=50&&(t.weight=20),t.markDurationAbs(),t.commit()}_cacheGroupMetadata(e){if(null!=e&&e.isGroup()){const t=r(63928).default.get(e);null!=t&&(this._groupMetadata=t)}}}},11339:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(52211);const{BOOLEAN:o,INTEGER:s,NUMBER:l,STRING:c,TIMER:d}=a.TYPES,u=Object.freeze({INVALID_PROTOCOL_BUFFER:1}),p=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_DEVICE_IDENTITY:2,ADV_SIGNED_KEY_INDEX_LIST:3,ADV_KEY_INDEX_LIST:4}),f=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),_=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),h=Object.freeze({LIMITED:0,FULL:1,LEGACY:2,LEVEL_3:3,EXTERNAL:4}),g=Object.freeze({API_1:1,API_2:2}),m=Object.freeze({NOT_AVAILABLE:1,SELF_TEST_FAILURE:2,ENC_KEY_READ_FAILURE:3,ENC_KEY_STORED_USED:4,ENC_KEY_PLAIN_DELETED:5,ENC_KEY_PLAIN_RECOVERED:6}),y=Object.freeze({DEBUG:1,ALPHA:2,BETA:3,RELEASE:4}),E=Object.freeze({FOREGROUND:1,BACKGROUND:2}),S=Object.freeze({JNI:1,OPENSLES:2}),v=Object.freeze({AUTO_REPLY_ACTION_FLAG_RECEIVED:0,AUTO_REPLY_ACTION_REPLY_SENT:1}),T=Object.freeze({NON_DIRECT_PATH:1,EVERSTORE:2,OIL:3}),C=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1}),A=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4}),b=Object.freeze({SHOWN:1,CLICK:2,DISMISS:3,ELIGIBLE:4,REVOKED:5}),P=Object.freeze({GROUP:1,SMB_WELCOME:2,SMB_VERIFIED:3,SMB_EDIT_PROFILE:4,SMB_EDIT_DESCRIPTION:5,SMB_EDIT_CATEGORY:6,SMB_EDIT_HOURS:7,SMB_EDIT_EMAIL:8,SMB_CATALOG:9,SMB_CATALOG_SHARE_BANNER:10,CROSS_SELL_PROFILE_INTERSTITIAL:11,CROSS_SELL_CHATS_INTERSTITIAL:12,CROSS_SELL_CHATS_BANNER:13,BUSINESS_ACCOUNT_SYSTEM_MESSAGE:14,SMB_CATALOG_CART_INTERSTITIAL:15,PAYMENTS_ONBOARD_BANNER:16,SMB_DIRECTORY_UPSELL:17,SMB_CATALG_LIST_LWI_ADVERTISE_BANNER:18,SMB_LWI_AD_HUB_EDUCATIONAL_BANNER:19,SMB_COLLECTION_CREATION:20,SMB_AWAY_MESSAGE:21,SMB_GREETING_MESSAGE:22,PAYMENTS_INCENTIVE_BANNER:23,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITH_VALID_PRODUCT:24,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITHOUT_VALID_PRODUCT:25,SMB_MD_AWARENESS:26,BACKUP_QUOTA:27,SMB_ADD_COVER_PHOTO:28,PAYMENTS_MERCHANT_ONBOARDING_BANNER:29}),M=Object.freeze({SHOPS:0,NATIVE:1}),O=Object.freeze({UNKNOWN:1,SMB:2,ENT:3}),I=Object.freeze({OTHER:0,CHAT:1,PROFILE:2,BLOCK_LIST:3,TRIGGERED_BLOCK:4,ACCOUNT_INFO:5,CALL_LOG:6,OVERFLOW_MENU:7,GROUP_INFO:8,BLOCK_DIALOG:9,MESSAGE_MENU:10,MEDIA_VIEWER:11}),w=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5}),R=Object.freeze({REQUEST_BUILT:1,RESPONSE_RECEIVED:2,RESPONSE_PARSED_VALID:3,MISSING_KEYS_REQUESTED:4,MISSING_KEYS_RECEIVED:5,MUTATIONS_DECRYPTED:6,ABOUT_TO_APPLY_MUTATIONS:7,APPLIED_MUTATIONS:8,PUSHNAME_APPLIED:9,PUSHNAME_INVALID:10,ENTERED_RETRY_MODE:11}),D=Object.freeze({IMPRESSION:0,TAP_ON_MESSAGE:1,TAP_ON_PROFILE:2,TAP_ON_CATALOG_VIEW_ALL:3,TAP_ON_CATLOG_PRODUCT:4,DISMISS_PREVIEW:5}),N=Object.freeze({REGISTRATION:1,SETTINGS:2,COMPLIANCE:3,QUICK_REPLY_SMART_DEFAULT:4}),L=Object.freeze({DESCRIPTION:1,HOURS:2,ADDRESS:3,EMAIL:4,WEBSITE:5,CATEGORY:6,PROFILE:7}),k=Object.freeze({BUSINESS_PROFILE_VIEW_ACTION_IMPRESSION:1,BUSINESS_PROFILE_VIEW_ACTION_CLICK_WEBSITE:2,BUSINESS_PROFILE_VIEW_ACTION_CLICK_LOCATION:3,BUSINESS_PROFILE_VIEW_ACTION_CLICK_HOURS:4,BUSINESS_PROFILE_VIEW_ACTION_CLICK_DESCRIPTION:5,BUSINESS_PROFILE_VIEW_ACTION_CLICK_EMAIL:6,BUSINESS_PROFILE_VIEW_ACTION_CLICK_ADDTOCONTACT:7,BUSINESS_PROFILE_VIEW_ACTION_CLICK_MORE_BIZ_PROFILE:8}),G=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),U=Object.freeze({ENTRY_BANNER:0,ENTRY_REGISTRATION_ONBOARDING:1,ENTRY_CONVERSATIONS:2,ENTRY_SETTINGS:3,ENTRY_DEEPLINK:4,ENTRY_STATUS_TAB_MENU:5,ENTRY_CALLS_TAB_MENU:6}),F=Object.freeze({OVERFLOW:0,PROFILE:1,CATALOG:2,AWAY_MESSAGE:3,GREETING_MESSAGE:4,QUICK_REPLIES:5,LABELS:6,LINKED_ACCOUNTS:7,SHORT_LINK:8,STATISTICS:9,CREATE_ACCOUNT_LINK:10,MANAGE_CTA:11,CREATE_AD:12,CONTINUE_PROMPT:13,ADVERTISE_LIST_ITEM:14,SHOPS:15,DISABLED_CATALOG:16,BANNED_SHOP:17}),x=Object.freeze({FACEBOOK:0,INSTAGRAM:1}),B=Object.freeze({CALLS_TAB_MISSED:1,CALLS_TAB_OUTGOING:2,SELECT_CONTACT:3,CALL_INFO:4,NOTIFICATION_MISSED:5,CONTACT_INFO:6,QUICK_CONTACT_INFO:7,CONVERSATION:8,CALLS_TAB_INCOMING:9,GROUP_CHAT_INFO:10,GROUP_CHAT_RECENT_LOCATION:11,ANDROID_BROADCAST_DETAILS:12,ANDROID_LIST_CHAT_INFO:13,ANDROID_CONTACTS_APPLICATION:14,CONTACT_VCARD:15,CALLS_TAB_NEW_CALL:16,VOICE_MAIL_CALL_BACK:17,IOS_INTENT:18,LIVE_LOCATION_MAP:19,GROUP_CALL_INFO:20,CALLS_TAB_BOTTOM_SHEET:21,STATUS_VIEWER:22,DEBUG_TOOL:23,GROUP_CHAT_PICKER:24,GROUP_CHAT_DIRECT:25,STELLA:26,CHAT_LIST:27,NEW_CHAT:28,CONVERSATION_OPTIONS:29,CALL_FAILED_SCREEN:30,BUSINESS_DIRECTORY:31}),K=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),j=Object.freeze({UNBOUND:1,BINDED:2}),Y=Object.freeze({INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23}),W=Object.freeze({CALL_SEGMENT_ONE_ON_ONE_ACTIVE:1,CALL_SEGMENT_GROUP_ACTIVE:2,CALL_SEGMENT_ONE_ON_ONE_HOLD_SELF:3,CALL_SEGMENT_ONE_ON_ONE_HOLD_PEER:4}),H=Object.freeze({UNKNOWN:1,CALL_ACCEPT_FAILED:2,INIT_MEDIA_STREAM_FAILED:3,START_MEDIA_STREAM_FAILED:4,AUDIO_INIT_ERROR:5,HANDLE_OFFER_FAILED:6,HANDLE_ACCEPT_FAILED:7,SOUND_PORT_CREATE_FAILED:8,P2P_TRANSPORT_CREATE_FAILED:9,P2P_TRANSPORT_MEDIA_CREATE_FAILED:10,INCOMPATIBLE_SRTP_KEY_EXCHANGE:11,SRTP_KEY_GENERATION_ERROR:12,UNSUPPORTED_AUDIO_CAPS:13,P2P_TRANSPORT_START_FAILED:14,RELAY_BIND_FAILED:15,CANNOT_INITIALIZE_AUDIO_RECORD_OBJECT:16,PEER_RELAY_BIND_FAILED:17,VIDEO_CAPTURE_INIT_FAILED:18,VIDEO_CAPTURE_START_FAILED:19,VIDEO_RENDER_INIT_FAILED:20,VIDEO_RENDER_START_FAILED:21,VIDEO_ENCODER_OPEN_FAILED:22,VIDEO_DECODER_OPEN_FAILED:23,VIDEO_STREAM_CREATE_FAILED:24,VIDEO_STREAM_SETUP_FAILED:25,PEER_SETUP_FAILED:26,HANDLE_PREACCEPT_FAILED:27}),V=Object.freeze({CALLER:1,CALLEE:2}),$=Object.freeze({ENDED_BY_USER:1,TIMEOUT:2,RECONNECTING:3,ENDED_BY_SELF:4,ENDED_BY_PEER:5,VIDEO_ENCODER_FATAL_ERROR:6,VIDEO_DECODER_FATAL_ERROR:7,AUDIO_RECORD_FATAL_ERROR:8,CRASH:9,DETECT_IDENTITY_CHANGE:10,USER_INVISIBLE:11,RELAY_BIND_FAILED:12,SETUP_FAILED:13,ACCEPTED_ELSEWHERE:14,REJECTED_ELSEWHERE:15,GROUP_CALL_ENDED:16,CALL_IS_FULL:17}),z=Object.freeze({UNKNOWN:0,P2P:1,UDP_RELAY:2,TCP_RELAY:3,MIXED:4}),q=Object.freeze({DISABLED:0,ENABLED:1,PAUSED:2,UPGRADE_REQUEST:3,MUTED:6,ERROR:20}),J=Object.freeze({NONE:0,UNKNOWN:1,APNS_PUSH:2,IOS_VOIP_PUSH:3,GCM_PUSH:4,ONLINE:5,RIM_PUSH:6}),Q=Object.freeze({DEFAULT:0,TEXTURE:1,TEXTURE_FALLBACK:2}),X=Object.freeze({DEFAULT:0,CONSERVATIVE:1,STRICT:2,ERROR:11}),Z=Object.freeze({ACTION_PRODUCT_ADD_CLICKED:1,ACTION_PRODUCT_ADD_SUCCESS:2,ACTION_PRODUCT_ADD_FAILED:3,ACTION_PRODUCT_EDIT_CLICKED:4,ACTION_PRODUCT_EDIT_SUCCESS:5,ACTION_PRODUCT_EDIT_FAILED:6,ACTION_PRODUCT_DELETE_CLICKED:7,ACTION_PRODUCT_DELETE_SUCCESS:8,ACTION_PRODUCT_DELETE_FAILED:9,ACTION_APPEAL_PRODUCT_CLICKED:10,ACTION_APPEAL_PRODUCT_SUCCESS:11,ACTION_APPEAL_PRODUCT_FAILED:12,ACTION_CREATE_PRODUCT_CATALOG:13,ACTION_CREATE_PRODUCT_CATALOG_SUCCESS:14,ACTION_CREATE_PRODUCT_CATALOG_FAILED:15,ACTION_CATALOG_MENU_ITEM_CLICKED:16,ACTION_PRODUCT_RESUBMIT_CLICKED:17,ACTION_START_IMPORT_FLOW:18,ACTION_IMPORT_POST:19,ACTION_CARD_IMPRESSION:20,ACTION_CARD_ITEM_CLICK:21,ACTION_CARD_MORE_CLICK:22,ACTION_LIST_IMPRESSION:23,ACTION_LIST_ITEM_CLICK:24,ACTION_DETAIL_IMAGE_CLICK:25,ACTION_DETAIL_LINK_CLICK:26,ACTION_IMAGE_LIST_IMPRESSION:27,ACTION_IMAGE_LIST_CLICK:28,ACTION_FULL_IMAGE_IMPRESSION:29,ACTION_FULL_IMAGE_SWIPE:30,ACTION_DETAIL_IMPRESSION:31,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:32,ACTION_PRODUCT_IN_CONVERSATION_CLICK:33,ACTION_SEND_PRODUCT_MESSAGE:34,ACTION_ONBOARD_IMPRESSION:35,ACTION_SHARE_CATALOG_LINK_CLICK:36,ACTION_SHARE_PRODUCT_LINK_CLICK:37,ACTION_CATALOG_IN_CONVERSATION_CLICK:38,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:39,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:40,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:41,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:42,ACTION_SEND_CATALOG_CLICK:43,ACTION_ORDER_MESSAGE_CLICK:44,ACTION_ORDER_LIST_IMPRESSION:45,ACTION_ORDER_LIST_ITEM_CLICK:46,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:47,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:48,ACTION_CART_ADD_PRODUCT:49,ACTION_CART_ICON_CLICK:50,ACTION_CART_SNACKBAR_CLICK:51,ACTION_CART_LIST_IMPRESSION:52,ACTION_CART_EDIT_PRODUCT:53,ACTION_CART_DELETE_PRODUCT:54,ACTION_CART_ABANDON:55,ACTION_SEND_ORDER_MESSAGE:56,ACTION_MENU_CLICK:57,ACTION_PRODUCT_HIDE_CLICKED:58,ACTION_PRODUCT_HIDE_SUCCESS:59,ACTION_PRODUCT_HIDE_CANCELLED:60,ACTION_PRODUCT_HIDE_FAILED:61,ACTION_PRODUCT_UNHIDE_CLICKED:62,ACTION_PRODUCT_UNHIDE_SUCCESS:63,ACTION_PRODUCT_UNHIDE_CANCELLED:64,ACTION_PRODUCT_UNHIDE_FAILED:65,ACTION_CATALOG_LIST_MENU_CLICKED:66,ACTION_CATALOG_LIST_MENU_CLICKED_WITH_ADVERTISE_SHOWN:67,ACTION_COLLECTION_CREATE_CLICKED:68,ACTION_COLLECTION_CREATED:69,ACTION_MENU_COLLECTIONS_CLICK:70,ACTION_COLLECTION_RENAME_CLICKED:71,ACTION_COLLECTION_RENAME_CANCELLED:72,ACTION_COLLECTION_RENAMED:73,ACTION_COLLECTION_DELETE_CLICKED:74,ACTION_COLLECTION_DELETE_CANCELLED:75,ACTION_COLLECTION_DELETED:76,ACTION_COLLECTION_ASSIGN_ITEMS:77,ACTION_COLLECTION_UNASSIGN_ITEMS:78,ACTION_COLLECTION_IMPRESSION:79}),ee=Object.freeze({CATALOG_ENTRY_POINT_PROFILE:1,CATALOG_ENTRY_POINT_SETTINGS:2,CATALOG_ENTRY_POINT_MESSAGE:3,CATALOG_ENTRY_POINT_ATTACHMENT_PANEL:4,CATALOG_ENTRY_POINT_NUX:5,CATALOG_ENTRY_POINT_DEEPLINK:6,CATALOG_ENTRY_POINT_CHAT:7,CATALOG_ENTRY_POINT_ORDER_MESSAGE:8,CATALOG_ENTRY_POINT_INVOICE_ATTACHMENT_PANEL:9,CATALOG_ENTRY_POINT_PRODUCT_LIST_MESSAGE:10,CATALOG_ENTRY_POINT_TOP_BAR:11}),te=Object.freeze({ACTION_CARD_IMPRESSION:1,ACTION_CARD_ITEM_CLICK:2,ACTION_CARD_MORE_CLICK:3,ACTION_LIST_IMPRESSION:4,ACTION_LIST_ITEM_CLICK:5,ACTION_DETAIL_IMAGE_CLICK:6,ACTION_DETAIL_LINK_CLICK:7,ACTION_IMAGE_LIST_IMPRESSION:8,ACTION_IMAGE_LIST_CLICK:9,ACTION_FULL_IMAGE_IMPRESSION:10,ACTION_FULL_IMAGE_SWIPE:11,ACTION_DETAIL_IMPRESSION:12,ACTION_REPORT_PRODUCT:13,ACTION_SEND_PRODUCT_MESSAGE:14,ACTION_REPORT_PRODUCT_SUCCESS:15,ACTION_REPORT_PRODUCT_FAILURE:16,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,ACTION_SHARE_CATALOG_LINK_CLICK:19,ACTION_SHARE_PRODUCT_LINK_CLICK:20,ACTION_CATALOG_IN_CONVERSATION_CLICK:21,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,ACTION_CHAT_CATALOG_ICON_CLICK:26,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:27,ACTION_CART_ADD_PRODUCT:28,ACTION_CART_EDIT_PRODUCT:29,ACTION_CART_DELETE_PRODUCT:30,ACTION_CART_ABANDON:31,ACTION_CART_ICON_CLICK:32,ACTION_CART_SNACKBAR_CLICK:33,ACTION_SEND_ORDER_MESSAGE:34,ACTION_ORDER_LIST_IMPRESSION:35,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:36,ACTION_CART_LIST_IMPRESSION:37,ACTION_ORDER_MESSAGE_CLICK:38,ACTION_ORDER_LIST_ITEM_CLICK:39,ACTION_PLM_CART_CTA_CLICK:40,ACTION_COLLECTION_IMPRESSION:41}),re=Object.freeze({CONTACT:0,NON_CONTACT:1,GROUP:2}),ne=Object.freeze({ATTACHMENT:1,CAMERA:2,PTT:3,PAYMENT:4,GIMMICK:5,PHONE:6,VIDEO:7,MESSAGE:8,CALL:9}),ie=Object.freeze({CLICK:1}),ae=Object.freeze({OPEN:1,SELECT_FILTER:2,SEARCH_WITH_FILTER:3,SEARCH:4,SEARCH_ITEM_SELECTED:5,SEARCH_MSG_SENT:6}),oe=Object.freeze({CHAT_LIST:0}),se=Object.freeze({NONE:0,OTHER_LABELS:1,UNREAD:2,GROUP:3,BROADCAST_LIST:4,NEW_CUSTOMER:5,NEW_ORDER:6,PENDING_PAYMENT:7,PAID:8,ORDER_COMPLETE:9,CONTACT:10,NON_CONTACT:11}),le=Object.freeze({TOS3:1,COUNTRY:2}),ce=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3}),de=Object.freeze({CONTACT:0,CHAT:1,GROUP:2,BROADCAST_LIST:3,MESSAGE:4}),ue=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3}),pe=Object.freeze({OUTSIDE_DIALOG_BOX:0,OK:1,LEARN_MORE:2}),fe=Object.freeze({SMALL:1,MEDIUM:2,LARGE:3,EXTRA_LARGE:4,XX_LARGE:5,XXX_LARGE:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),_e=Object.freeze({CLIENT_RENDERED:1,CLIENT_SAVED:2,CLIENT_WRITTEN_WIRE:3,CLIENT_QUEUED:4,CLIENT_WAITING_TO_ENCRYPT:5,CLIENT_READY_TO_SEND:6,CLIENT_ENCRYPT:7,CLIENT_PREKEYS_FETCH:8}),he=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5}),ge=Object.freeze({COMMERCE_ACTION_CARD_IMPRESSION:1,COMMERCE_ACTION_CARD_ITEM_CLICK:2,COMMERCE_ACTION_CARD_MORE_CLICK:3,COMMERCE_ACTION_LIST_IMPRESSION:4,COMMERCE_ACTION_LIST_ITEM_CLICK:5,COMMERCE_ACTION_DETAIL_IMAGE_CLICK:6,COMMERCE_ACTION_DETAIL_LINK_CLICK:7,COMMERCE_ACTION_IMAGE_LIST_IMPRESSION:8,COMMERCE_ACTION_IMAGE_LIST_CLICK:9,COMMERCE_ACTION_FULL_IMAGE_IMPRESSION:10,COMMERCE_ACTION_FULL_IMAGE_SWIPE:11,COMMERCE_ACTION_DETAIL_IMPRESSION:12,COMMERCE_ACTION_REPORT_PRODUCT:13,COMMERCE_ACTION_SEND_PRODUCT_MESSAGE:14,COMMERCE_ACTION_REPORT_PRODUCT_SUCCESS:15,COMMERCE_ACTION_REPORT_PRODUCT_FAILURE:16,COMMERCE_ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,COMMERCE_ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,COMMERCE_ACTION_SHARE_CATALOG_LINK_CLICK:19,COMMERCE_ACTION_SHARE_PRODUCT_LINK_CLICK:20,COMMERCE_ACTION_CATALOG_IN_CONVERSATION_CLICK:21,COMMERCE_ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,COMMERCE_ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,COMMERCE_ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,COMMERCE_ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,COMMERCE_ACTION_CHAT_CATALOG_ICON_CLICK:26,COMMERCE_ACTION_CLICK_ON_MESSAGE_BUSINESS_BUTTON:27}),me=Object.freeze({COMMERCE_ENTRY_POINT_PROFILE:1,COMMERCE_ENTRY_POINT_SETTINGS:2,COMMERCE_ENTRY_POINT_MESSAGE:3,COMMERCE_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_ENTRY_POINT_NUX:5,COMMERCE_ENTRY_POINT_DEEPLINK:6,COMMERCE_ENTRY_POINT_CHAT:7,COMMERCE_ENTRY_POINT_ORDER_MESSAGE:8}),ye=Object.freeze({COMMERCE_PERF_ENTRY_POINT_PROFILE:1,COMMERCE_PERF_ENTRY_POINT_SETTINGS:2,COMMERCE_PERF_ENTRY_POINT_PRODUCT_MESSAGE:3,COMMERCE_PERF_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_PERF_ENTRY_POINT_CATALOG_PDP:5,COMMERCE_PERF_ENTRY_POINT_DEEPLINK:6,COMMERCE_PERF_ENTRY_POINT_CATALOG_HOME:7,COMMERCE_PERF_ENTRY_POINT_SHOPS_PDP:8,COMMERCE_PERF_ENTRY_POINT_PRODUCT_LIST_MESSAGE:9}),Ee=Object.freeze({COMMERCE_PERF_MARKER_START:1,COMMERCE_PERF_MARKER_CACHE_CONTENT:2,COMMERCE_PERF_MARKER_NETWORK_CONTENT:3,COMMERCE_PERF_MARKER_INTERACT:4}),Se=Object.freeze({COMMERCE_PERF_CATALOG_PDP:1,COMMERCE_PERF_CATALOG_HOME:2,COMMERCE_PERF_PROFILE_CATALOG:3,COMMERCE_PERF_SHOPS_PDP:4}),ve=Object.freeze({PERSON:1,PUSH:2,OTHER:3,BACKOFF:4}),Te=Object.freeze({HOSTNAME:0,IP4:1,IP6:2}),Ce=Object.freeze({CHATD:1,MMS:2}),Ae=Object.freeze({PROBLEM_DESCRIPTION:1,SUGGESTED_FAQ:2,EMAIL_SEND:3,IN_APP_FAQ:4,CANCELLED:5,FAQ:6}),be=Object.freeze({MSG_SENT:1}),Pe=Object.freeze({DEEP_LINK_EXTERNAL:1,DEEP_LINK_WA_LINK_CLICK:2,QR_CODE_SHEET:3}),Me=Object.freeze({DEEP_LINK_UNKNOWN:1,DEEP_LINK_CHAT:2,DEEP_LINK_CONTACT_QR_CODE:3,DEEP_LINK_PAYMENT:4,DEEP_LINK_PRODUCT:5,DEEP_LINK_CATALOG:6,DEEP_LINK_FUTURE_PROOF:7,DEEP_LINK_GROUP_INVITE:8,DEEP_LINK_MSG_FORWARD:9,DEEP_LINK_MESSAGE_QR_CODE:10,DEEP_LINK_OPT_IN_QR_CODE:11,DEEP_LINK_CTWA:12,DEEP_LINK_STICKERPACK:13,DEEP_LINK_NOVI_HUB:14,DEEP_LINK_NOVI_ADD_DEBIT_CARD:15,DEEP_LINK_NOVI_ADD_BANK_ACCOUNT:16,DEEP_LINK_NOVI_WITHDRAW:17,DEEP_LINK_NOVI_RESET_PASSWORD:18,DEEP_LINK_PAYMENT_SIGNUP:19,DEEP_LINK_BIZTOOLS_ACCOUNTS:20,DEEP_LINK_PAYMENT_VIRALITY:21,DEEP_LINK_SETTINGS_ACCOUNT_DELETE:22,DEEP_LINK_SETTINGS_ACCOUNT_REQUEST_INFO:23,DEEP_LINK_SETTINGS_CHATS_HISTORY:24,DEEP_LINK_DISAPPEARING_MODE:25,DEEP_LINK_ARCHIVE_SETTINGS:26,DEEP_LINK_TOS:27,DEEP_LINK_NOVI_CARE:28,DEEP_LINK_NOVI_TPP_ACCOUNT_LINKING:29,DEEP_LINK_CONTACT_SUPPORT:30,DEEP_LINK_BIZTOOLS_DIRECTORY:31,DEEP_LINK_DIRECTORY:32,DEEP_LINK_CALL:33,DEEP_LINK_DIRECTORY_DEEPER_CATEGORY_SELECTION:34}),Oe=Object.freeze({APP_SWITCH:1,BROWSER:2,CANCELLED:3}),Ie=Object.freeze({PRIMARY:1,COMPANION:2}),we=Object.freeze({CHAT:1,INITIATED_BY_ME:2,INITIATED_BY_OTHER:3}),Re=Object.freeze({ACCOUNT_SETTINGS:1,SYSTEM_MESSAGE:2,INDIVIDUAL_CHAT_DISAPPEARING_MESSAGES_SETTING:3,GROUP_CHAT_DISAPPEARING_MESSAGES_SETTING:4,DEEP_LINK:5}),De=Object.freeze({CHAT_PERSONAL:1,CHAT_GROUP:2,STATUS_USER:3,STATUS_ADS:4,PRODUCT_CATALOG:5,GDPR:6,STICKER_PICKER:7,PROFILE_PICTURE:8,BLOKS:9,P2B:10,MESSAGE_HISTORY_SYNC:11}),Ne=Object.freeze({NORMAL_QUALITY:1,MID_QUALITY:2,INELIGIBLE_IMAGE_TOO_SMALL:3,INELIGIBLE_PARTIAL_HASHES_NOT_FOUND:4,ERROR_DETERMINING_ELIGIBILITY:5,NOT_DOWNLOADED_ENOUGH_BYTES_TO_DETERMINE_ELIGIBILITY:6}),Le=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3}),ke=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2}),Ge=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3}),Ue=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65}),Fe=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4}),xe=Object.freeze({B1:1,B4:2,B8:3,B16:4,B32:5,B64:6,B128:7,B256:8,B512:9,B1000:10,B1500:11,B2000:12,B2500:13,B3000:14,B3500:15,B4000:16,B4500:17,B5000:18,NULL:19}),Be=Object.freeze({ACTION_OPEN:1,ACTION_SAVE:2,ACTION_DISCARD:3,ACTION_PROFILE_FIELD_OPEN:4,ACTION_PROFILE_FIELD_SAVE:5,ACTION_PROFILE_FIELD_DISCARD:6,ACTION_FACEBOOK_ENABLED:7,ACTION_FACEBOOK_DISABLED:8,ACTION_INSTAGRAM_ENABLED:9,ACTION_INSTAGRAM_DISABLED:10,ACTION_FB_IG_POP_SHOWN:11,ACTION_EDIT_COVER_PHOTO_CLICK:12,ACTION_REMOVE_COVER_PHOTO:13}),Ke=Object.freeze({CALL_TOO_SHORT:1}),je=Object.freeze({CHAT_INFO:1,SYSTEM_MESSAGE:2,CHAT_OVERFLOW:3}),Ye=Object.freeze({ROOM_OPEN_FAILURE:1,UNKNOWN_ERROR:2}),We=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6}),He=Object.freeze({BOTH:1,SELF:2,PEER:3}),Ve=Object.freeze({SHOW:1,LOGOUT:2,UPGRADE:3}),$e=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2}),ze=Object.freeze({GIPHY:0,TENOR:1}),qe=Object.freeze({GET_CATALOG:1,GET_PRODUCT:2,GET_PRODUCT_LIST:3,GET_COLLECTIONS:4,GET_SINGLE_COLLECTION:5}),Je=Object.freeze({SUCCESS:1,FAILURE:2}),Qe=Object.freeze({INCOMING_CALL_SCREEN_ANSWER:1,INCOMING_CALL_SCREEN_REJECT:2,INCOMING_CALL_NOTIFICATION_ANSWER:3,INCOMING_CALL_NOTIFICATION_REJECT:4,PENDING_CALL_SCREEN_END_AND_ANSWER:5,PENDING_CALL_SCREEN_HOLD_AND_ANSWER:6,PENDING_CALL_SCREEN_REJECT:7,INCOMING_CALL_REMOTE_ANSWER:8,INCOMING_CALL_REMOTE_REJECT:9,PENDING_CALL_NOTIFICATION_END_AND_ANSWER:10,PENDING_CALL_NOTIFICATION_REJECT:11}),Xe=Object.freeze({DEFAULT:0,PROBING_ROTT_TO_RELAY:1,PROBING_E2E_PEER_RX:2,PROBING_E2E_RX:3,HIS_RECENT_PEER_RX:4,HIS_RECENT_RX:5,HIS_RECENT_PROBING_ROTT_TO_RELAY:6,HIS_RECENT_PROBING_E2E_PEER_RX:7,HIS_RECENT_PROBING_E2E_RX:8,ONE_SIDE_INITIAL_BANDWIDTH_ESTIMATION:9}),Ze=Object.freeze({USER_START:0,USER_CANCEL:1,FLOW_SUCCESS:2,FLOW_ERROR:3,USER_VIEW:4,USER_PAY_NOW:5,USER_VIEW_BASKET:6,USER_VIEW_PAYMENT_DETAILS:7,USER_MESSAGE_BUSINESS:8}),et=Object.freeze({ADD:1,EDIT:2,DELETE:3,VIEW:4,CLICK_POSITIVE:5,CLICK_NEGATIVE:6,UPDATE_LABEL_COUNT:7}),tt=Object.freeze({LABEL:1,MESSAGE:2,CONTACT:3,LABELS_SCREEN:4,LABEL_DETAILS_SCREEN:5,EDIT_LABEL_DIALOG:6,DELETE_LABEL_DIALOG:7,LABEL_MESSAGE_DIALOG:8,LABEL_CHAT_DIALOG:9,ADD_LABEL_DIALOG:10,BULK_UNLABEL_DIALOG:11,LABEL_COMBINED_DIALOG:12,GROUP:13,BROADCAST:14}),rt=Object.freeze({OK:1,ERROR_UNKNOWN:2,SERVER_ERROR:3,SERVER_GOAWAY:4,NETWORK_ERROR:5,ANDROID_KEYSTORE_ERROR:6}),nt=Object.freeze({APP_STATE_SYNC_KEY_EXPIRY:1,DEVICE_DEREGISTERATION:2,NO_KEYS:3}),it=Object.freeze({INITIAL:1,RECENT_HISTORY:2,FULL_HISTORY:3,PUSHNAME:4,STATUS_V3:5}),at=Object.freeze({CRITICAL:1,NON_CRITICAL:2}),ot=Object.freeze({APP_STATE:1,HISTORY:2}),st=Object.freeze({SUCCESS:1,FAILURE:2}),lt=Object.freeze({PIN_MUTATION:1,UNPIN_4TH_CHAT_MUTATION:2,DELETE_MUTATION:3,CLEAR_CHAT_REMOVE_STARRED_MUTATION:4,CLEAR_CHAT_KEEP_STARRED_MUTATION:5}),ct=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5}),dt=Object.freeze({INITIAL_SYNC:1,RESUME_SYNC:2,REGULAR_SYNC:3}),ut=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13}),pt=Object.freeze({TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:1,SERVER_DATA_MISMATCH:2,PROTOBUF_DESERIALIZATION_FAILED:3,EXTERNAL_PATCH_EXPIRED:4,MISSING_OR_EMPTY_INDEX:5,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:6,DECRYPTION_FAILED:7,MISSING_PATCH_VERSION:8,DUPLICATE_PATCH_VERSION_IN_COLLECTION:9,ENCRYPTION_FAILED:10,MISSING_MUTATION_VERSION:11,MISSING_MUTATION_VALUE:12,INVALID_MUTATION_INDEX:13,PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:14,MISSING_MUTATION_OPERATION:15,MISSING_MUTATION_RECORD:16,MISSING_MUTATION_KEY_ID:17,PATCH_PROTOBUF_DESERIALIZATION_FAILED:18,ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:19,MISSING_MUTATION_INDEX:20,MISSING_ACTION_INDEX:21,INVALID_ACTION_INDEX:22,MISSING_ACTION_VALUE:23,MISSING_ACTION_VERSION:24,MISSING_ACTION_TIMESTAMP:25,MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:26,MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:27,PATCH_PROTOBUF_SERIALIZATION_FAILED:28,ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:29,MISSING_KEY_ON_ALL_CLIENTS:30,TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:31,MAC_MISMATCH_SNAPSHOT:33,MAC_MISMATCH_PATCH:34,DB_STORE_NOT_READY:35,TERMINAL_PATCH_MISSING_DATA:36,TERMINAL_PATCH_DESERIALIZATION_ERROR:37,TERMINAL_PATCH_UNKNOWN:38,CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:39,MISSING_SNAPSHOT_VERSION:45,MISSING_SNAPSHOT_MAC:46,MISSING_PATCH_SNAPSHOT_MAC:47,MISSING_PATCH_MAC:48,MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:49,MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:50,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:51,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:52,INVALID_KEY_SHARE_KEY_ID:53,MISSING_PATCH_KEY_ID:56,INVALID_KEY_SHARE_KEY_DATA:57,SNAPSHOT_EXPIRED:58,MISSING_SNAPSHOT_KEY_ID:59,SNAPSHOT_MAC_MISMATCH_IN_PATCH:60,SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:61,XMPP_BAD_REQUEST_FOR_COLLECTION:62,XMPP_NOT_FOUND_FOR_COLLECTION:63,XMPP_BAD_REQUEST_GLOBAL_ERROR:64,XMPP_NOT_FOUND_GLOBAL_ERROR:65,XMPP_BAD_METHOD_GLOBAL_ERROR:66,XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:67,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:68,EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:69,SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:70,REQUESTING_MISSING_KEY_WITH_NO_CLIENTS:71,DB_STORE_NOT_READY_LOW_DISK_SPACE:72,SERVER_DID_NOT_SEND_ALL_PATCHES:73,SERVER_SENT_EARLIER_PATCH:74,MISSING_KEY_FOR_MUTATION_IN_LOCAL_SNAPSHOT:75,MISSING_ACTIVE_KEY_AFTER_ROTATION:76,MISSING_ACTIVE_KEY_FOR_ENCRYPTION:77,MISSING_CURRENT_EPOCH_FOR_ACTIVE_KEY_VALIDATION:78,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_OUTGOING_PATCH:79,INVALID_SNAPSHOT_RECORDS:80,MISSING_EXTERNAL_BLOB_REFERENCE_HANDLE:81,INVALID_EXTERNAL_BLOB_REFERENCE_UPLOADED:82,INVALID_PATCH_KEY_ID_SIZE:83,INVALID_PATCH_MAC_SIZE:84,INVALID_PATCH_SNAPSHOT_MAC_SIZE:85,INVALID_COLLECTION_SNAPSHOT_HASH_SIZE:86,MISSING_COLLECTION_SNAPSHOT_HASH:87,INVALID_PATCH_KEY_ID_DEVICE_ID:88,INVALID_PATCH_KEY_ID_EPOCH:89,DECRYPTION_FAILED_KEY_ID_MISMATCH:90,DECRYPTION_FAILED_VALUE_MAC_MISMATCH:91,DECRYPTION_FAILED_INDEX_MAC_MISMATCH:92,EXTERNAL_PATCH_MISSING_BLOB:93,COLLECTION_PULL_REQUEST_RECEIVED_PUSH_RESPONSE_WITH_UPDATED_VERSION:94,COLLECTION_PUSH_REQUEST_RECEIVED_RESPONSE_WITH_VERSION_MISMATCH:95}),ft=Object.freeze({SYNCD:1,WEB:2}),_t=Object.freeze({BROWSER:1,DESKTOP:2}),ht=Object.freeze({MANUAL:1,FULL:2,PREFETCH:3,HEADER:4,THUMBNAIL:5}),gt=Object.freeze({OK:1,ERROR_UNKNOWN:2,ERROR_TIMEOUT:3,ERROR_DNS:4,ERROR_INSUFFICIENT_SPACE:5,ERROR_TOO_OLD:6,ERROR_CANNOT_RESUME:7,ERROR_HASH_MISMATCH:8,ERROR_INVALID_URL:9,ERROR_OUTPUT_STREAM:10,ERROR_CANCEL:11,DEDUPED:12,ERROR_ENC_HASH_MISMATCH:14,PREFETCH_END:15,ERROR_CANCEL_PROGRAMMATIC:16,ERROR_MEDIA_CONN:17,ERROR_THROTTLE:18,ERROR_SSL:19,ERROR_NETWORK:20,ERROR_CONNECT:21}),mt=Object.freeze({CHAT_PHOTO_LIBRARY:1,CAMERA_TAB_CAPTURE:2,FORWARD:3,PASTE:4,SHARE_EXTENSION:5,EXPORT:6,MENU_CAMERA_CAPTURE:7,EXTERNAL_CAMERA:8,LINK_PREVIEW_DOWNLOAD:9,CAMERA_TAB_MEDIA_STRIP:10,CAMERA_TAB_PHOTO_LIBRARY:11,CHAT_BUTTON_CAMERA_CAPTURE:12,CHAT_BUTTON_CAMERA_MEDIA_STRIP:13,CHAT_BUTTON_CAMERA_PHOTO_LIBRARY:14,STATUS_TAB_CAMERA_CAPTURE:15,STATUS_TAB_CAMERA_MEDIA_STRIP:16,STATUS_TAB_CAMERA_PHOTO_LIBRARY:17,STATUS_REPLY_CAMERA_CAPTURE:18,STATUS_REPLY_CAMERA_MEDIA_STRIP:19,STATUS_REPLY_CAMERA_PHOTO_LIBRARY:20,MENU_CAMERA_PHOTO_LIBRARY:21,CHAT_GIF_INAPP:22,CHAT_GIF_EXTERNAL:23,STATUS_REPLY_GIF_INAPP:24,STATUS_REPLY_GIF_EXTERNAL:25,SMB_QUICK_REPLY_EDIT:26,SMB_QUICK_REPLY_SEND:27,MEDIA_BROWSER:28,CHAT_QUICK_EDIT:29,CAMERA_TAB_GIF:30,STATUS_TAB_GIF:31,PAYMENT_COMPOSER:32}),yt=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35}),Et=Object.freeze({REGULAR:1,FAST_FORWARD_EXIST_CHECK:2,VIDEO_EXIST_CHECK:3,PRODUCT:4,MEDIA_RETRY:5,WEB_REUPLOAD:6,THUMBNAIL:7}),St=Object.freeze({OK:1,DUPLICATE:3,ERROR_UNKNOWN:2,ERROR_REQUEST:4,ERROR_UPLOAD:5,ERROR_OOM:6,ERROR_IO:7,ERROR_NO_PERMISSIONS:8,ERROR_BAD_MEDIA:9,ERROR_INSUFFICIENT_SPACE:10,ERROR_FNF:11,ERROR_CANCEL:12,ERROR_SERVER:13,ERROR_REQUEST_TIMEOUT:14,ERROR_NOT_FINALIZED:15,ERROR_OPTIMISTIC_HASH:16,ERROR_MEDIA_CONN:17,ERROR_DNS:18,ERROR_THROTTLE:19,ERROR_SSL:20,ERROR_NO_CLIENT_NETWORK:21}),vt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),Tt=Object.freeze({OK:1,ERROR_UNKNOWN:3,ERROR_NETWORK:4,ERROR_EXPIRED:5,ERROR_CANCELLED:6,ERROR_UPLOAD:7,ERROR_BACKFILL_USYNC_FAILED:8}),Ct=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4}),At=Object.freeze({PREKEY_MESSAGE:1,CALL_PAYLOAD:2,RETRY_RECEIPT:3,PREKEY_RESPONSE:4,IDENTITY_RESPONSE:5,USYNC_RESPONSE:6}),bt=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8}),Pt=Object.freeze({NATIVE:0,OK_HTTP:1,LIGER:2,APACHE:3,WATLS:4}),Mt=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3}),Ot=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),It=Object.freeze({NONE:0,OPTIMISTIC:1,OPT_USED:2,OPT_TAKEOVER:3,OPT_DISABLED:4}),wt=Object.freeze({OTHER:0,CHAT:1,NOTIFICATION:2}),Rt=Object.freeze({RESUME_CHECK:1,UPLOAD:2,FINALIZE:3}),Dt=Object.freeze({NONE_NEW_CONTENT:1,NONE_EXPIRED:2,REUSED:3}),Nt=Object.freeze({CONSUMER:1,SMB:2,ENT:3}),Lt=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),kt=Object.freeze({PHONE_NUM_HYPERLINK_MSG_RECEIVED:1,LONG_PRESS_PHONE_NUM_HYPERLINK:2,CLICK_PHONE_NUM_HYPERLINK:3,CLICK_CALL:4,CLICK_ADD_TO_CONTACTS:5,CLICK_MESSAGE_ON_WHATSAPP:6,CLICK_COPY_PHONE_NUMBER:7,CLOSE_DIALOG_BOX:8,MESSAGE_SENT:9}),Gt=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3}),Ut=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),Ft=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3}),xt=Object.freeze({IPHONE:1,ANDROID:2,BB:3,BBX:7,S40:4,SYMBIAN:5,WP:6,WEBCLIENT:8,OSMETA:11,ENT:12,SMBA:13,KAIOS:14,SMBI:15,WINDOWS:16,WEB:17,PORTAL:18,BLOKS:19,BLUEA:20,BLUEI:21,FBLITEA:22,GREENA:23,GREENI:24,IGDA:25,IGDI:26,IGLITEA:27,MLITEA:28,MSGRA:29,MSGRI:30,MSGRP:31,MSGRW:32,IGDW:33,PAGE:34,MSGRDM:35,MSGRDW:36,MSGROM:37,MSGROC:38,MSGRM:43,IGDM:44,WEARM:45,CAPI:46,XR:47,MACOS:48,TEST:9,UNKNOWN:10}),Bt=Object.freeze({LT4:1,LT8:2,LT16:3,LT32:4,LT64:5,LT128:6,LT256:7,LT512:8,LT1000:9,LT1500:10,LT2000:11,LT2500:12,LT3000:13,LT3500:14,LT4000:15,LT4500:16,LT5000:17,LARGEST_BUCKET:18}),Kt=Object.freeze({SEND_MESSAGE:1,GET_VNAME_CERTIFICATE:2,SEND_LIVE_LOCATION_RETRY:3,SEND_LIVE_LOCATION_KEY:4,SEND_PEER_MESSAGE:5,MULTI_DEVICE_CALL:6,CALL_PEER_E2E_FAIL:7,IDENTITY_CHANGE_NOTIFICATION:8,BACK_OFF:9,USER_INTENT_PREFETCH:10,RESEND_MESSAGE:11,RETRY_MESSAGE:12}),jt=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_SIGNED_KEY_INDEX_LIST:2}),Yt=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14}),Wt=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5}),Ht=Object.freeze({CONTACT_CARD:1,CHAT_HEADER:2,CHAT_MENU:3,GROUP_MEMBERSHIP_SCREEN:4,STATUS:5,CALLS:6,BROADCAST_LIST:7,PRODUCT:8,CATALOG:9,SETTINGS:10,SPAM_BLOCK:11,CHATS_HOME:12,SHOPS:13,MENTION:14,EPHEMERAL_SETTINGS_MESSAGE:15,MAP:16,SEARCH:17,PAYMENT_TRANSACTION_DETAILS:18}),Vt=Object.freeze({DIT:1,DIRECTORY_SEARCH:2}),$t=Object.freeze({SUCCESS:1,ERROR_PARSING:2,ERROR_DECODING:3,ERROR_CREDENTIAL:4,ERROR_OTHER:5,ERROR_CLIENT_NETWORK:6,ERROR_WAIT_FOR_TOKEN:7,ERROR_SERVER_OTHER:8,SKIPPED_NO_NETWORK:9,SKIPPED_NO_DATA:10,ERROR_ACCESS_TOKEN:11}),zt=Object.freeze({CREATED:1,ROTATED:2,DELETED:3}),qt=Object.freeze({TEST_VALUE1:1,TEST_VALUE2:2}),Jt=Object.freeze({NO_REASON:0,REASON_UNKNOWN:1,REASON_WAIT_FOR_FIRST_TOKEN:2,REASON_INVALID_SHARED_KEY:3,REASON_INVALID_FACTOR:4,REASON_GEN_FACTOR_FAILURE:5,REASON_COMPUTE_HMAC_FAILURE:6,REASON_BLIND_FAILURE:7,REASON_UNBLIND_FAILURE:8,REASON_LAST_SIGNREQ_NETWORK_FAILURE:9,REASON_LAST_SIGNREQ_SERVER_ERROR:10,REASON_LAST_SIGNREQ_BAD_REQUEST:11,REASON_LAST_SIGNREQ_OTHER_ERROR:12,REASON_WAIT_FOR_GEN_TOKEN:13,REASON_GEN_SHAREDKEY_FAILURE:14,REASON_WAIT_FOR_GEN_FIRST_TOKEN:15}),Qt=Object.freeze({REASON_PS_PINGER:0,REASON_PS_OFFCYCLE:1}),Xt=Object.freeze({SUCCESS:1,CANCEL:2,ERROR:3}),Zt=Object.freeze({SPEED_1:0,SPEED_1_5:1,SPEED_2:2}),er=Object.freeze({AUDIO_QUEUE:0,AVPLAYER:1,AVAUDIOPLAYER:2,OPUSPLAYER:3,ANDROIDPLAYER:4,EXOPLAYER:5}),tr=Object.freeze({SENT:1,CANCELLED:2,TOO_SHORT:3}),rr=Object.freeze({FROM_CONVERSATION:0,FROM_VOICEMAIL:1}),nr=Object.freeze({UNKNOWN:0,AAC:1,MP3:2,AMR_NB:3,AMR_WB:4,OPUS:5,MULTIPLE_TRACKS:6}),ir=Object.freeze({MANUAL:0,SEQUENTIAL:1}),ar=Object.freeze({STICKER_STORE_DATA:0,PREVIEW_IMAGE_DOWNLOAD:1,STICKER_PACK_DATA:2,STICKER_SEARCH:3}),or=Object.freeze({ACTION_SETTINGS_IMPRESSION:1,ACTION_SETTINGS_ADD_CLICK:2,ACTION_SETTINGS_ADD_ABANDONED:3,ACTION_SETTINGS_ADDED:4,ACTION_SETTINGS_DELETED:5,ACTION_CHAT_IMPRESSION:6,ACTION_CHAT_CLICK:7,ACTION_SETTINGS_EDITED:8,ACTION_CHAT_INVALID_ATTACHMENTS:9,ACTION_SETTINGS_INVALID_ATTACHMENTS:10,ACTION_SETTINGS_MEDIA_TRANSCODE:11,ACTION_CHAT_CLICK_CANCEL:12,ACTION_SMART_DEFAULT_CLICK:13,QUICK_REPLY_MESSAGE_SENT:14}),sr=Object.freeze({QUICK_REPLY_ENTRY_POINT_KEYBOARD:1,QUICK_REPLY_ENTRY_POINT_ATTACHMENT_PANEL:2,QUICK_REPLY_ENTRY_POINT_SETTINGS_MENU:3,QUICK_REPLY_ENTRY_POINT_BANNERS:4,QUICK_REPLY_ENTRY_POINT_NUX:5}),lr=Object.freeze({UNKNOWN:0,CONVERSATIONS:1,BUTTON:2,KEYBOARD:3}),cr=Object.freeze({QUICK_REPLY_TRANSCODE_RESULT_OK:1,QUICK_REPLY_TRANSCODE_RESULT_CANCELLED:2,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_UNKNOWN:3,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_ENCODING:4,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_FILE_COPY:5,QUICK_REPLY_TRANSCODE_RESULT_FAIL_VIDEO_UNKNOWN:6}),dr=Object.freeze({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112}),ur=Object.freeze({OPEN_TRAY:1,DELETE:2,UPDATE:3}),pr=Object.freeze({CALLS_TAB:1,GROUP_CALL_UI:2,ATTACHMENT:3,WEB_MENU:4}),fr=Object.freeze({E2EE:0,BSP:1,FB:2}),_r=Object.freeze({ACTION_CLICK_SHOPS_SETTING:1,ACTION_CLICK_CATALOG_SETTING:2,ACTION_CLICK_COMMERCE_MANAGER_IN_CATALOG_SETTING:3,ACTION_CLICK_CANCEL_IN_CATALOG_SETTING:4,ACTION_CLICK_VIEW_SHOPS_IN_SHOPS_SETTING:5,ACTION_CLICK_COMMERCE_MANAGER_IN_SHOPS_SETTING:6,ACTION_CLICK_CANCEL_IN_SHOPS_SETTING:7,ACTION_SHOPS_PRODUCT_PREVIEW_VISIBLE:8,ACTION_CLICK_SHOPS_PRODUCT_PREVIEW_TILE:9,ACTION_CLICK_MANAGE_SHOPS:10,ACTION_SHARE_SHOPS:11,ACTION_CLICK_VIEW_SHOPS_FROM_EDIT_BIZ_PROFILE:12,ACTION_CLICK_COMMERCE_MANAGER_FROM_EDIT_BIZ_PROFILE:13,ACTION_CLICK_CANCEL_FROM_EDIT_BIZ_PROFILE:14}),hr=Object.freeze({SUCCESS:1,ERROR_BAD_REQUEST:2,ERROR_SERVER:3,ERROR_OTHER:4,ERROR_CLIENT_NETWORK:5}),gr=Object.freeze({ACCOUNT_SIGNATURE:1,DEVICE_SIGNATURE:2}),mr=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),yr=Object.freeze({STATIC:0,SHARED:1}),Er=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),Sr=Object.freeze({UNKNOWN:1,TEXT:2,IMAGE:3,VOICE:4,DOCUMENT:5,AUDIO:6,STICKER:7,LOCATION:8,PRODUCT:9,CONTACT:10,CONTACT_ARRAY:11,CAMERA_CAPTURE_IMAGE:12,MEDIA_GALLERY:13,GIF_VIDEO:14}),vr=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),Tr=Object.freeze({RECENT_STORIES:1,PREVIOUS_STORIES:2,MUTED_STORIES:3,MY_STATUS:4}),Cr=Object.freeze({REGULAR:1,PAYMENTS:2}),Ar=Object.freeze({STICKER_SEARCH:1,FORWARD:2,STICKER_PICKER_TAB_RECENTS:3,STICKER_PICKER_TAB_FAVORITES:4,STICKER_PICKER_TAB_EMOTION:5,STICKER_PICKER_TAB_PACK:6,STICKER_PICKER_TAB_CONTEXTUAL_SUGGESTIONS:7,STICKER_MAKER:8,STICKER_STORE:9}),br=Object.freeze({HSM:0,BUTTON:1,LIST:2,PRODUCT_LIST:3,BUTTON_NFM:4,PRODUCT_ITEM:5,SHOP_STOREFRONT:6}),Pr=Object.freeze({NONE:1,SPEEX:2,WEBRTC:3,MWEBRTC:4,ECHOSUPPRESSOR:5}),Mr=Object.freeze({TITLE:1,CONTENT:2,FOOTER:3,BUTTON:4}),Or=Object.freeze({B0:1,B1:2,B2:3,B11:4,B51:5,B101:6,B501:7,B1K:8,B10K:9,B100K:10,B1M:11}),Ir=Object.freeze({UPLOAD_SUCCESS:1,EMPTY_LOG_DIR:2,GZIP_FAILURE:3,UPLOAD_FAILURE:4,LOG_SIZE_EXCEEDED:5}),wr=Object.freeze({OTHER:1,APP_OPEN:2,CHAT_OPEN:3,IMAGE_OPEN:4,FIRST_FTS_RESULT:5,CONTACTS_OPEN:6,GROUP_INFO_OPEN:7,MSG_INFO_OPEN:8}),Rr=Object.freeze({UNKNOWN:1,CHAT_PERSONAL:2,CHAT_GROUP:3,STATUS_USER:4,PRODUCT_CATALOG:5,STICKER_WEB:6,PAYMENTS_KYC:7,MESSAGE_HISTORY_SYNC:8}),Dr=Object.freeze({OTHER:1,CAMERA:2,GALLERY:3,SHARE:4}),Nr=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TOO_MANY_PORTS:101,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_PINHOLE_SPACE_EXHAUSTED:701,ERR_CODE_FIREWALL_DISABLED:702,ERR_CODE_INBOUND_PINHOLE_NOT_ALLOWED:703,ERR_CODE_NO_SUCH_ENTRY:704,ERR_CODE_PROTOCOL_NOT_SUPPORTED:705,ERR_CODE_INTERNAL_PORT_WILDCARD_NOT_ALLOWED:706,ERR_CODE_PROTOCOL_WILDCARD_NOT_ALLOWED:707,ERR_CODE_WILDCARD_NOT_PERMITTED_IN_SRC_IP:708,ERR_CODE_NO_PACKET_SENT:709,ERR_CODE_SPECIFIED_ARRAY_INDEX_INVALID:713,ERR_CODE_NO_SUCH_ENTRY_IN_ARRAY:714,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_CONFLICT_IN_MAPPING_ENTRY:718,ERR_CODE_SAME_PORT_VALUES_REQUIRED:724,ERR_CODE_ONLY_PERMANENT_LEASES_SUPPORTED:725,ERR_CODE_REMOTE_HOST_ONLY_SUPPORTS_WILDCARD:726,ERR_CODE_EXTERNAL_PORT_ONLY_SUPORTS_WILDCARD:727,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Lr=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),kr=Object.freeze({INVALID_STANZA:1,JSON_FETCH:2,JSON_PARSE:3,IMAGE_FETCH:4}),Gr=Object.freeze({BANNER_APPEAR:1,BANNER_SELECT:2,MODAL_APPEAR:3,MODAL_DISMISS:4,MODAL_LINK_FOLLOW:5,MODAL_ACCEPT:6,BLOCKING_MODAL_APPEAR:7,BLOCKING_MODAL_LINK_FOLLOW:8,BLOCKING_MODAL_ACCEPT:9,BANNER_DISMISS:10,EDUCATION_1_APPEAR:11,EDUCATION_1_DISMISS:12,EDUCATION_1_CONTINUE:13,MODAL_BACK:14,BLOCKING_MODAL_BACK:15}),Ur=Object.freeze({ACTION_IMPRESSION:1,ACTION_CLICK_WEBSITE:2,ACTION_CLICK_LOCATION:3,ACTION_CLICK_HOURS:4,ACTION_CLICK_DESCRIPTION:5,ACTION_CLICK_EMAIL:6,ACTION_CLICK_ADDTOCONTACT:7,ACTION_CLICK_MORE_BIZ_PROFILE:8,ACTION_CLICK_MESSAGE:9,ACTION_CLICK_VOICE_CALL:10,ACTION_CLICK_VIDEO_CALL:11,ACTION_CLICK_FORWARD:12,ACTION_CLICK_CATALOG_ICON:13,ACTION_CLICK_SHOPS_ICON:14,ACTION_CLICK_APP_LINK:15,ACTION_APP_IMPRESSION:16,ACTION_CLICK_STATUS:17,ACTION_EXIT:18,ACTION_COVER_PHOTO_IMPRESSION:19}),Fr=Object.freeze({SERIAL_MISMATCH_CERT_IN_MESSAGE_INVALID:0,NEW_SERIAL_CERT_IN_MESSAGE_INVALID:1,GET_VNAME_CERT_INVALID:2,VNAME_CERT_UPDATE_INVALID:3,IDENTITY_ADDED_INVALID:4,IDENTITY_CHANGED_INVALID:5,IDENTITY_DELETED_INVALID:6,USYNC_VNAME_CERT_INVALID:7,USYNC_NO_VNAME_CERT:8}),xr=Object.freeze({STATIC:0,SHARED:1}),Br=Object.freeze({INVALID:0,NOT_SINGLE_SEGMENT_CALL:1,NOT_START_FROM_VIDEO_CALL:2,HAS_AV_SWITCH:3,SELF_CAMERA_OFF:4,PEER_CAMERA_OFF:5,SELF_HAS_NETWORK_TRANSITION:6,PEER_HAS_NETWORK_TRANSITION:7,CALL_TOO_SHORT:8,PASS:100}),Kr=Object.freeze({UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5}),jr=Object.freeze({UNCACHED:0,IDB:1,SW:2}),Yr=Object.freeze({INDIVIDUAL:0,GROUP:1,BROADCAST_LIST:2}),Wr=Object.freeze({PROD:0,INTERN:1,DEV:2}),Hr=Object.freeze({COMPLETED:0,ERROR:1,TIMEOUT:2,ABORTED:3}),Vr=Object.freeze({SUCCESS:0,SILENCE:1,ZEROWIDTH:2}),$r=Object.freeze({DOWNLOAD:1,UPLOAD:2}),zr=Object.freeze({NEW_GROUP:1,CREATE_A_ROOM:2,PROFILE:3,CATALOG:4,ARCHIVED:5,STARRED:6,LABELS:7,SETTINGS:8,LOG_OUT:9,CONTACT_INFO:10,SELECT_MESSAGES:11,CLOSE_CHAT:12,MUTE_NOTIFICATIONS:13,CLEAR_MESSAGES:14,DELETE_CHAT:15,REPORT_BUSINESS:16,BLOCK:17,SETTINGS_NOTIFICATIONS:18,SETTINGS_THEME:19,SETTINGS_CHAT_WALLPAPER:20,SETTINGS_BLOCKED:21,SETTINGS_HELP:22,OPEN:23,CLOSE:24}),qr=Object.freeze({THREADS_SCREEN_CLICK:1,CHAT_SCREEN_CLICK:2,SETTINGS_SCREEN_CLICK:3}),Jr=Object.freeze({LOAD_PREV:0,LOAD_NEXT:1,LOAD_AROUND:2}),Qr=Object.freeze({NAVIGATE_NEXT:0,RELOAD:1,BACK_FORWARD:2,UNDEFINED:255}),Xr=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12}),Zr=Object.freeze({UNKNOWN:0,USER_SCROLL:1,NEW_MESSAGE_PREFETCH:2,SEARCH_RESULT_CLICK:3}),en=Object.freeze({OTHER:0,MSG_CLICK:1,STICKER_PANEL_ICON:2,MEDIA_VIEWER:3,VIDEO_STREAMING:4,STATUS_V3:5,MULTI_SELECT_DOWNLOAD:6,DOCUMENT_DOWNLOAD:7,PIP:8,STICKER_PANEL_STICKER:9,SEND_TO_CHAT:10,UPLOAD:11,MSG_INIT:12,MSG_UPDATE:13,MSG_DELETE:14,MSG_RENDER:15}),tn=Object.freeze({INITIAL_PAIRING:0,OFFLINE_RESUME:1,IDLE:2}),rn=Object.freeze({TEXT:0,URL:1,IMAGE:2,VIDEO:3,GIF:4}),nn=Object.freeze({MY:0,RECENT:1,VIEWED:2,MUTED:3}),an=Object.freeze({STICKER_MAKER_BUTTON_TAP:0,IMAGE_UPLOADED:1,IMAGE_CROPPED:2,EMOJI_ADDED:3,STICKER_ADDED:4,TEXT_ADDED:5,IMAGE_OUTLINED:6,SEND_STICKER:7}),on=Object.freeze({QR:0,MAIN:1,SYNCING:2,OFFLINE:3,CONFLICT:4,PROXYBLOCK:5,TOS_BLOCK:6,SMB_TOS_BLOCK:7,DEPRECATED_VERSION:8}),sn=Object.freeze({PHONE:0,SERVER:1}),ln=Object.freeze({GET:0,SET:1}),cn=Object.freeze({WEB:1,WIN32:2,DARWIN:3,IOS_TABLET:4,ANDROID_TABLET:5,WINSTORE:6,MACSTORE:7,DARWIN_BETA:8,WIN32_BETA:9}),dn=Object.freeze({FALSE:0,TRUE:1,UNDEFINED:2}),un=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),pn=Object.freeze({FIRST_WELCOME_MESSAGE_IMP:0,FIRST_MESSAGE_SENT:1,QUICK_QUESTIONS_TAP:2,ICEBREAKERS_IMP:3,SELECT_QUESTION_TAP:4,SEND_TAP:5,ADS_CONTENT_DISMISSED:6}),fn=Object.freeze({IQ_REQUEST_FAILED:0,NO_WELCOME_MESSAGE_RETURNED:1,WELCOME_MESSAGE_RETURNED:2}),_n=Object.freeze({DISCONNECTED:1,CONNECTING:2,CONNECTED:3,UNKNOWN:4}),hn=Object.freeze({DISABLED:0,ALLOC:1,ALLOC_AND_RTP:2}),gn=(0,a.defineGlobal)({abKey2:[4473,c,["regular"]],appBuild:[1657,y,["regular","private"]],appIsBetaRelease:[21,o,["regular","private"]],appVersion:[17,c,["regular","private"]],browser:[779,c,["regular"]],browserVersion:[295,c,["regular"]],datacenter:[2795,c,["regular"]],deviceName:[13,c,["regular","private"]],deviceVersion:[4505,c,["regular"]],expoKey:[5029,c,["regular","private"]],mcc:[5,s,["regular","private"]],memClass:[655,s,["regular","private"]],mnc:[3,s,["regular","private"]],networkIsWifi:[23,o,["regular"]],osVersion:[15,c,["regular","private"]],platform:[11,xt,["regular","private"]],psCountryCode:[6833,c,["private"]],psId:[6005,c,["private"]],webcBucket:[875,c,["regular"]],webcEnv:[633,Wr,["regular"]],webcNativeAutolaunch:[1009,o,["regular"]],webcNativeBetaUpdates:[1007,o,["regular"]],webcPhoneAppVersion:[1005,c,["regular"]],webcPhoneCharging:[783,o,["regular"]],webcPhoneDeviceManufacturer:[829,c,["regular"]],webcPhoneDeviceModel:[831,c,["regular"]],webcPhoneOsBuildNumber:[833,c,["regular"]],webcPhoneOsVersion:[835,c,["regular"]],webcPhonePlatform:[707,xt,["regular"]],webcTabId:[3727,c,["regular"]],webcWebArch:[6605,c,["regular"]],webcWebDeviceManufacturer:[6599,c,["regular"]],webcWebDeviceModel:[6601,c,["regular"]],webcWebOsReleaseNumber:[6603,c,["regular"]],webcWebPlatform:[899,cn,["regular"]],yearClass:[689,s,["regular","private"]],yearClass2016:[2617,s,["regular","private"]]});(0,a.defineEvents)({AdvExpectedTsUnavailable:[3038,{},[1,1,1],"regular"],AdvIdentitySignatureInvalid:[3028,{advSignatureType:[1,gr]},[1,1,1],"regular"],AdvIdentityTimestampInvalid:[3046,{advIdentityIncomingTimestampInHours:[2,s],advIdentityLocalTimestampInHours:[1,s],advIdentityPrimaryIdentityMatch:[3,o]},[1,1,1],"regular"],AdvListSignatureInvalid:[3026,{},[1,1,1],"regular"],AdvListTimestampInvalid:[3040,{advListIncomingTimestampInHours:[2,s],advListIsExpired:[3,o],advListLocalTimestampInHours:[1,s]},[1,1,1],"regular"],AdvMetadataCreationFailure:[3048,{advMetadataIsMe:[1,o]},[1,1,1],"regular"],AdvPrimaryIdentityMissing:[3044,{primaryIdentityMissingProtoType:[1,jt]},[1,1,1],"regular"],AdvProtoDecodeFailed:[3032,{advDecodeErrorType:[2,u],advDecodeProtoType:[1,p]},[1,1,1],"regular"],AdvProtoMissing:[3042,{advCompanionIdentityMissing:[2,o],missingProtoType:[1,At]},[1,1,1],"regular"],AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,s]},[1,1,1],"regular"],AdvTimestampMismatch:[3030,{advProtobufTimestampInHours:[2,s],advStanzaTimestampInHours:[1,s]},[1,1,1],"regular"],AdvUsyncInvalidKeyIndex:[3034,{},[1,1,1],"regular"],AndroidMessageSendPerf:[1994,{appRestart:[16,o],bucketedSenderKeyDistributionCountPercentage:[32,s],bucketedSenderKeyDistributionHashTime:[35,s],deviceCount:[36,s],deviceSizeBucket:[26,mr],durationAbs:[11,d],durationRelative:[12,d],durationT:[1,d],fetchPrekeys:[15,o],fetchPrekeysPercentage:[21,s],groupSizeBucket:[17,fe],isDirectedMessage:[33,o],isE2eBackfill:[27,o],isMessageFanout:[9,o],isMessageForward:[8,o],isRevokeMessage:[24,o],isViewOnce:[29,o],jobsInQueue:[18,s],mediaType:[3,yt],messageIsFirstUserMessage:[30,o],messageIsInvisible:[31,o],messageType:[4,Ct],networkWasDisconnected:[14,o],participantCount:[37,s],phoneCores:[34,s],prekeysEligibleForPrallelProcessing:[28,o],sendCount:[13,s],sendRetryCount:[10,s],sendStage:[2,_e],senderKeyDistributionCountPercentage:[23,s],sessionsMissingWhenComposing:[25,o],targetDeviceGroupSizeBucket:[20,fe],threadsInExecution:[19,s]},[1,1,2e3],"regular"],ArchiveSettings:[2788,{keepChatsArchived:[1,o]},[1,1,1],"regular"],AutoReply:[3212,{autoReplyAction:[1,v]},[1,1,1],"private",113760892],BannerEvent:[1578,{bannerOperation:[2,b],bannerType:[1,P]},[1,1,1],"regular"],BizCatalogView:[3006,{bizPlatform:[14,O],cartToggle:[13,o],catalogEntryPoint:[2,ee],catalogEventSampled:[11,o],catalogOwnerJid:[10,c],catalogReportReasonCode:[8,c],catalogSessionId:[3,c],catalogViewAction:[1,te],collectionId:[15,c],collectionIndex:[16,c],deepLinkOpenFrom:[12,Pe],isNewProductAddedToCart:[7,o],isOrderMsgAttached:[5,o],orderId:[4,c],productId:[9,c],productIndex:[17,c],quantity:[6,s],sequenceNumber:[18,s]},[1,1,1],"private",0],BizProfileView:[3008,{bizFbSize:[8,Or],bizIgSize:[9,Or],businessProfileJid:[2,c],catalogSessionId:[6,c],isProfileLinked:[10,o],isSelfView:[11,o],linkedAccount:[5,x],profileEntryPoint:[12,Ht],scrollDepth:[4,s],sequenceNumber:[7,s],viewBusinessProfileAction:[1,Ur],websiteSource:[3,un]},[1,1,1],"private",0],BusinessMute:[1376,{muteT:[2,d],muteeId:[1,c]},[1,1,1],"regular"],BusinessProfileView:[2440,{businessOwnerJid:[2,c],businessProfileViewAction:[1,k],businessProfileWebsiteSourceTyp:[3,G]},[1,1,1],"private",113760892],BusinessToolsClick:[2218,{businessToolsItem:[3,F],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c],linkingTarget:[4,x]},[1,1,1],"regular"],BusinessToolsEntry:[2216,{businessToolsEntryPoint:[3,U],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessToolsImpression:[2220,{businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessUnmute:[1378,{muteeId:[1,c]},[1,1,1],"regular"],Call:[462,{acceptAckLatencyMs:[1016,d],acceptedButNotConnectedTimeSpentMs:[1015,d],activeRelayProtocol:[412,s],allocErrorBitmap:[593,s],androidAudioRouteMismatch:[1055,o],androidCamera2MinHardwareSupportLevel:[444,h],androidCameraApi:[443,g],androidSystemPictureInPictureT:[477,d],androidTelecomTimeSpentBeforeReject:[497,d],appInBackgroundDuringCall:[1109,o],audStreamMixPct:[1119,l],audioCodecDecodedFecFrames:[755,s],audioCodecDecodedPlcFrames:[756,s],audioCodecEncodedFecFrames:[751,s],audioCodecEncodedNonVoiceFrames:[753,s],audioCodecEncodedVoiceFrames:[752,s],audioCodecReceivedFecFrames:[754,s],audioDeviceIssues:[860,s],audioDeviceLastIssue:[861,s],audioDeviceSwitchCount:[867,s],audioDeviceSwitchDuration:[866,d],audioFrameLoss1xMs:[724,d],audioFrameLoss2xMs:[725,d],audioFrameLoss4xMs:[726,d],audioFrameLoss8xMs:[727,d],audioGetFrameUnderflowPs:[83,s],audioInbandFecDecoded:[679,s],audioInbandFecEncoded:[678,s],audioLossPeriodCount:[722,s],audioNackReqPktsRecvd:[646,s],audioNackReqPktsSent:[645,s],audioNackRtpRetransmitDiscardCount:[649,s],audioNackRtpRetransmitFailCount:[651,s],audioNackRtpRetransmitRecvdCount:[648,s],audioNackRtpRetransmitReqCount:[647,s],audioNackRtpRetransmitSentCount:[650,s],audioNumPiggybackRxPkt:[1008,s],audioNumPiggybackTxPkt:[1007,s],audioPlayCbIntervalGtDefaultCnt:[1138,s],audioPlayCbLatencyGteMaxCnt:[1139,s],audioPutFrameOverflowPs:[82,s],audioRecCbLatencyAvg:[1036,s],audioRecCbLatencyMax:[1035,s],audioRecCbLatencyMin:[1034,s],audioRecCbLatencyStddev:[1037,s],audioRtxPktDiscarded:[677,s],audioRtxPktProcessed:[676,s],audioRtxPktSent:[675,s],audioRxAvgFpp:[728,l],audioRxPktLossPctDuringPip:[642,l],audioTotalBytesOnNonDefCell:[450,l],avAvgDelta:[192,l],avMaxDelta:[193,l],aveNumPeersAutoPaused:[578,s],aveTimeBwResSwitches:[994,d],aveTimeBwVidRcDynCondTrue:[719,d],avgClockCbT:[139,d],avgDecodeT:[136,d],avgEncRestartAndKfGenT:[1048,d],avgEncRestartIntervalT:[1047,d],avgEncodeT:[135,d],avgEventQueuingDelay:[816,s],avgPlayCbIntvT:[1152,d],avgPlayCbT:[137,d],avgRecordCbIntvT:[495,d],avgRecordCbT:[138,d],avgRecordGetFrameT:[140,d],avgTargetBitrate:[141,l],avgTcpConnCount:[413,s],avgTcpConnLatencyInMsec:[414,d],batteryDropMatched:[355,o],batteryDropTriggered:[442,o],batteryLowMatched:[354,o],batteryLowTriggered:[441,o],batteryRulesApplied:[353,o],biDirRelayRebindLatencyMs:[843,d],biDirRelayResetLatencyMs:[844,d],builtinAecAvailable:[33,o],builtinAecEnabled:[38,o],builtinAecImplementor:[36,c],builtinAecUuid:[37,c],builtinAgcAvailable:[34,o],builtinNsAvailable:[35,o],bwaVidDisablingCandidate:[1114,o],bwaVidDisablingRxCandidateDuration:[1116,d],bwaVidDisablingTxCandidateDuration:[1115,d],bweEvaluationScoreE2e:[1068,s],bweEvaluationScoreSfuDl:[1070,s],bweEvaluationScoreSfuUl:[1069,s],c2DecAvgT:[302,d],c2DecFrameCount:[300,s],c2DecFramePlayed:[301,s],c2EncAvgT:[298,d],c2EncCpuOveruseCount:[299,s],c2EncFrameCount:[297,s],c2RxTotalBytes:[296,s],c2TxTotalBytes:[295,s],callAcceptFuncT:[132,d],callAecMode:[39,f],callAecOffset:[42,s],callAecTailLength:[43,s],callAgcMode:[52,_],callAndrGcmFgEnabled:[268,o],callAndroidAudioMode:[55,s],callAndroidRecordAudioPreset:[57,s],callAndroidRecordAudioSource:[56,s],callAudioEngineType:[54,S],callAudioRestartCount:[96,l],callAudioRestartReason:[97,l],callAvgAudioRxPipBitrate:[640,l],callAvgRottRx:[259,d],callAvgRottTx:[258,d],callAvgRtt:[107,d],callAvgVideoRxPipBitrate:[638,l],callBatteryChangePct:[195,l],callCalculatedEcOffset:[50,s],callCalculatedEcOffsetStddev:[51,s],callCreatorHid:[505,c],callDefNetwork:[405,K],callEcRestartCount:[99,l],callEchoEnergy:[46,l],callEchoLikelihood:[44,s],callEchoLikelihoodBeforeEc:[47,l],callEndFrameLossMs:[1142,d],callEndFuncT:[130,d],callEndReconnecting:[70,o],callEndReconnectingBeforeNetworkChange:[877,o],callEndReconnectingBeforeP2pFailover:[875,o],callEndReconnectingBeforeRelayFailover:[869,o],callEndReconnectingBeforeRelayReset:[948,o],callEndReconnectingSoonAfterCallActive:[848,o],callEndReconnectingSoonAfterNetworkChange:[878,o],callEndReconnectingSoonAfterP2pFailover:[876,o],callEndReconnectingSoonAfterRelayFailover:[870,o],callEndReconnectingSoonAfterRelayReset:[949,o],callEndedDuringAudFreeze:[518,o],callEndedDuringVidFreeze:[517,o],callEndedInterrupted:[23,o],callEnterPipModeCount:[626,s],callFromUi:[2,B],callHistEchoLikelihood:[45,l],callInitialRtt:[109,d],callInterrupted:[22,o],callIsLastSegment:[388,o],callLastRtt:[108,d],callMaxRtt:[106,d],callMessagesBufferedCount:[422,s],callMinRtt:[105,d],callNetwork:[76,K],callNetworkSubtype:[77,s],callNsMode:[53,Ot],callOfferAckTimout:[159,l],callOfferDelayT:[243,d],callOfferElapsedT:[102,d],callOfferFanoutCount:[588,s],callOfferReceiptDelay:[134,d],callP2pAvgRtt:[457,d],callP2pDisabled:[18,o],callP2pMinRtt:[456,d],callPeerAppVersion:[15,c],callPeerIpStr:[10,c],callPeerIpv4:[8,s],callPeerPlatform:[5,c],callPendingCallsAcceptedCount:[501,s],callPendingCallsCount:[498,s],callPendingCallsRejectedCount:[499,s],callPendingCallsTerminatedCount:[500,s],callPipMode10sCount:[628,s],callPipMode10sT:[633,d],callPipMode120sCount:[631,s],callPipMode120sT:[636,d],callPipMode240sCount:[632,s],callPipMode240sT:[637,d],callPipMode30sCount:[629,s],callPipMode30sT:[634,d],callPipMode60sCount:[630,s],callPipMode60sT:[635,d],callPipModeT:[627,d],callPlaybackBufferSize:[59,s],callPlaybackCallbackStopped:[25,o],callPlaybackFramesPs:[93,l],callPlaybackSilenceRatio:[95,l],callRadioType:[231,dr],callRandomId:[529,c],callRecentPlaybackFramesPs:[94,l],callRecentRecordFramesPs:[29,l],callReconnectingStateCount:[438,s],callRecordBufferSize:[58,s],callRecordCallbackStopped:[24,o],callRecordFramesPs:[28,s],callRecordMaxEnergyRatio:[98,l],callRecordSilenceRatio:[26,s],callRejectFuncT:[131,d],callRelayAvgRtt:[455,d],callRelayBindStatus:[16,j],callRelayCreateT:[104,d],callRelayMinRtt:[454,d],callRelayServer:[17,c],callResult:[63,Y],callRingingT:[103,d],callRxAvgBitrate:[121,l],callRxAvgBwe:[122,l],callRxAvgJitter:[125,d],callRxAvgLossPeriod:[128,d],callRxMaxJitter:[124,d],callRxMaxLossPeriod:[127,d],callRxMinJitter:[123,d],callRxMinLossPeriod:[126,d],callRxPktLossPct:[120,l],callRxPktLossRetransmitPct:[892,l],callRxStoppedT:[100,d],callSamplingRate:[30,s],callSegmentIdx:[389,s],callSegmentType:[393,W],callSelfIpStr:[9,c],callSelfIpv4:[7,s],callServerNackErrorCode:[68,s],callSetupErrorType:[71,H],callSetupT:[101,d],callSide:[1,V],callSoundPortFuncT:[133,d],callStartFuncT:[129,d],callSwAecMode:[41,s],callSwAecType:[40,Pr],callT:[92,d],callTermReason:[69,$],callTestBucket:[19,c],callTestEvent:[318,s],callTonesDetectedInRecord:[49,s],callTonesDetectedInRingback:[48,s],callTransitionCount:[78,s],callTransitionCountCellularToWifi:[432,s],callTransitionCountWifiToCellular:[431,s],callTransport:[72,z],callTransportExtrayElected:[515,o],callTransportP2pToRelayFallbackCount:[80,s],callTransportPeerTcpUsed:[587,o],callTransportRelayToRelayFallbackCount:[79,s],callTransportTcpFallbackToUdp:[516,o],callTransportTcpUsed:[514,o],callTxAvgBitrate:[112,l],callTxAvgBwe:[113,l],callTxAvgJitter:[116,d],callTxAvgLossPeriod:[119,d],callTxMaxJitter:[115,d],callTxMaxLossPeriod:[118,d],callTxMinJitter:[114,d],callTxMinLossPeriod:[117,d],callTxPktErrorPct:[111,l],callTxPktLossPct:[110,l],callUserRate:[20,s],callWakeupSource:[156,J],calleeAcceptToDecodeT:[447,d],callerInContact:[476,o],callerOfferToDecodeT:[445,d],callerVidRtpToDecodeT:[446,d],cameraFormats:[765,s],cameraIssues:[850,s],cameraLastIssue:[851,s],cameraOffCount:[331,s],cameraPauseT:[1131,d],cameraPermission:[849,o],cameraPreviewMode:[322,Q],cameraStartDuration:[852,d],cameraStartFailureDuration:[856,d],cameraStartMode:[233,X],cameraStartToFirstFrameT:[916,d],cameraStopDuration:[853,d],cameraStopFailureCount:[858,s],cameraSwitchCount:[855,s],cameraSwitchDuration:[854,d],cameraSwitchFailureDuration:[857,d],clampedBwe:[527,o],codecSamplingRate:[624,s],combinedE2eAvgRtt:[760,l],combinedE2eMaxRtt:[761,l],combinedE2eMinRtt:[759,l],confBridgeSamplingRate:[623,s],conservativeModeStopped:[974,o],conservativeRampUpExploringT:[743,d],conservativeRampUpHeldCount:[643,s],conservativeRampUpHoldingT:[741,d],conservativeRampUpRampingUpT:[742,d],createdFromGroupCallDowngrade:[519,o],dataLimitOnAltNetworkReached:[537,o],deviceBoard:[230,c],deviceHardware:[229,c],dtxRxByteFrameCount:[914,s],dtxRxCount:[912,s],dtxRxDurationT:[911,d],dtxRxTotalCount:[913,s],dtxRxTotalFrameCount:[1083,s],dtxTxByteFrameCount:[910,s],dtxTxCount:[619,s],dtxTxDurationT:[618,d],dtxTxTotalCount:[909,s],dtxTxTotalFrameCount:[1082,s],echoCancellationMsPerSec:[320,s],echoCancelledFrameCount:[940,s],echoEstimatedFrameCount:[941,s],echoSpeakerModeFrameCount:[987,s],encoderCompStepdowns:[81,s],endCallAfterConfirmation:[90,Ke],failureToCreateAltSocket:[534,s],failureToCreateTestAltSocket:[532,s],fastplayMaxDurationMs:[1005,d],fastplayNumFrames:[1004,s],fastplayNumTriggers:[1006,s],fieldStatsRowType:[328,He],finishedDlBwe:[503,o],finishedOverallBwe:[528,o],finishedUlBwe:[502,o],freezeAheadBweCongestionCorrPct:[1051,l],freezeBweCongestionCorrPct:[1009,l],groupAcceptNoCriticalGroupUpdate:[1013,o],groupAcceptToCriticalGroupUpdateMs:[1014,d],groupCallCallerParticipantCountAtCallStart:[439,s],groupCallInviteCountSinceCallStart:[360,s],groupCallIsGroupCallInvitee:[357,o],groupCallIsLastSegment:[356,o],groupCallNackCountSinceCallStart:[361,s],groupCallReringCountSinceCallStart:[946,s],groupCallReringNackCountSinceCallStart:[947,s],groupCallSegmentIdx:[329,s],groupCallTotalCallTSinceCallStart:[358,d],groupCallTotalP3CallTSinceCallStart:[359,d],groupCallVideoMaximizedCount:[592,s],hasRestrictedSettingsForAudioCalls:[539,o],highPeerBweT:[884,d],hisBasedInitialTxBitrate:[342,s],hisInfoCouldBeUsedForInitBwe:[339,o],historyBasedBweActivated:[807,o],historyBasedBweEnabled:[806,o],historyBasedBweSuccess:[808,o],historyBasedBweVideoTxBitrate:[809,s],incomingCallUiAction:[387,Qe],initBweSource:[337,Xe],initialEstimatedTxBitrate:[244,l],isCallFull:[1149,o],isIpv6Capable:[91,o],isLinkedGroupCall:[1090,o],isPendingCall:[976,o],isRejoin:[927,o],isRering:[945,o],isUpnpExternalIpPrivate:[260,o],isUpnpExternalIpTheSameAsReflexiveIp:[261,o],jbAvgDelay:[146,l],jbAvgDelayUniform:[644,l],jbAvgDisorderTargetSize:[1086,l],jbAvgTargetSize:[1012,l],jbDiscards:[150,l],jbEmpties:[151,l],jbEmptyPeriods1x:[997,l],jbEmptyPeriods2x:[998,l],jbEmptyPeriods4x:[999,l],jbEmptyPeriods8x:[1e3,l],jbGets:[152,l],jbLastDelay:[149,l],jbLost:[277,l],jbLostEmptyDuringPip:[641,s],jbLostEmptyHighPeerBwePerSec:[777,l],jbLostEmptyLowPeerBwePerSec:[775,l],jbLostEmptyLowToHighPeerBwePerSec:[776,l],jbMaxDelay:[148,l],jbMaxDisorderTargetSize:[1087,l],jbMinDelay:[147,l],jbNonSpeechDiscards:[846,l],jbPuts:[153,l],jbTotalEmptyPeriods:[996,l],jbVoiceFrames:[1081,s],joinableAfterCall:[895,o],joinableDuringCall:[894,o],joinableNewUi:[893,o],l1Locations:[986,c],lastConnErrorStatus:[415,s],libsrtpVersionUsed:[504,yr],lobbyVisibleT:[1127,d],logSampleRatio:[1120,s],longConnect:[21,o],lossOfAltSocket:[535,s],lossOfTestAltSocket:[533,s],lowDataUsageBitrate:[157,l],lowPeerBweT:[885,d],lowToHighPeerBweT:[886,d],malformedStanzaXpath:[452,c],maxConnectedParticipants:[1085,s],maxEventQueueDepth:[558,s],mediaStreamSetupT:[448,d],micAvgPower:[253,s],micMaxPower:[252,s],micMinPower:[251,s],micPermission:[859,o],micStartDuration:[862,d],micStartToFirstCallbackT:[931,d],micStopDuration:[863,d],multipleTxRxRelaysInUse:[838,o],nativeSamplesPerFrame:[32,c],nativeSamplingRate:[31,c],neteqAcceleratedFrames:[653,s],neteqExpandedFrames:[652,s],networkFailoverTriggeredCount:[1135,s],networkMediumChangeLatencyMs:[995,d],nseEnabled:[1128,o],nseOfflineQueueMs:[1129,d],numAsserts:[933,s],numConnectedParticipants:[330,s],numConnectedPeers:[1052,s],numCriticalGroupUpdateDropped:[567,s],numDirPjAsserts:[985,s],numInvitedParticipants:[1054,s],numL1Errors:[929,s],numL2Errors:[930,s],numOutOfOrderCriticalGroupUpdate:[625,s],numOutgoingRingingPeers:[1053,s],numPeersAutoPausedOnce:[577,s],numRenderSkipGreenFrame:[1029,s],numResSwitch:[993,s],numTransitionsToSpeech:[1113,s],numVidDlAutoPause:[574,s],numVidDlAutoResume:[576,s],numVidDlAutoResumeRejectBadAudio:[579,s],numVidRcDynCondTrue:[717,s],numVidUlAutoPause:[559,s],numVidUlAutoPauseFail:[560,s],numVidUlAutoPauseRejectHighSendingRate:[564,s],numVidUlAutoPauseRejectTooEarly:[565,s],numVidUlAutoPauseUserAction:[566,s],numVidUlAutoResume:[561,s],numVidUlAutoResumeFail:[562,s],numVidUlAutoResumeRejectAudioLqm:[563,s],numberOfProcessors:[27,s],offerAckLatencyMs:[1017,d],oibweDlProbingTime:[805,d],oibweE2eProbingTime:[802,d],oibweNotFinishedWhenCallActive:[868,o],oibweOibleProbingTime:[803,d],oibweUlProbingTime:[804,d],onMobileDataSaver:[525,o],onWifiAtStart:[540,o],oneSideInitRxBitrate:[507,s],oneSideInitTxBitrate:[506,s],oneSideMinPeerInitRxBitrate:[509,s],oneSideRcvdPeerRxBitrate:[508,o],opusVersion:[287,s],p2pSuccessCount:[522,s],pcntPoorAudLqmAfterPause:[599,l],pcntPoorAudLqmBeforePause:[598,l],pcntPoorVidLqmAfterPause:[597,l],pcntPoorVidLqmBeforePause:[596,l],peerCallNetwork:[264,Lt],peerCallResult:[66,Y],peerTransport:[591,z],peerVideoHeight:[191,s],peerVideoWidth:[190,s],peerXmppStatus:[4,_n],pingsSent:[160,l],pongsReceived:[161,l],poolMemUsage:[510,s],poolMemUsagePadding:[511,s],presentEndCallConfirmation:[89,Ke],prevCallTestBucket:[1060,c],previousCallInterval:[266,d],previousCallVideoEnabled:[265,o],previousCallWithSamePeer:[267,o],previousJoinNotEnded:[1001,o],probeAvgBitrate:[327,l],pushToCallOfferDelay:[158,l],rcMaxrtt:[155,l],rcMinrtt:[154,l],receivedByNse:[1130,o],reconnectingStartsBeforeCallActive:[847,o],recordCircularBufferFrameCount:[84,s],reflectivePortsDiff:[162,l],rekeyTime:[1140,s],relayBindFailureAltNetSwitchSuccess:[583,s],relayBindFailureAltNetSwitchTriggered:[582,s],relayBindFailureAltNetworkSwitchToCallEnd:[586,d],relayBindFailureFallbackCount:[581,s],relayBindFailureIpVersionSwitchToCallEnd:[585,d],relayBindFailureIpVersionSwitchTriggered:[584,s],relayBindTimeInMsec:[424,d],relayElectionTimeInMsec:[423,d],relayFallbackOnRxDataFromRelay:[481,s],relayFallbackOnStopRxDataOnP2p:[482,s],relayFallbackOnTransportStanzaNotification:[483,s],renderFreezeHighPeerBweT:[780,d],renderFreezeLowPeerBweT:[778,d],renderFreezeLowToHighPeerBweT:[779,d],rxProbeCountSuccess:[291,s],rxProbeCountTotal:[290,s],rxRelayRebindLatencyMs:[841,d],rxRelayResetLatencyMs:[842,d],rxTotalBitrate:[145,l],rxTotalBytes:[143,l],rxTpFbBitrate:[294,l],rxTrafficStartFalsePositive:[758,o],sbweAvgDowntrend:[963,l],sbweAvgUptrend:[962,l],sbweCeilingCongestionCount:[783,s],sbweCeilingCount:[781,s],sbweCeilingMissingRtcpCongestionCount:[786,s],sbweCeilingNoNewDataReceivedCongestionCount:[787,s],sbweCeilingPktLossCount:[782,s],sbweCeilingReceiveSideCount:[1106,s],sbweCeilingRttCongestionCount:[784,s],sbweCeilingZeroRttCongestionCount:[785,s],sbweGlobalMinRttCongestionCount:[1103,s],sbweHighestRttCongestionCount:[1133,s],sbweHoldCount:[961,s],sbweMinRttEmaCongestionCount:[1104,s],sbweRampDownCount:[960,s],sbweRampUpCount:[959,s],sbweRampUpPauseCount:[1134,s],senderBweInitBitrate:[975,s],sfuAbnormalUplinkRttCount:[879,s],sfuAvgDlPlrAtBalancedCongestion:[1096,l],sfuAvgDlPlrAtHighDlCongestion:[1094,l],sfuAvgDlPlrAtHighUlCongestion:[1092,l],sfuAvgLqHqTargetBitrateDiff:[1002,l],sfuAvgPeerRttAtBalancedCongestion:[1102,s],sfuAvgPeerRttAtHighPeerCongestion:[1100,s],sfuAvgPeerRttAtHighSelfCongestion:[1098,s],sfuAvgSelfRttAtBalancedCongestion:[1101,s],sfuAvgSelfRttAtHighPeerCongestion:[1099,s],sfuAvgSelfRttAtHighSelfCongestion:[1097,s],sfuAvgTargetBitrate:[673,l],sfuAvgTargetBitrateHq:[943,l],sfuAvgUlPlrAtBalancedCongestion:[1095,l],sfuAvgUlPlrAtHighDlCongestion:[1093,l],sfuAvgUlPlrAtHighUlCongestion:[1091,l],sfuBalancedPktLossAtCongestion:[1075,s],sfuBalancedRttAtCongestion:[1079,s],sfuBwaAllParticipantDlBwUsedPct:[919,l],sfuBwaAllParticipantUlBwUsedPct:[918,l],sfuBwaChangeNumStreamCount:[928,s],sfuBwaSelfDlBwUsedPct:[1003,l],sfuBwaSelfUlBwUsedPct:[917,l],sfuBwaSimulcastDisabledCntReasonBattery:[920,s],sfuBwaSimulcastDisabledCntReasonNetMedium:[921,s],sfuBwaVidEncHqStreamScheduledT:[926,d],sfuBwaVidEncLqStreamScheduledT:[925,d],sfuDownlinkAvgCombinedBwe:[662,l],sfuDownlinkAvgPktLossPct:[667,l],sfuDownlinkAvgRemoteBwe:[661,l],sfuDownlinkAvgSenderBwe:[660,l],sfuDownlinkMaxPktLossPct:[668,l],sfuDownlinkMinPktLossPct:[666,l],sfuDownlinkSbweAvgDowntrend:[973,l],sfuDownlinkSbweAvgUptrend:[972,l],sfuDownlinkSbweCeilingCongestionCount:[797,s],sfuDownlinkSbweCeilingCount:[795,s],sfuDownlinkSbweCeilingMissingRtcpCongestionCount:[800,s],sfuDownlinkSbweCeilingNoNewDataReceivedCongestionCount:[801,s],sfuDownlinkSbweCeilingPktLossCount:[796,s],sfuDownlinkSbweCeilingRttCongestionCount:[798,s],sfuDownlinkSbweCeilingZeroRttCongestionCount:[799,s],sfuDownlinkSbweHoldCount:[971,s],sfuDownlinkSbweRampDownCount:[970,s],sfuDownlinkSbweRampUpCount:[969,s],sfuDownlinkSenderBweDiffStddev:[958,l],sfuDownlinkSenderBweStddev:[957,l],sfuFirstRxBandwidthReportTime:[1111,d],sfuFirstRxParticipantReportTime:[883,d],sfuFirstRxUplinkReportTime:[881,d],sfuHighDlPktLossAtCongestion:[1074,s],sfuHighDlRttAtCongestion:[1078,s],sfuHighUlPktLossAtCongestion:[1073,s],sfuHighUlRttAtCongestion:[1077,s],sfuMaxTargetBitrate:[674,l],sfuMaxTargetBitrateHq:[944,l],sfuMinTargetBitrate:[672,l],sfuMinTargetBitrateHq:[942,l],sfuPeerDownlinkStddevAllCombinedBwe:[813,l],sfuRxBandwidthReportCount:[1110,s],sfuRxParticipantReportCount:[882,s],sfuRxUplinkReportCount:[880,s],sfuSimulcastAvgDecSessFlipTime:[833,d],sfuSimulcastAvgEncSchedEventUpdateTime:[837,d],sfuSimulcastBwaCandidateCnt:[923,s],sfuSimulcastBwaDownlinkBottleneckCount:[874,s],sfuSimulcastBwaUplinkBottleneckCount:[873,s],sfuSimulcastDecAvgKfRecvTimeSinceFlip:[952,d],sfuSimulcastDecAvgNumReplayedCachedPkt:[951,l],sfuSimulcastDecAvgNumSkippedCachedPkt:[950,l],sfuSimulcastDecNumNoKf:[953,s],sfuSimulcastDecSessFlipCount:[744,s],sfuSimulcastDecSessFlipErrorBitmap:[768,s],sfuSimulcastDecSessFlipErrorCount:[767,s],sfuSimulcastEncErrorBitmap:[766,s],sfuSimulcastEncSchedEventCount:[732,s],sfuSimulcastEncSchedEventErrorCount:[735,s],sfuSimulcastEncSchedEventSkipCount:[734,s],sfuSimulcastEncSchedEventSuccessUpdateCount:[733,s],sfuSimulcastMaxDecSessFlipTime:[832,d],sfuSimulcastMaxEncSchedEventUpdateTime:[836,d],sfuSimulcastMinDecSessFlipTime:[831,d],sfuSimulcastMinEncSchedEventUpdateTime:[835,d],sfuUplinkAvgCombinedBwe:[659,l],sfuUplinkAvgPktLossPct:[664,l],sfuUplinkAvgRemoteBwe:[658,l],sfuUplinkAvgRtt:[670,l],sfuUplinkAvgSenderBwe:[657,l],sfuUplinkMaxPktLossPct:[665,l],sfuUplinkMaxRtt:[671,l],sfuUplinkMinPktLossPct:[663,l],sfuUplinkMinRtt:[669,l],sfuUplinkSbweAvgDowntrend:[968,l],sfuUplinkSbweAvgUptrend:[967,l],sfuUplinkSbweCeilingCongestionCount:[790,s],sfuUplinkSbweCeilingCount:[788,s],sfuUplinkSbweCeilingMissingRtcpCongestionCount:[793,s],sfuUplinkSbweCeilingNoNewDataReceivedCongestionCount:[794,s],sfuUplinkSbweCeilingPktLossCount:[789,s],sfuUplinkSbweCeilingRttCongestionCount:[791,s],sfuUplinkSbweCeilingZeroRttCongestionCount:[792,s],sfuUplinkSbweHoldCount:[966,s],sfuUplinkSbweRampDownCount:[965,s],sfuUplinkSbweRampUpCount:[964,s],sfuUplinkSenderBweDiffStddev:[956,l],sfuUplinkSenderBweStddev:[955,l],simulcastAvgLqBitrateWhenHqEnabled:[1011,s],simulcastReplayVideoRenderFreeze2xT:[982,d],simulcastReplayVideoRenderFreeze4xT:[983,d],simulcastReplayVideoRenderFreeze8xT:[984,d],simulcastReplayVideoRenderFreezeT:[981,d],skippedBwaCycles:[748,s],skippedBweCycles:[747,s],speakerAvgPower:[250,s],speakerMaxPower:[249,s],speakerMinPower:[248,s],speakerStartDuration:[864,d],speakerStartToFirstCallbackT:[932,d],speakerStopDuration:[865,d],startedInitBweProbing:[900,o],switchToDefTriggeredByGoodDefNet:[538,s],switchToNonSfu:[750,s],switchToNonSimulcast:[1057,s],switchToSfu:[749,s],switchToSimulcast:[1056,s],symmetricNatPortGap:[257,s],systemNotificationOfNetChange:[541,s],telecomFrameworkCallStartDelayT:[440,d],timeEnc1280w:[992,d],timeEnc160w:[988,d],timeEnc320w:[989,d],timeEnc480w:[990,d],timeEnc640w:[991,d],timeOnNonDefNetwork:[530,d],timeOnNonDefNetworkPerSegment:[531,d],timeSinceLastRtpToCallEndInMsec:[715,d],timeVidRcDynCondTrue:[718,d],totalAqsMsgSent:[1126,s],totalAudioFrameLossMs:[723,d],totalBytesOnNonDefCell:[449,l],totalTimeVidDlAutoPause:[575,d],totalTimeVidUlAutoPause:[573,d],trafficShaperAvgAudioQueueMs:[898,d],trafficShaperAvgQueueMs:[242,d],trafficShaperAvgVideoQueueMs:[899,d],trafficShaperMaxDelayViolations:[240,s],trafficShaperMinDelayViolations:[241,s],trafficShaperOverflowCount:[237,s],trafficShaperQueueEmptyCount:[238,s],trafficShaperQueuedAudioPacketCount:[896,s],trafficShaperQueuedPacketCount:[239,s],trafficShaperQueuedVideoPacketCount:[897,s],transportCurTimeInMsecAsyncWriteWaitingInQueue:[552,d],transportLastSendOsError:[555,s],transportNumAsyncWriteDispatched:[580,s],transportNumAsyncWriteQueued:[551,s],transportOvershoot10PercCount:[699,s],transportOvershoot20PercCount:[700,s],transportOvershoot40PercCount:[701,s],transportOvershootLongestStreakS:[708,s],transportOvershootSinceLast10sCount:[704,s],transportOvershootSinceLast15sCount:[705,s],transportOvershootSinceLast1sCount:[702,s],transportOvershootSinceLast30sCount:[706,s],transportOvershootSinceLast5sCount:[703,s],transportOvershootStreakAvgS:[709,l],transportOvershootTimeBetweenAvgS:[707,l],transportRtpSendErrorRate:[557,l],transportSendErrorCount:[556,s],transportSnJumpDetectCount:[1153,s],transportSplitterRxErrCnt:[1059,s],transportSplitterTxErrCnt:[1058,s],transportSrtcpRxRejectedPktCnt:[1141,s],transportSrtpRxMaxPktSize:[1038,s],transportSrtpRxRejectedBitrate:[763,l],transportSrtpRxRejectedDupPktCnt:[772,s],transportSrtpRxRejectedPktCnt:[762,s],transportSrtpTxFailedPktCnt:[774,s],transportSrtpTxMaxPktSize:[773,s],transportTotalNumSendOsError:[554,s],transportTotalTimeInMsecAsyncWriteQueueToDispatch:[553,d],transportUndershoot10PercCount:[710,s],transportUndershoot20PercCount:[711,s],transportUndershoot40PercCount:[712,s],triggeredButDataLimitReached:[536,s],tsLogUpload:[1112,Ir],txProbeCountSuccess:[289,s],txProbeCountTotal:[288,s],txRelayBindUnbindPacketsMissingMessageIntegrity:[1105,s],txRelayRebindLatencyMs:[839,d],txRelayResetLatencyMs:[840,d],txTotalBitrate:[144,l],txTotalBytes:[142,l],txTpFbBitrate:[293,l],upnpAddResultCode:[246,Nr],upnpRemoveResultCode:[247,Lr],usedInitTxBitrate:[341,s],usedIpv4Count:[1150,s],usedIpv6Count:[1151,s],userDescription:[87,c],userProblems:[88,s],userRating:[86,s],v2vAudioFrameLoss1xMs:[1143,d],v2vAudioFrameLoss2xMs:[1144,d],v2vAudioFrameLoss4xMs:[1145,d],v2vAudioFrameLoss8xMs:[1146,d],v2vAudioLossPeriodCount:[1147,s],v2vTotalAudioFrameLossMs:[1148,d],vidAvgBurstyPktLossLength:[1121,d],vidAvgRandomPktLossLength:[1122,d],vidBurstyPktLossTime:[1123,d],vidCorrectRetxDetectPcnt:[688,s],vidFreezeTMsInSample0:[695,d],vidJbAvgDelay:[1062,l],vidJbDiscards:[1063,l],vidJbEmpties:[1064,l],vidJbGets:[1065,l],vidJbLost:[1061,l],vidJbPuts:[1066,l],vidJbResets:[1067,l],vidNumFecDroppedNoHole:[696,s],vidNumFecDroppedTooBig:[697,s],vidNumRandToBursty:[1124,s],vidNumRetxDropped:[698,s],vidNumRxRetx:[757,s],vidPktRxState0:[693,c],vidRandomPktLossTime:[1125,d],vidRxFecRateInSample0:[694,l],vidUlAutoPausedAtCallEnd:[589,o],vidUlTimeSinceAutoPauseAtCallEnd:[590,d],vidWrongRetxDetectPcnt:[716,s],videoActiveTime:[276,d],videoAheadAvSyncDiscardedFramesAvgDeltaT:[1041,d],videoAheadAvSyncRenderedFramesAvgDeltaT:[1043,d],videoAheadNumAvSyncDiscardFrames:[1039,s],videoAveDelayLtrp:[484,d],videoAvgCombPsnr:[390,l],videoAvgEncodingPsnr:[410,l],videoAvgScalingPsnr:[408,l],videoAvgSenderBwe:[186,l],videoAvgTargetBitrate:[184,l],videoAvgTargetBitrateHq:[828,l],videoBehindAvSyncDiscardedFramesAvgDeltaT:[1042,d],videoBehindAvSyncRenderedFramesAvgDeltaT:[1044,d],videoBehindNumAvSyncDiscardFrames:[1040,s],videoCaptureAvgFps:[222,s],videoCaptureConverterTs:[226,d],videoCaptureDupFrames:[887,s],videoCaptureFrameOverwriteCount:[496,s],videoCaptureHeight:[228,s],videoCaptureWidth:[227,s],videoCodecScheme:[401,s],videoCodecSubType:[303,s],videoCodecType:[236,s],videoDecAvgBitrate:[220,s],videoDecAvgConsecutiveKfVp8:[610,l],videoDecAvgConsecutiveLtrpVp8:[611,l],videoDecAvgFps:[207,l],videoDecAvgFramesFromFoundLtrVp8:[612,l],videoDecAvgFramesFromUnfoundLtrVp8:[613,l],videoDecColorId:[205,s],videoDecCrcMismatchFrames:[419,s],videoDecErrorFrames:[174,s],videoDecErrorFramesCodecSwitch:[714,s],videoDecErrorFramesDuplicate:[713,s],videoDecErrorFramesH264:[680,s],videoDecErrorFramesIgnoreConsecutive:[478,s],videoDecErrorFramesOutoforder:[682,s],videoDecErrorFramesSpsPpsH264:[812,s],videoDecErrorFramesSpsPpsMissingAfterResolutionSwitch:[810,s],videoDecErrorFramesSpsPpsNotSupportedAfterResolutionSwitch:[811,s],videoDecErrorFramesVp8:[681,s],videoDecErrorLtrpFramesVp8:[462,s],videoDecErrorLtrpFramesVp8CrcMismatch:[479,s],videoDecErrorLtrpFramesVp8NoLtr:[480,s],videoDecErrorLtrpFramesVp8NoLtr10:[615,s],videoDecErrorLtrpFramesVp8NoLtr5:[614,s],videoDecFatalErrorNum:[1084,s],videoDecInputFrames:[172,s],videoDecKeyframes:[175,s],videoDecLatency:[223,d],videoDecLatencyH264:[684,d],videoDecLatencyVp8:[683,d],videoDecLostPackets:[210,s],videoDecLtrpFramesVp8:[461,s],videoDecLtrpPoolCreateFailed:[490,o],videoDecName:[204,s],videoDecNumPliThrottledByAllLtrp:[915,s],videoDecNumSkippedFramesVp8:[616,s],videoDecNumSwitchesToAllLtrp:[617,s],videoDecOutputFrames:[173,s],videoDecRestart:[206,s],videoDecSkipPackets:[209,s],videoDecodePausedCount:[232,s],videoDowngradeCount:[273,s],videoEnabled:[163,o],videoEnabledAtCallStart:[270,o],videoEncAllLtrpTimeInMsec:[609,d],videoEncAvgBitrate:[221,s],videoEncAvgConsecutiveKfVp8:[605,l],videoEncAvgConsecutiveLtrpVp8:[606,l],videoEncAvgFps:[216,l],videoEncAvgFpsHq:[825,l],videoEncAvgFramesFromFoundLtrVp8:[604,l],videoEncAvgFramesFromUnfoundLtrVp8:[603,l],videoEncAvgPsnrKeyFrameVp8:[465,l],videoEncAvgPsnrLtrpFrameVp8:[469,l],videoEncAvgPsnrPFramePrevRefVp8:[474,l],videoEncAvgQpKeyFrameVp8:[466,l],videoEncAvgQpLtrpFrameVp8:[470,l],videoEncAvgQpPFramePrevRefVp8:[475,l],videoEncAvgSizeAllLtrpFrameVp8:[685,l],videoEncAvgSizeKeyFrameVp8:[464,l],videoEncAvgSizeLtrpFrameVp8:[468,l],videoEncAvgSizePFramePrevRefVp8:[473,l],videoEncAvgTargetFps:[215,l],videoEncAvgTargetFpsHq:[827,l],videoEncColorId:[213,s],videoEncDeviationAllLtrpFrameVp8:[686,l],videoEncDeviationPFramePrevRefVp8:[687,l],videoEncDiscardFrame:[217,s],videoEncDiscardFrameHq:[938,s],videoEncDropFrames:[179,s],videoEncDropFramesHq:[937,s],videoEncErrorFrames:[178,s],videoEncErrorFramesHq:[936,s],videoEncFatalErrorNum:[1049,s],videoEncInputFrames:[176,s],videoEncInputFramesHq:[934,s],videoEncKeyframes:[180,s],videoEncKeyframesHq:[939,s],videoEncKeyframesVp8:[463,s],videoEncKfErrCodecSwitchT:[731,d],videoEncKfIgnoreOldFrames:[729,s],videoEncKfQueueEmpty:[730,s],videoEncLatency:[224,d],videoEncLatencyHq:[826,d],videoEncLtrpFrameGenFailedVp8:[471,s],videoEncLtrpFramesVp8:[467,s],videoEncLtrpPoolCreateFailed:[491,o],videoEncLtrpToKfFallbackVp8:[494,s],videoEncModifyNum:[1050,s],videoEncName:[212,s],videoEncNumErrorLtrHoldFailedVp8:[600,s],videoEncNumErrorLtrHoldFailedVp810:[602,s],videoEncNumErrorLtrHoldFailedVp85:[601,s],videoEncNumSuccessHfFallbackVp8:[622,s],videoEncNumSwitchesToAllLtrp:[607,s],videoEncOutputFrames:[177,s],videoEncOutputFramesHq:[935,s],videoEncPFramePrevRefVp8:[472,s],videoEncRegularLtrpTimeInMsec:[608,d],videoEncRestart:[214,s],videoEncRestartPresetChange:[1046,s],videoEncRestartResChange:[1045,s],videoEncTimeOvershoot10PercH264:[363,d],videoEncTimeOvershoot10PercH265:[366,d],videoEncTimeOvershoot10PercVp8:[369,d],videoEncTimeOvershoot10PercVp9:[372,d],videoEncTimeOvershoot20PercH264:[364,d],videoEncTimeOvershoot20PercH265:[367,d],videoEncTimeOvershoot20PercVp8:[370,d],videoEncTimeOvershoot20PercVp9:[373,d],videoEncTimeOvershoot40PercH264:[365,d],videoEncTimeOvershoot40PercH265:[368,d],videoEncTimeOvershoot40PercVp8:[371,d],videoEncTimeOvershoot40PercVp9:[374,d],videoEncTimeSpentInFastH264Ms:[1026,d],videoEncTimeSpentInFasterH264Ms:[1025,d],videoEncTimeSpentInMediumH264Ms:[1027,d],videoEncTimeSpentInNegative10Vp8Ms:[1019,d],videoEncTimeSpentInNegative12Vp8Ms:[1018,d],videoEncTimeSpentInNegative4Vp8Ms:[1022,d],videoEncTimeSpentInNegative6Vp8Ms:[1021,d],videoEncTimeSpentInNegative8Vp8Ms:[1020,d],videoEncTimeSpentInSuperfastH264Ms:[1023,d],videoEncTimeSpentInVeryfastH264Ms:[1024,d],videoEncTimeUndershoot10PercH264:[375,d],videoEncTimeUndershoot10PercH265:[378,d],videoEncTimeUndershoot10PercVp8:[381,d],videoEncTimeUndershoot10PercVp9:[384,d],videoEncTimeUndershoot20PercH264:[376,d],videoEncTimeUndershoot20PercH265:[379,d],videoEncTimeUndershoot20PercVp8:[382,d],videoEncTimeUndershoot20PercVp9:[385,d],videoEncTimeUndershoot40PercH264:[377,d],videoEncTimeUndershoot40PercH265:[380,d],videoEncTimeUndershoot40PercVp8:[383,d],videoEncTimeUndershoot40PercVp9:[386,d],videoFecRecovered:[183,s],videoH264Time:[334,s],videoH265Time:[335,s],videoHeight:[189,s],videoInitRxBitrate16s:[904,l],videoInitRxBitrate2s:[901,l],videoInitRxBitrate4s:[902,l],videoInitRxBitrate8s:[903,l],videoInitialCodecScheme:[402,s],videoInitialCodecType:[321,s],videoLastCodecType:[404,s],videoLastSenderBwe:[185,l],videoMaxCombPsnr:[392,l],videoMaxEncodingPsnr:[411,l],videoMaxRxBitrate:[426,l],videoMaxScalingPsnr:[409,l],videoMaxTargetBitrate:[420,l],videoMaxTargetBitrateHq:[829,l],videoMaxTxBitrate:[425,l],videoMaxTxBitrateHq:[824,l],videoMinCombPsnr:[391,l],videoMinEncodingPsnr:[407,l],videoMinScalingPsnr:[406,l],videoMinTargetBitrate:[421,l],videoMinTargetBitrateHq:[830,l],videoNackSendDelay:[872,d],videoNewPktsBeforeNack:[871,s],videoNpsiGenFailed:[594,s],videoNpsiNoNack:[595,s],videoNumAvSyncDiscardFrames:[1010,s],videoNumH264Frames:[332,s],videoNumH265Frames:[333,s],videoPeerState:[275,q],videoPeerTriggeredPauseCount:[654,s],videoRenderAvgFps:[208,s],videoRenderConverterTs:[225,d],videoRenderDelayT:[196,d],videoRenderDupFrames:[888,s],videoRenderFreeze2xT:[304,d],videoRenderFreeze4xT:[305,d],videoRenderFreeze8xT:[306,d],videoRenderFreezeT:[235,d],videoRenderInitFreeze16sT:[908,d],videoRenderInitFreeze2sT:[905,d],videoRenderInitFreeze4sT:[906,d],videoRenderInitFreeze8sT:[907,d],videoRenderInitFreezeT:[526,d],videoRenderNumFreezes:[569,s],videoRenderNumSinceLastFreeze10s:[571,s],videoRenderNumSinceLastFreeze30s:[572,s],videoRenderNumSinceLastFreeze5s:[570,s],videoRenderPauseT:[1132,d],videoRenderSumTimeSinceLastFreeze:[568,d],videoRtcpAppRxFailed:[493,s],videoRtcpAppTxFailed:[492,s],videoRxBitrate:[169,l],videoRxBweHitTxBwe:[187,o],videoRxBytesRtcpApp:[489,l],videoRxFecBitrate:[219,l],videoRxFecFrames:[182,s],videoRxKfBeforeLtrpAfterRpsi:[485,s],videoRxLtrpFramesVp8:[460,s],videoRxNumCodecSwitch:[721,s],videoRxPackets:[201,s],videoRxPktErrorPct:[171,l],videoRxPktLossPct:[170,l],videoRxPktRtcpApp:[487,s],videoRxRtcpFir:[621,s],videoRxRtcpNack:[203,s],videoRxRtcpNpsi:[521,s],videoRxRtcpPli:[202,s],videoRxRtcpRpsi:[459,s],videoRxTotalBytes:[168,l],videoSelfState:[274,q],videoSenderBweDiffStddev:[954,l],videoSenderBweStddev:[348,l],videoTargetBitrateReaches1000kbpsT:[351,d],videoTargetBitrateReaches1500kbpsT:[435,d],videoTargetBitrateReaches2000kbpsT:[436,d],videoTargetBitrateReaches200kbpsT:[349,d],videoTargetBitrateReaches250kbpsT:[433,d],videoTargetBitrateReaches500kbpsT:[350,d],videoTargetBitrateReaches750kbpsT:[434,d],videoTotalBytesOnNonDefCell:[451,l],videoTxBitrate:[165,l],videoTxBitrateHq:[823,l],videoTxBytesRtcpApp:[488,l],videoTxFecBitrate:[218,l],videoTxFecFrames:[181,s],videoTxNumCodecSwitch:[720,s],videoTxPackets:[197,s],videoTxPacketsHq:[818,s],videoTxPktErrorPct:[167,l],videoTxPktErrorPctHq:[821,l],videoTxPktLossPct:[166,l],videoTxPktLossPctHq:[822,l],videoTxPktRtcpApp:[486,s],videoTxResendPackets:[198,s],videoTxResendPacketsHq:[819,s],videoTxRtcpFirEmptyJb:[620,s],videoTxRtcpNack:[200,s],videoTxRtcpNpsi:[520,s],videoTxRtcpPli:[199,s],videoTxRtcpPliHq:[820,s],videoTxRtcpRpsi:[458,s],videoTxTotalBytes:[164,l],videoTxTotalBytesHq:[817,l],videoUpdateEncoderFailureCount:[453,s],videoUpgradeCancelByTimeoutCount:[325,s],videoUpgradeCancelCount:[323,s],videoUpgradeCount:[272,s],videoUpgradeRejectByTimeoutCount:[326,s],videoUpgradeRejectCount:[324,s],videoUpgradeRequestCount:[271,s],videoWidth:[188,s],voipParamsCompressedSize:[1136,s],voipParamsUncompressedSize:[1137,s],vpxLibUsed:[513,xr],waLongFreezeCount:[891,s],waReconnectFreezeCount:[890,s],waShortFreezeCount:[889,s],waVoipHistoryGetVideoTxBitrateResult:[845,s],waVoipHistoryGetVideoTxBitrateSuccess:[740,o],waVoipHistoryIpAddressNotAvailable:[834,o],waVoipHistoryIsCallRecordLoaded:[737,o],waVoipHistoryIsCallRecordSaved:[738,o],waVoipHistoryIsInitialized:[769,o],waVoipHistoryNumOfCallRecordFound:[771,s],waVoipHistoryNumOfCallRecordLoaded:[739,s],waVoipHistorySaveCallRecordConditionCheckStatus:[770,Br],warpHeaderRxTotalBytes:[656,l],warpHeaderTxTotalBytes:[655,l],warpMiRxPktErrorCount:[1118,s],warpMiTxPktErrorCount:[1117,s],warpRelayChangeDetectCount:[1154,s],warpRxPktErrorCount:[746,s],warpTxPktErrorCount:[745,s],wavFileWriteMaxLatency:[1089,d],weakCellularNetConditionDetected:[429,s],weakWifiNetConditionDetected:[430,s],weakWifiSwitchToDefNetSuccess:[397,s],weakWifiSwitchToDefNetSuccessByPeriodicalCheck:[395,s],weakWifiSwitchToDefNetTriggered:[396,s],weakWifiSwitchToDefNetTriggeredByPeriodicalCheck:[394,s],weakWifiSwitchToNonDefNetFalsePositive:[399,s],weakWifiSwitchToNonDefNetSuccess:[400,s],weakWifiSwitchToNonDefNetTriggered:[398,s],wifiRssiAtCallStart:[263,s],wpNotifyCallFailed:[64,s],wpSoftwareEcMatches:[65,o],xmppStatus:[3,_n],xorCipher:[269,hn],zedFileWriteMaxLatency:[1088,d]},[1,1,1],"regular"],CatalogBiz:[1722,{cartToggle:[13,o],catalogAppealReason:[4,c],catalogBizAction:[1,Z],catalogEntryPoint:[7,ee],catalogSessionId:[3,c],collectionCount:[18,s],collectionId:[14,c],collectionIndex:[15,c],deepLinkOpenFrom:[8,Pe],errorCode:[5,s],isOrderMsgAttached:[10,o],orderId:[9,c],productCount:[6,s],productId:[2,c],productIds:[12,c],productIndex:[16,c],quantity:[11,s]},[1,1,1],"regular"],CatalogView:[1630,{bizPlatform:[16,O],cartToggle:[15,o],catalogEntryPoint:[7,ee],catalogEventSampled:[8,o],catalogOwnerJid:[6,c],catalogReportReasonCode:[4,c],catalogSessionId:[2,c],catalogViewAction:[1,te],collectionId:[17,c],collectionIndex:[18,c],deepLinkOpenFrom:[9,Pe],isNewProductAddedToCart:[13,o],isOrderMsgAttached:[10,o],orderId:[11,c],productId:[5,c],productIndex:[19,c],quantity:[12,s]},[1,1,1],"regular"],ChatComposerAction:[2948,{chatComposerActionTarget:[2,ne],chatComposerActionType:[1,ie]},[1,1,1],"private",113760892],ChatFilterEvent:[1616,{actionType:[1,ae],filterType:[2,se],searchResultType:[4,de],sessionId:[3,s],targetScreen:[5,oe]},[1,1,1],"regular"],ChatFolderOpen:[2808,{activityIndicatorCount:[2,s],folderType:[1,c],hasImportantMessages:[3,o]},[1,1,1],"regular"],ChatMessageCounts:[1644,{awayMsgsSent:[56,s],bizCatalogType:[60,M],bizConversationDepth:[65,s],blockReason:[33,w],broadcastMsgsReceived:[30,s],broadcastMsgsSent:[29,s],callOffersReceived:[27,s],callOffersSent:[26,s],callsResultBusy:[70,s],callsResultCancelled:[71,s],callsResultConnected:[72,s],callsResultError:[78,s],callsResultMissed:[73,s],callsResultRejected:[74,s],chatEphemeralityDuration:[15,s],chatMuted:[8,ce],chatOverflowClicks:[79,s],chatTypeInd:[2,ue],collectionInquiriesSent:[44,s],commerceMsgsReceived:[41,s],commerceMsgsSent:[40,s],disappearingChatInitiator:[59,we],entryPointConversionApp:[47,c],entryPointConversionSource:[46,c],ephemeralMessagesReceived:[14,s],ephemeralMessagesSent:[13,s],ephemeralMessagesUnreadExpired:[69,s],fbCtaInquiriesSent:[45,s],firstResponseTime:[25,s],gaStatus:[22,$e],greetingMsgsSent:[57,s],groupContainsBiz:[75,o],groupMembershipReplies:[51,s],groupPrivateReplies:[52,s],groupSize:[19,s],isAContact:[6,o],isAGroup:[5,o],isArchived:[10,o],isBlocked:[32,o],isCartAddClicked:[36,o],isCommerceViewed:[35,o],isCtaOnPdpClicked:[37,o],isLabelled:[54,o],isOppositePartyInitiated:[62,o],isPinned:[9,o],labelledMsgs:[55,s],messagesReceived:[4,s],messagesSent:[3,s],messagesStarred:[12,s],messagesUnread:[11,s],newThread:[68,o],ordersSent:[38,s],paymentsSent:[39,s],pdpInquiriesSent:[42,s],pdpViews:[61,s],profileReplies:[64,s],profileViews:[63,s],quickRepliesSent:[58,s],receiverDefaultDisappearingDuration:[21,s],senderDefaultDisappearingDuration:[20,s],spamReports:[31,s],startTime:[7,s],statusReplies:[50,s],statusViews:[49,s],storefrontInquiriesSent:[43,s],threadDs:[66,c],threadId:[67,c],totalCallDuration:[28,s],videoCallsOffered:[76,s],viewOnceMessagesOpened:[18,s],viewOnceMessagesReceived:[17,s],viewOnceMessagesSent:[16,s],voiceCallsOffered:[77,s]},[1,1,1],"regular"],ClockSkewDifferenceT:[3178,{clockSkewHourly:[1,s]},[1,1e3,1e4],"private",37887164],CommercePerf:[2420,{commercePerfEntryPoint:[4,ye],commercePerfMarker:[3,Ee],commercePerfView:[5,Se],instanceKey:[1,s],timespentT:[2,d]},[1,1,1],"private",113760892],CommerceView:[2438,{businessOwnerJid:[4,c],commerceAction:[1,ge],commerceActionSequenceNumber:[5,s],commerceEntryPoint:[2,me],commerceEventSampled:[8,o],commerceReportReasonCode:[6,c],commerceSessionId:[3,c],deepLinkOpenFrom:[9,Pe],productId:[7,c]},[1,1,1],"private",113760892],CompanionForceUpgradeUserAction:[3254,{forceUpgradeReason:[2,c],forceUpgradeUserAction:[1,Ve]},[1,1,1],"private",113760892],CompanionGetDevicesList:[3010,{getDevicesListApiCount:[2,s],getDevicesListApiDeviceType:[3,c],getDevicesListApiEnumerationType:[4,c],getDevicesListApiT:[1,d]},[1,1,1],"regular"],ContactDiscoveryTimeToEngagement:[3190,{elapsedTime:[1,s]},[1,1,1],"private",0],ContactSend:[2234,{channel:[1,Ce],isMultiVcard:[2,o],messageSendResult:[3,Tt],messageSendT:[4,d],vcardDataSize:[5,s]},[1,1,1],"regular"],ContactUsSession:[470,{contactUsAutomaticEmail:[3,o],contactUsExitState:[1,Ae],contactUsFaq:[2,o],contactUsLogs:[4,o],contactUsMenuFaqT:[12,d],contactUsOutage:[5,o],contactUsOutageEmail:[6,o],contactUsProblemDescription:[7,c],contactUsScreenshotC:[19,l],contactUsT:[11,d],languageCode:[21,c]},[1,1,1],"regular"],CtwaBusinessPreview:[3078,{catalogPresent:[4,o],ctwaBusinessPreviewAction:[1,D],eventTimestampMs:[2,s],openingHoursPresent:[5,o],profileLoadTimeMs:[3,s]},[1,1,1],"private",113760892],CtwaWelcomeMessage:[3022,{ctwaWelcomeMessageAction:[1,pn],ctwaWelcomeMessageContainsIcebreakers:[3,o],ctwaWelcomeMessageError:[4,fn],ctwaWelcomeMessageIcebreakersContainAutoreply:[5,o],firstWelcomeMessageImpressionTime:[2,s]},[1,1,1],"private",113760892],Daily:[1158,{accessibilityVoiceover:[108,o],addressbookSize:[11,s],addressbookWhatsappSize:[12,s],androidAdvertisingId:[135,c],androidKeystoreState:[139,m],appCodeHash:[103,c],autoDlAudioCellular:[90,o],autoDlAudioRoaming:[91,o],autoDlAudioWifi:[89,o],autoDlDocCellular:[96,o],autoDlDocRoaming:[97,o],autoDlDocWifi:[95,o],autoDlImageCellular:[87,o],autoDlImageRoaming:[88,o],autoDlImageWifi:[86,o],autoDlVideoCellular:[93,o],autoDlVideoRoaming:[94,o],autoDlVideoWifi:[92,o],backupNetworkSetting:[10,C],backupRestoreEncryptionVersion:[138,s],backupSchedule:[9,A],chatDatabaseSize:[19,s],defaultDisappearingDuration:[140,s],entSecurityNotificationsEnabled:[134,o],favoritedAnimatedStickerCount:[113,s],favoritedFirstPartyStickerCount:[112,s],favoritedTotalStickerCount:[111,s],installedAnimatedStickerPackCount:[116,s],installedAnimatedThirdPartyStickerPackCount:[137,s],installedFirstPartyStickerPackCount:[115,s],installedTotalStickerPackCount:[114,s],ipCountry:[123,c],ipStr:[122,c],languageCode:[5,c],locationCode:[6,c],mdPairTime:[124,s],mediaFolderFileCount:[21,s],mediaFolderSize:[20,s],networkIsRoaming:[7,o],osBuildNumber:[4,c],osNotificationSetting:[118,Mt],packageName:[102,c],paymentsIsEnabled:[100,o],permissionContacts:[104,o],privacySettingsAbout:[141,Wt],privacySettingsAboutExceptNum:[142,Yt],privacySettingsGroups:[143,Wt],privacySettingsGroupsExceptNum:[144,Yt],privacySettingsLastSeen:[145,Wt],privacySettingsLastSeenExceptNum:[146,Yt],privacySettingsProfilePhoto:[147,Wt],privacySettingsProfilePhotoExceptNum:[148,Yt],privacySettingsStatus:[150,Wt],privacySettingsStatusExceptNum:[151,Yt],privacySettingsStatusShareNum:[152,Yt],receiptsEnabled:[8,o],simMcc:[2,s],simMnc:[3,s],storageAvailSize:[31,s],storageTotalSize:[32,s],videoFolderFileCount:[23,s],videoFolderSize:[22,s]},[1,1,1],"regular"],DeepLinkClick:[1156,{deepLinkHasPhoneNumber:[2,o],deepLinkHasText:[1,o],deepLinkSessionId:[3,c]},[1,1,1],"regular"],DeepLinkMsgSent:[3198,{deepLinkAction:[1,be],deepLinkSessionId:[2,c]},[1,1,1],"regular"],DeepLinkOpen:[2136,{deepLinkOpenFrom:[2,Pe],deepLinkSessionId:[6,c],deepLinkType:[3,Me],isContact:[4,o],linkOwnerType:[5,Nt]},[1,1,1],"regular"],DisappearingModeSettingChange:[3056,{disappearingModeEntryPoint:[4,Re],lastToggleTimestamp:[3,s],newEphemeralityDuration:[2,s],previousEphemeralityDuration:[1,s]},[1,1,1],"regular"],E2eMessageRecv:[478,{e2eCiphertextType:[5,ke],e2eCiphertextVersion:[6,s],e2eDestination:[4,Ge],e2eFailureReason:[2,Ue],e2eSenderType:[8,Fe],e2eSuccessful:[1,o],messageMediaType:[7,yt],offline:[9,o],retryCount:[3,s]},[1,1,20],"regular"],E2eMessageSend:[476,{e2eCiphertextType:[5,ke],e2eCiphertextVersion:[6,s],e2eDestination:[4,Ge],e2eFailureReason:[2,Ue],e2eReceiverType:[8,Ie],e2eSuccessful:[1,o],encRetryCount:[9,s],messageMediaType:[7,yt],retryCount:[3,s]},[1,1,1],"regular"],E2eRetryAfterDelivery:[894,{deviceType:[4,Ie],messageType:[1,Ct],msgRetryCount:[3,s],retryRevoke:[2,o]},[1,1,1],"regular"],E2eeSystemMessage:[3176,{chatCategory:[1,re],e2eeDialogInteraction:[2,pe],e2eeSystemMessageGroupSizeBucket:[3,xe],e2eeSystemMessageType:[4,fr]},[1,1,1],"regular"],EditBusinessProfile:[1466,{businessProfileEntryPoint:[10,N],editBusinessProfileSessionId:[2,c],editProfileAction:[1,Be],editProfileActionField:[9,L],hasAddress:[5,o],hasCategory:[4,o],hasDescription:[3,o],hasEmail:[7,o],hasHours:[6,o],hasWebsite:[8,o]},[1,1,1],"regular"],EphemeralMessageTime:[2742,{zombieStateDuration:[1,s]},[1,1,1],"regular"],EphemeralPurgeCount:[2744,{messageCount:[1,s]},[1,1,1],"regular"],EphemeralSettingChange:[2370,{chatEphemeralityDuration:[1,s],ephemeralSettingEntryPoint:[3,je],ephemeralSettingGroupSize:[5,Bt],previousEphemeralityDuration:[2,s]},[1,1,1],"regular"],ForwardSend:[1728,{disappearingChatInitiator:[21,we],e2eCiphertextType:[12,ke],e2eCiphertextVersion:[11,s],ephemeralityDuration:[18,s],fastForwardEnabled:[5,o],isFrequentlyForwarded:[14,o],mediaCaptionPresent:[10,o],messageForwardAgeT:[4,d],messageIsFanout:[6,o],messageIsFastForward:[3,o],messageIsInternational:[9,o],messageMediaType:[2,yt],messageSendT:[13,d],messageType:[1,Ct],receiverDefaultDisappearingDuration:[20,s],resendCount:[8,s],retryCount:[7,s],senderDefaultDisappearingDuration:[19,s],wouldBeFrequentlyForwardedAt3:[16,o],wouldBeFrequentlyForwardedAt4:[17,o]},[1,1,1],"regular"],GatedChatOpened:[3150,{chatGatedReason:[1,le],selfInitiated:[2,o]},[1,1,1],"regular"],GatedMessageReceived:[3152,{chatGatedReason:[1,le]},[1,1,1],"regular"],GifFromProviderSent:[1124,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GifSearchCancelled:[1126,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GifSearchNoResults:[1128,{gifSearchProvider:[1,ze],inputLanguageCode:[3,c],languageCode:[2,c]},[1,1,1],"regular"],GifSearchResultTapped:[1122,{gifSearchProvider:[1,ze],rank:[2,s]},[1,1,1],"regular"],GifSearchSessionStarted:[1134,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GraphqlCatalogRequest:[3206,{graphqlCatalogEndpoint:[1,qe],graphqlErrorCode:[3,s],graphqlRequestResult:[2,Je]},[1,1,1],"private",0],GroupCatchUp:[3058,{mentionsCountPendingPercentage:[4,s]},[1,1,1],"regular"],GroupCreateC:[156,{},[1,1,1],"regular"],GroupJoinC:[158,{},[1,1,1],"regular"],HfmTextSearchComplete:[2186,{},[1,1,1],"regular"],LabelEvent:[1422,{itemsLabeledCount:[5,s],labelCount:[4,s],labelOperation:[2,et],labelTarget:[1,tt],predefinedLabelNumber:[3,s]},[1,1,1],"regular"],LdpExampleEvent1:[2866,{rapporValue1:[1,s],rapporValue2:[2,s]},[1,1,1],"private",113760892],Login:[460,{androidKeystoreState:[10,m],connectionOrigin:[6,ve],connectionT:[5,d],loginResult:[1,rt],loginT:[3,d],longConnect:[4,o],passive:[8,o],retryCount:[2,s],sequenceStep:[7,s],serverErrorCode:[9,s]},[1,1,1],"regular"],MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,o]},[1,20,1e3],"regular"],MdAppStateKeyRotation:[2518,{mdAppStateKeyRotationReason:[1,nt]},[1,20,1e3],"regular"],MdAppStateMessageRange:[2522,{additionalMessagesCount:[1,s]},[1,20,1e3],"regular"],MdAppStateOfflineNotifications:[2602,{redundantCount:[1,s]},[1,20,1e3],"regular"],MdAppStateSyncDaily:[2300,{crossIndexConflictCount:[11,s],invalidActionCount:[4,s],keyRotationRemoveCount:[12,s],missingKeyCount:[9,s],mutationCount:[1,s],storedMutationCount:[7,s],unsetActionCount:[8,s],unsupportedActionCount:[5,s],uploadConflictCount:[10,s]},[1,1,1],"regular"],MdAppStateSyncMutationStats:[3180,{applied:[1,bt],failed:[2,bt],invalid:[3,bt],orphan:[4,bt],syncdAction:[5,c],unsupported:[6,bt]},[1,1,100],"private",0],MdBadDeviceSentMessage:[2176,{dsmError:[2,Le],peerType:[1,Ie]},[1,1,1],"regular"],MdBootstrapAppStateCriticalDataProcessing:[3164,{bootstrapAppStateDataStage:[1,R],mdBootstrapPayloadType:[2,at],mdRegAttemptId:[3,c],mdSessionId:[4,c],mdTimestamp:[5,s]},[1,1,1],"regular"],MdBootstrapAppStateDataDownloaded:[2294,{mdBootstrapContactsCount:[5,s],mdBootstrapHistoryPayloadType:[11,it],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,at],mdBootstrapStepDuration:[6,s],mdBootstrapStepResult:[7,st],mdRegAttemptId:[10,c],mdSessionId:[1,c],mdStorageQuotaBytes:[8,s],mdStorageQuotaUsedBytes:[9,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapDataApplied:[2298,{collection:[5,he],historySyncStageProgress:[11,s],mdBootstrapContactsCount:[8,s],mdBootstrapHistoryPayloadType:[10,it],mdBootstrapPayloadType:[3,at],mdBootstrapSource:[2,ot],mdBootstrapStepDuration:[6,s],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestamp:[4,s],usedSnapshot:[7,o]},[1,1,1],"regular"],MdBootstrapHistoryDataDownloaded:[2296,{historySyncStageProgress:[14,s],mdBootstrapChatsCount:[6,s],mdBootstrapHistoryPayloadType:[13,it],mdBootstrapMessagesCount:[5,s],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,at],mdBootstrapStepDuration:[7,s],mdBootstrapStepResult:[8,st],mdHsOldestMessageTimestamp:[11,s],mdRegAttemptId:[12,c],mdSessionId:[1,c],mdStorageQuotaBytes:[9,s],mdStorageQuotaUsedBytes:[10,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapHistoryDataReceived:[2998,{historySyncStageProgress:[5,s],mdBootstrapHistoryPayloadType:[3,it],mdBootstrapPayloadType:[2,at],mdSessionId:[1,c],mdTimestamp:[4,s]},[1,1,1],"regular"],MdCriticalEvent:[2746,{mdCriticalEventCode:[1,ut]},[1,1,1],"regular"],MdDeviceSyncAck:[2180,{chatType:[1,vt],revoke:[2,o]},[1,1,1],"regular"],MdFatalError:[2304,{collection:[2,he],isBootstrap:[3,o],mdFatalErrorCode:[1,pt],patchSnapshotMutationCount:[9,s],patchVersion:[5,s],timeSincePairingMs:[6,s],timeSinceRefreshMs:[7,s],timeSinceTabTakeoverMs:[8,s]},[1,1,1],"regular"],MdLinkDeviceCompanion:[2576,{mdDurationS:[8,s],mdLinkDeviceCompanionErrorCode:[6,s],mdLinkDeviceCompanionStage:[4,ct],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestampS:[7,s],mdWasUpgraded:[5,o]},[1,1,1],"regular"],MdPushnameValidation:[2302,{didWebUserChangeSyncd:[3,o],isSyncdPushnameEmpty:[2,o],matches:[1,o],validationCaller:[4,ft],validationStage:[5,dt],webPlatform:[6,_t]},[1,1,1e3],"regular"],MdRetryFromUnknownDevice:[2178,{offline:[2,o],senderType:[1,Ie]},[1,1,1],"regular"],MdSyncdDogfoodingFeatureUsage:[3016,{mdSyncdDogfoodingFeature:[1,lt]},[1,1,1],"regular"],MediaDownload2:[1590,{connectionType:[31,Te],debugMediaException:[24,c],debugMediaIp:[22,c],debugUrl:[23,c],downloadBytesTransferred:[20,l],downloadConnectT:[15,d],downloadHttpCode:[18,s],downloadIsReuse:[17,o],downloadIsStreaming:[19,o],downloadNetworkT:[16,d],downloadQuality:[37,Ne],downloadResumePoint:[14,s],downloadTimeToFirstByteT:[21,d],estimatedBandwidth:[36,l],isViewOnce:[41,o],mediaId:[38,s],networkStack:[30,Pt],overallAttemptCount:[4,s],overallBackendStore:[39,T],overallConnBlockFetchT:[10,d],overallConnectionClass:[29,c],overallCumT:[27,d],overallDecryptT:[12,d],overallDomain:[5,c],overallDownloadMode:[11,ht],overallDownloadOrigin:[35,De],overallDownloadResult:[25,gt],overallFileValidationT:[13,d],overallIsEncrypted:[28,o],overallIsFinal:[26,o],overallMediaSize:[7,l],overallMediaType:[1,yt],overallMmsVersion:[6,s],overallQueueT:[9,d],overallRetryCount:[3,s],overallT:[8,d],usedFallbackHint:[40,c]},[1,1,1],"regular"],MediaPicker:[1038,{audienceSelectorClicked:[24,o],audienceSelectorUpdated:[25,o],chatRecipients:[16,s],isViewOnce:[22,o],mediaPickerChanged:[4,s],mediaPickerCroppedRotated:[10,s],mediaPickerDeleted:[3,s],mediaPickerDrawing:[11,s],mediaPickerFilter:[18,s],mediaPickerLikeDoc:[19,s],mediaPickerNotLikeDoc:[20,s],mediaPickerOrigin:[14,mt],mediaPickerOriginThirdParty:[21,o],mediaPickerSent:[2,s],mediaPickerSentUnchanged:[5,s],mediaPickerStickers:[12,s],mediaPickerT:[15,d],mediaPickerText:[13,s],mediaType:[1,yt],photoGalleryDurationT:[23,d],statusRecipients:[17,s]},[1,1,1],"regular"],MediaUpload2:[1588,{connectionType:[43,Te],debugMediaException:[34,c],debugMediaIp:[32,c],debugUrl:[33,c],estimatedBandwidth:[45,l],finalizeConnectT:[28,d],finalizeHttpCode:[31,s],finalizeIsReuse:[30,o],finalizeNetworkT:[29,d],isViewOnce:[49,o],mediaId:[46,s],networkStack:[42,Pt],overallAttemptCount:[4,s],overallConnBlockFetchT:[10,d],overallConnectionClass:[41,c],overallCumT:[37,d],overallCumUserVisibleT:[38,d],overallDomain:[5,c],overallEncryptT:[50,d],overallIsFinal:[36,o],overallIsForward:[16,o],overallIsManual:[13,o],overallLastUploadRetryPhase:[11,Rt],overallMediaKeyReuse:[40,Dt],overallMediaSize:[7,l],overallMediaType:[1,yt],overallMmsVersion:[6,s],overallOptimisticFlag:[12,It],overallQueueT:[9,d],overallRetryCount:[3,s],overallT:[8,d],overallTranscodeT:[15,d],overallUploadMode:[39,Et],overallUploadOrigin:[44,Rr],overallUploadResult:[35,St],overallUserVisibleT:[14,d],resumeConnectT:[17,d],resumeHttpCode:[20,s],resumeIsReuse:[19,o],resumeNetworkT:[18,d],uploadBytesTransferred:[27,l],uploadConnectT:[22,d],uploadHttpCode:[25,s],uploadIsReuse:[24,o],uploadIsStreaming:[26,o],uploadNetworkT:[23,d],uploadResumePoint:[21,s],uploadSource:[48,Dr],usedFallbackHint:[47,c]},[1,1,1],"regular"],MemoryStat:[1336,{hasVerifiedNumber:[7,o],numMessages:[8,l],privateBytes:[3,l],processType:[5,c],sharedBytes:[4,l],uptime:[6,l],workingSetPeakSize:[2,l],workingSetSize:[1,l]},[1,1,1],"regular"],MessageReceive:[450,{deviceCount:[16,s],deviceSizeBucket:[10,mr],disappearingChatInitiator:[14,we],ephemeralityDuration:[13,s],isViewOnce:[9,o],messageIsInternational:[4,o],messageIsOffline:[5,o],messageMediaType:[2,yt],messageQueueTime:[15,d],messageReceiveT0:[6,d],messageReceiveT1:[7,d],messageType:[1,Ct],mutedGroupMessage:[8,o],numOfWebUrlsInTextMessage:[3,s],participantCount:[17,s],receiverDefaultDisappearingDuration:[12,s],senderDefaultDisappearingDuration:[11,s]},[1,1,1],"regular"],MessageSend:[854,{deviceCount:[31,s],deviceSizeBucket:[25,mr],disappearingChatInitiator:[30,we],e2eBackfill:[23,o],e2eCiphertextType:[10,ke],e2eCiphertextVersion:[9,s],ephemeralityDuration:[21,s],fastForwardEnabled:[15,o],isFromWamsys:[19,o],isViewOnce:[22,o],mediaCaptionPresent:[8,o],messageForwardAgeT:[14,d],messageIsFanout:[5,o],messageIsFastForward:[13,o],messageIsFirstUserMessage:[26,o],messageIsForward:[4,o],messageIsInternational:[7,o],messageIsInvisible:[29,o],messageIsRevoke:[24,o],messageMediaType:[3,yt],messageSendOptUploadEnabled:[12,o],messageSendResult:[1,Tt],messageSendResultIsTerminal:[17,o],messageSendT:[11,d],messageType:[2,Ct],participantCount:[32,s],receiverDefaultDisappearingDuration:[28,s],resendCount:[16,s],retryCount:[6,s],senderDefaultDisappearingDuration:[27,s],stickerIsFirstParty:[18,o],thumbSize:[20,l]},[1,5,5],"regular"],MessageTemplateBlocks:[3002,{blockEntryPoint:[3,I],blockReason:[2,w],didUserReply:[4,o],templateId:[1,c]},[1,1,1],"private",113760892],OfflineResume:[3112,{chatThreadCount:[1,s],isOfflineCompleteMissed:[2,o],isResumeInForeground:[13,o],lastStanzaT:[3,d],mailboxAge:[14,s],mainScreenLoadT:[4,d],offlineDecryptErrorCount:[5,s],offlineMessageCount:[6,s],offlineNotificationCount:[7,s],offlinePreviewT:[8,d],offlineReceiptCount:[9,s],offlineSizeBytes:[10,s],onTrickleMode:[15,o],pageLoadT:[11,d],socketConnectT:[12,d]},[1,1,1],"regular"],OtpCopyCodeClick:[3080,{businessPhoneNumber:[1,s],otpEntryPoint:[4,wt],templateId:[3,c]},[1,1,1],"private",0],PaymentsDaily:[2950,{invitedUserCnt:[2,s],invitedUserRegisteredCnt:[3,s],inviterUserCnt:[5,s],invitesReceivedToUserCnt:[4,s],invitesSentToUserCnt:[1,s],startTs:[14,s],totalTransactionReceivedCnt:[10,s],totalTransactionSentCnt:[6,s],transactionReceivedWithBackgroundAndStickerCnt:[13,s],transactionReceivedWithBackgroundCnt:[12,s],transactionReceivedWithStickerCnt:[11,s],transactionSentWithBackgroundAndStickerCnt:[9,s],transactionSentWithBackgroundCnt:[8,s],transactionSentWithStickerCnt:[7,s]},[1,1,1],"private",113760892],PlaceholderActivity:[1980,{deviceCount:[9,s],deviceSizeBucket:[8,mr],messageIsRevoke:[7,o],messageMediaType:[6,yt],messageType:[5,Ct],participantCount:[10,s],placeholderActionInd:[2,Gt],placeholderChatTypeInd:[3,Ut],placeholderTimePeriod:[4,s],placeholderTypeInd:[1,Ft]},[1,1,1],"regular"],PrekeysDepletion:[3014,{deviceSizeBucket:[3,mr],messageType:[2,Ct],prekeysFetchReason:[1,Kt]},[1,1,1],"regular"],PsBufferUpload:[2244,{applicationState:[6,E],psBufferUploadHttpResponseCode:[3,s],psBufferUploadResult:[1,$t],psBufferUploadT:[2,d],psDitheredT:[11,s],psForceUpload:[10,o],psTokenNotReadyReason:[4,Jt],psUploadReason:[9,Qt],waConnectedToChatd:[5,o]},[1,1,1],"regular"],PsIdCreate:[2310,{},[1,1,1],"regular"],PsIdUpdate:[2862,{psIdAction:[2,zt],psIdKey:[1,s],psIdRotationFrequence:[3,s]},[1,1,1],"regular"],PsP2bThreadsV1:[2994,{chatEphemeralityDuration:[11,s],chatMuted:[6,ce],chatTypeInd:[18,ue],ephemeralMessagesReceived:[13,s],ephemeralMessagesSent:[12,s],groupSize:[3,s],isAContact:[1,o],isAGroup:[2,o],isArchived:[5,o],isPinned:[4,o],messagesReceived:[8,s],messagesSent:[7,s],messagesStarred:[9,s],messagesUnread:[10,s],startTime:[17,s],viewOnceMessagesOpened:[14,s],viewOnceMessagesReceived:[16,s],viewOnceMessagesSent:[15,s]},[1,1,1],"private",113760892],PsPhoneNumberHyperlink:[3266,{isPhoneNumHyperlinkOwner:[1,o],phoneNumHyperlinkAction:[2,kt],phoneNumberStatusOnWa:[3,o],sequenceNumber:[4,s]},[1,1,1],"private",113760892],PsStructuredMessageInteraction:[3052,{bizPlatform:[1,O],businessOwnerJid:[7,c],messageClass:[3,br],messageClassAttributes:[5,c],messageInteraction:[4,Ze],messageMediaType:[2,yt]},[1,1,1],"private",0],Ptt:[458,{pttDraftPlayCnt:[7,s],pttDraftSeekCnt:[8,s],pttDuration:[5,d],pttLock:[4,o],pttPauseCnt:[9,s],pttResult:[1,tr],pttSize:[3,l],pttSource:[2,rr],pttStop:[6,o],pttStopTapCnt:[10,s]},[1,1,1],"regular"],PttDaily:[2938,{pttCancelBroadcast:[9,s],pttCancelGroup:[8,s],pttCancelIndividual:[7,s],pttDraftReviewBroadcast:[15,s],pttDraftReviewGroup:[14,s],pttDraftReviewIndividual:[13,s],pttFastplaybackBroadcast:[21,s],pttFastplaybackGroup:[20,s],pttFastplaybackIndividual:[19,s],pttLockBroadcast:[12,s],pttLockGroup:[11,s],pttLockIndividual:[10,s],pttOutOfChatBroadcast:[29,s],pttOutOfChatGroup:[30,s],pttOutOfChatIndividual:[31,s],pttPausedRecordBroadcast:[22,s],pttPausedRecordGroup:[23,s],pttPausedRecordIndividual:[24,s],pttPlaybackBroadcast:[18,s],pttPlaybackGroup:[17,s],pttPlaybackIndividual:[16,s],pttRecordBroadcast:[3,s],pttRecordGroup:[2,s],pttRecordIndividual:[1,s],pttSendBroadcast:[6,s],pttSendGroup:[5,s],pttSendIndividual:[4,s],pttStopTapBroadcast:[25,s],pttStopTapGroup:[26,s],pttStopTapIndividual:[27,s]},[1,1,1],"regular"],PttLockC:[2984,{},[1,1,1],"regular"],PttPlayback:[2044,{pttDuration:[12,d],pttMainThreadBlock:[7,o],pttMiniPlayerClick:[15,s],pttMiniPlayerClose:[16,o],pttMiniPlayerPauseCnt:[17,s],pttPlayRequestT:[1,d],pttPlaybackFailed:[8,o],pttPlaybackOverallT:[4,d],pttPlaybackSpeed:[10,Zt],pttPlaybackSpeedCnt:[11,s],pttPlayedOutOfChat:[18,o],pttPlayedPct:[14,l],pttPlayer:[9,er],pttPlayerInitT:[2,d],pttPlayerPlayT:[3,d],pttSeekCnt:[13,s],pttTrigger:[5,ir],pttType:[6,nr]},[1,1,1],"regular"],QuickReply:[1468,{attachmentGifCount:[7,s],attachmentImageCount:[5,s],attachmentVideoCount:[6,s],isSmartDefault:[10,o],quickReplyAction:[1,or],quickReplyCount:[2,s],quickReplyEntryPoint:[11,sr],quickReplyKeywordCount:[3,s],quickReplyKeywordMatched:[4,o],quickReplyOrigin:[9,lr],quickReplyTranscodeResult:[8,cr]},[1,1,1],"regular"],ReactionActions:[3184,{mediaType:[3,yt],messageType:[1,Ct],reactionAction:[2,ur]},[1,10,20],"regular"],RoomsCreationFlow:[2202,{entryResult:[3,Oe],errorReason:[2,Ye],roomsEntryPoint:[1,pr]},[1,1,1],"regular"],SendRevokeMessage:[1348,{messageMediaType:[2,yt],messageType:[1,Ct],revokeSendDelay:[3,s]},[1,1,1],"regular"],SenderKeyExpired:[3130,{chatType:[1,vt],deviceSizeBucket:[2,mr],expiryReason:[3,We]},[1,1,1],"regular"],SignCredential:[2242,{applicationState:[6,E],overallT:[4,d],projectCode:[7,Vt],retryCount:[2,s],signCredentialResult:[1,hr],signCredentialT:[3,d],waConnectedToChatd:[5,o]},[1,1,1],"regular"],StatusItemView:[1658,{isPosterBiz:[23,o],isPosterInAddressBook:[25,o],mediaType:[4,yt],psaCampaignId:[17,c],psaCampaignItemIndex:[18,s],psaLinkAvailable:[19,o],psaLinkClick:[22,o],psaLinkLoadTime:[21,d],psaLinkOpenResult:[20,Xt],statusItemImpressionCount:[14,s],statusItemIndex:[16,s],statusItemLength:[7,d],statusItemLoadTime:[5,d],statusItemReplied:[8,s],statusItemUnread:[9,o],statusItemViewCount:[10,s],statusItemViewResult:[3,Er],statusItemViewTime:[6,d],statusRowIndex:[2,s],statusRowSection:[11,Tr],statusViewerSessionId:[1,s]},[1,1,1],"regular"],StatusReply:[1180,{isPosterBiz:[4,o],isPosterInAddressBook:[6,o],statusReplyMessageType:[3,Sr],statusReplyResult:[2,vr],statusSessionId:[1,s]},[1,1,1],"regular"],StatusTabOpen:[1172,{psaCampaigns:[5,c],statusAvailableUpdatesCount:[2,s],statusRankT:[3,d],statusSessionId:[1,s],statusTabOpenT:[4,d]},[1,1,1],"regular"],StickerCommonQueryToStaticServer:[2740,{httpResponseCode:[2,s],params:[3,c],queryType:[1,ar]},[1,1,1],"regular"],StickerDailyAggregatedEvent:[2884,{stickerAddToFavoriteCount:[11,s],stickerMakerCreates:[16,s],stickerMakerSends:[17,s],stickerPackDeleteCount:[12,s],stickerPickerOpenedCount:[13,s],stickerSearchOpenedCount:[14,s],stickerSendCount:[1,s],stickerSendCountForward:[6,s],stickerSendCountIsAnimated:[9,s],stickerSendCountIsFirstParty:[8,s],stickerSendCountIsWeb:[10,s],stickerSendCountStickerPickerTabEmotion:[5,s],stickerSendCountStickerPickerTabFavorites:[3,s],stickerSendCountStickerPickerTabPack:[15,s],stickerSendCountStickerPickerTabRecents:[2,s],stickerSendCountStickerSearch:[7,s]},[1,1,1],"regular"],StickerSend:[1840,{stickerIsAnimated:[3,o],stickerIsFirstParty:[2,o],stickerIsFromStickerMaker:[5,o],stickerSendMessageType:[4,Cr],stickerSendOrigin:[1,Ar]},[1,1,1],"regular"],StructuredMessageReceive:[3222,{bizPlatform:[1,O],businessOwnerJid:[2,c],messageClass:[3,br],messageClassAttributes:[4,c],messageMediaType:[5,yt]},[1,1,1],"private",0],TemplateTruncation:[1946,{buttonIndex:[3,s],originalLength:[2,s],templateComponent:[1,Mr]},[1,1,1],"regular"],TestAnonymousDaily:[2328,{},[1,1,1],"private",113760892],TestAnonymousDailyId:[2958,{psTestEnumField:[1,qt],psTestFloatField:[2,l]},[1,1,1],"private",248614979],TestAnonymousIdLess:[3004,{psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",0],TestAnonymousMonthlyId:[2960,{},[1,1,1],"private",191000728],TestAnonymousWeeklyId:[2956,{psTestBooleanField:[2,o],psTestStringField:[3,c],psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",42196056],UiAction:[472,{deviceCount:[5,s],participantCount:[6,s],sizeBucket:[4,mr],uiActionPreloaded:[2,o],uiActionT:[3,d],uiActionType:[1,wr]},[1,1,1],"regular"],UserActivity:[1384,{userActivityBitmapHigh:[4,s],userActivityBitmapLen:[5,s],userActivityBitmapLow:[3,s],userActivitySessionCum:[7,s],userActivitySessionId:[1,c],userActivitySessionSeq:[6,s],userActivityStartTime:[2,s]},[1,1,1],"regular"],UserActivitySessionSummary:[1502,{ipStr:[7,c],userActivityDuration:[2,s],userActivityForeground:[5,s],userActivitySessionsLength:[3,s],userActivityStartTime:[1,s],userActivityTimeChange:[4,s],userSessionSummarySequence:[6,s]},[1,1,1],"regular"],UserNotice:[2472,{userNoticeContentVersion:[2,s],userNoticeEvent:[3,Gr],userNoticeId:[1,s]},[1,1,1],"regular"],UserNoticeError:[2474,{userNoticeContentVersion:[2,s],userNoticeErrorEvent:[3,kr],userNoticeId:[1,s]},[1,1,1],"regular"],ViewBusinessProfile:[1522,{bizFbSize:[9,Or],bizIgSize:[10,Or],businessProfileJid:[3,c],catalogSessionId:[6,c],isProfileLinked:[11,o],isSelfView:[7,o],linkedAccount:[5,x],profileEntryPoint:[8,Ht],scrollDepth:[4,s],viewBusinessProfileAction:[1,Ur],websiteSource:[2,un]},[1,1,1],"regular"],VnameCertHealthEvent:[1890,{vnameCertHealthEventType:[2,Fr]},[1,1,1],"regular"],WaShopsManagement:[2908,{isShopsProductPreviewVisible:[2,o],shopsManagementAction:[1,_r],shopsSellerJid:[3,c]},[1,1,1],"regular"],WamTestAnonymous0:[2240,{testAnonymousChatdConnectivity:[2,o],wamTestAnonymous0Field0:[1,c]},[1,1,1],"private",113760892],WebWamForceFlush:[3264,{},[1,1,1],"regular"],WebcAbpropsValidation:[2802,{abpropName:[1,c],abpropValue:[2,c],serverPropName:[3,c],serverPropValue:[4,c]},[1,1,1],"regular"],WebcAssetLoad:[1358,{webcAssetCacheType:[4,jr],webcAssetFromCache:[2,o],webcAssetLoadT:[3,d],webcAssetName:[1,c],webcAssetSize:[5,l]},[1,1,1],"regular"],WebcChatOpen:[864,{webcChatOpenBeforePaintT:[7,d],webcChatOpenPaintedT:[6,d],webcChatOpenT:[2,d],webcFinalRenderedMessageCount:[5,s],webcRenderedMessageCount:[4,s],webcUnreadCount:[1,l],webcWindowHeightFloat:[8,l]},[1,1,1],"regular"],WebcCpu:[3e3,{cpuSessionSeconds:[2,s],ftsIndexInProgess:[3,o],logInterval:[4,s],percentCpuUsage:[1,s]},[1,1,1],"regular"],WebcDbOpen:[1940,{webcDbName:[1,c],webcDbOpenNumAttempts:[3,s],webcDbOpenWasSuccess:[2,o]},[1,1,1],"regular"],WebcEmojiOpen:[1166,{webcEmojiOpenTab:[1,c]},[1,1,1],"regular"],WebcFingerprint:[1704,{webcCanvasFingerprint:[25,c],webcDocumentDriverEvaluate:[9,o],webcDocumentDriverUnwrapped:[7,o],webcDocumentElementAttrDriver:[14,o],webcDocumentElementAttrSelenium:[12,o],webcDocumentElementAttrWebdriver:[13,o],webcDocumentFxdriverEvaluate:[6,o],webcDocumentFxdriverUnwrapped:[11,o],webcDocumentSeleniumEvaluate:[2,o],webcDocumentSeleniumUnwrapped:[10,o],webcDocumentWebdriverEvaluate:[1,o],webcDocumentWebdriverScriptFn:[5,o],webcDocumentWebdriverScriptFunc:[4,o],webcDocumentWebdriverScriptFunction:[3,o],webcDocumentWebdriverUnwrapped:[8,o],webcWebglFingerprint:[24,c],webcWebglRenderer:[23,c],webcWebglVendor:[22,c],webcWindowSeleniumIdeRecorder:[20,o],webcWindowCallphantom:[18,o],webcWindowCallselenium:[19,o],webcWindowNavigatorWebdriver:[21,dn],webcWindowNightmare:[16,o],webcWindowPhantom:[15,o],webcWindowSelenium:[17,o]},[1,1,1],"regular"],WebcImgError:[1700,{webcImgErrorCode:[1,l]},[1,1,1],"regular"],WebcJobInfo:[3054,{jobName:[1,c],jobPriority:[2,c],jobResultType:[5,Hr],pendingJobsCount:[4,s],scenario:[3,tn],webcJobAddedT:[6,d],webcJobCompletedT:[8,d],webcJobStartedT:[7,d]},[1,1,1],"regular"],WebcLogin:[1664,{webcBrowserNetworkType:[14,c],webcBrowserStorageQuotaBytes:[15,s],webcBrowserStorageQuotaUsedBytes:[16,s],webcLoginT:[3,d],webcPersistentLoginEnabled:[17,o],webcQrCodes:[1,s],webcQrLoadT:[2,d],webcSyncChatCount:[8,s],webcSyncChatSize:[10,s],webcSyncChatT:[9,d],webcSyncContactCount:[11,s],webcSyncContactSize:[13,s],webcSyncContactT:[12,d],webcSyncMessageCount:[5,s],webcSyncMessageSize:[7,s],webcSyncMessageT:[6,d],webcSyncT:[4,d]},[1,1,1],"regular"],WebcMediaAnalyzed:[912,{webcMediaAnalyzeT:[3,d],webcMediaExtensions:[2,c],webcMediaSupported:[1,o]},[1,1,1],"regular"],WebcMediaEditorSend:[2890,{editedImageCount:[2,s],emojiLayerCount:[5,s],imageCount:[1,s],paintedImageCount:[3,s],stickerLayerCount:[6,s],textLayerCount:[4,s]},[1,1,1],"regular"],WebcMediaErrorUnknownDetails:[2352,{mediaId:[1,s],webcMediaErrorName:[3,c],webcMediaOperation:[2,$r]},[1,1,1],"regular"],WebcMediaLoad:[1202,{webcMediaLoadResult:[2,Vr],webcMediaLoadT:[1,d]},[1,1,1],"regular"],WebcMediaRmr:[1906,{messageMediaType:[10,yt],webcBrowserNetworkType:[2,c],webcBrowserStorageQuotaBytes:[11,s],webcBrowserStorageQuotaUsedBytes:[12,s],webcChatPosition:[1,s],webcChatType:[9,Yr],webcMediaRmrError:[8,o],webcMediaRmrT:[6,d],webcMediaSize:[7,s],webcMessageIndex:[3,s],webcMessageT:[5,d],webcRmrReason:[14,en],webcRmrStatusCode:[13,s]},[1,1,1],"regular"],WebcMemoryStat:[1188,{hasVerifiedNumber:[12,o],jsHeapSizeLimit:[9,s],numMessages:[8,l],totalJsHeapSize:[10,s],uptime:[6,l],usedJsHeapSize:[11,s]},[1,1,1],"regular"],WebcMenu:[2504,{webcMenuAction:[2,qr],webcMenuItemLabel:[3,zr]},[1,1,1],"regular"],WebcMessageQuery:[1876,{webcAudioMessageCount:[14,s],webcBrowserNetworkType:[1,c],webcBrowserStorageQuotaBytes:[20,s],webcBrowserStorageQuotaUsedBytes:[21,s],webcChatPosition:[2,s],webcChatType:[13,Yr],webcDocumentMessageCount:[16,s],webcEarliestMessageIndex:[11,s],webcEarliestMessageT:[12,d],webcMessageCount:[4,s],webcMessageQueryTrigger:[19,Zr],webcMessageQueryType:[3,Jr],webcOtherMessageCount:[18,s],webcPhotoMessageCount:[7,s],webcPttMessageCount:[15,s],webcQueryT:[9,d],webcResponseBytes:[10,s],webcStickerMessageCount:[17,s],webcTextMessageCount:[5,s],webcVideoMessageCount:[6,s]},[1,1,1],"regular"],WebcMessageSend:[2072,{messageIsForward:[3,o],messageMediaType:[2,yt],messageSendT:[4,d],messageType:[1,Ct]},[1,1,1],"regular"],WebcOfflineResume:[2628,{chatThreadCount:[9,s],decryptErrorCount:[4,s],isOfflineCompleteMissed:[11,o],offlineMessageCount:[2,s],offlineNotificationCount:[12,s],offlineReceiptCount:[3,s],offlineSizeBytes:[8,s],webcLastStanzaT:[10,d],webcMainScreenLoadT:[7,d],webcOfflinePreviewT:[6,d],webcPageLoadT:[1,d],webcSocketConnectT:[5,d]},[1,1,1],"regular"],WebcPageLoad:[642,{webcAppcacheStatus:[29,Kr],webcCached:[30,o],webcConnectEnd:[10,d],webcConnectStart:[9,d],webcDomComplete:[19,d],webcDomContentLoadedEventEnd:[18,d],webcDomContentLoadedEventStart:[17,d],webcDomInteractive:[16,d],webcDomLoading:[15,d],webcDomainLookupEnd:[8,d],webcDomainLookupStart:[7,d],webcExeDone:[23,d],webcExeStart:[22,d],webcFetchStart:[6,d],webcInitialMountT:[38,d],webcInitialNavMountT:[39,d],webcInitialPanel:[42,c],webcInitialPanelMountStartT:[43,d],webcInitialPanelMountT:[40,d],webcInitialPanelRenderT:[46,d],webcJsLoadT:[37,d],webcLoadEventEnd:[21,d],webcLoadEventStart:[20,d],webcLoadInForeground:[53,o],webcMainScriptEnd:[45,d],webcMainScriptStart:[44,d],webcNativeLoadT:[36,d],webcNavigation:[32,Qr],webcPageLoadT:[34,d],webcParallellyFetched:[41,o],webcQrCode:[31,o],webcRedirectCount:[33,l],webcRedirectEnd:[5,d],webcRedirectStart:[4,d],webcRequestStart:[12,d],webcResponseEnd:[14,d],webcResponseStart:[13,d],webcSecureConnectionStart:[11,d],webcUnloadEventEnd:[3,d],webcUnloadEventStart:[2,d],webcWsAttempts:[28,l],webcWsNormal:[27,d],webcWsOpening:[24,d],webcWsPairing:[25,d],webcWsSyncing:[26,d]},[1,1,1],"regular"],WebcPageResume:[884,{webcResumeCount:[1,s]},[1,1,1],"regular"],WebcPhoneDisconnected:[878,{webcPhoneBbarShownT:[2,d],webcPhoneDisconnectedT:[1,d]},[1,1,1],"regular"],WebcProgressiveImage:[2226,{webcFirstRenderScans:[1,s],webcFirstRenderT:[2,d],webcFullQualityT:[4,d],webcMidQualityT:[3,d]},[1,1,10],"regular"],WebcQplHealth:[3134,{webcQplHealthEventData:[1,c],webcQplHealthEventType:[2,Xr]},[1,1,1],"regular"],WebcRawPlatforms:[2416,{webcRawPlatform:[1,c]},[1,1,1],"regular"],WebcResourceLoad:[688,{webcResourceCached:[3,o],webcResourceDuration:[2,d],webcResourceName:[1,c]},[1,1,1],"regular"],WebcStatusSession:[1880,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSessionId:[1,s],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusSync:[1878,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSyncT:[1,d],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusView:[1882,{webcIsPosterBiz:[11,o],webcIsPostersAddressBook:[12,o],webcStatusLoadT:[6,d],webcStatusLoaded:[4,o],webcStatusMediaType:[5,rn],webcStatusPlaybackT:[8,d],webcStatusReplyCount:[9,s],webcStatusRowIndex:[3,s],webcStatusRowSection:[2,nn],webcStatusSessionId:[1,s],webcStatusUnread:[10,o],webcStatusViewT:[7,d]},[1,1,1],"regular"],WebcStickerMakerEvents:[3104,{stickerMakerEventName:[1,an]},[1,1,1],"regular"],WebcStorageStat:[1504,{webcStorageQuota:[2,s],webcStorageUsage:[1,s]},[1,1,1],"regular"],WebcStreamModeChange:[770,{webcStreamMode:[1,on]},[1,1,1],"regular"],WebcUiFreeze:[1836,{webcUiFreezeFps:[1,l],webcUiFreezeT:[2,d]},[1,1,1],"regular"],WebcWapRequest:[2006,{webcWapRequestAckT:[3,d],webcWapRequestDestination:[6,sn],webcWapRequestKind:[5,ln],webcWapRequestName:[8,c],webcWapRequestRecvT:[4,d],webcWapRequestResponseSize:[2,s],webcWapRequestSize:[7,s],webcWapRequestStatus:[9,s]},[1,1,10],"regular"]});var mn=(0,i.default)((0,i.default)({},a.events),{METRICS:a.metrics,Global:gn,WamEvent:a.WamEvent,PrivateStatsAllIds:[{key:"DefaultPsId",keyHashInt:113760892,rotationPeriodDays:-1},{key:"IdTtl90Days",keyHashInt:37887164,rotationPeriodDays:90},{key:"IdTtlDaily",keyHashInt:248614979,rotationPeriodDays:1},{key:"IdTtlMonthly",keyHashInt:191000728,rotationPeriodDays:30},{key:"IdTtlWeekly",keyHashInt:42196056,rotationPeriodDays:7}],ADV_DECODE_ERROR_TYPE:u,ADV_DECODE_PROTO_TYPE:p,AEC_MODE:f,AGC_MODE:_,ANDROID_CAMERA2_SUPPORT_LEVEL:h,ANDROID_CAMERA_API:g,ANDROID_KEYSTORE_STATE_TYPE:m,APP_BUILD_TYPE:y,APPLICATION_STATE:E,AUDIO_ENGINE_TYPE:S,AUTO_REPLY_ACTION:v,BACKEND_STORE_TYPE:T,BACKUP_NETWORK_SETTING:C,BACKUP_SCHEDULE:A,BANNER_OPERATIONS:b,BANNER_TYPES:P,BIZ_CATALOG_TYPE:M,BIZ_PLATFORM:O,BLOCK_ENTRY_POINT:I,BLOCK_REASON:w,BOOTSTRAP_APP_STATE_DATA_STAGE_CODE:R,BUSINESS_PREVIEW_ACTION_TYPE:D,BUSINESS_PROFILE_ENTRY_POINT:N,BUSINESS_PROFILE_FIELD:L,BUSINESS_PROFILE_VIEW_ACTION:k,BUSINESS_PROFILE_WEBSITE_SOURCE_TYPE:G,BUSINESS_TOOLS_ENTRY_POINT_TYPE:U,BUSINESS_TOOLS_ITEM_TYPE:F,BUSINESS_TOOLS_LINKED_ACCOUNT_TYPE:x,CALL_FROM_UI:B,CALL_NETWORK_MEDIUM:K,CALL_RELAY_BIND_STATUS:j,CALL_RESULT_TYPE:Y,CALL_SEGMENT_TYPE:W,CALL_SETUP_ERROR_TYPE:H,CALL_SIDE:V,CALL_TERM_REASON:$,CALL_TRANSPORT_TYPE:z,CALL_VIDEO_STATE:q,CALL_WAKEUP_SOURCE:J,CAMERA_PREVIEW_MODE:Q,CAMERA_START_MODE_PARAMS:X,CATALOG_BIZ_ACTION:Z,CATALOG_ENTRY_POINT:ee,CATALOG_VIEW_ACTION:te,CATEGORY_TYPE:re,CHAT_COMPOSER_ACTION_TARGETS:ne,CHAT_COMPOSER_ACTION_TYPES:ie,CHAT_FILTER_ACTION_TYPES:ae,CHAT_FILTER_TARGET_SCREEN:oe,CHAT_FILTER_TYPES:se,CHAT_GATED_REASON:le,CHAT_MUTED_TYPE:ce,CHAT_SEARCH_RESULT_TYPE:de,CHAT_TYPE:ue,CLICKABLE_EVENT:pe,CLIENT_GROUP_SIZE_BUCKET:fe,CLIENT_MESSAGE_SEND_STAGE:_e,COLLECTION:he,COMMERCE_ACTION:ge,COMMERCE_ENTRY_POINT:me,COMMERCE_PERF_ENTRY_POINT:ye,COMMERCE_PERF_MARKER:Ee,COMMERCE_PERF_VIEW:Se,CONNECTION_ORIGIN_TYPE:ve,CONNECTION_TYPE:Te,CONTACT_SEND_CHANNEL:Ce,CONTACT_US_EXIT_STATE:Ae,DEEP_LINK_ACTION:be,DEEP_LINK_OPEN_FROM:Pe,DEEP_LINK_TYPE:Me,DESTINATION:Oe,DEVICE_TYPE:Ie,DISAPPEARING_CHAT_INITIATOR_TYPE:we,DISAPPEARING_MODE_ENTRY_POINT_TYPE:Re,DOWNLOAD_ORIGIN_TYPE:De,DOWNLOAD_QUALITY_TYPE:Ne,DSM_ERROR:Le,E2E_CIPHERTEXT_TYPE:ke,E2E_DESTINATION:Ge,E2E_FAILURE_REASON:Ue,E2E_SENDER_TYPE:Fe,E2EE_SIZE_BUCKET:xe,EDIT_PROFILE_ACTION:Be,END_CALL_CONFIRMATION_TYPE:Ke,EPHEMERAL_SETTING_ENTRY_POINT_TYPE:je,ERROR_REASON:Ye,EXPIRY_REASON:We,FIELD_STATS_ROW_TYPE:He,FORCE_UPGRADE_USER_ACTION_TYPE:Ve,GA_STATUS:$e,GIF_SEARCH_PROVIDER:ze,GRAPHQL_CATALOG_ENDPOINT:qe,GRAPHQL_REQUEST_RESULT:Je,INCOMING_CALL_UI_ACTION_TYPE:Qe,INIT_BWE_SOURCE:Xe,INTERACTION_TYPE:Ze,LABEL_OPERATIONS:et,LABEL_TARGETS:tt,LOGIN_RESULT_TYPE:rt,MD_APP_STATE_KEY_ROTATION_REASON_CODE:nt,MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE:it,MD_BOOTSTRAP_PAYLOAD_TYPE:at,MD_BOOTSTRAP_SOURCE:ot,MD_BOOTSTRAP_STEP_RESULT:st,MD_FEATURE_CODE:lt,MD_LINK_DEVICE_COMPANION_STAGE:ct,MD_PUSHNAME_VALIDATION_STAGE_CODE:dt,MD_SYNCD_CRITICAL_EVENT_CODE:ut,MD_SYNCD_FATAL_ERROR_CODE:pt,MD_VALIDATION_CALLER_CHANNEL:ft,MD_VALIDATION_WEB_PLATFORM:_t,MEDIA_DOWNLOAD_MODE_TYPE:ht,MEDIA_DOWNLOAD_RESULT_TYPE:gt,MEDIA_PICKER_ORIGIN_TYPE:mt,MEDIA_TYPE:yt,MEDIA_UPLOAD_MODE_TYPE:Et,MEDIA_UPLOAD_RESULT_TYPE:St,MESSAGE_CHAT_TYPE:vt,MESSAGE_SEND_RESULT_TYPE:Tt,MESSAGE_TYPE:Ct,MISSING_PROTO_TYPE:At,MUTATION_COUNT_BUCKET:bt,NETWORK_STACK_TYPE:Pt,NOTIFICATION_SETTING_TYPE:Mt,NS_MODE:Ot,OPTIMISTIC_FLAG_TYPE:It,OTP_ENTRY_POINT:wt,OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE:Rt,OVERALL_MEDIA_KEY_REUSE_TYPE:Dt,OWNER_TYPE:Nt,PEER_CALL_NETWORK_MEDIUM:Lt,PHONE_NUM_HYPERLINK_ACTION_TYPE:kt,PLACEHOLDER_ACTION:Gt,PLACEHOLDER_CHAT_TYPE:Ut,PLACEHOLDER_TYPE:Ft,PLATFORM_TYPE:xt,PRECISE_SIZE_BUCKET:Bt,PREKEYS_FETCH_CONTEXT:Kt,PRIMARY_IDENTITY_MISSING_PROTO_TYPE:jt,PRIVACY_SETTINGS_CONTACTS_BUCKETS:Yt,PRIVACY_SETTINGS_VALUE_TYPE:Wt,PROFILE_ENTRY_POINT:Ht,PROJECT_CODE:Vt,PS_BUFFER_UPLOAD_RESULT:$t,PS_ID_ACTION:zt,PS_TEST_ENUM_FIELD:qt,PS_TOKEN_NOT_READY_REASON:Jt,PS_UPLOAD_REASON:Qt,PSA_LINK_OPEN_RESULT:Xt,PTT_PLAYBACK_SPEED_TYPE:Zt,PTT_PLAYER_TYPE:er,PTT_RESULT_TYPE:tr,PTT_SOURCE_TYPE:rr,PTT_STREAM_TYPE:nr,PTT_TRIGGER_TYPE:ir,QUERY_TYPE:ar,QUICK_REPLY_ACTION:or,QUICK_REPLY_ENTRY_POINT:sr,QUICK_REPLY_ORIGIN:lr,QUICK_REPLY_TRANSCODE_RESULT:cr,RADIO_TYPE:dr,REACTION_ACTION_TYPE:ur,ROOMS_ENTRY_POINT:pr,SENDER_TYPE:fr,SHOPS_MANAGEMENT_ACTION:_r,SIGN_CREDENTIAL_RESULT:hr,SIGNATURE_TYPE:gr,SIZE_BUCKET:mr,SRTP_LIBRARY_VERSION:yr,STATUS_ITEM_VIEW_RESULT:Er,STATUS_REPLY_MESSAGE_TYPE:Sr,STATUS_REPLY_RESULT:vr,STATUS_ROW_SECTION:Tr,STICKER_SEND_MESSAGE_TYPE:Cr,STICKER_SEND_ORIGIN_TYPE:Ar,STRUCTURED_MESSAGE_CLASS:br,SW_AEC_TYPE:Pr,TEMPLATE_COMPONENT:Mr,TRUST_SIGNAL_BUCKETS:Or,TS_LOG_UPLOAD_RESULT:Ir,UI_ACTION_TYPE:wr,UPLOAD_ORIGIN_TYPE:Rr,UPLOAD_SOURCE_TYPE:Dr,UPNP_ADD_RESULT_CODE:Nr,UPNP_REMOVE_RESULT_CODE:Lr,USER_NOTICE_ERROR_EVENT:kr,USER_NOTICE_EVENT:Gr,VIEW_BUSINESS_PROFILE_ACTION:Ur,VNAME_CERT_HEALTH_EVENT_TYPE:Fr,VPX_LIB:xr,WA_VOIP_HISTORY_SAVE_CALL_RECORD_CONDITION_CHECK_STATUS:Br,WEBC_APPCACHE_STATUS_CODE:Kr,WEBC_ASSET_CACHE_TYPE_CODE:jr,WEBC_CHAT_TYPE:Yr,WEBC_ENV_CODE:Wr,WEBC_JOB_RESULT_TYPE_CODE:Hr,WEBC_MEDIA_LOAD_RESULT_CODE:Vr,WEBC_MEDIA_OPERATION_CODE:$r,WEBC_MENU_ITEM_LABEL:zr,WEBC_MENU_TYPE:qr,WEBC_MESSAGE_QUERY_DIRECTION:Jr,WEBC_NAVIGATION_TYPE:Qr,WEBC_QPL_HEALTH_EVENT_TYPE:Xr,WEBC_QUERY_TRIGGER_TYPE:Zr,WEBC_RMR_REASON_CODE:en,WEBC_SCENARIO_TYPE:tn,WEBC_STATUS_MEDIA_TYPE:rn,WEBC_STATUS_ROW_SECTION:nn,WEBC_STICKER_MAKER_EVENT_NAME_TYPE:an,WEBC_STREAM_MODE_CODE:on,WEBC_WAP_REQUEST_DESTINATION_CODE:sn,WEBC_WAP_REQUEST_KIND_CODE:ln,WEBC_WEB_PLATFORM_TYPE:cn,WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE:dn,WEBSITE_SOURCE_TYPE:un,WELCOME_MESSAGE_ACTION_TYPE:pn,WELCOME_MESSAGE_ERROR_TYPE:fn,XMPP_STATUS:_n,XOR_CIPHER_MODE:hn});t.default=mn},52211:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WamEvent=t.TYPES=t.Metric=t.GlobalMetric=void 0,t.defineEvents=function(e){for(const r in e){var t;const n=e[r],i=n[2];let a=1;a=i[2];const o=null!==(t=n[3])&&void 0!==t?t:"regular",s=5===n.length?n[4]:-1;y({name:r,id:n[0],props:n[1],weight:a,wamChannel:o,privateStatsIdInt:s})}},t.defineGlobal=function(e){const t={};for(const r in e){const n=e[r],[i,a,o=["regular"]]=n,s=_.defineGlobal(r,i,a,o);t[r]={type:s.validator,set(e){this.commitOnSet&&o.includes("regular")&&c.Wam.set(s,e)}}}return new((0,l.defineTypeHash)("Global",t,E))},t.metrics=t.events=void 0;var i=n(r(22205)),a=n(r(11700)),o=n(r(63137)),s=n(r(45095)),l=(r(6604),r(36737)),c=r(77959);const d=Object.freeze({BOOLEAN:"boolean",INTEGER:"integer",NUMBER:"number",STRING:"string",TIMER:"timer"});function u(e){return"number"==typeof e&&e===Math.floor(e)}t.TYPES=d;class p{constructor(e,t,r){this.name=e,this.id=t,this.type=r,this.setValidator()}setValidator(){const e=this.type;if("object"==typeof e){const t=(0,o.default)(e);this.validator=e=>e in t}else e===d.INTEGER||e===d.TIMER?this.validator=u:this.validator=e}}t.Metric=p;class f extends p{constructor(e,t,r,n){super(e,t,r),this.channels=n}}t.GlobalMetric=f;const _=new class{constructor(){this._events={},this._globalMetrics=new Map}_key(e,t){return`${e}::${t}`}getEvent(e,t){const r=this._key(e,t);return(0,s.default)(this._events[r],r)}define(e,t,r,n){const i=this._key(e,t);return i in this._events||(this._events[i]=new p(t,r,n)),this._events[i]}defineGlobal(e,t,r,n){return this._globalMetrics.has(e)||this._globalMetrics.set(e,new f(e,t,r,n)),(0,s.default)(this._globalMetrics.get(e),e)}getGlobal(e){return(0,s.default)(this._globalMetrics.get(e),e)}};t.metrics=_;let h=1;class g extends l.TypeHash{constructor(){super(),this.instanceId=h++,this.eventTime=Date.now(),this.commitTime=void 0,this.startMarkers={}}commit(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c.Wam.commit(this,e)}setTime(e){this.eventTime=e||Date.now()}setSequenceNumber(e){this.sequenceNumber=e}}t.WamEvent=g;const m={};function y(e){let{name:t,id:r,weight:n,props:o,wamChannel:s,privateStatsIdInt:c}=e;const u={id:r,weight:n,wamChannel:s,privateStatsIdInt:c},p={},f=[];for(const e in o){const r=o[e],n=_.define(t,e,r[0],r[1]);p[e]=n.validator,r[1]===d.TIMER&&f.push(e)}const h=(0,l.defineTypeHash)(t,p,g);f.forEach((e=>{u["mark"+(0,a.default)(e)]=function(t){var r,n;const{startMarkers:i,eventTime:a}=this;this[e]=Date.now()-(null!==(r=null===(n=i[e])||void 0===n?void 0:n.ts)&&void 0!==r?r:a),null==t||t.showInTimeline,this.startMark},u[`start${(0,a.default)(e)}`]=function(t){const r=Date.now();this.startMarkers[e]={ts:r},null==t||t.showInTimeline}})),(0,i.default)(h.prototype,u),m[t]=h}t.events=m;class E extends l.TypeHash{constructor(){super(...arguments),this.commitOnSet=!0}}},55843:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMessageCounts=function(e,t){e.webcMessageCount+=t.length;for(let r=0,n=t[r];r<t.length;++r,n=t[r])switch(n.type){case i.MSG_TYPE.CHAT:case i.MSG_TYPE.LOCATION:case i.MSG_TYPE.PAYMENT:case i.MSG_TYPE.VCARD:case i.MSG_TYPE.CIPHERTEXT:case i.MSG_TYPE.MULTI_VCARD:case i.MSG_TYPE.REVOKED:case i.MSG_TYPE.OVERSIZED:e.webcTextMessageCount+=1;break;case i.MSG_TYPE.IMAGE:case i.MSG_TYPE.PRODUCT:e.webcPhotoMessageCount+=1;break;case i.MSG_TYPE.VIDEO:e.webcVideoMessageCount+=1;break;case i.MSG_TYPE.AUDIO:e.webcAudioMessageCount+=1;break;case i.MSG_TYPE.PTT:e.webcPttMessageCount+=1;break;case i.MSG_TYPE.STICKER:e.webcStickerMessageCount+=1;break;case i.MSG_TYPE.DOCUMENT:e.webcDocumentMessageCount+=1;break;default:e.webcOtherMessageCount+=1}},t.newMessageQueryEvent=function(e){return new a.default.WebcMessageQuery({webcResponseBytes:0,webcMessageCount:0,webcTextMessageCount:0,webcVideoMessageCount:0,webcPhotoMessageCount:0,webcAudioMessageCount:0,webcPttMessageCount:0,webcStickerMessageCount:0,webcDocumentMessageCount:0,webcOtherMessageCount:0,webcMessageQueryTrigger:e})};var i=r(15461),a=n(r(11339))},57362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<=33?a.SMALL:e<=65?a.MEDIUM:e<=129?a.LARGE:e<=257?a.EXTRA_LARGE:e<=513?a.XX_LARGE:e<=1001?a.XXX_LARGE:e<=1501?a.LT1500:e<=2001?a.LT2000:e<=2501?a.LT2500:e<=3001?a.LT3000:e<=3501?a.LT3500:e<=4001?a.LT4000:e<=4501?a.LT4500:e<=5001?a.LT5000:a.LARGEST_BUCKET};var i=n(r(11339));const{CLIENT_GROUP_SIZE_BUCKET:a}=i.default},16786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<32?a.LT32:e<64?a.LT64:e<128?a.LT128:e<256?a.LT256:e<512?a.LT512:e<1e3?a.LT1000:e<1500?a.LT1500:e<2e3?a.LT2000:e<2500?a.LT2500:e<3e3?a.LT3000:e<3500?a.LT3500:e<4e3?a.LT4000:e<4500?a.LT4500:e<5e3?a.LT5000:a.LARGEST_BUCKET};var i=n(r(11339));const{SIZE_BUCKET:a}=i.default},97480:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineResumeReporter=void 0;var i=r(92844),a=n(r(11339));const o=new class{constructor(){this.isInitialSync=!1,this.oldestStanzaTs=0,this.offlineResume=new a.default.OfflineResume,this.offlineResume.offlineMessageCount=0,this.offlineResume.offlineReceiptCount=0,this.offlineResume.offlineNotificationCount=0,this.offlineResume.offlineDecryptErrorCount=0,this.offlineResume.offlineSizeBytes=0,this.offlineResume.chatThreadCount=0,this.offlineResume.isOfflineCompleteMissed=!1}roundUp(e,t){return Math.round(e/t)*t}logOldestStanzaTime(e){null!=this.offlineResume&&(0===this.oldestStanzaTs||this.oldestStanzaTs>e)&&(this.oldestStanzaTs=e)}countDays(){if(null==this.offlineResume||0===this.oldestStanzaTs)return 0;const e=(0,i.unixTime)()-this.oldestStanzaTs;return Math.round(e/i.DAY_SECONDS)}logOfflineCount(e){this.offlineResume&&(this.offlineResume.offlineMessageCount+=e.message,this.offlineResume.offlineReceiptCount+=e.receipt,this.offlineResume.offlineNotificationCount+=e.notification)}logOfflineDecryptionErrorCount(e){this.offlineResume&&(this.offlineResume.offlineDecryptErrorCount=e)}logAddOfflineSizeBytes(e){this.offlineResume&&(this.offlineResume.offlineSizeBytes+=e)}logOfflineChatThreadCount(e){const t=this.roundUp(e,10);this.offlineResume&&(this.offlineResume.chatThreadCount=t)}_logPerformanceT(e){const t=Math.floor(performance.now());null!=this.offlineResume&&(this.offlineResume[e]=t)}logLastStanzaT(){this._logPerformanceT("lastStanzaT")}logMainScreenLoadT(){this._logPerformanceT("mainScreenLoadT")}logOfflinePreviewT(){this._logPerformanceT("offlinePreviewT")}logPageLoadT(){this._logPerformanceT("pageLoadT"),window.document&&this.offlineResume&&(this.offlineResume.isResumeInForeground=!document.hidden,document.addEventListener("visibilitychange",this.logResumeInBackground))}logSocketConnectT(){this._logPerformanceT("socketConnectT")}logMissedOfflineComplete(){this.offlineResume&&(this.offlineResume.isOfflineCompleteMissed=!0)}setIsInitialSync(){this.isInitialSync=!0}logResumeInBackground(){this.offlineResume&&document.hidden&&(this.offlineResume.isResumeInForeground=!1)}commit(){const e=this.offlineResume;e&&(e.offlineSizeBytes=this.roundUp(e.offlineSizeBytes,1e3),e.offlineMessageCount=this.roundUp(e.offlineMessageCount,10),e.offlineReceiptCount=this.roundUp(e.offlineReceiptCount,10),e.offlineNotificationCount=this.roundUp(e.offlineNotificationCount,10),e.mailboxAge=this.countDays(),__LOG__(2)`======== offline resume perf ========
message: ${e.offlineMessageCount}
receipt: ${e.offlineReceiptCount}
notification: ${e.offlineNotificationCount}
chatThreadCount: ${e.chatThreadCount}
offlineSizeBytes: ${e.offlineSizeBytes}
decryptError: ${e.offlineDecryptErrorCount}
lastStanzaT: ${e.lastStanzaT}
pageLoadT: ${e.pageLoadT}
connectionT: ${e.socketConnectT}
offlinePreviewT: ${e.offlinePreviewT}
screenLoadT: ${e.mainScreenLoadT}
isResumeInForeground: ${e.isResumeInForeground}
mailboxAge: ${e.mailboxAge}
======================================`,this.isInitialSync||e.commit(),this.offlineResume=null,window.document&&document.removeEventListener("visibilitychange",this.logResumeInBackground))}};t.OfflineResumeReporter=o},71119:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mainScriptTimer=t.initialScreenTimer=t.exeTimer=t.PageLoad=void 0,t.onInitialRenderComplete=function(){f()},t.saveInitialPanelMountTime=function(e){d=e},t.setInitialScreen=function(e){if(null==u)return;u.set({webcInitialPanel:e})},t.streamInfoChange=function(e,t,r){const n=Math.floor(window.performance.now());p[e]=n,r&&(p.socketSequence=t,_())};var i=n(r(45095)),a=n(r(11339)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(6604)),s=n(r(34179)),l=r(77959);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}let d,u=new a.default.WebcPageLoad;const p={};let f,_;const h=new Promise((e=>f=e)),g=new Promise((e=>_=e));let m,y=!1;function E(e){return window.performance&&window.performance.timing&&window.performance.timing.navigationStart?e-window.performance.timing.navigationStart:null}function S(){u&&document.hidden&&(m=!1)}function v(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.navigation)return void __LOG__(2)`MetricReporter:logPageLoad metrics not provided by browser!`;if(!u)return;const t=u,r=window.performance.timing,n=window.performance.navigation,i=r.navigationStart,a=r.loadEventEnd-i;if(a<=0)return __LOG__(2)`MetricReporter:logPageLoad delayed`,void setTimeout(v,1e4);function o(e){const t=r[e];return t&&E(t)}t.set({webcPageLoadT:a,webcUnloadEventStart:o("unloadEventStart"),webcUnloadEventEnd:o("unloadEventEnd"),webcRedirectStart:o("redirectStart"),webcRedirectEnd:o("redirectEnd"),webcFetchStart:o("fetchStart"),webcDomainLookupStart:o("domainLookupStart"),webcDomainLookupEnd:o("domainLookupEnd"),webcConnectStart:o("connectStart"),webcConnectEnd:o("connectEnd"),webcSecureConnectionStart:o("secureConnectionStart"),webcRequestStart:o("requestStart"),webcResponseStart:o("responseStart"),webcResponseEnd:o("responseEnd"),webcDomLoading:o("domLoading"),webcDomInteractive:o("domInteractive"),webcDomContentLoadedEventStart:o("domContentLoadedEventStart"),webcDomContentLoadedEventEnd:o("domContentLoadedEventEnd"),webcDomComplete:o("domComplete"),webcLoadEventStart:o("loadEventStart"),webcLoadEventEnd:o("loadEventEnd"),webcCached:r.fetchStart===r.domainLookupEnd,webcNavigation:n.type,webcRedirectCount:n.redirectCount,webcWsOpening:p.OPENING,webcWsPairing:p.PAIRING,webcWsSyncing:p.SYNCING,webcWsNormal:p.NORMAL,webcWsAttempts:p.socketSequence,webcQrCode:!p.SYNCING,webcInitialPanelMountT:d-i,webcLoadInForeground:m}),t.commit(),window.document&&document.removeEventListener("visibilitychange",S),u=null}window.document&&(m=!document.hidden,document.addEventListener("visibilitychange",S)),Promise.all([h,g]).then((()=>{v(),(0,s.default)(),y||(y=!0,l.Wam.resumeJobs())}));class T{constructor(e){this._hasStarted=!1,this._label=e.label,this._startProperty=e.startProperty,this._endProperty=e.endProperty}start(){this._hasStarted=!0,null!=u&&(u.set({[this._startProperty]:E(Date.now())}),this._measure=o.startMeasure(this._label))}end(){null!=u&&(u.set({[this._endProperty]:E(Date.now())}),(0,i.default)(this._measure,"this._measure").end())}hasStarted(){return this._hasStarted}}const C=new T({label:"PageLoad.webcExe",startProperty:"webcExeStart",endProperty:"webcExeDone"});t.exeTimer=C;const A=new T({label:"PageLoad.webcMainScript",startProperty:"webcMainScriptStart",endProperty:"webcMainScriptEnd"});t.mainScriptTimer=A;const b=new T({label:"PageLoad.webcInitialPanelRender",startProperty:"webcInitialPanelMountStartT",endProperty:"webcInitialPanelRenderT"});t.initialScreenTimer=b;const P=(0,i.default)(u,"_PageLoad");t.PageLoad=P},16860:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.postPrekeysDepletionMetric=function(e){let{count:t,prekeysFetchReason:n,messageType:a,chatId:o}=e;if(null==t||0===t)return;const s={};null!=n&&(s.prekeysFetchReason=n);null!=a&&(s.messageType=a);if(null!=o&&o.isGroup()){const e=r(63928).default.get(o);null!=(null==e?void 0:e.cachedDeviceSizeBucket)&&(s.deviceSizeBucket=e.cachedDeviceSizeBucket)}setTimeout((()=>{for(let e=0;e<t;e++)new i.default.PrekeysDepletion(s).commit()}),0)};var i=n(r(11339))},99039:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.postSenderKeyExpiredMetric=function(e){let{chatId:t,expiryReason:r,deviceCount:n}=e;const s=new a.default.SenderKeyExpired;null!=r&&(s.expiryReason=r);if(null!=t){const e=(0,i.createWidFromWidLike)(t);e.isGroup()?s.chatType=a.default.MESSAGE_CHAT_TYPE.GROUP:e.isBroadcast()?s.chatType=a.default.MESSAGE_CHAT_TYPE.BROADCAST:e.isUser()&&(s.chatType=a.default.MESSAGE_CHAT_TYPE.INDIVIDUAL)}null!=n&&n>0&&(s.deviceSizeBucket=(0,o.default)(n));s.commit()};var i=r(45454),a=n(r(11339)),o=n(r(16786))},29590:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(87614),s=r(57319),l=r(92844),c=n(r(26372));t.Z=class{constructor(e){this.metric=e,this.psIdKeyBySchemaKeyHashInt={},this.psIdSchemaKeyHashIntById={},this.psIdInfoByKey={},e.PrivateStatsAllIds.map((e=>{this.psIdKeyBySchemaKeyHashInt[e.keyHashInt]=e.key,this.psIdSchemaKeyHashIntById[e.key]=e.keyHashInt,this.psIdInfoByKey[e.key]={value:e.keyHashInt,rotationPeriodDays:e.rotationPeriodDays}})),this.psIdKeyBySchemaKeyHashInt[0]="none",this.psIdSchemaKeyHashIntById.none=0,this.psIdInfoByKey.none={value:"none",rotationPeriodDays:-1},this.resolvesOnInit=this.initialize().then((()=>{this.resolvesOnInit=null})),this.rotatePsIdJob=new s.ShiftTimer((()=>{this.rotatePsIds()})),this.rotatePsIdJob.onOrBefore(l.DAY_MILLISECONDS)}initialize(){var e=this;return(0,a.default)((function*(){const t=[],r=yield c.default.getPsMeta(),n=new Set;r.map((r=>{n.add(r.key),void 0===e.psIdInfoByKey[r.key]?t.push(r.key):e.psIdInfoByKey[r.key].value=r.value}));const i=new Date;i.setUTCHours(0,0,0,0);const a=Object.keys(e.psIdInfoByKey).filter((e=>!n.has(e))).map((t=>("none"!==t&&(e.psIdInfoByKey[t].value=(0,o.randomHex)(16)),{key:t,value:e.psIdInfoByKey[t].value,rotateInDays:e.psIdInfoByKey[t].rotationPeriodDays,lastRotationTimeUtc:i.toString()})));yield c.default.addPsMeta(a),yield c.default.removePsMeta(t),a.map((t=>{new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.CREATED,psIdKey:e.psIdSchemaKeyHashIntById[t.key],psIdRotationFrequence:t.rotateInDays}).commit()})),t.map((t=>{new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.DELETED,psIdKey:e.psIdSchemaKeyHashIntById[t],psIdRotationFrequence:e.psIdInfoByKey[t].rotationPeriodDays}).commit()}))}))()}rotatePsIds(){var e=this;return(0,a.default)((function*(){try{const t=yield c.default.getPsMeta(),r=new Date;r.setUTCHours(0,0,0,0);const n=(e,t)=>{if(null==e)return!0;const n=new Date(e);return Math.ceil(Math.abs(r-n)/864e5)>=t};yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){const{key:a,rotateInDays:s,lastRotationTimeUtc:l}=t;if(-1!==s&&(null==l||n(l,s))){const n=(0,o.randomHex)(16);e.psIdInfoByKey[a].value=n,yield c.default.updatePsMeta((0,i.default)((0,i.default)({},t),{},{value:n,lastRotationTimeUtc:r.toString()})),new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.ROTATED,psIdKey:e.psIdSchemaKeyHashIntById[a],psIdRotationFrequence:s}).commit()}}));return function(){return t.apply(this,arguments)}}()))}catch(e){__LOG__(3)`error while rotating PS ids ${e}`}finally{e.rotatePsIdJob.onOrBefore(l.DAY_MILLISECONDS)}}))()}getPrivateStatsKeyFromInt(e){return this.psIdKeyBySchemaKeyHashInt[e]}getLatestPrivateStatsIdValueFromKey(e){if("regular"===e)throw new Error("tried to get psId for regular channel event");return this.psIdInfoByKey[e].value}}},7595:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyPrivateStatsTestEvents=function(){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return;new o.default.TestAnonymousDaily({}).commit(),(0,i.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousWeeklyId({}).commit(),new o.default.TestAnonymousIdLess({}).commit())},t.logUiActionShadowPrivateStatsTestEvents=function(){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return;(0,i.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousDailyId({}).commit(),new o.default.TestAnonymousMonthlyId({}).commit())};var i=r(86945),a=r(7293),o=n(r(11339))},14528:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new class{constructor(){this._resetNextSet=!1,this._value=0}get(){return this._value}_checkReset(){this._resetNextSet&&(this._resetNextSet=!1,this._value=0,this.initialDisplayDate=null)}inc(){return this._checkReset(),this.set(this._value+1)}set(e){if(this._checkReset(),this._value!==e)return 1===e&&(this.initialDisplayDate=Math.floor(window.performance.now())),this._value=e,this.get()}reset(){this._resetNextSet=!0}};t.default=r},34179:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.getEntriesByType)return void __LOG__(2)`MetricReporter:logResourceLoads metrics not provided by browser!`;const t=window.performance.timing.fetchStart===window.performance.timing.domainLookupEnd,r=window.performance.getEntriesByType("resource"),n=document.createElement("a");r.forEach((function(e){"xmlhttprequest"!==e.initiatorType&&(n.href=e.name,new i.default.WebcResourceLoad({webcResourceName:n.pathname+n.search+n.hash,webcResourceDuration:Math.round(e.duration),webcResourceCached:t}).commit())}))};var i=n(r(11339))},36737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHash=void 0,t.defineTypeHash=function(e,t,i){const a={$className:{value:e}};for(const i in t){let o=t[i];if("string"!=typeof o&&"function"!=typeof o||(o={type:o}),!o||"object"!=typeof o)throw new Error(`${e} specified with non-object ${o}`);a[i]={enumerable:!0,get:r(i),set:n(i,o)}}class o extends i{constructor(e){super(),this.all={},e&&this.set(e)}}return Object.defineProperties(o.prototype,a),o};function r(e){return function(){return this.all[e]}}function n(e,t){const r=t.type,n=t.set;return function(t){if(t!==this.all[e]){if(null==t);else if("function"==typeof r){if(!r(t))throw __LOG__(2)`type-validator fails ${t}`,new TypeError(`${this.$className}.${e} type-validator failed`)}else if(typeof t!==r)throw new TypeError(`${this.$className}.${e} requires type ${r}, got ${t}`);n&&n.call(this,t),this.all[e]=t}}}t.TypeHash=class{set(e){for(const t in e)this[t]=e[t]}}},77959:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=void 0,t.injectWamDependencies=function(e){_=e.Browser,g=e.Conn,h=e.CLB,m=e.Metric,S=e.UserPrefs,T=e.WamStorage,y=e.isUserLoggedIn,E=e.uploadStats,v=e.WamContext,O=m.PrivateStatsAllIds.map((e=>e.key)),C=new e.PsIdStore(m),e.CoreWamStorageAdaptor.startWamStore(),A=e.uploadPrivateStats,b=e.setWamBufferSizeUnsafeTestOnly,P=e.setPendingDelayUnsafeTestOnly,(0,u.isConnectedToPage)()&&r(7902);M=new d.ShiftTimer((()=>{!function(){Q.apply(this,arguments)}()}));for(;I.length;){I.pop()()}w=!0};var i=n(r(48926)),a=n(r(66604)),o=n(r(63105)),s=n(r(35161)),l=n(r(45095)),c=r(88156),d=r(57319),u=r(41796),p=r(42448),f=r(55021);let _,h,g,m,y,E,S,v,T,C,A,b,P,M,O=[];const I=[];let w=!1;const R="1";let D=5e4;const N={};let L=0,k=[],G=!1,U=1e4,F=!1,x=null,B=0,K=new c.Resolvable,j=!1,Y=!1;function W(e,t){e.commitTime=null!=t?t:de(),e.sequenceNumber=B++}function H(){return m.APP_BUILD_TYPE.RELEASE}function V(e){if(x&&!e)return;const t=_.info();x={appVersion:"2.2208.7",appBuild:H(),platform:m.PLATFORM_TYPE.WEBCLIENT,appIsBetaRelease:H()===m.APP_BUILD_TYPE.BETA,browser:t.name||null,browserVersion:t.ua||null,deviceName:t.os||null,deviceVersion:t.version||null,webcPhonePlatform:g.platformField||null,webcEnv:m.WEBC_ENV_CODE.PROD,webcTabId:S.thisTabId,webcWebPlatform:m.WEBC_WEB_PLATFORM_TYPE[p.WAM_PLATFORM]},e&&Object.assign(x,e),m.Global.commitOnSet=!1,m.Global.set(x),m.Global.commitOnSet=!0}function $(){return($=(0,i.default)((function*(){(0,f.resetWamProtocolVersion)(5),yield Promise.all(Object.keys(N).map(function(){var e=(0,i.default)((function*(e){var t;const r=null===(t=N[e])||void 0===t?void 0:t.unsavedPortion;if(r)try{const e=yield T.getNextSequenceNumberForStream(R);r.upgradeWamHeaderFromV3ToV5(e)}catch(e){}}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return k.push(e),G?t?(j=!1,Y=!0,setTimeout((()=>M.forceRunNow()),1)):M.onOrBefore(U):t&&(M.cancel(),j=!0,Y=!1),K.promise}function q(){G=!1,M.cancel();const e=K;return K=new c.Resolvable,e}function J(){G=!0,Y=!1,k.length>0&&M.onOrBefore(U),j&&(j=!1,Y=!0,M.forceRunNow())}function Q(){return(Q=(0,i.default)((function*(){const e=Y,t=q(),r=[...k];k=[];try{V(),yield C.resolvesOnInit||Promise.resolve(),yield Promise.all(["regular","none",...O].map((t=>ne(t,r,e))))}finally{t.resolve(),J()}}))).apply(this,arguments)}function X(e){return"regular"===e?"regular":"private"}function Z(){return ee.apply(this,arguments)}function ee(){return(ee=(0,i.default)((function*(e){return new v(e,yield T.getNextSequenceNumberForStream(R),C,x)}))).apply(this,arguments)}function te(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(e){var t;const r=null!==(t=N[e])&&void 0!==t?t:yield Z(e);return N[e]=r,r}))).apply(this,arguments)}function ne(){return ie.apply(this,arguments)}function ie(){return(ie=(0,i.default)((function*(e,t,r){const n=X(e);if((0,f.getWamProtocolVersion)()<5&&"private"===n)return;let i;try{i=yield te(e)}catch(e){return void __LOG__(3)`wam:_executePendingForContext failed to get context ${String((null==e?void 0:e.stack)?e.stack:e)}`}try{for(let r=0;r<t.length;r++){const a=t[r],[o,...s]=a;if(o){const t=s[0];("regular"===t.wamChannel&&t.wamChannel===n||"private"===t.wamChannel&&e===C.getPrivateStatsKeyFromInt(t.privateStatsIdInt))&&i.write(t)}else{const[e,t]=s;e.channels.includes(n)&&(x[e.name]=t,i.set(e.id,t))}}const a=de();if(i.eventsWritten>0&&(r||i.size()>D||a>L+300||!F)){if(!y())return void(i.buffer.size()>D?N[e]=null:yield ae(e));yield se(e)}else yield ae(e)}catch(t){__LOG__(3)`wam:_executePending error ${String((null==t?void 0:t.stack)?t.stack:t)}`,h.upload({reason:"wam-error"}),N[e]=null}}))).apply(this,arguments)}function ae(){return oe.apply(this,arguments)}function oe(){return(oe=(0,i.default)((function*(e){if(!N[e])return;const t=N[e].stringBuffer();if(!t)return;const r=(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion;if(r&&0===r.eventsWritten)return;const n=(0,l.default)(N[e],"contexts[bufferKey]").saveKey;try{if(r){const r=yield T.update(n,e,t);if(!N[e])return;r?(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion=yield Z(e):(N[e]=N[e].unsavedPortion,yield ae(e))}else{if(yield T.add(n,e,t),!N[e])return;(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion=yield Z(e)}}catch(e){__LOG__(3)`wam:save WamStorage failed to save ${String(e)}`}}))).apply(this,arguments)}function se(){return le.apply(this,arguments)}function le(){return(le=(0,i.default)((function*(e){let t;try{t=yield T.deleteAll(e)}catch(e){t={},__LOG__(3)`wam:sendAllLogs failed to read because ${String(e)}`}const r=t;if(N[e]){N[e].unsavedPortion&&!(N[e].saveKey in r)&&(N[e]=N[e].unsavedPortion);const t=(0,l.default)(N[e],"contexts[bufferKey]").saveKey;r[t]=(0,l.default)(N[e],"contexts[bufferKey]").stringBuffer()}const n=yield Promise.all((0,s.default)(r,((t,r)=>ce(t,r,X(e))))),a=(0,o.default)(n);if(a.length!==n.length&&(L=de(),F=!0),N[e]&&!a.includes(N[e].saveKey)&&(N[e]=null),0===a.length)return;const c=a.reduce((function(e,t){return e+r[t].length}),0);c<D?yield Promise.all((0,s.default)(a,function(){var t=(0,i.default)((function*(t){try{yield T.add(t,e,r[t])}catch(e){__LOG__(3)`sendAllLogs: adding to WamStorage failed`}}));return function(){return t.apply(this,arguments)}}())):(N[e]=null,__LOG__(3)`wam dropped ${a.length} buffers! (${c} bytes)`)}))).apply(this,arguments)}function ce(e,t,r){return""===e||"["===e[0]?Promise.resolve():"private"===r?A(e,t):"regular"===r?E(e,t):Promise.resolve()}function de(){return Math.floor(Date.now()/1e3)}const ue=(0,a.default)({commit:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null!=e.commitTime&&0!==e.commitTime?(__LOG__(3)`wam:commit redundant commit! ${e.$className}`,Promise.resolve()):0!==e.weight&&Math.random()*e.weight>1?(e.commitTime=de(),Promise.resolve()):(W(e),z([!0,e],t))},set:function(e,t){return z([!1,e,t])},resumeJobs:J,initialize:V,upgradeWamRuntime:function(){return $.apply(this,arguments)}},(function(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(w)return e(...r);I.push((()=>{e(...r)}))}}));t.Wam=ue},75838:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStore=function(){(0,l.closeWamStorage)()},t.privateStatsKillSwitchGetBlockedToken=p,t.privateStatsKillSwitchSet=f,t.savePrivateStatsToken=u,t.startWamStore=function(){(0,l.startWamStorage)(_)};var i=n(r(81109)),a=n(r(48926)),o=r(40265),s=r(92844),l=r(11562),c=r(99234),d=n(r(26372));function u(e){return d.default.savePsToken({key:"token",token:e,creationTs:(0,s.unixTime)(),redeemCount:1})}function p(){return Promise.resolve((0,c.getPsKillSwitchToken)())}function f(e){return(0,c.setPsKillSwitchToken)(e),Promise.resolve()}const _={getStreamId:()=>1,saveBuffer:()=>Promise.reject(new o.UnimplementedMethod("saveBuffer not implemented yet")),finishBuffer:()=>Promise.reject(new o.UnimplementedMethod("finishBuffer not implemented yet")),getStartingSequenceRow:()=>Promise.reject(new o.UnimplementedMethod("getStartingSequenceRow not implemented yet")),getBuffers:()=>Promise.reject(new o.UnimplementedMethod("getBuffers not implemented yet")),removeBufferByKey:()=>Promise.resolve(),nukeMetrics:()=>Promise.reject(new o.UnimplementedMethod("nukeMetrics not implemented yet")),updatePrivateStatsIds:()=>Promise.reject(new o.UnimplementedMethod("updatePrivateStatsIds not implemented yet")),redeemPrivateStatsToken:function(){var e=(0,a.default)((function*(e){const t=yield d.default.getPsToken();return t?e({redeemCount:t.redeemCount,creationTs:t.creationTs},{maxExpirySeconds:86400})?d.default.savePsToken((0,i.default)((0,i.default)({},t),{},{redeemCount:t.redeemCount+1})).then((()=>t.token)):Promise.resolve(null):null}));return function(){return e.apply(this,arguments)}}(),savePrivateStatsToken:u,privateStatsKillSwitchGetBlockedToken:p,privateStatsKillSwitchSet:f}},42448:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WAM_PLATFORM=void 0;t.WAM_PLATFORM="WEB"},55021:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWamProtocolVersion=function(){return r},t.resetWamProtocolVersion=function(e){r=e};let r=3},26372:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(19197));t.default=class{static add(e,t,r){return(0,i.default)((function*(){return(yield a.default.idb()).wam.add({key:e,buffer:r,channel:t},e).catch((e=>{__LOG__(2)`add failed: ${e}\n${null==e?void 0:e.stack}`}))}))()}static update(e,t,r){return(0,i.default)((function*(){let n=0;try{n=yield a.default.idb().then((n=>n.wam.update(e,{key:e,buffer:r,channel:t})))}catch(e){__LOG__(2)`update failed: ${e}\n${null==e?void 0:e.stack}`}return 0!==n}))()}static deleteAll(e){return(0,i.default)((function*(){const t={};try{yield a.default.idb().then((r=>r.wam.where("channel").equals(e).modify((function(e){t[e.key]=e.buffer,delete this.value}))))}catch(e){__LOG__(2)`deleteAll failed: ${e}\n${null==e?void 0:e.stack}`}return t}))()}static getNextSequenceNumberForStream(e){return(0,i.default)((function*(){let t=-1;try{const r=yield a.default.idb();yield r.transaction("rw",["wam_meta"],(0,i.default)((function*(){0===(yield r.wam_meta.where("streamId").equals(e).count())?(yield r.wam_meta.add({streamId:e,seqNum:1}),t=1):yield r.wam_meta.where("streamId").equals(e).modify((function(e){return t=e.seqNum+1,t>=65536&&(t=1),e.seqNum=t,e}))})))}catch(e){__LOG__(2)`getNextSequenceNumberForStream failed: ${e}\n${null==e?void 0:e.stack}`}if(-1===t)throw new Error(`could not get seq number for streamId ${e}`);return t}))()}static removePsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkDelete(e))).catch((e=>{__LOG__(2)`removePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsMeta(){return a.default.idb().then((e=>e.ps_meta.toArray())).catch((e=>(__LOG__(2)`getPsMeta failed: ${e}\n${null==e?void 0:e.stack}`,[])))}static addPsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkPut(e))).catch((e=>{__LOG__(2)`addPsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static updatePsMeta(e){return a.default.idb().then((t=>t.ps_meta.update(e.key,e))).catch((e=>{__LOG__(2)`updatePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsToken(){return a.default.idb().then((e=>e.ps_tokens.get("token"))).catch((e=>{__LOG__(2)`getPsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}static savePsToken(e){return a.default.idb().then((t=>t.transaction("rw",["ps_tokens"],(()=>t.ps_tokens.put(e))))).catch((e=>{__LOG__(2)`savePsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}}},15772:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.forceFlushAllWamBuffers=function(){return(new i.default.WebWamForceFlush).commit(!0)};var i=n(r(11339))},15078:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));var a=new class{constructor(){this._events=new Map}logSend(e){const t=e.tag;if(t)try{const r=e.getName(),n=r.startsWith("query")?i.default.WEBC_WAP_REQUEST_KIND_CODE.GET:i.default.WEBC_WAP_REQUEST_KIND_CODE.SET,a=e.isToPhone?i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.PHONE:i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,o=e.data.byteLength||JSON.stringify(e.data).length;this._createEvent(t,{kind:n,destination:a,name:r,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log send`}}logBasicSend(e,t){if(e)try{const r=i.default.WEBC_WAP_REQUEST_KIND_CODE.GET,n=i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,a=t[1].toLowerCase(),o=JSON.stringify(t).length;this._createEvent(e,{kind:r,destination:n,name:a,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log basic send`}}logAck(e){if(!e)return;const t=this._events.get(e);t&&t.markWebcWapRequestAckT({showInTimeline:!1})}logRecv(e,t,r){if(!e)return;const n=this._events.get(e);n&&(n.webcWapRequestResponseSize=t,null!=r&&(n.webcWapRequestStatus=r),n.markWebcWapRequestRecvT({showInTimeline:!1}),n.commit(),this._events.delete(e))}delete(e){e&&this._events.delete(e)}clear(){this._events.clear()}_createEvent(e,t){const r=new i.default.WebcWapRequest({webcWapRequestKind:t.kind,webcWapRequestDestination:t.destination,webcWapRequestName:t.name,webcWapRequestSize:t.size});this._events.set(e,r)}};t.default=a},81663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatJidToChatWid=function(e){return(0,i.toChatWid)((0,i.createWid)(e))},t.deviceJidToDeviceWid=function(e){return(0,i.createDeviceWid)(e)},t.deviceJidToUserWid=function(e){return(0,i.toUserWid)((0,i.createWid)(e))},t.groupJidToWid=function(e){return(0,i.createWid)(e)},t.jidWithTypeToWid=function(e){const t=(0,n.extractJidFromJidWithType)(e);return(0,i.createWid)(t)},t.userJidToUserWid=function(e){return(0,i.createUserWid)(e)};var n=r(72441),i=r(45454)},89867:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(52230),i=r(31515);const a=/(?:^([^.:@]+))(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(s\.whatsapp\.net|c\.us|g\.us|broadcast|call|b\.whatsapp\.net)$/i,o=/^([1-9][0-9]{0,14})(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(lid)$/,s="16505361212@c.us",l=["name","short","notify"];class c{constructor(e,t){var r;let{intentionallyUsePrivateConstructor:n}=t;if(!n)throw new Error("You should use WidFactory.createWid() instead of the Wid constructor. If you absolutely must use the constructor, pass {intentionallyUsePrivateConstructor: true} as a second parameter.");const i=null!==(r=e.match(a))&&void 0!==r?r:e.match(o);if(null==i)throw new Error(`wid error: invalid wid: ${e}`);const s=[],l=i[1],c=i[2],d=i[3],u=i[4].toLowerCase();let p;switch(u){case"s.whatsapp.net":p="c.us";break;default:p=u}if(this.server=p,this.user=l,s.push(this.user),null!=c&&""!==c){if("c.us"!==this.server)throw new Error(`wid error: wrong server for wid with agent present: ${e}`);const t=parseInt(c,10);if(isNaN(t))throw new Error(`wid error: NaN agent: ${c} wid: ${e}`);if(t>255)throw new Error(`wid error: agent>255 : ${t} wid: ${e}`);t&&(s.push("."),s.push(t),this.agent=t)}if(d){if("c.us"!==this.server&&"lid"!==this.server)throw new Error(`wid error: wrong server for wid with device present: ${e}`);const t=parseInt(d,10);if(isNaN(t))throw new Error(`wid error: NaN device: ${d} wid: ${e}`);if(t>255)throw new Error(`wid error: device>255 : ${t} wid: ${e}`);t&&(s.push(":"),s.push(t),this.device=t)}s.push("@"),s.push(this.server),this._serialized=s.join("")}getUserPartForLog(){if(this.isGroup()){const e=this.user.split("-");if(2===e.length){const[t,r]=e;return`${t.slice(-4)}-${r}`}}return this.user.slice(-4)}toString(e){if(e){let t,r;const n=e.legacy&&"c.us"===this.server?"s.whatsapp.net":this.server;e.formatFull?(t=`.${this.agent||0}`,r=`:${this.device||0}`):(t=null!=this.agent&&0!==this.agent?`.${this.agent}`:"",r=null!=this.device&&0!==this.device?`:${this.device}`:"");const i=e.forLog?this.getUserPartForLog():this.user;if(e.formatFull||e.legacy&&"c.us"===this.server||e.forLog)return[i,t,r,"@",n].join("")}return this._serialized}toLogString(){return this.toString({forLog:!0,legacy:!1})}toJid(){return this.toString({legacy:!0})}getSignalAddress(){const e=null!=this.agent&&0!==this.agent?`_${this.agent}`:"",t=null!=this.device&&0!==this.device?`:${this.device}`:"";return[this.user,e,t].join("")}getDeviceId(){const e=this.device;return null==e?0:e}equals(e){return e instanceof c&&this.toString()===e.toString()}isLessThan(e){return e instanceof c&&this.toString()<e.toString()}isGreaterThan(e){return e instanceof c&&this.toString()>e.toString()}isCompanion(){return null!=this.device&&this.device!==n.DEFAULT_DEVICE_ID}isUser(){return"c.us"===this.server||"lid"===this.server}isUserNotPSA(){return this.isUser()&&!this.isPSA()}isBroadcast(){return"broadcast"===this.server}isOfficialBizAccount(){return this.toString()===s}isGroup(){return"g.us"===this.server}isGroupCall(){return"call"===this.server}isServer(){return"server"===this.user.toLowerCase()&&"c.us"===this.server}isPSA(){return"0"===this.user&&"c.us"===this.server}isStatusV3(){return"status"===this.user.toLowerCase()&&"broadcast"===this.server}toJSON(){return this.toString()}static isXWid(e,t){return(0,i.isString)(t)?t.split("@")[1]===e:t instanceof c?t.server===e:(void 0!==t&&__LOG__(2)`wid:isXWid called on nonstring: + ${String(t)}`,!1)}static isUser(e){return c.isXWid("c.us",e)||c.isXWid("lid",e)}static isBroadcast(e){return c.isXWid("broadcast",e)}static isGroup(e){return c.isXWid("g.us",e)}static isGroupCall(e){return c.isXWid("call",e)}static isWid(e){return(0,i.isString)(e)?a.test(e)||o.test(e):e instanceof c}static canBeWid(e){return!e||!l.includes(e)}static isServer(e){return(0,i.isString)(e)?"server@c.us"===e.toLowerCase():e instanceof c&&e.isServer()}static isPSA(e){return(0,i.isString)(e)?"0@c.us"===e.toLowerCase():e instanceof c&&e.isPSA()}static isStatusV3(e){return(0,i.isString)(e)?e.toLowerCase()===n.STATUS_JID:e instanceof c&&e.isStatusV3()}static isOfficialBizAccount(e){return(0,i.isString)(e)?e.toLowerCase()===s:e instanceof c&&e.isOfficialBizAccount()}static user(e){return(0,i.isString)(e)?e.split("@")[0]:e instanceof c?e.user:void 0}static equals(e,t){return e instanceof c||t instanceof c?e instanceof c&&e.equals(t):e===t}static isLessThan(e,t){return e instanceof c&&t instanceof c&&e.toString()<t.toString()}static isGreaterThan(e,t){return e instanceof c&&t instanceof c&&e.toString()>t.toString()}}t.default=c},45454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceWid=l,t.createDeviceWidFromUserAndDevice=function(e,t){return l(`${e}:${t}@c.us`)},t.createUserWid=c,t.createWid=s,t.createWidFromWidLike=function(e){return s("string"==typeof e?e:e._serialized)},t.isWidlike=function(e){return!!e&&(!!i.default.isWid(e)||!(!e||"object"!=typeof e||!i.default.isWid(e._serialized)))},t.toChatWid=function(e){if(e.isUser())return d(e);return e},t.toUserWid=d;var i=n(r(89867)),a=r(31515),o=n(r(19037));function s(e){let t;return(null===o.default||void 0===o.default?void 0:o.default.cache)?(t=o.default.cache[e],t||(t=new i.default(e,{intentionallyUsePrivateConstructor:!0}),o.default.cache[e]=t)):t=new i.default(e,{intentionallyUsePrivateConstructor:!0}),t}function l(e){return s(e)}function c(e,t){let r;if(r=(0,a.isString)(e)&&(e.endsWith("@c.us")||e.endsWith("@s.whatsapp.net")||e.endsWith("@lid"))?e:`${e}@${t||"c.us"}`,r=s(r),!(null!=r.device&&0!==r.device||null!=r.agent&&0!==r.agent))return r;throw __LOG__(4,void 0,new Error)`createUserWid: ${e} is not a valid user jid`,new Error("createUserWid is called with invalid user string")}function d(e){if(!e.isUser())throw new Error("asUserWid: wid is not a user wid");return null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent?c(e.user,e.server):e}},79196:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.widToDeviceJid=function(e){const t=i(e);if("phoneDevice"===t.jidType||"lidDevice"===t.jidType)return t.deviceJid;if("phoneUser"===t.jidType)return(0,n.defaultDeviceJidForUser)(t.userJid);if("lidUser"===t.jidType)return(0,n.defaultLidDeviceJidForLidUserJid)(t.userJid);throw __LOG__(4,void 0,new Error)`widToDeviceJid: "${e.toString()}" is not a DeviceJid`,new Error("widToDeviceJid: can not convert wid to DeviceJid")},t.widToJidWithType=i;var n=r(72441);function i(e){const t=e.toJid(),r=(0,n.interpretAndValidateJid)(t);if("unknown"===r.jidType)throw __LOG__(4,void 0,new Error)`widToJidWithType: "${t}" is not a valid jid`,new Error("widToJidWithType: unknown jid type");return r}},47685:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateWid=function(e){if(null==e)return!1;const t=e.match(/(.*)@(.*)/);if(null==t)return"call"===e||"s.whatsapp.net"===e;const r=t[1],i=n.cast(t[2]);if(null==i)return __LOG__(3)`Domain not supported`,!1;switch(i){case n.BROADCAST:return d.test(r);case n.CALL:return l.test(r);case n.G_US:return c.test(r);case n.C_US:case n.S_WHATSAPP_NET:return u.test(r);case n.LID:return p.test(r);case n.MSGR:return f.test(r)}return!1};const n=r(76672)({BROADCAST:"broadcast",CALL:"call",C_US:"c.us",G_US:"g.us",LID:"lid",MSGR:"msgr",S_WHATSAPP_NET:"s.whatsapp.net"}),i=/[0-9]{1,2}/,a=/0/,o=/[1-9][0-9]{0,19}/,s=/(?!10)[1-9][0-9]{4,19}/,l=/^[0-9a-f]{18,32}$/i,c=new RegExp(`^${s.source}[-]${/[1-9][0-9]{9}/.source}$|^${o.source}$`),d=new RegExp(`^${o.source}$|${["status","location"].map((e=>"^"+e+"$")).join("|")}`,"i"),u=new RegExp(`^0$|^${s.source}([.]${a.source})?([:]${i.source})?$`),p=new RegExp(`^${/[1-9][0-9]{0,14}/.source}([.]${a.source})?([:]${i.source})?$`),f=new RegExp(`^${o.source}([:]${/[1-9][0-9]{0,2}/.source})?$`)},94300:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.App=function(){return(0,ve.jsx)(Re,{})},t.AppWrapper=void 0,t.hasPending=function(){return null!=Ae&&Ae.hasPending()},t.stopCommsBeforeUnload=function(){(0,T.stopComms)()};var i=n(r(48926)),a=n(r(51463)),o=n(r(45095)),s=r(38284),l=r(57319),c=(n(r(64369)),n(r(94184))),d=r(48360),u=n(r(41143)),p=n(r(30381)),f=r(67294),_=n(r(15421)),h=r(88711),g=n(r(6357)),m=(n(r(85954)),r(89721)),y=n(r(66034)),E=n(r(89248)),S=r(22683),v=r(88102),T=r(24747),C=n(r(52665)),A=n(r(8623)),b=r(17239),P=r(40249),M=n(r(19197)),O=n(r(94049)),I=r(78359),w=r(96384),R=r(24113),D=n(r(13259)),N=r(99234),L=r(7293),k=r(57701),G=r(29424),U=n(r(63824)),F=n(r(43725)),x=r(84387),B=r(70818),K=n(r(7260)),j=r(83578),Y=r(46582),W=n(r(30071)),H=n(r(11339)),V=r(66776),$=n(r(96753)),z=r(97480),q=r(71119),J=r(7111),Q=r(48694),X=r(77113),Z=n(r(43951)),ee=n(r(22028)),te=r(27838),re=r(64551),ne=n(r(31703)),ie=n(r(57050)),ae=n(r(37538)),oe=r(23283),se=r(8080),le=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=Te(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(12209)),ce=n(r(3137)),de=r(97628),ue=r(93373),pe=n(r(99736)),fe=r(65127),_e=r(18644),he=r(19518),ge=r(29898),me=r(2541),ye=n(r(49036)),Ee=r(78123),Se=r(65044);r(38125);var ve=r(85893);function Te(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Te=function(e){return e?r:t})(e)}Se.Socket.registerHandler((e=>{(0,Y.requireHandleSocketMessage)().then((t=>t(e)))}));const Ce=r(76672).Mirrored(["CLIENT_EXPIRED_DIALOG","ANOTHER_SESSION","UNSUPPORTED_TAKEOVER","QR","SYNCING","OFFLINE","PROXYBLOCK","CONFLICT","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION","MAIN","STARTUP","TEMP_BAN","LOGOUT","PRIMARY_FORCE_UPGRADE"]);let Ae,be=!1,Pe=!1;function Me(e){"initialPanelMountTRecorded"===e&&(be=!0),"initialPanelRenderTRecorded"===e&&(Pe=!0),be&&Pe&&(0,q.onInitialRenderComplete)()}const Oe=(0,a.default)((()=>{(0,q.saveInitialPanelMountTime)(Date.now()),Me("initialPanelMountTRecorded")}));function Ie(e){let{cmdAndData:t,isExternal:r,sessionId:n}=e;const{resultType:i,data:a}=t;return __LOG__(2)`main:execApiCmd:${i}`,(0,u.default)(null!=Ae,"Attempted to exec API command before main was loaded"),Ae.execApiCmd({cmd:i,untypedData:a,isExternal:r,sessionId:n})}class we extends f.Component{constructor(){super(...arguments),this.contextMenuRef=(0,f.createRef)(),this.animate=!0,this.state={mode:se.Stream.mode,updating:se.Stream.clientExpired,hardExpired:se.Stream.hardExpired,anotherSession:!1,takingOver:!1,isUnsupportedTakeover:!1,apiCmd:void 0,locale:F.default.getLocale(),mainLoaded:!1,socketProgressStep:0,theme:(0,de.getTheme)(),systemThemeMode:(0,de.getSystemThemeMode)(),isKeyboardUser:!1,initialLoadReady:!1,startLogout:!1,stayInSync:!Se.Socket.hasSynced,primaryForceUpgrade:Q.PrimaryForceUpgrade.shouldForceUpgrade},this._unsetIsKeyboardUser=()=>{this.setState({isKeyboardUser:!1})},this._setIsKeyboardUser=()=>{this.setState({isKeyboardUser:!0})},this._handlers={up:this._setIsKeyboardUser,down:this._setIsKeyboardUser,left:this._setIsKeyboardUser,right:this._setIsKeyboardUser,home:this._setIsKeyboardUser,end:this._setIsKeyboardUser,"command+up":this._setIsKeyboardUser,"command+down":this._setIsKeyboardUser,pageUp:this._setIsKeyboardUser,pageDown:this._setIsKeyboardUser,tab:this._setIsKeyboardUser,"shift+tab":this._setIsKeyboardUser,"shift+?":this._setIsKeyboardUser},this._setWamSystemInfo=null,this._setModeScheduler=new l.ShiftTimer((e=>{e!==this.state.mode&&this.setState({mode:e})})),this._handleStreamModeChange=()=>{const e=se.Stream.mode;this.state.mode!==se.StreamMode.MAIN?this._setModeScheduler.onOrBefore(0,e):this._setModeScheduler.forceRunNow(e)},this._handleClientExpired=()=>{this.state.updating!==se.Stream.clientExpired&&this.setState({updating:se.Stream.clientExpired})},this._handleHardExpired=()=>{this.setState({hardExpired:se.Stream.hardExpired})},this._handleMouseDown=e=>{0!==e.detail&&this._unsetIsKeyboardUser(),v.Cmd.windowMouseDown(e)},this._handleClick=e=>{v.Cmd.windowClick(e)},this._handleWindowClick=e=>{var t;const r=e.target;if(!r)return;if("A"!==r.nodeName)return;const n=r.getAttribute("href");if(!n)return;if(null===(t=r.dataset)||void 0===t?void 0:t.nohandle)return;const i=(0,J.parseAPICmd)(n);if("INVALID"===i.resultType)return;const a=this._getDeeplinkSessionId();this._canExecApiCmd()&&Ie({cmdAndData:i,isExternal:!0,sessionId:a})&&(L.GK.supportsFeature(L.GK.F.MD_BACKEND)&&this._logDeepLinkClickMetric(i,a),e.preventDefault())},this._logDeepLinkClickMetric=(e,t)=>{if(e.resultType===h.APICmd.GROUP_INVITE)new H.default.DeepLinkClick({deepLinkHasPhoneNumber:!1,deepLinkHasText:!0}).commit();else if(e.resultType===h.APICmd.MSG_SEND){const r=e.data.phone,n=e.data.text;new H.default.DeepLinkClick({deepLinkHasPhoneNumber:!!r,deepLinkHasText:!!n,deepLinkSessionId:t}).commit()}else(e.resultType===h.APICmd.CATALOG||e.resultType===h.APICmd.PRODUCT)&&new H.default.DeepLinkClick({deepLinkHasPhoneNumber:!0,deepLinkHasText:!1}).commit()},this._handleSetTheme=e=>{if(this.state.theme!==e){for(const t of de.THEME_ASSETS[e])m.AssetLoader.loadAsset(t,m.LOAD_PRIORITY.THEME_ASSET_LOAD,!1);if(re.ServerProps.wallpapersV2){const e=y.default.get("defaultPreference");if(e&&Ee.DEFAULT_CHAT_WALLPAPER!==e.wallpaperColor){const t=(0,Ee.toggleWallpaperColor)(e.wallpaperColor,this.state.theme);e.set("wallpaperColor",t)}}(0,de.setTheme)(e),this.setState({theme:e})}},this._handleSetSystemThemeMode=e=>{(0,de.setSystemThemeMode)(e),this.setState({systemThemeMode:e})},this._mdReloadPageOnTakeOver=()=>{__LOG__(2)`[md takeover] refreshing page on takeover`,window.location.reload()},this._handleReadyForMainScreen=()=>{__LOG__(2)`DebouncedLoadingScreen: Ready for main screen`,this.setState({stayInSync:!1})},this._mdReloadPageWithUnsupportedTakeOver=()=>{__LOG__(2)`[unsupported takeover] refreshing page with unsupported takeover`,window.location.reload()},this._getThemeContextValue=(0,W.default)((e=>{let{theme:t,systemThemeMode:r}=e;return{theme:t,setTheme:this._handleSetTheme,systemThemeMode:r,setSystemThemeMode:this._handleSetSystemThemeMode}}))}componentDidMount(){!0===(0,N.mdOptedIn)()&&(L.GK.setFeature(L.GK.F.MD_BACKEND,!0),L.GK.setFeature(L.GK.F.MD_ADV,!0),L.GK.setFeature(L.GK.F.MD_VOIP_GROUP,!1));const{theme:e}=this.state;(0,de.applyThemeToUI)(e),Le().then((t=>{m.AssetLoader.setPlatform(t),m.AssetLoader.loadInitialAssets(de.THEME_ASSETS[e])})),function(){return De.apply(this,arguments)}().then(X.loadProtoVersions).then((()=>{v.Cmd.mainLoaded(),this.setState({mainLoaded:!0})})).then((()=>Promise.all([(0,Y.requireEmojiAssetMapCreator)(),(0,Y.requireEmojiConfig)(),Le()]))).then((e=>{let[t,r,n]=e;m.AssetLoader.setPlatform(n),m.AssetLoader.initEmojiAsset(t(r)),I.emojiCompletionTracker.beginPreloadFallback()}));const{listeners:t}=this.props;t.add(v.Cmd,"increment_progress",(()=>{this._incProgress()})),t.add(v.Cmd,"initial_load_ready",(()=>{this.setState({initialLoadReady:!0})})),t.add(oe.StorageCmd,"storage_not_enough_space",(()=>{v.Cmd.openModal((0,ve.jsx)(C.default,{onOK:()=>{Se.Socket.logout(!1,j.LogoutReason.StorageQuotaExceeded)},okText:d.fbt._("OK",null,{hk:"2KEeHb"}),children:d.fbt._("Your computer does not have enough space for WhatsApp to run. Please create more storage by deleting unused files from your computer, then log in again.",null,{hk:"3tBII8"})}))})),t.add(v.Cmd,"account_temporarily_banned",(e=>{this.setState({temporaryBan:e})})),t.add(v.Cmd,"starting_logout",(()=>{this.setState({startLogout:!0})})),t.add(Q.PrimaryForceUpgrade,"change:shouldForceUpgrade",(()=>{const e=Q.PrimaryForceUpgrade.shouldForceUpgrade;this.state.primaryForceUpgrade!==e&&this.setState({primaryForceUpgrade:e})})),L.GK.supportsFeature(L.GK.F.MD_BACKEND)&&z.OfflineResumeReporter.logPageLoadT();{const e=r(63064).Z;t.add(window,"beforeunload",e.unloadMutex.bind(e)),t.add(window,"unload",e.unloadMutex.bind(e)),t.add(window,"storage",(t=>{e.storagePong(t)&&(L.GK.supportsFeature(L.GK.F.MD_BACKEND)&&(__LOG__(2)`[md takeover] tab taken over. stopping comms`,(0,T.stopComms)()),B.Logger.onTakeOver(),this.setState({takingOver:!1,anotherSession:!0}))}))}if(t.add(se.Stream,"change:clientExpired",this._handleClientExpired),t.add(se.Stream,"change:hardExpired",this._handleHardExpired),t.add(se.Stream,"change:mode",this._handleStreamModeChange),me.URL.canMuckHistory()){const e=(0,J.parseAPICmd)(window.location.href);if(e.resultType!==h.APICmd.INVALID){const{url:t}=e.data;delete e.data.url,this._maybeExecApiCmd(e),window.history.replaceState({},"",t)}}var n;t.add(F.default,"locale_change",(e=>{let{loc:t}=e;__LOG__(2)`App:componentDidMount:rerenderUI locale change`,(0,N.setLangPref)(t),L.GK.supportsFeature(L.GK.F.MD_BACKEND)&&S.Clock.setIs24HourBasedOnLocale(),this.animate=!1,this.setState({locale:`${F.default.getLocale()}#${p.default.locale()}`})})),this._registerYesterdayTimer(),__LOG__(2)`App:componentDidMount:visibilityState: ${document.visibilityState}`,"prerender"===document.visibilityState?(0,s.promiseTimeout)((0,ye.default)(document,"visibilitychange"),5e3).then((()=>this._beginMutex(0))).catch((()=>this._beginMutex(0))):this._beginMutex(0),this.props.listeners.add(window,"click",this._handleWindowClick,{capture:!0}),this.props.listeners.add(window,"blur",(()=>{this._unsetIsKeyboardUser()})),he.updatePoll.poll(he.checkForUpdates),this._logFirstRenderMountTime(),document.createElement=(n=document.createElement.bind(document),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("iframe"===e.toLowerCase()){__LOG__(3)`Modified a created iframe element to include sandbox attributes for security fix.`;const r=n(e,t);return r.sandbox=re.ServerProps.webYouTubePlayerEnhancements||re.ServerProps.webPipRedesign?"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox":"allow-scripts allow-same-origin",r}return n(e,t)}),this.props.listeners.add(ce.default,"system_theme_change",(e=>{this.state.systemThemeMode&&this._handleSetTheme(e)}))}componentDidUpdate(e,t){!0===t.anotherSession&&!1===this.state.anotherSession?M.default.openDB().catch((e=>{__LOG__(3)`Failed to open indexeddb: ${e}`})):!1===t.anotherSession&&!0===this.state.anotherSession&&M.default.idb().then((e=>{e.close(),__LOG__(2)`db: closed due to take over`})).catch((()=>{})),this._maybeExecApiCmd(this.state.apiCmd),this.state.mode!==se.StreamMode.MAIN&&(this.animate=!0),this._logFirstRenderMountTime()}componentWillUnmount(){this._setModeScheduler.cancel(),this._setWamSystemInfo&&this._setWamSystemInfo.cancel()}_beginMutex(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){if(fe.UA.isLocalStorageBroken&&L.GK.supportsFeature(L.GK.F.MD_BACKEND)){if(yield(0,te.isAnotherTabActive)()){B.Logger.onTakeOver(),t.setState({isUnsupportedTakeover:!0});try{(0,T.stopComms)()}catch(e){}return}}(0,te.setTabActive)(),n&&ge.Updater.shouldForceUpdateOnTakeOver()&&ge.Updater.restart();{const i=r(63064).Z,a=n?i.takeoverLocal(e):i.init(e),o=yield a.catch((e=>(t.setState({takingOver:!0}),t._beginMutex(e,!0))));B.Logger.isTakeOver=o,t.setState({takingOver:!1,anotherSession:o})}}))()}_incProgress(){this.setState({socketProgressStep:this.state.socketProgressStep+1})}_maybeExecApiCmd(e){if(e){if(this._canExecApiCmd()){return Ie({cmdAndData:e,isExternal:!0,sessionId:this._getDeeplinkSessionId()}),void(null!=this.state.apiCmd&&this.setState({apiCmd:null}))}e!==this.state.apiCmd&&this.setState({apiCmd:e})}}_canExecApiCmd(){return null!=Ae&&Ne(this.state)===Ce.MAIN}_logFirstRenderMountTime(){this.state.mode!==se.StreamMode.SYNCING&&Oe()}_calculateProgress(){return 20*this.state.socketProgressStep}_registerYesterdayTimer(){_.default.setLocalTimeout((()=>{__LOG__(2)`App:registerYesterdayTimer:rerenderUI relative timestamps`,__LOG__(2)`Local Clock: ${Date.now()}, Skew: ${S.Clock.getSkew()}`,v.Cmd.midnight(),this._registerYesterdayTimer()}),(0,p.default)().endOf("day").valueOf())}_getTemporaryBanReason(e){const t=(0,N.getMaybeMeUser)().user;switch(e){case 101:return F.default.t(781,{phone:t});case 102:return d.fbt._("You're temporarily banned from WhatsApp because too many people blocked you.",null,{hk:"3HhQ7n"});case 103:return F.default.t(782,{phone:t});case 104:return d.fbt._("You're temporarily banned from WhatsApp because you sent the same message to too many people.",null,{hk:"2r9Adr"});case 106:return d.fbt._("You're temporarily banned from WhatsApp because you sent too many messages to a broadcast list.",null,{hk:"3QZzJ1"});default:return d.fbt._("You're temporarily banned from WhatsApp because you may have violated our terms of service.",null,{hk:"1d1rXh"})}}_getUiAndIconCount(){switch(Ne(this.state)){case Ce.CLIENT_EXPIRED_DIALOG:return{ui:(0,ve.jsx)(R.DefaultFavicon,{children:(0,ve.jsx)(E.default,{})}),requiresBackendCheck:!1};case Ce.ANOTHER_SESSION:{let e,t;return this.state.takingOver?(e=()=>{},t=F.default.t(357)):(e=()=>{L.GK.supportsFeature(L.GK.F.MD_BACKEND)?this._mdReloadPageOnTakeOver():this._beginMutex(0,!0)},t=F.default.t(253)),{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(A.default,{cancelText:d.fbt._("Close",null,{hk:"19Jpec"}),onCancel:window.open.bind(window,"https://www.whatsapp.com/","_self"),okText:t,onOK:e,children:F.default.t(1036)})}),requiresBackendCheck:!1}}case Ce.UNSUPPORTED_TAKEOVER:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(A.default,{okText:d.fbt._("Refresh",null,{hk:"3gD6Jh"}),onOK:this._mdReloadPageWithUnsupportedTakeOver,children:d.fbt._("There is already another active WhatsApp Web tab in this browser. WhatsApp Web does not support multiple active tabs in this browser. Please use the existing tab or close it and refresh this tab.",null,{hk:"xnVvw"})})}),requiresBackendCheck:!1};case Ce.TEMP_BAN:const{code:e,expire:t}=this.state.temporaryBan||{},r=this._getTemporaryBanReason(e),n=p.default.duration(t,"seconds").humanize();return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsxs)(A.default,{cancelText:F.default.t(603),onCancel:()=>{__LOG__(2)`Banned accounts: user selected logout`,Se.Socket.logout()},okText:d.fbt._("Learn more",null,{hk:"1L9NkE"}),onOK:window.open.bind(window,(0,w.getFaqUrl)()),children:[(0,ve.jsx)("div",{children:r}),(0,ve.jsx)("div",{children:F.default.t(780,{duration:n})})]})}),requiresBackendCheck:!0};case Ce.QR:return{ui:(0,ve.jsxs)(R.DefaultFavicon,{children:[(0,ve.jsx)(V.ModalManager,{type:V.ModalType},"modal-manager"),(0,ve.jsx)(ee.default,{apiCmd:this.state.apiCmd},"qr-code")]}),extraClasses:g.default.isQR,requiresBackendCheck:!0};case Ce.STARTUP:case Ce.SYNCING:if(L.GK.supportsFeature(L.GK.F.MD_BACKEND)){let e=(0,ve.jsx)(ae.default,{initialLoadReady:this.state.initialLoadReady,onReady:this._handleReadyForMainScreen});return{ui:(0,ve.jsx)(R.DefaultFavicon,{children:e}),requiresBackendCheck:!0}}return{ui:(0,ve.jsx)(R.DefaultFavicon,{children:(0,ve.jsx)(ie.default,{progress:this._calculateProgress()})}),requiresBackendCheck:!0};case Ce.OFFLINE:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)($.default,{})}),requiresBackendCheck:!0};case Ce.PROXYBLOCK:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(Z.default,{})}),requiresBackendCheck:!0};case Ce.CONFLICT:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(A.default,{cancelText:F.default.t(603),onCancel:()=>Se.Socket.logout(),okText:F.default.t(253),onOK:()=>Se.Socket.takeover(),children:F.default.t(703)})}),requiresBackendCheck:!0};case Ce.TOS_BLOCK:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(pe.default,{description:d.fbt._('WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have. If you have accepted the Terms and Privacy Policy, click "LOG IN" to continue using WhatsApp.',null,{hk:"4uxe2b"})})}),requiresBackendCheck:!0};case Ce.SMB_TOS_BLOCK:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(pe.default,{description:d.fbt._('We are updating our WhatsApp Business Terms of Service. Agree to our new Terms on your phone to continue using WhatsApp Business. If you have accepted the Terms of Service, click "LOG IN" to continue using WhatsApp Business.',null,{hk:"3Ti2sa"}),children:(0,ve.jsx)(ne.default,{})})}),requiresBackendCheck:!0};case Ce.DEPRECATED_VERSION:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(O.default,{})}),requiresBackendCheck:!0};case Ce.LOGOUT:return{ui:(0,ve.jsxs)(R.DefaultFavicon,{children:[(0,ve.jsx)(V.ModalManager,{type:V.ModalType},"modal-manager"),(0,ve.jsx)(K.default,{},"logout")]}),requiresBackendCheck:!0};case Ce.PRIMARY_FORCE_UPGRADE:return{ui:(0,ve.jsx)(R.ErrorFavicon,{children:(0,ve.jsx)(D.default,{})}),requiresBackendCheck:!0};case Ce.MAIN:const{MainComponent:i}=(0,o.default)(Ae,"Main");return{ui:[(0,ve.jsx)(ue.ToastManager,{},"toast-manager"),(0,ve.jsx)(V.ModalManager,{contextMenuRef:this.contextMenuRef,type:V.ModalType},"main-modal-manager"),(0,ve.jsx)(V.ModalManager,{type:V.MediaType},"media-modal-manager"),(0,ve.jsx)(P.ContextMenuManager,{ref:this.contextMenuRef,type:P.Type.MENU},"context-menu-manager"),(0,ve.jsx)(P.ContextMenuManager,{type:P.Type.TOOLTIP},"tooltip-manager"),(0,ve.jsx)(I.InitialEmojisCompletionContext.Provider,{value:I.emojiCompletionTracker,children:(0,ve.jsx)(i,{conn:b.Conn,animate:this.animate})},"main")],extraClasses:g.default.isMain,requiresBackendCheck:!0}}}_getDeeplinkSessionId(){return(0,k.smbClickToChatLoggingEnabled)()?Math.floor(2147483648*Math.random()).toString():void 0}render(){!function(e){if(q.initialScreenTimer.hasStarted())return;const t=Ne(e);if(!function(e){return e!==Ce.SYNCING}(t))return;(0,q.setInitialScreen)(t),q.initialScreenTimer.start(),window.requestAnimationFrame((()=>{q.initialScreenTimer.end(),Me("initialPanelRenderTRecorded")}))}(this.state);const{isKeyboardUser:e}=this.state,{ui:t,extraClasses:r,requiresBackendCheck:n}=this._getUiAndIconCount(),i=(0,c.default)(g.default.wrapper,r,{"app-wrapper-native":le.isNative,"app-wrapper-web":le.isWeb,"safari-fix":le.hasSafariFix,"edge-fix":le.hasEdgeFix,"font-fix":le.hasFontFix,"os-ltr":le.isOSLTR,"os-rtl":le.isOSRTL,"os-mac":le.isOSMac,"os-win":le.isOSWin,"keyboard-user":e});n&&null!=Ae&&!(0,N.knowsPhone)()&&Ae.notificationBackend.shutdownAsNeeded();const a=Ne(this.state),o=a===Ce.STARTUP||a===Ce.SYNCING?"loading-screen":this.state.locale;return(0,ve.jsx)(de.ThemeContext.Provider,{value:this._getThemeContextValue({theme:this.state.theme,systemThemeMode:this.state.systemThemeMode}),children:(0,ve.jsx)(U.default.Provider,{value:e,children:(0,ve.jsx)(_e.UIE,{displayName:"App",uimState:_e.UIE.State.INACTIVE,children:(0,ve.jsxs)(G.HotKeys,{handlers:this._handlers,className:i,tabIndex:null,onMouseDownCapture:this._handleMouseDown,onClickCapture:this._handleClick,children:[undefined,undefined,t]},o)})})})}}we.displayName="AppImpl";const Re=(0,x.ListenerHOC)(we);function De(){return(De=(0,i.default)((function*(){const[e,t]=yield Promise.all([(0,Y.requireMain)(),Le()]);q.mainScriptTimer.start(),Ae=e(t),q.mainScriptTimer.end()}))).apply(this,arguments)}function Ne(e){const{anotherSession:t,isUnsupportedTakeover:r,updating:n,hardExpired:i,mainLoaded:a,mode:o}=e;if(L.GK.supportsFeature(L.GK.F.MD_BACKEND)){var s;if(null===(s=e.temporaryBan)||void 0===s?void 0:s.banned)return Ce.TEMP_BAN;if(e.startLogout)return Ce.LOGOUT}if(n||i)return Ce.CLIENT_EXPIRED_DIALOG;if(r)return Ce.UNSUPPORTED_TAKEOVER;if(t)return Ce.ANOTHER_SESSION;switch(o){case se.StreamMode.QR:return Ce.QR;case se.StreamMode.SYNCING:return Ce.SYNCING;case se.StreamMode.OFFLINE:return Ce.OFFLINE;case se.StreamMode.PROXYBLOCK:return Ce.PROXYBLOCK;case se.StreamMode.CONFLICT:return Ce.CONFLICT;case se.StreamMode.TOS_BLOCK:return Ce.TOS_BLOCK;case se.StreamMode.SMB_TOS_BLOCK:return Ce.SMB_TOS_BLOCK;case se.StreamMode.DEPRECATED_VERSION:return Ce.DEPRECATED_VERSION;case se.StreamMode.MAIN:if(!a)return Ce.STARTUP;if(L.GK.supportsFeature(L.GK.F.MD_BACKEND)){if(e.stayInSync)return Ce.SYNCING;if(e.primaryForceUpgrade)return Ce.PRIMARY_FORCE_UPGRADE}return Ce.MAIN}throw new Error(`app:render Error invalid StreamMode: ${o}`)}function Le(){return b.Conn.platform?Promise.resolve(b.Conn.platform):new Promise((e=>{const t=()=>{const{platform:r}=b.Conn;null!=r&&(b.Conn.off("change:platform",t),e(r))};b.Conn.on("change:platform",t)}))}t.AppWrapper=Re},50669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t,r){this.retryCount=0,this.asset=e,this.resolution=t,this.priority=r}getLoadUrlPromise(){return this._loadUrlPromise}setLoadUrlPromise(e,t){this._loadUrlPromise=e,this._loadUrlAbortController=t}abortLoadUrlPromise(){var e;null===(e=this._loadUrlAbortController)||void 0===e||e.abort()}getConsumerPromise(){return this._consumerPromise}setConsumerPromise(e){this._consumerPromise=e}getConsumerPromiseResolve(){return this._consumerPromiseResolve}setConsumerPromiseResolve(e,t){this._consumerPromiseResolve=e,this._consumerAbortController=t}abortConsumerPromise(){var e;null===(e=this._consumerAbortController)||void 0===e||e.abort()}}},95480:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!r(92658).default.supported)return;const t=!0===e.estimateStorage,n=r(25613).default,o=r(64237).default,p=navigator.serviceWorker;(0,a.detectWebpSupport)().then((t=>{const r=(0,i.default)(e.keep,(e=>[e[s.default.RES.LOW],e[s.default.RES.HIGH]])).map((e=>{var r;const n=null===(r=e[t&&e[u]?u:d])||void 0===r?void 0:r.split("/");return null!=n?n[n.length-1]:null}));(null==p?void 0:p.controller)&&n.request(p.controller,o.CLEAN_ASSETS,r).catch((()=>{}))})).then((()=>t?(0,l.default)():null)).then((e=>{e&&new c.default.WebcStorageStat({webcStorageUsage:e.usage,webcStorageQuota:e.quota}).commit()}))};var i=n(r(94654)),a=r(61498),o=n(r(41143)),s=n(r(3309)),l=n(r(96222)),c=n(r(11339));(0,o.default)(!0,"service worker builds only");const d="default",u="webp"},14315:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.emojiAssetMapCreator=function(e){return t=>d(t,e)},t.getEmojiTypeFromPlatform=u;var i=n(r(52628)),a=n(r(44908)),o=n(r(88306)),s=r(17239),l=r(25647),c=r(80439);const d=(0,o.default)(((e,t)=>{const r=new Map,n=u(e),o=t[n],s=o.SELECTOR,d=Math.ceil((0,a.default)((0,i.default)(o.UNICODE_TO_EMOJI)).length/l.BUCKET_SIZE);for(let e=0;e<d;e+=1){const t=`emoji-${s}-b${e}`,i=40;r.set(t,{id:t,selectors:[`.emoji.${s}.b${e}`,`.emojik.${s}.b${e}`],low:{default:(0,c.getEmojiSpritesPath)(n,e,40,"png"),webp:(0,c.getEmojiSpritesPath)(n,e,i,"webp")},high:{default:(0,c.getEmojiSpritesPath)(n,e,64,"png"),webp:(0,c.getEmojiSpritesPath)(n,e,64,"webp")}})}return r}));function u(e){switch(e){case s.PLATFORMS.IPHONE:case s.PLATFORMS.SMBI:case s.PLATFORMS.IPAD:case s.PLATFORMS.IPOD:return l.EMOJI_TYPE.APPLE;default:return l.EMOJI_TYPE.WHATSAPP}}},78359:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emojiCompletionTracker=t.InitialEmojisCompletionContext=t.EmojiCompletionTracker=void 0;var n=r(89721),i=r(67294);class a{constructor(){var e=this;this._loadingEmojisCount=0,this._hasTriggeredEmojiPreload=!1,this._firstRun=!1,this.beginPreload=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e._hasTriggeredEmojiPreload||(e._hasTriggeredEmojiPreload=!0,window.setTimeout((()=>{n.AssetLoader.loadEmojis()}),t?1e3:0))},this.beginPreloadFallback=()=>{window.setTimeout((()=>{this.beginPreload(!1)}),5e3)},this.incrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._firstRun||(this._firstRun=!0,this._firstRunTiming=performance.now()),this._loadingEmojisCount+=1)},this.decrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._loadingEmojisCount-=1,0===this._loadingEmojisCount&&this._firstRun&&(this.beginPreload(!0),__LOG__(2)`EmojiCompletionTracker:firstScreenEmojis complete in ${Math.ceil(performance.now()-this._firstRunTiming)} ms`))}}}t.EmojiCompletionTracker=a;const o=new a;t.emojiCompletionTracker=o;const s=(0,i.createContext)(o);t.InitialEmojisCompletionContext=s},89721:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_PRIORITY=t.AssetLoaderImpl=t.AssetLoaderClass=t.AssetLoader=void 0;var a=i(r(48926)),o=i(r(52628)),s=i(r(18446)),l=r(89385),c=i(r(45095)),d=i(r(9006)),u=i(r(41143)),p=i(r(50669)),f=i(r(3309)),_=i(r(75538)),h=r(70449),g=r(14315),m=r(25647),y=r(7087),E=i(r(11339)),S=i(r(84644)),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=C(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),T=i(r(95480));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(C=function(e){return e?r:t})(e)}const A={INITIAL_EMOJI_LOAD:1,INITIAL_ASSET_LOAD:2,THEME_ASSET_LOAD:2,HELP_ANIMATED_DOODLE:2,LAZY_LOAD_EMOJI:2,NOTIFICATION_ICON:2};t.LOAD_PRIORITY=A;class b{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;this._assetStyle=new _.default("asset-style"),this._requestedAssets={},this._loadingDataMap={},this._getEmojiForPlatform=null,this._currentResolution=f.default.currentRes,this._currentlyLoadingCount=0,this._queue=new d.default((e=>-e.priority)),this._hasLoggedDecrementBelowZero=!1,this._handleDpiChange=()=>{const e=f.default.currentRes,t=this._currentResolution;e!==t&&(this._currentResolution=e,Object.keys(this._requestedAssets).forEach((e=>{this._cancelLoad(e,t)})),this._loadAssets((0,o.default)(this._requestedAssets),A.INITIAL_EMOJI_LOAD,{forceCheck:!1}).catch((0,l.catchAbort)((()=>{}))))},this._maxConcurrentRequests=e,window.addEventListener("dpichange",this._handleDpiChange)}initEmojiAsset(e){this._getEmojiForPlatform=e}loadInitialAssets(e){const t=new E.default.WebcAssetLoad({webcAssetName:"initial-assets",webcAssetFromCache:!1,webcAssetCacheType:E.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(e,A.INITIAL_ASSET_LOAD,{estimateStorage:!0}).then((()=>{t.markWebcAssetLoadT(),t.commit();const e=t.webcAssetLoadT;__LOG__(2)`AssetLoader:loadInitialAssets complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadInitialAssets cancelled by more recent request.`})))}loadEmoji(e,t){if(this._getEmojiForPlatform&&this._currentPlatform){const r=this._getEmojiForPlatform(this._currentPlatform),n=h.EmojiUtil.getBucket(e),i=this._getEmojiPrefix(),a=r.get(`${i}b${n}`),o=this._currentResolution;return a?this.loadAsset(a,t,!1).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader: loadEmoji Cancelled by more recent request: ${a.id}-${o}`}))):Promise.reject(new Error("The given emoji glyph id was not found"))}return Promise.reject(new Error("emojiForPlatform or currentPlatform are not set"))}loadEmojis(){const e=(0,c.default)(this._currentPlatform,"this._currentPlatform");(0,u.default)(null!=this._getEmojiForPlatform,"Emojis were loaded before initializing the emoji assets!");const t=Array.from(this._getEmojiForPlatform(e).values()),r=new E.default.WebcAssetLoad({webcAssetName:"emojis",webcAssetFromCache:!1,webcAssetCacheType:E.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(t,A.INITIAL_EMOJI_LOAD,{estimateStorage:!0}).then((()=>{r.markWebcAssetLoadT(),r.commit();const e=r.webcAssetLoadT;__LOG__(2)`AssetLoader:loadEmojis complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadEmojis cancelled by more recent request.`})))}loadAsset(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{id:i}=e,a=f.default.currentRes,o=this._requestedAssets[i];if(o&&!(0,s.default)(e,o))return Promise.reject(new Error(["Attempted to load an asset using an already used ID"].join("\n")));this._requestedAssets[i]=e,this._loadingDataMap[i]=this._loadingDataMap[i]||{};const c="high"===a?"low":"high";this._cancelLoad(i,c);const d=this._loadingDataMap[i][a];if(d&&!r)return d.promise;const u=new p.default(e,a,t),_=new n,{signal:h}=_,g=this._buildPromise(u,_).then((t=>{if(h.aborted)throw new l.AbortError;const{selectors:r}=e;return r&&this._assetStyle.setRule(`${r.join(", ")}`,{"background-image":`url('${t}')`}),t})).catch((e=>{const t=this._loadingDataMap[i][a],r=m!==t;if(r||(this._loadingDataMap[i][a]=null),e.name===l.ABORT_ERROR&&(__LOG__(2)`Asset load cancelled by more recent request: ${i}-${a}`,r&&t))return t.promise;throw e}));u.setConsumerPromise(g);const m={promise:g,abort:e=>{this._abortUrlPromise(u,e)}};return this._loadingDataMap[i][a]=m,d&&d.abort(!1),this._startLoad(),g}_buildPromise(e,t){const r=new Promise((r=>{e.setConsumerPromiseResolve(r,t),this._queue.push(e)}));return(0,S.default)(r,t.signal)}_startLoad(){if(!(this._currentlyLoadingCount>=this._maxConcurrentRequests))for(let e=0;e<this._maxConcurrentRequests-this._currentlyLoadingCount;e++){const e=this._queue.pull();if(!e)return;this._currentlyLoadingCount+=1,(0,y.loadUrl)(e).then((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()})).catch((0,l.catchAbort)((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()}))).catch((t=>{this._decrementCurrentlyLoadingCount(),e.retryCount+=1;const r=v.expBackoff(e.retryCount,12e4,1e3,.1);setTimeout((()=>{this._queue.push(e),this._startLoad()}),r),this._startLoad(),(0,y.getSupportedImageFormatUrl)(e).then((e=>{const r=e.split("/");__LOG__(3)`Asset: ${r[r.length-1]} failed. Retrying... ${t.toString()}`}))}))}}_abortUrlPromise(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.getLoadUrlPromise()){e.abortLoadUrlPromise();const r=e.getConsumerPromise();t&&r&&e.abortConsumerPromise()}this._startLoad()}_cancelLoad(e,t){var r;const n=null===(r=this._loadingDataMap[e])||void 0===r?void 0:r[t];n&&(this._loadingDataMap[e][t]=null,n.abort(!0))}setPlatform(e){if(e===this._currentPlatform)return;this._currentPlatform=e;const t=((0,g.getEmojiTypeFromPlatform)(e)===m.EMOJI_TYPE.APPLE?m.EMOJI_TYPE.WHATSAPP:m.EMOJI_TYPE.APPLE)===m.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-";if(Object.keys(this._requestedAssets).forEach((e=>{e.startsWith(t)&&(this._cancelLoad(e,"high"),this._cancelLoad(e,"low"))})),null==this._getEmojiForPlatform)return;const r=Array.from(this._getEmojiForPlatform(e).values());this._loadAssets(r,A.INITIAL_EMOJI_LOAD,{forceCheck:!1})}_getEmojiPrefix(){return(0,g.getEmojiTypeFromPlatform)(this._currentPlatform)===m.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-"}_loadAssets(e,t,r){var n=this;return(0,a.default)((function*(){const i=!1!==(null==r?void 0:r.forceCheck),a=!0===(null==r?void 0:r.estimateStorage),s=yield Promise.all(e.map((e=>n.loadAsset(e,t,i))));return(0,T.default)({keep:(0,o.default)(n._requestedAssets),estimateStorage:a}),s}))()}_decrementCurrentlyLoadingCount(){this._currentlyLoadingCount<=0&&!this._hasLoggedDecrementBelowZero&&(this._hasLoggedDecrementBelowZero=!0,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Tried to decrease _loadingCount below zero, would have been negative.")),this._currentlyLoadingCount=Math.max(0,this._currentlyLoadingCount-1)}}t.AssetLoaderImpl=b;const P=new b;t.AssetLoader=P;const M=b;t.AssetLoaderClass=M},7087:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LoadUrlError=void 0,t.getSupportedImageFormatUrl=_,t.loadUrl=function(e){const t=new n,r=_(e).then(function(){var r=(0,a.default)((function*(r){yield d.default.waitIfOffline({signal:t.signal});const n=Date.now(),i=yield(0,c.extendedFetch)(r,{signal:t.signal}),a=e.getConsumerPromiseResolve();if(!i.ok||!a)throw new f(r,i.status,Date.now()-n);a(r)}));return function(){return r.apply(this,arguments)}}());return e.setLoadUrlPromise(r,t),r};var a=i(r(48926)),o=r(40265),s=i(r(45095)),l=r(61498),c=r(61181),d=i(r(57220));const u="default",p="webp";class f extends((0,o.customError)("LoadUrlError")){constructor(e,t,r){super(`Failed to load url. StatusCode: ${t}. Duration: ${r} ms`),this.url=e,this.statusCode=t}}function _(){return h.apply(this,arguments)}function h(){return(h=(0,a.default)((function*(e){const t=yield(0,l.detectWebpSupport)(),{asset:r,resolution:n}=e,i=t&&r[n][p]?p:u;return(0,s.default)(r[n][i],"asset[resolution][format]")}))).apply(this,arguments)}t.LoadUrlError=f},64481:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_LIST_ITEM_HEIGHT=t.MAX_REPLY_PRODUCT_TITLE_LENGTH=t.MAX_REPLY_PRODUCT_DESC_LENGTH=void 0;t.PRODUCT_LIST_ITEM_HEIGHT=96;t.MAX_REPLY_PRODUCT_TITLE_LENGTH=40;t.MAX_REPLY_PRODUCT_DESC_LENGTH=95},29821:(e,t,r)=>{"use strict";var n=r(95318)(r(48926)),i=r(85893);function a(){return(a=(0,n.default)((function*(){window.Promise=r(74121).Z;const{setupLodashMemoizeCache:e}=r(70634);e(),window.__LOG__=r(70818).log,window.SEND_LOGS=r(85965).sendLogs,window.onerror=r(58955).HC,window.onunhandledrejection=r(58955).TG;const t=r(92417).default;self.URL=self.URL||self.webkitURL,self.AudioContext=self.AudioContext||self.webkitAudioContext,self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem,r(64369).default;const{KEYS:a}=r(72407),{UA:o}=r(65127),s="1"===(null==t?void 0:t.getItem(a.LOGOUT_DIRTY_BIT)),l="true"===(null==t?void 0:t.getItem(a.MD_OPTED_IN)),c=!(null==t?void 0:t.getItem(a.LAST_WID_MD))&&!(null==t?void 0:t.getItem(a.LAST_WID)),{deleteAllIdb:d}=r(35217);if(s||c&&l)try{yield d()}catch(e){__LOG__(4,void 0,new Error,void 0,["bootstrap_qr"])`Preemptive db delete failed with error ${e}`}else try{r(70818).Logger.clearLogsPreemptive()}catch(e){}s&&(null==t||t.clear(),window.location.href=`${window.location.pathname}?post_logout=1`);{var u;const e=(null!==(u=window.location.search)&&void 0!==u?u:"").toLowerCase().includes("post_logout=1"),{URL:t}=r(2541);e&&t.canMuckHistory()&&window.history.replaceState({},document.title,"/")}const{initModules:p}=r(56599);p();const{injectWamDependencies:f}=r(77959);f({Browser:r(87045).default,Conn:r(17239).Conn,CLB:r(85965),CONST:r(64369).default,Metric:r(11339).default,UserPrefs:r(99234),WamStorage:r(26372).default,isUserLoggedIn:r(13194).Z,uploadStats:r(85195).Z,WamContext:r(88353).I,PsIdStore:r(29590).Z,CoreWamStorageAdaptor:r(75838),uploadPrivateStats:r(24569).Z});const{exeTimer:_}=r(71119);_.start();const h=r(45095).default,g=r(73935);r(67294),o.isSafari&&o.browserVersion.startsWith("13.")&&(h(document.body,"document.body").className+=" text-rendering-bug-fix"),r(94114),window.Velocity=r(12641),r(38161),window.WebFont=r(75933),r(92589);const m=r(77303),y=r(22854).Z;m.set(y);const{isFunction:E}=r(31515);["getSelection","open","focus"].forEach((function(e){const t=Object.getPrototypeOf(window)[e];E(t)&&window[e]!==t&&(window[e]=t)}));const S=r(85965);window.Debug||(window.Debug={}),window.Debug.uploadLogs=S.upload;try{if(o.isLocalStorageBroken){const e=r(19197).default;yield e.loadUserIdb()}}finally{const e=r(43725).default;e.init(r(99234).getLangPref()).then((0,n.default)((function*(){const{Clock:e}=yield Promise.resolve().then(r.bind(r,22683));e.setIs24HourBasedOnLocale()}))),r(70818).Logger;const{App:t,hasPending:a}=r(94300);window.Debug.VERSION="2.2208.7",window.Debug.DESKTOP_BETA=!1,window.Debug.BUILD_ID="354741050";const o=r(87045).default;window.onbeforeunload=function(){{const{stopCommsBeforeUnload:t}=r(94300);if(l&&!a())try{t()}catch(e){__LOG__(4,void 0,new Error)`error while stopping comms onbeforeunload: ${e}`}if(o.isDownloading())return void o.clearDownloading();if(__LOG__(2)`webclient close/reload triggered`,__LOG__(2)`latest hash: ${"19eab8dab4bc390c285bbc801c5e1aa967b80e7b"}`,__LOG__(2)`version: ${"2.2208.7"}`,o.promptUnloadGuards>0)return;if(a())return e.t(343)}},window.addEventListener("dragover",(function(e){e.preventDefault()})),window.addEventListener("drop",(function(e){e.preventDefault()})),r(71798).loadSVGData();(0,r(87826).Z)()||(g.render((0,i.jsx)(t,{}),h(document.getElementById("app"),"document.getElementById('app')")),_.end())}if(window.navigator.serviceWorker&&!window.navigator.serviceWorker.controller)try{window.navigator.serviceWorker.register("/serviceworker.js",{scope:"/"})}catch(e){}}))).apply(this,arguments)}!function(){a.apply(this,arguments)}()},30152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SMB_SEARCH_FILTERS=void 0;t.SMB_SEARCH_FILTERS={UNREAD:"unread",GROUP:"group",BROADCAST:"broadcast",CONTACT:"contact",NON_CONTACT:"non_contact"}},46331:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastPosition=t.ActionType=t.ActionToast=void 0,t.genId=function(e){return(0,a.default)(e||"action_toast")};var a=i(r(73955)),o=r(89385),s=r(13959),l=r(67294),c=r(88102),d=r(50452),u=r(85893);const p={LEFT:"LEFT",RIGHT:"RIGHT"};t.ToastPosition=p;t.ActionType=class{constructor(e,t){if(!e)throw new Error("ActionType must have text!");this.text=e,t&&(this.action=t.actionText,this.handler=t.actionHandler)}};class f extends l.Component{constructor(){super(...arguments),this.state={currentInitialAction:this.props.initialAction,actionType:this.props.initialAction,pending:!0},this._action=null,this.handleAction=()=>{this.state.actionType&&this.state.actionType.handler&&this.state.actionType.handler().catch((()=>{}))},this.handleDismiss=()=>{c.Cmd.closeToast(this)}}static getDerivedStateFromProps(e,t){const r=e.initialAction;return r!==t.currentInitialAction?{currentInitialAction:r,actionType:r,pending:!0}:null}componentDidMount(){this._runAction(this.props.pendingAction)}componentDidUpdate(e){e.pendingAction!==this.props.pendingAction&&this._runAction(this.props.pendingAction)}_runAction(e){this._action&&this._action.controller.abort();const t=new n,r=t.signal,i=e.then((e=>{if(r.aborted)throw new o.AbortError;this.setState({actionType:e,pending:!1})})).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;this.setState({actionType:e,pending:!1})})).then((()=>(0,s.delayMs)(this.props.settleDuration))).then((()=>{if(r.aborted)throw new o.AbortError;c.Cmd.closeToast(this)})).catch((0,o.catchAbort)((()=>{})));this._action={promise:i,controller:t}}render(){const{actionType:e}=this.state;if(!e)return null;let t,r;return e.action&&e.handler&&(r=(0,u.jsx)(d.ToastActionBtn,{buttonText:e.action,onClick:this.handleAction})),this.state.pending||(t=(0,u.jsx)(d.ToastDismissBtn,{onClick:this.handleDismiss})),(0,u.jsx)(d.ToastBody,{toastPosition:this.props.toastPosition,actionText:e.text,actionBtn:r,dismissBtn:t})}}t.ActionToast=f,f.defaultProps={settleDuration:5e3,toastPosition:p.LEFT},f.displayName="ActionToast"},39770:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{a8nText:t,children:r,className:n,xstyle:g,disabled:m,onClick:y,nowrap:E,spinner:S,type:v}=e;const[T,C]=(0,f.default)(y,{disabled:m}),[A,b]=(0,u.default)(),P=(0,p.default)(T,A);let M;switch(v){case"primary":M="white";break;case"secondary":case"plain-white":case"simplified":M="highlight";break;default:M="default"}m&&(M="default");return(0,_.jsx)("div",(0,i.default)((0,i.default)({},C),{},{"data-a8n":a.default.key(t),className:(0,o.default)(l.default.button,{[l.default.primary]:"primary"===v,[l.default.secondary]:"secondary"===v,[l.default.plainWhite]:"plain-white"===v,[l.default.disabled]:m,[l.default.nowrap]:E,[l.default.simplified]:"simplified"===v,[l.default.warning]:"warning"===v,[l.default.solidWarning]:"solidWarning"===v,[l.default.strong]:"strong"===v,[l.default.strongPrimary]:"strong-primary"===v,[l.default.itemFocused]:b},n,(0,s.default)(g)),ref:P,children:(0,_.jsxs)(c.FlexRow,{align:"center",justify:"center",children:[(0,_.jsx)(c.FlexItem,{a8nText:a.default.key("content"),children:null!=r?r:null}),S?(0,_.jsx)(c.FlexItem,{a8nText:a.default.key("spinner"),xstyle:h.spinner,children:(0,_.jsx)(d.Spinner,{color:M,size:16})}):null]})}))};var i=n(r(81109)),a=n(r(99964)),o=n(r(94184)),s=n(r(56720)),l=n(r(44889)),c=r(29623),d=r(11054),u=n(r(97056)),p=n(r(41104)),f=n(r(60265)),_=r(85893);const h={spinner:{paddingStart:"mhcwslh8"}}},99360:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{children:t,href:r,onClick:n,title:c,className:d,tabIndex:u}=e;return(0,s.jsx)("a",{"data-a8n":i.default.key(e.a8n),"data-testid":"clickable-link",className:(0,a.default)(d,(0,o.default)(l)),href:null!=r?r:void 0,onClick:e=>{null!=r&&(e.metaKey||e.altKey)||(e.preventDefault(),n(e))},role:"button",rel:"noreferrer noopener",target:"_blank",title:c,tabIndex:null!=u?u:void 0,children:t})};var i=n(r(99964)),a=n(r(94184)),o=n(r(56720)),s=r(85893);const l={cursor:"ajgl1lbb"}},40249:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Type=t.ContextMenuManagerImpl=t.ContextMenuManager=void 0;var i=n(r(81109)),a=r(67294),o=r(88102),s=r(60811),l=n(r(43725)),c=r(84387),d=n(r(33358)),u=n(r(2773)),p=n(r(41956)),f=r(85893);const _={MENU:"MENU",TOOLTIP:"TOOLTIP"};t.Type=_;const h={originX:0,originY:0,offsetX:0,offsetY:0,dirX:s.DirX.RIGHT,dirY:s.DirY.BOTTOM,type:s.MenuType.dropdown};function g(e,t,r,n){switch(e){case s.DirX.RIGHT:return t;case s.DirX.LEFT:return r;case s.DirX.CENTER:return t+n/2}}class m extends a.Component{constructor(){super(...arguments),this.state={},this._setRefMenuContainer=e=>{this._refMenuContainer=e},this._setRefDropdown=e=>{this._refDropdown=e},this.handleClose=e=>{(!e||this.state.menu&&this.state.menu.uim===e)&&this.setState({menu:void 0})},this._handleOpen=(e,t)=>{var r;let{menu:n}=this.state;(null===(r=n)||void 0===r?void 0:r.uim)&&n.uim.pop(),n=(0,i.default)((0,i.default)((0,i.default)({},h),{},{dirX:l.default.isRTL()?s.DirX.LEFT:s.DirX.RIGHT},e),{},{key:Math.random(),isTemporaryRender:!0}),e.event&&(n=(0,i.default)((0,i.default)({},n),{},{originX:e.event.clientX,originY:e.event.clientY,offsetX:null!=e.offsetX?e.offsetX:10,offsetY:null!=e.offsetY?e.offsetY:10}),e.event.stopPropagation()),this.setState({menu:n},(()=>{var e;t(null===(e=this._refMenuContainer)||void 0===e?void 0:e.getElement()),this._setDirection()}))},this.isOpen=()=>null!=this.state.menu}componentDidMount(){const e=this.props.type===_.MENU?"open_context_menu":"open_tooltip";this.props.listeners.add(o.Cmd,e,this._handleOpen);const t=this.props.type===_.MENU?"close_context_menu":"close_tooltip";this.props.listeners.add(o.Cmd,t,this.handleClose)}_setDirection(){if(!this._refDropdown)return;const e=this._refDropdown.clientWidth,t=this._refDropdown.clientHeight+10,r=window.innerWidth,n=window.innerHeight;if(!this.state.menu)return;const{anchor:a,originX:o,originY:l,offsetX:c,offsetY:d,dirX:u,dirY:p}=this.state.menu;let f=o,_=o,h=l,m=l,y=0;if(a&&a instanceof HTMLElement){const e=a.getBoundingClientRect();f=e.left,_=e.right,m=e.bottom,h=e.top,y=a.offsetWidth}let E=u;E===s.DirX.RIGHT&&f+e>r&&_-e>0?E=s.DirX.LEFT:E===s.DirX.LEFT&&_-e<0&&f+e<r&&(E=s.DirX.RIGHT);let S,v=p;v===s.DirY.BOTTOM&&m+t+d>n&&h-t>0?v=s.DirY.TOP:v===s.DirY.TOP&&h-0-t<0&&m+t+d<n&&(v=s.DirY.BOTTOM),S=v===s.DirY.TOP?h:m;let T=c,C=d;a||(E===s.DirX.LEFT&&(T=0),v===s.DirY.TOP&&(C=0)),this.setState({menu:(0,i.default)((0,i.default)({},this.state.menu),{},{dirX:E,dirY:v,originX:g(E,f,_,y),originY:S,offsetX:T,offsetY:C,isTemporaryRender:!1})})}render(){let e,t="dropdown";if(this.state.menu){const{menu:r,key:n,originX:i,originY:o,offsetX:l,offsetY:c,dirX:u,dirY:p,type:_,autoFocus:h,findFirstItem:g,horizontal:m,isTemporaryRender:y,theme:E}=this.state.menu,S=Array.isArray(r)?r.map((e=>(0,a.cloneElement)(e,{theme:E}))):r;e=(0,f.jsx)(s.Dropdown,{origin:{x:i+l,y:o+c},onRef:this._setRefDropdown,type:_,dirX:u,dirY:p,horizontal:m,autoFocus:h,findFirstItem:g,isTemporaryRender:y,children:(0,f.jsx)(d.default,{ref:this._setRefMenuContainer,children:S})},"key-"+n),t="picker"===_?"dropdown-picker":"dropdown"}return(0,f.jsx)(u.default.Consumer,{children:r=>{var n;return(0,f.jsx)(u.default.Provider,{value:(null===(n=this.state.menu)||void 0===n?void 0:n.uim)||r,children:(0,f.jsx)(p.default,{transitionName:t,children:e})})}})}}t.ContextMenuManagerImpl=m,m.displayName="ContextMenuManagerImpl";const y=(0,c.ListenerHOC)(m);t.ContextMenuManager=class extends y{isOpen(){return this.getComponent().isOpen()}}},11933:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Clipboard=t.APP_TEXT_MIMETYPE=void 0;var i=n(r(96026)),a=n(r(16579)),o=n(r(65345)),s=r(9964),l=n(r(5818)),c=n(r(56695)),d=n(r(48442)),u=r(52596);t.APP_TEXT_MIMETYPE="application/whatsapp";class p{constructor(e){this._value=e||""}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[this.toString(),e].filter((e=>e)).join(t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[e,this.toString()].filter((e=>e)).join(t),this}toString(){return this._value}}class f{static fromEl(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.isCopyable)(e))?(0,s.getAppTextTemplateData)(e):null;return new f("",t)}static getTemplate(e){let t=e;if(!t)return null;if(!(t instanceof HTMLElement)){if(!t.parentElement)return null;t=t.parentElement}let r=new f("${appText}"),n=t,i=5,a=0,o=!1;for(;n&&a<i;)n instanceof HTMLElement&&(0,s.isCopyable)(n)?(r=f.fromEl(n,!0).append(r.toString()),o=o||!r.isPlainText(),i=5):a++,n=n.parentElement;return o?r.toString():null}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._innerAppText=new p(e),this._appTextTemplate=t}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.append(e,t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.prepend(e,t),this}isPlainText(){return Boolean(!this._appTextTemplate&&""!==this._appTextTemplate)}toString(){return this._appTextTemplate||""===this._appTextTemplate?this._appTextTemplate.replace(/\$\{appText\}/g,this._innerAppText.toString()):this._innerAppText.toString()}}class _{constructor(e,t){const r=e||"";this._plainText=new p(r),t&&(this._appText=new f(r,t))}static _copyableChildrenToClipboard(e){const t=(0,s.findCopyableChildren)(e);return(0,a.default)(t,((e,t)=>e.prepend(this.fromEl(t),"\n")),new _)}static _pruneRangeNodes(e,t,r){let n=t.cloneContents().childNodes,i=(0,l.default)(t);const a=[],o=[];for(let t=0;t<n.length;t++){const s=n[t],l=i[t].parentElement;(r||(0,u.isSelectable)(i[t])||(0,u.hasSelectableChildren)(s))&&(e.contains(i[t])||l&&l.contains(e))&&(a.push(s),o.push(i[t]))}n=a,i=o;let s=r;if(1===n.length){const e=n[0];s=s||(0,u.isSelectable)(i[0]),s||(n=(0,u.findSelectableChildren)(e,s),s=!1)}return{rangeNodes:n,parentIsSelectable:s}}static fromCopyableEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=(0,s.getPrePlainTextData)(e)||"",n=new _(r),i=(0,s.getPlainTextData)(e),o=(0,s.getAppTextTemplateData)(e),l=new _("",o);return i||""===i?(l.appendPlainText(i),n.append(l)):t||(0,u.isSelectable)(e)?(0,c.default)(e,"br")?n.appendPlainText("\n"):((0,a.default)(e.childNodes,((e,t)=>{const r=(0,c.default)(t,"div")?"\n":"";return e.prepend(this.fromSelectableNode(t),r)}),l),n.append(l)):(l.append(this._copyableChildrenToClipboard(e)),n.append(l))}static fromEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.isCopyable)(e)||t?this.fromCopyableEl(e,t):this._copyableChildrenToClipboard(e)}static fromNode(e,t){return e instanceof HTMLElement?this.fromEl(e,t):t?this.fromSelectableNode(e):new _}static fromRange(e,t){const r=t.commonAncestorContainer,n=f.getTemplate(r),i=new _("",n),o=(0,u.isSelectAll)(r)?r:(0,u.findSelectAllParent)(r);if(o instanceof HTMLElement)return i.append(this.fromCopyableEl(o));const{parentIsSelectable:s,rangeNodes:l}=this._pruneRangeNodes(e,t,(0,u.isSelectable)(r));return(0,a.default)(l,((e,t)=>{const r=s?"":"\n",n=this.fromNode(t,s);return e.prepend(n,r)}),i)}static fromSelectableNode(e){if((0,d.default)(e))return new _(e.textContent);if(!(e instanceof HTMLElement))return new _;const t=new _;return(0,o.default)(e,(e=>(0,d.default)(e)||(0,s.isCopyable)(e)?[]:Array.from(e.childNodes)),(e=>{let r;(0,s.isCopyable)(e)&&e instanceof HTMLElement?(r=this.fromCopyableEl(e,!0),t.append(r)):(0,d.default)(e)&&t.appendPlainText(e.textContent)})),t}static fromSelection(e,t){const r=new _;return(0,i.default)(t.rangeCount).map((r=>{const n=t.getRangeAt(r);return this.fromRange(e,n)})).reduce(((e,t)=>e.append(t,"\n")),r)}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.append(e.toAppString(),t)):this.hasAppText()&&this._appText.append(e.toAppString(),t),this._plainText.append(e.toPlainString(),t),this}appendPlainText(e){return this.append(new _(e)),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.prepend(e.toAppString(),t)):this.hasAppText()&&this._appText.prepend(e.toAppString(),t),this._plainText.prepend(e.toPlainString(),t),this}hasAppText(){return Boolean(this._appText)}toAppText(){return this.hasAppText()?this._appText:new f(this.toPlainString())}toPlainString(){return this._plainText.toString()}toAppString(){return this.hasAppText()?this._appText.toString():this.toPlainString()}}t.Clipboard=_},9964:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Copyable=t.COPYABLE_CSS_SELECTOR=t.COPYABLE_CSS_CLASS=void 0,t.CopyableCode=function(e){return(0,u.jsx)("code",(0,a.default)({},P(e)))},t.CopyableDel=function(e){return(0,u.jsx)("del",(0,a.default)({},P(e)))},t.CopyableDiv=function(e){return(0,u.jsx)("div",(0,a.default)({},P(e)))},t.CopyableEm=function(e){return(0,u.jsx)("em",(0,a.default)({},P(e)))},t.CopyableImg=void 0,t.CopyableLink=function(e){const t=P(e),r=t.href;if(r&&!d.URL.hasValidUrlScheme(r))return(0,u.jsx)("span",{});return(0,u.jsx)("a",(0,a.default)({},t))},t.CopyableSpan=function(e){return(0,u.jsx)("span",(0,a.default)({},P(e)))},t.CopyableStrong=function(e){return(0,u.jsx)("strong",(0,a.default)({},P(e)))},t.CopyableUl=function(e){return(0,u.jsx)("ul",(0,a.default)({},P(e)))},t.PLAIN_TEXT_DATA_ATTR=void 0,t.findCopyableChildren=function(e){const t=Array.from(e.querySelectorAll(g));return t.filter((e=>!t.some((t=>t!==e&&t.contains(e)))))},t.getAppTextTemplateData=function(e){return e.dataset[T]},t.getPlainTextData=function(e){return e.dataset[y]},t.getPrePlainTextData=function(e){return e.dataset[S]},t.isCopyable=function(e){return e instanceof HTMLElement&&(0,c.default)(e,g)};var i=n(r(6479)),a=n(r(81109)),o=n(r(94184)),s=r(67294),l=n(r(19198)),c=n(r(20603)),d=r(2541),u=r(85893);const p=["forwardedRef"],f=["element"],_=["plainText","prePlainText","appTextTemplate"],h="copyable-text";t.COPYABLE_CSS_CLASS=h;const g=".copyable-text";t.COPYABLE_CSS_SELECTOR=g;const m="data-plain-text",y=(0,l.default)(m);t.PLAIN_TEXT_DATA_ATTR=y;const E="data-pre-plain-text",S=(0,l.default)(E),v="data-app-text-template",T=(0,l.default)(v);const C=(0,s.forwardRef)(((e,t)=>{var r;let{forwardedRef:n}=e;const o=P((0,i.default)(e,p));return(0,u.jsx)("img",(0,a.default)((0,a.default)({ref:null!=n?n:t},o),{},{alt:null!==(r=o.alt)&&void 0!==r?r:""}))}));function A(e,t){let{element:r}=e,n=(0,i.default)(e,f);return(0,u.jsx)(r,(0,a.default)((0,a.default)({},P(n)),{},{ref:t}))}t.CopyableImg=C;const b=(0,s.forwardRef)(A);function P(e){let{plainText:t,prePlainText:r,appTextTemplate:n}=e,s=(0,i.default)(e,_);const l=(0,a.default)({},s);return l.className=(0,o.default)(s.className,h),null!=t&&(l[m]=t),null!=r&&(l[E]=r),null!=n&&(l[v]=n),l}t.Copyable=b},5354:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(6479)),o=n(r(94184)),s=r(67294),l=r(11933),c=n(r(97922)),d=r(85893);const u=["canCut","children","className","testid"];function p(e,t){let{canCut:r,children:n,className:s,testid:l}=e,p=(0,a.default)(e,u);const f=(0,i.default)((0,i.default)({},p),{},{className:(0,o.default)(s,c.default.noop,"copyable-area"),onCopy:h,onCut:r?g:void 0});return(0,d.jsx)("div",(0,i.default)((0,i.default)({},f),{},{ref:t,"data-testid":l,children:n}))}var f=(0,s.forwardRef)(p);function _(e){const t=e.currentTarget;if(!(t instanceof HTMLElement))return!1;const r=l.Clipboard.fromSelection(t,window.getSelection());e.clipboardData.setData("text/plain",r.toPlainString());try{e.clipboardData.setData(l.APP_TEXT_MIMETYPE,r.toAppString())}catch(e){}return!0}function h(e){_(e,window.getSelection())&&(e.stopPropagation(),e.preventDefault())}function g(e){const t=window.getSelection();_(e)&&(t.deleteFromDocument(),e.stopPropagation(),e.preventDefault(),e.target.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})))}t.default=f},52596:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Selectable=t.SELECTABLE_INPUT_CSS_CLASS=t.SELECTABLE_CSS_SELECTOR=t.SELECTABLE_CSS_CLASS=void 0,t.SelectableCode=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableCode,(0,a.default)({},t)):(0,p.jsx)("code",(0,a.default)({},t))},t.SelectableDel=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableDel,(0,a.default)({},t)):(0,p.jsx)("del",(0,a.default)({},t))},t.SelectableDiv=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableDiv,(0,a.default)({},t)):(0,p.jsx)("div",(0,a.default)({},t))},t.SelectableEm=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableEm,(0,a.default)({},t)):(0,p.jsx)("em",(0,a.default)({},t))},t.SelectableImg=void 0,t.SelectableLink=function(e){const t=O(e),r=e.href;if(r&&!u.URL.hasValidUrlScheme(r))return(0,p.jsx)("span",{});return e.selectable?(0,p.jsx)(l.CopyableLink,(0,a.default)({},t)):(0,p.jsx)("a",(0,a.default)({},t))},t.SelectableSpan=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableSpan,(0,a.default)({},t)):(0,p.jsx)("span",(0,a.default)({},t))},t.SelectableStrong=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableStrong,(0,a.default)({},t)):(0,p.jsx)("strong",(0,a.default)({},t))},t.SelectableUl=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableUl,(0,a.default)({},t)):(0,p.jsx)("ul",(0,a.default)({},t))},t.createSelectableElement=function(e,t){const r=document.createElement(e);r.setAttribute("class",m),(t||""===t)&&(r.dataset[l.PLAIN_TEXT_DATA_ATTR]=t);return r},t.findSelectAllParent=function(e){if(!A(e))return null;let t,r=e,n=0;for(;r&&n<5;){if(C(r)&&r instanceof HTMLElement){t=r;break}r=r.parentElement,n++}return t},t.findSelectableChildren=function(e,t){if(!(e instanceof HTMLElement))return[];if(t||T(e))return Array.from(e.childNodes);const r=Array.from(e.querySelectorAll(y));return r.filter((e=>!r.some((t=>t!==e&&t.contains(e)))))},t.hasSelectableChildren=function(e){if(!(e instanceof HTMLElement))return!1;return!!e.querySelector(y)},t.isSelectAll=C,t.isSelectable=T;var i=n(r(6479)),a=n(r(81109)),o=n(r(94184)),s=r(67294),l=r(9964),c=n(r(20603)),d=n(r(8581)),u=r(2541),p=r(85893);const f=["forwardedRef"],_=["element"],h=["className","plainText","prePlainText","appTextTemplate","selectable","selectAll"],g="selectable-text";t.SELECTABLE_CSS_CLASS=g;const m=`${l.COPYABLE_CSS_CLASS} selectable-text`,y=".selectable-text";t.SELECTABLE_CSS_SELECTOR=y;const E=m;t.SELECTABLE_INPUT_CSS_CLASS=E;const S="select-all",v=".select-all";function T(e){if(!e)return!1;if(!(e instanceof HTMLElement)){return T(e.parentElement)}return(0,c.default)(e,y)||(0,c.default)(e,".selectable-text *")}function C(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,v):C(e.parentElement))}function A(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,".select-all *"):A(e.parentElement))}const b=(0,s.forwardRef)(((e,t)=>{var r;let{forwardedRef:n}=e,o=(0,i.default)(e,f);const s=O(o);return o.selectable?(0,p.jsx)(l.CopyableImg,(0,a.default)({forwardedRef:t},s)):(0,p.jsx)("img",(0,a.default)((0,a.default)({ref:t},s),{},{alt:null!==(r=o.alt)&&void 0!==r?r:""}))}));function P(e,t){let{element:r}=e,n=(0,i.default)(e,_);const o=O(n);return n.selectable?(0,p.jsx)(l.Copyable,(0,a.default)((0,a.default)({element:r},o),{},{ref:t})):(0,p.jsx)(r,(0,a.default)((0,a.default)({},o),{},{ref:t}))}t.SelectableImg=b;const M=(0,s.forwardRef)(P);function O(e){let{className:t,plainText:r,prePlainText:n,appTextTemplate:a,selectable:s,selectAll:l}=e;const c=(0,i.default)(e,h);return s&&(c.plainText=r,c.prePlainText=n,c.appTextTemplate=a),c.className=(0,o.default)(t,d.default.noop,{[g]:s,[S]:s&&l}),c}t.Selectable=M},19198:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e.replace(/^data-/,""))};var i=n(r(68929))},56695:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e instanceof HTMLElement&&e.tagName.toLowerCase()===t.toLowerCase()}},20603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof HTMLElement))return!1;return r.call(e,t)};const r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector},48442:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Boolean(e&&3===e.nodeType)}},5818:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.collapsed)return[];if(e.startContainer===e.endContainer)return(0,a.default)(e.startContainer)?[e.startContainer]:Array.prototype.slice.call(e.startContainer.childNodes,e.startOffset,e.endOffset);const t=e.commonAncestorContainer.childNodes;let r,n;r=e.commonAncestorContainer===e.startContainer?t[0]:o(e.commonAncestorContainer,e.startContainer);(0,i.default)(r,"range is invalid: start missing"),n=e.commonAncestorContainer===e.endContainer?t[t.length-1]:o(e.commonAncestorContainer,e.endContainer);(0,i.default)(n,"range is invalid: end missing");const s=n,l=e=>null==e?void 0:e.nextSibling,c=[];let d=r;for(;d&&d!==s;)c.push(d),d=l(d)||l(d.parentNode);return c.push(s),c};var i=n(r(41143)),a=n(r(48442));function o(e,t){let r=t;for(;r.parentNode!==e;){if(!r.parentNode)return null;r=r.parentNode}return r}},60811:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.REACTION_DETAILS_WIDTH=t.MenuType=t.EMOJI_PICKER_WIDTH=t.Dropdown=t.DirY=t.DirX=void 0;var i=n(r(81109)),a=n(r(45095)),o=n(r(81703)),s=n(r(45120)),l=n(r(52013)),c=n(r(94184)),d=r(67294),u=r(88102),p=n(r(23257)),f=n(r(3222)),_=r(29424),h=n(r(43725)),g=r(85893);const m=parseInt(p.default["-emoji-picker-width"].replace(/px$/,""),10);t.EMOJI_PICKER_WIDTH=m;const y=parseInt(p.default["-reaction-details-width"].replace(/px$/,""),10);t.REACTION_DETAILS_WIDTH=y;t.MenuType={dropdown:"dropdown",dropdown_menu:"dropdown_menu",dropdown_text:"dropdown_text",menu:"menu",picker:"picker",emoji_picker:"emoji_picker",sticker_picker:"sticker_picker",color_picker:"color_picker",tooltip:"tooltip",reaction_details_pane:"reaction_details_pane",reaction_send_tray:"reaction_send_tray"};const E=r(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.DirX=E;const S=r(76672).Mirrored(["TOP","BOTTOM"]);function v(e){switch(e){case E.RIGHT:return E.LEFT;case E.LEFT:return E.RIGHT;case E.CENTER:return E.CENTER}}function T(e,t,r){return e!==E.CENTER||null==t||null==r?null:{left:t.offsetWidth/2-r.offsetWidth/2}}t.DirY=S;class C extends d.Component{constructor(){super(...arguments),this.state={showShortcuts:!1,keyboard:!1,selected:null},this._setRefDropdown=e=>{this._refDropdown=e,this.props.onRef&&this.props.onRef(e)},this._setRefNib=e=>{this._refNib=e},this._setRefList=e=>{this._refList=e},this._floaterEscapeOverlap=()=>{this._refList&&this._refDropdown&&!this.props.isTemporaryRender&&u.Cmd.floaterEscapeOverlap(this._refDropdown,10)},this.handleMouseMove=()=>{l.default.focus(this._refDropdown),this.setState({keyboard:!1})},this._selectPrevious=e=>{A(e);const{activeChildren:t,currentlyFocusedIndex:r}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,r-1)},this.selectNext=e=>{A(e);const{activeChildren:t,currentlyFocusedIndex:r}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,r+1)},this._getActiveChildren=()=>{const e=Array.from((0,a.default)(this._refList,"this._refList").querySelectorAll("li:not(.dropdown-item-disabled)"));return{activeChildren:e,currentlyFocusedIndex:e.indexOf(this.state.selected)}},this._focusNewActiveChild=(e,t)=>{const r=(t<0?e.length-1:t)%e.length;l.default.focus(e[r]),this.setState({keyboard:!0,selected:e[r]})},this.close=e=>{e.preventDefault();const{uim:t}=this.props;t&&t.uie.requestDismiss()},this.default=e=>{const t=this.props.onDefault;if(t){s.default.shouldIndicateFocus();const{uim:r}=this.props;r&&r.uie.requestDismiss(),t(e)}},this._resetSelected=e=>{e.stopPropagation(),l.default.focus(this._refDropdown),this.setState({selected:void 0})}}getElement(){return this._refDropdown}_allowKeyboard(){const e=this.props.type;return"emoji_picker"!==e&&"reaction_details_pane"!==e&&"reaction_send_tray"!==e&&"sticker_picker"!==e&&"color_picker"!==e&&"dropdown_text"!==e}componentDidMount(){if(this._floaterEscapeOverlap(),!this._allowKeyboard())return;const{autoFocus:e,children:t,findFirstItem:r}=this.props;if(e){var n;const e=null===(n=this._refList)||void 0===n?void 0:n.querySelector("[tabindex]");let i;r&&e||this._refList&&this._refList.firstChild instanceof HTMLDivElement&&e?i=e:this._refList&&this._refList.children.length>0?i=this._refList.children[0]:null!=t&&(i=d.Children.toArray(t)[0]),l.default.focus(i),this.setState({keyboard:!0,selected:i})}else l.default.focus(this._refDropdown)}componentDidUpdate(e){e.isTemporaryRender&&!this.props.isTemporaryRender&&this._floaterEscapeOverlap()}getStyle(){var e;const{dirX:t,dirY:r,flipOnRTL:n,origin:a}=this.props,s={},l=null!==(e=this.props.style)&&void 0!==e?e:{},[c,d]=function(e,t,r){return[r&&h.default.isRTL()?v(e):e,t]}(t,r,n);if(s[o.default.prefix("transformOrigin")]=function(e,t){const r=v(e);return`${t===S.TOP?S.BOTTOM:S.TOP} ${r}`}(c,d),!a)return(0,i.default)((0,i.default)({},l),s);const u=function(e,t,r,n){var i,a;const o={};switch(e){case E.RIGHT:o.left=Math.min(window.innerWidth-(null!==(i=null==n?void 0:n.offsetWidth)&&void 0!==i?i:0)-32,r.x);break;case E.LEFT:o.right=window.innerWidth-r.x;break;case E.CENTER:o.left=r.x-(null!==(a=null==n?void 0:n.offsetWidth)&&void 0!==a?a:0)/2,o.marginLeft=0,o.marginRight=0}switch(t){case S.BOTTOM:{o.top=r.y;const e=null==n?void 0:n.offsetHeight;if(null!=e){const t=window.innerHeight-e-32;o.top=Math.min(t,r.y)}break}case S.TOP:o.bottom=window.innerHeight-r.y}return o}(c,d,a,this._refDropdown);return(0,i.default)((0,i.default)((0,i.default)({},l),s),u)}render(){const e=this.props,t=e.type,r=(0,c.default)({[p.default.container]:"dropdown"===t||"dropdown_menu"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t,[p.default.right]:"dropdown_menu"===t,[p.default.icons]:"menu"===t,[p.default.picker]:"picker"===t,[p.default.emoji]:"emoji_picker"===t,[p.default.sticker]:"sticker_picker"===t,[p.default.colorPicker]:"color_picker"===t,[p.default.reactionDetails]:"reaction_details_pane"===t,[p.default.reactionSendTray]:"reaction_send_tray"===t,[p.default.text]:"dropdown_text"===t,[p.default.tooltip]:"tooltip"===t,[p.default.inverse]:("picker"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t||"tooltip"===t)&&e.dirX===E.LEFT,[p.default.inverseVertical]:("emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t)&&e.dirY===S.TOP}),n="picker"===t||"emoji_picker"===t||"sticker_picker"===t||"dropdown_text"===t||"tooltip"===t?(0,g.jsx)("div",{"data-testid":"tooltip-nib",ref:this._setRefNib,className:p.default.nib,"data-animate-dropdown-nib":!0,style:T(this.props.dirX,this._refDropdown,this._refNib)}):null;if(this._allowKeyboard()){const t={enter:this.default,tab:A,"shift+tab":A,up:()=>{},down:()=>{}};return e.horizontal?(t[h.default.LR("left","right")]=this._selectPrevious,t[h.default.LR("right","left")]=this.selectNext,t[h.default.LR("up","down")]=this._selectPrevious,t[h.default.LR("down","up")]=this.selectNext):(t.up=this._selectPrevious,t.down=this.selectNext,t[h.default.LR("left","right")]=this.close,t[h.default.LR("right","left")]=this.default),(0,g.jsxs)(_.HotKeys,{onRef:this._setRefDropdown,handlers:t,className:r,style:this.getStyle(),onMouseMove:this.state.keyboard?this.handleMouseMove:null,onMouseUp:this._resetSelected,children:[(0,g.jsx)("ul",{"data-testid":e.testid,ref:this._setRefList,className:p.default.items,children:e.children}),n]})}return(0,g.jsxs)("div",{ref:this._setRefDropdown,className:r,style:this.getStyle(),"data-testid":e.testid,children:[e.children,n]})}}function A(e){e.stopPropagation(),e.preventDefault()}C.defaultProps={type:"dropdown",dirX:E.RIGHT,dirY:S.BOTTOM},C.displayName="DropdownImpl";const b=(0,f.default)(C);t.Dropdown=b},12591:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalLink=void 0,t.openExternalLink=function(e){if(!c.URL.hasValidUrlScheme(e))return void(e.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${e}`,SEND_LOGS("URL error")));const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.style.display="none",document.body&&document.body.appendChild(t);t.click(),document.body&&document.body.removeChild(t)};var i=r(64331),a=n(r(99964)),o=n(r(64369)),s=r(67294),l=(n(r(77793)),n(r(54889))),c=r(2541),d=r(85893);function u(e){const t=(0,s.useRef)(),r=e=>{var r;(0,l.default)(e)&&(null===(r=t.current)||void 0===r||r.click())},{children:n,className:u,href:p,isLongTemplateUrl:f,onClick:_,a8nText:h,"aria-label":g}=e;return c.URL.hasValidUrlScheme(p)?f?(0,d.jsxs)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:_,onKeyDown:r,"aria-label":g,children:[(0,i.substring)(p,0,o.default.TEMPLATE_URL_START),(0,d.jsx)("span",{children:""}),(0,i.substring)(p,p.length-o.default.TEMPLATE_URL_END,p.length)]}):(0,d.jsx)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:_,onKeyDown:r,"data-a8n":a.default.key(h),"aria-label":g,children:n}):(p.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${p}`,SEND_LOGS("URL error")),null)}const p=(0,s.memo)(u);t.ExternalLink=p},24113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFavicon=function(e){let{children:t}=e;return(0,n.useEffect)((()=>{(0,i.setTitleAndIcon)(0)}),[]),t},t.ErrorFavicon=function(e){let{children:t}=e;return(0,n.useEffect)((()=>{(0,i.setTitleAndIcon)(-1)}),[]),t};var n=r(67294),i=r(90914)},29623:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexContainer=t.FlexColumn=void 0,Object.defineProperty(t,"FlexItem",{enumerable:!0,get:function(){return u.FlexItem}}),t.FlexRow=void 0;var i=n(r(81109)),a=n(r(6479)),o=n(r(99964)),s=n(r(94184)),l=r(67294),c=n(r(56720)),d=r(85893),u=r(48846);const p=["a8nText","align","as","direction","justify","wrap","children","className","xstyle","style"],f={flex:{display:"p357zi0d",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},directionHorizontal:{flexDirection:"sap93d0t"},directionVertical:{flexDirection:"f8m0rgwh"},directionHorizontalReverse:{flexDirection:"v76qf5v1"},directionVerticalReverse:{flexDirection:"qzvtbs9h"},justifyStart:{justifyContent:"fhf7t426"},justifyCenter:{justifyContent:"ac2vgrno"},justifyEnd:{justifyContent:"kcgo1i74"},justifyAll:{justifyContent:"o4u7okr9"},justifyAround:{justifyContent:"j1p1mz06"},justifyEvenly:{justifyContent:"s1e5xcja"},alignCenter:{alignItems:"gndfcl4n"},alignStart:{alignItems:"r15c9g6i"},alignEnd:{alignItems:"r6jd426a"},alignStretch:{alignItems:"elxb2u3l"},alignBaseline:{alignItems:"e4eao3g2"},wrap:{flexWrap:"lkhkxwyq"},wrapReverse:{flexWrap:"ns59xd2u"}},_=(0,l.forwardRef)((function(e,t){const{a8nText:r,align:n="start",as:l="div",direction:u,justify:_="start",wrap:h="nowrap",children:g,className:m,xstyle:y,style:E}=e,S=(0,a.default)(e,p);return(0,d.jsx)(l,(0,i.default)((0,i.default)({className:(0,s.default)((0,c.default)(f.flex,"start"===_&&f.justifyStart,"center"===_&&f.justifyCenter,"end"===_&&f.justifyEnd,"all"===_&&f.justifyAll,"around"===_&&f.justifyAround,"evenly"===_&&f.justifyEvenly,"vertical"===u&&f.directionVertical,"horizontal"===u&&f.directionHorizontal,"vertical-reverse"===u&&f.directionVerticalReverse,"horizontal-reverse"===u&&f.directionHorizontalReverse,"start"===n&&f.alignStart,"center"===n&&f.alignCenter,"end"===n&&f.alignEnd,"stretch"===n&&f.alignStretch,"baseline"===n&&f.alignBaseline,"wrap"===h&&f.wrap,"wrap-reverse"===h&&f.wrapReverse,y),m),ref:t,style:E,"data-a8n":o.default.key(r)},S),{},{children:g}))}));t.FlexContainer=_,_.displayName="FlexContainer";const h=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(_,(0,i.default)((0,i.default)({},e),{},{direction:"horizontal",ref:t,children:e.children}))}));t.FlexRow=h,h.displayName="FlexRow";const g=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(_,(0,i.default)((0,i.default)({},e),{},{direction:"vertical",ref:t,children:e.children}))}));t.FlexColumn=g,g.displayName="FlexColumn"},48846:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexItem=void 0;var i=n(r(81109)),a=n(r(15206)),o=r(67294),s=n(r(56720)),l=r(85893);const c={flexItem:{flexGrow:"tvf2evcx",flexShrink:"m0h2a7mj",flexBasis:"lb5m6g5c",order:"j7l1k36l",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},alignAuto:{alignSelf:"gjuq5ydh"},alignStart:{alignSelf:"ex3gcxaf"},alignCenter:{alignSelf:"o2es7gts"},alignEnd:{alignSelf:"rwlvdxyg"},alignStretch:{alignSelf:"l33m68ws"}},d=(0,o.forwardRef)((function(e,t){const{a8nText:r,align:n="auto",as:o="div",basis:d,xstyle:u,children:p,order:f,grow:_,shrink:h,style:g}=e,m={flexBasis:"string"==typeof d||null==d?d:`${d}px`,flexGrow:_,flexShrink:h,order:f};return(0,l.jsx)(o,{className:(0,s.default)(c.flexItem,"auto"===n&&c.alignAuto,"start"===n&&c.alignStart,"center"===n&&c.alignCenter,"end"===n&&c.alignEnd,"stretch"===n&&c.alignStretch,u),"data-a8n":r,ref:t,style:(0,i.default)((0,i.default)({},g),(0,a.default)(m)),children:p})}));t.FlexItem=d,d.displayName="FlexItem"},81559:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const n=(0,o.default)(e),{leading:s,trailing:l,maxWait:c}=null!=r?r:{},d=(0,a.useMemo)((()=>(0,i.default)(n,t,r)),[t,s,c,l,n]);return(0,a.useEffect)((()=>d.cancel),[d]),d};var i=n(r(23279)),a=r(67294),o=n(r(83800))},97056:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,n.useState)(!1),r=(0,a.useFocusVisibility)();return[(0,i.useFocus)({onFocusChange:t}),e&&r]};var n=r(67294),i=r(60480),a=r(22885)},59909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e]=(0,n.useReducer)((e=>e+1),0);return e};var n=r(67294)},98007:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const{immediate:n=!1}=null!=r?r:{},o=(0,a.default)(e),s=(0,i.useRef)(),l=(0,i.useCallback)((()=>{s.current&&clearInterval(s.current)}),[]),c=(0,i.useCallback)((()=>{l(),s.current=setInterval(o,t)}),[l,t,o]);return(0,i.useEffect)((()=>(n&&c(),l)),[n,c,l]),[c,l]};var i=r(67294),a=n(r(83800))},88624:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,n.useRef)(!1);(0,n.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]);return(0,n.useCallback)((()=>e.current),[])};var n=r(67294)},59552:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.useRef)();null==t.current&&(t.current=e());return t};var n=r(67294)},19529:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useAddListenerOnce=function(){const e=(0,o.useRef)(),t=(0,o.useCallback)(((t,r,n,a)=>{e.current=c(t,r,n,(0,i.default)((0,i.default)({},a),{},{once:!0}))}),[]),r=(0,o.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.call(e)}),[]);return(0,o.useEffect)((()=>r),[r]),[t,r]},t.useListener=function(e,t,r,n){const i=(0,l.default)(r),a=d(t);(0,o.useLayoutEffect)((()=>{if(null!=r)return c(e,t,i,n)}),[e,null==r,a])},t.useListeners=function(e){const t=e.map((e=>{let{callback:t}=e;return t})),r=(0,o.useRef)(t);r.current=t;const n=e.map((e=>{let{source:t,eventOrEvents:r}=e;return`${(0,a.default)(t)},${d(r)}`})).join("-");(0,o.useLayoutEffect)((()=>{const t=e.map(((e,t)=>{let{source:n,eventOrEvents:i,opts:a}=e;return c(n,i,(function(){for(var e,n,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return null===(e=(n=r.current)[t])||void 0===e?void 0:e.call(n,...a)}),a)}));return()=>t.forEach((e=>e()))}),[n])};var i=n(r(81109)),a=n(r(92226)),o=r(67294),s=r(59923),l=n(r(83800));function c(e,t,r,n){if(null==e)return()=>{};const i=function(e,t){if(Array.isArray(t))return(0,s.isEventsType)(e)?[t.join(" ")]:t;return[t]}(e,t).map((t=>new s.Listener(e,t,(function(){(null==n?void 0:n.once)&&a(),r(...arguments)}),n)));i.forEach((e=>{e.engage()}));const a=()=>{i.forEach((e=>{e.disengage()}))};return a}function d(e){return Array.isArray(e)?e.join("\0"):e}},41104:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(48313).useMergeRefs;t.default=n},41502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e})),t.current};var n=r(67294)},83800:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.useRef)(e);t.current=e;return(0,n.useCallback)((function(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(e=t.current)||void 0===e?void 0:e.call(t,...n)}),[])};var n=r(67294)},60265:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r;const n=(0,i.useRef)(),s=!0===(null==t?void 0:t.disabled),l=s?o:e;return[e=>{n.current=e},{"aria-disabled":null!==(r=null==t?void 0:t.disabled)&&void 0!==r?r:void 0,onClick:l,onKeyPress:function(e){var t;(0,a.default)(e)&&(e.stopPropagation(),e.preventDefault(),null===(t=n.current)||void 0===t||t.click())},role:"button",tabIndex:s?-1:0}]};var i=r(67294),a=n(r(54889));function o(){}},99935:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useManualTimeout=o,t.useTimeout=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const{immediate:n=!1}=null!=r?r:{},[a,s]=o(e),l=(0,i.useCallback)((()=>a(t)),[a,t]);return(0,i.useEffect)((()=>{n&&l()}),[n,l]),[l,s]};var i=r(67294),a=n(r(83800));function o(e){const t=(0,a.default)(e),r=(0,i.useRef)(),n=(0,i.useCallback)((()=>{r.current&&clearTimeout(r.current)}),[]),o=(0,i.useCallback)((e=>{n(),r.current=setTimeout(t,e)}),[n,t]);return(0,i.useEffect)((()=>n),[n]),[o,n]}},38080:(e,t,r)=>{"use strict";var n=r(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e]=(0,i.useState)((()=>new n));return(0,i.useEffect)((()=>()=>e.abort()),[e]),e.signal};var i=r(67294)},47065:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=r(50796),o=n(r(64369)),s=r(67294),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=n(r(97827)),d=n(r(72668)),u=r(52596),p=n(r(90012)),f=r(2541),_=r(85893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}const g=new d.default;class m extends s.Component{static getDerivedStateFromProps(e,t){return e.src!==t.src?{src:e.src,available:!0}:null}constructor(e){super(e),this._refNative=(0,s.createRef)(),this.getElement=()=>this._refNative.current,this.handleLoad=e=>{const{target:t}=e;if(t instanceof HTMLImageElement){const t=this.getImgElement();(null==t?void 0:t.complete)&&this._showImgElement(t),this.props.onLoad&&this.props.onLoad(e),this.setState({loading:!1})}},this.handleError=e=>{this.setState({available:!1});const{src:t,crossOrigin:r,noXHR:n,hasPrivacyChecks:o}=this.props;if(!t||!function(e){return"/"===e[0]||f.URL.isHttp(e)}(t))return void this.setState({error:e.error});const s=this.retry;let d;if(s)if(y(s,this.props)){if(!s.noXHR)return;d=s}else{s.release()&&g.remove(s),d=new c.default(t,r,n,o)}else d=new c.default(t,r,n,o);this.retry=d;const u=g.enqueue(d),p=this.props.getUnmountSignal();u.then((()=>{d===this.retry&&(p.aborted||this.setState({available:!0}))})).catch((0,a.filteredCatch)([l.ServerStatusError,l.GaveUpRetry],(e=>{d===this.retry&&(p.aborted||(this.setState({available:!1,error:e}),this.props.onError&&this.props.onError(e)))}))).catch((0,a.filteredCatch)(l.Unmount,(()=>{}))).catch((0,i.catchAbort)((()=>{})))},this.handleContextMenu=e=>{this.props.disableContextMenu&&e.preventDefault()},this.state={src:e.src,available:!0,error:null,loading:!0}}componentDidMount(){if(!this.props.src)return;const e=this.getImgElement();e&&!e.complete&&this._hideImgElement(e)}componentDidUpdate(e){if(y(e,this.props)||this._cancelRetry(),!this.props.src)return;const t=this.getImgElement();t&&!t.complete&&this._hideImgElement(t)}componentWillUnmount(){this._cancelRetry()}_cancelRetry(){if(this.retry){const e=this.retry;e.release()&&g.remove(e)}}getImgElement(){return this._refNative.current}_showImgElement(e){"visible"!==e.style.visibility&&(e.style.visibility="visible")}_hideImgElement(e){"hidden"!==e.style.visibility&&(e.style.visibility="hidden")}render(){const{alt:e,className:t,crossOrigin:r,draggable:n,onClick:i,onMouseMove:a,plainText:s,selectable:l,src:c,style:d,renderLoading:p,renderError:f}=this.props,{available:h,error:g,loading:m}=this.state;if(g&&f)return f(g);const y=Boolean(h&&c);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(u.SelectableImg,{ref:this._refNative,plainText:s||"",selectable:Boolean(l),crossOrigin:r?"anonymous":void 0,onError:y?this.handleError:()=>{},onLoad:y?this.handleLoad:()=>{},src:y&&null!=c?c:o.default.ONE_BY_ONE_TRANS_GIF,alt:e,className:t,draggable:n,onClick:i,onMouseMove:a,style:d,onContextMenu:this.handleContextMenu}),m&&p&&p()]})}}function y(e,t){return e.src===t.src&&e.crossOrigin===t.crossOrigin&&e.noXHR===t.noXHR&&e.hasPrivacyChecks===t.hasPrivacyChecks}m.defaultProps={crossOrigin:!0,noXHR:!1,hasPrivacyChecks:!0},m.displayName="Img";var E=(0,p.default)(m);t.default=E},97827:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=r(38284),s=(r(88156),i(r(11854))),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=i(r(11339));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}t.default=class{constructor(e,t,r,n){this.src=e,this.crossOrigin=t,this.noXHR=r,this.hasPrivacyChecks=n,this.generation=0,this.refCount=0,this.inProgress=!1}key(){return`co:${this.crossOrigin?"Y":"N"},noXHR:${this.noXHR?"Y":"N"},src:${this.src}`}sendXHR(){if(this.noXHR)return Promise.resolve(!0);const e=this.src;this.inProgress=!0;const t=new n,r=(0,o.promiseTimeout)(s.default.get(e,void 0,void 0,t.signal),3e4,"ImgRetryTimeout");return this._xhrRequest={promise:r,controller:t},this._xhrRequest.promise.then((t=>{const{status:r}=t;if(r>=200&&r<400)return!0;if(r>=500){__LOG__(2)`Img:Retry ${e} failed with error code ${r}. Retrying.`;return new c.default.WebcImgError({webcImgErrorCode:r}).commit(),!1}__LOG__(2)`Img:Retry ${e} failed with error code ${r}. Not retrying.`;throw new c.default.WebcImgError({webcImgErrorCode:r}).commit(),new l.ServerStatusError(null,e,r)})).catch((e=>{if(e instanceof l.ServerStatusError)throw e;if(e.name===a.ABORT_ERROR)throw e;return!1})).finally((()=>{this.inProgress=!1}))}release(){return this.refCount--,this.refCount<=0&&(this._xhrRequest&&this._xhrRequest.controller.abort(),!0)}shouldRetain(){return this.refCount>0}}},72668:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=i(r(45095)),s=r(88156),l=_(r(64103)),c=r(50338),d=i(r(57220)),u=i(r(84644)),p=_(r(22906));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class h{constructor(){this._queue=new Map,this._inDelay=new Map,this._numInProgress=0}static maxInProgressRetry(){return 20}enqueue(e){const t=this._queue.get(e.key());if(t){if(e.hasPrivacyChecks!==t.hasPrivacyChecks){const t=`Img:hasPrivacyChecks shouldn't change ${e.key()}`;return Promise.reject(t)}return t.refCount++,t.deferred.promise}return e.deferred=new s.Resolvable,e.refCount++,this._addToQueue(e),e.deferred.promise}remove(e){const t=e.key();this._queue.delete(t);const r=this._inDelay.get(t);r&&(r.controller.abort(),this._inDelay.delete(t))}_addToQueue(e){const t=e.generation;if(e.generation++,t>10){const t=`Stop retrying ${e.src} after 10 times`;throw new l.GaveUpRetry(t)}const r=e.key();if(0===t)this._queue.set(r,e),this._startProcessing();else{const i=new n,o=i.signal,s=(0,u.default)(p.expDelaySec(t,60,0),o).catch((0,a.catchAbort)((()=>{})));this._inDelay.set(e.key(),{promise:s,controller:i}),s.then((()=>{this._inDelay.delete(r),o.aborted||this._queue.set(r,e),this._startProcessing()}))}}_startProcessing(){this._waitPromise||(this._waitPromise=d.default.waitIfOffline({signal:(new n).signal}).then((()=>{this._waitPromise=null,c.UIBusyTasks.enqueue((()=>{this._processRetries()}))})))}_processRetries(){const e=this._queue.values();let t;for(;(t=e.next())&&!t.done&&!(this._numInProgress>h.maxInProgressRetry());){const e=t.value;this._processRetry((0,o.default)(e,"retry"))}}_processRetry(e){e.inProgress||(e.deferred.resolveWasCalled()?this._queue.delete(e.key()):(this._numInProgress++,e.sendXHR().then((t=>{this._queue.delete(e.key()),t?e.deferred.resolve():e.shouldRetain()&&this._addToQueue(e)})).catch((t=>{this._queue.delete(e.key()),e.deferred.reject(t)})).finally((()=>{this._numInProgress--}))))}}t.default=h},29424:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SpecialKeyMap=t.HotKeys=void 0;var i=n(r(81109)),a=n(r(6479)),o=n(r(52628)),s=r(67294),l=r(89618),c=r(85893);const d=["component","handlers","children","onRef"],u={alt:"Alt",ctrl:"Control",meta:"Meta",shift:"Shift"},p=(0,o.default)(u),f={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,meta:224};t.SpecialKeyMap=f;const _={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+"};class g extends s.Component{constructor(){super(...arguments),this._setRef=e=>{this._ref=e,this.props.onRef&&this.props.onRef(e)},this.getElement=()=>this._ref,this.focused=!1,this.onKeyDown=e=>{const{handlers:t}=this.props;t&&Object.keys(t).forEach((r=>{const n=t[r];if(null==n)return;const i=this.normalizeKM(r),[a]=i;_[a]&&this.matchHandler(i,e)&&n(e)}))},this.onKeyPress=e=>{const{handlers:t}=this.props;t&&Object.keys(t).forEach((r=>{const n=t[r];if(null==n)return;const i=this.normalizeKM(r),[a]=i;_[a]||this.matchHandler(i,e)&&n(e)}))},this.onFocus=e=>{this.focused=!0,this.props.onFocus(e)},this.onBlur=e=>{this.focused=!1,this.props.onBlur(e)}}matchHandler(e,t){let[r,n]=e;return r===t.which&&p.every((e=>n&&e===n?t.getModifierState(n):!t.getModifierState(e)))}normalizeKM(e){let[t,r]=e.toLowerCase().split("+");h[t]&&(t=h[t]),h[r]&&(r=h[r]);let n,i=t;return r?(i=r,n=u[t],void 0===n?__LOG__(3)`Invalid HotKey Modifier: ${t}`:void 0===i&&__LOG__(3)`Invalid HotKey Key: ${r}`):void 0===i&&__LOG__(3)`Invalid HotKey Key: ${t}`,[f[i]||i.charCodeAt(0),n]}componentDidMount(){this.focused=!1}componentWillUnmount(){if(!0===this.focused){const e=document.activeElement;this._ref===e&&l.UIM.Manager.refocusTopUie()}}render(){const e=this.props,{component:t,handlers:r,children:n,onRef:o}=e,s=(0,a.default)(e,d),l=r&&Object.keys(r).some((e=>null!=r[e]));return(0,c.jsx)(t,(0,i.default)((0,i.default)({ref:this._setRef,tabIndex:"-1",onKeyPress:l?this.onKeyPress:null,onKeyDown:l?this.onKeyDown:null},s),{},{onFocus:this.onFocus,onBlur:this.onBlur,children:n}))}}t.HotKeys=g,g.defaultProps={component:"div",onFocus:()=>{},onBlur:()=>{}},g.flashFocus=Date.now(),g.displayName="HotKeys"},54889:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=0;const r=e.charCode,n=e.keyCode;null!=r&&0!==r?t=r:null!=n&&0!==n&&(t=n);return i.has(t)};var n=r(29424);const i=new Set([n.SpecialKeyMap.enter,n.SpecialKeyMap.space])},87956:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFocus=t.FocusType=void 0;var i=n(r(45120)),a=n(r(52013)),o=r(67294),s=r(54392),l=n(r(30769)),c=r(63454),d=r(85893);const u=c.FocusType;function p(e,t){const{focusType:r}=e,n=(0,o.useRef)(null),u=()=>n.current;return(0,o.useImperativeHandle)(t,(()=>({getElement:u}))),(0,d.jsx)("div",{ref:n,style:e.style,className:l.default.container,onKeyDown:e=>{if(e.metaKey||e.ctrlKey)return;const t=n.current;let o;var l;(e.key===s.KEYBOARD_EVENT_KEY_VALUE.TAB?(e.stopPropagation(),e.preventDefault(),i.default.shouldIndicateFocus(),null!=t&&(o=(0,c.getNextTabbableElement)(t,e.shiftKey?c.TabDirection.BACKWARD:c.TabDirection.FORWARD,r))):null!=t&&t===document.activeElement&&(o=(0,c.getNextTabbableElement)(t,c.TabDirection.FORWARD,r,(e=>"input"===e.nodeName.toLowerCase()))),null!=o)&&(i.default.shouldIndicateFocus(),(l=o).restoreFocus?l.restoreFocus():a.default.focus(l))},tabIndex:"-1",children:e.children})}t.FocusType=u;const f=(0,o.forwardRef)(p);t.RotateFocus=f},22179:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(67294),a=r(54392),o=n(r(36037)),s=r(63454),l=r(85893);function c(e,t){const r=(0,i.useRef)(null),n=()=>r.current;return(0,i.useImperativeHandle)(t,(()=>({getElement:n}))),(0,l.jsx)("div",{ref:r,className:o.default.container,onKeyDown:e=>{if(!e.metaKey&&!e.ctrlKey)return e.key===a.KEYBOARD_EVENT_KEY_VALUE.TAB?(e=>{const t=r.current;if(!t)return;const n=e.shiftKey?s.TabDirection.BACKWARD:s.TabDirection.FORWARD,i=(0,s.getNextTabbableElement)(t,n,s.FocusType.TABBABLE);null!=i&&(e.preventDefault(),i.focus())})(e):void 0},tabIndex:"-1",onBlur:e.onBlur,role:"dialog",children:e.children})}var d=(0,i.forwardRef)(c);t.default=d},63454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TabDirection=t.FocusType=void 0,t.getNextTabbableElement=function(e){let t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.FORWARD,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.CUSTOM,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0;d===o.TABBABLE?(t=(0,a.tabbable)(e),r=()=>!0):(t=(0,i.default)(Array.from(e.querySelectorAll("[data-tab]")),(e=>parseInt(e.getAttribute("data-tab"),10)||0)),r=c);const p=n===s.FORWARD?1:-1;let f=0;const{activeElement:_}=document;if(_){const e=t.findIndex((e=>e.contains(_)));f=-1===e?0:l(e+p,t.length)}for(let e=0;e<t.length;e++){const n=l(f+e*p,t.length),i=t[n];if(r(i)&&u(i))return i}return null};var i=n(r(89734)),a=r(88388);const o=r(76672).Mirrored(["CUSTOM","TABBABLE"]);t.FocusType=o;const s=r(76672).Mirrored(["FORWARD","BACKWARD"]);function l(e,t){return(e+t)%t}function c(e){if(e.disabled)return!1;const t=parseInt(e.dataset.tab,10);return!("number"!=typeof t||t<0)&&!function(e){if("hidden"===getComputedStyle(e).visibility)return!0;let t=e;for(;t;){if("none"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}(e)}t.TabDirection=s},56074:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41609)),a=r(67294),o=n(r(43725)),s=r(52596),l=r(85893);const c=/(.*?)__(\w+?)__/g;function d(e){const{onClick:t,wrapInHiddenToken:r,id:n,plural:d,params:u,className:p,tabIndex:f}=e;return(0,l.jsx)(s.SelectableSpan,{dir:o.default.isRTL()?"rtl":"ltr",selectable:!r,onClick:t,className:p,tabIndex:f,children:(()=>{const e=o.default.t(n,{_plural:d});if(!u||(0,i.default)(u))return e;let t,r;const s=[];for(;t=c.exec(e);){const e=t;s.push(e[1]);const n=e[2];if(n&&null!=u[n]){const e=Array.isArray(u[n])?u[n].map(((e,t)=>(0,l.jsx)(a.Fragment,{children:e},`child_${t}`))):(0,l.jsx)(a.Fragment,{children:u[n]},n);s.push(e)}r=e.index+e[0].length}return"number"==typeof r&&r<e.length&&s.push(e.slice(r)),0===s.length?e:s})()})}d.defaultProps={wrapInHiddenToken:!0};var u=d;t.default=u},24161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(80648)),a=r(85893);t.default=e=>{let{max:t=100,value:r}=e;return(0,a.jsx)("progress",{value:r,max:t,className:i.default.progress})}},28828:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,a.useRef)(null),[t,r]=(0,a.useState)(m.FIRST_OPEN),n=(0,u.default)();(0,p.useListener)(window,"dpichange",(()=>{n()}));const E=()=>{r(m.READY)},S=e=>{r(m.LOADING),e.stopPropagation(),e.preventDefault()},v=()=>{r(m.REPLAY);const t=e.current;t&&t.play()};let T,C;t===m.FIRST_OPEN&&(T=(0,_.jsx)("div",{className:l.default.overlay,children:(0,_.jsx)(c.Spinner,{size:32})}),C=E);const A=t===m.FIRST_OPEN||t===m.READY||t===m.LOADING?(0,_.jsx)(s.default,{className:(0,i.default)(l.default.poster,{[l.default.hidden]:t===m.FIRST_OPEN}),src:g[o.default.currentRes],onLoad:C},"poster"):null;let b,P;const M=h[o.default.currentRes],O=t!==m.FIRST_OPEN&&t!==m.READY?(0,_.jsx)("video",{autoPlay:!0,className:l.default.player,controls:!0,controlsList:"nodownload",onCanPlayThrough:()=>{t===m.LOADING&&r(m.FIRST_PLAY)},onEnded:()=>{r(m.ENDED)},ref:e,children:(0,_.jsx)("source",{src:M,type:"video/mp4"})},o.default.currentRes):null;switch(t){case m.READY:P=S,b=(0,_.jsx)(y,{});break;case m.LOADING:b=(0,_.jsx)(c.Spinner,{color:"white",size:32});break;case m.ENDED:P=v,b=(0,_.jsx)(d.default,{name:"refresh-large"});break;default:b=null,P=null}const I=b?(0,_.jsx)("div",{className:l.default.overlay,role:"button",onClick:P,children:(0,_.jsx)("div",{className:l.default.button,children:b})}):null;return(0,_.jsx)("div",{className:l.default.video,children:(0,_.jsxs)("div",{className:l.default.container,children:[(0,_.jsxs)(f.default,{transitionName:"fade",children:[T,I,A]}),O]})})};var i=n(r(94184)),a=r(67294),o=n(r(3309)),s=n(r(47065)),l=n(r(71937)),c=r(11054),d=n(r(23217)),u=n(r(59909)),p=r(19529),f=n(r(41956)),_=r(85893);const h={low:r(79061),high:r(73727)},g={low:r(17818),high:r(7246)},m=r(76672).Mirrored(["FIRST_OPEN","READY","LOADING","FIRST_PLAY","ENDED","REPLAY"]);const y=()=>(0,_.jsx)("div",{className:l.default.play,children:(0,_.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"34",viewBox:"0 0 28 34",children:(0,_.jsx)("path",{fill:"#FFF",d:"M1 4.983v24.034a2.982 2.982 0 0 0 4.564 2.53L24.792 19.53a2.981 2.981 0 0 0 0-5.058L5.563 2.454A2.983 2.983 0 0 0 1 4.983z"})})})},22028:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,r]=(0,d.useState)(y.getRememberMe),[n]=(0,d.useState)((()=>!!(0,y.getShowMdUpgradeCompleteMsg)())),[i]=(0,d.useState)((()=>!!(0,y.getForcedMdUpgradeComplete)())),[a,o]=(0,d.useState)(G.Socket.state===I.SOCKET_STATE.UNPAIRED_IDLE),[s,u]=(0,d.useState)(!C.default.online),[f,h]=(0,d.useState)(G.Socket.state===I.SOCKET_STATE.UNPAIRED);(0,N.useListener)(G.Socket,"change:state change:online",(()=>{o(G.Socket.state===I.SOCKET_STATE.UNPAIRED_IDLE),u(!C.default.online),h(G.Socket.state===I.SOCKET_STATE.UNPAIRED)})),(0,d.useEffect)((()=>{}),[]);const S=()=>{E.GK.supportsFeature(E.GK.F.MD_BACKEND)?_.Cmd.refreshQR():G.Socket.poke()};let A;A=s?(0,F.jsx)(B,{children:(0,F.jsxs)("div",{className:P.default.qrButton,children:[(0,F.jsx)("div",{className:P.default.qrButtonIcon,children:(0,F.jsx)(R.default,{name:"connection"})}),v.default.t(282)]},"expiry")}):a?(0,F.jsx)(B,{children:(0,F.jsxs)("button",{className:P.default.qrButton,onClick:S,children:[(0,F.jsx)("div",{className:P.default.qrButtonIcon,children:(0,F.jsx)(R.default,{name:"refresh-large"})}),c.fbt._("Click to reload QR code",null,{hk:"pEkpW"})]},"expiry")}):f?(0,F.jsx)(B,{}):(0,F.jsx)("div",{className:P.default.qrcode,children:(0,F.jsx)(w.Spinner,{})});const b=t?null:(0,F.jsx)("div",{className:(0,l.default)(P.default.tip,P.default.rememberMeTip),children:v.default.t(529)});let M;if(e.apiCmd)switch(e.apiCmd.resultType){case p.APICmd.GROUP_INVITE:M=(0,F.jsx)("div",{className:P.default.groupInviteTip,children:(0,F.jsx)("div",{className:P.default.tip,children:c.fbt._("Log in to WhatsApp Web to join this WhatsApp group",null,{hk:"3OnLb2"})})});break;case p.APICmd.MSG_SEND:M=(0,F.jsx)("div",{className:P.default.groupInviteTip,children:(0,F.jsx)("div",{className:P.default.tip,children:c.fbt._("Log in to WhatsApp Web to share",null,{hk:"2k3JEY"})})})}const O=(0,F.jsx)("strong",{children:(0,F.jsx)(T.default,{id:582,params:{android_menu_icon:(0,F.jsx)(K,{})}})}),D=(0,F.jsx)("strong",{children:(0,F.jsx)(T.default,{id:584,params:{iphone_settings_icon:(0,F.jsx)(j,{})}})}),x=(0,F.jsx)("strong",{children:c.fbt._("Linked Devices",null,{hk:"Nqq5i"})}),W=(0,F.jsx)(T.default,{id:585,params:{android_menu:O,iphone_settings:D,whatsapp_web_menu_item:x}}),H=(0,F.jsx)("strong",{children:c.fbt._("Link a Device",null,{hk:"v9hB7"})}),V=(0,F.jsx)(T.default,{id:586,params:{login_step_3_md_link_device:H}}),$=n||i||(0,y.mdOptedIn)();let z,q;n&&(q=(0,F.jsx)("div",{className:"landing-header-upgradeCompleteText",children:c.fbt._("Update complete. Scan the QR code to use WhatsApp Web.",null,{hk:"3mQH0X"})}));i&&(q=(0,F.jsx)("div",{className:"landing-header-upgradeCompleteText",children:c.fbt._("Now use WhatsApp Web without keeping your phone online.",null,{hk:"1eDnsC"})}));z=(0,F.jsxs)("div",{className:"landing-header",children:[(0,F.jsx)(Y,{}),(0,F.jsx)("div",{className:"landing-headerTitle",children:v.default.t(587)})]});let J=(0,F.jsx)(U.default,{});return(0,F.jsxs)("div",{className:"landing-wrapper",children:[z," ",q,(0,F.jsxs)("div",{className:"landing-window",children:[(0,F.jsx)("div",{className:"landing-main",children:(0,F.jsxs)("div",{className:P.default.qrWrapper,children:[(0,F.jsxs)("div",{className:P.default.text,children:[(0,F.jsx)("div",{className:(0,l.default)("landing-title",P.default.headline),children:c.fbt._("To use WhatsApp on your computer:",null,{hk:"3aGbOX"})}),(0,F.jsxs)("ol",{className:P.default.list,children:[(0,F.jsx)("li",{className:P.default.listItem,children:c.fbt._("Open WhatsApp on your phone",null,{hk:"3hHeUI"})}),(0,F.jsx)("li",{className:P.default.listItem,children:W}),$&&(0,F.jsx)("li",{className:P.default.listItem,children:V}),(0,F.jsx)("li",{className:P.default.listItem,children:c.fbt._("Point your phone to this screen to capture the code",null,{hk:"2SaWOV"})})]})]}),(0,F.jsxs)("div",{className:P.default.qr,children:[M,A]}),(0,F.jsx)(g.ExternalLink,{href:(0,m.getLoginFaqUrl)(),className:P.default.hint,children:v.default.t(583)}),E.GK.supportsFeature(E.GK.F.MD_BACKEND)?null:(0,F.jsxs)("div",{className:P.default.toggle,children:[(0,F.jsx)(L.default,{transitionName:"fade_sifo",children:b}),(0,F.jsxs)("label",{children:[(0,F.jsx)("input",{type:"checkbox",name:"rememberMe",checked:t,onChange:e=>{G.Socket.isIncognito||k.default.setRememberMe(e.target.checked).catch((()=>{})),(0,y.setRememberMe)(e.target.checked),r((0,y.getRememberMe)())}}),v.default.t(602)]})]})]})}),J,undefined,undefined]})]})};var i=n(r(48926)),a=r(15688),o=n(r(99964)),s=r(41906),l=n(r(94184)),c=r(48360),d=r(67294),u=r(46308),p=r(88711),f=n(r(87045)),_=r(88102),h=(n(r(52665)),r(17239)),g=r(12591),m=r(96384),y=r(99234),E=r(7293),S=r(14111),v=n(r(43725)),T=n(r(56074)),C=n(r(57220)),A=n(r(14528)),b=n(r(37360)),P=n(r(66937)),M=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=x(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(16413)),O=(r(52596),r(11849)),I=r(62583),w=r(11054),R=n(r(23217)),D=n(r(81559)),N=r(19529),L=n(r(41956)),k=n(r(56891)),G=r(65044),U=n(r(28828)),F=r(85893);function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(x=function(e){return e?r:t})(e)}function B(e){const t=e.children,[r,n]=(0,d.useState)(!1),c=(0,D.default)((()=>{n(!0)}),100),p=(0,d.useRef)(null),g=(0,d.useRef)(null),m=()=>{if(h.Conn.connected)return Promise.resolve(void 0);const e=h.Conn.ref;if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))return O.waSignalStore.getRegistrationInfo().then(function(){var t=(0,i.default)((function*(t){const r=yield S.waNoiseInfo.get();if(!r||!r.staticKeyPair||!t)return __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Empty noiseInfo or empty regInfo"),null;const n=(0,a.encodeB64)(r.staticKeyPair.pubKey),i=(0,a.encodeB64)(t.identityKeyPair.pubKey),o=(0,u.getADVSecretKey)();return e+","+n+","+i+","+o}));return function(){return t.apply(this,arguments)}}());const t=f.default.id();return Promise.resolve().then((()=>{const r=M.getOrGenerate();return e+","+r+","+t}))},y=function(){var e=(0,i.default)((function*(){const e=p.current,t=g.current;if(null==e)return Promise.resolve();const r=yield m();r&&(A.default.inc(),t?t.makeCode(r):g.current=new b.default(e,{text:r,colorDark:"#122e31",width:s.QR_EDGE,height:s.QR_EDGE,correctLevel:b.default.CorrectLevel.L}),e.removeAttribute("title"),e.setAttribute("data-ref",r))}));return function(){return e.apply(this,arguments)}}();(0,N.useListener)(h.Conn,"change:ref",y),(0,d.useEffect)((()=>(y(),_.Cmd.initialLoadReady(),()=>{A.default.reset()})),[]);const v=(0,l.default)(P.default.qrcode,{[P.default.idle]:!!t}),T=r&&null==t?{cursor:"none"}:null;return(0,F.jsxs)("div",{ref:p,"data-a8n":o.default.key("qrcode"),className:v,onContextMenu:null,style:T,onMouseMove:()=>{r&&n(!1),c()},onMouseLeave:()=>{c.cancel(),n(!1)},children:[(0,F.jsx)(L.default,{transitionName:"scale",children:t}),(0,F.jsx)("div",{className:P.default.codeLogo,children:(0,F.jsx)(W,{})})]})}const K=()=>(0,F.jsx)("span",{className:P.default.icon,children:(0,F.jsxs)("svg",{height:"24px",viewBox:"0 0 24 24",width:"24px",children:[(0,F.jsx)("rect",{fill:"#f2f2f2",height:"24",rx:"3",width:"24"}),(0,F.jsx)("path",{d:"m12 15.5c.825 0 1.5.675 1.5 1.5s-.675 1.5-1.5 1.5-1.5-.675-1.5-1.5.675-1.5 1.5-1.5zm0-2c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5zm0-5c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5z",fill:"#818b90"})]})}),j=()=>(0,F.jsx)("span",{className:P.default.icon,children:(0,F.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[(0,F.jsx)("rect",{fill:"#F2F2F2",width:"24",height:"24",rx:"3"}),(0,F.jsx)("path",{d:"M12 18.69c-1.08 0-2.1-.25-2.99-.71L11.43 14c.24.06.4.08.56.08.92 0 1.67-.59 1.99-1.59h4.62c-.26 3.49-3.05 6.2-6.6 6.2zm-1.04-6.67c0-.57.48-1.02 1.03-1.02.57 0 1.05.45 1.05 1.02 0 .57-.47 1.03-1.05 1.03-.54.01-1.03-.46-1.03-1.03zM5.4 12c0-2.29 1.08-4.28 2.78-5.49l2.39 4.08c-.42.42-.64.91-.64 1.44 0 .52.21 1 .65 1.44l-2.44 4C6.47 16.26 5.4 14.27 5.4 12zm8.57-.49c-.33-.97-1.08-1.54-1.99-1.54-.16 0-.32.02-.57.08L9.04 5.99c.89-.44 1.89-.69 2.96-.69 3.56 0 6.36 2.72 6.59 6.21h-4.62zM12 19.8c.22 0 .42-.02.65-.04l.44.84c.08.18.25.27.47.24.21-.03.33-.17.36-.38l.14-.93c.41-.11.82-.27 1.21-.44l.69.61c.15.15.33.17.54.07.17-.1.24-.27.2-.48l-.2-.92c.35-.24.69-.52.99-.82l.86.36c.2.08.37.05.53-.14.14-.15.15-.34.03-.52l-.5-.8c.25-.35.45-.73.63-1.12l.95.05c.21.01.37-.09.44-.29.07-.2.01-.38-.16-.51l-.73-.58c.1-.4.19-.83.22-1.27l.89-.28c.2-.07.31-.22.31-.43s-.11-.35-.31-.42l-.89-.28c-.03-.44-.12-.86-.22-1.27l.73-.59c.16-.12.22-.29.16-.5-.07-.2-.23-.31-.44-.29l-.95.04c-.18-.4-.39-.77-.63-1.12l.5-.8c.12-.17.1-.36-.03-.51-.16-.18-.33-.22-.53-.14l-.86.35c-.31-.3-.65-.58-.99-.82l.2-.91c.03-.22-.03-.4-.2-.49-.18-.1-.34-.09-.48.01l-.74.66c-.39-.18-.8-.32-1.21-.43l-.14-.93a.426.426 0 00-.36-.39c-.22-.03-.39.05-.47.22l-.44.84-.43-.02h-.22c-.22 0-.42.01-.65.03l-.44-.84c-.08-.17-.25-.25-.48-.22-.2.03-.33.17-.36.39l-.13.88c-.42.12-.83.26-1.22.44l-.69-.61c-.15-.15-.33-.17-.53-.06-.18.09-.24.26-.2.49l.2.91c-.36.24-.7.52-1 .82l-.86-.35c-.19-.09-.37-.05-.52.13-.14.15-.16.34-.04.51l.5.8c-.25.35-.45.72-.64 1.12l-.94-.04c-.21-.01-.37.1-.44.3-.07.2-.02.38.16.5l.73.59c-.1.41-.19.83-.22 1.27l-.89.29c-.21.07-.31.21-.31.42 0 .22.1.36.31.43l.89.28c.03.44.1.87.22 1.27l-.73.58c-.17.12-.22.31-.16.51.07.2.23.31.44.29l.94-.05c.18.39.39.77.63 1.12l-.5.8c-.12.18-.1.37.04.52.16.18.33.22.52.14l.86-.36c.3.31.64.58.99.82l-.2.92c-.04.22.03.39.2.49.2.1.38.08.54-.07l.69-.61c.39.17.8.33 1.21.44l.13.93c.03.21.16.35.37.39.22.03.39-.06.47-.24l.44-.84c.23.02.44.04.66.04z",fill:"#818b90"})]})}),Y=()=>(0,F.jsx)("span",{className:P.default.icon,children:(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"39",height:"39",viewBox:"0 0 39 39",children:[(0,F.jsx)("path",{fill:"#00E676",d:"M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"}),(0,F.jsx)("path",{fill:"#FFF",d:"M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-4.4-7.1-2.3-16.5 4.9-20.9s16.5-2.3 20.9 4.9 2.3 16.5-4.9 20.9c-2.3 1.5-5.1 2.3-7.9 2.3zm8.8-11.1l-1.1-.5s-1.6-.7-2.6-1.2c-.1 0-.2-.1-.3-.1-.3 0-.5.1-.7.2 0 0-.1.1-1.5 1.7-.1.2-.3.3-.5.3h-.1c-.1 0-.3-.1-.4-.2l-.5-.2c-1.1-.5-2.1-1.1-2.9-1.9-.2-.2-.5-.4-.7-.6-.7-.7-1.4-1.5-1.9-2.4l-.1-.2c-.1-.1-.1-.2-.2-.4 0-.2 0-.4.1-.5 0 0 .4-.5.7-.8.2-.2.3-.5.5-.7.2-.3.3-.7.2-1-.1-.5-1.3-3.2-1.6-3.8-.2-.3-.4-.4-.7-.5h-1.1c-.2 0-.4.1-.6.1l-.1.1c-.2.1-.4.3-.6.4-.2.2-.3.4-.5.6-.7.9-1.1 2-1.1 3.1 0 .8.2 1.6.5 2.3l.1.3c.9 1.9 2.1 3.6 3.7 5.1l.4.4c.3.3.6.5.8.8 2.1 1.8 4.5 3.1 7.2 3.8.3.1.7.1 1 .2h1c.5 0 1.1-.2 1.5-.4.3-.2.5-.2.7-.4l.2-.2c.2-.2.4-.3.6-.5s.4-.4.5-.6c.2-.4.3-.9.4-1.4v-.7s-.1-.1-.3-.2z"})]})}),W=()=>(0,F.jsx)("span",{className:P.default.icon,children:(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64",children:[(0,F.jsx)("path",{fill:"#FFF",d:"M6.525 43.936a29.596 29.596 0 0 1-3.039-13.075C3.494 14.568 16.755 1.313 33.05 1.313c7.904.004 15.328 3.082 20.91 8.666 5.581 5.586 8.653 13.01 8.65 20.907-.007 16.294-13.266 29.549-29.558 29.549a29.648 29.648 0 0 1-12.508-2.771L1.391 62.687l5.134-18.751z"}),(0,F.jsx)("path",{fill:"#123033",d:"M50.801 13.135c-4.739-4.742-11.039-7.354-17.752-7.357-13.837 0-25.094 11.253-25.099 25.085a25.039 25.039 0 0 0 3.349 12.541l-3.56 12.999 13.304-3.488a25.084 25.084 0 0 0 11.996 3.054h.011c13.83 0 25.088-11.256 25.095-25.087.002-6.703-2.607-13.005-7.344-17.747zM33.05 51.733h-.008a20.866 20.866 0 0 1-10.62-2.906l-.762-.452-7.894 2.07 2.108-7.694-.497-.789a20.802 20.802 0 0 1-3.189-11.097c.004-11.496 9.361-20.85 20.87-20.85a20.73 20.73 0 0 1 14.746 6.115 20.733 20.733 0 0 1 6.104 14.752c-.006 11.497-9.363 20.851-20.858 20.851z"}),(0,F.jsx)("path",{fill:"#123033",d:"M25.429 19.26a8.65 8.65 0 0 0-1.028.011 2.352 2.352 0 0 0-.95.255c-.221.114-.427.277-.75.582-.305.288-.481.54-.668.782a6.974 6.974 0 0 0-1.443 4.291l.001.003a8.243 8.243 0 0 0 .844 3.607c1.043 2.307 2.763 4.746 5.035 7.008a24.676 24.676 0 0 0 1.657 1.6 24.145 24.145 0 0 0 9.814 5.229s.751.179 1.391.218c.021.001.04.003.061.003a9.207 9.207 0 0 0 1.422-.033 5.086 5.086 0 0 0 2.129-.59c.423-.225.623-.337.978-.561 0 0 .11-.072.319-.23.345-.257.558-.438.845-.736.211-.22.394-.479.534-.772.2-.417.401-1.213.481-1.874.061-.505.042-.781.036-.952-.011-.275-.238-.558-.487-.678l-1.486-.668s-2.222-.967-3.581-1.587a1.278 1.278 0 0 0-.452-.104c-.341-.021-.723.068-.966.324v-.004c-.013-.001-.182.145-2.031 2.385-.102.122-.341.387-.754.362a1.086 1.086 0 0 1-.185-.029 3.402 3.402 0 0 1-.49-.17c-.316-.134-.427-.185-.643-.278l-.013-.006a15.361 15.361 0 0 1-4.013-2.556 15.88 15.88 0 0 1-.927-.885c-1.074-1.041-1.953-2.148-2.607-3.24-.035-.06-.09-.146-.15-.242-.107-.174-.225-.381-.262-.523-.095-.376.157-.678.157-.678s.622-.68.911-1.05c.278-.356.518-.704.671-.952.301-.484.39-.982.238-1.37a216.767 216.767 0 0 0-2.219-5.215c-.156-.339-.598-.589-1.005-.636a6.284 6.284 0 0 0-.414-.041"})]})})},31703:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(99360)),a=r(12591),o=n(r(43725)),s=r(2541),l=r(85893);t.default=()=>{const e=s.URL.build("https://www.whatsapp.com/legal/small-business-terms/",{lg:o.default.getLocale()});return(0,l.jsx)(i.default,{href:e,onClick:t=>{t.preventDefault(),setTimeout((()=>(0,a.openExternalLink)(e)),10)},children:o.default.t(554)})}},11054:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RADIUS=void 0,t.Spinner=function(e){const{size:t=65,stroke:r=4,styleThemes:n,color:i=d.default,outgoingMsg:c,max:u=100,value:f}=e,_=function(e,t){if(null==e)return null;const r=Math.max(Math.min(e,t),0);return Math.ceil(100*r/t)}(f,u);(0,a.useEffect)((()=>{}),[]);const h=40+r;return(0,s.jsxs)("svg",{className:(0,o.default)(null==_&&l.container||l.rotate,...(n||[]).map((e=>l[e]))),width:t,height:t,viewBox:`0 0 ${h} ${h}`,role:"status",children:[null!=_?(0,s.jsx)(p,{viewBoxSide:h,stroke:r,outgoingMsg:c,color:"default",progress:u}):null,(0,s.jsx)(p,{progress:_,viewBoxSide:h,stroke:r,outgoingMsg:c,color:i})]})},t.styleThemeOptions=t.colorOptions=void 0;var i=n(r(66919)),a=r(67294),o=n(r(56720)),s=r(85893);const l={accent:{stroke:"dba1p600"},container:{animationName:"gdrnme8s",animationDuration:"hbnrezoj",animationTimingFunction:"f8mos8ky",animationIterationCount:"tkmeqcnu",zIndex:"b9fczbqn"},default:{stroke:"a5uym4to"},highlight:{stroke:"sku37djt"},progress:{stroke:"gibn6ev6"},in:{stroke:"ptcoeott"},noop:{visibility:"g5crjs6l"},out:{stroke:"mbixqzja"},rounded:{strokeLinecap:"bvgz89zs"},path:{animationName:"nmreelbr",animationDuration:"sw4r90y6",animationTimingFunction:"gaqnkt02",animationIterationCount:"tkmeqcnu",strokeDasharray:"kzgl1sas",strokeDashoffset:"fwna6xbl"},solidwhite:{stroke:"ad0o4787"},white:{stroke:"qaop2s2o"},rotate:{transform:"bwjm0vhl",transformOrigin:"sx61ek5s"}},c=(0,i.default)({noop:null});t.styleThemeOptions=c;const d=(0,i.default)({default:null,highlight:null,solidwhite:null,white:null,accent:null,progress:null});t.colorOptions=d;function u(e){if(null==e)return null;const t=Math.ceil(40*Math.PI);return{strokeDasharray:`${t} ${t}`,strokeDashoffset:t-e/100*t}}function p(e){let{stroke:t,viewBoxSide:r,progress:n,color:i,outgoingMsg:a}=e;return(0,s.jsx)("circle",{style:u(n),className:(0,o.default)(l.rounded,null==n&&l.path,l[i],!1===a&&l.in,a&&l.out),cx:r/2,cy:r/2,r:20,fill:"none",strokeWidth:t})}t.RADIUS=20},90669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STICKER_PADDING=t.STICKER_PACK_FETCH_TIMEOUT=t.STICKER_MAKER_IMAGE_PADDING=t.STICKER_LIST_ITEM_HEIGHT=t.STICKER_DIMENSION=t.STICKER_BORDER_WIDTH=void 0;t.STICKER_DIMENSION=512;t.STICKER_BORDER_WIDTH=8;t.STICKER_PADDING=36;t.STICKER_LIST_ITEM_HEIGHT=156;t.STICKER_MAKER_IMAGE_PADDING=20;t.STICKER_PACK_FETCH_TIMEOUT=86400},23217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{className:t,containerRef:r,directional:n,display:l,height:c,name:d,color:u,title:p,style:f,width:_,xstyle:h,iconXstyle:g,"aria-label":m,"aria-hidden":y}=e;return(0,o.jsx)(a.SVGBase,{"aria-hidden":y,"aria-label":m,className:t,containerRef:r,height:c,isRTL:!!n&&i.default.isRTL(),display:l,name:d,title:p,style:f,width:_,xstyle:[h,u&&s[`${u}Color`]],iconXstyle:g})};n(r(56720));var i=n(r(43725)),a=r(71798),o=r(85893);const s={secondaryColor:{color:"aft2yglh"},tealColor:{color:"jq3rn4u7"},grayColor:{color:"hsqj3bek"}}},71798:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SVGBase=void 0,t.loadSVGData=T,t.loadSpecificSVG=function(){return C.apply(this,arguments)};var i=n(r(81109)),a=n(r(6479)),o=n(r(48926)),s=r(89385),l=n(r(45095)),c=r(13959),d=r(4352),u=n(r(94184)),p=r(67294),f=n(r(56720)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),h=n(r(38080)),g=r(85893);const m=["aria-label","aria-hidden","name","isRTL","className","display","containerRef","height","width","xstyle","iconXstyle"];function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}const E={reverse:{display:"f804f6gw",transform:"n4o0o7gj"},inline:{display:"l7jjieqr",verticalAlign:"fewfhwl7"}};let S,v;function T(e){return v||(v=(0,d.promiseLoop)(((t,n,i)=>{if(null==e?void 0:e.aborted)throw new s.AbortError;const a=(0,c.delayMs)(_.expBackoff(i,12e4,1e3,.1));return r.e(5512).then(r.bind(r,69692)).then((e=>{S=e.default,t()})).catch((()=>a))})))}function C(){return(C=(0,o.default)((function*(e){return yield T(),(0,l.default)(S,"SVGData")[e]}))).apply(this,arguments)}function A(e){const t=e.split("-");for(let e=1;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1).toLowerCase();return t.join("")}function b(e){if(null==e)return{};const t=e.attributes;return t.length>0?function(e){const t={};for(const r of e){let e=r.name;e.startsWith("xmlns")||(e.includes("-")?e=A(e):"class"===e&&(e="className"),t[e]=r.value)}return t}(t):{}}function P(e){var t;const[r,n]=(0,p.useState)(!!S),o=(0,h.default)();(0,p.useEffect)((()=>{r||T(o).then((()=>{if(o.aborted)throw new s.AbortError;n(!0)})).catch((()=>{}))}),[]);const{"aria-label":l,"aria-hidden":c,name:d,isRTL:_,className:y,display:v,containerRef:C,height:A,width:P,xstyle:M,iconXstyle:O}=e,I=(0,a.default)(e,m);if(S&&!S[d])throw new Error("Missing SVG for '"+d+"'!");const w=null===(t=S)||void 0===t?void 0:t[d],R=(0,p.useMemo)((()=>function(e){if(null==e)return null;const t=document.createElement("div");t.innerHTML=e;const r=t.firstElementChild;return"svg"===(null==r?void 0:r.tagName)?(t.removeChild(r),r):null}(w)),[w]),D=(0,p.useMemo)((()=>b(R)),[R]),N={};return null==A&&null==P||(N.height=A,N.width=P,N.preserveAspectRatio="xMidYMid meet"),(0,g.jsx)("span",(0,i.default)((0,i.default)({"data-testid":d,"aria-hidden":c,"aria-label":l,ref:C,"data-icon":d,className:(0,u.default)(y,(0,f.default)(_&&E.reverse,"inline"===v&&E.inline,M))},I),{},{children:(0,g.jsx)("svg",(0,i.default)((0,i.default)((0,i.default)({},D),N),{},{className:(0,f.default)(O),dangerouslySetInnerHTML:{__html:null==R?void 0:R.innerHTML}}))}))}const M=(0,p.memo)(P);t.SVGBase=M},3137:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));class a extends i.default{constructor(){super(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.theme=this.getCurrentTheme(),this.handleThemeChange=()=>{const e=this.getCurrentTheme();e!==this.theme&&(this.theme=e,this.trigger("system_theme_change",e))},this.mediaQuery.addListener(this.handleThemeChange)}getCurrentTheme(){return this.mediaQuery.matches?"dark":"light"}}var o=new a;t.default=o},13923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Text=p,t.TextDiv=function(e){return(0,c.jsx)(p,(0,a.default)({as:"div"},e))},t.TextHeader=function(e){const{level:t="1"}=e,r=(0,i.default)(e,d);return(0,c.jsx)(p,(0,a.default)({as:f[t]},r))},t.TextLabel=function(e){let{htmlFor:t}=e,r=(0,i.default)(e,u);return(0,c.jsx)(p,(0,a.default)((0,a.default)({as:"label"},r),{},{extras:{htmlFor:t}}))},t.TextParagraph=function(e){return(0,c.jsx)(p,(0,a.default)({as:"p"},e))},t.TextSpan=function(e){return(0,c.jsx)(p,(0,a.default)({as:"span"},e))};var i=n(r(6479)),a=n(r(81109)),o=n(r(94184)),s=n(r(56720)),l=n(r(98285)),c=r(85893);const d=["level"],u=["htmlFor"];function p(e){var t,r,n,i;const d=null!==(t=e.as)&&void 0!==t?t:"span",u=e.theme?l.default[e.theme]:null,p=e.color?l.default[`color-${e.color}`]:null,f=l.default[`weight-${null!==(r=e.weight)&&void 0!==r?r:"normal"}`],_=null!=e.customSize||null!=(null!==(n=e.xstyle)&&void 0!==n?n:{}).fontSize?null:null!==(i=e.size)&&void 0!==i?i:"14",h=null!=_?l.default[`size-${_}`]:null;let g;return null!=e.customSize&&(g={fontSize:"string"==typeof e.customSize?e.customSize:`${e.customSize}px`}),(0,c.jsx)(d,(0,a.default)((0,a.default)({},e.extras),{},{className:(0,o.default)(u,p,h,f,e.className,(0,s.default)(e.xstyle)),style:g,children:e.children}))}const f={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"}},50452:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastImpl=t.ToastDismissBtn=t.ToastBody=t.ToastActionBtn=t.Toast=void 0,t.genId=function(e){return(0,i.default)(e||"toast")};var i=n(r(73955)),a=n(r(99964)),o=r(28298),s=r(67294),l=n(r(56720)),c=r(88102),d=n(r(23217)),u=n(r(4478)),p=r(85893);const f={btnSuccess:{color:"j5au4wul",fontWeight:"nbipi2bn"},button:{color:"dud78hvd",cursor:"ajgl1lbb",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo",flexShrink:"oq44ahr5"},close:{color:"afo7vhit"},right:{right:"grt5ktjy"},toast:{alignItems:"gndfcl4n",backgroundColor:"cqvkqxai",borderTopStartRadius:"cynldqnp",borderTopEndRadius:"l5pmshjt",borderBottomEndRadius:"ecxr5yey",borderBottomStartRadius:"lysxvg3k",color:"k17s6i4e",display:"p357zi0d",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo"}};class _ extends s.PureComponent{constructor(){super(...arguments),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration),this.onDismiss=()=>{c.Cmd.closeToast(this),this.props.onDismiss&&this.props.onDismiss()}}getId(){return this.props.id}restartDelay(){this.props.clearTimeout(this.delay),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration)}render(){const{msg:e,action:t}=this.props;let r;return t&&(r=(0,p.jsx)(h,{buttonText:t.actionText,onClick:t.dismiss?this.onDismiss:t.onAction,theme:t.theme})),(0,p.jsx)(g,{actionText:e,actionBtn:r})}}t.ToastImpl=_,_.defaultProps={duration:4e3},_.displayName="ToastImpl";const h=e=>{let{buttonText:t,onClick:r,theme:n}=e;return(0,p.jsx)("button",{className:(0,l.default)(f.button,o.uiMargin.start15,"success"===n&&f.btnSuccess),onClick:r,children:t})};t.ToastActionBtn=h;t.ToastDismissBtn=e=>{let{buttonText:t,onClick:r}=e;return(0,p.jsx)("button",{className:(0,l.default)(f.close,o.uiMargin.start15),onClick:r,children:(0,p.jsx)(d.default,{name:"x-alt"})})};const g=e=>{let{toastPosition:t,actionText:r,actionBtn:n,dismissBtn:i}=e;return(0,p.jsxs)("div",{className:(0,l.default)(f.toast,o.uiPadding.vert12,o.uiPadding.horiz16,"RIGHT"===t&&f.right),"data-a8n":a.default.key("toast-body"),children:[(0,p.jsx)("span",{children:r}),n,i]})};t.ToastBody=g;const m=(0,u.default)(_);t.Toast=class extends m{restartDelay(){const e=this.getComponent();e&&e.restartDelay()}}},93373:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastManager=function(){const e=(0,_.default)((()=>new Map)),t=(t,r)=>{r?e.current.set(t,r):e.current.delete(t)},r=(0,_.default)((()=>new u.default(t))),n=(0,s.useRef)(null),[v,T]=(0,s.useState)({}),C=(0,g.default)(v),A=(t,r)=>{let n;(n=e.current.get(t.props.id))&&n instanceof p.Toast?n.restartDelay():T((0,i.default)((0,i.default)({},v),{},{[t.props.id]:{toast:t,position:r}}))};(0,h.useListener)(c.Cmd,"open_toast",A),(0,h.useListener)(c.Cmd,"close_toast",(e=>{v[e.props.id]&&T((0,o.default)(v,e.props.id))}));const b=null;(0,h.useListener)(b,"cannot_reach_phone",(e=>{A((0,y.jsx)(p.Toast,{msg:e,id:(0,p.genId)()}))})),(0,h.useListener)(b,"window_error",(e=>{A((0,y.jsx)(p.Toast,{msg:` ${e}`,id:(0,p.genId)()}))})),(0,h.useListener)(b,"ping_sent",(e=>{A((0,y.jsx)(p.Toast,{msg:e,id:(0,p.genId)()}))})),(0,s.useEffect)((()=>{n.current=Object.keys(null!=C?C:{}).length>Object.keys(v).length}),[v,C]);const P=n.current,M=(0,a.default)(v,["toast","id"]).reverse().map(((e,t)=>{let{toast:n,position:i}=e;return(0,y.jsx)("div",{ref:r.current.getRefSetter(n.props.id),className:(0,l.default)(S.wrapper,i===E.CENTER&&S.center,i===E.RIGHT&&S.right,0===t&&P&&S.slide0,1===t&&S.slide1,2===t&&S.slide2,t>=3&&S.slide3),children:(0,y.jsx)("div",{className:(0,l.default)(i===E.CENTER&&(d.default.isRTL()?S.transformRight:S.transformLeft)),children:(0,s.cloneElement)(n)})},n.props.id)})),O=f.UA.isTrident?"fade_sifo":"toast-transition";return(0,y.jsx)(m.default,{transitionName:O,children:M})},t.ToastPosition=void 0;var i=n(r(81109)),a=n(r(89734)),o=n(r(57557)),s=r(67294),l=n(r(56720)),c=r(88102),d=n(r(43725)),u=n(r(59578)),p=r(50452),f=r(65127),_=n(r(59552)),h=r(19529),g=n(r(41502)),m=n(r(41956)),y=r(85893);const E=r(76672)({LEFT:"LEFT",CENTER:"CENTER",RIGHT:"RIGHT"});t.ToastPosition=E;const S={slide0:{transform:"qdd0en2n"},slide1:{transform:"gqonocmn"},slide2:{transform:"b5bqnu92"},slide3:{opacity:"axi1ht8l",transform:"j7iro104"},wrapper:{opacity:"bs7a17vp",bottom:"jxacihee",lineHeight:"d53pemmv",marginTop:"fgtikrv0",marginEnd:"gqi0zhd6",marginBottom:"dblt22a0",marginStart:"nzcjdldu",minHeight:"ocs0cmsa",position:"lhggkp7q",zIndex:"pglj95m3",transition:"byw3xhqn"},center:{start:"m7kgcvyw",marginStart:"svoq16ka",marginEnd:"jnwc1y2a"},transformLeft:{transform:"t9w6h8zt"},transformRight:{transform:"ajuzgosp"},right:{end:"ebjesfe0"}}},3222:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r;return(t=class extends s.WrappedComponent{render(){return this.state.hasError?null:(0,c.jsx)(l.default.Consumer,{children:t=>(0,c.jsx)(e,(0,i.default)((0,i.default)({ref:this.setComponent},this.props),{},{uim:(0,a.default)(t,"uim")}))})}}).defaultProps=null!==(r=e.defaultProps)&&void 0!==r?r:void 0,t.displayName=`UIM(${(0,o.default)(e)})`,t.wrappedComponent=e,t};var i=n(r(81109)),a=n(r(45095)),o=n(r(38701)),s=r(7128),l=n(r(2773)),c=r(85893)},89618:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIMState=t.UIM=void 0;var i=n(r(84753)),a=n(r(82729)),o=n(r(57538));const s=r(76672).Mirrored(["ACTIVE","PASSIVE","INACTIVE","DEAD"]);t.UIMState=s;class l{static maybePreventScroll(e){var t;const r=null===(t=l.Manager.getTop())||void 0===t?void 0:t.uie.getNode();e.target instanceof HTMLElement&&r&&!r.contains(e.target)&&(e.preventDefault(),e.stopPropagation())}constructor(e,t){this.shouldRequestFocus=!0,this.parent=e||this,e||(l.Manager.root&&(__LOG__(4,void 0,new Error,!0)`Attempting to set multiple UIM tree roots. Expecting only one.`,SEND_LOGS("multiple-uim-roots")),l.Manager.root=this),this.uie=t,this.children=[],this.setState(t.getUIMState())}getState(){return this._state}setState(e){switch(e){case s.ACTIVE:this.lastActive=Date.now(),l.Manager.setTop(this);break;case s.PASSIVE:this.lastActive=Date.now(),this._state!==s.ACTIVE&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.INACTIVE:this._state&&this._state!==e&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.DEAD:}this._state=e}activate(){this.setState(this._state)}branch(e){const t=new l(this,e);return this.children.push(t),l.pprint(),t}pop(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.getState()===s.DEAD)return;this._invalidateAndDismissChildren(this.children,e),(0,a.default)(this.parent.children,(e=>e===this));const r=l.findMostRecentlyActiveFocusable(this);r&&(r.shouldRequestFocus=t),l.Manager.setTop(r),l.pprint()}_invalidateAndDismissChildren(e,t){e.forEach((e=>{e.setState(s.DEAD),e.uie.requestDismiss(t),this._invalidateAndDismissChildren(e.children,t)}))}static findMostRecentlyActiveFocusable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>{const t=e.getState();return t===s.ACTIVE||t===s.PASSIVE}))}static findMostRecentlyActiveDismissable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>e.getState()===s.ACTIVE))||c(t,e,(e=>e.getState()===s.PASSIVE))}static pprint(e){if(!e&&!l.Manager.verbose)return;const{root:t}=l.Manager;t&&__LOG__(2)`${u(t,[])}`}}function c(e,t,r){if(!e.children.length)return e;const n=e.children.filter((e=>e!==t)).map((e=>c(e,t,r))).concat([e]).filter(Boolean).filter(r);return(0,i.default)(n,"lastActive")}t.UIM=l,l.State=s,l.Manager={_top:void 0,setTop(e){e&&(e.lastActive=Date.now()),e&&this._top!==e&&e.getState()!==s.INACTIVE&&e.getState()!==s.DEAD&&e.shouldRequestFocus&&e.uie.requestFocus(),e&&(e.shouldRequestFocus=!0),null!=this._top&&this._top.uie.popable()&&window.removeEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),e&&e.uie.popable()&&window.addEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),this._top=e},getTop(){return this._top},refocusTopUie(){setTimeout((()=>{null!=this._top&&document.activeElement===document.body&&this._top.uie.requestFocus()}),0)},root:void 0,verbose:!1};function d(e,t,r,n){let i;i=r&&n?"":r&&!n?"":!r&&n?"":"",e===l.Manager.root&&(i="");let a=e.uie.getDisplayName();e===l.Manager.getTop()&&(a=`${a} `);const o=`(${function(e){switch(e){case s.ACTIVE:return"A";case s.PASSIVE:return"P";case s.INACTIVE:return"I";case s.DEAD:return"D"}}(e.getState())})${n?"\n":""}`;return`${t.join("")}${i} ${a} ${o}`}function u(e,t,r){return d(e,t,r,!!e.children.length)+e.children.map(((n,i)=>{const a=i<e.children.length-1;return u(n,r?t.concat([" "]):t.concat(["  "]),a)})).join("\n")}window.addEventListener("keydown",(e=>{if(e.keyCode!==o.default.ESC)return;const t=l.Manager.getTop(),r=(null==t?void 0:t.getState())===s.ACTIVE?t:l.findMostRecentlyActiveDismissable();r&&r.uie.escapable()&&(e.stopPropagation(),e.preventDefault(),r&&r.uie.requestDismiss(!1))}),{capture:!0});let p=null;function f(e,t){const r=e&&e.getState()===s.ACTIVE&&e.uie.popable()?e:l.findMostRecentlyActiveDismissable();if(!r||!r.uie.popable())return null;const n=r.uie.getNode();return n&&t.target instanceof Node&&n.contains(t.target)?null:r}window.addEventListener("mousedown",(e=>{if(p=null,!e.screenX||!e.screenY)return;const t=f(l.Manager.getTop(),e);t&&2===e.button?t.uie.requestDismiss():p=t}),{capture:!0}),window.addEventListener("mouseup",(e=>{if(!e.screenX||!e.screenY)return void(p=null);const t=f(l.Manager.getTop(),e);t&&t===p&&setTimeout((()=>t.uie.requestDismiss()),0),p=null}),{capture:!0})},18644:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIE=void 0;var i=r(89618),a=r(67294),o=n(r(38701)),s=n(r(2773)),l=r(85893);let c=null;class d extends a.Component{constructor(e,t){super(e,t),this._didMount=!1,this._pendingRequestFocus=!1,this._requestFocusTimeout=null,this._refAnchorElement=(0,a.createRef)(),this._setRefChild=e=>{const t="function"==typeof(null==e?void 0:e.getComponent)?e.getComponent():e;this._refChild=t,this.props.children&&"function"==typeof this.props.children.ref&&this.props.children.ref(t)},this.uim=this.context?this.context.branch(this):new i.UIM(void 0,this)}componentDidUpdate(e){e.uimState!==this.props.uimState&&this.uim.setState(this.props.uimState)}componentWillUnmount(){c&&this._requestFocusTimeout===c&&(clearTimeout(c),c=null),this.uim.pop(!0,this.props.requestRecentFocusOnUnmount)}activate(){this.uim.activate()}popable(){return this.props.popable}escapable(){return this.props.escapable}requestDismiss(e){this.props.requestDismiss&&this.props.requestDismiss(e)}componentDidMount(){const{requestFocus:e}=this.props;this._didMount=!0,e&&this._pendingRequestFocus&&this._maybeCallRequestFocus()}requestFocus(){const{requestFocus:e}=this.props;e&&this._didMount?this._maybeCallRequestFocus():this._pendingRequestFocus=!0}getDisplayName(){return this.props.displayName}getRef(){return this._refChild}getUIMState(){return this.props.uimState}getNode(){const e=this._refChild;if(null!=e){if(e instanceof HTMLElement)return e;let t="";try{const r=e.getElement();if(null==r||r instanceof HTMLElement)return r;t=`Non HTML element received:\n${(0,o.default)(r.constructor)}`}catch(e){t=`${e.message}:\n${e.stack}`}__LOG__(4,void 0,new Error,!0)`UIE received a child component that does not have a compatible API:\n${t}`,SEND_LOGS("uie-bad-child-api");const r=this._refAnchorElement.current;if((null==r?void 0:r.previousElementSibling)instanceof HTMLElement)return r.previousElementSibling}return null}render(){const{children:e}=this.props;if(!e)return null;const t=(0,a.cloneElement)(e,{ref:this._setRefChild});return(0,l.jsxs)(s.default.Provider,{value:this.uim,children:[t,(0,l.jsx)("div",{ref:this._refAnchorElement,style:{display:"none"},hidden:!0})]})}_maybeCallRequestFocus(){const{requestFocus:e}=this.props;e&&(c&&clearTimeout(c),this._requestFocusTimeout=c=setTimeout((()=>{e(),this._requestFocusTimeout=c=null}),0))}}t.UIE=d,d.State=i.UIM.State,d.defaultProps={uimState:i.UIM.State.ACTIVE,requestRecentFocusOnUnmount:!0},d.contextType=s.default,d.displayName="UIE"},33358:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(67294),i=r(85893),a=(0,n.forwardRef)((function(e,t){let{children:r}=e;const a=(0,n.useRef)();return(0,n.useImperativeHandle)(t,(()=>({getElement:()=>a.current}))),(0,i.jsx)("div",{ref:a,children:r})}));t.default=a},2773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,r(67294).createContext)(null);t.default=n},78123:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHAT_WALLPAPER=void 0,t.colorExistsInTheme=function(e,t){const r=u(t);return e===i||r.some((t=>t.toUpperCase()===e.toUpperCase()))},t.getDoodleAssetName=function(e,t){if(n.ServerProps.wallpapersV2&&"light"===t&&e!==i){const r=p(e,t,"doodle");if(r)return`data-asset-chat-background-${r}`}let r=`data-asset-chat-background-${t}`;"light"===t&&e===i&&(r="data-asset-chat-background-dark");return r},t.getDoodleOpacity=function(e,t){if(n.ServerProps.wallpapersV2){const r=p(e,t,"opacity");if(r)return r}if("light"===t&&e===i)return"0.4";return"0.06"},t.getWallpaperColorPropValue=p,t.getWallpaperColors=u,t.invertTransparentWallpaperColors=function(e,t){if(n.ServerProps.wallpapersV2)return"light"===e&&t!==i&&!!p(t,e,"invertTransparentWallpaperColors");const r=o.includes(t);return!!u(e).includes(t)&&(r?"light"===e:"dark"===e)},t.toggleWallpaperColor=function(e,t){const r=u(t);if(e===i)return i;if(n.ServerProps.wallpapersV2){const n=r.findIndex((t=>t.toUpperCase()===e.toUpperCase()));if(-1!==n)return"light"===t?d[n]:c[n]}return e};var n=r(64551);const i="default_chat_wallpaper";t.DEFAULT_CHAT_WALLPAPER=i;const a=["#ccebdc","#aed8c7","#7acba5","#c7e9eb","#a9dbd8","#68d5d9","#6ec3d4","#f2dad5","#f2d5e1","#fbcad2","#ffa7a8","#cbdaec","#d7d3eb","#e5c0eb","#d0deb1","#dee0b4","#e6dfa8","#f7e9a8","#ffd1a4","#ff8a8c","#ff5978","#f56056","#dc6e4f","#e6e365","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#dee3e9","#d9dade","#c0c1c4","#7e90a3","#55626f","#243640","#162127"],o=["#ff8a8c","#ff5978","#f56056","#dc6e4f","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#7e90a3","#55626f","#243640","#162127"],s={"#BBE4E5":{doodle:"dark",opacity:"0.42"},"#AED8C7":{doodle:"dark",opacity:"0.3"},"#7ACBA5":{doodle:"dark",opacity:"0.26"},"#CBDAEC":{doodle:"dark",opacity:"0.42"},"#66D2D5":{doodle:"dark",opacity:"0.26"},"#63BDCF":{doodle:"dark",opacity:"0.26"},"#D6D0F0":{doodle:"dark",opacity:"0.36"},"#CECECE":{doodle:"dark",opacity:"0.36"},"#D1DABE":{doodle:"dark",opacity:"0.36"},"#E6E1B1":{doodle:"dark",opacity:"0.42"},"#FEEFA9":{doodle:"light",opacity:"0.06"},"#FED297":{doodle:"dark",opacity:"0.42"},"#FD9A9B":{doodle:"dark",opacity:"0.26"},"#FD6769":{doodle:"dark",opacity:"0.26"},"#FB4668":{doodle:"dark",opacity:"0.26"},"#922040":{doodle:"dark",opacity:"0.17",invertTransparentWallpaperColors:!0},"#DC6E4F":{doodle:"dark",opacity:"0.2"},"#644D52":{doodle:"dark",opacity:"0.13",invertTransparentWallpaperColors:!0},"#517E7E":{doodle:"dark",opacity:"0.13"},"#3190BB":{doodle:"dark",opacity:"0.13"},"#35558A":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#55626F":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#1D2326":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#301E34":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#ECF0F1":{doodle:"light",opacity:"0.06"},"#FFFEA2":{doodle:"light",opacity:"0.06"},"#E7E8D2":{doodle:"light",opacity:"0.06"}},l={"#0F2424":{doodle:"dark",opacity:"0.05"},"#12261F":{doodle:"dark",opacity:"0.055"},"#11241C":{doodle:"dark",opacity:"0.055"},"#111E27":{doodle:"dark",opacity:"0.06"},"#0F2224":{doodle:"dark",opacity:"0.06"},"#0E2125":{doodle:"dark",opacity:"0.055"},"#1F1D25":{doodle:"dark",opacity:"0.06"},"#212121":{doodle:"dark",opacity:"0.055"},"#1F211C":{doodle:"dark",opacity:"0.055"},"#23231B":{doodle:"dark",opacity:"0.055"},"#262419":{doodle:"dark",opacity:"0.055"},"#261F17":{doodle:"dark",opacity:"0.055"},"#261717":{doodle:"dark",opacity:"0.055"},"#260F10":{doodle:"dark",opacity:"0.06"},"#260A10":{doodle:"dark",opacity:"0.07"},"#19050B":{doodle:"dark",opacity:"0.075"},"#21100C":{doodle:"dark",opacity:"0.07"},"#0F0C0C":{doodle:"dark",opacity:"0.065"},"#101919":{doodle:"dark",opacity:"0.06"},"#0A1D25":{doodle:"dark",opacity:"0.055"},"#0D1523":{doodle:"dark",opacity:"0.065"},"#0D0F11":{doodle:"dark",opacity:"0.07"},"#0A0C0D":{doodle:"dark",opacity:"0.07"},"#110B12":{doodle:"dark",opacity:"0.07"},"#1E1F1F":{doodle:"dark",opacity:"0.055"},"#262618":{doodle:"dark",opacity:"0.055"},"#23231F":{doodle:"dark",opacity:"0.055"}},c=Object.keys(s),d=Object.keys(l);function u(e){return n.ServerProps.wallpapersV2?"light"===e?c:d:a}function p(e,t,r){const n="light"===t?s:l;for(const t in n)if(t.toUpperCase()===e.toUpperCase())return n[t][r];return null}},32554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayHighQualityLinkPreview=function(e,t){if(!Boolean(e.thumbnailDirectPath||e.thumbnailHQ)||null==e.thumbnailHeight||null==e.thumbnailWidth)return!1;if(a(e.t))return!1;return!(t===n.DISPLAY_TYPE.GALLERY)},t.hqLinkPreviewExpired=a;var n=r(5177),i=r(22683);function a(e){return i.Clock.globalUnixTime()-e>2592e3}},94270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionBubbleType=void 0;const n=r(76672).Mirrored(["DEFAULT","NON_CONVERSATION","STICKER","MEDIA_ITEM"]);t.ReactionBubbleType=n},38701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e?e:e&&(e.displayName||e.name)||"Component"}},7128:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedComponent=t.HOCRef=void 0,t._getComponent=function(){const e=this.component||this.refs.component;if("function"==typeof e._getComponent)return e._getComponent();return e};var i=n(r(81109)),a=n(r(45095)),o=r(67294);t.HOCRef="component";class s extends o.Component{constructor(e){super(e),this.setComponent=e=>{this.component=e},this.state=(0,i.default)({},this.state)}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){__LOG__(4,void 0,new Error,!0)`${e.stack}\n${t.componentStack}`,SEND_LOGS("component-did-catch")}getComponent(){return this.component instanceof s?this.component.getComponent():(0,a.default)(this.component,"this.component")}}t.WrappedComponent=s},84387:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ListenerHOC=function(e){var t,r;return(t=class extends d.WrappedComponent{constructor(){super(...arguments),this.listeners=new f}componentDidMount(){this.listeners.internalUseOnlyMarkMounted()}componentWillUnmount(){this.listeners.internalUseOnlyMarkUnmounted()}_getComponent(){return d._getComponent.call(this)}render(){return this.state.hasError?null:(0,p.jsx)(e,(0,a.default)((0,a.default)({ref:this.setComponent},this.props),{},{listeners:this.listeners}))}}).defaultProps=null!==(r=e.defaultProps)&&void 0!==r?r:void 0,t.displayName=`Listener(${(0,c.default)(e)})`,t.wrappedComponent=null,t},t.Listeners=void 0;var a=i(r(81109)),o=r(89385),s=r(88102),l=r(92200),c=i(r(38701)),d=r(7128),u=r(59923),p=r(85893);class f{constructor(){this._mounted=!1,this._unmounted=!1,this._listeners=new Set,this._remove=e=>{e.disengage(),this._listeners.delete(e)}}_add(e){this._unmounted?__LOG__(3)`Listener added after unmounting`:(this._listeners.add(e),this._mounted&&e.engage())}internalUseOnlyMarkMounted(){this._mounted=!0,this._listeners.forEach((e=>{e.engage()}))}internalUseOnlyMarkUnmounted(){this._unmounted=!0,this._listeners.forEach(this._remove),this._abortController&&this._abortController.abort()}add(e,t,r,n){const i=this,a=new u.Listener(e,t,(function(){i._unmounted||r.apply(this,arguments)}),n,r);this._add(a)}addOnce(e,t,r,n){const i=this,a=new u.Listener(e,t,(function(){i._remove(a),i._unmounted||r.apply(this,arguments)}),n,r);this._add(a)}remove(e,t,r,n){this._listeners.forEach((i=>{i.represents(e,t,r,n)&&this._remove(i)}))}uiIdle(e){s.Cmd.uiBusy?this.addOnce(s.Cmd,"ui_idle",e):(this._abortController=this._abortController||new n,(0,l.documentFlushed)({signal:this._abortController.signal}).then((()=>{e()}),(e=>{if(e.name!==o.ABORT_ERROR)throw e})))}testsOnlyGetListeners(){return this._listeners}}t.Listeners=f},31019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unproxy=function(e){if(null==e?void 0:e.$ProxyState$state)return e.$ProxyState$state;return e}},4478:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;return(t=class extends l.WrappedComponent{constructor(){var e;super(...arguments),e=this,this._timers=new Map,this._timerId=0,this._unmounted=!1,this.setInterval=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting interval after unmount"));const r=++this._timerId,n=window.setInterval(e,t);return this._timers.set(r,(()=>{window.clearInterval(n),this._timers.delete(r)})),r},this.clearInterval=e=>{const t=this._timers.get(e);t&&t()},this.setTimeout=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting timeout after unmount"));const[r,n]=this._cbWrapper(e),i=window.setTimeout(n,t);return this._timers.set(r,(()=>{window.clearTimeout(i),this._timers.delete(r)})),r},this.clearTimeout=e=>{const t=this._timers.get(e);t&&t()},this.requestAnimationFrame=e=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Requesting animation frame after unmount"));const[t,r]=this._cbWrapper(e),n=window.requestAnimationFrame(r);return this._timers.set(t,(()=>{window.cancelAnimationFrame(n),this._timers.delete(t)})),t},this.cancelAnimationFrame=e=>{const t=this._timers.get(e);t&&t()},this.throttle=(t,r,n)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Throttling after unmount"));const[i,a]=this._cbWrapper(t),s=(0,o.default)(a,r,n),l=s.cancel.bind(s);s.cancel=()=>{l(),this._timers.delete(i)};const c=function(){e._unmounted||(e._timers.set(i,s.cancel),s(...arguments))};return c.cancel=s.cancel,c.flush=s.flush,c},this.debounce=(t,r,n)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Debouncing after unmount"));const[i,o]=this._cbWrapper(t),s=(0,a.default)(o,r,n),l=s.cancel.bind(s),c=s.flush.bind(s);s.cancel=()=>{l(),this._timers.delete(i)},s.flush=()=>{c()};const d=function(){e._unmounted||(e._timers.set(i,s.cancel),s(...arguments))};return d.cancel=s.cancel,d.flush=s.flush,d},this._cbWrapper=t=>{const r=++this._timerId;return[r,function(){e._timers.delete(r),t(...arguments)}]}}_getComponent(){return l._getComponent.call(this)}componentWillUnmount(){this._unmounted=!0,this._timers.forEach((e=>e()))}render(){return this.state.hasError?null:(0,c.jsx)(e,(0,i.default)({ref:this.setComponent,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,requestAnimationFrame:this.requestAnimationFrame,cancelAnimationFrame:this.cancelAnimationFrame,debounce:this.debounce,throttle:this.throttle},this.props))}}).displayName=`Timer(${(0,s.default)(e)})`,t.wrappedComponent=null,t};var i=n(r(81109)),a=n(r(23279)),o=n(r(23493)),s=n(r(38701)),l=r(7128),c=r(85893)},90012:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r;return(t=class extends s.WrappedComponent{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.getUnmountSignal=()=>(this._controller||(this._controller=new n,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort()}_getComponent(){return s._getComponent.call(this)}render(){return this.state.hasError?null:(0,l.jsx)(e,(0,a.default)({ref:this.setComponent,getUnmountSignal:this.getUnmountSignal},this.props))}}).defaultProps=null!==(r=e.defaultProps)&&void 0!==r?r:void 0,t.displayName=`UnmountSignal(${(0,o.default)(e)})`,t.wrappedComponent=null,t};var a=i(r(81109)),o=i(r(38701)),s=r(7128),l=r(85893)},56599:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.initModules=function(){c()};var a=i(r(51463)),o=r(91903),s=r(46582);const l={minTimeout:1e3,maxTimeout:12e4,retries:1/0,signal:(new n).signal};const c=(0,a.default)((function(){return(0,o.exponentialBackoff)(l,((e,t)=>Promise.all([r.e(2101),r.e(7964)]).then(r.bind(r,67019)).catch((r=>(__LOG__(3)`failed to load main bundle`,10===t&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("failed to load main bundle")),e(r)))))).then((e=>(0,s.setMainBundleModules)(e)))}))},46582:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMainBundleModules=o,t.requireCallCollection=function(){return S.apply(this,arguments)},t.requireChatCollection=function(){return m.apply(this,arguments)},t.requireClearAppStates=function(){return _.apply(this,arguments)},t.requireContactCollection=function(){return l.apply(this,arguments)},t.requireEmojiAssetMapCreator=function(){return p.apply(this,arguments)},t.requireEmojiConfig=function(){return u.apply(this,arguments)},t.requireHandleSocketMessage=function(){return d.apply(this,arguments)},t.requireHandleVideoStreamingRequest=function(){return h.apply(this,arguments)},t.requireLabelCollection=function(){return g.apply(this,arguments)},t.requireLoadProtoVersions=function(){return c.apply(this,arguments)},t.requireMain=function(){return s.apply(this,arguments)},t.requireMsgCollection=function(){return y.apply(this,arguments)},t.requireSetHandlers=function(){return C.apply(this,arguments)},t.requireStatusV3Collection=function(){return f.apply(this,arguments)},t.requireStickerPackCollection=function(){return E.apply(this,arguments)},t.requireVoip=function(){return v.apply(this,arguments)},t.requireVoipCommonDisabled=function(){return T.apply(this,arguments)},t.setMainBundleModules=function(e){return a.resolve(e),e};var i=n(r(48926));const a=new(r(88156).Resolvable);function o(){return a.promise}function s(){return(s=(0,i.default)((function*(){return(yield o()).requireMain()}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){return(yield o()).requireContactCollection()}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(){return(yield o()).requireLoadProtoVersions()}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){return(yield o()).requireHandleSocketMessage()}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){return(yield o()).requireEmojiConfig()}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){return(yield o()).requireEmojiAssetMapCreator()}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){return(yield o()).requireStatusV3Collection()}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){return(yield o()).requireClearAppStates()}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){return(yield o()).requireHandleVideoStreamingRequest()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){return(yield o()).requireLabelCollection()}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){return(yield o()).requireChatCollection()}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return(yield o()).requireMsgCollection()}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){return(yield o()).requireStickerPackCollection()}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){return(yield o()).requireCallCollection()}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){return(yield o()).requireVoip()}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){return(yield o()).requireVoipCommonDisabled()}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){return(yield o()).requireSetHandlers()}))).apply(this,arguments)}},59923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=void 0,t.isEventsType=o;var i=n(r(81703)),a=n(r(34342));function o(e){return e instanceof a.default||"function"==typeof e.on&&"function"==typeof e.off}t.Listener=class{constructor(e,t,r,n,a){this._hasEngaged=!1,this._hasDisengaged=!1,this.source=e,this.cb=r,this.opts=n,this._cbIdentifier=a,o(e)?this.event=t:this.event=i.default.prefix(t,e)}engage(){if(this._hasEngaged||this._hasDisengaged)return;this._hasEngaged=!0;const e=this.source,t=this.event;o(e)?(e.on(t,this.cb),"function"==typeof e.incObservers&&e.incObservers()):this.opts?e.addEventListener(t,this.cb,this.opts):e.addEventListener(t,this.cb)}disengage(){if(this._hasDisengaged)return;if(this._hasDisengaged=!0,!this._hasEngaged)return;const e=this.source,t=this.event;o(e)?(e.off(this.event,this.cb),"function"==typeof e.decObservers&&e.decObservers()):this.opts?e.removeEventListener(t,this.cb,this.opts):e.removeEventListener(t,this.cb)}represents(e,t,r,n){var i;if(this.source!==e)return!1;if(this.event!==t)return!1;if(this._cbIdentifier!==r)return!1;const{capture:a=!1,once:o=!1,passive:s=!1}=null!=n?n:{},{capture:l=!1,once:c=!1,passive:d=!1}=null!==(i=this.opts)&&void 0!==i?i:{};return a===l&&o===c&&s===d}}},65273:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(30988)),o=n(r(18446)),s=r(50833),l=r(39581),c=n(r(48014)),d=r(47732),u=r(39989),p=n(r(16186)),f=n(r(24055)),_=n(r(46668)),h=r(81829);class g{static create(){const{backgroundColor:e,tintColor:t}=d.DEFAULT_DOMINANT_COLOR.getBackgroundAndTintColors();return new g({id:Math.random(),frame:new f.default({origin:new p.default({x:0,y:0}),size:new _.default({width:0,height:0}),rotation:0,scale:0}),layers:[],paintLayer:new s.DrawLayer({size:_.default.empty(),type:s.DrawLayerType.Paint}),outlineLayer:new s.DrawLayer({size:_.default.empty(),type:s.DrawLayerType.Outline}),background:null,selectedLayer:null,backgroundColor:e,tintColor:t,rotation:0,cropFrame:new f.default({origin:new p.default({x:0,y:0}),size:new _.default({width:0,height:0}),rotation:0,scale:0})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}_update(e){const t=(0,i.default)({},this._props);return null!=e.layers&&(t.layers=e.layers),void 0!==e.paintLayer&&(t.paintLayer=e.paintLayer),void 0!==e.outlineLayer&&(t.outlineLayer=e.outlineLayer),void 0!==e.background&&(t.background=e.background),void 0!==e.frame&&(t.frame=e.frame,t.frame&&(t.cropFrame=t.cropFrame.updateXYWidthHeight({x:0,y:0,width:t.frame.width,height:t.frame.height}))),void 0!==e.cropFrame&&(t.cropFrame=e.cropFrame),void 0!==e.selectedLayer&&(t.selectedLayer=e.selectedLayer),null!=e.backgroundColor&&(t.backgroundColor=e.backgroundColor),null!=e.tintColor&&(t.tintColor=e.tintColor),null!=e.rotation&&(t.rotation=e.rotation),(0,o.default)(this._props,t)?this:new g(t)}updateLayer(e,t){if(e instanceof h.TextLayer&&!(t instanceof h.TextLayer)||e instanceof u.ImageLayer&&!(t instanceof u.ImageLayer))throw new TypeError("MediaEditorData: calling _updateLayer with two different layer types");if(e===t)return this;const r=this.layers.map((r=>r===e?t:r));let n=this.selectedLayer;return n===e&&(n=t),this._update({layers:r,selectedLayer:n})}setBackground(e,t){const{fitToSquare:r=!1,scale:n=1}=null!=t?t:{},i=u.ImageLayer.create({type:u.ImageLayerType.Background,origin:new p.default({x:0,y:0}),image:e,editable:!0,scale:n}),a=i.frame.dimension,o=r?f.default.create({x:0,y:0,width:a,height:a,scale:1,rotation:0}):i.frame,l=new p.default({x:(o.width-i.width)/2,y:(o.height-i.height)/2}),c=i.setScale(n).setOrigin(l),_=(0,d.getDominantColor)(e),{backgroundColor:h,tintColor:g}=_.getBackgroundAndTintColors(),m=new s.DrawLayer({size:o.size,type:s.DrawLayerType.Paint}),y=new s.DrawLayer({size:o.size,type:s.DrawLayerType.Outline});return this._update({background:c,frame:o,backgroundColor:h,tintColor:g,paintLayer:m,outlineLayer:y})}updateBackground(e,t,r,n){var i;const a=null===(i=this.background)||void 0===i?void 0:i.setImage(e).setOrigin(t).setRotation(r).setScale(n);return this._update({background:a,selectedLayer:a})}addImageLayer(e){const t=u.ImageLayer.create(e),r=[...this.layers,t];return this._update({layers:r,selectedLayer:t})}addImageLayerToCenter(e){const t=this.toCanvasPoint(new p.default({x:this.screenWidth/2,y:this.screenHeight/2})),r=new p.default({x:t.x-e.image.width/2,y:t.y-e.image.height/2}),n=(0,i.default)({origin:r,rotation:-this.rotation},e);return this.addImageLayer(n)}addTextLayer(e){const t=e instanceof h.TextLayer?e:h.TextLayer.create((0,i.default)((0,i.default)({},e),{},{rotation:-this.rotation})),r=[...this.layers,t];return this._update({layers:r,selectedLayer:t})}setText(e,t){return this.updateLayer(e,e.setText(t))}setTextColor(e,t){return this.updateLayer(e,e.setTextColor(t))}setTextBackground(e,t){return this.updateLayer(e,e.setTextBackground(t))}setFont(e,t){return this.updateLayer(e,e.setFont(t))}setAlignment(e,t){return this.updateLayer(e,e.setAlignment(t))}setRotation(e){if(e%90!=0)throw new Error("canvas can only be rotated at a 90 degrees interval");return this._update({rotation:e%360})}setCrop(e,t){if(e.x<0||e.y<0||e.x+t.width>this.width||e.y+t.height>this.height)throw new Error("canvas crop must stays within the frame bound");const r=new f.default({origin:e,size:t,rotation:0,scale:0});return this._update({cropFrame:r})}addEmptyTextLayer(e,t){const r={origin:new p.default({x:this.width/4,y:this.height/2}),text:"",textColor:e,textBackground:!1,font:t,alignment:l.TextAlignment.CENTER};return this.addTextLayer(r)}addPaintPath(e){const t=this.paintLayer.addPath(e);return this._update({paintLayer:t})}addOutlinePath(e){const t=this.outlineLayer.addPath(e);return this._update({outlineLayer:t})}cropToOutline(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;if(this.outlineLayer.isEmpty())return this;const r=this.outlineLayer.getAllPoints(),n=(0,c.default)(r,this.frame.rotation,this.frame.scale),i=null!=t?t:n.size.dimension,a=e*n.size.dimension/i,o=n.addPadding(a,this.frame);return this.setCrop(o.origin,o.size)}clearOutlinePaths(){const e=this.outlineLayer.clearPaths();return this._update({outlineLayer:e})}translateLayer(e,t){return this.updateLayer(e,e.setOrigin(t))}translateBackground(e){var t;const r=null===(t=this.background)||void 0===t?void 0:t.setOrigin(e);return this._update({background:r,selectedLayer:r})}transformLayer(e,t,r){return this.updateLayer(e,e.setRotation(t).setScale(r))}transformBackground(e,t){var r;const n=null===(r=this.background)||void 0===r?void 0:r.setRotation(e).setScale(t);return this._update({background:n,selectedLayer:n})}setSelectedLayer(e){return this._update({selectedLayer:e})}moveToTop(e){if(this.layers[this.layers.length-1]===e)return this;const t=[...this.layers.filter((t=>t!==e)),e];return this._update({layers:t})}clearSelectedLayer(){return this._update({selectedLayer:null})}deleteLayer(e){e.delete();let t={layers:this.layers.filter((t=>t!==e))};return e===this.selectedLayer&&(t=(0,i.default)((0,i.default)({},t),{},{selectedLayer:null})),this._update(t)}deleteAllLayers(){return this.layers.forEach((e=>e.delete())),this._update({layers:[],paintLayer:new s.DrawLayer({size:this.size,type:s.DrawLayerType.Paint}),outlineLayer:new s.DrawLayer({size:this.size,type:s.DrawLayerType.Outline}),selectedLayer:null})}hasEdits(){return!this.paintLayer.isEmpty()||!this.outlineLayer.isEmpty()||this.layers.length>0||0!==this.rotation||!this.size.equals(this._props.cropFrame.size)}get layers(){return this._props.layers}get lastTextLayer(){const e=(0,a.default)(this.layers,(e=>e instanceof h.TextLayer));return e instanceof h.TextLayer?e:null}get paintLayer(){return this._props.paintLayer}get outlineLayer(){return this._props.outlineLayer}get background(){return this._props.background}get selectedLayer(){return this._props.selectedLayer}get backgroundColor(){return this._props.backgroundColor}get tintColor(){return this._props.tintColor}get size(){return this._props.frame.size}get frame(){return this._props.frame}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get cropWidth(){return this._props.cropFrame.width}get cropHeight(){return this._props.cropFrame.height}get cropOrigin(){return this._props.cropFrame.origin}get cropSize(){return this._props.cropFrame.size}get cropCenter(){return this._props.cropFrame.getCenter()}get screenWidth(){return this.rotation%180==0?this.cropWidth:this.cropHeight}get screenHeight(){return this.rotation%180==0?this.cropHeight:this.cropWidth}get canvasCenter(){return new p.default({x:this.width/2,y:this.height/2})}get rotation(){return this._props.rotation}get id(){return this._props.id}toScreenPoint(e){const t=Math.max(this.width,this.height),r=new p.default({x:t/2,y:t/2}),n=new p.default({x:e.x+(t-this.width)/2,y:e.y+(t-this.height)/2}).rotate(r,this.rotation),i=new p.default({x:this.cropCenter.x+(t-this.width)/2,y:this.cropCenter.y+(t-this.height)/2}).rotate(r,this.rotation),a=new p.default({x:i.x-this.screenWidth/2,y:i.y-this.screenHeight/2});return new p.default({x:n.x-a.x,y:n.y-a.y})}toCanvasPoint(e){const t=Math.max(this.width,this.height),r=new p.default({x:t/2,y:t/2}),n=this.cropCenter.rotate(r,this.rotation),i=new p.default({x:n.x-this.screenWidth/2,y:n.y-this.screenHeight/2}),a=new p.default({x:e.x+i.x,y:e.y+i.y}).rotate(r,-this.rotation);return new p.default({x:a.x,y:a.y})}resetCropRotate(){return this.setRotation(0).setCrop(new p.default({x:0,y:0}),new _.default({width:this.width,height:this.height}))}isRotated(){return 0!==this.rotation}isCropped(){return!this.cropOrigin.equals(new p.default({x:0,y:0}))||!this.cropSize.equals(this.size)}isOutlined(){return!this.outlineLayer.isEmpty()}}t.default=g},92320:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COLORS=void 0,t.getAllColors=function(){return Object.keys(i)},t.getColorValue=function(e){return a[e]};var n=r(16241);const i=Object.freeze({BLACK:"BLACK",GRAY:"GRAY",WHITE:"WHITE",BLUE:"BLUE",GREEN:"GREEN",PURPLE:"PURPLE",ORANGE:"ORANGE",RED:"RED"});t.COLORS=i;const a={[i.BLACK]:n.Color.fromHex("#434343"),[i.GRAY]:n.Color.fromHex("#9DA0A9"),[i.WHITE]:n.Color.fromHex("#FFFFFF"),[i.BLUE]:n.Color.fromHex("#33CEFF"),[i.GREEN]:n.Color.fromHex("#64DC2F"),[i.PURPLE]:n.Color.fromHex("#BD73FF"),[i.ORANGE]:n.Color.fromHex("#F49226"),[i.RED]:n.Color.fromHex("#FF4A4A")}},39581:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlignment=t.FONTS=void 0,t.getAllFonts=function(){return Object.keys(i)},t.getFontStyle=function(e){return a[e]},t.getFontTranslation=function(e){switch(e){case i.SANS_SERIF:return n.fbt._("Sans Serif",null,{hk:"oqthG"});case i.SERIF:return n.fbt._("Serif",null,{hk:"1EWGvo"});case i.NORICAN_REGULAR:return n.fbt._("Norican",null,{hk:"RU2yb"});case i.BRYNDAN_WRITE:return n.fbt._("Bryndan Write",null,{hk:"2d40Ei"});case i.OSWALD_HEAVY:return n.fbt._("Oswald",null,{hk:"vyZEQ"});default:throw new Error("Unsupported font")}};var n=r(48360);const i=Object.freeze({SANS_SERIF:"SANS_SERIF",SERIF:"SERIF",NORICAN_REGULAR:"NORICAN_REGULAR",BRYNDAN_WRITE:"BRYNDAN_WRITE",OSWALD_HEAVY:"OSWALD_HEAVY"});t.FONTS=i;const a={[i.SANS_SERIF]:{fontFamily:"sans-serif"},[i.SERIF]:{fontFamily:'"Droid Serif", serif'},[i.NORICAN_REGULAR]:{fontFamily:'"Norican"'},[i.BRYNDAN_WRITE]:{fontFamily:'"Bryndan-Write"'},[i.OSWALD_HEAVY]:{fontFamily:'"Oswald"',fontWeight:"bold"}},o=r(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.TextAlignment=o},70638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class r{constructor(e){const{points:t,color:r,thickness:n,smoothing:i}=e;this._points=[...t],this._color=r,this._thickness=n,this._smoothing=i,Object.freeze(this)}update(e){let t=this.points,n=this.color,i=this.thickness,a=this.smoothing;return null!=e.points&&(t=e.points),null!=e.color&&(n=e.color),null!=e.thickness&&(i=e.thickness),null!=e.smoothing&&(a=e.smoothing),new r({points:t,color:n,thickness:i,smoothing:a})}clone(){const e={points:[...this.points],color:this.color.clone(),thickness:this.thickness,smoothing:this.smoothing};return new r(e)}toString(){return`points: [${this.points.map((e=>e.toString())).join(", ")}]\ncolor: ${this.color.toString()}\nthickness: ${this.thickness}`}equals(e){return this.color.equals(e.color)&&Math.abs(this.thickness-e.thickness)<Number.EPSILON&&this.points.length===e.points.length&&this.points.every(((t,r)=>t.equals(e.points[r])))}isDrag(){return this.points.length>1}isSmooth(){return this.smoothing||this.isDrag()}isStraight(){return!this.isSmooth()}get points(){return this._points}get color(){return this._color}get thickness(){return this._thickness}get smoothing(){return this._smoothing}}t.default=r},16186:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446));class o{constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.x&&(t.x=e.x),null!=e.y&&(t.y=e.y),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.x}x, ${this.y}y)`}equals(e){return Math.abs(this.x-e.x)<Number.EPSILON&&Math.abs(this.y-e.y)<Number.EPSILON}distance(e){return Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2)}rotate(e,t){const r=t*Math.PI/180,n=this.x-e.x,i=this.y-e.y,a=Math.cos(r)*n-Math.sin(r)*i+e.x,s=Math.sin(r)*n+Math.cos(r)*i+e.y;return new o({x:Math.round(100*a)/100,y:Math.round(100*s)/100})}get x(){return this._props.x}get y(){return this._props.y}}t.default=o},24055:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446)),o=n(r(16186)),s=n(r(46668));class l{static create(e){return new l({origin:new o.default({x:e.x,y:e.y}),size:new s.default({width:e.width,height:e.height}),rotation:e.rotation,scale:e.scale})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}updateXYWidthHeight(e){const t=(0,i.default)({},this._props);return null==e.x&&null==e.y||(t.origin=t.origin.update({x:e.x,y:e.y})),null==e.width&&null==e.height||(t.size=t.size.update({width:e.width,height:e.height})),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&(t.scale=e.scale),this.update(t)}update(e){const t=(0,i.default)({},this._props);return null!=e.origin&&(t.origin=e.origin),null!=e.size&&(t.size=e.size),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&Math.abs(t.scale-e.scale)>1e-6&&(t.scale=e.scale),(0,a.default)(this._props,t)?this:new l(t)}clone(){return new l(this._props)}addPadding(e,t){const r=this.getTopLeft(),n=t.getTopLeft(),i=new o.default({x:Math.max(n.x,r.x-e),y:Math.max(n.y,r.y-e)}),a=this.getBottomRight(),s=t.getBottomRight(),l=new o.default({x:Math.min(s.x,a.x+e),y:Math.min(s.y,a.y+e)}),c=l.x-i.x,d=l.y-i.y;return this.updateXYWidthHeight({x:i.x,y:i.y,width:c,height:d})}toString(){return`(${this.origin.toString()}, ${this.size.toString()}, ${this.rotation}r)`}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)&&this.rotation===e.rotation&&this.scale===e.scale}contains(e){return e.x>=this.x&&e.y>=this.y&&e.x<this.x+this.width&&e.y<this.y+this.height}getTopLeft(){return new o.default({x:this.x,y:this.y})}getTopCenter(){return new o.default({x:this.x+this.width/2,y:this.y})}getTopRight(){return new o.default({x:this.x+this.width,y:this.y})}getLeftCenter(){return new o.default({x:this.x,y:this.y+this.height/2})}getCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height/2})}getRightCenter(){return new o.default({x:this.x+this.width,y:this.y+this.height/2})}getBottomLeft(){return new o.default({x:this.x,y:this.y+this.height})}getBottomCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height})}getBottomRight(){return new o.default({x:this.x+this.width,y:this.y+this.height})}get origin(){return this._props.origin}get size(){return this._props.size}get x(){return this.origin.x}get y(){return this.origin.y}get width(){return this.size.width}get height(){return this.size.height}get rotation(){return this._props.rotation}get scale(){return this._props.scale}get dimension(){return this.size.dimension}}t.default=l},46668:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446));class o{constructor(e){const{width:t,height:r}=e;if(t<0)throw new RangeError("MediaEditor:Size width cannot be negative");if(r<0)throw new RangeError("MediaEditor:Size height cannot be negative");this._props=Object.freeze({width:t,height:r}),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.width}w, ${this.height}h)`}equals(e){return Math.abs(this.width-e.width)<Number.EPSILON&&Math.abs(this.height-e.height)<Number.EPSILON}isEmpty(){return this.equals(o.empty())}static empty(){return new o({width:0,height:0})}get width(){return this._props.width}get height(){return this._props.height}get dimension(){return Math.max(this.width,this.height)}}t.default=o},50833:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayerType=t.DrawLayer=void 0;var i=r(83428),a=n(r(70638)),o=n(r(16186)),s=n(r(24055));const l=r(76672).Mirrored(["Paint","Outline"]);t.DrawLayerType=l;class c{constructor(e){if(this._type=e.type,null!=e.size){const t=e.size;this._frame=new s.default({origin:new o.default({x:0,y:0}),size:t,rotation:0,scale:1}),this._paths=[]}else null!=e.frame&&null!=e.paths&&(this._frame=e.frame,this._paths=e.paths);e.id?this._id=e.id:this._id=(0,i.generateLayerId)(e.type),Object.freeze(this)}delete(){}_update(e){let t=this._paths;null!=e.paths&&(t=e.paths);const r=this._frame,n=this._type;return new c({id:this.id,paths:t,frame:r,type:n})}setOrigin(){throw new TypeError("MediaEditor:DrawLayer resetting origin is not allowed")}setRotation(){throw new TypeError("MediaEditor:DrawLayer resetting rotation is not allowed")}setScale(){throw new TypeError("MediaEditor:DrawLayer resetting scale is not allowed")}addPath(e){const t=new a.default(e),r=[...this._paths,t];return this._update({paths:r})}clearPaths(){return this._update({paths:[]})}isEmpty(){return 0===this._paths.length}getAllPoints(){return this.paths.reduce(((e,t)=>(!t.smoothing&&e.length&&e.push(e[e.length-1]),t.isDrag()&&e.push(t.points[0]),e.push(...t.points.flatMap((e=>t.isSmooth()?[e]:[e,e]))),e)),[])}get paths(){return this._paths}get editable(){return!1}get id(){return this._id}get type(){return this._type}get frame(){return this._frame}get origin(){return this._frame.origin}get size(){return this._frame.size}get x(){return this._frame.x}get y(){return this._frame.y}get width(){return this._frame.width}get height(){return this._frame.height}get rotation(){return this._frame.rotation}get scale(){return this._frame.scale}}t.DrawLayer=c},39989:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayerType=t.ImageLayer=void 0;var i=n(r(81109)),a=n(r(18446)),o=r(83428),s=n(r(24055)),l=n(r(46668));const c=r(76672).Mirrored(["Image","Emoji","Sticker","Background"]);t.ImageLayerType=c;class d{static create(e){var t;const r=e.image.width,n=e.image.height;if(!r||!n)throw new Error("Image must have valid width and height");return new d({id:(0,o.generateLayerId)("image"),type:e.type,image:e.image,editable:e.editable,frame:new s.default({origin:e.origin,size:new l.default({width:r,height:n}),rotation:null!==(t=e.rotation)&&void 0!==t?t:0,scale:e.scale})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setFrame(e){return this._update({frame:e})}setImage(e){return this._update({image:e})}setEditable(e){return this._update({editable:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.image){const r=e.image.width,n=e.image.height;if(!r||!n)throw new Error("Image must have valid width and height");t.image=e.image,t.frame=new s.default({origin:this.frame.origin,size:new l.default({width:r,height:n}),rotation:this.frame.rotation,scale:this.frame.scale})}return null!=e.editable&&(t.editable=e.editable),null!=e.frame&&(t.frame=e.frame),(0,a.default)(this._props,t)?this:new d(t)}get image(){return this._props.image}get editable(){return this._props.editable}get id(){return this._props.id}get frame(){return this._props.frame}get origin(){return this._props.frame.origin}get size(){return this._props.frame.size}get x(){return this._props.frame.x}get y(){return this._props.frame.y}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get rotation(){return this._props.frame.rotation}get scale(){return this._props.frame.scale}isSticker(){return this._props.type===c.Sticker}isEmoji(){return this._props.type===c.Emoji}isBackground(){return this._props.type===c.Background}}t.ImageLayer=d},81829:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=t.DEFAULT_FONT_SIZE=void 0;var i=n(r(81109)),a=n(r(18446)),o=r(16241),s=r(92320),l=(r(39581),r(83428)),c=n(r(16186)),d=n(r(24055)),u=n(r(46668)),p=r(31323),f=r(51234);t.DEFAULT_FONT_SIZE=18;const _={lineVerticalPadding:6,lineHorizontalPadding:8,layerPadding:6,backgroundBorderRadius:5,backgroundShadow:{offsetX:0,offsetY:1,radius:6,spread:0,color:new o.Color(0,0,0,.32)}};class h{static create(e){var t;const r=[],n=g(r,_);let i=0;return null!=e.rotation&&(i=e.rotation),new h({id:(0,l.generateLayerId)("text"),text:"",textColor:e.textColor,textBackground:e.textBackground,font:e.font,alignment:e.alignment,lines:r,frame:new d.default({origin:new c.default({x:e.origin.x-n.width/2,y:e.origin.y-n.height/2}),size:n,rotation:i,scale:null!==(t=e.scale)&&void 0!==t?t:1}),maxWidth:0,backgroundPath:""}).setText(e.text)}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setText(e){return this._update({text:e})}setTextColor(e){return this._update({textColor:e})}setTextBackground(e){return this._update({textBackground:e})}setFont(e){return this._update({font:e})}setAlignment(e){return this._update({alignment:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.frame&&(t.frame=e.frame),null!=e.textColor&&(t.textColor=e.textColor),null!=e.textBackground&&(t.textBackground=e.textBackground),null!=e.text&&e.text!==t.text||null!=e.font&&e.font!==t.font){var r,n;t.text=null!==(r=e.text)&&void 0!==r?r:t.text,t.font=null!==(n=e.font)&&void 0!==n?n:t.font,t.lines=(0,f.getLines)(t.text,t.font,18,this._props.maxWidth);const i=g(t.lines,_),a=t.frame.size,o=t.frame.origin,s=new c.default({x:o.x+a.width/2-i.width/2,y:o.y+a.height/2-i.height/2});t.frame=t.frame.update({origin:s,size:i})}if(null!=e.alignment&&(t.alignment=e.alignment),this.font!==t.font||this.text!==t.text||this.alignment!==t.alignment){const e=t.lines.map((e=>e.width));t.backgroundPath=(0,p.generateTextBackgroundPath)(e,t.alignment,{lineVerticalPadding:this.styles.lineVerticalPadding,lineHorizontalPadding:this.styles.lineHorizontalPadding,lineHeight:this.lineHeight,arcSize:this.styles.backgroundBorderRadius})}return(0,a.default)(this._props,t)?this:new h(t)}get lines(){return this._props.lines}get linesOfText(){return this.lines.map((e=>e.text))}get lineWidths(){return this.lines.map((e=>e.width))}get numberOfLines(){return this.lines.length}get fontSize(){return 18}get lineHeight(){return this.fontSize}get styles(){return _}get text(){return this._props.text}get textColor(){return this._props.textColor}get textBackgroundColor(){return this.textColor.isLight()?(0,s.getColorValue)(s.COLORS.BLACK):(0,s.getColorValue)(s.COLORS.WHITE)}get textBackground(){return this._props.textBackground}get font(){return this._props.font}get editable(){return!0}get id(){return this._props.id}get alignment(){return this._props.alignment}get frame(){return this._props.frame}get origin(){return this.frame.origin}get size(){return this.frame.size}get x(){return this.frame.x}get y(){return this.frame.y}get width(){return this.frame.width}get height(){return this.frame.height}get rotation(){return this.frame.rotation}get scale(){return this.frame.scale}get backgroundPath(){return this._props.backgroundPath}}function g(e,t){const r=Math.max(...e.map((e=>e.width)),0)+2*t.lineHorizontalPadding+2*t.layerPadding,n=e.length*(18+2*t.lineVerticalPadding)+2*t.layerPadding;return new u.default({width:r,height:n})}t.TextLayer=h},16241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0,t.cleanHex=s,t.compareHex=function(e,t){if(!e||!t)return!1;const r=s(e),n=s(t);if(r===n)return!0;let i=0,a=0;for(;i<e.length;){if(r[i]!==n[a]||r[i]!==n[a+1])return!1;i+=1,a+=2}return!0},t.isValidHex=function(e){if(!e)return!1;const t=s(e);if(3===t.length)return r.test(t);if(6===t.length)return n.test(t);return!1};const r=/^[0-9A-F]{3}$/i,n=/^[0-9A-F]{6}$/i;class i{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e<0||e>255)throw new RangeError(`red (${e} given) should be >= 0 and <= 255`);if(t<0||t>255)throw new RangeError(`green (${t} given) should be >= 0 and <= 255`);if(r<0||r>255)throw new RangeError(`blue (${r} given) should be >= 0 and <= 255`);if(n<0||n>1)throw new RangeError(`alpha (${n} given) should be >= 0 and <= 1`);this._red=e,this._green=t,this._blue=r,this._alpha=n}static fromHex(e){let t=e.trim().toLowerCase();if(t.length&&"#"===t[0]&&(t=t.substr(1)),3!==t.length&&6!==t.length)throw new RangeError(`hex ${e} does not have 3 or 6 digits`);3===t.length&&(t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`);const r=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16);if(isNaN(r)||isNaN(n)||isNaN(a))throw new RangeError(`hex ${e} is invalid`);return new i(r,n,a,1)}static _fromHsl(e,t,r){let n,o,s;if(0===t||0===r)n=o=s=r;else{const i=r<.5?r*(1+t):r+t-r*t,l=2*r-i;n=a(l,i,e+1/3),o=a(l,i,e),s=a(l,i,e-1/3)}return new i(Math.round(255*n),Math.round(255*o),Math.round(255*s))}toRgb(){return{red:this._red,green:this._green,blue:this._blue}}toRgba(){return{red:this._red,green:this._green,blue:this._blue,alpha:this._alpha}}toRgbString(){return`rgb(${this._red}, ${this._green}, ${this._blue})`}toRgbaString(){return`rgba(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}toHex(){return`#${o(this._red.toString(16),2)}${o(this._green.toString(16),2)}${o(this._blue.toString(16),2)}`.toUpperCase()}toHsl(){const e=this._red/255,t=this._green/255,r=this._blue/255,n=Math.max(e,t,r),i=Math.min(e,t,r);let a=(n+i)/2,o=(n+i)/2;const s=(n+i)/2;if(n===i)a=o=0;else{const l=n-i;switch(o=s>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{hue:a,saturation:o,lightness:s}}getBackgroundAndTintColors(){const{hue:e,saturation:t,lightness:r}=this.toHsl();let n,a;if(r<.55&&t>.1){let o=e;e>.08&&e<.22&&(o=e<.08+.14?.08:.22),n=i._fromHsl(o,t<.01?0:Math.max(t,.75),Math.min(r,.25)),a=new i(255,255,255,1)}else n=i._fromHsl(e,Math.min(t,.33),Math.max(r,.9)),a=i._fromHsl(e,0===t?0:.4,.2);return{backgroundColor:n,tintColor:a}}withAlpha(e){return new i(this._red,this._green,this._blue,e)}isLight(){return.299*this._red+.587*this._green+.114*this._blue>190}isWhite(){const{lightness:e}=this.toHsl();return e>=.996}equals(e){return this._red===e._red&&this._green===e._green&&this._blue===e._blue&&this._alpha===e._alpha}clone(){return new i(this._red,this._green,this._blue,this._alpha)}toString(){return`(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}get red(){return this._red}get green(){return this._green}get blue(){return this._blue}get alpha(){return this._alpha}}function a(e,t,r){let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function o(e,t){return e.length>=t?e:"0".repeat(t-e.length)+e}function s(e){let t=e.trim();return"#"===t.substring(0,1)&&(t=t.substring(1).toLowerCase()),t}t.Color=i,i.Black=new i(0,0,0),i.White=new i(255,255,255)},83428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerId=function(e){const t=Math.random().toString(36).substring(2,10);return`${e}-${t}`}},48014:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=1/0,a=1/0,o=0,s=0;e.forEach((e=>{const t=e.x,r=e.y;t<n&&(n=t),t>o&&(o=t),r<a&&(a=r),r>s&&(s=r)}));const l=o-n,c=s-a;return i.default.create({x:n,y:a,width:l,height:c,rotation:t,scale:r})};var i=n(r(24055))},47732:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DOMINANT_COLOR=void 0,t.getDominantColor=function(e){const t=function(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return null;const n=t.height=e.height,i=t.width=e.width;r.drawImage(e,0,0);try{return r.getImageData(0,0,i,n).data}catch(e){return null}}(e);return t?function(e){let t=0,r=0,i=0,a=0,o=0;for(let n=0;n<e.length;n+=20){const s=e[n+3],l=e[n]*s,c=e[n+1]*s,d=e[n+2]*s;t+=l,r+=c,i+=d,a+=s,o++}return a?new n.Color(Math.round(t/a),Math.round(r/a),Math.round(i/a),Math.round(a/o)/255):new n.Color(0,0,0,0)}(t):i};var n=r(16241);const i=new n.Color(220,220,220);t.DEFAULT_DOMINANT_COLOR=i},31323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTextBackgroundPath=function(e,t,r){const a=r.arcSize,o=[],s=[],l=Math.max(...e),c=r.lineHeight+2*r.lineVerticalPadding;e.forEach(((i,a)=>{const d=i+2*r.lineHorizontalPadding;let u=0;switch(t){case n.TextAlignment.LEFT:u=0;break;case n.TextAlignment.CENTER:u=(l-i)/2;break;case n.TextAlignment.RIGHT:u=l-i}const p=a*c;o.push({y:p,x:u}),s.push({y:p,x:u+d}),a===e.length-1&&(o.push({y:p+c,x:u}),s.push({y:p+c,x:u+d}))}));let d=[];for(let{left:e,points:t}of[{left:!0,points:o},{left:!1,points:s}]){let r=t,n=!0;for(;n;){t=r,r=[],n=!1;for(let i=0;i<t.length;i++){const o=t[i];if(0===i)r.push(o);else{r.length>=2&&r[r.length-1].x===r[r.length-2].x&&(r.pop(),n=!0);const t=r[r.length-1];o.x!==t.x&&Math.abs(o.x-t.x)<2*a&&(n=!0,e&&t.x<o.x||!e&&t.x>o.x?o.x=t.x:t.x=o.x),r.push(o)}}}const i=[];for(let e=0;e<r.length;e++){const t=r[e];if(0===e||e===r.length-1){i.push(t);continue}const n=r[e-1];if(t.x!==n.x){const e={x:n.x,y:t.y},r=i.length-1;i.length>=2&&i[r].x===e.x&&i[r].x===i[r-1].x&&i.pop(),i.push(e)}i.push(t)}e||i.reverse(),d=d.concat(i)}return function(e,t){function r(t){return 0===t?e[e.length-1]:e[t-1]}function n(t){return t===e.length-1?e[0]:e[t+1]}const a=[];for(let o=0;o<e.length;o++){const{start:s,end:l,clockwise:c}=i(e[o],r(o),n(o),t),d=o===e.length-1?0:o+1,{start:u}=i(e[d],r(d),n(d),t);0===o&&a.push(`M ${s.x},${s.y}`),a.push(`A ${t},${t} 0 0 ${c?1:0} ${l.x},${l.y}`),a.push(`L ${u.x},${u.y}`)}return a.push("Z"),a.join("\n")}(d,a)};var n=r(39581);function i(e,t,r,n){const i=t.y===e.y,a={y:i?e.y:t.y>e.y?e.y+n:e.y-n,x:i?t.x>e.x?e.x+n:e.x-n:e.x},o=e.y===r.y;return{start:a,end:{y:o?e.y:r.y>e.y?e.y+n:e.y-n,x:o?r.x>e.x?e.x+n:e.x-n:e.x},clockwise:i&&(t.y<r.y&&t.x<r.x||t.x>r.x&&t.y>r.y)||!i&&(t.y<r.y&&t.x>r.x||t.x<r.x&&t.y>r.y)}}},51234:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLines=function(e,t,r,i){const a=[];for(const s of e.split("\n")){if(""===s){a.push({text:"",width:0,words:[]});continue}const e=s.split(" ");let l="",c=0,d=[];for(let s=0;s<e.length;s++){const u=(0!==s?" ":"")+e[s],p=l+u,f=o(p,t,r);if(i>0&&f>i&&c>0)a.push({text:l,width:c,words:d}),l="",c=0,d=[],s--;else{l=p,c=f;for(const e of u.split(n.EmojiUtil.emojiRegex())){if(!e)continue;let i=null;if(n.EmojiUtil.isEmoji(e)){const t=n.EmojiUtil.getGlyphId(e);null!=t&&(i=n.EmojiUtil.getGlyphPath(t,"xlarge").high)}const a=o(e,t,r);d.push({text:e,width:a,emojiPath:i})}}}c>0&&a.push({text:l,width:c,words:d})}return a},t.getTextBounds=function(e,t){const r=`${t}px ${(0,i.getFontStyle)(e).fontFamily}`,n=l.get(r);if(null!=n)return n;const a="ABCDEF",c=Math.round(o(a,e,t)),d=t,u=s().getContext("2d");u.textBaseline="middle",u.font=r,u.fillStyle="red",u.fillText(a,0,d/2);const p=u.getImageData(0,0,c,d).data;let f=1/0,_=1/0,h=1/0;for(let e=0;e<c;e++)for(let t=0;t<d;t++){p[4*(t*c+e)+3]>0&&(_=Math.min(_,t),f=Math.min(f,e),h=Math.min(h,d-t))}u.clearRect(0,0,c,d);const g={top:_,left:f,bottom:h};return l.set(u.font,g),g};var n=r(70449),i=r(39581);let a;function o(e,t,r){const a=s().getContext("2d");a.font=`${r}px ${(0,i.getFontStyle)(t).fontFamily}`;let o=0;for(const t of e.split(n.EmojiUtil.emojiRegex()))n.EmojiUtil.isEmoji(t)?o+=r:o+=a.measureText(t).width;return o}function s(){return null==a&&(a=document.createElement("canvas"),a.width=9999,a.height=99),a}const l=new Map},89248:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.useEffect)((()=>{c.Updater.restart(!0).then((()=>{c.Updater.restart()}))}),[]),(0,d.jsxs)(s.Modal,{cover:!0,title:o.default.t(807),children:[(0,d.jsx)("div",{children:o.default.t(806)}),(0,d.jsx)("div",{className:a.default.pending,children:(0,d.jsx)(l.Spinner,{stroke:4,size:40,color:"highlight"})})]})};var i=r(67294),a=n(r(8762)),o=n(r(43725)),s=r(57224),l=r(11054),c=r(29898),d=r(85893)},52665:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(48360),a=r(67294),o=n(r(39770)),s=r(29424),l=r(57224),c=r(85893);var d=(0,a.forwardRef)(((e,t)=>{const r=(0,a.useRef)();(0,a.useImperativeHandle)(t,(()=>({getElement:()=>r.current})));const n=t=>{var r;t.stopPropagation(),t.preventDefault(),null===(r=e.onCancel)||void 0===r||r.call(e)},d=e.onOK?(0,c.jsx)(o.default,{a8nText:"popup-controls-ok",type:"primary",onClick:t=>{var r;t.stopPropagation(),t.preventDefault(),null===(r=e.onOK)||void 0===r||r.call(e)},disabled:e.okDisabled,spinner:!0===e.okSpinner,children:e.okText||i.fbt._("OK",null,{hk:"2KEeHb"})}):null,u=e.onCancel?(0,c.jsx)(o.default,{a8nText:"popup-controls-cancel",type:e.onOK?"secondary":"primary",onClick:n,children:e.cancelText||i.fbt._("Cancel",null,{hk:"H0gNq"})}):null,p={escape:e.onCancel?n:()=>{}},f=(0,c.jsxs)(c.Fragment,{children:[u,d]});return(0,c.jsx)(s.HotKeys,{handlers:p,onRef:e=>{r.current=e},children:(0,c.jsx)(l.Modal,{actions:f,children:e.children,cover:e.cover,onDragChange:e.onDragChange,onDrop:e.onDrop,type:e.type,title:e.title})})}));t.default=d},8623:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t,cancelText:r,onCancel:n,okText:o,onOK:s}=e;return(0,a.jsx)(i.default,{cover:!0,children:t,cancelText:r,onCancel:n,okText:o,onOK:s})};var i=n(r(52665)),a=r(85893)},31760:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(13959),s=r(67294),l=r(88102),c=r(28237),d=r(99608),u=n(r(88624)),p=r(19529),f=r(65044),_=r(85893);const h=r(76672).Mirrored(["INITIAL_LOAD","CONNECTING","FAKE_FILL","DOWNLOADING","ORGANIZING"]),g=r(76672).Mirrored(["NOT_STARTED","STARTED","PAST_MIN_TIME"]);var m=e=>{let{onReady:t,onLogout:r,initialLoadReady:n}=e;const m=(0,u.default)(),y=(0,s.useRef)(!1),[E,S]=(0,s.useState)(n?d.Stage.CONNECTING:d.Stage.INITIAL_LOAD),[v,T]=(0,s.useState)({INITIAL_LOAD:n?g.PAST_MIN_TIME:g.NOT_STARTED,CONNECTING:g.NOT_STARTED,FAKE_FILL:g.NOT_STARTED,DOWNLOADING:g.NOT_STARTED,ORGANIZING:g.NOT_STARTED}),[C,A]=(0,s.useState)(0),[b,P]=(0,s.useState)(null);(0,p.useListener)(l.Cmd,"offline_progress_update",(()=>{v.CONNECTING===g.PAST_MIN_TIME&&A(c.OfflineMessageHandler.getOfflineDeliveryProgress());const e=c.OfflineMessageHandler.getHasMessagesToDownload();null==b&&null!=e&&P(e)}));const M=(0,s.useCallback)(function(){var e=(0,a.default)((function*(e,t){T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.STARTED}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - starts minimum display time`,yield(0,o.delayMs)(t),m()&&(T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.PAST_MIN_TIME}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - ends minimum display time`)}));return function(){return e.apply(this,arguments)}}(),[m]),{CONNECTING:O,DOWNLOADING:I,ORGANIZING:w,FAKE_FILL:R,INITIAL_LOAD:D}=v;return(0,s.useEffect)((()=>{if(w===g.PAST_MIN_TIME)y.current||(t(),y.current=!0);else if(I===g.PAST_MIN_TIME&&C>=100&&w===g.NOT_STARTED)(0,o.delayMs)(450).then((()=>{m()&&(S(d.Stage.ORGANIZING),M(h.ORGANIZING,800))}));else if(O===g.PAST_MIN_TIME&&null!=b&&I===g.NOT_STARTED&&R===g.NOT_STARTED){const e=c.OfflineMessageHandler.getFinishedDownloading();b&&!e?(S(d.Stage.DOWNLOADING),A(c.OfflineMessageHandler.getOfflineDeliveryProgress()),M(h.DOWNLOADING,450)):(A(100),M(h.FAKE_FILL,450).then((()=>{m()&&(f.Socket.hasSynced?y.current||(t(),y.current=!0):(S(d.Stage.ORGANIZING),M(h.ORGANIZING,800)))})))}else n&&D===g.PAST_MIN_TIME&&O===g.NOT_STARTED?(S(d.Stage.CONNECTING),M(h.CONNECTING,1500)):D===g.NOT_STARTED&&M(h.INITIAL_LOAD,500)}),[C,t,b,M,m,n,O,I,w,R,D]),(0,_.jsx)(d.LoadingScreen,{stage:E,progress:C,onLogout:r})};t.default=m},94049:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(48360),a=n(r(52665)),o=n(r(43725)),s=r(83578),l=r(65044),c=r(85893);t.default=()=>(0,c.jsx)(a.default,{cover:!0,cancelText:o.default.t(603),onCancel:l.Socket.logout.bind(l.Socket,!0,s.LogoutReason.UserInitiated),okText:o.default.t(581),onOK:l.Socket.poke.bind(l.Socket),children:i.fbt._('The version of WhatsApp on your phone is too old. Please update to the latest version, then click "LOG IN" to continue using WhatsApp.',null,{hk:"2gorpJ"})})},79592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(67294),a=n(r(83322)),o=n(r(41502)),s=r(85893);function l(e,t){const{disableFromWithin:r,onDrop:n,onDragChange:l}=e,[c,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[f,_]=(0,i.useState)(!1),h=(0,o.default)(u),g=()=>{r&&d(!0)},m=()=>{r&&d(!1)},y=e=>{e.preventDefault(),e.stopPropagation(),u||c||(p(!0),_(!1),function(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}(e))};return(0,i.useEffect)((()=>{null!=h&&h!==u&&l&&l(u,f)}),[f,u,l,h]),(0,i.useImperativeHandle)(t,(()=>({onDragStart:g,onDragEnd:m,onDragOver:y}))),(0,s.jsx)("div",{className:a.default.mask,style:u?{}:{display:"none"},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),u&&(p(!1),_(!1))},onDrop:e=>{e.preventDefault(),e.stopPropagation(),p(!1),_(!0),n&&!c&&n(e)}},"mask")}var c=(0,i.forwardRef)(l);t.default=c},13259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,p.jsx)(a.default,{cover:!0,cancelText:o.default.t(603),onCancel:f,okText:i.fbt._("UPDATE",null,{hk:"2YdJcK"}),onOK:_,children:i.fbt._("Please update to the latest version of WhatsApp. This version has expired.",null,{hk:"2Gcdji"})})};var i=r(48360),a=n(r(52665)),o=n(r(43725)),s=r(83578),l=n(r(11339)),c=r(48694),d=r(29898),u=r(65044),p=r(85893);function f(){var e;u.Socket.logout(!0,s.LogoutReason.UserInitiated),new l.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:l.default.FORCE_UPGRADE_USER_ACTION_TYPE.LOGOUT,forceUpgradeReason:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit()}function _(){var e;new l.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:l.default.FORCE_UPGRADE_USER_ACTION_TYPE.UPGRADE,forceUpgradeReason:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit(),d.Updater.update(null,!0,0)}},99608:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.LoadingScreen=void 0;var i=n(r(94184)),a=r(48360),o=r(67294),s=n(r(39770)),l=n(r(43725)),c=n(r(56074)),d=n(r(24326)),u=n(r(24161)),p=n(r(59909)),f=r(19529),_=r(85893);const h=r(76672).Mirrored(["INITIAL_LOAD","CONNECTING","DOWNLOADING","ORGANIZING"]);t.Stage=h;const g=e=>{(0,o.useEffect)((()=>{const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const t=(0,p.default)();(0,f.useListener)(l.default,"locale_change",t);const r=e.stage===h.INITIAL_LOAD,n=e.stage===h.CONNECTING,g=e.stage===h.DOWNLOADING,E=e.stage===h.ORGANIZING,S=(0,i.default)(d.default.container,{[d.default.containerFixed]:!e.debug,[d.default.initialLoad]:r,[d.default.connecting]:n,[d.default.downloading]:g,[d.default.organizing]:E,[d.default.web]:!0}),v=(0,i.default)(d.default.graphic,{[d.default.shimmering]:r||E}),T=(0,i.default)(d.default.logout,{[d.default.showWarning]:g}),C=(0,i.default)(d.default.warning,{[d.default.showWarning]:g});let A;switch(e.stage){case h.INITIAL_LOAD:A=l.default.t(1034);break;case h.CONNECTING:A=l.default.t(357);break;case h.DOWNLOADING:A=(0,_.jsx)(c.default,{id:594,params:{progress:e.progress}});break;case h.ORGANIZING:A=a.fbt._("Organizing messages",null,{hk:"2ldft"})}return(0,_.jsxs)("div",{className:S,children:[(0,_.jsx)("div",{className:v,children:(0,_.jsx)(m,{})}),(0,_.jsx)("div",{className:d.default.progress,children:(0,_.jsx)(u.default,{value:e.progress,max:100})}),(0,_.jsx)("div",{className:d.default.main,children:A}),(0,_.jsxs)("div",{className:d.default.secondary,children:[(0,_.jsx)(y,{})," ",l.default.t(401)]}),null,null!=e.onLogout&&(0,_.jsx)("div",{className:T,children:(0,_.jsx)(s.default,{type:"plain-white",onClick:e.onLogout,children:l.default.t(603)})}),(0,_.jsx)("div",{className:C,children:a.fbt._("Don't close this window. Your messages are downloading.",null,{hk:"23nekH"})})]})},m=()=>(0,_.jsx)("span",{children:(0,_.jsxs)("svg",{width:"250px",height:"52px",viewBox:"0 0 250 52",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,_.jsxs)("g",{className:d.default.dots,children:[(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"65.7636689",cy:"21.1046108",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"81.0791876",cy:"19.3283142",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"96.3947063",cy:"17.7846275",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"111.710225",cy:"17.5274031",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"127.025744",cy:"17.6118619",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"142.341262",cy:"18.4196288",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"157.656781",cy:"19.9893339",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"172.9723",cy:"22.0657859",r:"3.65625"})]}),(0,_.jsx)("path",{className:d.default.laptop,d:"M190.14097 4.7518926h48.227869l.281462-.00596781c1.058365-.00288774 2.664865.25185461 2.695721 2.87464716.142823 12.13996425 0 22.28077555 0 34.40910725 0 .06028-.024112.168784-.036168.217008l-16.394805-.0086927c-12.47317.0007215-24.136918.0136044-37.78743-.0033633l-.010915-6.2953341c-.030319-9.5718533-.105914-18.2714581.010915-28.31872515.033356-2.86867935 1.976535-2.91690333 3.013351-2.86867935zm20.097267 4.28597465l-19.256815-.00079524.002426 4.98254029c-.000422 6.5558423-.012657 12.8111695-.002954 19.3619492l.011919 4.9777941h46.536157l.008754-4.9777414c.010547-8.1882109.002637-15.913459.002637-24.3331514l-27.302124-.01059555zM179.195421 44.6572387c.397848-.036168.807752-.024112 1.2056-.024112 9.620684 0 19.241369-.012056 28.862053 0 .132616.4701838.54252 1.6393289 1.036816 1.6393289 3.255119.012056 4.510238 0 7.765357 0 .542519.036168.988591-1.1450331 1.133263-1.6513849 9.910029 0 19.820057.012056 29.730086.012056.084392.012056.265232.036168.349624.048224-.016075.2571945-.016075 1.0085894 0 2.2541846 0 1.4209691-1.193544 1.8201689-1.965128 2.1215688-.421959.1205599-.868031.1326159-1.289991.1928959h-63.560505c-.651024-.072336-1.350272-.108504-1.916904-.4701838-.566631-.2893439-1.000647-.7595278-1.350271-1.2779356v-2.8446419z",fill:"currentColor"}),(0,_.jsx)("path",{className:d.default.logo,d:"M37.7314595,31.1612046 C37.0876293,30.8391042 33.9223475,29.2816062 33.332139,29.0666255 C32.7419305,28.8517683 32.3127104,28.7444016 31.8834903,29.3887258 C31.4542703,30.0332973 30.2204788,31.4835521 29.8447567,31.91339 C29.4692818,32.3428571 29.0936834,32.3968494 28.4499768,32.0745019 C27.8060232,31.7521544 25.7314595,31.0723707 23.272278,28.8787027 C21.3582085,27.171583 20.0661004,25.0632896 19.6905019,24.4185946 C19.315027,23.7741467 19.6505946,23.4257297 19.9729421,23.1046178 C20.2625483,22.8161235 20.6167722,22.352556 20.9386255,21.9767104 C21.2606023,21.6007413 21.3678456,21.3320154 21.5824556,20.9026718 C21.7970657,20.472834 21.6898224,20.0968649 21.528834,19.7746409 C21.3678456,19.452417 20.0801853,16.2831815 19.543722,14.993915 C19.0210965,13.7387491 18.4903166,13.9087567 18.0950733,13.8887413 C17.7199691,13.870085 17.2902548,13.8661313 16.8611583,13.8661313 C16.4319382,13.8661313 15.7343629,14.0272433 15.144278,14.6716911 C14.5540695,15.3163861 12.8908108,16.8740077 12.8908108,20.0429961 C12.8908108,23.2121081 15.1978996,26.2734826 15.5198765,26.7031969 C15.8417297,27.1330348 20.0597992,33.6360772 26.5184865,36.4250193 C28.05461,37.0883707 29.2539305,37.4846023 30.1888494,37.7811274 C31.7312742,38.2713822 33.1348263,38.2021931 34.2440772,38.0363861 C35.4810811,37.8515521 38.0533127,36.478888 38.5898996,34.9750116 C39.1263629,33.470888 39.1263629,32.1818687 38.9653745,31.91339 C38.8045097,31.6447876 38.3752896,31.4835521 37.7314595,31.1612046 M25.9838765,47.2013591 L25.9752278,47.2013591 C22.1322625,47.1998763 18.3629343,46.1674749 15.0745946,44.2160926 L14.2926332,43.7519074 L6.18674906,45.8782394 L8.35027028,37.9751042 L7.84111198,37.1648494 C5.69723552,33.7549343 4.56500386,29.8139923 4.56660833,25.767166 C4.57130502,13.9587954 14.1789652,4.35187645 25.9924016,4.35187645 C31.7128649,4.35385328 37.0902239,6.58458689 41.1338378,10.6327722 C45.1773282,14.680834 47.4028724,20.0618996 47.4007737,25.7843398 C47.3959539,37.5936988 37.7882934,47.2013591 25.9838765,47.2013591 M44.2112742,7.556695 C39.3464092,2.68614672 32.8767258,0.00271814672 25.9836293,0 C11.7809421,0 0.221652509,11.5584247 0.215969112,25.7654363 C0.21411583,30.3069652 1.40058687,34.7397683 3.65553668,38.6475984 L-4.61852778e-14,52 L13.6596757,48.4167413 C17.4233205,50.4695597 21.6607876,51.5516293 25.9733745,51.5531121 L25.9838765,51.5531121 L25.984,51.5531121 C40.1852046,51.5531121 51.7456062,39.9934517 51.7512912,25.7860695 C51.7538842,18.9011274 49.0761392,12.4271197 44.2112742,7.556695",fill:"currentColor"})]})}),y=()=>(0,_.jsx)("span",{children:(0,_.jsx)("svg",{width:"10px",height:"12px",viewBox:"0 0 10 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,_.jsx)("path",{d:"M5.00847986,1.6 C6.38255462,1.6 7.50937014,2.67435859 7.5940156,4.02703389 L7.59911976,4.1906399 L7.599,5.462 L7.75719976,5.46214385 C8.34167974,5.46214385 8.81591972,5.94158383 8.81591972,6.53126381 L8.81591972,9.8834238 C8.81591972,10.4731038 8.34167974,10.9525438 7.75719976,10.9525438 L2.25767996,10.9525438 C1.67527998,10.9525438 1.2,10.4731038 1.2,9.8834238 L1.2,6.53126381 C1.2,5.94158383 1.67423998,5.46214385 2.25767996,5.46214385 L2.416,5.462 L2.41679995,4.1906399 C2.41679995,2.81636129 3.49135449,1.68973395 4.84478101,1.60510326 L5.00847986,1.6 Z M5.00847986,2.84799995 C4.31163824,2.84799995 3.73624912,3.38200845 3.6709675,4.06160439 L3.6647999,4.1906399 L3.663,5.462 L6.35,5.462 L6.35111981,4.1906399 C6.35111981,3.53817142 5.88169076,2.99180999 5.26310845,2.87228506 L5.13749818,2.85416626 L5.00847986,2.84799995 Z",fill:"currentColor"})})}),E=(0,o.memo)(g);t.LoadingScreen=E},7260:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(48360),a=n(r(79436)),o=r(11054),s=r(13923),l=r(85893);var c=()=>(0,l.jsx)("div",{className:a.default.background,children:(0,l.jsxs)("div",{className:a.default.mainWrapper,children:[(0,l.jsx)(o.Spinner,{size:50,stroke:4,color:"highlight"}),(0,l.jsx)(s.TextDiv,{className:a.default.logoutTitle,size:"32",children:i.fbt._("Logging Out",null,{hk:"1YEOxc"})}),(0,l.jsx)(s.TextDiv,{theme:"muted",children:i.fbt._("Do not close this window",null,{hk:"14ygD4"})})]})});t.default=c},57224:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=function(e){const t=(0,s.useRef)(null),r=null!=e.title?(0,u.jsx)("div",{"data-a8n":a.default.key("popup-title"),className:d.default.popupTitle,children:e.title}):null,n=e.type===p.CustomSize&&e.dimensions?{height:`${e.dimensions.height}px`,width:`${e.dimensions.width}px`}:null,f=(0,o.default)(d.default.popup,{[d.default.popupFlexInvite]:e.type===p.Invite,[d.default.popupFlexUpgrade]:e.type===p.Upgrade,[d.default.popupBox]:e.type===p.Box,[d.default.popupFlex]:e.type===p.Flex,[d.default.popupTower]:e.type===p.Tower,[d.default.popupAuto]:e.type===p.Auto,[d.default.popupColumnButtons]:e.type===p.ColumnButtons,[d.default.popupMultiline]:e.type===p.Multiline,[d.default.popupCustomSize]:e.type===p.CustomSize}),_=(0,i.default)(e.actions)?null:(0,u.jsx)("div",{className:d.default.popupControls,children:e.actions}),h=(0,o.default)("overlay",d.default.backdrop,{[d.default.backdropCover]:e.cover,[d.default.popupGuide]:e.type===p.Guide}),g=(0,u.jsx)("div",{className:d.default.popupContainer,children:(0,u.jsx)("div",{className:f,"data-animate-modal-popup":!0,style:n,children:(0,u.jsxs)("div",{className:d.default.popupBody,"data-animate-modal-body":!0,children:[r,(0,u.jsx)("div",{"data-a8n":a.default.key("popup-contents"),className:d.default.popupContents,children:e.children}),_]})})});return(0,u.jsxs)(l.default,{className:h,onDragOver:e=>{var r;null===(r=t.current)||void 0===r||r.onDragOver(e)},onDragStart:e=>{var r;null===(r=t.current)||void 0===r||r.onDragStart(e)},onDragEnd:e=>{var r;null===(r=t.current)||void 0===r||r.onDragEnd(e)},ref:e.onRef,"data-animate-modal-backdrop":!0,children:[e.onDrop&&(0,u.jsx)(c.default,{ref:t,disableFromWithin:!0,onDragChange:e.onDragChange,onDrop:e.onDrop}),g]})},t.ModalTheme=void 0;var i=n(r(41609)),a=n(r(99964)),o=n(r(94184)),s=r(67294),l=n(r(5354)),c=n(r(79592)),d=n(r(17152)),u=r(85893);const p=r(76672).Mirrored(["Box","Flex","Guide","Tower","Auto","Invite","ColumnButtons","Multiline","Upgrade","CustomSize"]);t.ModalTheme=p},66776:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,t.ModalManager=function(e){const{type:t,contextMenuRef:r}=e,n=(0,s.useRef)(null),[S,v]=(0,s.useState)(void 0),[T,C]=(0,s.useState)(null),[A,b]=(0,s.useState)(m),[P,M]=(0,s.useState)(void 0),[O,I]=(0,s.useState)(!1),w=()=>{if(!n.current)return;const e=n.current.getNode();e&&!e.contains(document.activeElement)&&o.default.focus(e)},R=()=>{if(!n.current)return;const e=n.current.getNode();e&&o.default.focus(e)},D=e=>{(e=>{const t=e.relatedTarget,n=null==r?void 0:r.current,i=!!n&&n.isOpen();return t instanceof HTMLElement&&!e.currentTarget.contains(t)&&!i})(e)&&w()},N=e=>{S&&(v(void 0),C(null),e&&b(e))},L=e=>{e===T&&N()};let k;(0,_.useListener)(c.Cmd,`open_${t}`,(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.transition||m;const{uim:i,blockClose:o}=r;S&&(n=y);const c=(0,a.default)(`ModalManager${t}`);let d=e;t===E&&(d=(0,s.cloneElement)(e,{requestFocus:R})),l.default.unstable_batchedUpdates((()=>{v(d),C(c),b(n),M(i),I(null!=o&&o)}))})),(0,_.useListener)(c.Cmd,`close_${t}`,N),S&&(k=(0,g.jsx)(p.UIE,{displayName:`Modal${(0,i.default)(e.type)}`,escapable:!O,ref:n,requestFocus:w,requestDismiss:L.bind(null,T),children:e.type===E?(0,g.jsx)(u.default,{onBlur:D,children:S}):(0,g.jsx)(d.RotateFocus,{children:S})},T));return(0,g.jsx)(f.default.Consumer,{children:e=>(0,g.jsx)(f.default.Provider,{value:P||e,children:(0,g.jsx)(h.default,{transitionName:A,children:k})})})},t.ModalType=void 0;var i=n(r(11700)),a=n(r(73955)),o=n(r(52013)),s=r(67294),l=n(r(73935)),c=r(88102),d=r(87956),u=n(r(22179)),p=r(18644),f=n(r(2773)),_=r(19529),h=n(r(41956)),g=r(85893);const m="modal",y="none",E="modal";t.ModalType=E;t.MediaType="media"},96753:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(48360),a=n(r(43725)),o=r(57224),s=r(85893);t.default=()=>(0,s.jsx)(o.Modal,{title:i.fbt._("Computer not connected",null,{hk:"300jSy"}),cover:!0,children:a.default.t(590)})},43951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(48360),a=n(r(52665)),o=r(12591),s=r(96384),l=n(r(43725)),c=r(85893);function d(){(0,o.openExternalLink)((0,s.getCannotConnectFaqUrl)())}t.default=()=>(0,c.jsx)(a.default,{cover:!0,title:l.default.t(259),okText:l.default.t(554),onOK:d,children:i.fbt._("Your computer is connected to a network that prevents WhatsApp from working correctly",null,{hk:"GhGFR"})})},57050:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81629)),a=r(48360),o=n(r(30381)),s=r(67294),l=n(r(52665)),c=r(12591),d=r(96384),u=n(r(43725)),p=r(84387),f=r(99608),_=n(r(39326)),h=r(8080),g=n(r(4478)),m=r(65044),y=r(85893);class E extends s.PureComponent{constructor(e){super(e),this._forceUpdate=()=>{this.forceUpdate()},this._retried=()=>{null!=this.timeout&&(this.props.clearTimeout(this.timeout),this.timeout=null),null!=this.interval&&(this.props.clearInterval(this.interval),this.interval=null),this.setState({retriable:!1}),this.startTimeout()},this._allowRetry=()=>{this.setState({retriable:!0}),this.interval=this.props.setInterval(this._forceUpdate,1e3)},this.retry=()=>{m.Socket.poke(),this._retried()},this._onLearnMoreClick=()=>{(0,c.openExternalLink)((0,d.getCannotConnectFaqUrl)())},this.state={retriable:!1}}componentDidMount(){this.startTimeout();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e),this.props.listeners.add(h.Stream,"change:displayInfo",this._forceUpdate),this.props.listeners.add(m.Socket,"change:retryTimestamp",this._retried)}startTimeout(){this.timeout=this.props.setTimeout(this._allowRetry,3e3)}logout(){__LOG__(2)`Startup: user selected logout`,m.Socket.logout()}render(){let e,t,r,n;const{progress:s}=this.props;switch(h.Stream.displayInfo){case h.StreamInfo.OPENING:e=u.default.t(358),t=u.default.t(590),n=this.logout;break;case h.StreamInfo.PAIRING:case h.StreamInfo.TIMEOUT:e=u.default.t(785),t=(0,y.jsxs)("span",{children:[a.fbt._("Make sure your phone has an active Internet connection.",null,{hk:"4u0X1o"}),(0,y.jsx)("span",{className:_.default.action,onClick:this._onLearnMoreClick,role:"button",children:u.default.t(554)})]}),n=this.logout;break;case h.StreamInfo.SYNCING:case h.StreamInfo.CONNECTING:return(0,y.jsx)(f.LoadingScreen,{progress:s,stage:f.Stage.INITIAL_LOAD});default:return h.Stream.mode===h.StreamMode.MAIN?(0,y.jsx)(f.LoadingScreen,{progress:s,stage:f.Stage.INITIAL_LOAD}):null}const c=this.state.retriable;if(c){const e=m.Socket.retryTimestamp-Date.now();if(isNaN(e)||e<1)r=u.default.t(726),(0,i.default)((()=>m.Socket.poke()));else if(e<6e4){const t=Math.ceil(e/1e3);r=u.default.t(728,{number:t,_plural:t})}else r=u.default.t(727,{duration:o.default.duration(e).humanize()})}else r=u.default.t(726);return(0,y.jsxs)(l.default,{cover:!0,title:e,okText:u.default.t(725),onOK:c?this.retry:()=>{},cancelText:n?u.default.t(603):null,onCancel:n,children:[r,(0,y.jsx)("hr",{className:_.default.divider}),(0,y.jsx)("div",{className:_.default.textTip,children:t})]})}}E.displayName="Startup";var S=(0,g.default)((0,p.ListenerHOC)(E));t.default=S},37538:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,d.default)();let r,n;(0,p.useListener)(c.Stream,"change:displayInfo",t);const[g]=(0,u.default)(t,1e3),[m]=(0,f.useTimeout)(g,6e3),y=c.Stream.displayInfo;(0,i.useEffect)((()=>{m();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const E=()=>{__LOG__(2)`Startup: user selected logout`,_.Socket.logout()};switch(y){case c.StreamInfo.OPENING:case c.StreamInfo.PAIRING:case c.StreamInfo.TIMEOUT:r=s.default.t(358),n=s.default.t(590);break;case c.StreamInfo.SYNCING:case c.StreamInfo.CONNECTING:return(0,h.jsx)(o.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E});default:return c.Stream.mode===c.StreamMode.MAIN?(0,h.jsx)(o.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E}):null}return(0,h.jsxs)(a.default,{cover:!0,title:r,cancelText:s.default.t(603),onCancel:E,children:[(0,h.jsx)("hr",{className:l.default.divider}),(0,h.jsx)("div",{className:l.default.textTip,children:n})]})};var i=r(67294),a=n(r(52665)),o=n(r(31760)),s=n(r(43725)),l=n(r(57525)),c=r(8080),d=n(r(59909)),u=n(r(98007)),p=r(19529),f=r(99935),_=r(65044),h=r(85893)},99736:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,l.jsxs)(i.default,{cover:!0,cancelText:a.default.t(603),onCancel:s.Socket.logout.bind(s.Socket,!0,o.LogoutReason.UserInitiated),okText:a.default.t(581),onOK:s.Socket.poke.bind(s.Socket),children:[e.description,"",e.children]})};var i=n(r(52665)),a=n(r(43725)),o=r(83578),s=r(65044),l=r(85893)},58955:(e,t,r)=>{"use strict";t.TG=function(e){const{promise:t,reason:r}=e;if(a.Logger.logUncaughtError(r,t),!d(r))return;const i=r instanceof Error&&r.stack?null:`unhandled-rejection: ${r}`;n.upload({reason:i,hasTaggedMessage:!0})},t.HC=function(e,t,i,o,u){if(function(e){const t=[...s];return t.push(...l),t.some((t=>{let{partialUserAgent:r,partialMsg:n}=t;return c.includes(r)&&String(e).includes(n)}))}(e))return __LOG__(3)`Ignored Error: ${e||(u||"").toString()}`,!0;try{const{UIM:e}=r(89618);e.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}const p=t.split("?")[0];let f;f=p&&"number"==typeof i?` (${p}:${i}:${o})`:p?` (${p})`:"";if("Script error."===e&&!u)return a.Logger.logUncaughtError(`${f} ${e}`),p&&n.upload({reason:"script-error",hasTaggedMessage:!0}),!1;const _=u instanceof Error&&u.stack?u:`${e||`Given: ${String(u)}`}`;if(a.Logger.logUncaughtError(_),!d(u))return!0;return n.upload({reason:null,hasTaggedMessage:!0}),!0};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(85965)),i=r(64103),a=r(70818);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}const s=[{partialUserAgent:"Chrome",partialMsg:"ResizeObserver loop limit exceeded"}],l=[{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'style' of null"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"Unexpected token :"},{partialUserAgent:"Firefox/52.0,,Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.4) Gecko/20100101 Firefox/52.0",partialMsg:"Cannot read property 'style' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15",partialMsg:"is not an object"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'getElementsByTagName' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36",partialMsg:"Can't find variable: dismissKeyboard"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"ReferenceError: None is not defined"}],c=window.navigator.userAgent;function d(e){return!(e instanceof i.DbOnLogoutAbort)}},27838:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getIsTabActive=function(){return s},t.isAnotherTabActive=function(){return l.apply(this,arguments)},t.setTabActive=function(){s=!0};var i=n(r(48926)),a=n(r(25613)),o=n(r(64237));let s=!1;function l(){return(l=(0,i.default)((function*(){const e=navigator.serviceWorker;if(null==e?void 0:e.controller)try{return(yield a.default.request(e.controller,o.default.ACTIVE_TAB)).some((e=>!0===e.isActive))}catch(e){return __LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("ACTIVE_TAB service worker call failed"),!1}return!1}))).apply(this,arguments)}},97628:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeContext=t.THEME_ASSETS=void 0,t.applyThemeToUI=u,t.getSystemThemeMode=c,t.getTheme=function(){var e;if(c())return o.default.getCurrentTheme();return null!==(e=(0,a.getTheme)())&&void 0!==e?e:"light"},t.setSystemThemeMode=d,t.setTheme=l;var i=r(67294),a=r(99234),o=n(r(3137));const s={light:[{id:"bg-chat-light",selectors:["[data-asset-chat-background-light]"],low:{default:r(33557)},high:{default:r(33557)}},{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:r(29347)},high:{default:r(29347)}},{id:"intro-connection-light",selectors:["[data-asset-intro-image-light]"],low:{default:r(5250)},high:{default:r(12891)}}],dark:[{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:r(29347)},high:{default:r(29347)}},{id:"intro-connection-dark",selectors:["[data-asset-intro-image-dark]"],low:{default:r(35729)},high:{default:r(74548)}}]};function l(e){(0,a.setTheme)(e),u(e)}function c(){var e;return null===(e=(0,a.getSystemThemeMode)())||void 0===e||e}function d(e){(0,a.setSystemThemeMode)(e)}function u(e){const t=document.body;null==t||t.classList.toggle("dark","dark"===e)}t.THEME_ASSETS=s;const p={theme:o.default.getCurrentTheme(),systemThemeMode:!0,setTheme:l,setSystemThemeMode:d},f=(0,i.createContext)(p);t.ThemeContext=f},99964:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={key(e){}};t.default=r},81703:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r="animation",n="transition";var i={_normalize(e,t,r){const n=e.toLowerCase().indexOf(t),i=e.slice(0,n).toLowerCase();return 0===e.indexOf(t)?i+e.slice(n)+r.toLowerCase():i+e.slice(n)+r},prefix(e,t){let i;if(0===e.indexOf(r)){i=e.substring(r.length);const t=window.Modernizr?window.Modernizr.prefixed(r):r;return this._normalize(t,r,i)}if(0===e.indexOf(n)){i=e.substring(n.length);const t=window.Modernizr?window.Modernizr.prefixed(n):n;return this._normalize(t,n,i)}return window.Modernizr.prefixed(e,t,!1)||e}};t.default=i},5177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TYPE=void 0;t.DISPLAY_TYPE={CONVERSATION:"CONVERSATION",MSG_INFO:"MSG_INFO",STARRED_MSGS:"STARRED_MSGS",GALLERY:"GALLERY",REPLY_STAGE:"REPLY_STAGE",QUOTED_MSG:"QUOTED_MSG",CONTACT_CARD:"CONTACT_CARD",ORDER:"ORDER"}},45120:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(21338));var a=new class{constructor(){this.shouldIndicateFocusTimestamp=0}shouldIndicateFocus(){this.shouldIndicateFocusTimestamp=Date.now()}maybeIndicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;Date.now()-this.shouldIndicateFocusTimestamp>200||this.indicateFocus(e,t)}indicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}};t.default=a},52013:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(57319);let i=[],a=!1;const o=new n.ShiftTimer((function(){i=[],a=!1}));document.addEventListener("keydown",(()=>{o.forceRunNow()}),{capture:!0,passive:!0});var s={focus(e,t){if(e&&(!i.length||e!==i[i.length-1])){if(a=a||null!=window.event,function(e){5===i.length&&i.shift(),i.push(e)}(e),function(){if(i.length<5)return!1;const e=new Set;for(let t=0;t<i.length;t++){if(e.has(i[t]))return!0;e.add(i[t])}return!1}()&&!a)return __LOG__(4,void 0,new Error,!0)`Focus loop encountered.`,void SEND_LOGS("focus-loop");o.onOrBefore(75),e.focus(t)}}};t.default=s},41906:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCROLL_FUDGE=t.QR_EDGE=t.LAYOUT_2COLUMNS_MAX_WIDTH=void 0;t.SCROLL_FUDGE=100;t.LAYOUT_2COLUMNS_MAX_WIDTH=1024;t.QR_EDGE=264},28298:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uiPadding=t.uiMargin=void 0;n(r(56720));const i={horizMinus6:{marginEnd:"n3fdhnkw",marginStart:"heai6z19"},startMinus6:{marginStart:"heai6z19"},endMinus6:{marginEnd:"n3fdhnkw"},horizMinus4:{marginEnd:"isg5rw3j",marginStart:"nxn8agaf"},startMinus4:{marginStart:"nxn8agaf"},endMinus4:{marginEnd:"isg5rw3j"},topMinus3:{marginTop:"if44n927"},topMinus1:{marginTop:"o9i7y497"},all0:{marginTop:"tt8xd2xn",marginEnd:"jnwc1y2a",marginBottom:"mpdn4nr2",marginStart:"svoq16ka"},horiz0:{marginEnd:"jnwc1y2a",marginStart:"svoq16ka"},vert0:{marginTop:"tt8xd2xn",marginBottom:"mpdn4nr2"},top0:{marginTop:"tt8xd2xn"},bottom0:{marginBottom:"mpdn4nr2"},end0:{marginEnd:"jnwc1y2a"},start0:{marginStart:"svoq16ka"},top1:{marginTop:"b9l0eqez"},all2:{marginTop:"kiiy14zj",marginEnd:"om6y7gxh",marginBottom:"j4enbv94",marginStart:"gj5xqxfh"},horiz2:{marginEnd:"om6y7gxh",marginStart:"gj5xqxfh"},vert2:{marginTop:"kiiy14zj",marginBottom:"j4enbv94"},top2:{marginTop:"kiiy14zj"},bottom2:{marginBottom:"j4enbv94"},end2:{marginEnd:"om6y7gxh"},start2:{marginStart:"gj5xqxfh"},all3:{marginTop:"g1eqewly",marginEnd:"kjemk6od",marginBottom:"kzyzudjh",marginStart:"k6y3xtnu"},horiz3:{marginEnd:"kjemk6od",marginStart:"k6y3xtnu"},vert3:{marginTop:"g1eqewly",marginBottom:"kzyzudjh"},top3:{marginTop:"g1eqewly"},bottom3:{marginBottom:"kzyzudjh"},end3:{marginEnd:"kjemk6od"},start3:{marginStart:"k6y3xtnu"},all4:{marginTop:"qt60bha0",marginEnd:"mw4yctpw",marginBottom:"inww9tbj",marginStart:"qnz2jpws"},horiz4:{marginEnd:"mw4yctpw",marginStart:"qnz2jpws"},vert4:{marginTop:"qt60bha0",marginBottom:"inww9tbj"},top4:{marginTop:"qt60bha0"},bottom4:{marginBottom:"inww9tbj"},end4:{marginEnd:"mw4yctpw"},start4:{marginStart:"qnz2jpws"},all5:{marginTop:"hymafltn",marginEnd:"q471nw87",marginBottom:"g105fvfm",marginStart:"p3lsiedt"},horiz5:{marginEnd:"q471nw87",marginStart:"p3lsiedt"},vert5:{marginTop:"hymafltn",marginBottom:"g105fvfm"},top5:{marginTop:"hymafltn"},bottom5:{marginBottom:"g105fvfm"},end5:{marginEnd:"q471nw87"},start5:{marginStart:"p3lsiedt"},all6:{marginTop:"iin4x6c7",marginEnd:"claouzo6",marginBottom:"ngycyvoj",marginStart:"oz0g9ue8"},horiz6:{marginEnd:"claouzo6",marginStart:"oz0g9ue8"},vert6:{marginTop:"iin4x6c7",marginBottom:"ngycyvoj"},top6:{marginTop:"iin4x6c7"},bottom6:{marginBottom:"ngycyvoj"},end6:{marginEnd:"claouzo6"},start6:{marginStart:"oz0g9ue8"},all8:{marginTop:"dj1c3cmq",marginEnd:"bugiwsl0",marginBottom:"or9x5nie",marginStart:"fooq7fky"},horiz8:{marginEnd:"bugiwsl0",marginStart:"fooq7fky"},vert8:{marginTop:"dj1c3cmq",marginBottom:"or9x5nie"},top8:{marginTop:"dj1c3cmq"},bottom8:{marginBottom:"or9x5nie"},end8:{marginEnd:"bugiwsl0"},start8:{marginStart:"fooq7fky"},all10:{marginTop:"opp68qpq",marginEnd:"spjzgwxb",marginBottom:"brac1wpa",marginStart:"a3oefunm"},horiz10:{marginEnd:"spjzgwxb",marginStart:"a3oefunm"},vert10:{marginTop:"opp68qpq",marginBottom:"brac1wpa"},top10:{marginTop:"opp68qpq"},bottom10:{marginBottom:"brac1wpa"},end10:{marginEnd:"spjzgwxb"},start10:{marginStart:"a3oefunm"},all12:{marginTop:"iy2cu22y",marginEnd:"oz083wsx",marginBottom:"t4zgqcuo",marginStart:"g9zvcdbd"},horiz12:{marginEnd:"oz083wsx",marginStart:"g9zvcdbd"},vert12:{marginTop:"iy2cu22y",marginBottom:"t4zgqcuo"},top12:{marginTop:"iy2cu22y"},bottom12:{marginBottom:"t4zgqcuo"},end12:{marginEnd:"oz083wsx"},start12:{marginStart:"g9zvcdbd"},bottom14:{marginBottom:"k0lnf8n4"},all15:{marginTop:"eg3lofc5",marginEnd:"ds60debm",marginBottom:"pz0xruzv",marginStart:"htq1q0kf"},horiz15:{marginEnd:"ds60debm",marginStart:"htq1q0kf"},vert15:{marginTop:"eg3lofc5",marginBottom:"pz0xruzv"},top15:{marginTop:"eg3lofc5"},bottom15:{marginBottom:"pz0xruzv"},end15:{marginEnd:"ds60debm"},start15:{marginStart:"htq1q0kf"},top16:{marginTop:"fgtikrv0"},all20:{marginTop:"c46o30wg",marginEnd:"rvlagp7p",marginBottom:"du8bjn1j",marginStart:"bv1sdm6y"},horiz20:{marginEnd:"rvlagp7p",marginStart:"bv1sdm6y"},vert20:{marginTop:"c46o30wg",marginBottom:"du8bjn1j"},top20:{marginTop:"c46o30wg"},bottom20:{marginBottom:"du8bjn1j"},end20:{marginEnd:"rvlagp7p"},start20:{marginStart:"bv1sdm6y"},vert28:{marginTop:"ignnouf6",marginBottom:"bibl1e27"},top28:{marginTop:"ignnouf6"},bottom28:{marginBottom:"bibl1e27"},all30:{marginTop:"nylzjxre",marginEnd:"lfum0007",marginBottom:"bvhm1occ",marginStart:"r6x3u63k"},horiz30:{marginEnd:"lfum0007",marginStart:"r6x3u63k"},vert30:{marginTop:"nylzjxre",marginBottom:"bvhm1occ"},top30:{marginTop:"nylzjxre"},bottom30:{marginBottom:"bvhm1occ"},end30:{marginEnd:"lfum0007"},start30:{marginStart:"r6x3u63k"}},a={horizMinus6:i.horizMinus6,startMinus6:i.startMinus6,endMinus6:i.endMinus6,horizMinus4:i.horizMinus4,startMinus4:i.startMinus4,endMinus4:i.endMinus4,topMinus3:i.topMinus3,topMinus1:i.topMinus1,all0:i.all0,horiz0:i.horiz0,vert0:i.vert0,top0:i.top0,bottom0:i.bottom0,end0:i.end0,start0:i.start0,top1:i.top1,all2:i.all2,horiz2:i.horiz2,vert2:i.vert2,top2:i.top2,bottom2:i.bottom2,end2:i.end2,start2:i.start2,all3:i.all3,horiz3:i.horiz3,vert3:i.vert3,top3:i.top3,bottom3:i.bottom3,end3:i.end3,start3:i.start3,all4:i.all4,horiz4:i.horiz4,vert4:i.vert4,top4:i.top4,bottom4:i.bottom4,end4:i.end4,start4:i.start4,all5:i.all5,horiz5:i.horiz5,vert5:i.vert5,top5:i.top5,bottom5:i.bottom5,end5:i.end5,start5:i.start5,all6:i.all6,horiz6:i.horiz6,vert6:i.vert6,top6:i.top6,bottom6:i.bottom6,end6:i.end6,start6:i.start6,all8:i.all8,horiz8:i.horiz8,vert8:i.vert8,top8:i.top8,bottom8:i.bottom8,end8:i.end8,start8:i.start8,all10:i.all10,horiz10:i.horiz10,vert10:i.vert10,top10:i.top10,bottom10:i.bottom10,end10:i.end10,start10:i.start10,all12:i.all12,horiz12:i.horiz12,vert12:i.vert12,top12:i.top12,bottom12:i.bottom12,end12:i.end12,start12:i.start12,bottom14:i.bottom14,all15:i.all15,horiz15:i.horiz15,vert15:i.vert15,top15:i.top15,bottom15:i.bottom15,end15:i.end15,start15:i.start15,top16:i.top16,all20:i.all20,horiz20:i.horiz20,vert20:i.vert20,top20:i.top20,bottom20:i.bottom20,end20:i.end20,start20:i.start20,vert28:i.vert28,top28:i.top28,bottom28:i.bottom28,all30:i.all30,horiz30:i.horiz30,vert30:i.vert30,top30:i.top30,bottom30:i.bottom30,end30:i.end30,start30:i.start30};t.uiMargin=a;const o={all0:{paddingTop:"i5tg98hk",paddingEnd:"f9ovudaz",paddingBottom:"przvwfww",paddingStart:"gx1rr48f"},horiz0:{paddingEnd:"f9ovudaz",paddingStart:"gx1rr48f"},vert0:{paddingTop:"i5tg98hk",paddingBottom:"przvwfww"},top0:{paddingTop:"i5tg98hk"},bottom0:{paddingBottom:"przvwfww"},end0:{paddingEnd:"f9ovudaz"},start0:{paddingStart:"gx1rr48f"},top1:{paddingTop:"qbqilfqo"},all2:{paddingTop:"ppypbuwx",paddingEnd:"fhfm09ip",paddingBottom:"s8gyl5p1",paddingStart:"mjn2akup"},horiz2:{paddingEnd:"fhfm09ip",paddingStart:"mjn2akup"},vert2:{paddingTop:"ppypbuwx",paddingBottom:"s8gyl5p1"},top2:{paddingTop:"ppypbuwx"},bottom2:{paddingBottom:"s8gyl5p1"},end2:{paddingEnd:"fhfm09ip"},start2:{paddingStart:"mjn2akup"},all3:{paddingTop:"ocd2b0bc",paddingEnd:"folpon7g",paddingBottom:"aa0kojfi",paddingStart:"snweb893"},horiz3:{paddingEnd:"folpon7g",paddingStart:"snweb893"},vert3:{paddingTop:"ocd2b0bc",paddingBottom:"aa0kojfi"},top3:{paddingTop:"ocd2b0bc"},bottom3:{paddingBottom:"aa0kojfi"},end3:{paddingEnd:"folpon7g"},start3:{paddingStart:"snweb893"},all4:{paddingTop:"eujn52yf",paddingEnd:"jfqm35v0",paddingBottom:"ckm995li",paddingStart:"bdbt56hn"},horiz4:{paddingEnd:"jfqm35v0",paddingStart:"bdbt56hn"},vert4:{paddingTop:"eujn52yf",paddingBottom:"ckm995li"},top4:{paddingTop:"eujn52yf"},bottom4:{paddingBottom:"ckm995li"},end4:{paddingEnd:"jfqm35v0"},start4:{paddingStart:"bdbt56hn"},all5:{paddingTop:"qomlamqu",paddingEnd:"lnjlmjd6",paddingBottom:"bxcbqipq",paddingStart:"mc6o24uu"},horiz5:{paddingEnd:"lnjlmjd6",paddingStart:"mc6o24uu"},vert5:{paddingTop:"qomlamqu",paddingBottom:"bxcbqipq"},top5:{paddingTop:"qomlamqu"},bottom5:{paddingBottom:"bxcbqipq"},end5:{paddingEnd:"lnjlmjd6"},start5:{paddingStart:"mc6o24uu"},all6:{paddingTop:"n1yiu2zv",paddingEnd:"abxuf49s",paddingBottom:"eb4rp10x",paddingStart:"mhcwslh8"},horiz6:{paddingEnd:"abxuf49s",paddingStart:"mhcwslh8"},vert6:{paddingTop:"n1yiu2zv",paddingBottom:"eb4rp10x"},top6:{paddingTop:"n1yiu2zv"},bottom6:{paddingBottom:"eb4rp10x"},end6:{paddingEnd:"abxuf49s"},start6:{paddingStart:"mhcwslh8"},top7:{paddingTop:"esbfogcw"},all8:{paddingTop:"fbgy3m38",paddingEnd:"ft2m32mm",paddingBottom:"oq31bsqd",paddingStart:"nu34rnf1"},horiz8:{paddingEnd:"ft2m32mm",paddingStart:"nu34rnf1"},vert8:{paddingTop:"fbgy3m38",paddingBottom:"oq31bsqd"},top8:{paddingTop:"fbgy3m38"},bottom8:{paddingBottom:"oq31bsqd"},end8:{paddingEnd:"ft2m32mm"},start8:{paddingStart:"nu34rnf1"},all9:{paddingTop:"qlb265nb",paddingEnd:"i8go5xc4",paddingBottom:"n0ziumnz",paddingStart:"e1yunedv"},horiz9:{paddingEnd:"i8go5xc4",paddingStart:"e1yunedv"},vert9:{paddingTop:"qlb265nb",paddingBottom:"n0ziumnz"},top9:{paddingTop:"qlb265nb"},bottom9:{paddingBottom:"n0ziumnz"},end9:{paddingEnd:"i8go5xc4"},start9:{paddingStart:"e1yunedv"},all10:{paddingTop:"emrlamx0",paddingEnd:"itegkywt",paddingBottom:"aiput80m",paddingStart:"rppts313"},horiz10:{paddingEnd:"itegkywt",paddingStart:"rppts313"},vert10:{paddingTop:"emrlamx0",paddingBottom:"aiput80m"},top10:{paddingTop:"emrlamx0"},bottom10:{paddingBottom:"aiput80m"},end10:{paddingEnd:"itegkywt"},start10:{paddingStart:"rppts313"},all12:{paddingTop:"b7n2qyd4",paddingEnd:"btzf6ewn",paddingBottom:"ekpn4oxx",paddingStart:"nqtxkp62"},horiz12:{paddingEnd:"btzf6ewn",paddingStart:"nqtxkp62"},vert12:{paddingTop:"b7n2qyd4",paddingBottom:"ekpn4oxx"},top12:{paddingTop:"b7n2qyd4"},bottom12:{paddingBottom:"ekpn4oxx"},end12:{paddingEnd:"btzf6ewn"},start12:{paddingStart:"nqtxkp62"},horiz13:{paddingEnd:"pbp0z3j0",paddingStart:"rn41jex5"},start13:{paddingStart:"rn41jex5"},end13:{paddingEnd:"pbp0z3j0"},bottom14:{paddingBottom:"p9a4hubg"},all15:{paddingTop:"pxvlsfnc",paddingEnd:"kyc7k6mt",paddingBottom:"n3bptxsn",paddingStart:"f78eapp6"},horiz15:{paddingEnd:"kyc7k6mt",paddingStart:"f78eapp6"},vert15:{paddingTop:"pxvlsfnc",paddingBottom:"n3bptxsn"},top15:{paddingTop:"pxvlsfnc"},bottom15:{paddingBottom:"n3bptxsn"},end15:{paddingEnd:"kyc7k6mt"},start15:{paddingStart:"f78eapp6"},all16:{paddingTop:"tvsr5v2h",paddingEnd:"l9g3jx6n",paddingBottom:"jd93c9cp",paddingStart:"lyvj5e2u"},horiz16:{paddingEnd:"l9g3jx6n",paddingStart:"lyvj5e2u"},start16:{paddingStart:"lyvj5e2u"},end16:{paddingEnd:"l9g3jx6n"},all18:{paddingTop:"a71rq12o",paddingEnd:"tcyu26xv",paddingBottom:"pcbmd69e",paddingStart:"i8b31kl9"},horiz18:{paddingEnd:"tcyu26xv",paddingStart:"i8b31kl9"},top18:{paddingTop:"a71rq12o"},all20:{paddingTop:"nlnf8xo7",paddingEnd:"iffbo4e8",paddingBottom:"r219jyu0",paddingStart:"khscay3k"},horiz20:{paddingEnd:"iffbo4e8",paddingStart:"khscay3k"},vert20:{paddingTop:"nlnf8xo7",paddingBottom:"r219jyu0"},top20:{paddingTop:"nlnf8xo7"},bottom20:{paddingBottom:"r219jyu0"},end20:{paddingEnd:"iffbo4e8"},start20:{paddingStart:"khscay3k"},all24:{paddingTop:"a4bywxmn",paddingEnd:"h1a80dm5",paddingBottom:"lzi2pvmc",paddingStart:"sta02ykp"},horiz24:{paddingEnd:"h1a80dm5",paddingStart:"sta02ykp"},vert24:{paddingTop:"a4bywxmn",paddingBottom:"lzi2pvmc"},top24:{paddingTop:"a4bywxmn"},bottom24:{paddingBottom:"lzi2pvmc"},end24:{paddingEnd:"h1a80dm5"},start24:{paddingStart:"sta02ykp"},all30:{paddingTop:"msavwer2",paddingEnd:"bcymb0na",paddingBottom:"slgfab0f",paddingStart:"e8k79tju"},horiz30:{paddingEnd:"bcymb0na",paddingStart:"e8k79tju"},vert30:{paddingTop:"msavwer2",paddingBottom:"slgfab0f"},top30:{paddingTop:"msavwer2"},bottom30:{paddingBottom:"slgfab0f"},end30:{paddingEnd:"bcymb0na"},start30:{paddingStart:"e8k79tju"},horiz36:{paddingEnd:"lk91ofgv",paddingStart:"s9xya5d7"},start36:{paddingStart:"s9xya5d7"},end36:{paddingEnd:"lk91ofgv"}},s={all0:o.all0,horiz0:o.horiz0,vert0:o.vert0,top0:o.top0,bottom0:o.bottom0,end0:o.end0,start0:o.start0,top1:o.top1,all2:o.all2,horiz2:o.horiz2,vert2:o.vert2,top2:o.top2,bottom2:o.bottom2,end2:o.end2,start2:o.start2,all3:o.all3,horiz3:o.horiz3,vert3:o.vert3,top3:o.top3,bottom3:o.bottom3,end3:o.end3,start3:o.start3,all4:o.all4,horiz4:o.horiz4,vert4:o.vert4,top4:o.top4,bottom4:o.bottom4,end4:o.end4,start4:o.start4,all5:o.all5,horiz5:o.horiz5,vert5:o.vert5,top5:o.top5,bottom5:o.bottom5,end5:o.end5,start5:o.start5,all6:o.all6,horiz6:o.horiz6,vert6:o.vert6,top6:o.top6,bottom6:o.bottom6,end6:o.end6,start6:o.start6,top7:o.top7,all8:o.all8,horiz8:o.horiz8,vert8:o.vert8,top8:o.top8,bottom8:o.bottom8,end8:o.end8,start8:o.start8,all9:o.all9,horiz9:o.horiz9,vert9:o.vert9,top9:o.top9,bottom9:o.bottom9,end9:o.end9,start9:o.start9,all10:o.all10,horiz10:o.horiz10,vert10:o.vert10,top10:o.top10,bottom10:o.bottom10,end10:o.end10,start10:o.start10,all12:o.all12,horiz12:o.horiz12,vert12:o.vert12,top12:o.top12,bottom12:o.bottom12,end12:o.end12,start12:o.start12,horiz13:o.horiz13,start13:o.start13,end13:o.end13,bottom14:o.bottom14,all15:o.all15,horiz15:o.horiz15,vert15:o.vert15,top15:o.top15,bottom15:o.bottom15,end15:o.end15,start15:o.start15,all16:o.all16,horiz16:o.horiz16,start16:o.start16,end16:o.end16,all18:o.all18,horiz18:o.horiz18,top18:o.top18,all20:o.all20,horiz20:o.horiz20,vert20:o.vert20,top20:o.top20,bottom20:o.bottom20,end20:o.end20,start20:o.start20,all24:o.all24,horiz24:o.horiz24,vert24:o.vert24,top24:o.top24,bottom24:o.bottom24,end24:o.end24,start24:o.start24,all30:o.all30,horiz30:o.horiz30,vert30:o.vert30,top30:o.top30,bottom30:o.bottom30,end30:o.end30,start30:o.start30,horiz36:o.horiz36,start36:o.start36,end36:o.end36};t.uiPadding=s},22712:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MainAudioChannel=void 0;var i=n(r(34342));class a extends i.default{registerMedia(e){let t=null;const r=()=>{t=this.claim(e,(()=>{e.pause()}))},n=()=>{var e;null===(e=t)||void 0===e||e()};return e.addEventListener("play",r),e.addEventListener("pause",n),()=>{var i;null===(i=t)||void 0===i||i(),e.removeEventListener("play",r),e.removeEventListener("pause",n)}}claim(e,t){const r=this._active;return null!=r&&e!==r.key&&(r.pause(),this.trigger("paused_DEPRECATED_DO_NOT_USE",r.key)),this._active={key:e,pause:t},()=>{var t;e===(null===(t=this._active)||void 0===t?void 0:t.key)&&(this._active=null)}}}const o=new a;t.MainAudioChannel=o},89345:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));class a extends i.default{constructor(){super(...arguments),this.openVoipWindow=()=>{this.manager&&this.manager.openVoipWindow()},this.closeVoipWindow=()=>{this.manager&&this.manager.closeVoipWindow()}}register(e){this.manager=e}unregister(){this.manager&&this.manager.closeVoipWindow(),this.manager=null}}var o=new a;t.default=o},80666:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditorAction=t.AttachMedia=t.ATTACH_MEDIA_STATE=void 0;var i=n(r(48926)),a=r(50796),o=r(15461),s=r(29984),l=r(11290),c=n(r(65273)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(1063),p=r(78986),f=n(r(97390)),_=n(r(34949)),h=(r(13705),r(90669));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}const m=r(76672).Mirrored(["Outline","OutlineDone","CropRotateCanvas"]);t.MediaEditorAction=m;const y={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=y;class E extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.file=(0,l.prop)(),this.uiProcessed=(0,l.prop)(!1),this.fileOrigin=(0,l.prop)(),this.isVcardOverMmsDocument=(0,l.prop)(!1),this.stickerMaker=(0,l.prop)(!1),this.state=(0,l.session)(),this.mediaPrep=(0,l.session)(),this.mimetype=(0,l.session)(),this.originalMimetype=(0,l.session)(),this.processPromise=(0,l.session)(),this.exception=(0,l.session)(),this.caption=(0,l.session)(),this.type=(0,l.session)(o.MSG_TYPE.UNKNOWN),this.mediaEditorData=(0,l.session)(),this.lastMediaEditorAction=(0,l.session)(),this.editedFile=(0,l.session)(),this._mediaEditorUndoStack=(0,l.session)((()=>[])),this._mediaEditorRedoStack=(0,l.session)((()=>[])),this.preview=(0,l.session)(),this.fullPreview=(0,l.session)(),this.fullPreviewSize=(0,l.session)(),this.filename=(0,l.session)(),this.documentPageCount=(0,l.session)(),this.isGif=(0,l.session)(),this.gifAttribution=(0,l.session)(),this.previewable=(0,l.derived)(this._previewable,["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),this.filesize=(0,l.derived)(this._filesize,["file"]),this.fileExt=(0,l.derived)(this._fileExt,["filename"])}_previewable(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case o.MSG_TYPE.DOCUMENT:return!!this.filename;case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.STICKER:case o.MSG_TYPE.PTT:case o.MSG_TYPE.UNKNOWN:return!0;default:throw new Error(`Unsupported attach media type ${this.type}`)}}_filesize(){return this.file instanceof _.default?this.file.size():this.file instanceof Blob?this.file.size:null}_fileExt(){return this.filename?(0,u.getFileExtension)(this.filename):null}initialize(){if(super.initialize(),!(this.file instanceof Promise))throw new Error("cannot process non-promise file");this.processAttachment(this.file)}processAttachment(e){this.state=y.PROCESSING,this.mediaEditorData=c.default.create(),this.processPromise=this._processAttachmentPromiseHelper(e).then((()=>{const e=new Image;e.src=this.fullPreview,e.onload=()=>{const t={};this.stickerMaker&&(t.fitToSquare=!0,t.scale=1-2*h.STICKER_MAKER_IMAGE_PADDING/h.STICKER_DIMENSION),this.mediaEditorData=this.mediaEditorData.setBackground(e,t)}}))}_processAttachmentPromiseHelper(e){var t=this;return e.then(function(){var e=(0,i.default)((function*(e){t.set(e);const r={},{file:n,filename:i,isGif:a,asSticker:l,stickerMaker:c,gifAttribution:d,isVcardOverMmsDocument:f,documentPageCount:g}=e;!0===a?(r.asGif=!0,r.gifAttribution=d):e.type===u.FILETYPE.DOCUMENT&&(r.asDocument=!0,r.filename=i,r.isVcardOverMmsDocument=f,r.documentPageCount=g),r.asSticker=l,!0===c&&(r.minDimension=h.STICKER_DIMENSION,r.transparency=!0),r.precomputedFields={fullHeight:e.fullPreviewSize?e.fullPreviewSize.height:void 0,fullWidth:e.fullPreviewSize?e.fullPreviewSize.width:void 0,preview:e.preview,duration:e.duration};const m=_.default.createFromData(n,n.type),E=(0,p.prepRawMedia)(m,r);t.set({mediaPrep:E});const S=yield E.waitForPrep(),v=S.documentPreview,T=S.mediaBlob instanceof _.default?window.URL.createObjectURL(S.mediaBlob.forceToBlob()):window.URL.createObjectURL(S.mediaBlob),C={file:S.mediaBlob,fullPreview:T,type:S.type,filename:S.filename,mimetype:S.mimetype,originalMimetype:e.mimetype,preview:S.preview,state:y.READY,isGif:S.isGif,fullPreviewSize:void 0,documentPageCount:g,isVcardOverMmsDocument:S.isVcardOverMmsDocument,editedFile:S.mediaBlob};(0,s.isNonZeroNumber)(S.fullWidth)&&(0,s.isNonZeroNumber)(S.fullHeight)&&(C.fullPreviewSize={height:S.fullHeight,width:S.fullWidth}),S.type===o.MSG_TYPE.IMAGE&&(C.preview=T),S.type===o.MSG_TYPE.DOCUMENT&&v&&(C.fullPreview=v.url,C.preview=v.thumbUrl,C.fullPreviewSize={height:v.height,width:v.width},C.documentPageCount=v.pdfPages),t.set(C),t.previewable||(__LOG__(4,void 0,new Error,!0)`Invariant violated, processed file is not previewable`,SEND_LOGS("AttachMedia processFile"))}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([d.InvalidMediaFileType,d.InvalidImageFileType],(t=>{if(this.isGif||this.type===u.FILETYPE.DOCUMENT)throw t;return this._processAttachmentPromiseHelper(e.then((e=>(e.type=u.FILETYPE.DOCUMENT,e))))}))).catch((0,a.filteredCatch)([f.default,d.MediaFileFailedLoad,d.MediaFileEmpty],(e=>(this.set({exception:e,state:y.ERROR}),this)))).catch((()=>(__LOG__(3)`AttachMedia:processFile convert unexpected error to InvalidMediaFileType:`,this.set({exception:new d.InvalidMediaFileType,state:y.ERROR}),this)))}sendToChat(e,t){if(!this.mediaPrep)return Promise.reject(new Error("MediaPrep not available"));if(this.state===y.ERROR)return Promise.reject(new Error(this.exception));if(!(this.state!==y.PROCESSING||this.previewable&&t.addEvenWhilePreparing))return Promise.reject(new Error("Media still processing"));if(this.state===y.READY)return this.mediaPrep.sendToChat(e,t);const r={mimetype:this.mimetype};switch(this.type){case o.MSG_TYPE.VIDEO:r.isGif=this.isGif,r.gifAttribution=this.gifAttribution;case o.MSG_TYPE.IMAGE:r.width=this.fullPreviewSize.width,r.height=this.fullPreviewSize.height,r.body=this.preview,t.placeholderProps=r;break;case o.MSG_TYPE.DOCUMENT:r.pageCount=this.documentPageCount,r.filename=this.filename,r.body=this.preview,t.placeholderProps=r;break;case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:}return this.mediaPrep.sendToChat(e,t)}getFileType(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,u.typeFromMimetype)(this.file.type)}isViewableOnce(){return new Set([o.MSG_TYPE.IMAGE,o.MSG_TYPE.VIDEO]).has(this.type)&&!this.isGif}isSendableAsSticker(){return this.type===o.MSG_TYPE.IMAGE}delete(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),super.delete()}updateMediaEditorData(e,t){return this.mediaEditorData===e||(t.undoable&&(this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]),this.lastMediaEditorAction=t.lastAction,this._mediaEditorRedoStack=[]),this.mediaEditorData=e),this.mediaEditorData}undoMediaEditorData(){if(this.canUndoMediaEditorData()){this._mediaEditorRedoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorUndoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}redoMediaEditorData(){if(this.canRedoMediaEditorData()){this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorRedoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}canUndoMediaEditorData(){return this._mediaEditorUndoStack.length>0}canRedoMediaEditorData(){return this._mediaEditorRedoStack.length>0}updateEditedFile(e){this.editedFile=e}updatePreview(e){window.URL.revokeObjectURL(this.preview),this.preview=e}updateFullPreview(e){window.URL.revokeObjectURL(this.fullPreview),this.fullPreview=e}updateCaption(e){this.caption=e}}E.Proxy="attachMedia";const S=(0,l.defineModel)(E);t.AttachMedia=S},14075:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(64369)),o=r(48360),s=r(80666),l=r(1255),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),d=r(1063),u=n(r(43725)),p=r(90535),f=n(r(97390)),_=r(64551),h=n(r(87481));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}const{IMAGE:m,VIDEO:y,DOCUMENT:E,AUDIO:S}=d.FILETYPE,{READY:v,ERROR:T,PROCESSING:C}=s.ATTACH_MEDIA_STATE;let A=1;class b extends l.BaseCollection{constructor(e){let{chatParticipantCount:t}=e;super(),this.errorMsgs=null,this.ignored=0,this.mediaPickerStatsLogger=new p.MediaPickerStatsLogger,this.selection=new h.default([],(e=>e.id),"prev"),this.isStickerMaker=!1,this.mediaPickerStatsLogger.chatRecipients=t,this.listenTo(this.selection,"all",this._handleSelectionEvents.bind(this))}_handleSelectionEvents(e,t){"focus"!==t&&!1!==t||this.trigger("active-change")}removeSingleton(e,t){var r;e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),(null===(r=e.original)||void 0===r?void 0:r.url)&&window.URL.revokeObjectURL(e.original.url))}remove(e,t){const r=super.remove(e,t);return r.forEach((e=>this.removeSingleton(e,t))),this.selection.init(this.getPreviewableMedias(),!0),r}delete(){super.delete(),this.forEach((e=>this.removeSingleton(e))),this.selection.init(this.getPreviewableMedias(),!0)}reorder(e,t){return this.reorderMutate(e,t),this.selection.init(this.getPreviewableMedias(),!0),this.getPreviewableMedias()}replace(e,t){const r=this.get(e);if(!r)return;const n=this.indexOf(r),i=r.caption;this.remove(r,{silent:!0}),r.delete();const a=new s.AttachMedia({id:e,caption:i,file:this._normalizeAttachment(t)});return this.add(a,n?{at:n}:{}),a.processPromise}getValidMedias(){return this.filter((e=>e.state===v||e.state===C))}getPreviewableMedias(){return this.filter((e=>e.previewable))}getActive(){return this.selection.getVal()}setActive(e){this.selection.setVal(e)}unsetActive(){this.selection.unset()}setNextAsActive(){const e=this.selection.list.length-1;return-1===this.selection.index||this.selection.index===e||this.selection.setNext(),this.selection.getVal()}setPrevAsActive(){return-1===this.selection.index||0===this.selection.index||this.selection.setPrev(),this.selection.getVal()}processAttachments(e,t){var r=this;return(0,i.default)((function*(){const n=r.getPreviewableMedias().length,i=e.length+n>a.default.MAX_FILES?Math.max(a.default.MAX_FILES-n,0):e.length,o=e.length-i;0===i?o&&r.trigger("max_upload_limit",o):r.ignore(o);const l=e.slice(0,i).map((e=>new s.AttachMedia({id:A++,file:r._normalizeAttachment(e),fileOrigin:t})));r.add(l);const c=r.getActive();return r.unsetActive(),Promise.all(e).then((()=>{r._attemptToSetNextActiveFromAdded(l,c)})),yield Promise.all(l.map((e=>e.processPromise))),l.forEach((e=>r._logMediaAdd(e,t))),r._attemptToSetNextActiveFromAdded(l,c)}))()}_attemptToSetNextActiveFromAdded(e,t){if(this.getActive())return;if(this.getModelsArray().some((e=>e.state===C&&!e.previewable)))return;let r=e.find((e=>e.previewable));r||(r=t),this.selection.init(this.getPreviewableMedias()),r&&this.setActive(r)}_logMediaAdd(e,t){if(null==t)return;const r=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,r,t)}_normalizeAttachment(e){return(0,i.default)((function*(){const t=yield Promise.resolve(e);return t.filename||(t.filename=t.file.name),t.mimetype||(t.mimetype=t.file.type),t.type||(t.type=(0,d.typeFromMimetype)(t.file.type)),!t.type&&t.mimetype&&(t.type=(0,d.typeFromMimetype)(t.mimetype)),t}))()}ignore(e){e>0&&(this.ignored+=e)}uiProcessMsgs(){let e,t=[],r=0,n=0,i=0,s=0,l=0,d=0,p=0,h=0,g=0,v=0,A=0,b=!1;const P=u.default.filesize(_.ServerProps.media),M=u.default.filesize((0,_.getMaxFilesSizeServerProp)()),O=u.default.filesize(1024*_.ServerProps.vcardMaxSizeKb);if(this.forEach((t=>{if(!t.uiProcessed&&(!e&&t.previewable&&(e=t),t.state!==C&&(t.uiProcessed=!0,t.state===T)))if(t.exception instanceof f.default)switch(t.getFileType()){case m:r+=1;break;case y:n+=1;break;case S:i+=1;break;case E:t.isVcardOverMmsDocument?l+=t.documentPageCount:s+=1}else if(t.exception instanceof c.MediaFileEmpty)switch(t.getFileType()){case m:d+=1;break;case y:p+=1;break;case S:h+=1;break;case E:t.isVcardOverMmsDocument?v+=t.documentPageCount:g+=1}else t.exception instanceof c.MediaFileFailedLoad?b=!0:A+=1})),r>0&&t.push(u.default.t(531,{number:r,_plural:r,maxSize:P})),n>0&&t.push(u.default.t(816,{number:n,_plural:n,maxSize:P})),i>0&&t.push(u.default.t(150,{number:i,_plural:i,maxSize:P})),s>0&&t.push(u.default.t(400,{number:s,_plural:s,maxSize:M})),l>0&&t.push(u.default.t(367,{_plural:l,maxSize:O})),d>0&&t.push(u.default.t(530,{number:d,_plural:d})),p>0&&t.push(u.default.t(814,{number:p,_plural:p})),h>0&&t.push(u.default.t(148,{number:h,_plural:h})),g>0&&t.push(u.default.t(399,{number:g,_plural:g})),v>0&&t.push(u.default.t(366,{number:v,_plural:v})),A>0&&t.push(u.default.t(459,{number:A,_plural:A})),b&&(t=[],t.push(o.fbt._("The item you tried adding failed to load.",null,{hk:"1MmBvO"}))),t.length>1){t=[];const e=r+n+i+s,a=d+p+h+g,o=e+a+A;0===A?(0!==e&&t.push(u.default.t(460,{number:e,_plural:e,maxSize:M})),0!==a&&t.push(u.default.t(456,{number:a,_plural:a}))):t.push(u.default.t(458,{number:o,_plural:o}))}const I=t.join(" ");this.errorMsgs=I,this.ignore(this.getPreviewableMedias().length-a.default.MAX_FILES);const w=this.ignored;return this.ignored=0,w&&this.trigger("max_upload_limit",w),A>0&&this.trigger("files_not_supported"),{errorMsgs:I}}canSend(){return!this.getModelsArray().some((e=>e.state===C&&!e.previewable))}}t.default=b,b.model=s.AttachMedia},32742:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResult=t.BUSINESS_CATEGORY_EMPTY_STR_ID=void 0;var i=n(r(89867)),a=r(11290);t.BUSINESS_CATEGORY_EMPTY_STR_ID="__empty_query__";class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.categories=(0,a.prop)(),this.notABizId=(0,a.prop)()}getCollection(){return r(3754).BusinessCategoriesResultCollection}}o.Proxy="BusinessCategoriesResult",o.idClass=i.default;const s=(0,a.defineModel)(o);t.BusinessCategoriesResult=s},3754:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResultCollectionImpl=t.BusinessCategoriesResultCollection=void 0;var i=n(r(48926)),a=r(1255),o=r(32742),s=r(46977);class l extends a.BaseCollection{_find(e){return(0,i.default)((function*(){const{categories:t,notABizId:r}=yield(0,s.queryBusinessCategories)(e);return new o.BusinessCategoriesResult({id:e,categories:t,notABizId:r})}))()}}t.BusinessCategoriesResultCollectionImpl=l,l.model=o.BusinessCategoriesResult,l.staleCollection=!0;const c=new l;t.BusinessCategoriesResultCollection=c},64886:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=r(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.cypher=(0,a.prop)(),this.cypherExpirationTimestamp=(0,a.prop)()}}o.Proxy="business_direct_connection",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},15131:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(1255),s=n(r(64886)),l=r(884),c=r(46977),d=r(52804),u=r(36993),p=r(48808);class f extends o.BaseCollection{_getValidCertificate(e,t,r){return(0,i.default)((function*(){if(!r&&(null==t?void 0:t.certificateChain)){const e=yield(0,l.getValidCertificate)((0,p.stringToCertificateString)(t.certificateChain));if(e)return e}return(0,l.getValidCertificate)(yield(0,l.fetchCertificateFullChain)(e))}))()}_getCypherFromDborApi(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){const n=yield(0,u.fetchDirectConnectionKeys)(e.toJid());if(!r&&n&&!(0,l.isExpired)(n.cypherExpirationTimestamp))return{id:e,cypher:(0,d.stringToCypherString)(n.cypher),cypherExpirationTimestamp:n.cypherExpirationTimestamp};const[i,o]=yield Promise.all([t._getValidCertificate(e,n,r),(0,c.querySignedUserInfo)(e)]);if(null==i)return __LOG__(3)`[direct-connection] no certificate returned from the get_public_key IQ`,null;const s=(0,a.default)(yield(0,l.getCypher)(i.chain,o),"yield getCypher(validCertificate.chain, userInfo)"),f=o.phoneNumberSignatureExpiration;return yield(0,u.createOrUpdateDirectConnectionKeys)({id:e.toJid(),cypher:(0,d.cypherStringToString)(s),cypherExpirationTimestamp:f,certificateChain:(0,p.certificateStringToString)(i.string)}),{id:e,cypher:s,cypherExpirationTimestamp:f}}))()}getCypher(e){var t=this;let{forceRenew:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.default)((function*(){const n=r?null:t.get(e);return!n||(0,l.isExpired)(n.cypherExpirationTimestamp)?[].concat(yield t.update(e,{forceRenewDirectConnection:r}))[0]:n}))()}_find(e){return this._getCypherFromDborApi(e)}_update(e,t){let{forceRenewDirectConnection:r}=t;return this._getCypherFromDborApi(e,r)}}f.model=s.default;var _=new f;t.default=_},884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchCertificateFullChain=function(){return h.apply(this,arguments)},t.getCypher=function(){return _.apply(this,arguments)},t.getValidCertificate=function(){return f.apply(this,arguments)},t.isCypherNeeded=function(){return g.apply(this,arguments)},t.isExpired=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.default)();if(null==e)return!0;const r=(0,o.default)(e,p);return!(r.isValid()&&r.isAfter(t))},t.timestampFormat=void 0;var i=n(r(48926)),a=n(r(45095)),o=n(r(30381)),s=r(46977),l=r(69951),c=r(52804),d=r(7003),u=r(48808);const p="YYYYMMDDTHHmmssZ";function f(){return(f=(0,i.default)((function*(e){const t=yield(0,u.extractCertificates)(e),{result:r}=yield(0,u.validateCertificates)(t.slice(1,-1),t.slice(-1));return r?{string:e,chain:t}:null}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const r=(0,u.arrayBufferToBase64)(yield(0,u.getRandomValues)(new Uint8Array(16)));return(0,c.genCypher)(e[0],r,{phone_number:t.phoneNumber,ttl_timestamp:t.phoneNumberSignatureExpiration,phone_number_signature:t.phoneNumberSignature})}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const[{certificate:t},r]=yield Promise.all([(0,s.queryBusinessPublicKey)(e),(0,u.fetchFromCABundle)()]);if(null==t)throw new Error("[direct-connection] no certificate returned from the get_public_key IQ");const n=yield(0,u.extractCertificates)(t),i=(0,a.default)(yield(0,u.genRootIssuers)(n,r),"yield genRootIssuers(extractedCertificate, caBundle)");return(0,u.encodeToString)([...n,...i])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){var t;const n=r(93581).BusinessProfileCollection;return Boolean((0,d.supportsDirectConnection)()&&null!=l.ChatCollection.get(e)&&(null===(t=(yield n.find(e)).profileOptions)||void 0===t?void 0:t.directConnection))}))).apply(this,arguments)}t.timestampFormat=p},48018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_BUSINESS_CATEGORIES=t.DEFAULTS=t.BusinessProfile=void 0;var i=n(r(89867)),a=r(11290);t.MAX_BUSINESS_CATEGORIES=3;class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.tag=(0,a.prop)(),this.description=(0,a.prop)(),this.categories=(0,a.prop)(),this.profileOptions=(0,a.prop)(),this.email=(0,a.prop)(),this.website=(0,a.prop)(),this.latitude=(0,a.prop)(),this.longitude=(0,a.prop)(),this.businessHours=(0,a.prop)(),this.catalogStatus=(0,a.prop)(),this.address=(0,a.prop)(),this.structuredAddress=(0,a.prop)(),this.legalEntityDetails=(0,a.prop)(),this.fbPage=(0,a.prop)(),this.igProfessional=(0,a.prop)(),this.isProfileLinked=(0,a.prop)(),this.directConnection=(0,a.prop)(),this.stale=(0,a.session)(!0)}markStale(){this.stale=!0,this.hasObservers()&&this.getCollection().find(this.id)}getCollection(){return r(93581).BusinessProfileCollection}isValid(){return Array.isArray(this.categories)}}o.Proxy="businessProfile",o.idClass=i.default;const s=(0,a.defineModel)(o);t.BusinessProfile=s;t.DEFAULTS={description:null,email:null,website:null}},93581:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BusinessProfileCollectionImpl=t.BusinessProfileCollection=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(1255),s=r(48018),l=r(46977),c=r(94010),d=r(19380);t.CATALOG_EXISTS="catalog_exists";class u extends o.BaseCollection{_find(e){return this._findAndParse(e,{queryCatalog:!0})}_update(e,t){return this._findAndParse(e,{queryCatalog:!1,getMerchantCompliance:null==t?void 0:t.getMerchantCompliance})}_findAndParse(e,t){var r=this;let{queryCatalog:n,getMerchantCompliance:o}=t;return(0,a.default)((function*(){const t=r.gadd(e);if(!t.id.isUser())return __LOG__(2)`Store:BusinessProfile:find businessProfile is only available to users (${String(e)})`,Promise.resolve({id:e});const a=yield(0,l.queryBusinessProfile)([{wid:t.id,tag:t.tag}],o);if(!Array.isArray(a))return __LOG__(3)`Received invalid business profile response`,null;if(0===a.length)return __LOG__(2)`Store:BusinessProfile:find No businessProfile found for ${String(e)}`,{id:e};const s=a[0],{wid:u,tag:p}=s,f={id:u,tag:p},{profile:_}=s;if(_){const t=d.ContactCollection.get(e);return t&&!t.isContactSyncCompleted&&(t.set("isBusiness",!0),t.set("forcedBusinessUpdateFromServer",!0)),(0,i.default)((0,i.default)({},(0,c.parseBusinessProfile)({id:s.wid,profile:_,queryCatalog:n})),f)}return f}))()}fetchBizProfile(e){const t=this.get(e);return t&&t.markStale(),this.find(e)}onResume(){this.filter((e=>e.stale&&e.hasObservers())).map((e=>this.find(e.id)))}handle(e){let[t]=e;t&&null!=t.tag||__LOG__(3)`Store:BusinessProfile:handle Received invalid update from server`;const r=this.gadd(t.wid);t.tag!==r.tag&&r.markStale()}getValid(e){const t=this.get(e);if(null==t?void 0:t.isValid())return t}}t.BusinessProfileCollectionImpl=u,u.model=s.BusinessProfile,u.staleCollection=!0;const p=new u;t.BusinessProfileCollection=p},93170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.businessTypeOptions=t.VERIFIED_LEVEL=t.DAYS_OF_WEEK=t.COMMERCE_EXPERIENCE_TYPES=t.BUSINESS_PROFILE_FIELDS_LENGTH=t.BUSINESS_HOUR_MODES=void 0;t.VERIFIED_LEVEL={UNKNOWN:0,LOW:1,HIGH:2};t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"];t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"};const n=r(76672)({CATALOG:"catalog",NONE:"none",SHOP:"shop"});t.COMMERCE_EXPERIENCE_TYPES=n;t.businessTypeOptions={limitedLiabilityPartnership:"Limited liability partnership",soleProprietorship:"Sole proprietorship",partnership:"Partnership",publicCompany:"Public Company",privateCompany:"Private Company",other:"Other"};t.BUSINESS_PROFILE_FIELDS_LENGTH={WEBSITE:256,DESCRIPTION:512,EMAIL:128,ADDRESS:256}},94010:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BUSINESS_OPEN_STATUS=void 0,t.getBusinessOpenState=C,t.hasShop=t.hasCatalog=t.goToShop=t.goToCommerceManager=void 0,t.isBusinessOpen=b,t.parseBusinessProfile=t.isShopBanned=t.isCompleteBizProfile=void 0,t.quickReplyHoursStr=function(e){const t=b(e)?s.fbt._("We're currently *open*",null,{hk:"1Skaff"}):s.fbt._("We're currently *closed*",null,{hk:"18eiaZ"}),r=s.fbt._("Our business hours are:",null,{hk:"Qljt"}),n=(0,_.getBusinessHours)(e,!0).map((e=>`${(0,o.default)(e.day)}: ${e.hours}`)).join("\n");return[t,r,n].join("\n")};var i=n(r(81109)),a=n(r(6479)),o=n(r(48403)),s=r(48360),l=n(r(87045)),c=r(48018),d=r(93170),u=r(99989),p=r(19380),f=r(64551),_=r(43390);const h=["business_hours","catalog_status","structured_address","profile_options","address","legal_entity_details","fb_page","ig_professional","profile_is_linked"],g="catalog_exists";t.CATALOG_EXISTS=g;const m=e=>{var t;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||(null==e?void 0:e.catalog_status)===g};t.hasCatalog=e=>{var t;return e&&e instanceof c.BusinessProfile?(null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||e.catalogStatus===g:m(e)};const y=e=>{var t,r;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(r=e.profileOptions)||void 0===r?void 0:r.shopURL)};t.hasShop=y;t.isShopBanned=e=>{var t,r;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.NONE||y(e)&&!!(null==e||null===(r=e.profileOptions)||void 0===r?void 0:r.isBanned)};t.goToShop=e=>{var t;const r=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.shopURL;r&&l.default.open(r)};t.goToCommerceManager=e=>{var t;const r=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceManagerURL;l.default.open(r||"https://business.facebook.com/commerce_manager/")};const E=e=>m(e)||f.ServerProps.shopsProductGrid&&(e=>{var t,r;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(r=e.profile_options)||void 0===r?void 0:r.shop_url)})(e),S=e=>{let{email:t,landline_number:r,mobile_number:n}=e;const i={email:t};return r&&(i.landlineNumber=r),n&&(i.mobileNumber=n),i},v=e=>{let{entity_name:t,entity_type:r,is_registered:n,entity_type_custom:i,customer_care_details:a,grievance_officer_details:o}=e;const s={entityName:t,entityType:r,isRegistered:n};return i&&(s.entityTypeCustom=i),a&&(s.customerCareDetails=(e=>{let{email:t,landline_number:r,mobile_number:n}=e;return S({email:t,landline_number:r,mobile_number:n})})(a)),o&&(s.grievanceOfficerDetails=(e=>{let{name:t,email:r,landline_number:n,mobile_number:i}=e;const a=S({email:r,landline_number:n,mobile_number:i});return a.name=t,a})(o)),s};t.parseBusinessProfile=e=>{let{profile:t,id:r,queryCatalog:n}=e;if(!t)return{id:r};const{business_hours:o,catalog_status:s,structured_address:l,profile_options:f,address:_,legal_entity_details:g,fb_page:m,ig_professional:y,profile_is_linked:S}=t,T=(0,a.default)(t,h),C={};return C.businessHours=o?(e=>{let{config:t,timezone:r}=e;const n={};return t.forEach((e=>{const{day_of_week:t,mode:r}=e;if(r===d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){const{open_time:i,close_time:a}=e;n[t]||(n[t]={mode:r,hours:[]}),null!=i&&null!=a&&n[t].hours&&n[t].hours.push([i,a])}else n[t]={mode:r}})),{config:n,timezone:r}})(o):null,f&&(C.profileOptions={},C.profileOptions.commerceExperience=f.commerce_experience,C.profileOptions.cartEnabled=f.cart_enabled,C.profileOptions.directConnection=f.direct_connection,null!=f.shop_url&&(C.profileOptions.shopURL=f.shop_url),null!=f.commerce_manager_url&&(C.profileOptions.commerceManagerURL=f.commerce_manager_url),null!=f.is_banned&&(C.profileOptions.isBanned=f.is_banned)),E(t)&&(C.catalogStatus=s,n&&u.CatalogCollection.findCarouselCatalog(r).then((e=>{const t=Array.isArray(e)?e[0]:e,n=p.ContactCollection.get(r);n&&(n.businessCatalog=t)})).catch((()=>__LOG__(3)`Store:BusinessProfile:missing catalog`))),l?C.structuredAddress={streetAddress:l.street_address,cityId:l.city_id,localizedCityName:l.localized_city_name,zipCode:l.zip_code}:C.address=_||null,g&&(C.legalEntityDetails=v(g)),m&&(C.fbPage={displayName:m.display_name,likes:m.likes,id:m.id}),y&&(C.igProfessional={handle:y.ig_handle,followers:y.followers}),null!=S&&(C.isProfileLinked=!!S),(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},c.DEFAULTS),T),C),{},{id:r})};t.isCompleteBizProfile=e=>{var t,r;return null!=e.address&&null!=e.description&&null!=(null===(t=e.businessHours)||void 0===t?void 0:t.config)&&0!==Object.keys(e.businessHours.config).length&&null!=e.email&&0!==(null===(r=e.website)||void 0===r?void 0:r.length)};const T={OPEN:"open",CLOSED:"closed",OPEN_TODAY:"open_today",CLOSED_TODAY:"closed_today",OPEN_APPOINTMENT:"open_appointment",OPEN_24H:"open_24h",UNKNOWN:"unknown"};function C(e,t){var r,n;if(null==e.timezone)return{status:"unknown"};const i=t||new Date,a=new Date(i.toLocaleString("en-US",{timeZone:e.timezone})),o=(i.getTime()-a.getTime())/1e3/60,s=e.config[d.DAYS_OF_WEEK[i.getDay()]];if(!s)return{status:T.CLOSED_TODAY};switch(s.mode){case d.BUSINESS_HOUR_MODES.OPEN_24H:if(s)return{status:T.OPEN_24H};break;case d.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:if(s)return{status:T.OPEN_APPOINTMENT};break;case d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:const e=60*i.getHours()+i.getMinutes();if(1===(null===(r=s.hours)||void 0===r?void 0:r.length)){const t=s.hours[0][0],r=s.hours[0][1];return e>=t&&e<=r?{status:T.OPEN,openUntil:A(o+r)}:e<=t?{status:T.CLOSED,opensAt:A(o+t)}:{status:T.CLOSED}}if(2===(null===(n=s.hours)||void 0===n?void 0:n.length)){const t=s.hours[0][0],r=s.hours[0][1],n=s.hours[1][0],i=s.hours[1][1];return e>=t&&e<=r?{status:T.OPEN,openUntil:A(o+r),additionalOpen:A(o+n),additionalClose:A(o+i)}:e<t?{status:T.CLOSED,opensAt:A(o+t),additionalOpen:A(o+n),additionalClose:A(o+i)}:e>=n&&e<=i?{status:T.OPEN,openUntil:A(o+i)}:e<n?{status:T.CLOSED,opensAt:A(o+n)}:{status:T.CLOSED}}}return{status:"unknown"}}function A(e){const t=new Date,r=Math.floor(e/60);return t.setHours(r),t.setMinutes(e%60),t.setSeconds(0),t}function b(e){switch(C(e).status){case T.OPEN_24H:case T.OPEN_APPOINTMENT:case T.OPEN:return!0;case T.CLOSED:case T.CLOSED_TODAY:default:return!1}}t.BUSINESS_OPEN_STATUS=T},65999:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(57037);class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.products=(0,n.prop)(),this.itemCount=(0,n.prop)(),this.total=(0,n.prop)(),this.currency=(0,n.prop)(),this.message=(0,n.prop)()}countTotals(){const e=this.cartItemCollection.reduce(((e,t)=>{var r;return e.currency.add(t.currency),{itemCount:e.itemCount+t.quantity,total:e.total+t.quantity*(null!==(r=t.priceAmount1000)&&void 0!==r?r:0),currency:e.currency}}),{itemCount:0,total:0,currency:new Set}),t=1===e.currency.size,r={itemCount:e.itemCount,total:t?e.total:null,currency:t?e.currency.values().next().value:null};this.set(r,{silent:!0})}initialize(){super.initialize(),this.cartItemCollection=new i.CartItemCollection,this.listenTo(this,"change:cartItemCollection",this.countTotals)}getCollection(){return r(12392).CartCollection}}a.Proxy="cart";var o=(0,n.defineModel)(a);t.default=o},12392:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CartCollectionImpl=t.CartCollection=void 0;var i=r(1255),a=n(r(65999)),o=r(17239),s=r(99234),l=r(7293);class c extends i.BaseCollection{constructor(e,t){super(),this.imageWidth=100,this.imageHeight=100,null!=e&&(this.imageWidth=e),null!=t&&(this.imageHeight=t)}saveToCache(){if(!l.GK.supportsFeature(l.GK.F.MD_BACKEND))try{if(!o.Conn.shouldSaveToCache())return;const e=this.reduce(((e,t)=>{const{cartItemCollection:r,itemCount:n,total:i,currency:a,id:o,message:s}=t,l=r.map((e=>({id:e.id,priceAmount1000:e.priceAmount1000,currency:e.currency,name:e.name,quantity:e.quantity,imageHash:e.imageHash})));return l.length>0&&e.push({id:o,products:l,itemCount:n,total:i,currency:a,message:s}),e}),[]);(0,s.setCollection)(c.cachePolicy.id,e,!0)}catch(e){__LOG__(3)`Error while saving carts to cache, ${String(e)}`}}initializeFromCache(e){try{(e||[]).forEach((e=>{const t=new a.default({id:e.id,itemCount:e.itemCount,total:e.total,currency:e.currency,message:e.message});t.cartItemCollection.add(e.products),this.add(t,{merge:!0})}))}catch(e){__LOG__(3)`Error while restoring carts from cache, ${String(e)}`}}findCart(e){return this.gadd(e)}}t.CartCollectionImpl=c,c.model=a.default,c.cachePolicy={id:"cart_collection",policy:i.CACHE_POLICY.LOAD,delay:2e3};const d=new c;t.CartCollection=d},9581:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_QUANTITY=t.CartItem=void 0;var n=r(11290);t.MAX_QUANTITY=99;class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.priceAmount1000=(0,n.prop)(),this.currency=(0,n.prop)(),this.name=(0,n.prop)(),this.quantity=(0,n.prop)(),this.imageHash=(0,n.prop)(),this.imageCdnUrl=(0,n.prop)()}getCollection(){return r(12392).CartCollection}}i.Proxy="cart-item";const a=(0,n.defineModel)(i);t.CartItem=a},57037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CartItemCollection=void 0;var n=r(1255),i=r(9581);class a extends n.BaseCollection{}t.CartItemCollection=a,a.model=i.CartItem},21423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(17304);class a extends n.BaseCollection{constructor(){super(...arguments),this.hasProductBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryProducts(e){const t=e.msgs;return this.hasProductBefore=!1,this.add(t.filter((e=>null!=e.asProduct)),{at:0}),Promise.resolve()}}t.default=a,a.model=i.Msg,a.comparator=(e,t)=>e.t-t.t},34535:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveMessageHeaderMediaType=t.IM_MEDIA_HEADER_TYPES=void 0;const n=r(76672).Mirrored(["IMAGE","VIDEO","DOCUMENT"]);t.InteractiveMessageHeaderMediaType=n;const i=new Set([n.IMAGE,n.VIDEO,n.DOCUMENT]);t.IM_MEDIA_HEADER_TYPES=i},84064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(76672)({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront"});t.default=n},5165:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(76672)({ORDER_DETAILS:"order_details",ORDER_STATUS:"order_status"});t.default=n},8803:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Label=void 0,t.intColorToHex=d;var n=r(11290),i=r(17239),a=r(7293),o=r(59846),s=r(34741),l=r(31912);class c extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.name=(0,n.prop)(),this.colorIndex=(0,n.prop)(),this.color=(0,n.prop)(),this.count=(0,n.prop)(),this.stale=(0,n.session)(!0),this.hexColor=(0,n.derived)(this._hexColor,["color","colorIndex"])}initialize(){super.initialize(),this.labelItemCollection=new s.LabelItemCollection,this._triggerLabelUpdate(),this.listenTo(this,"change:name",this._triggerLabelUpdate),this.listenTo(this,"change:color",this._triggerLabelUpdate),this.listenTo(this,"change:colorIndex",this._triggerLabelUpdate),this.listenTo(this,"change:count",this._triggerLabelUpdate),a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&(this.listenTo(this.labelItemCollection,"add",this._handleLabelItemCollectionUpdate),this.listenTo(this.labelItemCollection,"remove",this._handleLabelItemCollectionUpdate))}_hexColor(){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)){const e=this.colorIndex;if(null==e)return;return i.Conn.platform===i.PLATFORMS.SMBI?o.IPHONE_LABEL_COLOR_PALETTE[e]:o.ANDROID_LABEL_COLOR_PALETTE[e]}if(this.color)return d(this.color)}_find(e){return Promise.resolve({id:e})}_triggerLabelUpdate(){this.name&&r(16770).LabelCollection.trigger(`label_updated_${this.id}`)}_handleLabelItemCollectionUpdate(){const e=this.labelItemCollection.filter((e=>e.parentType!==l.LabelItemParentType.Contact)).length;this.count=String(e)}}function d(e){return`#${(parseInt(e,10)>>>0).toString(16).slice(-6)}`}c.Proxy="label";const u=(0,n.defineModel)(c);t.Label=u},16770:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelCollectionImpl=t.LabelCollection=void 0;var i=n(r(48926)),a=n(r(82729)),o=r(89385),s=r(50796),l=r(13959),c=r(4352),d=r(48360),u=r(46331),p=r(1255),f=r(88102),_=r(17239),h=r(45741),g=L(r(64103)),m=r(99234),y=r(7293),E=n(r(43725)),S=r(8803),v=r(82663),T=r(59846),C=r(50047),A=r(31912),b=r(905),P=n(r(11339)),M=L(r(22906)),O=n(r(17072)),I=n(r(56891)),w=r(77591),R=r(65044),D=r(85893);function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(N=function(e){return e?r:t})(e)}function L(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=N(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class k extends p.BaseCollection{constructor(){super(),this.checksum=void 0,this.listenTo(this,"remove",this.handleRemove)}initializeAssociationsFromCache(e){e.forEach((e=>{let{labelId:t,associationId:r,type:n}=e;(0,b.addToLabelCollection)(r,[t],n===v.LabelAssociationType.Jid?A.LabelItemParentType.Chat:A.LabelItemParentType.Msg)}))}addNewLabel(e,t){if(y.GK.supportsFeature(y.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");(0,C.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.ADD,1,P.default.LABEL_TARGETS.LABEL);const r=I.default.createLabel(e,t),n=new u.ActionType(d.fbt._("Adding new label: {labelName}",[d.fbt._param("labelName",e)],{hk:"4iHRrD"})),i=(0,u.genId)(),a=r.then((t=>{let{status:r}=t;return 200===r?new u.ActionType(E.default.t(95,{labelName:e})):new u.ActionType(E.default.t(94,{labelName:e}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new u.ActionType(E.default.t(94,{labelName:e})))));return f.Cmd.openToast((0,D.jsx)(u.ActionToast,{id:i,initialAction:n,pendingAction:a})),r}removeAllLabelsMD(e){return this.addOrRemoveLabelsMD((e.labels||[]).map((e=>({type:"remove",id:e}))),[e])}addOrRemoveLabelsMD(e,t){y.GK.supportsFeature(y.GK.F.MD_BACKEND)&&e.forEach((e=>{let{id:r,type:n}=e;t.forEach((e=>{const t=(0,b.getParentTypeFromModel)(e),i=e.id.toString();"add"===n?(0,b.addToLabelCollection)(i,[r],t):(0,b.removeLabelFromCollection)(i,r,t)}))}))}addOrRemoveLabels(e,t){const r=(0,u.genId)(),n=new u.ActionType(E.default.t(5,{count:e.length,_plural:e.length})),i=(0,h.editLabelAssociation)(e,t).then((()=>{this.addOrRemoveLabelsMD(e,t)})).then((()=>new u.ActionType(E.default.t(7,{count:e.length,_plural:e.length})))).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new u.ActionType(E.default.t(6)))));f.Cmd.openToast((0,D.jsx)(u.ActionToast,{id:r,initialAction:n,pendingAction:i}))}deleteLabel(e){(0,C.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.DELETE,1,P.default.LABEL_TARGETS.LABEL);const t=I.default.deleteLabel(e),r=this.get(e);if(!r)return void __LOG__(2)`deleteLabel - label does not exist`;const{name:n}=r,i=new u.ActionType(E.default.t(46,{labelName:n})),a=(0,u.genId)(),o=t.then((e=>{let{status:t}=e;return 200===t?new u.ActionType(d.fbt._("Deleted label: {labelName}",[d.fbt._param("labelName",n)],{hk:"4bqQlK"})):new u.ActionType(d.fbt._("Deleting label: {labelName} failed",[d.fbt._param("labelName",n)],{hk:"1j0DXC"}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new u.ActionType(d.fbt._("Deleting label: {labelName} failed",[d.fbt._param("labelName",n)],{hk:"1j0DXC"})))));return f.Cmd.openToast((0,D.jsx)(u.ActionToast,{id:a,initialAction:i,pendingAction:o})),t}_getActionLabelUpdateString(e,t){switch(e){case T.LABEL_PROPERTIES.NAME:return t===T.UPDATE_STATUS.UPDATING?d.fbt._("Updating label name",null,{hk:"2FancO"}):t===T.UPDATE_STATUS.SUCCEEDED?d.fbt._("Label name updated",null,{hk:"Nacb5"}):d.fbt._("Label name update failed",null,{hk:"33PW5z"});case T.LABEL_PROPERTIES.COLOR:return t===T.UPDATE_STATUS.UPDATING?d.fbt._("Updating label color",null,{hk:"49XPdJ"}):t===T.UPDATE_STATUS.SUCCEEDED?d.fbt._("Label color updated",null,{hk:"2cuEYz"}):d.fbt._("Label color update failed",null,{hk:"Dzw1J"})}return""}updateLabel(e,t){(0,C.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.EDIT,1,P.default.LABEL_TARGETS.LABEL);const r=I.default.editLabel(e.id,e.name,e.color),n=new u.ActionType(this._getActionLabelUpdateString(t,T.UPDATE_STATUS.UPDATING)),i=(0,u.genId)(),a=r.then((e=>{let{status:r}=e;return 200===r?new u.ActionType(this._getActionLabelUpdateString(t,T.UPDATE_STATUS.SUCCEEDED)):new u.ActionType(this._getActionLabelUpdateString(t,T.UPDATE_STATUS.FAILED))})).catch((()=>(__LOG__(3)`updatingLabel dropped`,new u.ActionType(this._getActionLabelUpdateString(t,T.UPDATE_STATUS.FAILED)))));return f.Cmd.openToast((0,D.jsx)(u.ActionToast,{id:i,initialAction:n,pendingAction:a})),r}getNewLabelColor(){return(0,i.default)((function*(){try{return(yield I.default.queryNextLabelColor()).labelColors[0].color}catch(e){return}}))()}getLabelColorPalette(){return this.labelColorPalette=this.labelColorPalette||(0,m.getSmbLabelPalette)(),this.labelColorPalette&&this.labelColorPalette.waVersion===_.Conn.phone.wa_version?Promise.resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then((e=>{const t=e.labelColors.map((e=>{let{color:t}=e;return t}));return(0,m.setSmbLabelPalette)({colors:t,waVersion:_.Conn.phone.wa_version}),t})).catch((()=>{}))}_getColorPaletteLoop(){return(0,c.promiseLoop)(((e,t,r)=>{const n=(0,l.delayMs)(M.expBackoff(r,12e4,1e3,.1));return("CONNECTED"===R.Socket.stream?Promise.resolve():(0,O.default)(R.Socket,"change:stream",(()=>"CONNECTED"===R.Socket.stream))).then((()=>I.default.queryLabelPalette().then((t=>{e(t)})))).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;return r>3||404===e?(__LOG__(3)`labels:loadLabelPalette:error ${String(e)}`,404===e?Promise.reject(new w.E404):Promise.reject(new g.GaveUpRetry(`Gave up loading label palette ${r} tries`))):n}))}),0)}handleRemove(e){const{labelItemCollection:t}=e;t.toArray().forEach((e=>{const{parentId:t,parentType:r,labelId:n}=e,i=(0,b.getParentCollection)(r).get(t);i&&(i.labels=(0,a.default)(i.labels,(e=>e!==n)))}))}onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,s.filteredCatch)(w.WebdDrop,(()=>{})))}))}delete(){super.delete(),delete this.checksum}sync(e){if(!e||this.checksum!==e)return this.findQuery({}).catch((0,s.filteredCatch)([w.WebdDrop,g.ProtoVersionUndefined],(()=>{})))}handle(e){var t,r;if(e.checksum&&this.updateChecksum(e.checksum),null===(t=e.labels)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.labelUpdates){let t;return e.labels[0].labelUpdates.forEach((e=>{e.collection.forEach((r=>{r!==A.LabelItemParentType.Msg&&r!==A.LabelItemParentType.Chat||(t=!0);const n=e.id,i=(0,b.getParentCollection)(r).get(e.id);i&&(i.labels&&i.labels.forEach((t=>{e.labels.includes(t)||(0,b.removeLabelFromCollection)(n,t,r)})),i.labels=e.labels)}))})),void(t&&this.trigger("bulk_msg_chat_label_change"))}const n=[],i=[];e.labels.forEach((e=>{"delete"===e.type?n.push(e.label):i.push(e.label)})),this.remove(n.map((e=>{let{id:t}=e;return t}))),this.add(i,{merge:!0})}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield I.default.queryLabels();return t.checksum&&e.updateChecksum(t.checksum),t.labels}))()}_find(){return this._findQuery()}updateChecksum(e){this.checksum=e}getLabelsForModel(e,t){return this.filter((r=>r.labelItemCollection.get((0,b.createLabelItemId)(e,r.id,t)))).map((e=>e.id))}}t.LabelCollectionImpl=k,k.model=S.Label,k.staleCollection=!0,k.resumeOnAvailable=!0;const G=new k;t.LabelCollection=G},59846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_STATUS=t.LABEL_PROPERTIES=t.IPHONE_LABEL_COLOR_PALETTE=t.ANDROID_LABEL_COLOR_PALETTE=void 0;t.ANDROID_LABEL_COLOR_PALETTE=["#FF9485","#64C4FF","#FFD429","#DFAEF0","#99B6C1","#55CCB3","#FF9DFF","#D3A91D","#6D7CCE","#D7E752","#00D0E2","#FFC5C7","#93CEAC","#F74848","#00A0F2","#83E422","#FFAF04","#B5EBFF","#9BA6FF","#9368CF"];t.IPHONE_LABEL_COLOR_PALETTE=["#A62C71","#90A841","#C1A03F","#792138","#AE8774","#F0B330","#B6B327","#C69FCC","#8B6990","#FF8A8C","#54C265","#FF7B6B","#26C4DC","#57C9FF","#74676A","#7E90A3","#5696FF","#6E257E","#7ACBA5","#243640"];const r=Object.freeze({NAME:"name",COLOR:"color"});t.LABEL_PROPERTIES=r;const n=Object.freeze({UPDATING:"updating",SUCCEEDED:"succeeded",FAILED:"failed"});t.UPDATE_STATUS=n},24137:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);r(31912);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.parentType=(0,n.prop)(),this.parentId=(0,n.prop)(),this.labelId=(0,n.prop)()}}i.Proxy="labelItem";var a=(0,n.defineModel)(i);t.default=a},34741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemCollection=void 0;var i=n(r(82569)),a=r(1255),o=r(7293),s=n(r(24137)),l=r(905);class c extends a.BaseCollection{constructor(){super(),o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&(this.listenTo(this,"add",this._handleAdd),this.listenTo(this,"remove",this._handleRemove))}_handleAdd(e){this._handleChange(e,!0)}_handleRemove(e){this._handleChange(e,!1)}_handleChange(e,t){const r=(0,l.getParentCollection)(e.parentType).get(e.parentId);if(!r)return;const n=r.labels||[];t?n.includes(e.labelId)||(r.labels=[e.labelId].concat(n)):r.labels=(0,i.default)(n,e.labelId)}}t.LabelItemCollection=c,c.model=s.default},52388:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=n(r(89867)),s=r(11290),l=r(9468),c=r(96519),d=r(21374),u=r(12496),p=r(5641);class f extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.afterCursor=(0,s.prop)(),this.index=(0,s.prop)(),this.fetchedFromServer=(0,s.session)(),this._products=(0,s.session)(),this._msgs=(0,s.session)()}initialize(){super.initialize(),this.productCollection=new p.ProductCollection,this.msgProductCollection=new p.ProductCollection,this.collections=new u.ProductCollCollection,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.listenTo(this,"change:_msgs",this.triggerMsgUpdate),this.triggerProductUpdate(),this.triggerMsgUpdate()}triggerProductUpdate(){this._products&&this.productCollection.add(this._products,{merge:!0}),this._products=void 0}triggerMsgUpdate(){this._msgs&&this.msgProductCollection.add(this._msgs,{merge:!0}),this._msgs=void 0}markProductCollectionOld(){this.productCollection.forEach((e=>e.markOld()))}addProduct(e){var t=this;return(0,i.default)((function*(){const{id:r}=t,n=yield(0,c.addProduct)(e),i=t.productCollection.at(0);n.catalogWid=r,n.index=i?i.index-1:0;const o=t.productCollection.add(n,{merge:!0,at:0})[0];return(0,a.default)(o,"addedProduct")}))()}editProduct(e){var t=this;return(0,i.default)((function*(){const r=yield(0,c.editProduct)(e),n=t.productCollection.add(r,{merge:!0})[0];return t.collections&&t.collections.forEach((t=>{t.productCollection.get(e.id)&&t.productCollection.add(r,{merge:!0})})),(0,a.default)(n,"editedProduct")}))()}refreshProduct(e){var t=this;return(0,i.default)((function*(){const r=t.productCollection.get(e);r&&(r.stale=!0);const n=yield(0,c.queryProduct)(t.id,e);if(null!=n.data){const i=(0,d.mapProductResponseToModel)(n.data,t.id);r&&t.productCollection.add(i,{merge:!0}),t.collections&&t.collections.forEach((t=>{t.productCollection.get(e)&&t.productCollection.add(i,{merge:!0})}))}}))()}pullProduct(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,c.queryProduct)(r.id,e,void 0,void 0,void 0,t);if("NOT_FOUND"===n.error&&r.productCollection.remove(e),null!=n.data){const e=new l.Product((0,d.mapProductResponseToModel)(n.data,r.id));r.updateProduct(e)}}))()}updateProduct(e){this.productCollection.add(e,{merge:!1})}getCollection(){return r(99989).CatalogCollection}}f.Proxy="catalog",f.idClass=o.default;var _=(0,s.defineModel)(f);t.default=_},99989:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogCollectionImpl=t.CatalogCollection=void 0;var i=n(r(48926)),a=r(45454),o=r(1255),s=n(r(52388)),l=r(78711),c=r(96519),d=r(21374),u=r(48870),p=(r(27798),r(64551)),f=r(31515),_=r(77591);class h extends o.BaseCollection{addMsgAsProduct(e){const t=e.businessOwnerJid&&(0,a.createWid)(e.businessOwnerJid);if(!t)return;const r=this.get(t),n=r&&e.productId&&r.msgProductCollection.get(e.productId),i=r&&e.productId?r.productCollection.get(e.productId):null;if((null==i?void 0:i.t)&&i.t>=e.t)return;if(null==n?void 0:n.fetchedFromServer)return;const o=(0,d.mapMsgToProductModel)(e);return super.add({id:t,afterCursor:void 0,_msgs:[o],stale:!0,fetchedFromServer:!!i},{merge:!0})}_queryProduct(e){var t=()=>super.add,r=this;let{catalogWid:n,productId:a,productMsgMediaData:o,width:s,height:l,shouldFetchComplianceFields:u,canLogQpl:p}=e;return(0,i.default)((function*(){const e=yield(0,c.queryProduct)(n,a,s,l,u,p);if("NOT_FOUND"===e.error){const e=r.get(n);return null==e||e.productCollection.remove(a),Promise.reject(new _.E404("CatalogCollection:findProduct:_queryProduct NOT_FOUND"))}if(!e.data)return t().call(r,{id:n,afterCursor:void 0});const{data:i}=e;if(!i.image_cdn_urls)return Promise.reject(new Error("CatalogCollection:findProduct:_queryProduct: could not find image_cdn_urls for product"));const f=(0,d.mapProductResponseToModel)(i,n);f.productMsgMediaData=o;const h=[f];return t().call(r,{id:n,afterCursor:void 0,_products:h,_msgs:h},{merge:!0})}))()}findProduct(e){let{catalogWid:t,productId:r,productMsgMediaData:n,shouldFetchComplianceFields:i,canLogQpl:a}=e;return r?this._queryProduct({catalogWid:t,productId:r,productMsgMediaData:n,shouldFetchComplianceFields:i,canLogQpl:a}):Promise.reject(new Error("CatalogCollection:findProduct Received productId type "+(void 0===r?"undefined":"null")))}_queryCatalog(e,t,r,n,a,o){return(0,i.default)((function*(){const i=e?e.index:0;o&&u.QPL.markerPoint(o,"datasource_catalog_start");const s=yield(0,c.queryCatalog)(t,r,10,void 0,void 0,n,a);if(o&&u.QPL.markerPoint(o,"datasource_catalog_end"),!s.data.length)return{id:t,afterCursor:null};const l=[];return s.data.forEach((e=>{e.image_cdn_urls&&l.push((0,d.mapProductResponseToModel)(e,t))})),{id:t,afterCursor:s.paging.cursors.after,_products:l,fetchedFromServer:!0,index:i+l.length}}))()}_findQuery(e,t){const r=this.get(e),n=r&&!r.stale?r.afterCursor:void 0;return this._queryCatalog(r,e,n,void 0,void 0,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}findCarouselCatalog(e){var t=()=>super.add,r=this;return(0,i.default)((function*(){const n=r.get(e),i=(0,f.isString)(e)?(0,a.createWid)(e):e;n&&n.set({index:0});const o=yield r._queryCatalog(n,i,void 0,void 0,Boolean(p.ServerProps.shopsProductGrid));return n&&n.markProductCollectionOld(),t().call(r,o,{merge:!0})}))()}findNextProductPage(e,t){var r=this;return(0,i.default)((function*(){!0===t&&(0,l.qplPointCatalogView)("datasource_start");const n=yield r.update(e);!0===t&&(0,l.qplPointCatalogView)("datasource_end");return(Array.isArray(n)?n[0]:n).productCollection.getProductModels()}))()}findCollectionMembership(e,t){var r=()=>super.add,n=this;return(0,i.default)((function*(){let i=n.get(e);const o=(0,f.isString)(e)?(0,a.createWid)(e):e,s=i&&!i.stale?i.afterCursor:void 0,l=yield n._queryCatalog(i,o,s,t);r().call(n,l,{merge:!0}),i=n.get(e),i&&(i.stale=!1)}))()}}t.CatalogCollectionImpl=h,h.model=s.default,h.staleCollection=!0;const g=new h;t.CatalogCollection=g},78711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCatalogView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,e)},t.qplPointProductMessageSend=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,e)};var n=r(48870),i=r(27798)},9468:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.MIN_PRICE=t.MAX_PRODUCT_IMAGES=t.MAX_PRICE=void 0;var i=r(11290),a=r(1063),o=n(r(2320)),s=r(58668),l=r(7514);t.MIN_PRICE=0;t.MAX_PRICE=4503599627370496;t.MAX_PRODUCT_IMAGES=10;class c extends i.BaseModel{constructor(){super(...arguments),this.old=(0,i.session)(!1),this.checkmark=(0,i.session)(!1),this.id=(0,i.prop)(),this.isHidden=(0,i.prop)(),this.catalogWid=(0,i.prop)(),this.url=(0,i.prop)(),this.name=(0,i.prop)(),this.description=(0,i.prop)(),this.availability=(0,i.prop)(),this.reviewStatus=(0,i.prop)(),this.canAppeal=(0,i.prop)(),this.currency=(0,i.prop)(),this.priceAmount1000=(0,i.prop)(),this.salePriceAmount1000=(0,i.prop)(),this.salePriceStartDate=(0,i.prop)(),this.salePriceEndDate=(0,i.prop)(),this.retailerId=(0,i.prop)(),this.productImageCollection=(0,i.session)(),this.imageCount=(0,i.prop)(),this.index=(0,i.prop)(),this.additionalImageCdnUrl=(0,i.prop)(),this.additionalImageHashes=(0,i.prop)(),this.imageCdnUrl=(0,i.prop)(),this.imageHash=(0,i.prop)(),this.complianceInfo=(0,i.prop)(),this.productMsgMediaData=(0,i.session)(),this.fetchedFromServer=(0,i.session)(),this.t=(0,i.prop)()}initialize(){super.initialize(),this.productImageCollection=new l.ProductImageCollection,this.listenTo(this,"change:imageCdnUrl",this.triggerMainImageUpdate),this.initImageUpdate()}triggerAdditionalImageUpdate(){var e;let t=0;null===(e=this.additionalImageCdnUrl)||void 0===e||e.forEach(((e,r)=>{this.productImageCollection.gadd({id:`_${r+1}`,mediaUrl:e,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}),t=r+1})),this.productImageCollection.filter(((e,r)=>r>t)).forEach((e=>e.markOld()))}triggerMainImageUpdate(){var e;this.imageCdnUrl?this.productImageCollection.gadd({id:"_0",mediaUrl:this.imageCdnUrl,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}):null===(e=this.productImageCollection.get("_0"))||void 0===e||e.markOld()}initImageUpdate(){if(this.fetchedFromServer||!this.productMsgMediaData)this.triggerMainImageUpdate();else for(let e=0;e<this.imageCount;e++)this.productImageCollection.gadd({id:`_${e}`,type:"product",mediaData:new o.default({mediaStage:s.MEDIA_DATA_STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0})}markOld(){this.old=!0}lazyloadProductImageCollection(){return this.triggerAdditionalImageUpdate(),this.productImageCollection}getProductImageCollectionCount(){return this.productImageCollection.length}getProductImageCollectionHead(){return this.productImageCollection.head()}getHeadImageFile(){var e;const{productImageCollection:t,name:r}=this,n=t.head();if(!n)return;let i;const o=null===(e=n.mediaData)||void 0===e?void 0:e.mediaBlob;if(o._blob&&(i=o._blob),!i)return;return(0,a.createFile)([i],`${r}.jpg`,{type:"image/jpeg"})}evictImagesFromCache(){this.productImageCollection.forEach((e=>e.evictFromCache()))}getPreviewImage(){return this.productImageCollection.head()}}c.Proxy="product";const d=(0,i.defineModel)(c);t.Product=d},91450:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductMsgSnapshot=E,t.sendProductMessage=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(15461),l=r(48360),c=r(80666),d=n(r(14075)),u=r(88102),p=r(78711),f=n(r(11339)),_=r(13151),h=r(50452),g=r(85893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t){const r=(0,o.default)(new d.default({chatParticipantCount:t}),"new AttachMediaCollection({\n  chatParticipantCount\n})");if((0,p.qplPointProductMessageSend)("image_upload_start"),yield r.processAttachments([{file:e}],f.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY),(0,p.qplPointProductMessageSend)("image_upload_end"),!r.canSend())return;const n=r.getPreviewableMedias();if(1!==n.length)return;const[i]=n;return i.caption||(i.caption=void 0),i}))).apply(this,arguments)}function E(e){return(0,i.default)((0,i.default)({businessOwnerJid:e.catalogWid.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),title:e.name,description:e.description},0===e.priceAmount1000?{priceAmount1000:null,currencyCode:null}:{currencyCode:e.currency,priceAmount1000:e.priceAmount1000}),{},{salePriceAmount1000:(0,_.isSalePriceActive)(e)?e.salePriceAmount1000:null})}function S(){return(S=(0,a.default)((function*(e,t,r){const n=t.getHeadImageFile();if(!n)throw u.Cmd.openToast((0,g.jsx)(h.Toast,{msg:l.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,h.genId)()})),new Error("Tried to send product message. Media file is not available.");const a=e.getParticipantCount(),o=yield m(n,a);if(!o)throw u.Cmd.openToast((0,g.jsx)(h.Toast,{msg:l.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,h.genId)()})),new Error("Tried to send product message. Media data is not available.");const d={quotedMsg:r,caption:o.caption,addEvenWhilePreparing:o.previewable&&o.state===c.ATTACH_MEDIA_STATE.PROCESSING,useBasePropsType:!0};o.sendToChat(e,(0,i.default)((0,i.default)({},d),{},{type:s.MSG_TYPE.PRODUCT,productMsgOptions:E(t)}))}))).apply(this,arguments)}},94629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(5641);class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.name=(0,n.prop)(),this.isHidden=(0,n.prop)(),this.reviewStatus=(0,n.prop)(),this.commerceUrl=(0,n.prop)(),this.rejectReason=(0,n.prop)(),this.totalItemsCount=(0,n.prop)(),this.afterCursor=(0,n.prop)(),this.canAppeal=(0,n.prop)()}initialize(){super.initialize(),this.productCollection=new i.ProductCollection,this.afterCursor=void 0}addProducts(e){this.productCollection.add(e,{merge:!0})}}a.Proxy="productColl";var o=(0,n.defineModel)(a);t.default=o},12496:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollCollection=void 0;var i=n(r(48926)),a=r(1255),o=r(97951),s=r(21374),l=n(r(94629)),c=r(60323),d=r(48870);r(27798);const u=100,p=e=>({id:e.id,name:e.name,reviewStatus:e.reviewStatus,totalItemsCount:e.totalItemsCount,canAppeal:e.canAppeal,commerceUrl:e.commerceUrl,rejectReason:e.rejectReason});class f extends a.BaseCollection{constructor(){super(...arguments),this.afterCursor=""}findCollectionsList(e,t,r,n){var a=this;return(0,i.default)((function*(){n&&d.QPL.markerPoint(n,"datasource_collections_start");try{const r=yield(0,o.attemptWithDirectConnectionRetry)(e,(r=>(0,c.queryCollections)(e,a.afterCursor,10,t,u,u,r)));n&&d.QPL.markerPoint(n,"datasource_collections_end"),a.afterCursor=r.afterCursor,a.add(r.collections.map(p),{merge:!0}),r.collections.forEach((t=>{const r=a.get(t.id);r&&r.addProducts(t.products.map((t=>(0,s.mapProductResponseToModel)(t,e))))})),a.trigger("change")}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionsList, error: ${e}`,SEND_LOGS("Find collections list failed"),e}}))()}getCollectionModels(e){const t=this.toArray();return e?t:t.filter((e=>!e.isHidden&&"APPROVED"===e.reviewStatus))}findCollectionProducts(e,t,r,n){var a=this;return(0,i.default)((function*(){let r=a.get(t);const i=r?r.afterCursor:void 0;n&&d.QPL.markerPoint(n,"datasource_start");try{const l=yield(0,o.attemptWithDirectConnectionRetry)(e,(r=>(0,c.querySingleCollection)(e,t,i,10,u,u,r)));n&&d.QPL.markerPoint(n,"datasource_end"),1===l.collections.length&&(a.add(l.collections.map(p),{merge:!0}),r=a.get(t),r&&(r.addProducts(l.collections[0].products.map((t=>(0,s.mapProductResponseToModel)(t,e)))),r.afterCursor=l.afterCursor))}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionProducts, error: ${e}`,SEND_LOGS("Find collection products failed"),e}}))()}}t.ProductCollCollection=f,f.model=l.default,f.staleCollection=!0},5641:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollection=t.PRODUCT_REVIEW_STATUS=void 0;var n=r(1255),i=r(9468);const a={NO_REVIEW:"NO_REVIEW",PENDING:"PENDING",REJECTED:"REJECTED",APPROVED:"APPROVED",OUTDATED:"OUTDATED"};t.PRODUCT_REVIEW_STATUS=a;class o extends n.BaseCollection{getProductModels(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=super.toArray();if(super.length<1)return t;const r=super.head();if(!(null==r?void 0:r.catalogWid))return t;const n=e?new Set([a.OUTDATED,a.NO_REVIEW,a.APPROVED,a.REJECTED,a.PENDING]):new Set([a.APPROVED]),i=super.filter((e=>n.has(e.reviewStatus)&&!e.old));return e?i:i.filter((e=>!e.isHidden))}add(e,t){const r=t?super.add(e,t):super.add(e);return this.sort(),r}evictImagesFromCache(e){const t=this.get(e);t&&t.evictImagesFromCache()}}t.ProductCollection=o,o.model=i.Product,o.comparator=function(e,t){return e.index-t.index}},51954:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STATIC_WHATSAPP_IMAGE_URI=t.ProductImage=void 0;var a=i(r(48926)),o=i(r(81109)),s=r(37178),l=r(77712),c=r(11290),d=r(64103),u=r(55975),p=r(78986),f=i(r(2320)),_=r(58668),h=r(56406),g=i(r(34949)),m=r(28080);const y="https://static.whatsapp.net";t.STATIC_WHATSAPP_IMAGE_URI=y;const E=(0,s.createTimer)({algo:{type:"fibonacci",first:0,second:1},jitter:.25,max:9e5});function S(e){return"_productimage_"+(e.includes(y)?e:new URL(e).pathname)}class v extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.type=(0,c.prop)(),this.mediaUrl=(0,c.prop)(),this.blobUrl=(0,c.session)(),this.mediaData=(0,c.session)(),this.fetchedFromServer=(0,c.prop)(),this.old=(0,c.session)(!1)}initialize(){super.initialize(),this.listenTo(this,"change:mediaUrl change:fetchedFromServer",this.triggerImageUpdate),this.triggerImageUpdate()}_processAndUpdateMediaData(e){let t={};const r=g.default.createFromData(e,"image/jpeg");(0,p.prepRawMedia)(r,{}).waitForPrep().then((e=>(t=(0,o.default)((0,o.default)({},t),{},{mediaBlob:e.mediaBlob,type:e.type,mimetype:e.mimetype,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),Promise.all(["string"==typeof e.preview?g.default.createFromBase64Jpeg(e.preview):Promise.resolve(null),g.default.createFromData(e.mediaBlob),(0,m.getHash)(e.mediaBlob)])))).then((e=>{const[r,n,i]=e;t=(0,o.default)((0,o.default)({},t),{},{preview:r,mediaBlob:n,renderableUrl:n.url(),mediaStage:_.MEDIA_DATA_STAGE.RESOLVED,filehash:i}),i!==this.mediaData.filehash&&this.mediaData.set(t)}))}triggerImageUpdate(){var e=this;return(0,a.default)((function*(){if(!e.fetchedFromServer||!e.mediaUrl)return;e.mediaData||e.addChild("mediaData",new f.default({mediaStage:_.MEDIA_DATA_STAGE.PREPARING}));const t=S(e.mediaUrl),r=yield u.LruMediaStore.get(t);if(r)return e._processAndUpdateMediaData(r);const i={delay:e=>{let{taskDuration:t}=e;const r=1e3*E();return Math.max(r-t,0)},signal:(new n).signal,retries:10};try{const{result:r}=yield(0,l.backoff)(i,function(){var t=(0,a.default)((function*(t){const r=yield(0,h.fetchMedia)(e.mediaUrl);return r&&r.status>=200&&r.status<300?r:t(new d.CatalogImageDownloadError)}));return function(){return t.apply(this,arguments)}}());u.LruMediaStore.put(t,r),e._processAndUpdateMediaData(r)}catch(t){__LOG__(3)`Failed to fetch ${e.mediaUrl}`,e.mediaData.set({mediaStage:_.MEDIA_DATA_STAGE.ERROR_MISSING})}}))()}markOld(){this.old=!0}evictFromCache(){if(this.mediaUrl){const e=S(this.mediaUrl);u.LruMediaStore.del(e)}}}v.Proxy="productImage";const T=(0,c.defineModel)(v);t.ProductImage=T},7514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductImageCollection=void 0;var n=r(1255),i=r(51954);class a extends n.BaseCollection{toArray(){return super.filter((e=>e.old?(this.remove(e),!1):e))}}t.ProductImageCollection=a,a.model=i.ProductImage},89295:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageList=t.INVALID_PRODUCT_TOKEN=void 0;var i=n(r(48926)),a=n(r(65212)),o=r(11290),s=r(884),l=r(99989),c=r(69951),d=r(21374),u=r(5641),p=r(92002),f=r(40264),_=r(64551);const h="DELETED";t.INVALID_PRODUCT_TOKEN=h;const g=["ERROR","SUCCESS"];class m extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.catalogId=(0,o.prop)(),this.title=(0,o.prop)(),this.requiresDirectConnection=(0,o.prop)(),this._productsLoadingStatus=(0,o.session)(),this._productList=(0,o.session)(),this._products=(0,o.session)()}initialize(){super.initialize(),this.productCollection=l.CatalogCollection.gadd({id:this.catalogId}).productCollection,this._productsLoadingStatus=new Map,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.triggerProductUpdate(),this.listenTo(this.productCollection,"remove",this.triggerProductRemoved),this.listenTo(c.ChatCollection,"add",this.triggerChatAdded)}triggerProductRemoved(e){(0,p.updateProductListHeaderImageRejected)(e,this.id)}triggerProductUpdate(){null!=this._products&&(this._products.forEach((e=>{const t=this._getFetchStatus(e);if(this.setProductLoadingStatus(e.id,t),"DELETED"===e.status&&this.triggerProductRemoved(e),"DELETED"!==e.status&&"ERROR"!==t){const t=(0,d.mapProductResponseToModel)(e,this.catalogId);t.reviewStatus===u.PRODUCT_REVIEW_STATUS.REJECTED&&this.triggerProductRemoved(t),this.productCollection.add(t,{merge:!0})}})),this._products=void 0)}triggerChatAdded(e){var t=this;return(0,i.default)((function*(){e.id.equals(t.catalogId)&&(yield(0,s.isCypherNeeded)(t.catalogId))&&(t.productCollection.reset(),t._productsLoadingStatus=new Map)}))()}getNextProductBatchToLoad(){const e=this.getPageSize(),t=this._productList.productSections.reduce(((e,t)=>{let{products:r}=t;return[...e,...r.map((e=>{let{productId:t}=e;return t})).filter(Boolean).filter((e=>"NONE"===this.getProductLoadingStatus(e)))]}),[]).slice(0,e);return t.forEach((e=>this.setProductLoadingStatus(e,"PENDING"))),t}getPageSize(){const e=_.ServerProps.webProductListMessagePageSize||f.PRODUCT_PAGE_SIZE,t=this.getProductSize();return t<3*e?t:2*e}getProductSize(){return this._productList.productSections.reduce(((e,t)=>{let{products:r}=t;return e+r.length}),0)}setProductLoadingStatus(e,t){this._productsLoadingStatus.set(e,t)}getProductLoadingStatus(e){return this._productsLoadingStatus.get(e)||"NONE"}getTotalProductsFetchedOrFailed(){return Array.from(this._productsLoadingStatus).filter((e=>{let[t,r]=e;return g.includes(r)})).length}getProductList(){return this._productList}getSections(){return this._productList.productSections}getSectionsCount(){return this._productList.productSections.reduce(((e,t)=>{let{title:r}=t;return null!=r&&""!==r?e+1:e}),0)}isFetching(){let e=!1;return this._productsLoadingStatus.forEach((t=>{"PENDING"===t&&(e=!0)})),e}_getFetchStatus(e){return e.status!==h&&e.image_cdn_urls?"SUCCESS":"ERROR"}}m.Proxy="product_list",m.idClass=a.default;const y=(0,o.defineModel)(m);t.ProductMessageList=y},18952:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageListCollectionImpl=t.ProductMessageListCollection=void 0;var i=n(r(48926)),a=r(45454),o=r(1255),s=r(96519),l=r(89295);r(27798);class c extends o.BaseCollection{_queryProductList(e,t){return(0,i.default)((function*(){const r=e.catalogId,n=yield(0,s.queryProductList)(r,e.getNextProductBatchToLoad(),void 0,void 0,t);return{id:e.id,_products:n,fetchedFromServer:!0}}))()}_findQuery(e,t){const r=this.get(e);return null==r?Promise.resolve({id:e}):this._queryProductList(r,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}getOrAdd(e,t,r,n,i){let o=this.get(e);if(null!=o)return o;if(null==n)return null;const s=(0,a.createWid)(n);return o=this.add({id:e,catalogId:s,_productList:t,title:i,requiresDirectConnection:r})[0],null!=o?o:null}}t.ProductMessageListCollectionImpl=c,c.model=l.ProductMessageList,c.staleCollection=!0;const d=new c;t.ProductMessageListCollection=d},40264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_PAGE_SIZE=void 0;t.PRODUCT_PAGE_SIZE=6},13151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSalePriceActive=t.isEmptyPrice=t.getActivePrice=void 0;const r=e=>null!=e.salePriceAmount1000&&(null==e.salePriceStartDate||e.salePriceStartDate<=Date.now())&&(null==e.salePriceEndDate||e.salePriceEndDate>Date.now());t.isSalePriceActive=r;const n=e=>r(e)?e.salePriceAmount1000:e.priceAmount1000;t.getActivePrice=n;t.isEmptyPrice=e=>{const{currency:t,priceAmount1000:r}=e,i=n(e);return!t||null==r||null==i}},6822:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductComplianceCategory=t.ProductAvailability=void 0;const n=r(76672)({IN_STOCK:"in stock",OUT_OF_STOCK:"out of stock",UNKNOWN:"unknown"});t.ProductAvailability=n;const i=r(76672)({Default:"DEFAULT",CountryOriginExempt:"COUNTRY_ORIGIN_EXEMPT"});t.ProductComplianceCategory=i},65563:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyTypes=void 0;const n=r(76672)({TEXT:"text",ADDRESS_SMART_DEFAULT:"address_smart_default",HOURS_SMART_DEFAULT:"hours_smart_default",PROFILE_SMART_DEFAULT:"profile_smart_default"});t.QuickReplyTypes=n},47169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(65563),a=r(2223);class o extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.shortcut=(0,n.prop)(),this.message=(0,n.prop)(),this.count=(0,n.prop)(),this.keywords=(0,n.prop)(),this.pendingCount=(0,n.session)(0),this.totalCount=(0,n.derived)(this._totalCount,["count","pendingCount"]),this.type=(0,n.derived)(this._type,["id"])}_totalCount(){return this.count+this.pendingCount}_type(){var e;switch(null!==(e=i.QuickReplyTypes.cast(this.id))&&void 0!==e?e:i.QuickReplyTypes.TEXT){case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return i.QuickReplyTypes.ADDRESS_SMART_DEFAULT;case i.QuickReplyTypes.HOURS_SMART_DEFAULT:return i.QuickReplyTypes.HOURS_SMART_DEFAULT;case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:return i.QuickReplyTypes.PROFILE_SMART_DEFAULT;default:return i.QuickReplyTypes.TEXT}}useOnce(){this.isSmartDefault()?(this.count+=1,(0,a.updateQuickReply)(this)):(this.pendingCount+=1,this.getCollection().periodicFlush())}getCollection(){return r(99662).QuickReplyCollection}isSmartDefault(){switch(this.type){case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:case i.QuickReplyTypes.HOURS_SMART_DEFAULT:case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return!0;default:return!1}}}o.Proxy="quickReply";var s=(0,n.defineModel)(o);t.default=s},99662:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyCollectionImpl=t.QuickReplyCollection=void 0;var i=n(r(48926)),a=r(50796),o=r(57319),s=r(1255),l=r(7293),c=n(r(47169)),d=r(47787),u=n(r(56891)),p=r(77591);class f extends s.BaseCollection{constructor(){super(...arguments),this.checksum=void 0,this.flushCountsTimer=new o.ShiftTimer((()=>{this.hasPendingCounts()&&this.flushCounts()})),this.sortQuickReply=(e,t)=>e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1,this.onCountsFlushed=e=>{let{id:t,count:r}=e;const n=this.get(t);n&&(n.count=r,n.pendingCount=0)}}delete(){super.delete(),delete this.checksum}filterShortcuts(e){return this.filter((t=>{let{shortcut:r}=t;return r.toLowerCase().startsWith(e.toLowerCase())})).sort(this.sortQuickReply)}sync(e){(0,d.addSmartDefaults)(),l.GK.supportsFeature(l.GK.F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}).catch((0,a.filteredCatch)(p.WebdDrop,(()=>{}))))}periodicFlush(){l.GK.supportsFeature(l.GK.F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}updateChecksum(e){this.checksum=e}synced(){return void 0!==this.checksum}hasPendingCounts(){return this.some((e=>{let{pendingCount:t}=e;return t>0}))}getAllPendingCounts(){const e={};return this.forEach((t=>{let{id:r,pendingCount:n}=t;n>0&&(e[r]=n)})),e}flushCounts(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");const e=this.getAllPendingCounts();u.default.flushQuickReplyCounts(e).then((t=>{t.checksum&&this.updateChecksum(t.checksum),t.data.filter((t=>{let{id:r}=t;return void 0!==e[r]})).forEach(this.onCountsFlushed)})).catch((0,a.filteredCatch)(p.WebdDrop,(()=>{})))}_findQuery(){var e=this;return(0,i.default)((function*(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");const t=e.getAllPendingCounts(),r=yield u.default.queryQuickReplies(t);return r.checksum&&e.updateChecksum(r.checksum),r.data.filter((e=>{let{id:r}=e;return void 0!==t[r]})).forEach(e.onCountsFlushed),r.data}))()}handle(e){e.checksum&&this.updateChecksum(e.checksum);const t=[],r=[];e.quickReplies.forEach((e=>{"delete"===e.type?t.push(e):r.push(e)})),this.remove(t.map((e=>{let{id:t}=e;return t}))),this.add(r,{merge:!0})}}t.QuickReplyCollectionImpl=f,f.model=c.default,f.cachePolicy={id:"quick_replies_collection",policy:s.CACHE_POLICY.LOAD,delay:2e3};const _=new f;t.QuickReplyCollection=_},47787:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSmartDefaults=function(){if(!(0,l.quickRepliesV2Enabled)())return function(){const e=o.QuickReplyTypes.PROFILE_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}(),function(){const e=o.QuickReplyTypes.ADDRESS_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}(),void function(){const e=o.QuickReplyTypes.HOURS_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}();(function(){const e=o.QuickReplyTypes.PROFILE_SMART_DEFAULT,t=function(){const e=a.ContactCollection.get((0,s.getMaybeMeUser)());if(e){const t=o.QuickReplyTypes.PROFILE_SMART_DEFAULT;return new d.default({id:t,shortcut:i.fbt._("profile",null,{hk:"10UPRT"}).toString(),message:e.displayName,count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})})(),function(){const e=o.QuickReplyTypes.ADDRESS_SMART_DEFAULT,t=function(){const e=r(93581).BusinessProfileCollection.get((0,s.getMaybeMeUser)());if((null==e?void 0:e.latitude)||(null==e?void 0:e.longitude)||(null==e?void 0:e.address)){const t=o.QuickReplyTypes.ADDRESS_SMART_DEFAULT,r=e.address||i.fbt._("Map Location",null,{hk:"3wlwI4"});return new d.default({id:t,shortcut:i.fbt._("address",null,{hk:"38K1PS"}).toString(),message:c.default.t(713,{pinEmoji:"",address:r}),count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})}(),function(){const e=o.QuickReplyTypes.HOURS_SMART_DEFAULT,t=function(){var e;const t=r(93581).BusinessProfileCollection,n=r(94010).quickReplyHoursStr,a=t.get((0,s.getMaybeMeUser)());if(null==a||null===(e=a.businessHours)||void 0===e?void 0:e.config){const e=o.QuickReplyTypes.HOURS_SMART_DEFAULT,t=n(a.businessHours);return new d.default({id:e,shortcut:i.fbt._("hours",null,{hk:"1WmWJY"}).toString(),message:t,count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})}()};var i=r(48360),a=r(19380),o=r(65563),s=r(99234),l=r(57701),c=n(r(43725)),d=n(r(47169))},89310:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=r(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)()}contact(){return r(19380).ContactCollection.gadd(this.id)}getCollection(){return r(32826).BlocklistCollection}}o.Proxy="blocklist",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},32826:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistCollectionImpl=t.BlocklistCollection=void 0;var i=r(1255),a=n(r(89310));class o extends i.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.blockContact),this.listenTo(this,"remove",this.unblockContact)}blockContact(e){e.contact().isContactBlocked=!0}unblockContact(e){e.contact().isContactBlocked=!1}}t.BlocklistCollectionImpl=o,o.model=a.default;const s=new o;t.BlocklistCollection=s},15871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.displayText=(0,n.prop)(),this.selected=(0,n.session)(!1)}}i.Proxy="replyButton";var a=(0,n.defineModel)(i);t.default=a},47688:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonCollection=void 0;var i=r(1255),a=n(r(15871));class o extends i.BaseCollection{}t.ButtonCollection=o,o.model=a.default},40122:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(22712),a=r(11290),o=n(r(16142)),s=r(88102),l=r(17239),c=n(r(69594)),d=r(49835);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.peerJid=(0,a.prop)(),this.offerTime=(0,a.prop)(),this.isVideo=(0,a.prop)(!1),this.isGroup=(0,a.prop)(!1),this.groupCallParticipants=(0,a.prop)(),this.canHandleLocally=(0,a.prop)(!1),this.outgoing=(0,a.prop)(!1),this.webClientShouldHandle=(0,a.prop)(!1),this.participants=(0,a.collection)(o.default),this.callInfo=(0,a.prop)(),this._state=(0,a.prop)(),this._ringTimeout=(0,a.prop)()}getState(){return this._state}setState(e){var t;(t=this._state,e in f[t||"EMPTY"])&&(this._state=e,this.handleNotification())}handleNotification(){const e=this.getState();if(!(!l.Conn.tosShowCallNotification||!this.peerJid||c.default.isVoiceCallEnabled()&&!this.isVideo||c.default.isVideoCallEnabled()&&this.isVideo))if(e===d.CALL_STATES.INCOMING_RING){s.Cmd.alertCall(this.peerJid,this.id,this.isVideo,this.isGroup,this.canHandleLocally);i.MainAudioChannel.claim(this,(()=>{}))()}else s.Cmd.cancelCall(this.peerJid)}getCollection(){return r(31218).CallCollection}}u.Proxy="call";var p=(0,a.defineModel)(u);t.default=p;const f={EMPTY:{[d.CALL_STATES.INCOMING_RING]:!0,[d.CALL_STATES.OUTGOING_CALLING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},INCOMING_RING:{[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},OUTGOING_CALLING:{[d.CALL_STATES.OUTGOING_RING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0},OUTGOING_RING:{[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0},CONNECTING:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},CONNECTION_LOST:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},ACTIVE:{[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.CONNECTION_LOST]:!0},HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{},NOT_ANSWERED:{}}},31218:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallCollectionImpl=t.CallCollection=void 0;var i=n(r(81109)),a=n(r(82492)),o=n(r(14176)),s=r(88156),l=r(22712),c=n(r(64369)),d=r(1255),u=n(r(40122)),p=n(r(83938)),f=n(r(96489)),_=r(17506),h=n(r(69594)),g=r(66934),m=r(45473),y=r(32968),E=r(49835);const{VOIP_LOG_COLOR:S}=c.default;let v=null,T=null;class C extends d.BaseCollection{constructor(){super(...arguments),this.pendingOffers={},this.pendingVoipCapChecks={}}handleQuery(){return Promise.resolve()}handle(e){var t;v&&T||(v=r(84356).Voip,T=r(84356).checkVoipCapability);const n=e.shift();if(null===(t=n.data)||void 0===t?void 0:t[0]){const e=g.VoipSignaling.parseCallSignalingMsg(n);if(!e)return;let t={};h.default.isVoiceCallEnabled()&&(Array.isArray(n.data[0])&&(n.data=n.data[0]),(0,g.base64DecodeRecursively)(n.data),t={peer_jid:e.peer_jid,payload:n.data,peer_platform:e.peer_platform,peer_app_version:e.peer_version,epoch_msec:null!=e.t?String(1e3*e.t):void 0,elapsed_msec:null!=e.e?String(1e3*e.e):void 0,is_offline:n.data[1].offline});const r=e.call_id;let a=null,o=null,l=null;const c=JSON.parse(JSON.stringify(n)),d=c.data[2]&&c.data[2].find((e=>"enc"===e[0]));d&&(d[2]="xxx bytes"),__LOG__(2)`voip:incoming_signaling(peer):${JSON.stringify(e)}:`;let u=!1;switch(e.type){case m.TYPE.OFFER:if((0,_.getDoNotDisturb)()&&!f.default.isFocused)return void __LOG__(2)`CallCollection:handle: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`;if(u=!0,a=e.isVideoCall,o=e.isGroupCall_DEPRECATED,l=e.t,v.isInitialized()){this.pendingVoipCapChecks[r]=Promise.all([T((0,i.default)({},e)),(0,p.default)()]).then((e=>{let[t,r]=e;return t&&r}));const t=n.data[2]&&n.data[2].find((e=>"enc"===e[0]));this.pendingOffers[r]=new s.Resolvable,this.pendingOffers[r].promise.then((e=>{e&&g.VoipSignaling.receiveCallOfferKey(e,t)}))}}this.pendingVoipCapChecks[r]?this.pendingVoipCapChecks[r].then((i=>{let s;var c;(s=!o&&(a?i&&h.default.isVideoCallEnabled():i),this.processIncomingCall(r,n.from,{isVideo:a,isGroupCall:o,canHandleLocally:s,offerTime:l}),s&&this.pendingOffers[r]&&h.default.isVoiceCallEnabled())?this.pendingOffers[r].promise.then((()=>{var r;null===(r=v)||void 0===r||r.handleIncomingSignalingMessage(e,t)})):(this.cleanupPendingOffer(r),null===(c=v)||void 0===c||c.handleIncomingSignalingMessage(e,t))})).finally((()=>{delete this.pendingVoipCapChecks[r]})):this.pendingOffers[r]?(u&&this.processIncomingCall(r,n.from),h.default.isVoiceCallEnabled()&&this.pendingOffers[r].promise.then((()=>{var r;null===(r=v)||void 0===r||r.handleIncomingSignalingMessage(e,t)}))):(u&&this.processIncomingCall(r,n.from,{isVideo:a,isGroupCall:o,canHandleLocally:!1,offerTime:l}),v.handleIncomingSignalingMessage(e,t))}else{__LOG__(2)`voip:incoming_signaling(paired phone):${JSON.stringify(n)}:`;const e=this.get(n.id);switch(n.type){case"offer_key":const t=this.pendingOffers[n.id];t&&n.key instanceof ArrayBuffer?t.resolve(n.key):__LOG__(3)`received offer_key: no pending offer`;break;case"accept":case"reject":e&&e.setState(E.CALL_STATES.HANDLED_REMOTELY),v.callEndByHandledRemotely(n.id),this.cleanupPendingOffer(n.id);break;case"terminate":e&&e.setState(E.CALL_STATES.ENDED),this.cleanupPendingOffer(n.id)}}}processIncomingCall(e,t,r){if(null!=this.get(e))return void __LOG__(2)`voip:processIncomingCall: Attempting to add existing call with call ID`;let n=r;const i={id:e};null!=t&&(i.peerJid=t),n&&(n=(0,o.default)(n,(e=>null==e)),(0,a.default)(i,n)),this.add(i,{merge:!0})}cleanupPendingOffer(e){delete this.pendingOffers[e]}setActiveCall(e){var t,r;const n=this.activeCall&&!e,i=null===(t=this.activeCall)||void 0===t?void 0:t.webClientShouldHandle;this.activeCall=e,this.trigger("change:activeCall",e),n&&i&&(0,y.playEndCallTone)(),null===(r=this._releaseAudioChannelClaim)||void 0===r||r.call(this),null!=e&&(this._releaseAudioChannelClaim=l.MainAudioChannel.claim(this,(()=>{})))}}t.CallCollectionImpl=C,C.model=u.default;const A=new C;t.CallCollection=A},8384:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.callId=(0,n.prop)(),this.isIncoming=(0,n.prop)(!1),this.isRinging=(0,n.prop)(!1),this.isInterrupted=(0,n.prop)(!1),this.isMuted=(0,n.prop)(!1),this.isTrafficStopped=(0,n.prop)(!1),this.isInvitingToGroupCall=(0,n.prop)(!1),this.isVideoStopped=(0,n.prop)(!1),this.isVideoPaused=(0,n.prop)(!1),this.isVideoDecodePaused=(0,n.prop)(!1),this.isVideoDecodeStarted=(0,n.prop)(!1),this.isOfferingVideoUpgrade=(0,n.prop)(!1)}}i.Proxy="callParticipant";var a=(0,n.defineModel)(i);t.default=a},16142:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(32304)),a=r(1255),o=n(r(8384));class s extends a.BaseCollection{}t.default=s,s.model=o.default,s.comparator=(e,t)=>e.id===t.id?0:(0,i.default)(e.id,t.id)?-1:1},13424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_TYPES=t.BaseCallUi=void 0;var n=r(11290),i=r(49835);t.CALL_TYPES={VOICE:"VOICE",VIDEO:"VIDEO"};class a extends n.BaseModel{constructor(){super(...arguments),this.callId=(0,n.session)(),this.state=(0,n.session)(i.CALL_UI_STATES.NONE),this.from=(0,n.session)(),this.to=(0,n.session)(),this.type=(0,n.session)(),this.muted=(0,n.session)(),this.peerMuted=(0,n.session)(),this.speaker=(0,n.session)(),this.outgoing=(0,n.session)(),this.startTime=(0,n.session)(),this.showFullscreenCallView=(0,n.session)(!1),this.showCallStatusBar=(0,n.session)(!1),this.externalInputAvailable=(0,n.session)(),this.interrupted=(0,n.session)(),this.peerBusy=(0,n.session)(),this.peerVideoState=(0,n.session)(),this.voipWindowId=(0,n.session)(),this.isGroup=(0,n.session)(),this.groupCallParticipants=(0,n.session)()}onStateChange(){}onAudioOutputChange(){}overrideOutputRoute(){return Promise.resolve()}}t.BaseCallUi=a,a.Proxy="callUi"},97048:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CALL_TYPES",{enumerable:!0,get:function(){return i.CALL_TYPES}}),Object.defineProperty(t,"CALL_UI_STATES",{enumerable:!0,get:function(){return o.CALL_UI_STATES}}),t.CallUi=void 0,Object.defineProperty(t,"OUTPUT_DEVICES",{enumerable:!0,get:function(){return n.OUTPUT_DEVICES}});var n=r(71386),i=r(13424),a=r(11290),o=r(49835);const s=new((0,a.defineModel)(i.BaseCallUi));t.CallUi=s},63183:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.KIND=t.ConversationEndOfHistoryTransferModelPropType=t.Chat=t.CHAT_KIND=void 0,t.getForwardedMessageFields=Je;var a=i(r(48926)),o=i(r(81109)),s=i(r(57557)),l=i(r(2525)),c=i(r(91966)),d=i(r(75472)),u=i(r(66678)),p=i(r(41609)),f=i(r(23279)),_=r(89385),h=r(50796),g=i(r(45095)),m=r(13959),y=r(4352),E=r(35470),S=r(13042),v=i(r(64369)),T=i(r(65212)),C=r(15461),A=r(64603),b=i(r(89867)),P=r(45454),M=r(48360),O=r(86945),I=r(46331),w=i(r(15421)),R=r(54958),D=r(11290),N=i(r(54248)),L=r(48285),k=i(r(6977)),G=i(r(77653)),U=i(r(65568)),F=r(51612),x=i(r(21423)),B=i(r(16173)),K=r(22683),j=r(88102),Y=r(17239),W=i(r(89520)),H=r(19380),V=i(r(35667)),$=r(47473),z=r(24606),q=r(60324),J=i(r(96222)),Q=Ve(r(64103)),X=r(99234),Z=i(r(24238)),ee=r(7293),te=r(57701),re=r(29331),ne=i(r(89748)),ie=i(r(43725)),ae=r(905),oe=r(10435),se=i(r(64084)),le=r(78986),ce=i(r(11339)),de=r(17304),ue=r(59871),pe=r(55843),fe=r(54676),_e=r(72472),he=r(47524),ge=r(6684),me=r(371),ye=r(68315),Ee=r(91450),Se=r(82039),ve=i(r(86243)),Te=r(81027),Ce=r(86657),Ae=r(75887),be=(r(13705),r(19569)),Pe=r(69694),Me=r(92052),Oe=r(30152),Ie=r(19011),we=i(r(58492)),Re=Ve(r(22906)),De=r(70768),Ne=r(37894),Le=i(r(41809)),ke=r(43323),Ge=r(27211),Ue=r(58871),Fe=i(r(87798)),xe=r(84728),Be=i(r(17072)),Ke=i(r(56891)),je=r(77591),Ye=r(65044),We=r(85893);function He(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(He=function(e){return e?r:t})(e)}function Ve(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=He(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const $e=r(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1,INCOMPLETE:2});t.ConversationEndOfHistoryTransferModelPropType=$e;const ze={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"};t.CHAT_KIND=t.KIND=ze;class qe extends we.default{constructor(){super(...arguments),this.id=(0,D.prop)(),this.t=(0,D.prop)(),this.unreadCount=(0,D.prop)(0),this.archive=(0,D.prop)(),this.isReadOnly=(0,D.prop)(),this.isAnnounceGrpRestrict=(0,D.prop)(),this.modifyTag=(0,D.prop)(),this.muteExpiration=(0,D.prop)(0),this.name=(0,D.prop)(),this.notSpam=(0,D.prop)(),this.pin=(0,D.prop)(),this.labels=(0,D.prop)(),this.changeNumberOldJid=(0,D.prop)(),this.changeNumberNewJid=(0,D.prop)(),this.lastReceivedKey=(0,D.prop)(),this.ephemeralDuration=(0,D.prop)(),this.ephemeralSettingTimestamp=(0,D.prop)(),this.disappearingModeInitiator=(0,D.prop)(),this.createdLocally=(0,D.session)(),this.pendingAction=(0,D.session)(),this.formattedTitle=(0,D.session)(),this.active=(0,D.session)(),this.pausedTimerId=(0,D.session)(),this.presenceResendTimerId=(0,D.session)(),this.recording=(0,D.session)(),this.typing=(0,D.session)(),this.colors=(0,D.session)(),this.composeContents=(0,D.session)((()=>({}))),this.attachMediaContents=(0,D.session)(),this.pttRecordingSession=(0,D.session)(),this.squelch=(0,D.session)(),this.reactionSquelch=(0,D.session)(),this.pendingSeenCount=(0,D.session)(0),this.unreadMsgAnchor=(0,D.session)(),this.markedUnread=(0,D.session)(),this.trusted=(0,D.session)(),this.canSend=(0,D.session)(),this.promises=(0,D.session)((()=>({}))),this.ftsCache=(0,D.session)((()=>({}))),this.composeQuotedMsg=(0,D.session)(),this.composeQuotedMsgRemoteJid=(0,D.session)(),this.quotedMsgAdminGroupJid=(0,D.session)(),this.quotedMsgAdminGroupSubject=(0,D.session)(),this.quotedMsgAdminParentGroupJid=(0,D.session)(),this.groupMetadata=(0,D.session)(),this.presence=(0,D.session)(),this.mute=(0,D.session)(),this.contact=(0,D.session)(),this.liveLocation=(0,D.session)(),this.liveLocationQueried=(0,D.session)(!1),this.ackedProps=(0,D.session)((()=>({}))),this.mediaCount=(0,D.session)(0),this.linkCount=(0,D.session)(0),this.docCount=(0,D.session)(0),this.productCount=(0,D.session)(0),this.unreadMentionsOfMe=(0,D.prop)(),this.unreadMentionCount=(0,D.prop)(),this.hasUnreadMention=(0,D.prop)(!1),this.archiveAtMentionViewedInDrawer=(0,D.prop)(!1),this.hasChatBeenOpened=(0,D.prop)(!1),this.tcToken=(0,D.prop)(),this.tcTokenTimestamp=(0,D.prop)(),this.tcTokenSenderTimestamp=(0,D.prop)(),this.msgUnsyncedButtonReplyMsgs=(0,D.prop)(),this.vcardDismissed=(0,D.session)(!1),this.endOfHistoryTransfer=(0,D.session)(!1),this.endOfHistoryTransferType=(0,D.prop)(),this.hasEstablishedE2EESession=(0,D.session)(!1),this.pendingInitialLoading=(0,D.prop)(!1),this.kind=(0,D.derived)(this._kind),this.isUser=(0,D.derived)(this._isUser),this.isPSA=(0,D.derived)(this._isPSA),this.isGroup=(0,D.derived)(this._isGroup),this.isBroadcast=(0,D.derived)(this._isBroadcast),this.isBusinessGroup=(0,D.derived)(this._isBusinessGroup),this.canUnread=(0,D.derived)(this._canUnread),this.hasUnread=(0,D.derived)(this._hasUnread,["unreadCount"]),this.optimisticUnreadCount=(0,D.derived)(this._optimisticUnreadCount,["unreadCount","pendingSeenCount"]),this.shouldShowUnreadDivider=(0,D.derived)(this._shouldShowUnreadDivider,["unreadCount","unreadMsgAnchor"]),this.shouldAppearInList=(0,D.derived)(this._shouldAppearInList,["createdLocally","msgs","msgsLength","groupMetadata"]),this.previewMessage=(0,D.derived)(this._previewMessage,["msgs","msgsChanged"]),this.showChangeNumberNotification=(0,D.derived)(this._showChangeNumberNotification,["changeNumberOldJid","changeNumberNewJid","id","isUser"]),this.shouldShowUnreadInTitle=(0,D.derived)(this._shouldShowUnreadInTitle,["isGroup","archive","optimisticUnreadCount","muteExpiration"]),this.deleteSignal=(0,D.derived)(this._getDeleteSignal)}initialize(){super.initialize(),this.addQueue=new ne.default,this.sendQueue=new ne.default,this._ephemeralMessagesToDelete=new Set,this._ephemeralMessageTimerIds=new Map,this._abortController=new n,this.msgs.msgLoadState.contextLoaded=!0,this.addChild("presence",ye.PresenceCollection.gadd(this.id));const e=_e.MuteCollection.get(this.id);if(e?this.addChild("mute",e):this.addChild("mute",_e.MuteCollection.gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",H.ContactCollection.gadd(this.id)),this.name&&!this.contact.name){const e={name:this.name};this.isGroup?this.contact.set(e):(0,Ge.updateLocal)(this.contact.id,e).then((()=>{this.contact.set(e)}))}if(this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.listenTo(De.TosManager,"change",this.updateCanSend),this.listenTo(this.contact,"change:privacyMode",this.updateCanSend),this.isGroup||this.isBroadcast){const e=this.getGroupMetadataCollection();let t;this.isBroadcast&&!e.get(this.id)&&(t=!0);const r=e.gadd(this.id);if(this.addChild("groupMetadata",r),this.listenTo(r,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(r.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(r,"change:trusted change:stale",this.isTrusted),this.listenTo(r,"change:participants change:stale",this.updateReadOnly),this.listenTo(r.participants,"change:contact.formattedShortName",this.updateTitle),(0,oe.isGroupCatchUpEnabled)()){if(this.unreadMentionsOfMe){const e=this.unreadMentionsOfMe.map((e=>new Le.default({id:e.id,timestamp:e.timestamp})));r.unreadMentionMetadata.addUnreadMentions(e,ke.UnreadMessageType.PERSISTANCE_LOAD)}null!=this.unreadMentionCount&&(r.unreadMentionMetadata.pendingUnreadMentionCount=this.unreadMentionCount),this._handleUnreadMention(),this.listenTo(r.unreadMentionMetadata.unreadMentionCollection,"add remove reset",this._handleUnreadMention),this.listenTo(r.unreadMentionMetadata,"change:pendingUnreadMentionCount",this._handleUnreadMention)}this.updateReadOnly(),this.updateIsAnnounceGrpRestrict();const n=this.id;this.listenTo(this,"change:isReadOnly",(function(){this.isTrusted(),this.updateCanSend(),Se.ProfilePicThumbCollection.update(n).catch((0,h.filteredCatch)(je.WebdDrop,(()=>{}))),e.update(n).catch((0,h.filteredCatch)(je.WebdDrop,(()=>{})))})),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),this.listenTo(this,"change:archive",(()=>{!0===this.archive&&(0,R.shouldEnableArchiveV2)()&&(0,Me.setArchiveEnabledSetting)(!0)})),t&&e.update(n).catch((0,h.filteredCatch)(je.WebdDrop,(()=>{})))}else this.listenTo(this.presence,"change:isOnline",(()=>(0,me.presenceOnlineChanged)(this)));const t=this.getCollection();t.notSpam[this.id]&&!this.notSpam&&(0,be.sendNotSpam)(this).catch((()=>{})),t.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this.msgs,"add",this._deregisterExpiredViewOnceMessage),this.listenTo(this.msgs,"bulk_add",this.deregisterExpiredViewOnceBulkMessages),this.listenTo(this.msgs,"add remove change:ephemeralExpirationTimestamp",this._resetEphemeralMessageExpirationTimer),this.listenTo(this.msgs,"bulk_add",(e=>{e.forEach((e=>{this._resetEphemeralMessageExpirationTimer(e)}))})),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=(0,f.default)(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this._handleActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache),this.listenTo(ie.default,"locale_change",(()=>{this.updateTitle()})),Y.Conn.isSMB&&(0,ae.initializeLabels)(this)}_handleUnreadMention(){this.isGroup&&this.groupMetadata&&(0,oe.isElevatedImportantMessageEnabled)()&&(this.hasUnreadMention=this.groupMetadata.unreadMentionMetadata.getUnreadMentionCount()>0)}_kind(){return b.default.isGroup(this.id)?ze.GROUP:b.default.isBroadcast(this.id)?ze.BROADCAST:b.default.isUser(this.id)?ze.CHAT:void __LOG__(2)`chat:unknown kind id:${this.id.toString()}`}_isUser(){return b.default.isUser(this.id)}_isPSA(){return b.default.isPSA(this.id)}_isGroup(){return b.default.isGroup(this.id)}_isBroadcast(){return b.default.isBroadcast(this.id)}_isBusinessGroup(){var e;const t=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getAdmins();if(!t)return!1;for(const e of t){const t=H.ContactCollection.get(e.id);if(null==t?void 0:t.isBusiness)return!0}return!1}isSupportGroup(){var e;return this.isGroup&&!0===(null===(e=this.groupMetadata)||void 0===e?void 0:e.support)}isSupportGroupOrSupportAdmin(){return this.isSupportGroup()||(0,Z.default)(this.id.user)}_canUnread(){return!this.isBroadcast}_hasUnread(){return 0!==this.unreadCount}_optimisticUnreadCount(){const{unreadCount:e,pendingSeenCount:t}=this;return e===v.default.MARKED_AS_UNREAD?e:Math.max(0,e-t)}_shouldShowUnreadDivider(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){const{msgChunk:e}=this.unreadMsgAnchor,t=e?e.getModelsArray():[];return this.unreadMsgAnchor!==t.find((e=>e.isUnreadType))}if(this.msgs.msgLoadState.noEarlierMsgs){return this.msgs.filter((e=>e.isUnreadType)).length!==this.unreadCount}return!0}_shouldAppearInList(){var e;if(ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&this.isBroadcast)return!1;if(this._shouldAppearInListLatched)return!0;if(b.default.isStatusV3(this.id))return!1;if(this.isGroup&&!0===(null===(e=this.groupMetadata)||void 0===e?void 0:e.isParentGroup)&&(0,te.communitiesEnabled)())return!1;const t=this.msgs.some((e=>!(e.type===C.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals((0,X.getMaybeMeUser)())||e.isInitialE2ENotification||e.type===C.MSG_TYPE.CALL_LOG||e.isBizNotification||"change_number"===e.subtype||e.isDisappearingModeSystemMessage)));return this._shouldAppearInListLatched=!this.createdLocally||t,this._shouldAppearInListLatched}_previewMessage(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&t.type!==C.MSG_TYPE.E2E_NOTIFICATION&&t.type!==C.MSG_TYPE.NOTIFICATION_TEMPLATE&&t.type!==C.MSG_TYPE.REACTION)return t}if(this.msgs.length>0)return this.msgs.last()}_showChangeNumberNotification(){if(!ee.GK.supportsFeature(ee.GK.F.CHANGE_NUMBER_V_2))return!1;const{changeNumberOldJid:e,changeNumberNewJid:t,id:r,isUser:n}=this;if(!n)return!1;if(!e&&!t)return!1;const i=H.ContactCollection.get(t||r);return!(null==i?void 0:i.isMyContact)}_shouldShowUnreadInTitle(){const e=!!this.muteExpiration;if(this.archive)return!1;if(this.optimisticUnreadCount<=0)return!1;if(!this.isGroup)return!e;if(!e)return!0;if(!this.msgs||0===this.msgs.length)return!1;let t=!1;const r=this.msgs,n=this.optimisticUnreadCount;let i=Math.max(0,r.length-n);for(;i<r.length;i++){const e=this.msgs.at(i);if(!e)continue;const r=(0,X.getMaybeMeUser)();if(e.isMentioned(r)||e.isQuoted(r)){const r=this.getCollection().get(e.sender);if(!r||!r.muteExpiration){t=!0;break}}}return t}_getDeleteSignal(){return this._abortController.signal}set(e,t,r){"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(t):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration);return super.set(e,t,r)}addPendingAction(e){const t=()=>{this.decPending()};e.then(t,t),this.pendingAction++}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}_handleActiveUpdate(){this.isGroup&&this.active&&(this.squelch=v.default.SQUELCH_RESET_VALUE,this.reactionSquelch=v.default.SQUELCH_RESET_VALUE,this.hasChatBeenOpened=!0),this.presence.chatActive=this.active,this.active||(this.msgs.filter((e=>(0,xe.isExpired)(e.safe()))).forEach(le.deregisterMsg),ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&(0,q.removeExpiredMessagesFromHistory)(Array.from(this._ephemeralMessagesToDelete)).then((()=>{if((0,te.receiveReactionsEnabled)()){const e=Array.from(this._ephemeralMessagesToDelete).map((e=>e.id.toString()));if(e.length>0){(0,r(68819).getJobManager)().waitUntilPersisted(ge.jobSerializers.deleteReactions(this.id.toString(),e))}}})),this._ephemeralMessagesToDelete.forEach((e=>{this._ephemeralMessagesToDelete.delete(e),e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})})))}onPendingActionUpdate(){this.pendingAction<0&&(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}onNotSpamChange(){var e;(this.getCollection().notSpam[this.id]=this.notSpam,this.isGroup)&&(null===(e=this.groupMetadata)||void 0===e||e.set({notAddedByContact:!1}));this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}hasMaybeSentMsgToChat(){return this.getAllMsgs().some((e=>e.isSentByMe))}isTrusted(){let e=!1;var t;this.isGroup?e=this.isReadOnly||this.notSpam||(null===(t=this.groupMetadata)||void 0===t?void 0:t.isTrusted()):this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact);return!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=Boolean(e)}updateMuteExpiration(){const e=Number(this.mute.expiration);(0,Ue.updateLocal)(this.id,{muteExpiration:e}).then((()=>this.muteExpiration=e))}updateTitle(){var e,t;this.isBroadcast?this.formattedTitle=this.contact.name||(null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[]).map((function(e){return e.contact.formattedShortName})).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}isSuspendedGroup(){if(ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)){var e;return(0,O.getABPropConfigValue)("group_suspend_v0_enabled")&&this.isGroup&&!!(null===(e=this.groupMetadata)||void 0===e?void 0:e.suspended)}return!1}isInviteGrowthLockedGroup(){var e;return!(!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||!(0,O.getABPropConfigValue)("growth_lock_v0_enabled"))&&(this.isGroup&&"invite"===(null===(e=this.groupMetadata)||void 0===e?void 0:e.growthLockType)&&(this.groupMetadata.growthLockExpiration||0)>K.Clock.globalUnixTime())}title(){return this.isGroup?this.formattedTitle||M.fbt._("unknown subject",null,{hk:"3Lg3Zm"}).toString():this.formattedTitle}getTcToken(){return ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)?null==this.tcToken||null==this.tcTokenTimestamp||(0,A.isTokenExpired)(this.tcTokenTimestamp,A.TcTokenMode.Receiver)?null:this.tcToken:null}isPresenceUnknown(){return!(!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||!(0,O.getABPropConfigValue)("trusted_contacts_ti")||null!=this.getTcToken())}updateCanSend(){return this.isReadOnly||this.isAnnounceGrpRestrict||(0,Ne.shouldBlockByTos)(this.contact)||(0,$.shouldBlockByCountry)(this.contact)?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}delete(){super.delete(),this.getCollection().remove(this.id),this._abortController.abort(),this.presence.delete(),this.liveLocation&&this.liveLocation.delete(),j.Cmd.closeChat(this),this.groupMetadata&&this.groupMetadata.delete(),this.mediaMsgs&&this.mediaMsgs.delete(),this.linkMsgs&&this.linkMsgs.delete(),this.docMsgs&&this.docMsgs.delete(),this.productMsgs&&this.productMsgs.delete();const e=this.starredMsgs;e&&(e.delete(),e.stopListening(),e.reset()),this.receivedVcardMsgs&&this.receivedVcardMsgs.delete(),(0,X.deleteComposeContents)(this.id)}isDirty(){return 0!==this.unreadCount}resetMediaMsgs(){const{mediaMsgs:e,linkMsgs:t,docMsgs:r,productMsgs:n}=this;e&&(e.delete(),e.queryMedia({chat:this})),t&&(t.delete(),t.queryLinks(this)),r&&(r.delete(),r.queryDocs(this)),n&&(n.delete(),n.queryProducts(this))}isMsgForMediaCollection(e){return e.isMedia&&!e.isViewOnce}addMediaMsgs(e,t){if(!e)return;const r=Array.isArray(e)?e:[e],n=[],i=[],a=[],s=[];r.forEach((e=>{this.isMsgForMediaCollection(e)&&n.push(e),e.asDoc&&a.push(e),e.linkPreview&&i.push(e),null!=e.asProduct&&s.push(e)}));const{mediaMsgs:l}=this;if(l&&n.length){const e=ee.GK.isMediaGalleryFixEnabled()?(0,o.default)((0,o.default)({},t),{},{silent:!1}):(0,o.default)({},t);l.add(n,e)}this.linkMsgs&&i.length&&this.linkMsgs.add(i,t),this.docMsgs&&a.length&&this.docMsgs.add(a,t),this.productMsgs&&s.length&&this.productMsgs.add(s,t)}onNewMsg(e){var t=this;if(!e)return;let r=Promise.resolve();e.isSentByMe&&!this.notSpam&&(r=(0,Ue.updateLocal)(this.id,{notSpam:!0}).then((()=>this.notSpam=!0))),"i"!==e.eventType&&r.then((0,a.default)((function*(){const r={};if(ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||(r.t=e.t),t.promises.updateSortTime&&t.promises.updateSortTime.abortController.abort(),t.updateMediasCountOnMsg(e),(!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&e.isSentByMeFromWeb)&&t.archive&&(0,R.shouldUnarchiveChat)(e.isSentByMe)&&(r.archive=!1),t.promises.setArchive&&t.promises.setArchive.abortController.abort(),e.isSentByMe?t.markedUnread=!1:((0,N.default)({id:t.id,participant:e.author,type:"paused"},!1),ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||"a"!==e.eventType&&"d"!==e.eventType||(r.unreadCount=t.unreadCount+1||1)),yield(0,Ue.updateLocal)(t.id,r),ee.GK.supportsFeature(ee.GK.F.MD_BACKEND))try{const{unreadCount:e,timestamp:n}=yield(0,L.getChatMeta)(t.id);r.t=n,r.unreadCount=e}catch(e){__LOG__(4,void 0,new Error)`onNewMsg: unable to find metadata from chat table for id:${t.id.toString()}`}return r}))).then((t=>{e.isSentByMeFromWeb&&e.sendDeferred?this.setAndKeepPrevious(t,e.sendDeferred.promise):this.set(t);const r=V.default.get(this.id);if(r&&(r.timestamp=K.Clock.globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,X.getMaybeMeUser)().toString()}`,this.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&j.Cmd.alertNewMsg(e),this.msgs.length<S.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs(void 0,ce.default.WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH).catch((0,h.filteredCatch)(je.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onNewMsg failed\n${e}`}));break;case"n":e.type===C.MSG_TYPE.CALL_LOG&&j.Cmd.alertNewMsg(e);break;case"s":if("gp2"===e.type&&"add"===e.subtype&&(0,X.getMaybeMeUser)().equals(e.recipients[0])&&!this.contact.name)return;j.Cmd.alertNewMsg(e);this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,X.getMaybeMeUser)().toString()}`,this.id)}const r=e.mediaData;if(!r||"image"!==r.type&&"video"!==r.type||j.Cmd.newMediaMsg(e),ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&t.unreadCount&&(0,re.processOrphanPeerReceipt)(e.id),(0,oe.isGroupCatchUpEnabled)()&&(0,fe.isImportantMessage)(e)){var n;const t=new Le.default({id:e.id.toString(),timestamp:e.t});if(null===(n=this.groupMetadata)||void 0===n||n.unreadMentionMetadata.addUnreadMentions(t,ke.UnreadMessageType.NEW_MESSAGE),this.archiveAtMentionViewedInDrawer){const e=new Map;e.set(this.id.toString(),!1),(0,L.updateChatArchiveDrawer)(e),this.archiveAtMentionViewedInDrawer=!1}}}}))}canPin(){var e;if(this.archive)return!1;const t=null===(e=this.promises)||void 0===e?void 0:e.setArchive;return!(null==t?void 0:t.archive)}canArchive(){return!this.isBroadcast||ee.GK.supportsFeature(ee.GK.F.ARCHIVE_BROADCAST)}sendDismissChangeNumber(){if(this.promises.sendDismissChangeNumber)return this.promises.sendDismissChangeNumber;const e=ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)?Promise.resolve({status:200,_duplicate:null}):Ke.default.sendConversationDismissChangeNumber(this.id);this.promises.sendDismissChangeNumber=e;const t=new I.ActionType(M.fbt._("Dismissing change number notification.",null,{hk:"XSlwz"})),r=e.then((e=>200===e.status?new I.ActionType(M.fbt._("Change number notification dismissed.",null,{hk:"1QpySR"})):e.status>=400?new I.ActionType(M.fbt._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"})):void 0)).catch((()=>(__LOG__(3)`models:chat:sendDismissChangeNumber dropped`,new I.ActionType(M.fbt._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"}),{actionText:ie.default.t(129),actionHandler:this.sendDismissChangeNumber.bind(this)}))));return j.Cmd.openToast((0,We.jsx)(I.ActionToast,{id:(0,I.genId)(),initialAction:t,pendingAction:r})),e.then((e=>{if(200===e.status&&!e._duplicate)return(0,Ue.updateLocal)(this.id,{changeNumberNewJid:void 0,changeNumberOldJid:void 0}).then((()=>{this.changeNumberOldJid=this.changeNumberNewJid=void 0}))})).finally((()=>{this.promises.sendDismissChangeNumber=null}))}setComposeContents(e){this.composeContents=e}getSessionPersistedComposeContents(){return(0,X.getComposeContents)(this.id)}getComposeContents(){return(0,p.default)(this.composeContents)?this.getSessionPersistedComposeContents()||{}:this.composeContents}setAttachMediaContents(e){this.attachMediaContents=e}preload(){1===this.msgs.length&&this.loadEarlierMsgs().catch((0,h.filteredCatch)(je.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:preload failed\n${e}`}))}onEmptyMRM(){__LOG__(2)`models:Chat:removeMsg 0 messages left, querying...`,this.loadEarlierMsgs().catch((0,h.filteredCatch)(je.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onEmptyMRM failed\n${e}`}))}loadEarlierMsgs(e,t,r){var n=this;return(0,a.default)((function*(){ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&(yield n.waitForChatLoading());let i=e;const a=null!=t?t:ce.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL;if(i||(i=n.msgs),i.msgLoadState.noEarlierMsgs)return Promise.resolve();if(i.msgLoadState.isLoadingEarlierMsgs)return i.loadEarlierPromise;const o=i?i.head():null,s=yield n._loadMsgs("before",i,a,r),l=o?o.msgChunk:i;return l&&Array.isArray(s)&&s.length<S.PAGE_SIZE&&(l.msgLoadState.noEarlierMsgs=!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||n.endOfHistoryTransferType!==$e.INCOMPLETE),l&&n.isMostRecentCMC(l)&&n.trigger("msgs:loadEarlier"),s}))()}isMostRecentCMC(e){return this.msgs===e}loadRecentMsgs(e,t){let r=e;return r||(r=this.msgs),this.isMostRecentCMC(r)?Promise.resolve():r.msgLoadState.isLoadingRecentMsgs?r.loadRecentPromise:this._loadMsgs("after",r,ce.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL,t)}_loadMsgs(e,t,r,n){let i;i="after"===e?t.last():t.head();let a={};i?a=i.id.clone():a.remote=this.id,a.count=S.PAGE_SIZE,a.direction=e;const o=(0,pe.newMessageQueryEvent)(r);return this._loadMsgsPromiseLoop(i,t,ue.MsgCollection.findQuery.bind(ue.MsgCollection,a,{logOnSend:e=>{o.webcResponseBytes+=e.binarySize}}),e,o,!0,n)}_updateMsgLoadState(e,t,r){const n=(null==e?void 0:e.msgChunk)&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&n&&((0,g.default)(e.msgChunk,"msg.msgChunk").msgLoadState.contextLoaded=!0),"after"===r?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===r?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!1)}_loadMsgsPromiseLoop(e,t,r,n,i){var o=this;let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0;const c=performance.now();"after"===n?(t.msgLoadState.isLoadingRecentMsgs=!0,i.webcMessageQueryType=ce.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===n?(t.msgLoadState.isLoadingEarlierMsgs=!0,i.webcMessageQueryType=ce.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!0,i.webcMessageQueryType=ce.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),i.webcBrowserNetworkType=(0,he.getEffectiveNetworkType)(),i.webcChatType=this.getWebcChatType(),"number"==typeof this.initialIndex&&(i.webcChatPosition=this.initialIndex);const d=(0,ve.default)([l,this._abortController.signal].filter(Boolean),(s=>(0,y.promiseLoop)(function(){var l=(0,a.default)((function*(a,l,d){if(s.aborted)throw new _.AbortError;const u=(0,m.delayMs)(Re.expBackoff(d,12e4,1e3,.1));let p=Promise.resolve();ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||"CONNECTED"===Ye.Socket.stream||(p=(0,Be.default)(Ye.Socket,"change:stream",(()=>"CONNECTED"===Ye.Socket.stream)));try{yield p;const l=yield r();if(s.aborted)throw new _.AbortError;let d;i.webcQueryT=Math.ceil(performance.now()-c),Array.isArray(l[0])?(d=l[0][0],l.forEach((e=>(0,pe.logMessageCounts)(i,e)))):(d=l[0],(0,pe.logMessageCounts)(i,l)),d&&(i.webcEarliestMessageT=d.t,d.msgChunk===o.msgs&&(i.webcEarliestMessageIndex=o.msgs.length-1)),(0,J.default)().then((e=>{e&&(i.webcBrowserStorageQuotaBytes=e.quota,i.webcBrowserStorageQuotaUsedBytes=e.usage)})).finally((()=>i.commit())),o._updateMsgLoadState(e,t,n),a(l)}catch(r){if(r.name===_.ABORT_ERROR)throw r;return d>3||404===r?(o._updateMsgLoadState(e,t,n),__LOG__(3)`chat:loadMsgs:error ${String(r)}`,404===r?Promise.reject(new je.E404):Promise.reject(new Q.GaveUpRetry(`Gave up msg fetch after ${d} tries`))):u}}));return function(){return l.apply(this,arguments)}}(),0))).catch((0,h.filteredCatch)(Q.GaveUpRetry,(()=>[]))).catch((0,h.filteredCatch)(je.E404,(e=>{if(s)return[];throw e})));return"after"===n?t.loadRecentPromise=d:"before"===n?t.loadEarlierPromise=d:"around"===n&&(t.loadAroundPromise=d),d}getSearchContext(e,t){let r,n=null;e instanceof de.Msg?n=e:e instanceof T.default&&(r=e);let i=n?n.msgChunk:void 0;const a=Math.trunc(S.PAGE_SIZE/3*2);if(!i||!i.msgLoadState.contextLoaded){i||(i=new F.ChatMsgsCollection,this.msgChunks.push(i),n&&i.add(n));const e=n?n.id.clone():r.clone();e.count=a;const o=function(){if(n)return n.msgChunk;if(null!=r){const e=ue.MsgCollection.get(r);return(null==e?void 0:e.msgChunk)?e.msgChunk:i}return i},s=(0,pe.newMessageQueryEvent)(ce.default.WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK);this._loadMsgsPromiseLoop(n,i,ue.MsgCollection.getContext.bind(ue.MsgCollection,e,o,(e=>{s.webcResponseBytes+=e.binarySize})),"around",s,null==t).then((e=>{const t=o();t&&i&&t!==i&&this.notifyMsgCollectionMerge(t,i,t);const s=e[0],l=r?ue.MsgCollection.get(r):n;l&&Array.isArray(s)&&s.length<a&&((0,g.default)(l.msgChunk,"loadedMsg.msgChunk").msgLoadState.noEarlierMsgs=!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==$e.INCOMPLETE,i&&l.msgChunk!==i&&(i.msgLoadState.noEarlierMsgs=!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==$e.INCOMPLETE))})).catch((()=>{t&&(t.isQuotedMsgAvailable=!1)}))}return{collection:i,msg:n,key:r,highlightMsg:!0}}sendStarMsgs(e,t){return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=(0,Pe.sendStarMsgs)(this.id,e,t).then((()=>{e.forEach((e=>{e.set("star",t)})),t?(0,Ie.addStarredMsgs)(e):(0,Ie.removeStarredMsgs)(e)})).finally((()=>{this.promises.sendStarMsgs=null}))}sendRevokeMsgs(e,t){return this.promises.sendRevokeMsgs?this.promises.sendRevokeMsgs:this.promises.sendRevokeMsgs=Promise.all(e.map((e=>(0,Te.sendRevoke)(e,e.canSenderRevoke()?j.Revoke.Sender:j.Revoke.Admin,t)))).finally((()=>{this.promises.sendRevokeMsgs=null}))}sendDeleteMsgs(e,t){return this.promises.sendDeleteMsgs||(this.promises.sendDeleteMsgs=(0,Ce.sendDeleteMsgs)(e,t,this.id).then((()=>(e.forEach((e=>{e.delete()})),e.length))).catch((0,h.filteredCatch)(je.ServerStatusCodeError,(()=>{let t=0;return e.forEach((e=>{(e.ack===E.ACK.FAILED||e.isExpired())&&(e.delete(),t++)})),t}))).finally((()=>{this.promises.sendDeleteMsgs=null}))),this.promises.sendDeleteMsgs}deleteMsgs(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}deleteMsgsOlderThan(e,t,r){const n=this.msgs;let i=n.head();!i||i.t>=e||(i=n.last(),i&&i.t<e?this.deleteMsgs(t,r):this.deleteMsgsPartial((function(n){return n&&(r&&!(0,fe.msgMatchesType)(n,r)||n.star&&!t||n.t>=e||n.isInitialE2ENotification)})))}deleteMsgsBeforeMsgInclusive(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(e){if(!this.msgs.get(e.id))return;t=this.msgs.indexOf(e)}else t=this.msgs.length;this.deleteMsgsPartial((function(e,i){return n&&!(0,fe.msgMatchesType)(e,n)||e.msgChunk===this.msgs&&i>t||r&&e.star||e.isInitialE2ENotification&&r}),!0)}deleteMsgsPartial(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.unreadCount;if(this.getAllCMCs().forEach((r=>{const n=r.filter(((t,r,n)=>!e.apply(this,[t,r,n])));r.remove(n,void 0,t),n.forEach((e=>{e.delete()}))})),(0,u.default)(this.msgChunks).forEach((e=>{0===e.length&&this.removeMsgsCollection(e)})),this.msgs.length>0){const e=r>this.msgs.length?this.msgs.length:r;(0,Ue.updateLocal)(this.id,{unreadCount:e}).then((()=>{this.unreadCount=e,this.msgs.msgLoadState.noEarlierMsgs=!ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==$e.INCOMPLETE}))}}deleteMessages(e){this.msgs.remove(e)}getFirstMsgWithStatus(){return this.msgs.getModelsArray().find((function(e){return!e.isNotification&&(e.isSentByMe||e.type===C.MSG_TYPE.PTT||e.isViewOnce||e.isEphemeral)}))}getLastReceivedMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&(!t.local||t.ack>E.ACK.CLOCK))return t}}getLastReceivedNonExpiredMsg(e){for(let t=this.msgs.length-1;t>=0;t--){const r=this.msgs.at(t);if(r&&(!r.local||r.ack>E.ACK.CLOCK)&&(!r.isEphemeral||null!=r.ephemeralExpirationTimestamp&&r.ephemeralExpirationTimestamp>e))return r}}getLastMsgKeyForAction(){const e=this.msgs.last();let t;return e&&(t=!this.lastReceivedKey||e.id.fromMe&&e.local&&e.ack===E.ACK.CLOCK?e.id:this.lastReceivedKey),t||void 0}getLastTimestampMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&"i"!==(0,fe.eventTypeFromMsgType)(t))return t}}getWebcChatType(){switch(this.kind){case ze.CHAT:return ce.default.WEBC_CHAT_TYPE.INDIVIDUAL;case ze.GROUP:return ce.default.WEBC_CHAT_TYPE.GROUP;case ze.BROADCAST:return ce.default.WEBC_CHAT_TYPE.BROADCAST_LIST;default:throw new TypeError(`Invalid Chat.kind ${String(this.kind)}`)}}deregisterExpiredViewOnceBulkMessages(e){e.forEach(this._deregisterExpiredViewOnceMessage)}_deregisterExpiredViewOnceMessage(e){(0,xe.isExpired)(e.safe())&&(0,le.deregisterMsg)(e)}_resetEphemeralMessageExpirationTimer(e){var t=this;w.default.clearTimeout(this._ephemeralMessageTimerIds.get(e)),this._ephemeralMessageTimerIds.delete(e),this._ephemeralMessagesToDelete.delete(e);const{ephemeralExpirationTimestamp:n}=e;if(null==n||!this.msgs.includes(e))return;const i=function(){var n=(0,a.default)((function*(){if(t._ephemeralMessageTimerIds.delete(e),t.active)t._ephemeralMessagesToDelete.add(e);else{if(ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&(yield(0,q.removeExpiredMessagesFromHistory)([e]),(0,te.receiveReactionsEnabled)())){const n=r(68819).getJobManager;yield n().waitUntilPersisted(ge.jobSerializers.deleteReactions(t.id.toString(),[e.id.toString()]))}e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})}}));return function(){return n.apply(this,arguments)}}();if(e.isExpired())i();else{const t=w.default.setGlobalTimeout(i,1e3*n);this._ephemeralMessageTimerIds.set(e,t)}}sendProductMessage(e,t){var r=this;return(0,a.default)((function*(){yield(0,Ee.sendProductMessage)(r,e,t)}))()}sendGroupInviteMessage(e,t,r,n,i,a){const o=(0,X.getMaybeMeUser)(),s={ack:E.ACK.CLOCK,from:o,id:new T.default({from:o,to:this.id,id:T.default.newId(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:K.Clock.globalUnixTime(),to:this.id,type:"groups_v4_invite",isNewMsg:!0,inviteGrpJpegThum:a,inviteCode:r,inviteCodeExp:n,inviteGrp:e,inviteGrpName:t,comment:i};return(0,Ae.addAndSendMsgToChat)(this,s)[1]}_isMediaMsg(e){return Boolean(e.asMms&&!e.ctwaContext)}isUnreadMsg(e){const t=this.msgs.filter((e=>e.isUnreadType));return t.includes(e,t.length-this.unreadCount)}_forwardMessageAndSendToChat(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isMediaMsg(e))return(0,le.forwardMediaMsg)(e,this,r).then(void 0);const n=Je(e),i=(0,X.getMaybeMeUser)();let a;ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)?t.isGroup()&&(a=(0,P.toUserWid)(i)):a=void 0;const o=new T.default({from:i,to:t,id:T.default.newId(),participant:a,selfDir:"out"});e.ctwaContext&&(n.body=e.ctwaContext.sourceUrl,n.type=C.MSG_TYPE.CHAT,n.mediaObject=void 0),this.isEphemeralSettingOn()&&(n.ephemeralDuration=this.getEphemeralSetting());const s=this.getEphemeralSettingTimestamp();null!=s&&(n.ephemeralSettingTimestamp=s);const l=this.getDisappearingModeInitiator();return null!=l&&(n.disappearingModeInitiator=l),Object.assign(n,{id:o,from:i,t:K.Clock.globalUnixTime(),to:t,ack:E.ACK.CLOCK,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardedFromWeb:!0,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:r}),(0,Ae.addAndSendMsgToChat)(this,n),Promise.resolve()}forwardMessages(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){const n=t.id,i=t.contact;if(i.isUser&&i.isBlocked())throw new W.default("Forwarded to contact is blocked",i);const a=[];for(const i of e)try{yield t._forwardMessageAndSendToChat(i,n,r)}catch(e){t._isMediaMsg(i)&&a.push(i)}return a}))()}updateReadOnly(){var e;if(this.isSupportGroup()&&this.isReadOnly)return;let t=Promise.resolve();if(this.isGroup&&!(null===(e=this.groupMetadata)||void 0===e?void 0:e.stale)){let e=!1;var r,n;if(ee.GK.supportsFeature(ee.GK.F.MD_BACKEND))e=!(null===(r=this.groupMetadata)||void 0===r?void 0:r.participants.get((0,X.getMeUser)()));else e=!(null===(n=this.groupMetadata)||void 0===n?void 0:n.participants.get((0,X.getMaybeMeUser)()));t=(0,Ue.updateLocal)(this.id,{isReadOnly:e}).then((()=>this.isReadOnly=e))}t.then((()=>{this.isBroadcast&&this.updateTitle()}))}updateIsAnnounceGrpRestrict(){const e=this.groupMetadata;if(this.isGroup&&null!=e&&!e.stale){const t=e.participants.get((0,X.getMaybeMeUser)()),r=t&&!t.isAdmin&&e.announce;(0,Ue.updateLocal)(this.id,{isAnnounceGrpRestrict:r}).then((()=>this.isAnnounceGrpRestrict=r))}}sortMsgs(e){const t=e.map((e=>{const t=(0,g.default)(e.msgChunk,"msg.msgChunk");return{msg:e,chunkT:(0,g.default)(t.at(0),"chunk.at(0)").t,index:t.indexOf(e)}}));return(0,d.default)(t,["chunkT","index"]).map((e=>e.msg))}waitForChatLoading(){let e=Promise.resolve();return ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)&&this.pendingInitialLoading&&(e=(0,Be.default)(this,"change:pendingInitialLoading",(()=>!this.pendingInitialLoading))),e}_updateAssignedColor(){var e,t;if(!this.colors)return;const r=null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[],n=this.colors,i=(0,c.default)(Object.keys(n),r.map((e=>e.id.toString())).map(se.default));i.forEach((function(e){delete n[e]})),i.length&&this._saveAssignedColors()}loadAssignedColors(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),(0,X.getGroupParticipantAssignedColor)(this.id)||{}}saveAssignedColors(){const e=this.colors;e&&(0,X.setGroupParticipantAssignedColor)(this.id,e)}assignedColor(e){const t=this.colors||(this.colors=this.loadAssignedColors());let r;const n=(0,se.default)(e.toString());if(r=t[n])return r;const i={};(0,l.default)(t,((e,t)=>{i[e]?i[e].push(t):i[e]=[t]}));let a=Number.POSITIVE_INFINITY;for(let e=1;e<=17;e++){if(!i[e]){r=e;break}i[e].length<a&&(a=i[e].length,r=e)}return t[n]=r,this._saveAssignedColors(),r}unstarAll(){const e=this.getAllMsgs();e.forEach((e=>{e&&(e.star=!1)})),(0,Ie.removeStarredMsgs)(e)}constructMediaMsgs(e){if(!e)return this.getMediaMsgs();if(e.isViewOnce)return new U.default;let t;return this.getMediaMsgs().includes(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new U.default,t.includes(e)||(e.msgChunk?t.add(e.msgChunk.filter(this.isMsgForMediaCollection)):t.add(e)),t}fts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0;if(1===t){const n=this.ftsCache[e];if(n)return n;const i=ue.MsgCollection.search(e,t,r,this.id);this.ftsCache[e]=i;const a=()=>{this.ftsCache[e]=null};return setTimeout(a,3e5),i.catch(a),i}return ue.MsgCollection.search(e,t,r,this.id)}_clearFtsCache(){this.ftsCache={}}updateSortTime(){if(this.promises.updateSortTime)return;const e=new n,t=e.signal,r=(0,ve.default)([t,this._abortController.signal],(e=>(0,m.delayMs)(0).then((()=>{const e=this.getLastTimestampMsg();if(e)this.t=e.t;else if(!this.msgs.msgLoadState.noEarlierMsgs&&!this.pendingMsgs)return this.loadEarlierMsgs()})).then((t=>{if(e.aborted)throw new _.AbortError;if(t){const e=this.getLastTimestampMsg();this.t=e?e.t:void 0}})).catch((()=>{})).finally((()=>{this.promises.updateSortTime=void 0}))));this.promises.updateSortTime={promise:r,abortController:e}}removeFromCollection(e){var t;(e.star&&(0,Ie.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length>0&&this.linkMsgs?this.linkMsgs.remove(e):e.asDoc&&this.docMsgs?this.docMsgs.remove(e):null!=e.asProduct&&this.productMsgs&&this.productMsgs.remove(e),this.updateMediasCountOnMsg(e,!0),(0,oe.isGroupCatchUpEnabled)()&&e.chat.isGroup)&&(null===(t=e.chat.groupMetadata)||void 0===t||t.unreadMentionMetadata.removeUnreadMentions(e.id.toString()))}countAllMedia(){return ee.GK.supportsFeature(ee.GK.F.MD_BACKEND)?null!=this.promises.sendDelete?Promise.resolve(0):Promise.all([this.getMediaMsgs(),this.getLinkMsgs(),this.getDocMsgs()].map((e=>e.count(this)))).then((e=>e.reduce(((e,t)=>e+(null!=t?t:0)),0))):(__LOG__(4,void 0,new Error,!0)`countAllMedia can be called only from MD code`,SEND_LOGS("countAllMedia-not-from-MD"),Promise.resolve(0))}getMediaMsgs(){return this.mediaMsgs||(this.mediaMsgs=new U.default),this.mediaMsgs}getLinkMsgs(){return this.linkMsgs||(this.linkMsgs=new G.default),this.linkMsgs}getDocMsgs(){return this.docMsgs||(this.docMsgs=new k.default),this.docMsgs}getParticipantCount(){var e;return(null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.length)||1}getProductMsgs(){return this.productMsgs||(this.productMsgs=new x.default),this.productMsgs}getReceivedVcardMsgs(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVcardMsgs||(this.receivedVcardMsgs=new B.default,this.receivedVcardMsgs.parent=this),this.receivedVcardMsgs)}dismissVcard(){this.vcardDismissed=!0}updateMediasCountOnMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!ee.GK.supportsFeature(ee.GK.F.MEDIAS_COUNT))return;const r=t?-1:1;e.isMedia&&(this.mediaCount+=r);const n=e.getLinks().length;n&&(this.linkCount+=r*n),e.asDoc&&(this.docCount+=r)}resetMediasCount(e){ee.GK.supportsFeature(ee.GK.F.MEDIAS_COUNT)&&(null!=e.mediaCount&&(this.mediaCount=e.mediaCount),null!=e.linkCount&&(this.linkCount=e.linkCount),null!=e.docCount&&(this.docCount=e.docCount))}getStarredMsgs(){let e=this.starredMsgs;return e||(this.starredMsgs=e=new Ie.StarredMsgCollection,this.starredMsgs.add(Ie.AllStarredMsgsCollection.filter((e=>e.chat===this)))),e}setAndKeepPrevious(e,t){const r=Object.keys(e);r.forEach((e=>{e in this.ackedProps||(this.ackedProps[e]=this[e])})),t.finally((()=>{r.forEach((e=>{delete this.ackedProps[e]}))})),this.set(e)}getAckedPhoneProps(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,ephemeralDuration:this.ephemeralDuration,ephemeralSettingTimestamp:this.ephemeralSettingTimestamp,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}matchFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(0,p.default)(e)||(e.label?this.labels&&this.labels.includes(e.label):e.kind===Oe.SMB_SEARCH_FILTERS.UNREAD?!!this.hasUnread&&!this.isBroadcast:e.kind===Oe.SMB_SEARCH_FILTERS.CONTACT?this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===Oe.SMB_SEARCH_FILTERS.NON_CONTACT?!this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===this.kind)}getEphemeralSetting(){var e;const t=this.isGroup?null===(e=this.groupMetadata)||void 0===e?void 0:e.ephemeralDuration:this.ephemeralDuration;return null==t||0===t?null:t<0?(__LOG__(3)`[ephemeral] invalid duration of ${t} for chat ${this.id.toString()}`,null):t}getEphemeralSettingTimestamp(){return this.isGroup||0===this.ephemeralSettingTimestamp?null:this.ephemeralSettingTimestamp}isEphemeralSettingOn(){const e=this.getEphemeralSetting();return null!=e&&0!==e}shouldShowEphemeralSetting(){if(!ee.GK.supportsAnyFeature(ee.GK.F.EPHEMERAL_MESSAGES,ee.GK.F.MD_BACKEND))return!1;if(this.isGroup){var e,t;const r=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getSuperAdmin();if(null==r?void 0:r.contact.isEnterprise)return!1;if(!(null===(t=this.groupMetadata)||void 0===t?void 0:t.canSetEphemeralSetting())&&!this.isEphemeralSettingOn())return!1}return!this.isBroadcast&&!this.contact.isEnterprise}getDisappearingModeInitiator(){return this.isGroup?null:(0,oe.isDisappearingModeEnabled)()?null!=this.disappearingModeInitiator?this.disappearingModeInitiator:this.isEphemeralSettingOn()?z.DisappearingModeInitiator.ChangedInChat:null:null}getCollection(){return r(69951).ChatCollection}getGroupMetadataCollection(){return r(63928).default}}function Je(e){var t;let r=["buttons","caption","broadcast","ephemeralDuration","ephemeralSettingTimestamp","ephemeralStartTimestamp","ephemeralOutOfSync","dynamicReplyButtons","replyButtons","isMdHistoryMsg","bizPrivacyStatus"];!0===e.isDynamicReplyButtonsMsg&&e.type===C.MSG_TYPE.CHAT||(r=["footer",...r]),(null===(t=e.quotedMsg)||void 0===t?void 0:t.type)!==C.MSG_TYPE.PRODUCT&&(r=["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID",...r]);const n=e.asUrl;return null==n||null==n.mediaKeyTimestamp||(0,Fe.default)(n.mediaKeyTimestamp)||(r=["mediaKey","mediaKeyTimestamp","thumbnailHQ","thumbnailDirectPath","thumbnailSha256","thumbnailEncSha256","thumbnailHeight","thumbnailWidth",...r]),(0,s.default)(e.toJSON(),r)}qe.Proxy="chat",qe.idClass=b.default;const Qe=(0,D.defineModel)(qe);t.Chat=Qe},42265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(e,t)=>{const r=e.pin||0,n=t.pin||0;if(r||n)return r!==n?r>n?-1:1:e.id.toString()<t.id.toString()?-1:1;const i=e.t||0,a=t.t||0;return i!==a?i>a?-1:1:e.id.toString()<t.id.toString()?-1:1};t.default=r},69951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCollectionImpl=t.ChatCollection=void 0;var i=n(r(48926)),a=n(r(35937)),o=n(r(39693)),s=n(r(63105)),l=n(r(35161)),c=n(r(41609)),d=n(r(23279)),u=r(50796),p=r(13959),f=r(67602),_=r(13042),h=n(r(65212)),g=n(r(89867)),m=r(1255),y=r(80140),E=r(63183),S=n(r(42265)),v=r(17239),T=r(19380),C=r(11082),A=n(r(74036)),b=n(r(45126)),P=r(99234),M=r(7293),O=r(50338),I=r(16770),w=n(r(51783)),R=r(99662),D=r(91692),N=r(3060),L=r(32613),k=r(3553),G=n(r(68132)),U=r(62583),F=r(16774),x=r(66299),B=r(27211),K=n(r(17072)),j=r(77591),Y=r(65044);class W extends m.BaseCollection{constructor(){super(),this.notSpam={},this.promises={sendUnstarAll:null},this._sortEnabled=!1,this._viewOnceCleanupTaskQueue=new Set,this.enableSortListener(),this.listenTo(Y.Socket,"change:stream",(()=>{Y.Socket.stream===U.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.pendingMsgs=!1}))})),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100)),this._scheduleViewOnceMediaCleanup()}_scheduleViewOnceMediaCleanup(){clearTimeout(this._viewOnceCleanupTimeout),this._viewOnceCleanupTimeout=setTimeout((()=>{O.IdleCallbackTasks.enqueue((()=>{this._runViewOnceMediaCleanup(),this._scheduleViewOnceMediaCleanup()}))}),18e5)}_runViewOnceMediaCleanup(){this.forEach((e=>{const t=e.id;this._viewOnceCleanupTaskQueue.has(t)||(O.IdleCallbackTasks.enqueue((()=>{this._viewOnceCleanupTaskQueue.delete(t);const e=this.get(t);!1===(null==e?void 0:e.active)&&e.deregisterExpiredViewOnceBulkMessages(e.msgs)})),this._viewOnceCleanupTaskQueue.add(t))}))}enableSortListener(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:shouldAppearInList",this.sort),e&&this.sort(),this._sortEnabled=!0)}disableSortListener(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}setIndexes(){this.forEach(((e,t)=>{e.initialIndex=t}))}getActive(){return this.filter((e=>e.active))[0]}_findQuery(e){var t=this;return(0,i.default)((function*(){const n={},i=yield(0,C.find)(!!e.retry,n);if("preempted"===i)return Promise.reject(new m.CollectionSilentQueryError("chats preempted"));if(v.Conn.platform===v.PLATFORMS.IPHONE||v.Conn.platform===v.PLATFORMS.SMBI){const e=r(59871).MsgCollection;(0,c.default)(i)?e.trigger(_.COLLECTION_HAS_SYNCED):setTimeout((()=>{e.trigger(_.COLLECTION_HAS_SYNCED)}),2500)}return t.trigger(_.COLLECTION_HAS_SYNCED,n),Promise.resolve(i)}))()}sync(){this.findQuery({}).catch((0,u.filteredCatch)(j.WebdDrop,(()=>{})));const e=r(59871).MsgCollection;return Promise.all([(0,K.default)(this,_.COLLECTION_HAS_SYNCED),e.hasSynced()])}getKeysForResyncMsgs(){return this.filter((function(e){return e.shouldAppearInList})).map((function(e){const t=e.getAckedPhoneProps(),r=e.lastReceivedKey;return r&&(t.id=r.id,t.fromMe=r.fromMe.toString(),t.participant=r.participant),t}))}resyncMessages(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ChatStore:resyncMessages`;const t=e.getKeysForResyncMsgs();try{const n=yield(0,N.resyncMessages)(t);if(n.status>=400)return __LOG__(3)`ChatStore:resyncMessages resume error ${n.status}`,Promise.reject(new Error("ChatStore:resyncMessages resume error "+n.status));__LOG__(2)`ChatStore:resyncMessages resume success`;try{e.disableSortListener(),n.data.forEach((t=>{if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){const e=t.keys[0];t.firstUnreadKey=new h.default({id:e[0],fromMe:e[1],participant:e[2],remote:t.id})}if("delete"!==t.type&&!g.default.isPSA(t.id)){const e=T.ContactCollection.get(t.id);if(e){if(t.name){const r={name:t.name};(0,B.updateLocal)(e.id,r).then((()=>{e.set(r)}))}}else T.ContactCollection.add({id:t.id,name:t.name})}const r=e.get(t.id);if(r)if("clear"===t.type){r.resetMediaMsgs();const e=[];r.msgs.forEach((t=>e.push(t))),r.msgChunks.length&&r.msgChunks.forEach((t=>{t.forEach((t=>e.push(t)))})),r.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration,ephemeralDuration:t.ephemeralDuration,ephemeralSettingTimestamp:t.ephemeralSettingTimestamp}),e.forEach((e=>{e.delete()})),__LOG__(2)`model:chat:resume: cleared chat for ${t.id}`}else"delete"===t.type?(r.delete(),__LOG__(2)`model:chat:resume: deleted chat for ${t.id}`):r.set(t,{merge:!0});else e.add(t)})),e.enableSortListener(!0)}catch(e){__LOG__(3)`model:chat:resume error in processing reply:${String(e)}`}(0,p.delayMs)(100).then((()=>{M.GK.supportsFeature(M.GK.F.USER_NOTICE)&&w.default.sync(!0),M.GK.supportsFeature(M.GK.F.SETTINGS_SYNC)&&G.default.sync(!0),n.checksum&&(0,L.resyncContacts)(n.checksum),n.statusChecksum&&r(59387).StatusV3Collection.sync(n.statusChecksum),n.quickRepliesChecksum&&R.QuickReplyCollection.sync(n.quickRepliesChecksum),n.labelsChecksum&&I.LabelCollection.sync(n.labelsChecksum),n.stickerPackChecksum&&x.StickerPackCollection.sync(n.stickerPackChecksum),null!=n.recentStickersChecksum&&D.RecentStickerCollection.sync(n.recentStickersChecksum),null!=n.starredStickersChecksum&&F.StarredStickerCollection.sync(n.starredStickersChecksum)})).catch((e=>{__LOG__(3)`model:chat:resume error in processing checksum:${String(e)}`}))}catch(e){return(0,u.filteredCatch)(j.WebdDrop,(function(e){return __LOG__(3)`ChatStore:resyncMessages resume dropped`,Promise.reject(e)}))(e)}}))()}unstarAllMessages(e,t){return(0,k.unstarAllMessages)(e,t)}forwardMessagesToChats(e,t){return(0,i.default)((function*(){const n=Promise.all(e.map((e=>(0,f.promiseProps)({message:e,canForward:e.canForward()&&(null!=r(59871).MsgCollection.get(e.id)||e.isEphemeral)})))),a=yield Promise.all(t.filter((e=>e.canSend)).map(function(){var e=(0,i.default)((function*(e){let t;t=e.isUser&&e.contact.isBlocked()?(0,y.unblockContact)(e.contact):Promise.resolve(!0);const[r]=yield Promise.all([n,t]),i=(0,l.default)((0,s.default)(r,{canForward:!0}),"message"),a=(0,l.default)((0,s.default)(r,{canForward:!1}),"message");return(0,f.promiseProps)({chat:e,undelivered:e.forwardMessages(i,!0),canForward:i,cannotForward:a})}));return function(){return e.apply(this,arguments)}}())),c=(0,o.default)(a.map((e=>{let{chat:t,undelivered:r,canForward:n,cannotForward:i}=e,a=null;return(r.length||i.length)&&(a=(0,A.default)({chat:t,undelivered:r,canForward:n,cannotForward:i})),a?{chat:t,reason:a}:null})));if(c.length)throw new b.default(c);return!0}))()}saveToCache(){if(!v.Conn.shouldSaveToCache())return;const{id:e}=W.cachePolicy;__LOG__(2)`ChatCollection:saveToCache save: ${String(e)}`;const t=this.map(((e,t)=>{const r=e.toJSON(),n=t<20?Math.min(e.unreadCount+20,50):Math.min(Math.max(3,e.unreadCount),20);return r.msgs=e.msgs?e.msgs.slice(-n).map((e=>(0,a.default)(e.toJSON(),(e=>void 0!==e)))):[],r}));(0,P.setCollection)(e,t,!0)}onResume(){const e=this.getActive();e&&e.presence.subscribe()}delete(){super.delete(),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100))}}t.ChatCollectionImpl=W,W.model=E.Chat,W.comparator=S.default;const H=new W;t.ChatCollection=H},6977:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50796),o=r(1255),s=r(7293),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=r(17304),d=r(59871),u=r(77591);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}class f extends o.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasDocBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var r;if(!s.GK.supportsFeature(s.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-docs-not-from-MD"),null;if(null!=e._count)return e._count;const n=t.msgs.filter(_),i=null!==(r=n[0])&&void 0!==r?r:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield d.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"document")).length)&&void 0!==a?a:0,r=t>0&&n.length>0?1:0;return e._count=t+n.length-r,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count docs for chat ${t.id}`,SEND_LOGS(`md-failed-docs-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryDocs(e,t){if(t)return this.queryDocBefore||(this.queryDocBefore=d.MsgCollection.queryMedia(t.id.remote,d.MEDIA_QUERY_LIMIT,"before",t.id,"document").then((e=>((!e||e.length<d.MEDIA_QUERY_LIMIT)&&(this.hasDocBefore=!1),this.add(e.filter(_),{at:0}),{length:e.length}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryDocBefore=null,this.trigger("query_doc_before")})),this.trigger("query_doc_before")),this.queryDocBefore;const r=e.msgs;if(0===this.length){if(!r||0===r.length)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(r.filter(_),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*d.MEDIA_QUERY_LIMIT){const t=0===this.length?r.head():this.head();return this.queryDocs(e,t)}return new Promise((e=>{e({eof:!1})}))}}function _(e){return null!=e.asDoc&&!e.isVcardOverMmsDocument}t.default=f,f.model=c.Msg},77653:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50796),o=r(4352),s=r(1255),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=r(7293),d=r(17304),u=r(59871),p=r(77591);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}class _ extends s.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasLinkBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var r;if(!c.GK.supportsFeature(c.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-links-not-from-MD"),null;if(null!=e._count)return e._count;const n=t.msgs.filter((e=>e.getLinks().length>0)),i=null!==(r=n[0])&&void 0!==r?r:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield u.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"url")).length)&&void 0!==a?a:0,r=t>0&&n.length>0?1:0;return e._count=t+n.length-r,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryLinks(e,t){if(t)return this.queryLinkBefore||(this.queryLinkBefore=u.MsgCollection.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,"before",t.id,"url").then((e=>((!e||e.length<u.MEDIA_QUERY_LIMIT)&&(this.hasLinkBefore=!1),this.add(e,{at:0}),this.createLinksAndAddMsgs(e),{length:e.length}))).catch((0,a.filteredCatch)([p.WebdDrop,l.ProtoVersionUndefined,p.E404],(()=>{}))).finally((()=>{this.queryLinkBefore=null,this.trigger("query_link_before")})),this.trigger("query_link_before")),this.queryLinkBefore;const r=e.msgs.getModelsArray();if(0===this.length){if(!r||0===r.length)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(r.filter((e=>e.getLinks().length>0)),{at:0}),this.createLinksAndAddMsgs(r)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*u.MEDIA_QUERY_LIMIT){const t=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,t)}return new Promise((e=>{e({eof:!1})}))}createLinksAndAddMsgs(e){const t=[];(0,o.promiseLoop)(((r,n,i)=>{if(e.length===i)return void r();const a=e[i];if(null!=a){a.getLinks().length&&t.push(a)}})).then((()=>{this.add(t),this.trigger("query_link_before")}))}}t.default=_,_.model=d.Msg,_.comparator=(e,t)=>e.t-t.t},65568:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50796),o=r(1255),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(7293),c=r(17304),d=r(59871),u=r(77591);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}const f="before",_="after";function h(e){return e.isMedia&&!e.isViewOnce}class g extends o.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasMediaBefore=!0,this.hasMediaAfter=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var r;if(!l.GK.supportsFeature(l.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-media-not-from-MD"),null;if(null!=e._count)return e._count;const n=t.msgs.filter(h),i=null!==(r=n[0])&&void 0!==r?r:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield d.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id)).mediaCount)&&void 0!==a?a:0,r=t>0&&n.length>0?1:0;return e._count=t+n.length-r,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}getAfter(e){const t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}getBefore(e){const t=this.indexOf(e);return t<=0?null:this.at(t-1)}loadEarlierMedias(){const e=this.head();e&&this.queryMedia({msg:e})}loadRecentMedias(){const e=this.last();e&&this.queryMedia({msg:e,direction:_})}loadMoreAroundIfNeeded(e){if(!e||e.isViewOnce)return;const t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}queryMedia(e){var t;const{chat:r,msg:n}=e,i=null!==(t=e.direction)&&void 0!==t?t:f;if(!n&&r){const e=r.msgs;if(!e||0===e.length)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(e.filter(h),{at:0});const t=this.toArray();if(r.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));if(t.length<=2*d.MEDIA_QUERY_LIMIT){const n=0===t.length?e.head():t[0];return this.queryMedia({chat:r,msg:n})}return new Promise((e=>{e({eof:!1})}))}if(n&&i===f){if(this.queryMediaBefore)return this.queryMediaBefore;let e=0;return this.queryMediaBefore=d.MsgCollection.queryMedia(n.id.remote,d.MEDIA_QUERY_LIMIT,i,n.isMedia?n.id:void 0).then((t=>{const n=t.messages;(!n||n.length<d.MEDIA_QUERY_LIMIT)&&(this.hasMediaBefore=!1);let i=[];n&&n.length>0&&(i=n.filter(h)),this.add(i,{at:0});const a={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return r&&r.resetMediasCount(a),e=i.length,{length:e}})).catch((0,a.filteredCatch)([u.WebdDrop,s.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryMediaBefore=null,this.trigger("query_media_before",e)})),this.trigger("query_media_before",0),this.queryMediaBefore}if(n&&i===_)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=d.MsgCollection.queryMedia(n.id.remote,d.MEDIA_QUERY_LIMIT,i,n.id).then((e=>{const t=e.messages;(!t||t.length<d.MEDIA_QUERY_LIMIT)&&(this.hasMediaAfter=!1);let n=[];t&&t.length>0&&(n=t.filter(h)),this.add(n);const i={mediaCount:e.mediaCount,linkCount:e.linkCount,docCount:e.docCount};return r&&r.resetMediasCount(i),{length:n.length}})).catch((0,a.filteredCatch)([u.WebdDrop,s.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryMediaAfter=null,this.trigger("query_media_after")}))}}t.default=g,g.model=c.Msg,g.comparator=(e,t)=>e.t-t.t},51612:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=t.ChatMsgsCollection=void 0;var i=n(r(81109)),a=n(r(41143)),o=r(1255),s=r(11290),l=r(17304);class c extends s.BaseModel{constructor(){super(...arguments),this.noEarlierMsgs=(0,s.prop)(),this.isLoadingEarlierMsgs=(0,s.prop)(),this.isLoadingRecentMsgs=(0,s.prop)(),this.isLoadingAroundMsgs=(0,s.prop)(),this.contextLoaded=(0,s.prop)()}}c.Proxy="msgLoad";const d=(0,s.defineModel)(c);t.MsgLoadState=d;class u extends o.BaseCollection{constructor(){super(),this.msgLoadState=new d({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)}delete(){this.stopListening(),super.delete(),this.msgLoadState.delete()}triggerChangeLast(e,t,r){const n=this.last();if(this._last!==n){this._last=n;let i=!1;const a=!!r.add,o=!!r.remove;t.includes(e)&&a&&!o&&(i=!0),this.trigger("change:last",n,i)}}add(e,t){let n;Array.isArray(e)?1===e.length&&(n=e[0]):n=e;let a=[];if(null!=n&&(n.isInitialE2ENotification||n.isDisappearingModeSystemMessage)){const r=this.some((e=>e.isInitialE2ENotification));if(n.isInitialE2ENotification&&(r||(a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:0})))),n.isDisappearingModeSystemMessage){if(!this.some((e=>e.isDisappearingModeSystemMessage))){const n=r?1:0;a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:n}))}}a&&this.trigger("insert_msgs",a,t)}else a=super.add(e,t);if(a.length>0){r(59871).MsgCollection.add(a,t).forEach((e=>{e&&this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",a,t)}return a}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=super.remove(e,t),i=!!t&&t.silent,a=n.filter((e=>!!e));return a.length&&!i&&(this.trigger("remove_msgs",a,t),r||this.trigger("update_sort_time")),n}replace(e){this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;const t=e.getModelsArray();this.set(t,{silent:!0,merge:!1}),t.forEach((e=>{this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",t)}onMsgLoadStateChange(e){let t;const r=()=>{e()},n=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null after bulk_add"),t.off("change",r);const n=this.msgLoadState;n.on("change",r),t=n,e()};t=this.msgLoadState,t.on("change",r),this.on("bulk_add",n);let i=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null when unsubscribing"),this.off("bulk_add",n),t.off("change",r)};return()=>{const e=i;e&&(i=null,e())}}}t.ChatMsgsCollection=u,u.model=l.Msg},33929:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=t.ChatPreference=void 0;var i=n(r(89867)),a=r(11290);const o="defaultPreference";t.DEFAULT_PREFERENCE=o;class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.wallpaperColor=(0,a.prop)(),this.saveToCameraRoll=(0,a.prop)(),this.showDoodle=(0,a.prop)()}getCollection(){return r(66034).default}}s.Proxy="chatPreference",s.idClass=i.default,s.allowedIds=[o];const l=(0,a.defineModel)(s);t.ChatPreference=l},66034:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(33929),a=r(72407),o=r(78123);class s extends n.BaseCollection{initializeFromCache(e){this.add([{id:i.DEFAULT_PREFERENCE,wallpaperColor:o.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0},...e||[]],{merge:!0})}get(e){return super.get(e)||super.get(i.DEFAULT_PREFERENCE)}delete(){super.delete(),this.add({id:i.DEFAULT_PREFERENCE,wallpaperColor:o.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0})}}s.model=i.ChatPreference,s.cachePolicy={id:a.KEYS.CHAT_PREFERENCE_COLLECTION,policy:n.CACHE_POLICY.LOAD,delay:1e3};var l=new s;t.default=l},16173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50796),i=r(1255),a=r(7293),o=r(17304),s=r(59871),l=r(77591);class c extends i.BaseCollection{constructor(){super(...arguments),this.syncPromise=null,this.isSynced=!1}onResume(){this.isSynced=!1,this.sync(this.parent)}sync(e){return a.GK.supportsFeature(a.GK.F.INDEX_RECEIVED_VCARD)?this.isSynced?Promise.resolve():(this.syncPromise||(this.syncPromise=s.MsgCollection.queryVcard(e.id).then((e=>this.add(e))).catch((0,n.filteredCatch)(l.E499,(()=>{}))).catch((()=>{})).finally((()=>{this.isSynced=!0,this.syncPromise=null}))),this.syncPromise):(this.isSynced=!0,Promise.resolve())}}t.default=c,c.model=o.Msg,c.resumeOnAvailable=!0},11006:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(31727)),a=n(r(41809));class o extends i.default{oldestUnreadMention(){var e;const t=null!==(e=this.last())&&void 0!==e?e:null;return t&&this.remove(t),t}}t.default=o,o.model=a.default,o.comparator=(e,t)=>t.timestamp-e.timestamp},4550:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=n(r(44558)),o=r(55975);function s(){return(s=(0,i.default)((function*(){(yield Promise.allSettled([(0,a.default)(),o.LruMediaStore.clear()])).forEach((e=>{if("rejected"===e.status)throw e.reason}))}))).apply(this,arguments)}},98423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handle=function(e){let[t]=e;switch(t.type){case"read":if(t.isStatus){u.StatusV3Collection.handle([t]);break}case"unread":const e=i.ChatCollection.get(t.jid);e&&("read"===t.type?(0,p.markSeen)(e):"unread"===t.type&&(0,p.markUnseen)(e));break;case"log":a.upload({reason:a.SERVER_REQUESTED,immediate:!0,force:!0,isHighPri:!0});break;case"privacy":if(t.jid){const e=l.PresenceCollection.get(t.jid);e&&e.reset(),c.ProfilePicThumbCollection.update(t.jid).catch((0,n.filteredCatch)(f.WebdDrop,(()=>{}))),d.StatusCollection.update(t.jid).catch((0,n.filteredCatch)(f.WebdDrop,(()=>{})))}else __LOG__(3)`Store:Cmd:handle:privacy no jid`;break;case"identity":if(t.jid){const e=o.ContactCollection.get(t.jid);e?(0,s.updateIdentity)(e,t):__LOG__(3)`Store:Cmd:handle:identity no contact`}else __LOG__(3)`Store:Cmd:handle:identity no jid`;break;default:__LOG__(3)`Store:Cmd:handle:unknown ${t.type}`}};var n=r(50796),i=r(69951),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(85965)),o=r(19380),s=r(84765),l=r(68315),c=r(82039),d=r(46133),u=r(59387),p=r(9609),f=r(77591);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}},17239:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=t.ConnImpl=t.Conn=void 0;var i=n(r(23279)),a=n(r(44908)),o=r(11290),s=r(88102),l=r(99234),c=r(7293),d=n(r(83938)),u=n(r(43725)),p=r(53558),f=r(46582),_=n(r(11339)),h=n(r(69594));const g={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"};t.PLATFORMS=g;class m extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.ref=(0,o.prop)(),this.refTTL=(0,o.prop)(),this.refId=(0,o.prop)(),this.wid=(0,o.prop)(),this.connected=(0,o.prop)(),this.protoVersion=(0,o.prop)(),this.clientToken=(0,o.prop)(),this.serverToken=(0,o.prop)(),this.secret=(0,o.prop)(),this.isResponse=(0,o.prop)(),this.battery=(0,o.prop)(),this.plugged=(0,o.prop)(),this.lc=(0,o.prop)(),this.lg=(0,o.prop)(),this.locales=(0,o.prop)(),this.is24h=(0,o.prop)(),this.platform=(0,o.prop)(),this.phone=(0,o.prop)(),this.tos=(0,o.prop)(),this.smbTos=(0,o.prop)(0),this.pushname=(0,o.prop)(),this.blockStoreAdds=(0,o.session)(!1),this.isVoipInitialized=(0,o.session)(!1),this.refExpiry=(0,o.derived)(this._refExpiry,["ref","refTTL"]),this.locale=(0,o.derived)(this._locale,["lg","lc"]),this.localesList=(0,o.derived)(this._localesList,["locales","lg","lc"]),this.allLocales=(0,o.derived)(this._allLocales,["localesList"]),this.allLanguages=(0,o.derived)(this._allLanguages,["localesList"]),this.platformField=(0,o.derived)(this._platformField,["platform"]),this.tosShowCallNotification=(0,o.derived)(this._tosShowCallNotification,["tos"]),this.isSMB=(0,o.derived)(this._isSMB,["platform"])}_refExpiry(){return Date.now()+this.refTTL}_locale(){return this.formatLocale(this.lg,this.lc)}_localesList(){return this.locales&&this.locales.length?this.locales.split(",").map((e=>{const[t,r]=e.split("-");return t?[t,r]:null})).filter(Boolean):this.lg?[[this.lg,this.lc]]:[]}_allLocales(){return(0,a.default)(this.localesList.map((e=>{let[t,r]=e;return this.formatLocale(t,r)}))).filter(Boolean)}_allLanguages(){return(0,a.default)(this.localesList.map((e=>{let[t,r]=e;return t})))}_platformField(){return"wp7"===this.platform?_.default.PLATFORM_TYPE.WP:this.platform&&_.default.PLATFORM_TYPE[this.platform.toUpperCase()]||_.default.PLATFORM_TYPE.UNKNOWN}_tosShowCallNotification(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)||this.tos<2}_isSMB(){return this.platform===g.SMBA||this.platform===g.SMBI}initialize(){o.BaseModel.prototype.initialize.call(this),this.listenTo(this,"change:locale",(function(e,t){u.default.setLocale(t,p.L10N_PRIORITY.PHONE)})),this.listenTo(this,"change:plugged",(0,i.default)((()=>{_.default.Global.webcPhoneCharging=this.plugged}),5e3,{leading:!0})),this.listenTo(this,"change:phone",(()=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{mcc:t,mnc:r}=e;t&&"string"==typeof t&&(t=parseInt(t,10));r&&"string"==typeof r&&(r=parseInt(r,10));_.default.Global.set({mcc:null!=t?t:null,mnc:null!=r?r:null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}(this.phone)})),this.listenTo(this,"change:platform",this.handlePlatformChange),this.listenTo(s.Cmd,"main_stream_mode_ready_legacy",this.updateVoipAvailability)}delete(){(0,l.setPushname)(),(0,l.setVersion)(),this.clear()}canSetMyPushname(){return!this.isSMB}updateVoipAvailability(){__LOG__(2)`Conn: updateVoipAvailability`,(0,f.requireVoip)().then((e=>{if(!h.default.isVoiceCallEnabled()&&!h.default.isVideoCallEnabled())return __LOG__(2)`Conn: updateVoipAvailability, Voip GK false`,e.cleanup(),void(this.isVoipInitialized=!1);this.id&&(0,l.getMaybeMeUser)()?(0,d.default)().then((t=>{t?(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip true`,e.init().then((t=>{__LOG__(2)`Conn: updateVoipAvailability, Voip initialized: ${t}`,this.isVoipInitialized=t,t&&e.updateAudioVideoSwitch()}))):(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip false`,e.cleanup(),this.isVoipInitialized=!1)})):(__LOG__(2)`Conn: updateVoipAvailability, getMaybeMeUser undefined`,e.cleanup(),this.isVoipInitialized=!1)}))}handlePlatformChange(){__LOG__(2)`Conn: platform change: ${this.platform}`,this.platform&&(0,l.setLastMobilePlatform)(this.platform)}formatLocale(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}shouldSaveToCache(){return!!(0,l.getMe)()&&!!this.id}}t.ConnImpl=m,m.Proxy="conn";const y=new((0,o.defineModel)(m))({id:"1"});t.Conn=y},32161:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new RegExp("[A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]");t.default=r},121:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=n(r(32161)),o=r(11290),s=r(32826),l=r(352),c=r(93170),d=r(17239),u=r(47969),p=r(99234),f=r(57701),_=n(r(43725)),h=r(905),g=n(r(64084)),m=r(82039),y=r(959),E=r(46133),S=n(r(39938));const v=/^[^0-9]+$/;class T extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.name=(0,o.prop)(),this.shortName=(0,o.prop)(),this.pushname=(0,o.prop)(),this.type=(0,o.prop)("in"),this.verifiedName=(0,o.prop)(),this.isBusiness=(0,o.prop)(),this.isEnterprise=(0,o.prop)(),this.verifiedLevel=(0,o.prop)(),this.privacyMode=(0,o.prop)(),this.statusMute=(0,o.prop)(),this.sectionHeader=(0,o.prop)(),this.labels=(0,o.prop)(),this.isContactSyncCompleted=(0,o.prop)(),this.forcedBusinessUpdateFromServer=(0,o.prop)(),this.disappearingModeDuration=(0,o.prop)(),this.disappearingModeSettingTimestamp=(0,o.prop)(),this.isContactBlocked=(0,o.session)(!1),this.verificationString=(0,o.session)(),this.verificationBinary=(0,o.session)(),this.pendingAction=(0,o.session)(),this.promises=(0,o.session)((()=>({}))),this.status=(0,o.session)(),this.profilePicThumb=(0,o.session)(),this.businessProfile=(0,o.session)(),this.commonGroups=(0,o.session)(),this.liveLocations=(0,o.session)(),this.businessCatalog=(0,o.session)(),this.locale=(0,o.session)(),this.notifyName=(0,o.derived)(this._notifyNameFunction,["pushname","isBusiness","verifiedLevel","verifiedName"]),this.mentionName=(0,o.derived)(this._mentionName,["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),this.displayName=(0,o.derived)(this._displayName,["id","mentionName","isMe"]),this.userid=(0,o.derived)(this._userid),this.userhash=(0,o.derived)(this._userhash),this.searchName=(0,o.derived)(this._searchName,["name","id","locale"]),this.searchVerifiedName=(0,o.derived)(this._searchVerifiedName,["verifiedLevel","verifiedName"]),this.header=(0,o.derived)(this._header,["name"]),this.isMe=(0,o.derived)(this._isMe),this.isUser=(0,o.derived)(this._isUser),this.isGroup=(0,o.derived)(this._isGroup),this.isBroadcast=(0,o.derived)(this._isBroadcast),this.isPSA=(0,o.derived)(this._isPSA),this.formattedShortNameWithNonBreakingSpaces=(0,o.derived)(this._formattedShortNameWithNonBreakingSpaces,["shortName","formattedName","id","locale"]),this.formattedShortName=(0,o.derived)(this._formattedShortName,["shortName","formattedName","id","locale"]),this.formattedName=(0,o.derived)(this._formattedName,["name","id","locale","verifiedLevel","verifiedName"]),this.formattedUser=(0,o.derived)(this._formattedUser,["name","id","locale","verifiedLevel","verifiedName"]),this.isWAContact=(0,o.derived)(this._isWAContact,["type"]),this.isMyContact=(0,o.derived)(this._isMyContact,["name"]),this.showBusinessCheckmarkAsPrimary=(0,o.derived)(this._showBusinessCheckmarkAsPrimary,["isBusiness","verifiedLevel","name","verifiedName"]),this.showBusinessCheckmarkAsSecondary=(0,o.derived)(this._showBusinessCheckmarkAsSecondary,["isBusiness","verifiedLevel","name","verifiedName"]),this.shouldForceBusinessUpdate=(0,o.derived)(this._shouldForceBusinessUpdate,["forcedBusinessUpdateFromServer","isContactSyncCompleted"])}_notifyNameFunction(){return this.isBusiness&&this.verifiedLevel!==c.VERIFIED_LEVEL.HIGH?this.verifiedName:this.pushname}_mentionName(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==c.VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}_displayName(){return this.isMe&&d.Conn.pushname?d.Conn.pushname:this.mentionName||(0,S.default)(this.id)}_userid(){return this.isUser?i.default.user(this.id):null}_userhash(){return this.isUser?(0,g.default)((this.id.user||"")+"WA_ADD_NOTIF"):null}_searchName(){return i.default.isPSA(this.id)?_.default.accentFold(_.default.t(1029)):this.name?_.default.accentFold(this.name):null}_searchVerifiedName(){return this.verifiedLevel!==c.VERIFIED_LEVEL.HIGH?null:this.verifiedName?_.default.accentFold(this.verifiedName):null}_header(){if(this.name){const e=this.name.toLowerCase(),t=a.default.exec(e);if(t&&0===t.index||t&&v.test(e.slice(t.index))){const e=t[0],r=_.default.removeAccents(e);return(0,u.getCollator)().compare(r,e)?e:r}return"#"}}_isMe(){return this.id.equals((0,p.getMaybeMeUser)())}_isUser(){return i.default.isUser(this.id)}_isGroup(){return i.default.isGroup(this.id)}_isBroadcast(){return i.default.isBroadcast(this.id)}_isPSA(){return i.default.isPSA(this.id)}_formattedShortNameWithNonBreakingSpaces(){return this.id?this.isMe?_.default.t(1020):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g," "):""}_formattedShortName(){return this.id?this.isMe?_.default.t(1020):this.shortName||this.formattedName:""}_formattedName(){return this.id?this.isMe?_.default.t(1020):i.default.isPSA(this.id)?_.default.t(1029):this.name?this.name:this.verifiedLevel===c.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:this.isUser?(0,S.default)(this.id):"":""}_formattedUser(){return this.getFormattedUser()}_isWAContact(){return this.isUser&&"in"===this.type}_isMyContact(){var e;return!(!this.isUser||!(null===(e=this.name)||void 0===e?void 0:e.length))}_showBusinessCheckmarkAsPrimary(){return this.isBusiness&&this.verifiedLevel===c.VERIFIED_LEVEL.HIGH&&(this.name===this.verifiedName||!this.name)}_showBusinessCheckmarkAsSecondary(){return this.isBusiness&&this.verifiedLevel===c.VERIFIED_LEVEL.HIGH&&Boolean(this.name)&&this.name!==this.verifiedName}_shouldForceBusinessUpdate(){return!this.forcedBusinessUpdateFromServer&&!this.isContactSyncCompleted}initialize(){super.initialize(),this.id&&(this.isMe&&this.addChild("status",E.StatusCollection.gadd(this.id)),this.isMe&&this.addChild("profilePicThumb",m.ProfilePicThumbCollection.gadd(this.id)),(this.isBusiness||this.isMe&&d.Conn.isSMB)&&this.addChild("businessProfile",r(93581).BusinessProfileCollection.gadd(this.id)),this.listenTo(this,"change:isBusiness",(()=>(0,l.onIsBusinessChange)(this))),this.isMe&&this.listenTo(d.Conn,"change:pushname",(()=>{this.set({pushname:d.Conn.pushname})})),this.listenTo(_.default,"locale_change",(()=>{this.locale=_.default.getLocale()})),this.listenTo(this,"change:name",this.updateShortName),this.isContactBlocked=!!s.BlocklistCollection.get(this.id),this.pendingAction=0,d.Conn.isSMB&&(0,h.initializeLabels)(this))}updateShortName(){if(this.isUser&&this.name&&!this.shortName){const e=(0,y.getShortName)(this.name);e&&this.set("shortName",e)}}getStatus(){return i.default.user(this.id)||__LOG__(2)`contact:getStatus for non-user ${this.id.toString()}`,this.status=E.StatusCollection.gadd(this.id)}getProfilePicThumb(){return this.profilePicThumb=m.ProfilePicThumbCollection.gadd(this.id)}addPendingAction(e){const t=()=>{this.decPending()};return e.then(t,t),this.pendingAction++,e}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`contact:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}isBlocked(){return!!s.BlocklistCollection.get(this.id)}searchMatch(e,t,r){var n;return(0,f.canDisplayLabel)()&&r?!(e&&this.searchName&&!this.searchName.includes(e))&&Boolean(null===(n=this.labels)||void 0===n?void 0:n.includes(r)):!!e&&(!(!this.searchName||!this.searchName.includes(e))||(!(!this.userid||!this.userid.includes(e))||(!!(t&&this.userid&&this.userid.includes(t))||(!(!this.searchVerifiedName||!this.searchVerifiedName.includes(e))||!(!this.pushname||!_.default.accentFold(this.pushname).includes(e))))))}getFormattedUser(){return this.id?i.default.isPSA(this.id)?_.default.t(1029):this.name?this.name:this.verifiedLevel===c.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:(0,S.default)(this.id):""}set(e,t,r){const n=super.set(e,t,r);if("string"!=typeof e&&(null==t?void 0:t.merge)&&n){if(n.isPSA)return n;!e.name&&n.name&&(n.unset("name"),n.unset("shortName")),!e.verifiedName&&n.verifiedName&&n.unset("verifiedName")}return n}getCollection(){return r(19380).ContactCollection}setNotMyContact(){this.name&&this.set("name",void 0)}}T.Proxy="contact",T.idClass=i.default;var C=(0,o.defineModel)(T);t.default=C},19380:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactCollectionImpl=t.ContactCollection=void 0;var i=n(r(23279)),a=r(50796),o=r(13042),s=r(1255),l=r(45873),c=n(r(121)),d=r(47969),u=r(43024),p=r(8071),f=r(99234),_=n(r(43725)),h=n(r(35029)),g=r(62583),m=n(r(17072)),y=r(77591),E=r(65044);class S extends s.BaseCollection{constructor(){super(),this._contactHashes=new h.default,this.checksum=void 0,this._frequentContacts={},this._sort=(0,i.default)((()=>super.sort()),1e3),this._silentSort=(0,i.default)((()=>super.sort({silent:!0})),1e3),this.listenTo(_.default,"locale_change",(()=>this.sort())),this.listenTo(this,"change:name",this.sort),this.listenTo(E.Socket,"change:stream",(()=>{E.Socket.stream===g.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.unset("verificationString"),e.unset("verificationBinary")}))})),this.listenTo(this,"add",this.contactAdded),this.listenTo(this,"remove",this.contactRemoved)}sort(e){return(null==e?void 0:e.silent)?this._silentSort():this._sort()}ensureSorted(){this._sort.flush()}initializeFromCache(e){e&&(__LOG__(2)`Store:Contact init from cache`,this.add(e,{silent:!0,merge:!0}))}contactAdded(e){this._contactHashes.put(e)}contactRemoved(e){this._contactHashes.remove(e)}contactHashLength(){return this._contactHashes.length}delete(){super.delete(),this.setChecksum(),delete this.checksum,this._frequentContacts={},(0,p.setFrequent)({}).catch((()=>{})),this._contactHashes.clear()}isFilteredContact(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}getFilteredContacts(){return this.filter((function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}))}getGroupContacts(){return this.filter((e=>e.isGroup))}_find(e){const t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}_findQuery(e){return(0,u.contactFindQuery)(e)}sync(){return this.findQuery({}).catch((0,a.filteredCatch)(y.WebdDrop,(()=>{}))),(0,m.default)(this,o.COLLECTION_HAS_SYNCED)}updateFrequentContacts(e){this._frequentContacts=e}frequentContacts(e,t){let r=e&&this._frequentContacts[e];if(r||(r=this._frequentContacts.message),!r)return[];const n=null==t?void 0:t.id;return r.map((e=>this.get(e))).filter((e=>!!e&&!e.id.equals(n)))}getUserCount(){return this.map((e=>e.isUser?1:0)).reduce(((e,t)=>e+t),0)}setChecksum(e){this.checksum=e,(0,f.setContactChecksum)(this.checksum),(0,l.setChecksum)(e).catch((()=>{}))}resolveWidsFromHash(e){return this._contactHashes.get(e)}}t.ContactCollectionImpl=S,S.model=c.default,S.comparator=d.ContactComparator;const v=new S;t.ContactCollection=v},47969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactComparator=void 0,t.getCollator=function(){return o};var n=r(88102),i=r(99234),a=r(53558);let o;s(),n.Cmd.on("set_locale",s);function s(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DEFAULT_LOCALE;if(null===(e=self.Intl)||void 0===e?void 0:e.Collator){const e=self.Intl.Collator([t],{sensitivity:"base"});o={compare(t,r){try{return e.compare(t,r)}catch(e){return 0}}}}else o={compare:(e,t)=>e.localeCompare(t)}}t.ContactComparator=(e,t)=>{const r=e.id.toString(),n=t.id.toString(),a=(0,i.getMaybeMeUser)(),s=a&&a.toString();if(r===s)return 1;if(n===s)return-1;const l=e.name,c=t.name;if(!l&&c)return 1;if(l&&!c)return-1;if(l&&c&&e.header&&t.header){const r=o.compare(e.header,t.header);return 0===r?o.compare(l,c):r}return r&&n?r.localeCompare(n):-1}},959:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getShortName=function(e){if(null==e)return null;const[t]=e.split(/\s/);if(i.default.exec(t))return t;return __LOG__(2)`[short-name] unable to get short name for contact: ${e}`,null};var i=n(r(32161))},35029:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(82729)),a=n(r(45095)),o=n(r(89867));class s{constructor(){this._map={},this.length=0}static getSidelistHash(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(__LOG__(3)`Store:Contact can't call slice on contact.userhash`,null):null}put(e){const t=s.getSidelistHash(e);if(t&&!this._map[t]){if(this._map[t]){const r=this._map[t];r instanceof o.default?this._map[t]=[r,e.id]:r instanceof Array&&r.push(e.id)}else this._map[t]=e.id;this.length++}}remove(e){const t=s.getSidelistHash(e);if(!t||!this._map[t])return;const r=(0,a.default)(this._map[t],"this._map[hash]");r instanceof o.default?delete this._map[t]:r instanceof Array&&(0,i.default)(r,(t=>t.equals(e.id))),this.length++}get(e){const t=this._map[e];return t instanceof o.default?[t]:t}clear(){this._map={},this.length=0}}t.default=s},18787:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=t.ConversionTuple=void 0;var i=r(8584),a=n(r(89867)),o=n(r(15421)),s=r(11290),l=r(22683);const c=604800;t.ConversionTupleExpiry=c;class d extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.conversionData=(0,s.prop)(),this.conversionSource=(0,s.prop)(),this.timestamp=(0,s.prop)((()=>l.Clock.globalUnixTime())),this.alarmId=(0,s.session)()}initialize(){super.initialize(),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}_setExpiryTimer(){const e=this.timestamp+c;if(e<0)return __LOG__(3)`Invalid conversionTuple timer`,void this.delete();this.alarmId=o.default.setLocalTimeout((()=>{this.delete()}),1e3*e,this.alarmId)}_clearAlarm(){this.alarmId&&(o.default.clearTimeout(this.alarmId),this.alarmId=void 0)}elapsedSeconds(){return l.Clock.globalUnixTime()-this.timestamp}formatTuple(){const e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}toJSON(){const e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){const r=new i.Binary(t);e.conversionData=r.readString(t.byteLength)}return e}delete(){super.delete(),this.getCollection().remove(this.id),this._clearAlarm()}getCollection(){return r(35667).default}}d.Proxy="conversionTuple",d.idClass=a.default;const u=(0,s.defineModel)(d);t.ConversionTuple=u},35667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(22683),a=r(18787),o=r(7111);class s extends n.BaseCollection{initializeFromCache(e){if(!e)return;const t=i.Clock.globalUnixTime()-a.ConversionTupleExpiry,r=e.filter((e=>e.timestamp-t>0)).map((e=>{const t=(0,o.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e}));this.add(r),this.saveToCache()}}s.model=a.ConversionTuple,s.cachePolicy={id:"conversion_tuple",policy:n.CACHE_POLICY.LOAD,delay:1e3};var l=new s;t.default=l},21547:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);const i=864e5;class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.startTime=(0,n.prop)(),this.pttCancelBroadcast=(0,n.prop)(0),this.pttCancelGroup=(0,n.prop)(0),this.pttCancelIndividual=(0,n.prop)(0),this.pttDraftReviewBroadcast=(0,n.prop)(0),this.pttDraftReviewGroup=(0,n.prop)(0),this.pttDraftReviewIndividual=(0,n.prop)(0),this.pttFastplaybackBroadcast=(0,n.prop)(0),this.pttFastplaybackGroup=(0,n.prop)(0),this.pttFastplaybackIndividual=(0,n.prop)(0),this.pttLockBroadcast=(0,n.prop)(0),this.pttLockGroup=(0,n.prop)(0),this.pttLockIndividual=(0,n.prop)(0),this.pttPlaybackBroadcast=(0,n.prop)(0),this.pttPlaybackGroup=(0,n.prop)(0),this.pttPlaybackIndividual=(0,n.prop)(0),this.pttRecordBroadcast=(0,n.prop)(0),this.pttRecordGroup=(0,n.prop)(0),this.pttRecordIndividual=(0,n.prop)(0),this.pttSendBroadcast=(0,n.prop)(0),this.pttSendGroup=(0,n.prop)(0),this.pttSendIndividual=(0,n.prop)(0),this.pttPausedRecordBroadcast=(0,n.prop)(0),this.pttPausedRecordGroup=(0,n.prop)(0),this.pttPausedRecordIndividual=(0,n.prop)(0),this.pttStopTapBroadcast=(0,n.prop)(0),this.pttStopTapGroup=(0,n.prop)(0),this.pttStopTapIndividual=(0,n.prop)(0),this.pttOutOfChatBroadcast=(0,n.prop)(0),this.pttOutOfChatGroup=(0,n.prop)(0),this.pttOutOfChatIndividual=(0,n.prop)(0)}getEndTime(){return this.startTime+i}shouldBeSubmitted(){return!this.isExpired()&&this.getEndTime()<Date.now()}isExpired(){const e=Date.now()-18144e5;return this.startTime<e}}a.Proxy="daily-aggregated-stats";var o=(0,n.defineModel)(a);t.default=o},66423:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DailyAggregatedStatsCollectionImpl=t.DailyAggregatedStatsCollection=void 0;var i=n(r(45095)),a=r(1255),o=n(r(21547)),s=r(99234);const l=864e5;class c extends a.BaseCollection{gaddForDate(e){var t;const r=(0,s.getDailyStatsStartTime)(),n=e.getTime()-r,a=Math.floor(n/l),o=r+l*a;return null!==(t=this.get(o))&&void 0!==t?t:(0,i.default)(this.add({id:o.toString(),startTime:o})[0],"this.add({\n  id: startTime.toString(),\n  startTime\n})[0]")}gaddForToday(){return this.gaddForDate(new Date)}initializeFromCache(e){if(null==e)return;const t=e.map((e=>new o.default(e))).filter((e=>u(e)&&!e.isExpired()));this.add(t)}serialize(){return this.toArray().filter((e=>u(e)&&!e.isExpired())).map((e=>e.toJSON()))}}t.DailyAggregatedStatsCollectionImpl=c,c.model=o.default,c.cachePolicy={id:"daily_aggregated_stats",policy:a.CACHE_POLICY.LOAD,delay:1e3};const d=new c;function u(e){return(e.startTime-(0,s.getDailyStatsStartTime)())%l==0}t.DailyAggregatedStatsCollection=d},93894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.weight=(0,n.prop)()}}i.Proxy="recentEmoji";var a=(0,n.defineModel)(i);t.default=a},92671:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiCollectionImpl=t.RecentEmojiCollection=void 0;var i=n(r(23493)),a=n(r(23279)),o=r(50796),s=r(1255),l=r(70449),c=r(7293),d=r(72407),u=n(r(93894)),p=n(r(56891)),f=r(77591);class _ extends s.BaseCollection{constructor(){super(),this.dirty=!1,this._throttledSync=(0,i.default)((function(e){e.sync()}),36,{leading:!1}),this.listenTo(this,"change:weight change:length",(0,a.default)(this._sortTrimScale,100))}_sortTrimScale(){const e=this.length;e&&(this.sort(),e>36&&this.remove(this.models.slice(36)))}delete(){super.delete(),this.dirty=!1,this._throttledSync.cancel()}sync(){return this.findQuery({},{set:!0}).finally((()=>{this.dirty=!1})).catch((0,o.filteredCatch)(f.WebdDrop,(()=>{})))}_findQuery(){return c.GK.supportsFeature(c.GK.F.RECENT_EMOJI_SYNC)&&!c.GK.supportsFeature(c.GK.F.MD_BACKEND)?p.default.recentEmojiQuery(this.dirty?this.toArray():void 0).then((function(e){if(Array.isArray(e))return e.forEach((function(e){e.id=l.EmojiUtil.normalizeAllEmojis(e.id)})),e;throw __LOG__(3)`models:recentEmoji:findQuery error`,new Error("recent emoji fetch error")})):Promise.reject(new s.CollectionSilentQueryError("gk recent emoji sync unsupported"))}throttledSync(){c.GK.supportsFeature(c.GK.F.RECENT_EMOJI_SYNC)&&(__LOG__(2)`models:RecentEmoji:throttledSync dirty: ${String(this.dirty)}`,this._throttledSync(this))}increment(e){const t=l.EmojiUtil.getSkinToneBase(e)||e;this.get(t)||this.add({id:t,weight:0}),this.forEach((e=>{e.id===t?e.weight+=1:e.weight*=.9})),this.dirty=!0,this.throttledSync()}}t.RecentEmojiCollectionImpl=_,_.cachePolicy={id:d.KEYS.RECENT_EMOJI_COLLECTION,policy:s.CACHE_POLICY.LOAD,delay:2e3},_.comparator=(e,t)=>e.weight>t.weight?-1:1,_.model=u.default;const h=new _;t.RecentEmojiCollection=h},14423:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50796),o=r(57319),s=n(r(89867)),l=r(48360),c=r(11290),d=r(19380),u=r(99234),p=r(7293),f=r(57701),_=r(62415),h=r(55981),g=r(10435),m=(n(r(11339)),n(r(96091))),y=n(r(48911)),E=r(48537),S=n(r(73213)),v=n(r(11824)),T=n(r(56891)),C=r(77591);class A extends c.BaseModel{constructor(){super(...arguments),this.participants=(0,c.collection)(m.default),this.pendingParticipants=(0,c.collection)(y.default),this.id=(0,c.prop)(),this.creation=(0,c.prop)(),this.owner=(0,c.prop)(),this.desc=(0,c.prop)(),this.descId=(0,c.prop)(),this.descTime=(0,c.prop)(),this.descOwner=(0,c.prop)(),this.restrict=(0,c.prop)(),this.announce=(0,c.prop)(),this.noFrequentlyForwarded=(0,c.prop)(),this.ephemeralDuration=(0,c.prop)(),this.growthLockExpiration=(0,c.prop)(),this.growthLockType=(0,c.prop)(),this.size=(0,c.prop)(),this.support=(0,c.prop)(),this.suspended=(0,c.prop)(!1),this.uniqueShortNameMap=(0,c.prop)(),this.isParentGroup=(0,c.prop)(),this.parentGroup=(0,c.prop)(),this.defaultSubgroup=(0,c.prop)(),this.unjoinedSubgroups=(0,c.prop)((()=>[])),this.joinedSubgroups=(0,c.session)((()=>[])),this.stale=(0,c.session)(!0),this.trusted=(0,c.session)(!0),this.inviteCode=(0,c.session)(),this.groupInviteCodePromise=(0,c.session)(),this.revokeGroupInvitePromise=(0,c.session)(),this.revokeGroupV4AddInvitePromise=(0,c.session)(),this.groupInviteLink=(0,c.derived)(this._groupInviteLink,["inviteCode"]),this.cachedDeviceCount=(0,c.session)(),this.cachedDeviceSizeBucket=(0,c.session)(),this.notAddedByContact=(0,c.prop)(!1),this.addedBy=(0,c.prop)(),this.groupType=(0,c.derived)(this._groupType,["parentGroup","isParentGroup"]),this.displayedDesc=(0,c.derived)(this._displayedDesc,["desc","groupType"])}_groupInviteLink(){return this.inviteCode?`https://chat.whatsapp.com/${this.inviteCode}`:null}_groupType(){return!0===this.defaultSubgroup?h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:null!=this.parentGroup?h.GroupType.SUBGROUP:!0===this.isParentGroup?h.GroupType.COMMUNITY:h.GroupType.DEFAULT}_displayedDesc(){return(0,f.communitiesEnabled)()&&this.groupType===h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP?l.fbt._("",null,{hk:"4kc4Kr"}).toString():this.desc}hasUniqueShortNameMention(e){var t;if(!this.uniqueShortNameMap||!e.shortName||!e.isMyContact)return!1;const r=this._normalizeShortName(e.shortName);return null!==(t=this.uniqueShortNameMap.get(r))&&void 0!==t&&t}_normalizeShortName(e){return e.toLowerCase().trim()}delete(){super.delete(),this.getCollection().remove(this.id),this.participants.delete()}canSetSubject(){return(!(0,f.communitiesEnabled)()||this.groupType!==h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&(!!this.participants.iAmMember()&&((this.participants.iAmAdmin()||!p.GK.supportsFeature(p.GK.F.GROUPS_V_3)||!0!==this.restrict)&&!this.support))}canSetDescription(){return!!p.GK.supportsFeature(p.GK.F.GROUPS_V_3)&&((!(0,f.communitiesEnabled)()||this.groupType!==h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&(!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&!this.support))}canSetGroupProperty(){return!!p.GK.supportsFeature(p.GK.F.GROUPS_V_3)&&(!!this.participants.iAmAdmin()&&!this.support)}canSetEphemeralSetting(){return!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&!this.support}initialize(){c.BaseModel.prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.listenTo(this,"change:notAddedByContact",this.isTrusted),this.isTrusted(),this._updateUniqueShortNameMapTimer=this._createUniqueNameMapShiftTimer(),this.listenTo(this.participants,"change:contact.shortName",this.onParticipantShortNameUpdated),this.uniqueShortNameMap=new Map,this.unreadMentionMetadata=new v.default}onParticipantShortNameUpdated(){var e;null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(A.UPDATE_NAME_MAP_DEBOUNCE_TIME)}triggerParticipantsChange(){var e;(0,g.isDropLastNameEnabled)()&&(null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(A.UPDATE_NAME_MAP_DEBOUNCE_TIME));this.trigger("change:participants")}_createUniqueNameMapShiftTimer(){return new o.ShiftTimer((()=>{if((0,g.isDropLastNameEnabled)()){const e=new Map;this.participants&&this.participants.forEach((t=>{if(t.contact.shortName&&t.contact.isMyContact){const r=this._normalizeShortName(t.contact.shortName);e.has(r)?e.set(r,!1):e.set(r,!0)}})),this.uniqueShortNameMap=e}}))}isTrusted(){if(this.stale)return this.trusted;if(this.support)return this.trusted=!0;if(this.addedBy){const e=d.ContactCollection.get(this.addedBy);if(null==e?void 0:e.isMyContact)return this.notAddedByContact=!1,this.trusted=!0}return this.notAddedByContact?this.trusted=!1:this.trusted=!0}revokeGroupV4AddInvite(e){if(this.revokeGroupV4AddInvitePromise)return this.revokeGroupV4AddInvitePromise;const t=this.id.toString(),{pendingParticipants:r}=this;let n=Promise.resolve();return n=(0,E.revokeGroupInviteV4)(e,t),this.revokeGroupV4AddInvitePromise=n.then((t=>(t.status>=200&&t.status<300&&r.remove(e),t.status))).catch((()=>(__LOG__(3)`models:groupMetadata:participantCollection:revokeGroupV4AddInvite failed`,500))).finally((()=>{this.revokeGroupV4AddInvitePromise=null}))}queryGroupV4PendingInvite(){var e=this;return(0,i.default)((function*(){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND))return void(yield(0,_.updatePendingParticipants)(e.id));const t=(0,u.getMaybeMeUser)().toString(),r=e.id.toString();return T.default.findGroupPendingInvitesFromPhone(t,r).then((t=>{e.collection&&e.collection.add({id:e.id,pendingParticipants:t.participants},{merge:!0})})).catch((0,a.filteredCatch)(C.WebdDrop,(()=>{})))}))()}getJoinedSubgroupsMetadata(){const e=this.getCollection();return this.joinedSubgroups.map((t=>e.get(t.toString()))).filter(Boolean)}getUnjoinedSubgroupsMetadata(){return this.unjoinedSubgroups.map((e=>S.default.get(e.toString()))).filter(Boolean)}getSubgroupsMetadata(){return[...this.getJoinedSubgroupsMetadata(),...this.getUnjoinedSubgroupsMetadata()]}getCollection(){return r(63928).default}}A.Proxy="groupMetadata",A.idClass=s.default,A.UPDATE_NAME_MAP_DEBOUNCE_TIME=200;var b=(0,c.defineModel)(A);t.default=b},63928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(93386)),o=r(50796),s=n(r(89867)),l=r(45454),c=r(1255),d=r(69951),u=r(42822),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=C(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),f=r(7293),_=r(57701),h=r(90101),g=n(r(14423)),m=r(96269),y=r(10790),E=n(r(95716)),S=r(97270),v=n(r(56891)),T=r(77591);function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(C=function(e){return e?r:t})(e)}class A extends c.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.onGroupAdd),this.listenTo(this,"remove",this.onGroupRemove),this.listenTo(this,"change:parentGroup",this.onParentGroupChange)}onGroupAdd(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;if(null!=t){const r=e.id;(0,S.addJoinedSubgroup)(t,r)}}onGroupRemove(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;if(null!=t){const r=e.id;(0,S.removeJoinedSubgroup)(t,r)}}onParentGroupChange(e,t,r){if(!e.participants.iAmMember())return;const n=e.id,i=null!=t?this.get(t.toString()):null,a=null!=r?this.get(r.toString()):null;null!=i&&(0,S.addJoinedSubgroup)(i,n),null!=a&&(0,S.removeJoinedSubgroup)(a,n)}onResume(){(0,a.default)(d.ChatCollection.where({active:!0}).filter((e=>e.isGroup||e.isBroadcast)),d.ChatCollection.where({isBroadcast:!0})).forEach((e=>{this.find(e.id).catch((0,o.filteredCatch)([T.WebdDrop,p.ProtoVersionUndefined],(()=>{})))}))}_find(e){var t=this;return(0,i.default)((function*(){if(s.default.isGroup(e)){var n;const t=r(69951).ChatCollection.get(e);if(null==t?void 0:t.isReadOnly)return f.GK.supportsFeature(f.GK.F.MD_BACKEND)?(__LOG__(3)`queryGroupFromPhone: not implemented for MD`,Promise.resolve({id:e})):(0,m.queryGroupFromPhone)(e);let i=yield(0,h.getGroupMetadataFromStorage)(e);if(null==i)i=yield(0,y.sendQueryGroup)(e);else{const t=i.unjoinedSubgroups;if((0,_.communitiesEnabled)()&&null!=t&&t.length>0){const r=yield(0,E.default)(t);(0,u.addUnjoinedSubgroupsToCollection)(r,e)}}return(0,y.updateSubject)(e,null!=(null===(n=i)||void 0===n?void 0:n.subject)?i.subject:""),i}if(s.default.isBroadcast(e)){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return __LOG__(3)`contactFindBroadcast: not implemented for MD`,Promise.resolve({id:e});const r=yield v.default.contactFindBroadcast(e);if(200===r.status){const n=t.get(e);return n&&!n.stale?n:{id:e,participants:r.recipients}}if(404===r.status)return __LOG__(3)`models:GroupMetadataCollection:_find:False broadcast list query`,{id:e};throw __LOG__(3)`models:GroupMetadataCollection:_find:bclist error: ${r.status}`,new Error("models:GroupMetadataCollection:_find:bclist error: "+r.status)}return __LOG__(2)`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`,Promise.reject(new Error(`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`))}))()}_handle(e){return e}handlePendingInvite(e){const{gid:t,participants:r}=e;this.add({id:(0,l.createWid)(t),pendingParticipants:r},{merge:!0})}}A.model=g.default,A.staleCollection=!0;var b=new A;t.default=b},55981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupType=void 0;const n=r(76672).Mirrored(["DEFAULT","COMMUNITY","SUBGROUP","DEFAULT_ANNOUNCEMENT_GROUP"]);t.GroupType=n},45077:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=r(11290),o=r(19380);class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.isAdmin=(0,a.prop)(),this.isSuperAdmin=(0,a.prop)(),this.contact=(0,a.session)()}initialize(){super.initialize(),this.addChild("contact",o.ContactCollection.gadd(this.id))}}s.Proxy="participant",s.idClass=i.default;var l=(0,a.defineModel)(s);t.default=l},96091:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(69951),o=n(r(31727)),s=r(56489),l=r(99234),c=r(7293),d=r(57701),u=n(r(43725)),p=n(r(45077)),f=n(r(26812)),_=r(97270);class h extends o.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._updateSubgroup=e=>{var t,r,n;const i=(0,l.getMaybeMeUser)();if(!i||!i.equals(e.id))return;const o=this.parent.id,s=o?null===(t=a.ChatCollection.get(o.toString()))||void 0===t||null===(r=t.groupMetadata)||void 0===r?void 0:r.parentGroup:null,c=s?null===(n=a.ChatCollection.get(s.toString()))||void 0===n?void 0:n.groupMetadata:null;null!=c&&(this.iAmMember()?(0,_.addJoinedSubgroup)(c,o):(0,_.removeJoinedSubgroup)(c,o))},this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.sendForNeededAddRequest=e=>{var t,r;const n=this.parent.id,i=a.ChatCollection.assertGet(n),o=null!==(t=null===(r=i.groupMetadata)||void 0===r?void 0:r.desc)&&void 0!==t?t:"";(0,s.sendForNeededAddRequest)(e,i.formattedTitle||i.name,o,this.parent.id)},this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(u.default,"locale_change",this._debouncedSort),this.listenTo(this,"add remove",this._updateSubgroup)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e,t){const r=t||{};return r.isParticipantCollectionAdd||(r.remove=!0),super.set(e,r)}add(e,t){const r=t||{};return r.isParticipantCollectionAdd=!0,super.add(e,r)}canAdd(){return!!this.iAmAdmin()}canPromote(e){return!!e&&(!(0,l.getMaybeMeUser)().equals(e.id)&&(!!this.iAmAdmin()&&!e.isAdmin))}canDemote(e){var t;if(!e)return!1;if(!this.iAmAdmin())return!1;const r=this.parent.id,n=a.ChatCollection.assertGet(r);if((!(0,d.cadminSelfDemoteEnabled)()||!0!==(null===(t=n.groupMetadata)||void 0===t?void 0:t.isParentGroup)||1===this.getAdmins().length)&&(0,l.getMaybeMeUser)().equals(e.id))return!1;return!(c.GK.supportsFeature(c.GK.F.GROUPS_V_3)&&e.isSuperAdmin)&&!!e.isAdmin}canRemove(e){return!!e&&(!(0,l.getMaybeMeUser)().equals(e.id)&&!!this.iAmAdmin())}canVerifyIdentity(e){return!!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(!!e&&!(0,l.getMaybeMeUser)().equals(e.id))}iAmMember(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)()))).length}iAmRestrictedMember(){var e;const t=this.parent.id;return!0===(null===(e=a.ChatCollection.assertGet(t).groupMetadata)||void 0===e?void 0:e.restrict)&&!this.iAmAdmin()}iAmAdmin(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)())&&e.isAdmin)).length}iAmSuperAdmin(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)())&&e.isSuperAdmin)).length}getAdmins(){return this.where({isAdmin:!0})}getSuperAdmin(){return this.findFirst((e=>e.isSuperAdmin))}}t.default=h,h.model=p.default,h.comparator=f.default},26812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(47969);var i=(e,t)=>(0,n.ContactComparator)(e.contact,t.contact);t.default=i},48911:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=n(r(31727)),o=n(r(43725)),s=n(r(45077)),l=n(r(26812));class c extends a.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(o.default,"locale_change",this._debouncedSort)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd||(t.remove=!0),super.set(e,t)}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd=!0,super.add(e,t)}}t.default=c,c.model=s.default,c.comparator=l.default},33689:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=r(11290),o=n(r(96091));class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.subject=(0,a.prop)(),this.parentGroupId=(0,a.prop)(),this.participants=(0,a.collection)(o.default)}}s.Proxy="unjoinedSubgroupMetadata",s.idClass=i.default;var l=(0,a.defineModel)(s);t.default=l},73213:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=n(r(33689));class o extends i.BaseCollection{}o.model=a.default;var s=new o;t.default=s},11824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(11006));r(43323);class o extends i.BaseModel{constructor(){super(...arguments),this.unreadMentionCollection=(0,i.prop)(),this.pendingUnreadMentionCount=(0,i.prop)()}initialize(){this.unreadMentionCollection=new a.default,this.pendingUnreadMentionCount=0}hasMentionId(e){return null!=this.unreadMentionCollection.get(e)}addUnreadMentions(e){this.unreadMentionCollection.add(e)}removeUnreadMentions(e){this.unreadMentionCollection.remove(e)}oldestUnreadMention(){return this.unreadMentionCollection.oldestUnreadMention()}reset(){this.pendingUnreadMentionCount=0,this.unreadMentionCollection.reset()}getUnreadMentionCount(){return this.pendingUnreadMentionCount+this.unreadMentionCollection.length}}var s=(0,i.defineModel)(o);t.default=s},43323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadMessageType=void 0;const n=r(76672).Mirrored(["NEW_MESSAGE","PERSISTANCE_LOAD","HISTORYC_SYNC_CHUNK"]);t.UnreadMessageType=n},1255:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0,Object.defineProperty(t,"CACHE_POLICY",{enumerable:!0,get:function(){return d.CACHE_POLICY_TYPE}}),t.CollectionSilentQueryError=void 0;var i=n(r(48926)),a=n(r(81109)),o=n(r(73955)),s=n(r(39693)),l=n(r(43063)),c=r(50796),d=r(73923),u=n(r(31727)),p=r(17239),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=S(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),_=r(99234),h=(r(27798),r(62583)),g=r(8080),m=r(31515),y=r(77591),E=r(65044);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(S=function(e){return e?r:t})(e)}const v="QUERY",T="FIND",C="UPDATE",A=(new Object).toString(),b={id:"none",policy:d.CACHE_POLICY_TYPE.NONE};class P extends Error{constructor(e){super(e),this.name="CollectionSilentQueryError",this.message=e}}t.CollectionSilentQueryError=P;class M extends u.default{constructor(){super(),this._inflight={},this._cachePolicy=(0,d.createCachePolicy)(this,this.constructor.cachePolicy||b),this._staleCollection=this.constructor.staleCollection||!1,this._resumeOnAvailable=this.constructor.resumeOnAvailable||!1,(!0===this._staleCollection||(0,m.isFunction)(this.onResume))&&(this.listenTo(E.Socket,"change:stream",this._handleStreamChange),this.listenTo(E.Socket,"didResume",this._onResume),this._resumeOnAvailable&&this.listenTo(g.Stream,"change:available",(()=>{g.Stream.available&&this._needsUpdate&&this._onResume()}))),this._cachePolicy.enableCaching(),this._cachePolicy.constructor.policy===d.CACHE_POLICY_TYPE.LOAD&&this.listenTo(p.Conn,"me_ready",this._updateFromCache)}initializeFromCache(e){this.add(e)}saveToCache(){if(!p.Conn.shouldSaveToCache())return;const{id:e}=this._cachePolicy;__LOG__(2)`baseCollection:saveToCache save: ${String(e)}`,(0,_.setCollection)(e,this.toJSON())}add(e,t){if(e){if(p.Conn.blockStoreAdds)throw new y.LogoutDrop("adding to store when blocking store adds");const r=Array.isArray(e)?e:[e];if(r.every((e=>null==e?void 0:e.isState))){const e=(0,l.default)(r,(e=>this.get(e.id)));return e.length&&super.add(e,t),r}}return super.add(e,t)}findQuery(e,t){return this._query(v,e,t)}find(e,t){return e?this._query(T,e,t):(__LOG__(4,void 0,new Error,!0)`Called find without an id`,SEND_LOGS("find-without-id"),Promise.reject(new Error("called find without an id")))}update(e,t){return e?this._query(C,e,t):(__LOG__(4,void 0,new Error,!0)`Called update without an id`,SEND_LOGS("update-without-id"),Promise.reject(new Error("called update without an id")))}handle(e){const t=this._handle(e.shift());if(this._staleCollection){const e=Array.isArray(t)?t:[t];(0,s.default)(e).forEach((e=>{e.stale=!1}))}this.add(t,{merge:!0})}gadd(e,t){if(this.modelClass.prototype.isIdType(e)){const r=this.get(e);return r||this.add({id:e},t)[0]}if(e.id){const r=t||{};return r.merge=!0,this.add(e,r)[0]}throw new Error("gadd called without an id attr (id)")}gaddUp(e){let t,r=this._staleCollection;if(this.modelClass.prototype.isIdType(e)){const n={stale:r,id:e};t=this.get(e)||this.add(n,{merge:!0})[0]}else e.id&&(this.get(e.id)&&(r=!1),e=(0,a.default)({stale:r},e),t=this.add(e,{merge:!0})[0]);if(t){const e=t;return t.stale&&this.find(t.id).catch((0,c.filteredCatch)(y.WebdDrop,(()=>{}))),e}throw new Error(".gaddUp called without an id attr (id)")}delete(){this._inflight={},this.reset()}isStateStale(e){const t=this.get(e);return!!t&&t.stale}_handleResume(){switch(E.Socket.stream){case h.SOCKET_STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach((e=>{e&&(e.stale=!0)}));break;case h.SOCKET_STREAM.RESUMING:case h.SOCKET_STREAM.SYNCING:case h.SOCKET_STREAM.CONNECTED:}}_onResume(){(0,m.isFunction)(this.onResume)&&(this._resumeOnAvailable&&!g.Stream.available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}_query(e,t,r){let n=(0,m.isString)(t)?t:t.toString();n===A&&(n=(0,o.default)("collection_query_"));const i=e===v?void 0:this.get(t),a="force-"+n;return(this._inflight[a]&&e===T||e===C)&&(n=a),this._inflight[n]?e===T&&i&&!i.stale?Promise.resolve(i):this._inflight[n]:!i||i.stale||e===C?this._inflight[n]=this._serverQuery(e,t,r).finally((()=>{delete this._inflight[n]})).catch((0,c.filteredCatch)(y.LogoutDrop,(e=>{__LOG__(3)`LogoutDrop error: ${e.toString()}`}))).catch((e=>{if(!(e instanceof P))throw e;__LOG__(2)`baseCollection:query query promise rejected: ${String(e)}`})).catch((0,c.filteredCatch)(y.WebdDrop,(function(e){throw __LOG__(3)`WebdDrop error: ${e.toString()}`,e}))):Promise.resolve(i)}_serverQuery(e,t,r){var n=this;return(0,i.default)((function*(){let i;if(e===C)i=n._update(t,r);else if(e===T)i=n._find(t,r);else{const e=null==r?void 0:r.logOnSend;i=n._findQuery(t,e)}const a=yield i;if(n._staleCollection){const e=Array.isArray(a)?a:[a];(0,s.default)(e).forEach((function(e){void 0===e.stale&&(e.stale=!1)}))}let o;if(o=(null==r?void 0:r.set)?n.set(a):n.add(a,{merge:!0}),Array.isArray(a))return o;if(o[0])return o[0];throw new f.ModelCreateError("Unknown",a)}))()}_update(e,t){return this._find(e,t)}_handleStreamChange(){this._handleResume(),this._cachePolicy.constructor.policy===d.CACHE_POLICY_TYPE.LOAD&&this._updateFromCache()}_updateFromCache(){const{id:e}=this._cachePolicy;this._cachePolicy.disableCaching(),p.Conn.shouldSaveToCache()&&(__LOG__(2)`baseCollection:initFromCache load: ${String(e)}`,this.initializeFromCache((0,_.getCollection)(e)),this._cachePolicy.enableCaching())}}t.BaseCollection=M},25389:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMirror=void 0,t.genBitMask=function(e,t){const r=[];for(let n=0;n<t.length;n++){const i=e[`change:${t[n]}`],a=Math.floor(i/32);o(r,a+1),r[a]|=1<<i%32}return r},t.genMirrorMask=function(e){const t={};let r=0;const n=e=>{t[`change:${e}`]=r++};e.props&&Object.keys(e.props).forEach(n);e.session&&Object.keys(e.session).forEach(n);e.derived&&Object.keys(e.derived).forEach(n);return t};var i=n(r(4788));function a(e,t){e[t]=e[e.length-1],e.pop()}function o(e,t){if(t<=e.length)return;const r=t-e.length;for(let t=0;t<r;t++)e.push(0)}t.BaseMirror=class{constructor(e){this.state=e}destructor(){this.state.off("all",this.onGatherEvent,this)}initListener(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[]}onGatherEvent(e){if("change"===e){if(!this.changeEvents.filter(Boolean).length)return;this.onChange(),this.changeEvents=[]}else{const t=this.state.mirrorMask[e];if(void 0===t)return;const r=t/32|0;o(this.changeEvents,r+1),this.changeEvents[r]|=1<<(t%32|0)}}onChange(){const e=this.state,t=this.changeEvents;(0,i.default)(this.masks,this.listeners).forEach((r=>{let[n,i]=r;const a=Math.min(t.length,n.length);for(let r=0;r<a;r++)if(t[r]&n[r]){const[t,r]=i;null!=t&&null!=r&&t(r,e);break}}))}addListener(e,t,r){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,r])}removeListener(e){const t=this.listeners;for(let r=0;r<t.length;r++)t[r][0]===e&&(t[r][0]=null,t[r][1]=null,a(this.masks,r),a(t,r))}}},11290:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0,Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return p.collection}}),t.defineModel=function(e){const t=(0,p.convert)(e),r=(0,p.stateExtend)(m,t);if(e.Proxy){const n=(0,c.genMirrorMask)(t);r.prototype.mirrorMask=n,r.prototype.proxyName=e.Proxy,(0,f.ProxyStateFactory)(e.Proxy,t,n)}return r},Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return p.derived}}),Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return p.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return p.session}});var i=n(r(81109)),a=n(r(7287)),o=n(r(2525)),s=n(r(52353)),l=n(r(14176)),c=r(25389),d=r(88102),u=n(r(34342)),p=r(67820),f=r(80134),_=r(31515),h=r(77591);const g=/^change:/;class m extends u.default{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),this.stale=(0,p.session)(!1),this.__fired=null,this.__changes=null,this.__initialized=!1,t._internalInitializationDoNotUse)return;this.stale=(null==e?void 0:e.stale)||this.getDefault("stale"),this.parent=t.parent,this.collection=t.collection,this._initDeriveds(),this._initCollections();const r=this.__defaults,n=r?(0,i.default)((0,i.default)({},r),e):e;n&&!function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)&&this.set(n,(0,i.default)({silent:!0},t)),this.initialize(),this.__initialized=!0}initialize(){if(this.collection&&this.id&&!this.collection.modelClass.prototype.isIdType(this.id))throw new Error(`Model id:${String(this.id)} is wrong type`);this._uiObservers=0,this.mirrorMask&&(this.mirror=new c.BaseMirror(this))}_refreshStaleModel(){if(this._uiObservers||!this.stale){if(!this.getCollection)throw new Error("base_model:_refreshStaleModel getCollection does not exist");this.getCollection().find(this.id).catch(h.WebdDrop,(()=>{}))}}incObservers(e){if(this._uiObservers++,e)return;r(57220).default.online&&this.stale&&(d.Cmd.uiBusy?this.listenToOnce(d.Cmd,"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}decObservers(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(d.Cmd,"ui_idle",this._refreshStaleModel)}hasObservers(){return this._uiObservers>0}addChild(e,t){const r={};r[e]=t,this.set(r,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}get(e){return this[e]}set(e,t,r){var n;let i=r;return"string"==typeof e?this._set(e,t,i):(i=t,(null===(n=i)||void 0===n?void 0:n.merge)?this._set((0,l.default)(e,s.default),i):this._set(e,i))}_markChange(e,t){this.__initialized&&(this._getChanges().push({key:e,oldValue:t}),this.__fired&&(this.__fired[e]=!1))}_set(e,t,r){const n=!!this.__changes,[i,a]=(0,_.isString)(e)?[{[e]:t},r]:[e,t];let o=Object.keys(i).reduce(((e,t)=>{const r=this._setKV(t,i[t],a);return r&&e.push(...r),e}),[]),s=0;for(;o&&o.length>0;){if(s++>5)throw new Error("Circular derived properties / event listeners");const e=this._topo;if(!e)throw new Error("_topo unexpectedly undefined");const t=y(e,o);o=t.reduce(((e,r,n)=>{const i=this._setD(r,t.slice(n+1));return i&&e.push(...i),e}),[])}if(!(null==a?void 0:a.silent)&&this.hasUnfiredChanges()){const e=this.__fired={},t=this._getChanges(),r=t.length>0;for(;t.length;){const{key:r,oldValue:n}=t.shift();if(!e[r]){e[r]=!0;const t=this._definition[r].evt;if(this.isListening(t)||this.isListening("all")){const e=this[r];this.trigger(t,this,e,n)}}}(r&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return n||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}_setKV(e,t,r){if(this._collections[e])return void this[e].set(t,r);const n=this._definition[e];if(!n)return void(this[e]=t);if(n.attr===p.Attr.DERIVED)throw new Error(`Attempting to directly set derived property: ${e}`);const i=n.sk,a=this[e];if(t===a)return;this[i]=t,this._markChange(e,a);const o=this._deps;return(null==o?void 0:o[e])?o[e]:void 0}_setD(e,t){var r;const n=this._definition[e],i=n.sk,a=n.fn.call(this),o=this[i];if(a!==o&&(this[i]=a,this._markChange(e,o),null===(r=this._deps)||void 0===r?void 0:r[e])){const r=function(e,t){const r=new Set(t);return e.filter((e=>!r.has(e)))}(this._deps[e],t);if(r.length)return r}}hasUnfiredChanges(){const e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(let r=0;r<t.length;r++)if(!e[t[r].key])return!0;return!1}_getChanges(){return this.__changes||(this.__changes=[])}_initDeriveds(){this.__derived.forEach((e=>{this[this._definition[e].sk]=p.INIT}))}_initCollections(){(0,o.default)(this._collections,((e,t)=>{this[t]=new e(null,{parent:this})}))}unset(e,t){const r=Array.isArray(e)?e:[e];this.set((0,a.default)(r),t)}clear(){this.unset([...this.__props,...this.__session])}delete(){this.stopListening()}reset(){this.set(this.__defaults)}toJSON(){return this.serialize()}serialize(){const e={};for(let t=0;t<this.__props.length;t++)e[this.__props[t]]=this[this.__props[t]];return(0,o.default)(this._collections,((t,r)=>{e[r]=this[r].serialize()})),e}getDefault(e){const t=this._definition[e];if(!t)return;const r=t.defaultValue;return(0,_.isFunction)(r)?r():r}_getCachedEventBubblingHandler(e){return function(t,r,n){g.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],r,n):"change"===t&&this.trigger("change",this)}.bind(this)}static isIdType(e){return!(!this.allowedIds||!this.allowedIds.includes(e))||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}function y(e,t){const r=new Set(t);return e.filter((e=>r.has(e)))}t.BaseModel=m},14648:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=t.BaseCachePolicy=void 0;var i=n(r(34342));const a={LOAD:"LOAD",NONE:"NONE"};t.CACHE_POLICY_TYPE=a;class o extends i.default{constructor(e,t){super(),this._collection=e,this._id=t}enableCaching(){}disableCaching(){}get collection(){return this._collection}get id(){return this._id}}t.BaseCachePolicy=o,o.policy=a.NONE},73923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CACHE_POLICY_TYPE",{enumerable:!0,get:function(){return i.CACHE_POLICY_TYPE}}),t.createCachePolicy=function(e,t){switch(t.policy){case"LOAD":return new a.default(e,t);case"NONE":return new o.default(e,t)}return new o.default(e,{id:"none",policy:"NONE"})};var i=r(14648),a=n(r(1088)),o=n(r(58433))},1088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(14648);class o extends a.BaseCachePolicy{constructor(e,t){super(e,t.id),this._trigger=t.trigger||"all",this._delay=t.delay,this._saveToCache=(0,i.default)(this.saveToCache,this._delay)}saveToCache(){this.collection.saveToCache()}enableCaching(){this.listenTo(this.collection,this._trigger,this._saveToCache)}disableCaching(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}t.default=o,o.policy=a.CACHE_POLICY_TYPE.LOAD},58433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(14648);class i extends n.BaseCachePolicy{constructor(e,t){super(e,t.id)}}t.default=i,i.policy=n.CACHE_POLICY_TYPE.NONE},31727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(48206),o=n(r(34342));class s extends o.default{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),e.parent&&(this.parent=e.parent);const{model:t,comparator:r}=this.constructor;if(!t)throw new Error("Collection initialized without model. It is likely that you have a circular dependency. Run `yarn lint:circular` to find it and use inline `require` instead of `import` to avoid it.");this.modelClass=t,r&&(this._comparator=r),this._reset()}add(e,t){let r;return r=Array.isArray(e)?e.slice():e?[e]:[],this.set(r,(0,i.default)({merge:!1,add:!0,remove:!1},t))}set(e,t){if(!e)return __LOG__(3)`collection:set called with no models`,[];const r=(0,i.default)({add:!0,remove:!0,merge:!0},t);let n,a,o,s;const l=this._comparator&&!1!==r.sort,c=[],d=[],u={},{add:p,merge:f,remove:_}=r,h=null!=r.at?r.at:void 0,g=!(l||!p||!_)&&[];for(let t=0,i=e.length;t<i;t++){if(s=e[t],this.isModel(s)&&(a=s),n=s.id,!n){__LOG__(3)`collection:set model has no id`;continue}if(o=this.get(n),o){const n=o;_&&(u[o.id.toString()]=!0),f&&(s=a&&s===a?a.attributes:s,n.set(s,r)),e[t]=n}else if(p){if(a=e[t]=this._prepareModel(s,r),!a)continue;{const e=a;c.push(e),this._addReference(e)}}if(a=o||a,!a)continue;const i=a;!g||a.id&&u[a.id.toString()]||g.push(i),u[i.id.toString()]=!0}if(_){for(let e=0,t=this.length;e<t;e++){a=this._models[e];const t=a;u[a.id.toString()]||d.push(t)}d.length&&this.remove(d,(0,i.default)({},r))}let m;if(c.length||(null==g?void 0:g.length))if(l&&(m=!0),"number"==typeof h)this._models.splice(h,0,...c);else{const e=g||c;for(let t=0,r=e.length;t<r;t++)this._models.push(e[t])}if(m&&this.sort({silent:!0}),!r.silent){for(let e=0,t=c.length;e<t;e++)a=c[e],a.trigger?a.trigger("add",a,this,r):this.trigger("add",a,this,r);(m||g.length)&&this.trigger("sort",this,r)}return e}remove(e){let t,r,n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=Array.isArray(e)?e.slice():[e],s=[];for(let e=0,l=o.length;e<l;e++)if(i=o[e],i&&(n=i instanceof this.modelClass?i.id:i,t=s[e]=this.get(n),t)){const e=t;this._deIndex(t),r=this._models.indexOf(t),this._models.splice(r,1),a.silent||(a.index=r,e.trigger?e.trigger("remove",t,this,a):this.trigger("remove",t,this,a)),this._removeReference(e)}return s}reset(){for(let e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}sort(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}replaceId(e,t){const r=this.get(e);r&&(this._removeFromIndex(e),r.set({id:t}),this._addIndex(r))}reorderMutate(e,t){(0,a.arrayMoveMutate)(this._models,e,t)}get(e){return this._index[e]}assertGet(e){const t=this._index[e];return t||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Collection:assertGet no result")),t}at(e){return this._models[e]}get length(){return this._models.length}get isCollection(){return!0}get models(){return this._models}serialize(){return this.map((e=>e.toJSON()))}toJSON(){return this.serialize()}isModel(e){return e instanceof this.modelClass}includes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0===t?e instanceof this.modelClass&&null!=this.get(e.id):this._models.includes(e,t)}indexOf(e,t){return this._models.indexOf(e,t)}lastIndexOf(e,t){return this._models.lastIndexOf(e,t)}every(e){return this._models.every(e)}some(e){return this._models.some(e)}forEach(e){this._models.forEach(e)}map(e){return this._models.map(e)}filter(e){return this._models.filter(e)}findFirst(e){return this._models.find(e)}reduce(e,t){return this._models.reduce(e,t)}slice(e,t){return this._models.slice(e,t)}where(e){return this.filter((t=>{for(const r in e)if(e[r]!==t.get(r))return!1;return!0}))}head(){return this._models[0]}last(){return this._models[this._models.length-1]}toArray(){return this._models.slice()}getModelsArray(){return this._models}reorder(e,t){return(0,a.arrayMove)(this._models,e,t)}_reset(){this._models=[],this._index={}}_prepareModel(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;const r=(0,i.default)((0,i.default)({},t),{},{collection:this});try{return new this.modelClass(e,r)}catch(e){return void __LOG__(3)`collection:_prepareModel exception: ${e.stack}`}}_addReference(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._onModelEvent,this)}_removeReference(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._onModelEvent,this)}_addIndex(e){this._index[e.id]=e}_deIndex(e){delete this._index[e.id]}_removeFromIndex(e){this.get(e)&&delete this._index[e]}_onModelEvent(e,t,r,n){const i=e.indexOf(":"),a=-1===i?e:e.slice(0,i);("add"!==a&&"remove"!==a||r===this)&&("destroy"===a&&this.remove(t,n),this.trigger.apply(this,arguments))}}t.default=s},67820:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.INIT=t.Attr=void 0,t.collection=function(e){return{val:e,type:m}},t.convert=function(e){const t=new e({},{_internalInitializationDoNotUse:!0}),r={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(r.Collection=e.Collection);e.idClass&&(r.idClass=e.idClass);e.allowedIds&&(r.allowedIds=e.allowedIds);const n=new Set(["constructor"]),i=new Set(["collection","parent","__changes","__fired","__initialized"]);(function(e){const t=[];for(const r in e)"function"!=typeof e[r]&&t.push([r,e[r]]);return t})(t).forEach((t=>{let[a,s]=t;if(!i.has(a)&&null!=s)switch(s.type){case _:r.props[a]=y(s);break;case h:r.session[a]=y(s);break;case g:r.derived[a]=(0,o.default)(s,"type"),n.add(s.fn.name);break;case m:r.collections[a]=s.val;break;default:throw new Error(`Invalid defineModel Class type for ${e.name}:${a}.`)}}));const a=function(e){const t={},r=Object.getPrototypeOf({});let n=e;Object.getOwnPropertyNames(n).forEach((e=>{"function"==typeof n[e]&&(t[e]=n[e])}));for(;(n=Object.getPrototypeOf(n))&&n!==r;)Object.getOwnPropertyNames(n).forEach((e=>{e in t||(t[e]=n[e])}));return t}(t);return n.forEach((e=>{delete a[e]})),Object.assign(r,a),r},t.derived=function(e,t){return{fn:e,deps:t,type:g}},t.prop=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:_};return t},t.session=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:h};return t},t.stateExtend=function(e,t){const r=(0,l.default)(t.name,"protoDef.name");delete t.name;const n=function(e,t){return{[t]:class extends e{}}[t]}(e,r),s=n.prototype,d=s.__props=[],f=s.__session=[],_=s.__derived=[],h=s._collections={},g=s._definition={},m=s._derived={};(0,a.default)(t.props,(function(e,t){d.push(t),S(s,t,e,p.PROP)})),(0,a.default)(t.session,(function(e,t){f.push(t),S(s,t,e,p.SESSION)})),(0,a.default)(t.derived,(function(e,t){_.push(t),function(e,t,r){const n=E(t),i=r.fn;e._definition[t]=e._derived[t]={sk:n,evt:"change:"+t,attr:p.DERIVED,fn:i,deps:r.deps},Object.defineProperty(e,t,{get(){const e=this[n];if(e!==u)return e;const t=i.call(this);return this[n]=t,t},set(){throw new TypeError(`'${t}' is a derived property, it can't be set directly.`)}})}(s,t,e)})),(0,a.default)(t.collections,(function(e,t){h[t]=e})),Object.assign(s,(0,o.default)(t,["props","session","derived","collections"]));const y=d.concat(f),v=y.length;Object.defineProperties(s,{attributes:{get(){const e={};for(let t=0;t<v;++t)e[y[t]]=this[y[t]];return e}},isState:{get:()=>!0,set(){throw new Error("attempt to set isState")}}});const T={};for(let e=0;e<v;e++){const t=y[e];"defaultValue"in g[t]&&(T[t]=u)}(0,i.default)(T)||(s.__defaults=T);if(_.length){const e=[],t={},r={};(0,a.default)(m,((n,i)=>{r[i]=!0,(0,a.default)(n.deps,(n=>{r[n]=!0,(t[n]||(t[n]=[])).push(i),e.push([i,n])}))})),e.length&&(s._deps=t,s._topo=c.default.array(Object.keys(r),e).reverse())}return n};var i=n(r(41609)),a=n(r(2525)),o=n(r(57557)),s=n(r(13218)),l=n(r(45095)),c=n(r(94633)),d=r(31515);const u={sentinel:"DEFAULT VALUE PLACEHOLDER"};t.INIT=u;const p={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"};t.Attr=p;const f=Symbol("NO_DEFAULT_VALUE");t.NO_DEFAULT_VALUE=f;const _="Props",h="Session",g="Derived",m="Collection";function y(e){const t=e.defaultValue;return t===f?{}:{defaultValue:t}}function E(e){return"__x_"+e}function S(e,t,r,n){if(!(0,s.default)(r))throw new Error("Invalid Prop/Session definition.");const i={sk:E(t),evt:`change:${t}`,attr:n};void 0!==r.defaultValue&&(i.defaultValue=r.defaultValue),e._definition[t]=i;const a=(0,d.isFunction)(i.defaultValue);if(null!=i.defaultValue&&!a){if(Array.isArray(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if((0,s.default)(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: WAUnsafeObjectType provided.")}const o=i.sk;Object.defineProperty(e,t,{set(e){this.set(t,e)},get(){const e=this[o];return e!==u?e:a?this[o]=i.defaultValue():i.defaultValue}})}},80134:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=t.ProxyStateFactory=t.DuplicatedProxyProperty=void 0;var i=n(r(6479)),a=r(40265);const o=["props","session","collections","derived"];class s extends((0,a.customError)("DuplicatedProxyProperty")){}t.DuplicatedProxyProperty=s;const l={};t.ProxyStates=l;t.ProxyStateFactory=(e,t,r)=>{const{props:n,session:a,collections:c,derived:d}=t,u=(0,i.default)(t,o),p=function(e){this.$ProxyState$state=e},f={};if([n,a,c,d].forEach((t=>{t&&Object.keys(t).forEach((t=>{f[t]={get(){return __LOG__(4,void 0,new Error,!0)`Cannot read proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Access"),this.$ProxyState$state[t]},set(r){__LOG__(4,void 0,new Error,!0)`Cannot write proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Write"),this.$ProxyState$state[t]=r}}}))})),f.proxyName={value:e},f.mirrorMask={value:r},f.isProxyOf={value(e){return this.$ProxyState$state===e}},["set","get",...Object.keys(u)].forEach((e=>{f[e]={value(){const t=this.$ProxyState$state;return t[e].apply(t,arguments)}}})),(p.prototype=Object.create(null,f)).constructor=p,e in l)throw new s(`Duplicated proxy property "${e}".`);l[e]=p}},71306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(50796),a=n(r(89867)),o=r(48360),s=r(46331),l=r(11290),c=r(69951),d=r(88102),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),p=r(99234),f=r(7293),_=n(r(43725)),h=n(r(33861)),g=n(r(56891)),m=r(77591),y=r(85893);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}class S extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.duration=(0,l.prop)(),this.participants=(0,l.collection)(h.default),this.active=(0,l.session)(!1),this.keepAliveTimer=(0,l.session)(),this.stopPromise=(0,l.session)()}initialize(){super.initialize(),this.listenTo(this.participants,"remove reset",(()=>{this.hasParticipants()||this.delete()}));const e=c.ChatCollection.get(this.id);e&&!e.liveLocation&&(e.liveLocation=this)}delete(){super.delete(),this.stopViewingMap(),this.participants.delete(),this.getCollection().remove(this.id);const e=c.ChatCollection.get(this.id);e&&(e.liveLocation=void 0)}hasParticipants(){return this.participants.length>0}startViewingMap(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}stopViewingMap(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}userHasLiveLocation(e){return!!this.participants.get(e)}iHaveLiveLocation(){return this.userHasLiveLocation((0,p.getMaybeMeUser)())}stopMyLiveLocation(e){if(!this.iHaveLiveLocation())return Promise.reject(new u.ActionError);if(this.stopPromise)return this.stopPromise;if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=this.stopPromise=g.default.disableLiveLocation(this.id),r=new s.ActionType(o.fbt._("Stopping live location sharing",null,{hk:"3Zapuy"})),n=e||(0,s.genId)(),i=t.then((e=>200===e.status?new s.ActionType(o.fbt._("Stopped sharing live location",null,{hk:"1sRjWg"})):e.status>=400?new s.ActionType(o.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"})):void 0)).catch((()=>(__LOG__(3)`models:liveLocation:disableLiveLocation dropped`,new s.ActionType(o.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"}),{actionText:_.default.t(129),actionHandler:this.stopMyLiveLocation.bind(this,n)}))));return d.Cmd.openToast((0,y.jsx)(s.ActionToast,{id:n,initialAction:r,pendingAction:i})),t.then((e=>{if(200===e.status&&!e._duplicate){const e=this.participants.get((0,p.getMaybeMeUser)());e&&e.disable()}})).finally((()=>{this.stopPromise=null}))}_updateLiveLocations(){this.getCollection().update(this.id).catch((()=>{}))}_pauseLiveLocations(){g.default.unsubscribeLiveLocation(this.id).catch((0,i.filteredCatch)(m.WebdDrop,(()=>{})))}_sendKeepAlive(){g.default.subscribeLiveLocation(this.id,!1).catch((0,i.filteredCatch)(m.WebdDrop,(()=>{})))}_startKeepAlive(){if(null!=this.keepAliveTimer)return;const e=this.duration;null!=e&&0!==e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}_stopKeepAlive(){null!=this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}getCollection(){return r(85865).LiveLocationCollection}}S.Proxy="liveLocation",S.idClass=a.default;var v=(0,l.defineModel)(S);t.default=v},85865:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LiveLocationCollectionImpl=t.LiveLocationCollection=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(50796),s=r(15461),l=n(r(89867)),c=r(1255),d=r(22683),u=r(19380),p=r(7293),f=n(r(71306)),_=r(31515),h=n(r(56891)),g=r(77591);class m extends c.BaseCollection{_find(e){var t=this;return(0,a.default)((function*(){if(!l.default.isUser(e)&&!l.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));if(p.GK.supportsFeature(p.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield h.default.subscribeLiveLocation(e,!0);if(r.status&&r.status>=400)return 499===r.status?__LOG__(2)`liveLocation:subscribe query not implemented on the phone`:__LOG__(3)`model:LiveLocation:_find error ${r.status}`,Promise.reject(r.status);const n=(0,_.isNumber)(r.duration)?r.duration:void 0,a=r.participants?r.participants.map((e=>(0,i.default)((0,i.default)({},t._extractLocationFields(e)),{},{id:e.id,expiration:0===e.expiration?1/0:e.expiration}))):[];return{id:e,duration:n,participants:a}}))()}getActive(e){var t=this;return(0,a.default)((function*(){if(!l.default.isUser(e)&&!l.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));try{const r=yield h.default.queryActiveLiveLocation(e);if(r.status&&r.status>=400)return 499===r.status?__LOG__(2)`liveLocation:participant query not implemented on the phone`:__LOG__(3)`model:LiveLocation:getActive error ${r.status}`,Promise.reject(r.status);if(!r.participants||!r.participants.length)return;const n=r.participants.map((e=>({id:e.id,expiration:0===e.expiration?1/0:e.expiration})));t.add({id:e,participants:n},{merge:!0})}catch(e){return(0,o.filteredCatch)(g.WebdDrop,(()=>{}))(e)}}))()}onResume(){this.filter((e=>e.active&&e.hasParticipants())).forEach((e=>{this.update(e.id)}))}handle(e){Array.isArray(e)?e.forEach((e=>{switch(e.type){case"update":{const t=this._extractLocationFields(e),r=u.ContactCollection.get(e.jid);(null==r?void 0:r.liveLocations)&&r.liveLocations.forEach((e=>e.set(t)));break}case"disable":{const t=this.get(e.chat);if(t){const r=t.participants.get(e.jid);r&&(e.seq>r.sequence||-1===e.seq)&&r.disable()}break}default:__LOG__(3)`models:liveLocation:handle unknown type: ${e.type}`}})):__LOG__(3)`models:liveLocation:handle unrecognized payload`}processMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.type===s.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to process non live-location msg"));const r=e.id.remote,{lat:n,lng:i,accuracy:a,speed:o,degrees:l,sequence:c,comment:u,shareDuration:p,t:f}=e;if(!f||!p)return;const _=f+p;if(_<=d.Clock.globalUnixTime())return;const h={id:e.sender,lat:n,lng:i,accuracy:a,speed:o,degrees:l,sequence:c,comment:u,expiration:_,lastUpdated:f,msg:e};-1===c&&delete h.sequence;const g=this.get(r);if(g){const e=g.participants.get(h.id);if(t)return void(e&&e.lastUpdated<=h.lastUpdated&&e.set(h));if(e&&g.participants.removeParticipant(e),g.hasParticipants())return void g.participants.add(h)}this.add({id:r,participants:[h]})}removeMsg(e){e.type===s.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to remove non live-location msg"));const t=e.id.remote,r=e.sender,n=this.get(t);n&&n.participants.remove(r)}_extractLocationFields(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:d.Clock.globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}t.LiveLocationCollectionImpl=m,m.model=f.default,m.staleCollection=!0,m.resumeOnAvailable=!0;const y=new m;t.LiveLocationCollection=y},57465:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=n(r(15421)),o=r(11290),s=r(22683),l=r(19380),c=r(99234),d=r(3879),u=r(31515);class p extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.msg=(0,o.prop)(),this.lat=(0,o.prop)(),this.lng=(0,o.prop)(),this.accuracy=(0,o.prop)(),this.speed=(0,o.prop)(),this.degrees=(0,o.prop)(),this.sequence=(0,o.prop)(),this.comment=(0,o.prop)(),this.expiration=(0,o.prop)(),this.lastUpdated=(0,o.prop)(),this.contact=(0,o.session)(),this.expireTimerId=(0,o.session)(),this.disabled=(0,o.session)(!1),this.isMe=(0,o.derived)(this._isMe,["id"]),this.valid=(0,o.derived)(this._valid,["lat","lng"])}_isMe(){return this.id.equals((0,c.getMaybeMeUser)())}_valid(){return t=this.lat,(0,u.isNumber)(t)&&t>=-90&&t<=90&&(e=this.lng,(0,u.isNumber)(e)&&e>=-180&&e<=180);var e,t}initialize(){super.initialize(),this.addChild("contact",l.ContactCollection.gadd(this.id)),(0,d.addLiveLocation)(this.contact,this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}delete(){super.delete(),this._disableMsg(),(0,d.removeLiveLocation)(this.contact,this),this._clearExpireTimer()}remainingTime(){return this.expiration-s.Clock.globalUnixTime()}elapsedTime(){return s.Clock.globalUnixTime()-this.lastUpdated}disable(){this.disabled=!0}_disableMsg(){const e=this.msg;e&&(e.shareDuration=s.Clock.globalUnixTime()-e.t-1)}_setExpireTimer(){this.expiration&&(this.remainingTime()<=0?this._expire():this.expireTimerId=a.default.setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}_clearExpireTimer(){a.default.clearTimeout(this.expireTimerId),this.expireTimerId=null}_expire(){this.disable()}}p.Proxy="liveLocationParticipant",p.idClass=i.default;var f=(0,o.defineModel)(p);t.default=f},33861:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=r(47969),o=r(99234),s=n(r(57465));class l extends i.BaseCollection{constructor(){super(),this.listenTo(this,"change:disabled",(e=>{e.disabled&&this.removeParticipant(e)}))}delete(){this.forEach((e=>this.removeParticipant(e)))}validLocations(){return this.filter((e=>e.valid))}removeParticipant(e){this.remove(e),e.delete()}}t.default=l,l.model=s.default,l.comparator=(e,t)=>{const r=(0,o.getMaybeMeUser)();return e.contact.id.equals(r)?-1:t.contact.id.equals(r)?1:(0,a.ContactComparator)(e.contact,t.contact)}},96489:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.isFocused=(0,n.session)(!0)}initialize(){super.initialize(),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}delete(){super.delete()}_onFocus(){this.isFocused=!0}_onBlur(){this.isFocused=!1}}i.Proxy="mainWindowState";var a=new((0,n.defineModel)(i));t.default=a},96876:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(57319),a=r(11290),o=r(22683),s=r(99234),l=r(7293),c=n(r(68132)),d=r(65044);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.showAwarenessMsg=(0,a.prop)(!1),this.showCountDownMsg=(0,a.prop)(!1),this.daysLeftTillDeadline=(0,a.prop)(0),this.expirationTime=(0,a.prop)(),this.deadlineExpiredLogoutTimer=(0,a.session)()}processMdOptInDeadline(){if(l.GK.supportsFeature(l.GK.F.EXTERNAL_MD_OPT_IN_AVAILABLE)&&c.default.mdOptInDeadline.timestamp>0){const e=c.default.mdOptInDeadline.timestamp,t=o.Clock.globalUnixTime(),r=o.Clock.daysDelta(t,e);if(t>e)return __LOG__(2)`MdOptInDeadline:processMdOptInDeadline logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),void d.Socket.logout();0===r?this.set({showCountDownMsg:!0,expirationTime:o.Clock.relativeStr(e).toString(),daysLeftTillDeadline:null,showAwarenessMsg:!1}):r<=7?this.set({showCountDownMsg:!0,daysLeftTillDeadline:r,expirationTime:null,showAwarenessMsg:!1}):this.set({showAwarenessMsg:!0,expirationTime:null,daysLeftTillDeadline:null,showCountDownMsg:!1}),this.deadlineExpiredLogoutTimer.cancel(),this.deadlineExpiredLogoutTimer.onOrAfter(1e3*(e-t))}}initialize(){super.initialize(),this.deadlineExpiredLogoutTimer=new i.ShiftTimer((function(){__LOG__(2)`MdOptInDeadline:deadlineExpiredLogoutTimer logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),d.Socket.logout()}))}}u.Proxy="mdOptInDeadline";var p=new((0,a.defineModel)(u));t.default=p},17304:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgImpl=t.Msg=void 0,t.createProductInquiry=function(e,t,r,n){const i=function(e){return new ye(e)}({ack:g.ACK.CLOCK,id:new y.default({id:"product_inquiry",remote:t,fromMe:!0}),from:t,t:b.Clock.globalUnixTime(),type:E.MSG_TYPE.PRODUCT,title:e.name,description:e.description,businessOwnerJid:t.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),body:r.preview instanceof ee.default?r.preview.getBase64():null,currencyCode:e.currency,priceAmount1000:e.priceAmount1000,salePriceAmount1000:(0,re.isSalePriceActive)(e)?e.salePriceAmount1000:null,sessionId:n});return i.mediaData.set(r),i};var i=n(r(48926)),a=n(r(23279)),o=n(r(57557)),s=n(r(45578)),l=n(r(41609)),c=n(r(39138)),d=ge(r(93131)),u=n(r(45095)),p=r(40277),f=r(27870),_=r(88156),h=r(64331),g=r(35470),m=n(r(64369)),y=n(r(65212)),E=r(15461),S=r(15411),v=n(r(89867)),T=r(11290),C=r(92115),A=r(64481),b=r(22683),P=r(88102),M=r(17239),O=r(19380),I=r(24606),w=r(24808),R=r(70449),D=n(r(96222)),N=n(r(45494)),L=r(70014),k=r(7003),G=r(99234),U=r(6901),F=n(r(53988)),x=r(7293),B=r(57701),K=(r(55981),n(r(84064))),j=n(r(7056)),Y=n(r(43725)),W=r(905),H=r(11902),V=r(10435),$=ge(r(86688)),z=ge(r(78986)),q=n(r(2320)),J=r(58668),Q=n(r(11339)),X=ge(r(54676)),Z=n(r(5165)),ee=n(r(34949)),te=r(7111),re=r(13151),ne=r(4136),ie=r(19708),ae=r(13705),oe=r(64551),se=r(31515),le=n(r(50039)),ce=r(97563),de=r(12896),ue=r(78521),pe=r(84728),fe=n(r(17072)),_e=n(r(39938));function he(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(he=function(e){return e?r:t})(e)}function ge(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=he(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class me extends T.BaseModel{constructor(){super(...arguments),this.id=(0,T.prop)(),this.rowId=(0,T.prop)(),this.body=(0,T.prop)(),this.type=(0,T.prop)(),this.subtype=(0,T.prop)(),this.t=(0,T.prop)(),this.notifyName=(0,T.prop)(),this.from=(0,T.prop)(),this.to=(0,T.prop)(),this.author=(0,T.prop)(),this.self=(0,T.prop)("in"),this.ack=(0,T.prop)(),this.invis=(0,T.prop)(),this.isNewMsg=(0,T.prop)(),this.star=(0,T.prop)(!1),this.recvFresh=(0,T.prop)(),this.caption=(0,T.prop)(),this.interactiveAnnotations=(0,T.prop)(),this.contextInfo=(0,T.prop)(),this.clientUrl=(0,T.prop)(),this.loc=(0,T.prop)(),this.lat=(0,T.prop)(),this.lng=(0,T.prop)(),this.isLive=(0,T.prop)(),this.accuracy=(0,T.prop)(),this.speed=(0,T.prop)(),this.degrees=(0,T.prop)(),this.comment=(0,T.prop)(),this.sequence=(0,T.prop)(),this.shareDuration=(0,T.prop)(),this.finalLat=(0,T.prop)(),this.finalLng=(0,T.prop)(),this.finalAccuracy=(0,T.prop)(),this.finalThumbnail=(0,T.prop)(),this.finalSpeed=(0,T.prop)(),this.finalDegrees=(0,T.prop)(),this.finalTimeOffset=(0,T.prop)(),this.deprecatedMms3Url=(0,T.prop)(),this.directPath=(0,T.prop)(),this.mimetype=(0,T.prop)(),this.duration=(0,T.prop)(),this.filehash=(0,T.prop)(),this.encFilehash=(0,T.prop)(),this.size=(0,T.prop)(),this.filename=(0,T.prop)(),this.streamingSidecar=(0,T.prop)(),this.mediaKey=(0,T.prop)(),this.mediaKeyTimestamp=(0,T.prop)(),this.pageCount=(0,T.prop)(),this.isGif=(0,T.prop)(),this.gifAttribution=(0,T.prop)(),this.isViewOnce=(0,T.prop)(),this.streamable=(0,T.prop)(),this.width=(0,T.prop)(),this.height=(0,T.prop)(),this.thumbnailDirectPath=(0,T.prop)(),this.thumbnailSha256=(0,T.prop)(),this.thumbnailEncSha256=(0,T.prop)(),this.thumbnailHeight=(0,T.prop)(),this.thumbnailWidth=(0,T.prop)(),this.waveform=(0,T.prop)(),this.staticUrl=(0,T.prop)(),this.stickerPackId=(0,T.prop)(),this.stickerPackName=(0,T.prop)(),this.stickerPackPublisher=(0,T.prop)(),this.scanLengths=(0,T.prop)(),this.scansSidecar=(0,T.prop)(),this.isFromTemplate=(0,T.prop)(!1),this.devicesAdded=(0,T.prop)(),this.devicesRemoved=(0,T.prop)(),this.isThisDeviceAdded=(0,T.prop)(),this.firstFrameLength=(0,T.prop)(),this.firstFrameSidecar=(0,T.prop)(),this.isAnimated=(0,T.prop)(),this.canonicalUrl=(0,T.prop)(),this.matchedText=(0,T.prop)(),this.thumbnail=(0,T.prop)(),this.thumbnailHQ=(0,T.prop)(),this.richPreviewType=(0,T.prop)(),this.doNotPlayInline=(0,T.prop)(),this.title=(0,T.prop)(),this.description=(0,T.prop)(),this.businessOwnerJid=(0,T.prop)(),this.productId=(0,T.prop)(),this.currencyCode=(0,T.prop)(),this.priceAmount1000=(0,T.prop)(),this.salePriceAmount1000=(0,T.prop)(),this.retailerId=(0,T.prop)(),this.url=(0,T.prop)(),this.productImageCount=(0,T.prop)(),this.sessionId=(0,T.prop)(),this.recipients=(0,T.prop)(),this.broadcast=(0,T.prop)(),this.quotedMsg=(0,T.prop)(),this.quotedStanzaID=(0,T.prop)(),this.quotedRemoteJid=(0,T.prop)(),this.quotedParticipant=(0,T.prop)(),this.quotedGroupSubject=(0,T.prop)(),this.quotedParentGroupJid=(0,T.prop)(),this.mentionedJidList=(0,T.prop)(),this.footer=(0,T.prop)(),this.hydratedButtons=(0,T.prop)(),this.buttons=(0,T.prop)(),this.selectedId=(0,T.prop)(),this.selectedIndex=(0,T.prop)(),this.multicast=(0,T.prop)(),this.urlText=(0,T.prop)(),this.urlNumber=(0,T.prop)(),this.clearMedia=(0,T.prop)(),this.isVcardOverMmsDocument=(0,T.prop)(!1),this.vcardList=(0,T.prop)(),this.vcardFormattedName=(0,T.prop)(),this.revokeSender=(0,T.prop)(),this.protocolMessageKey=(0,T.prop)(),this.futureproofBuffer=(0,T.prop)(),this.templateParams=(0,T.prop)(),this.textColor=(0,T.prop)(),this.backgroundColor=(0,T.prop)(),this.font=(0,T.prop)(),this.campaignId=(0,T.prop)(),this.campaignDuration=(0,T.prop)(),this.actionLink=(0,T.prop)(),this.statusPSAReadTimestamp=(0,T.prop)(),this.isForwarded=(0,T.prop)(!1),this.forwardingScore=(0,T.prop)(),this.labels=(0,T.prop)(),this.hasReaction=(0,T.prop)(!1),this.paymentCurrency=(0,T.prop)(),this.paymentAmount1000=(0,T.prop)(),this.paymentMessageReceiverJid=(0,T.prop)(),this.paymentTransactionTimestamp=(0,T.prop)(),this.paymentStatus=(0,T.prop)(),this.paymentTxnStatus=(0,T.prop)(),this.paymentNoteMsg=(0,T.prop)(),this.paymentRequestMessageKey=(0,T.prop)(),this.paymentExpiryTimestamp=(0,T.prop)(),this.paymentInviteServiceType=(0,T.prop)(),this.paymentBackground=(0,T.prop)(),this.ephemeralStartTimestamp=(0,T.prop)(),this.ephemeralDuration=(0,T.prop)(),this.ephemeralSettingTimestamp=(0,T.prop)(),this.ephemeralOutOfSync=(0,T.prop)(),this.ephemeralSharedSecret=(0,T.prop)(),this.disappearingModeInitiator=(0,T.prop)(),this.bizPrivacyStatus=(0,T.prop)(),this.privacyModeWhenSent=(0,T.prop)(),this.verifiedBizName=(0,T.prop)(),this.inviteCode=(0,T.prop)(),this.inviteCodeExp=(0,T.prop)(),this.inviteGrp=(0,T.prop)(),this.inviteGrpName=(0,T.prop)(),this.inviteGrpJpegThum=(0,T.prop)(),this.inviteGrpType=(0,T.prop)(),this.sellerJid=(0,T.prop)(),this.message=(0,T.prop)(),this.orderTitle=(0,T.prop)(),this.itemCount=(0,T.prop)(),this.orderId=(0,T.prop)(),this.surface=(0,T.prop)(),this.status=(0,T.prop)(),this.token=(0,T.prop)(),this.totalAmount1000=(0,T.prop)(),this.totalCurrencyCode=(0,T.prop)(),this.historySyncMetaData=(0,T.prop)(),this.mdDowngrade=(0,T.prop)(),this.isSendFailure=(0,T.prop)(),this.appStateSyncKeyShare=(0,T.prop)(),this.appStateSyncKeyRequest=(0,T.prop)(),this.appStateFatalExceptionNotification=(0,T.prop)(),this.broadcastParticipants=(0,T.prop)(),this.broadcastEphSettings=(0,T.prop)(),this.broadcastId=(0,T.prop)(),this.ctwaContext=(0,T.prop)(),this.list=(0,T.prop)(),this.listResponse=(0,T.prop)(),this.productListItemCount=(0,T.prop)(),this.productHeaderImageRejected=(0,T.prop)(!1),this.lastPlaybackProgress=(0,T.prop)(0),this.sendDeferred=(0,T.session)(),this.local=(0,T.session)(),this.search=(0,T.session)(),this.msgChunk=(0,T.session)(),this.phoneUploading=(0,T.session)(),this.startOfDay=(0,T.session)(),this.startOfDaySkew=(0,T.session)(),this._quotedMsgObj=(0,T.session)(),this.isQuotedMsgAvailable=(0,T.session)(!0),this.senderObj=(0,T.session)(),this.mediaData=(0,T.session)(),this.forwardedFromWeb=(0,T.session)(!1),this.squelch=(0,T.session)(),this.wamMessageSendPerfReporter=(0,T.session)(),this.isDynamicReplyButtonsMsg=(0,T.prop)(!1),this.dynamicReplyButtons=(0,T.prop)(),this.replyButtons=(0,T.prop)(),this.buttonsResponse=(0,T.prop)(),this.selectedButtonId=(0,T.prop)(),this.headerType=(0,T.prop)(),this.nativeFlowName=(0,T.prop)(),this.nativeFlowButtons=(0,T.prop)(),this.interactiveHeader=(0,T.prop)(),this.interactiveType=(0,T.prop)(),this.interactivePayload=(0,T.prop)(),this.reactionParentKey=(0,T.prop)(),this.reactionText=(0,T.prop)(),this.reactionTimestamp=(0,T.prop)(),this.isMdHistoryMsg=(0,T.prop)(!1),this._links=(0,T.session)((()=>[])),this._headerLinks=(0,T.session)((()=>[])),this._footerLinks=(0,T.session)((()=>[])),this.linksIndexParsed=(0,T.session)(0),this._phoneNumbers=(0,T.session)((()=>[])),this._headerPhoneNumbers=(0,T.session)((()=>[])),this._footerPhoneNumbers=(0,T.session)((()=>[])),this.phoneNumbersIndexParsed=(0,T.session)(0),this._waitForPhoneUploadPromise=(0,T.session)(),this.requiresDirectConnection=(0,T.prop)(null),this.pttForwardedFeaturesEnabled=(0,T.prop)(!1),this.chat=(0,T.derived)(this._chat),this.hasTemplateButtons=(0,T.derived)(this._hasTemplateButtons,["buttons"]),this.ephemeralExpirationTimestamp=(0,T.derived)(this._ephemeralExpirationTimestamp,["t","subtype","ephemeralStartTimestamp","ephemeralDuration"]),this.isEphemeral=(0,T.derived)(this._isEphemeral,["ephemeralDuration","type","subtype"]),this.isQuickReply=(0,T.derived)(this._isQuickReply,["buttons"]),this.isFutureproof=(0,T.derived)(this._isFutureproof,["type","subtype"]),this.isGroupMsg=(0,T.derived)(this._isGroupMsg),this.isStickerMsg=(0,T.derived)(this._isStickerMsg),this.isStatusV3=(0,T.derived)(this._isStatusV3),this.isPSA=(0,T.derived)(this._isPSA),this.isProductListMessage=(0,T.derived)(this._isProductListMessage),this.isRTL=(0,T.derived)(this._isRTL,["dir"]),this.asProductInquiry=(0,T.derived)(this._asProductInquiry),this.statusV3TextBg=(0,T.derived)(this._statusV3TextBg),this.isSentByMe=(0,T.derived)(this._isSentByMe),this.isSentByMeFromWeb=(0,T.derived)(this._isSentByMeFromWeb,["isUserCreatedType"]),this.isRevokedByMe=(0,T.derived)(this._isRevokedByMe),this.isInternational=(0,T.derived)(this._isInternational),this.isNotification=(0,T.derived)(this._isNotification,["type","subtype"]),this.asGroupNotification=(0,T.derived)(this._asGroupNotification,["type"]),this.asBroadcastNotification=(0,T.derived)(this._asBroadcastNotification,["type"]),this.isBizNotification=(0,T.derived)(this._isBizNotification,["type","subtype"]),this.asProduct=(0,T.derived)(this._asProduct,["type"]),this.asAlbumAsset=(0,T.derived)(this._asAlbumAsset,["type","isNotification","caption","isForwarded","asRevoked","isGif","quotedMsg","ctwaContext","isViewOnce"]),this.asAutoDownloadableMedia=(0,T.derived)(this._asAutoDownloadableMedia,["type"]),this.asGroupedSticker=(0,T.derived)(this._asGroupedSticker,["type","isNotification","asRevoked","quotedMsg","ctwaContext"]),this.isMedia=(0,T.derived)(this._isMedia,["type"]),this.asDoc=(0,T.derived)(this._asDoc,["type"]),this.asImage=(0,T.derived)(this._asImage,["type"]),this.asVideo=(0,T.derived)(this._asVideo,["type"]),this.asAudio=(0,T.derived)(this._asAudio,["type"]),this.asPtt=(0,T.derived)(this._asPtt,["type"]),this.asMms=(0,T.derived)(this._asMms,["type"]),this.asUrl=(0,T.derived)(this._asUrl,["type","subtype"]),this.asRevoked=(0,T.derived)(this._asRevoked,["type"]),this.asViewOnce=(0,T.derived)(this._asViewOnce,["type","isViewOnce"]),this.asVisualMedia=(0,T.derived)(this._asVisualMedia,["type"]),this.numTimesForwarded=(0,T.derived)(this._numTimesForwarded,["isForwarded","forwardingScore"]),this.isFrequentlyForwarded=(0,T.derived)(this._isFrequentlyForwarded,["numTimesForwarded"]),this.eventType=(0,T.derived)(this._eventType,["type","invis","isNewMsg"]),this.sender=(0,T.derived)(this._sender),this.text=(0,T.derived)(this._text,["type","body","caption","comment","isLive","paymentNoteMsg","subtype"]),this.containsEmoji=(0,T.derived)(this._containsEmoji,["text"]),this.isFailed=(0,T.derived)(this._isFailed,["isSentByMe","ack","mdDowngrade","isSendFailure"]),this.vcard=(0,T.derived)(this._vcard,["type","body"]),this.isUnsentMedia=(0,T.derived)(this._isUnsentMedia,["ack","asMms","isSentByMe"]),this.dir=(0,T.derived)(this._dir,["type","text","subtype"]),this.rtl=(0,T.derived)(this._rtl,["type","text","subtype"]),this.linkPreview=(0,T.derived)(this._linkPreview,["matchedText","body","title","description"]),this.isGroupsV4InviteExpired=(0,T.derived)(this._isGroupsV4InviteExpired,["type","inviteCode","inviteCodeExp"]),this.isUnreadType=(0,T.derived)(this._isUnreadType,["type"]),this.isUserCreatedType=(0,T.derived)(this._isUserCreatedType,["type"]),this.supportsMessageFooter=(0,T.derived)(this._supportsMessageFooter,["isDynamicReplyButtonsMsg","isFromTemplate"]),this.supportsMessageFooterLinks=(0,T.derived)(this._supportsMessageFooterLinks,["type","isDynamicReplyButtonsMsg"]),this.hasBodyOrFooter=(0,T.derived)(this._hasBodyOrFooter,["text","footer"]),this.initialPageSize=(0,T.derived)(this._initialPageSize,["isFrequentlyForwarded"]),this.productListHeaderImage=(0,T.derived)(this._productListHeaderImage,["productHeaderImageRejected","list"]),this.isInitialE2ENotification=(0,T.derived)(this._isInitialE2ENotification,["type","subtype"]),this.isDisappearingModeSystemMessage=(0,T.derived)(this._isDisappearingModeSystemMessage,["type","subtype"]),this.asPttLike=(0,T.derived)(this._asPttLike,["type","mimetype","pttForwardedFeaturesEnabled","waveform"]),this._saveLastPlaybackProgress=(0,a.default)(((e,t)=>{(0,ce.updateLocal)(e,{lastPlaybackProgress:t})}),500)}_chat(){return this._getChatCollection().get(this.id.remote)}_hasTemplateButtons(){return this.isFromTemplate&&null!=this.buttons&&this.buttons.length>0}_ephemeralExpirationTimestamp(){const{ephemeralDuration:e,ephemeralStartTimestamp:t,t:r,subtype:n,id:{fromMe:i}}=this;return(0,U.getEphemeralExpirationTimestamp)(e,t,r,n,i)}_isEphemeral(){return(this.type!==E.MSG_TYPE.PROTOCOL||"ephemeral_setting"!==this.subtype)&&(null!=this.ephemeralDuration&&0!==this.ephemeralDuration)}_isQuickReply(){if(!this.hasTemplateButtons)return!1;if(null==this.buttons)return!1;const e=this.buttons.at(0);return null!=e&&e.subtype===S.TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY}_isFutureproof(){return this.type===E.MSG_TYPE.UNKNOWN||this.type===E.MSG_TYPE.PAYMENT&&"futureproof"===this.subtype}_isGroupMsg(){return v.default.isGroup(this.from)||v.default.isGroup(this.to)}_isStickerMsg(){return this.type===E.MSG_TYPE.STICKER}_isStatusV3(){return v.default.isStatusV3(this.id.remote)}_isPSA(){return v.default.isPSA(this.id.remote)}_isProductListMessage(){var e;return this.type===E.MSG_TYPE.LIST&&(null===(e=this.list)||void 0===e?void 0:e.listType)===w.Message$ListMessageListType.PRODUCT_LIST}_isRTL(){return"rtl"===this.dir||void 0===this.dir&&Y.default.isRTL()}_asProductInquiry(){const e=this.safe();return e.type===E.MSG_TYPE.PRODUCT&&e.id&&e.id.id.startsWith(C.PRODUCT_INQUIRY_TYPE)?e:null}_statusV3TextBg(){if(!this.isStatusV3)return null;const e=this.backgroundColor;return e?`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&255})`:null}_isSentByMe(){return"in"!==this.id.self&&!this.isNotification&&v.default.equals(this.from,(0,G.getMaybeMeUser)())}_isSentByMeFromWeb(){return this.id.fromMe&&this.local&&this.isUserCreatedType}_isRevokedByMe(){return v.default.equals(this.revokeSender,(0,G.getMaybeMeUser)())}_isInternational(){var e;const t=this.id.fromMe?this.to.toString({legacy:!0}):this.from.toString({legacy:!0}),r=null===(e=(0,G.getMaybeMeUser)())||void 0===e?void 0:e.toString({legacy:!0});return t&&r?(0,p.phoneCC)(t)!==(0,p.phoneCC)(r):(__LOG__(3)`Msg: could not derive isInternational as some data is missing`,!1)}_isNotification(){return X.isNotification(this.type,this.subtype)}_asGroupNotification(){const e=this.safe();switch(e.type){case E.MSG_TYPE.GROUP_NOTIFICATION:case E.MSG_TYPE.GP2:return e;default:return null}}_asBroadcastNotification(){const e=this.safe();return e.type===E.MSG_TYPE.BROADCAST_NOTIFICATION?e:null}_isBizNotification(){if(this.type===E.MSG_TYPE.NOTIFICATION_TEMPLATE){if(C.BIZ_SYSTEM_MSG_SUBTYPES.includes(this.subtype))return!0;if(C.BIZ_SYSTEM_MSG_SUBTYPES_V2.includes(this.subtype))return!0;switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}}return!1}_asProduct(){const e=this.safe();return"product"===e.type?e:null}_asAlbumAsset(){const e=this.safe();return e.type!==E.MSG_TYPE.IMAGE&&(e.type!==E.MSG_TYPE.VIDEO||!0===e.isGif)||e.isNotification||e.caption||e.asRevoked||e.quotedMsg||e.ctwaContext||e.isViewOnce?null:e}_asAutoDownloadableMedia(){const e=this.safe();switch(e.type){case E.MSG_TYPE.IMAGE:case E.MSG_TYPE.STICKER:case E.MSG_TYPE.AUDIO:case E.MSG_TYPE.PTT:case E.MSG_TYPE.VIDEO:case E.MSG_TYPE.DOCUMENT:return e}return(0,X.typeIsUrl)(e)?e:null}_asGroupedSticker(){const e=this.safe();return e.type!==E.MSG_TYPE.STICKER||e.isNotification||e.asRevoked||e.quotedMsg||e.ctwaContext?null:e}_isMedia(){return["image","video","audio"].includes(this.type)}_asDoc(){const e=this.safe();return e.type===E.MSG_TYPE.DOCUMENT?e:null}_asImage(){const e=this.safe();return e.type===E.MSG_TYPE.IMAGE?e:null}_asVideo(){const e=this.safe();return e.type===E.MSG_TYPE.VIDEO?e:null}_asAudio(){const e=this.safe();return e.type===E.MSG_TYPE.AUDIO?e:null}_asPtt(){const e=this.safe();return e.type===E.MSG_TYPE.PTT?e:null}_asMms(){const e=this.safe();return(0,X.typeIsMms)(e)?e:null}_asUrl(){const e=this.safe();return(0,X.typeIsUrl)(e)?e:null}_asRevoked(){const e=this.safe();return e.type===E.MSG_TYPE.REVOKED?e:null}_asViewOnce(){const e=this.asVisualMedia;return(null==e?void 0:e.isViewOnce)?e:null}_asVisualMedia(){const e=this.safe();return e.type===E.MSG_TYPE.IMAGE||e.type===E.MSG_TYPE.VIDEO?e:null}_numTimesForwarded(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}_isFrequentlyForwarded(){return this.numTimesForwarded>=m.default.FREQUENTLY_FORWARDED_SENTINEL}_eventType(){if(!this.isNewMsg)return"i";const e=(0,X.eventTypeFromMsgType)(this);return this.invis?"i"===e?"i":"n":e}_sender(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from}_text(){var e;if(this.isFromTemplate||this.isDynamicReplyButtonsMsg)return this.type===E.MSG_TYPE.CHAT?this.body:this.caption;switch(this.type){case E.MSG_TYPE.CHAT:return this.body;case E.MSG_TYPE.IMAGE:case E.MSG_TYPE.VIDEO:return this.caption;case E.MSG_TYPE.LOCATION:return this.isLive?this.comment:void 0;case E.MSG_TYPE.PAYMENT:const{paymentNoteMsg:t}=this;return t?t.body:void 0;case E.MSG_TYPE.GROUPS_V4_INVITE:return this.comment;case E.MSG_TYPE.LIST:return null===(e=this.list)||void 0===e?void 0:e.description;case E.MSG_TYPE.PRODUCT:return(0,c.default)(this.title,{length:A.MAX_REPLY_PRODUCT_TITLE_LENGTH});case E.MSG_TYPE.HSM:case E.MSG_TYPE.TEMPLATE_BUTTON_REPLY:return this.body;case E.MSG_TYPE.INTERACTIVE:return null!=this.nativeFlowName?(0,L.formatNFMText)(this):this.caption;case E.MSG_TYPE.NATIVE_FLOW:return(0,L.formatNFMText)(this);default:return}}_containsEmoji(){const{text:e}=this;return!!e&&R.EmojiUtil.containsEmoji(e)}_isFailed(){const e=this.isSentByMe&&this.ack<g.ACK.CLOCK;return x.GK.supportsFeature(x.GK.F.MD_BACKEND)?e||!!this.mdDowngrade||!!this.isSendFailure:e}_vcard(){if(this.type===E.MSG_TYPE.VCARD)try{return(0,ue.parseVcard)(this.body)}catch(e){return}}_isUnsentMedia(){return this.ack<g.ACK.SENT&&null!=this.asMms&&this.isSentByMe}_dir(){return this.type===E.MSG_TYPE.VCARD?this.subtype?d.dir(this.subtype):void 0:this.text?d.dir(this.text):void 0}_rtl(){return this.type===E.MSG_TYPE.VCARD?!!this.subtype&&"rtl"===d.dir(this.subtype):!!this.text&&"rtl"===d.dir(this.text)}_linkPreview(){return(0,se.isString)(this.matchedText)&&(!(0,l.default)(this.title)||!(0,l.default)(this.description))&&this.body.includes(this.matchedText)}_isGroupsV4InviteExpired(){if(this.type!==E.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(!this.inviteCode)return!0;const e=(new Date).getTime()/1e3;return parseInt(e,10)>=parseInt(this.inviteCodeExp,10)}_isUnreadType(){return(0,de.isUnreadTypeMsg)(this)}_isUserCreatedType(){return[E.MSG_TYPE.PROTOCOL,E.MSG_TYPE.CHAT,E.MSG_TYPE.LOCATION,E.MSG_TYPE.VCARD,E.MSG_TYPE.MULTI_VCARD,E.MSG_TYPE.IMAGE,E.MSG_TYPE.VIDEO,E.MSG_TYPE.AUDIO,E.MSG_TYPE.PTT,E.MSG_TYPE.DOCUMENT,E.MSG_TYPE.STICKER,E.MSG_TYPE.PRODUCT,E.MSG_TYPE.GROUPS_V4_INVITE,E.MSG_TYPE.ORDER].includes(this.type)}_supportsMessageFooter(){return this.isFromTemplate||this.isDynamicReplyButtonsMsg}_supportsMessageFooterLinks(){return this.isDynamicReplyButtonsMsg||this.type===E.MSG_TYPE.LIST||this.type===E.MSG_TYPE.INTERACTIVE}_hasBodyOrFooter(){return null!=this.text||null!=this.footer}_initialPageSize(){return this.isFrequentlyForwarded?308:768}_productListHeaderImage(){var e,t,r,n;return!0===this.productHeaderImageRejected?null:null!==(e=null===(t=this.list)||void 0===t||null===(r=t.productListInfo)||void 0===r||null===(n=r.headerImage)||void 0===n?void 0:n.jpegThumbnail)&&void 0!==e?e:null}_isInitialE2ENotification(){return this.type===E.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===this.subtype||C.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT.includes(this.subtype)}_isDisappearingModeSystemMessage(){return this.type===E.MSG_TYPE.NOTIFICATION_TEMPLATE&&"disappearing_mode"===this.subtype}_asPttLike(){const e=this.safe();return e.type===E.MSG_TYPE.PTT||e.pttForwardedFeaturesEnabled&&e.type===E.MSG_TYPE.AUDIO&&(0,j.default)(e.mimetype)&&null!=e.waveform?e:null}initialize(){if(super.initialize(),this.pttForwardedFeaturesEnabled=oe.ServerProps.pttForwardedFeaturesEnabled,this._pendingAckUpdate=new f.PromiseQueue,this.sender)this.addChild("senderObj",O.ContactCollection.gadd(this.sender));else switch(this.type){case E.MSG_TYPE.NOTIFICATION:case E.MSG_TYPE.NOTIFICATION_TEMPLATE:case E.MSG_TYPE.GROUP_NOTIFICATION:case E.MSG_TYPE.GP2:case E.MSG_TYPE.BROADCAST_NOTIFICATION:case E.MSG_TYPE.E2E_NOTIFICATION:case E.MSG_TYPE.CALL_LOG:case E.MSG_TYPE.PROTOCOL:break;default:__LOG__(2)`msg:msg with no sender id:${this.id.toString()}, from:${this.from.toString()}, author:${this.author&&this.author.toString()}, type:${this.type}`}let e;this.mentionedJidList=this.mentionedJidList||[],this.mentionedJidList.forEach((e=>O.ContactCollection.gadd(e)));const t=this.getCollection();(e=t.preAck[this.id])&&(__LOG__(2)`Msg:initialize updating msg with out of order ack`,this.updateAck(e.ack,e.t),delete t.preAck[this.id]),this.type===E.MSG_TYPE.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this.mediaObject=void 0,X.typeIsMms(this)&&(this._createMediaDataChild(),this.isViewOnce&&!(0,pe.isUnviewed)(this.safe())||z.registerMsg(this)),this.isSentByMeFromWeb&&(this.sendDeferred=new _.Resolvable,this.sendDeferred.promise.finally((()=>{this.sendDeferred=null}))),this.isLive&&r(85865).LiveLocationCollection.processMsg(this,!1),M.Conn.isSMB&&(0,W.initializeLabels)(this),this.isViewOnce&&(this.listenTo(this,"change:ack",this.onViewOnceMediaStatusChanged),this.listenTo(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged))}_getLinks(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const r=(0,h.firstNCodepoints)(e,t);let n=$.findLinks(r,false,this.sender);if((0,h.numCodepoints)(e)>t&&n.length>0){const i=n[n.length-1];(0,h.numCodepoints)(r.slice(0,i.index))+(0,h.numCodepoints)(i.url)===t&&(n=$.findLinks(e,false,this.sender))}return[n,t]}_getPhoneNumbers(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const r=(0,h.firstNCodepoints)(e,t);let n=(0,N.default)(r);if((0,h.numCodepoints)(e)>t&&n.length>0){const i=n[n.length-1];(0,h.numCodepoints)(r.slice(0,i.index))+(0,h.numCodepoints)(i.phone)===t&&(n=(0,N.default)(e))}return[n,t]}getLinks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;const{text:t}=this;if(null==t)return this._links;const[r,n]=this._getLinks(t,this._links,this.linksIndexParsed,e);return this.linksIndexParsed=n,this._links=r}_displayHeaderLinksForListMessages(){var e,t;return"list"===this.type&&(null===(e=this.list)||void 0===e?void 0:e.listType)===w.Message$ListMessageListType.SINGLE_SELECT&&null!=(null===(t=this.list)||void 0===t?void 0:t.title)}_displayHeaderLinksForNonListMessages(){return!0===this.isDynamicReplyButtonsMsg&&null!=this.title}_getHeaderLinks(e){if(this._headerLinks.length>0)return this._headerLinks;const[t]=this._getLinks(e,this._headerLinks);return this._headerLinks=t}getHeaderLinks(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderLinks((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderLinks(this.title):this.type===E.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderLinks(this.interactiveHeader.title):[]}getFooterLinks(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerLinks.length>0)return this._footerLinks;const[e]=this._getLinks(this.footer,this._footerLinks);return this._footerLinks=e}getGalleryLinks(){return(0,s.default)(this.getLinks(),"href").filter((e=>e.isHttp))}getSuspiciousLinks(){return this.getLinks().filter((e=>{var t;return null===(t=e.suspiciousCharacters)||void 0===t?void 0:t.size}))}getPhoneNumbers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;if(!(0,B.hyperlinkedPhoneNumbersEnabled)())return[];const{text:t}=this;if(null==t)return this._phoneNumbers;const[r,n]=this._getPhoneNumbers(t,this._phoneNumbers,this.phoneNumbersIndexParsed,e);return this.phoneNumbersIndexParsed=n,this._phoneNumbers=r}_getHeaderPhoneNumbers(e){if(this._headerPhoneNumbers.length>0)return this._headerPhoneNumbers;const[t]=this._getPhoneNumbers(e,this._headerPhoneNumbers);return this._headerPhoneNumbers=t}getHeaderPhoneNumbers(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderPhoneNumbers((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderPhoneNumbers(this.title):this.type===E.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderPhoneNumbers(this.interactiveHeader.title):[]}getFooterPhoneNumbers(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerPhoneNumbers.length>0)return this._footerPhoneNumbers;const[e]=this._getPhoneNumbers(this.footer,this._footerPhoneNumbers);return this._footerPhoneNumbers=e}_createMediaDataChild(){this.addChild("mediaData",new q.default)}hasSymbol(){return this.type===E.MSG_TYPE.INTERACTIVE?this.interactiveType===K.default.SHOPS_STOREFRONT||this.interactiveType===K.default.NATIVE_FLOW&&this.nativeFlowName===Z.default.ORDER_DETAILS:["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","groups_v4_invite","product","order"].includes(this.type)}mayFail(){return this.isSentByMe&&this.ack<g.ACK.SENT}isUnsentPhoneMsg(){return!this.local&&this.isSentByMe&&this.ack<g.ACK.SENT}canReply(){return!(this.type===E.MSG_TYPE.LIST&&!(0,X.listMsgCanRender)(this))&&(this.chat.canSend&&!this.mayFail()&&!this.isNotification&&!this.chat.isSuspendedGroup()&&this.type!==E.MSG_TYPE.UNKNOWN&&this.type!==E.MSG_TYPE.CIPHERTEXT&&this.type!==E.MSG_TYPE.OVERSIZED&&this.type!==E.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased())}canPrivateReply(){return!this.mayFail()&&!this.isNotification&&this.type!==E.MSG_TYPE.UNKNOWN&&this.type!==E.MSG_TYPE.CIPHERTEXT&&this.type!==E.MSG_TYPE.OVERSIZED&&this.type!==E.MSG_TYPE.REVOKED&&!this.isSentByMe&&this.isGroupMsg&&this.interactiveButtonsReleased()}canPrivateReplyInRestrictedGrp(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==E.MSG_TYPE.UNKNOWN&&this.type!==E.MSG_TYPE.CIPHERTEXT&&this.type!==E.MSG_TYPE.OVERSIZED&&this.type!==E.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased()}canForward(){var e,t;if(this.type===E.MSG_TYPE.CIPHERTEXT)return!1;if(this.type===E.MSG_TYPE.OVERSIZED)return!1;if(this.type===E.MSG_TYPE.REVOKED)return!1;if(this.type===E.MSG_TYPE.UNKNOWN)return!1;if(this.type===E.MSG_TYPE.PAYMENT)return!1;if(this.type===E.MSG_TYPE.LIST)return(null===(e=this.list)||void 0===e?void 0:e.listType)===w.Message$ListMessageListType.PRODUCT_LIST&&(0,X.listMsgCanRender)(this);if(this.type===E.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(this.type===E.MSG_TYPE.LOCATION&&this.isLive)return!1;if(this.type===E.MSG_TYPE.ORDER)return!1;if(this.type===E.MSG_TYPE.INTERACTIVE&&null!=this.nativeFlowName)return!1;if(!this.interactiveButtonsReleased())return!1;if(this.ack<g.ACK.SENT&&this.isSentByMe)return!1;if(this.asMms){const e=this.mediaData;if(e.mediaStage===J.MEDIA_DATA_STAGE.EXISTS)return!0;if(e.mediaStage===J.MEDIA_DATA_STAGE.ERROR_MISSING)return!1;if(e.mediaStage===J.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED)return!1;if(e.mediaStage!==J.MEDIA_DATA_STAGE.RESOLVED&&(this.type===E.MSG_TYPE.IMAGE||this.type===E.MSG_TYPE.VIDEO||this.type===E.MSG_TYPE.PTT))return!1;if(this.isViewOnce)return!1;if(this.isUnsentMedia)return!1}return!(null===(t=this.nativeFlowButtons)||void 0===t?void 0:t.length)}canQuickForward(){return!(!this.canForward()||this.isFrequentlyForwarded||0!==this.getSuspiciousLinks().length||null!=this.asPttLike||this.type===E.MSG_TYPE.STICKER||!this.interactiveButtonsReleased())&&(null!=this.asMms||this.linkPreview||this.type===E.MSG_TYPE.VCARD||this.type===E.MSG_TYPE.LOCATION||null!=this.ctwaContext)}canStar(){return!(this.type===E.MSG_TYPE.LIST&&!(0,X.listMsgCanRender)(this))&&(!this.isNotification&&!this.isFutureproof&&!this.isViewOnce&&this.type!==E.MSG_TYPE.REVOKED&&!(this.ack<g.ACK.SENT&&this.isSentByMe)&&this.interactiveButtonsReleased())}interactiveButtonsReleased(){return this.isFromTemplate||!this.hasTemplateButtons&&this.type!==E.MSG_TYPE.TEMPLATE_BUTTON_REPLY}isGroupLeave(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&v.default.equals(this.recipients[0],(0,G.getMaybeMeUser)())}isTrusted(){var e;return!!v.default.equals(this.sender,(0,G.getMaybeMeUser)())||(!!(null===(e=this.senderObj)||void 0===e?void 0:e.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():this.chat.notSpam))}getVcardWids(){return this.type!==E.MSG_TYPE.VCARD?null:(0,ue.vcardWids)(this.vcard)}getLocObject(){const e=this.loc;if(e){const[t,r=null]=e.split("\n");return{name:t,addr:r}}return null}resumeRemoteUpload(){return this.isUnsentPhoneMsg()&&!this.phoneUploading&&((0,ie.sendMsgRecord)(this).then((e=>{e!==ae.SendMsgResult.OK&&(this.phoneUploading=!1)})),this.phoneUploading=!0),this.forceDownloadMediaEvenIfExpensive()}forceRMR(){return Promise.reject(new Error("unimplemented forceRMR"))}isForcingRMR(){return!1}cancelDownload(){z.cancelDownloadMsg(this)}resumeUpload(){return this.mediaData.mediaStage!==J.MEDIA_DATA_STAGE.NEED_UPLOAD&&(__LOG__(4,void 0,new Error,!0)`resumeUpload called while state was ${this.mediaData.mediaStage}`,SEND_LOGS("resume-non-need-upload")),z.resumeUploadMsg(this)}cancelUpload(){z.cancelUploadMsg(this)}waitForPhoneUpload(){var e=this;return(0,i.default)((function*(){Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()||(e._waitForPhoneUploadPromise||(e._waitForPhoneUploadPromise=(0,fe.default)(e.mediaData,"change:mediaStage change:filehash",(()=>Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()))),yield e._waitForPhoneUploadPromise,e._waitForPhoneUploadPromise=null)}))()}forceDownloadMediaEvenIfExpensive(){return this.downloadMedia({downloadEvenIfExpensive:!0,rmrReason:Q.default.WEBC_RMR_REASON_CODE.MSG_CLICK,isUserInitiated:!0})}downloadMedia(e){if(this.asRevoked)return Promise.resolve();const{downloadEvenIfExpensive:t,rmrReason:r,isUserInitiated:n,isAutoDownload:i}=e;if(this.asMms||(__LOG__(4,void 0,new Error,!0)`id: ${this.id.toString()} type: ${this.type}`,SEND_LOGS("media-fault: downloadMedia msg is not mms type")),this.isUnsentPhoneMsg()){let t=this._waitForPhoneUploadPromise;return t||(t=this._waitForPhoneUploadPromise=(0,fe.default)(this.mediaData,"change:mediaStage change:filehash",(()=>!!this.mediaData.filehash&&!this.isUnsentPhoneMsg())).then((()=>{this._waitForPhoneUploadPromise=null}))),t.then((()=>this.downloadMedia(e)))}return z.downloadMsg({msg:this,isUserClick:r===Q.default.WEBC_RMR_REASON_CODE.MSG_CLICK,downloadEvenIfExpensive:t,rmrReason:r,rmrData:this._getRmrData(r),mode:n?"manual":"auto",isAutoDownload:i})}_getRmrData(e){const t={webcRmrReason:e,webcMessageT:this.t},r=this.chat;if(r){t.webcChatType=r.getWebcChatType(),null!=r.initialIndex&&(t.webcChatPosition=r.initialIndex);const{msgChunk:e}=this;e&&e===r.msgs&&(t.webcMessageIndex=e.length-e.indexOf(this)-1)}return t}applyUpdate(e){if(e.type&&this.type!==e.type&&X.typeIsMms(e))return this.type!==E.MSG_TYPE.CIPHERTEXT&&(__LOG__(4,void 0,new Error,!0)`updated ${this.id.toString()} from ${this.type} to ${String(e.type)}`,SEND_LOGS("invalid-type-update")),this._createMediaDataChild(),z.registerMsgEarly(this,e),z.prepareMsg(this).then((()=>{this.set(e)})).catch((e=>{__LOG__(4,void 0,new Error,!0)`error = ${String(e)}`,SEND_LOGS("preregister-error")}));if(this.set(e),this.isLive&&r(85865).LiveLocationCollection.processMsg(this,!0),this.paymentTransactionTimestamp){this.getCollection().updateLastTransactionTime(this.id.remote,this.paymentTransactionTimestamp)}return Promise.resolve()}waitForPrep(){var e=this;return(0,i.default)((function*(){var t;const r=null==e.requiresDirectConnection?(0,k.genDirectConnectionMessageModifiers)(e.type,null===(t=e.list)||void 0===t?void 0:t.listType,e.businessOwnerJid).then((t=>e.set(t))):Promise.resolve(),n=X.typeIsMms(e)?z.prepareMsg(e):Promise.resolve();return yield r,n}))()}delete(e){super.delete();r(19011).AllStarredMsgsCollection.remove(this),this.isLive&&r(85865).LiveLocationCollection.removeMsg(this);this.getCollection().remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id,{},Boolean(null==e?void 0:e.skipUpdatingSortTime)),X.typeIsMms(this)&&z.deregisterMsg(this),r(16770).LabelCollection.removeAllLabelsMD(this);const t=this._getChatCollection().get(this.id.remote);if(t){t.unreadMsgAnchor===this&&(t.unreadMsgAnchor=void 0);if((!e||!e.doNotResetLastReceived)&&t.lastReceivedKey===this.id){let e;const r=t.getLastReceivedMsg();r&&(e=r.id),(0,H.setLastReceivedKey)(t.id,e).then((()=>{t.lastReceivedKey=e}))}t.composeQuotedMsg===this&&(t.composeQuotedMsg=null)}}isLastMessage(){const e=this.chat.msgs.last();return this.id.equals(null==e?void 0:e.id)}quotedMsgObj(){if(!this.quotedMsg&&!this.paymentRequestMessageKey)return null;if(this._quotedMsgObj){const e=this.getCollection();return X.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}if(this.quotedMsg)this._quotedMsgObj=this._getQuotedMsgObj();else{if(!this.paymentRequestMessageKey)return null;this._quotedMsgObj=this._getQuotedPaymentRequestMsg()}const e=this.getCollection();return X.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}_getQuotedMsgObj(){const e=(0,G.getMaybeMeUser)(),t=!this.quotedParticipant||v.default.equals(this.quotedParticipant,e),r=t?"out":"in",n=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,i={id:this.quotedStanzaID,from:t?e:n,to:t?n:e,self:r,author:(0,u.default)(this.quotedParticipant,"this.quotedParticipant"),remote:n};return!(v.default.isGroup(i.from)||v.default.isGroup(i.to))&&!v.default.isStatusV3(n)||v.default.equals(e,this.quotedParticipant)&&!x.GK.supportsFeature(x.GK.F.MD_BACKEND)||(i.participant=(0,u.default)(this.quotedParticipant,"this.quotedParticipant")),Object.assign(i,this.quotedMsg),X.createQuotedMsg(i)}_getQuotedPaymentRequestMsg(){if(!this.paymentRequestMessageKey)return null;const e=this.paymentRequestMessageKey.remote?this.paymentRequestMessageKey.remote:this.id.remote,t=this.paymentRequestMessageKey.fromMe,r=null!=this.paymentRequestMessageKey.self?this.paymentRequestMessageKey.self:t?"out":"in",n=this.paymentRequestMessageKey.participant||this.paymentMessageReceiverJid,i={id:this.paymentRequestMessageKey.id,from:t?(0,G.getMaybeMeUser)():e,to:t?e:(0,G.getMaybeMeUser)(),self:r,participant:n,author:n,remote:e,amount1000:this.paymentAmount1000,currency:this.paymentCurrency,receiverJid:this.sender,type:this.type,subtype:"request"};return X.createQuotedMsg(i)}getQuotedMsgAdminGroupJid(){return null==this.quotedMsg?this.quotedRemoteJid:null}getQuotedMsgAdminGroupSubject(){return null==this.quotedMsg?this.quotedGroupSubject:null}getQuotedMsgAdminParentGroupJid(){return null==this.quotedMsg?this.quotedParentGroupJid:null}msgContextInfo(e){const t=(0,o.default)(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast","replyButtons","buttons"]);let r=null;return e&&!this.id.remote.equals(e)&&(r=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:r}}displayName(e,t){if(!this.sender)return"";if(this.sender.equals((0,G.getMaybeMeUser)()))return Y.default.t(1020);const r=this.senderObj,n=e?r.shortName:void 0;if(n)return n;if(r.name)return r.name;const i=t&&this.notifyName?" ~"+this.notifyName:"";return(0,_e.default)(this.sender)+i}isQuoted(e){const t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}isMentioned(e){return!!this.mentionedJidList&&this.mentionedJidList.findIndex((t=>t.equals(e)))>-1}mentionMap(){if(!this.mentionedJidList)return null;if(!this.mentionedJidList.length)return null;const e={};return this.mentionedJidList.forEach((t=>{e[`@${v.default.user(t)||""}`]=O.ContactCollection.gadd(t)})),e}updateAck(e,t){const r=this.ack;x.GK.supportsFeature(x.GK.F.MD_BACKEND)&&!this.isStatusV3&&this.chat.isGroup&&this.isMdHistoryMsg&&e>=g.ACK.RECEIVED&&this.id.fromMe||((0,se.isNumber)(e)&&(void 0===r||e>r||e===g.ACK.FAILED)?(this.ack=e,e>=1&&null!=t&&null==this.ephemeralStartTimestamp&&this.updateEphemeralStartTimestamp(t),"ephemeral_setting"===this.subtype&&1===e&&null!=t&&(0,le.default)(this.chat,t),this._pendingAckUpdate.enqueue((()=>(0,ce.updateLocal)(this.id,{ack:e})))):e===g.ACK.FAILED&&this.ack===g.ACK.CLOCK&&(this.ack=g.ACK.FAILED,this.phoneUploading=!1,this._pendingAckUpdate.enqueue((()=>(0,ce.updateLocal)(this.id,{ack:e})))))}updateLastPlaybackProgress(e){this.lastPlaybackProgress=e,this._saveLastPlaybackProgress(this.id,e)}avParams(){return z.mediaMetadata(this)}resend(){var e=this;if(this.isFailed){const t={ack:g.ACK.CLOCK};return x.GK.supportsFeature(x.GK.F.MD_BACKEND)&&(t.isSendFailure=!1,t.mdDowngrade=!1),this._pendingAckUpdate.enqueue((0,i.default)((function*(){yield(0,ce.updateLocal)(e.id,t),e.set(t)}))),this.asMms?this.isSentByMeFromWeb?this.resumeUpload():this.resumeRemoteUpload():(0,ie.sendMsgRecord)(this)}return Promise.resolve()}onCiphertextDecrypted(){if(this.isStatusV3)return;const e=this.chat,t=e.msgs.length,r=e.msgs.indexOf(this);-1!==r&&t-r<=10&&P.Cmd.alertNewMsg(this)}onViewOnceMediaStatusChanged(){if(!this.isViewOnce)return;if(null==this.mediaData)return;const e=this.isSentByMe&&this.ack>=g.ACK.SENT&&this.mediaData.mediaStage===J.MEDIA_DATA_STAGE.RESOLVED,t=!this.isSentByMe&&this.ack>=g.ACK.PLAYED;(e||t)&&(this.stopListening(this,"change:ack",this.onViewOnceMediaStatusChanged),this.stopListening(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged),z.deregisterMsg(this))}_canRevoke(){var e;return!(this.chat.isGroup&&!(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmMember()))&&(this.isUserCreatedType&&(!v.default.isBroadcast(this.id.remote)||"iphone"===M.Conn.platform)&&!this.broadcast&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia&&!this.chat.isSuspendedGroup())}canSenderRevoke(){const e=(0,V.isSenderRevokeWindowSenderEnabled)()?ne.REVOKE_WINDOW_V2:ne.REVOKE_WINDOW,t=Math.trunc(+new Date/1e3)-this.t<=e;return this._canRevoke()&&this.id.fromMe&&t}canAdminRevoke(){var e;const t=Math.trunc(+new Date/1e3)-this.t<=ne.REVOKE_WINDOW_V2;return(0,B.adminRevokeSenderEnabled)()&&this._canRevoke()&&!this.id.fromMe&&Boolean(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmAdmin())&&t}getWamDisappearingModeInitiator(){const e=this.disappearingModeInitiator;if(null==e)return null;switch(e){case I.DisappearingModeInitiator.InitiatedByMe:return Q.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_ME;case I.DisappearingModeInitiator.InitiatedByOther:return Q.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_OTHER;case I.DisappearingModeInitiator.ChangedInChat:return Q.default.DISAPPEARING_CHAT_INITIATOR_TYPE.CHAT}}getWamMessageType(){return this.isStatusV3?Q.default.MESSAGE_TYPE.STATUS:this.isGroupMsg?Q.default.MESSAGE_TYPE.GROUP:v.default.isBroadcast(this.id.remote)?Q.default.MESSAGE_TYPE.BROADCAST:Q.default.MESSAGE_TYPE.INDIVIDUAL}getWamMediaType(){var e,t;if(!0===this.isDynamicReplyButtonsMsg)return Q.default.MEDIA_TYPE.BUTTON_MESSAGE;switch(this.type){case E.MSG_TYPE.IMAGE:return Q.default.MEDIA_TYPE.PHOTO;case E.MSG_TYPE.VIDEO:return this.mediaData.isGif?Q.default.MEDIA_TYPE.GIF:Q.default.MEDIA_TYPE.VIDEO;case E.MSG_TYPE.AUDIO:return Q.default.MEDIA_TYPE.AUDIO;case E.MSG_TYPE.PTT:return Q.default.MEDIA_TYPE.PTT;case E.MSG_TYPE.DOCUMENT:return Q.default.MEDIA_TYPE.DOCUMENT;case E.MSG_TYPE.UNKNOWN:return Q.default.MEDIA_TYPE.FUTURE;case E.MSG_TYPE.LOCATION:return this.isLive?Q.default.MEDIA_TYPE.LIVE_LOCATION:Q.default.MEDIA_TYPE.LOCATION;case E.MSG_TYPE.VCARD:return Q.default.MEDIA_TYPE.CONTACT;case E.MSG_TYPE.MULTI_VCARD:return Q.default.MEDIA_TYPE.CONTACT_ARRAY;case E.MSG_TYPE.CHAT:return this.linkPreview?(0,te.matchCatalogUrl)(this.matchedText)?Q.default.MEDIA_TYPE.CATALOG_LINK:(0,te.matchProductUrl)(this.matchedText)?Q.default.MEDIA_TYPE.PRODUCT_LINK:Q.default.MEDIA_TYPE.URL:Q.default.MEDIA_TYPE.NONE;case E.MSG_TYPE.STICKER:return Q.default.MEDIA_TYPE.STICKER;case E.MSG_TYPE.PRODUCT:return Q.default.MEDIA_TYPE.PRODUCT_IMAGE;case E.MSG_TYPE.LIST:switch(null!==(e=null===(t=this.list)||void 0===t?void 0:t.listType)&&void 0!==e?e:w.Message$ListMessageListType.UNKNOWN){case w.Message$ListMessageListType.SINGLE_SELECT:return Q.default.MEDIA_TYPE.LIST;case w.Message$ListMessageListType.PRODUCT_LIST:return Q.default.MEDIA_TYPE.PRODUCT_LIST;default:return Q.default.MEDIA_TYPE.NONE}case E.MSG_TYPE.LIST_RESPONSE:return Q.default.MEDIA_TYPE.LIST_REPLY;case E.MSG_TYPE.BUTTONS_RESPONSE:return Q.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case E.MSG_TYPE.ORDER:return Q.default.MEDIA_TYPE.ORDER;case E.MSG_TYPE.INTERACTIVE:return(0,F.default)(this.interactiveType);case E.MSG_TYPE.REACTION:return Q.default.MEDIA_TYPE.REACTION;default:return Q.default.MEDIA_TYPE.NONE}}getForwardingScoreWhenForwarded(){const e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=oe.ServerProps.frequentlyForwardedThreshold?m.default.FREQUENTLY_FORWARDED_SENTINEL:e}updateEphemeralStartTimestamp(e){var t=this;return(0,i.default)((function*(){yield(0,ce.updateLocal)(t.id,{ephemeralStartTimestamp:e}),t.ephemeralStartTimestamp=e}))()}isExpired(){return null!=this.ephemeralExpirationTimestamp&&this.ephemeralExpirationTimestamp<=b.Clock.globalUnixTime()}timeUntilExpiration(){const e=this.ephemeralExpirationTimestamp;return null==e?null:this.isExpired()?0:e-b.Clock.globalUnixTime()}_logStorageEstimate(e){return(0,i.default)((function*(){const t=yield(0,D.default)();t&&(e.webcBrowserStorageQuotaBytes=t.quota,e.webcBrowserStorageQuotaUsedBytes=t.usage)}))()}getCollection(){return r(59871).MsgCollection}_getChatCollection(){return r(69951).ChatCollection}isDownloadable(){var e;return!this.asRevoked&&(!this.isViewOnce&&(this.type===E.MSG_TYPE.VCARD||this.type===E.MSG_TYPE.MULTI_VCARD||!!(null===(e=this.mediaData)||void 0===e?void 0:e.isDownloadable())&&this.type!==E.MSG_TYPE.STICKER))}safe(){return this}unsafe(){return this}}t.MsgImpl=me,me.Proxy="msg",me.idClass=y.default;const ye=(0,T.defineModel)(me);t.Msg=ye},52846:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(65212)),a=r(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.unsyncedButtonReplies=(0,a.prop)()}}o.Proxy="msgButtonReplyMsg",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},81037:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=n(r(52846));class o extends i.BaseCollection{}t.default=o,o.model=a.default},59871:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgCollectionImpl=t.MsgCollection=t.MEDIA_QUERY_LIMIT=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(50796),s=n(r(45095)),l=r(67602),c=r(13042),d=n(r(65212)),u=r(15461),p=n(r(89867)),f=r(45454),_=r(29984),h=r(1255),g=r(24808),m=r(76581),y=r(80872),E=r(99234),S=r(7293),v=r(17304),T=n(r(81037)),C=r(17780),A=r(64551),b=(r(30152),r(62583)),P=n(r(86500)),M=r(31515),O=n(r(17072)),I=n(r(56891)),w=r(77591),R=r(65044);t.MEDIA_QUERY_LIMIT=50;class D extends h.BaseCollection{constructor(){super(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.productListMessagesPrefetchChain=Promise.resolve([]),this.onSearchTag=e=>{this.pendingSearchTag=e},this.listenTo(A.ServerProps,"change:pttForwardedFeaturesEnabled",(()=>{this.forEach((e=>{"ptt"!==e.type&&"audio"!==e.type||(e.pttForwardedFeaturesEnabled=A.ServerProps.pttForwardedFeaturesEnabled)}))})),this.listenTo(R.Socket,"change:stream",(function(){R.Socket.stream===b.SOCKET_STREAM.DISCONNECTED&&(this.preAck={})})),this.listenTo(this,"remove",this.removeFromCollection)}removeFromCollection(e){e.chat&&e.chat.removeFromCollection(e)}_findQuery(e,t){var n=this;return(0,a.default)((function*(){const i=n;let a;switch(e.direction){case"before":case"after":a=e.direction;break;default:a="before"}const o={add:a,isHistory:!0},s=yield(0,m.msgFindQuery)(a,e,t,void 0);return s.status>=400?(__LOG__(3)`model:Msg:findQuery error ${s.status}`,Promise.reject(s.status)):(s.forEach((function(e){e.invis=!0})),__LOG__(2)`model:Msg:findQuery:got:${s.length}:${e.direction}`,i.processMultipleMessages(e.remote,s,o,(function(){const t=i.get(e),n=r(69951).ChatCollection.get(e.remote);return t?t.msgChunk:n?n.msgs:void 0})))}))()}add(e,t){const r=(Array.isArray(e)?e:[e]).filter((e=>{if(null==e.ephemeralDuration||0===e.ephemeralDuration)return!0;return!new v.Msg(e).isExpired()})),n=super.add(r,t);return this._syncTemplateButtonClickState(n),this._syncQuickReplyButtonClickState(n),this._prefetchProductListMessages(n),n}_prefetchProductListMessages(e){const t=r(18952).ProductMessageListCollection;this.productListMessagesPrefetchChain=e.filter((e=>{var t,r;return null!=e&&e.isNewMsg&&e.type===u.MSG_TYPE.LIST&&(null===(t=e.list)||void 0===t?void 0:t.listType)===g.Message$ListMessageListType.PRODUCT_LIST&&null!=(null===(r=e.list)||void 0===r?void 0:r.productListInfo)})).reduce(((e,r)=>{var n,i;if(null==r)return e;const a=r.requiresDirectConnection,o=r.isForwarded?r.businessOwnerJid:r.from.toString({legacy:!0}),s=null===(n=r.list)||void 0===n?void 0:n.productListInfo;if(null==o||null==s)return e;const l=t.getOrAdd(r.id,s,a,o,null===(i=r.list)||void 0===i?void 0:i.title);return null==l||0!==l.productCollection.getModelsArray().length||l.isFetching()?e:e.then((()=>t.update(l.id)))}),this.productListMessagesPrefetchChain)}_syncTemplateButtonClickState(e){for(let t=0;t<e.length;t++){const r=e[t];if(!r)continue;const n=r.chat;if(r.type===u.MSG_TYPE.TEMPLATE_BUTTON_REPLY&&null!=r.selectedIndex&&r.sender.equals((0,E.getMaybeMeUser)())){null==n.msgUnsyncedButtonReplyMsgs&&(n.msgUnsyncedButtonReplyMsgs=new T.default);const{msgUnsyncedButtonReplyMsgs:e}=n,t=r.quotedMsgObj();if(!t)continue;let i=e.get(t.id);i||(e.add({id:t.id,unsyncedButtonReplies:new P.default}),i=e.get(t.id));const{unsyncedButtonReplies:a}=(0,s.default)(i,"buttonReplyMsg");a.add(r);const o=this.get(t.id);if(null==o?void 0:o.buttons){const e=o.buttons.get(`${(0,s.default)(r.selectedIndex,"msg.selectedIndex")}`);e&&(e.selected=!0),a.remove(r)}}else if(r.isFromTemplate&&r.buttons){const{msgUnsyncedButtonReplyMsgs:e}=n;if(null==e)continue;const t=e.get(r.id);t&&(t.unsyncedButtonReplies.forEach((e=>{const t=(0,s.default)(r.buttons,"msg.buttons").get(`${(0,s.default)(e.selectedIndex,"replyMsg.selectedIndex")}`);t&&(t.selected=!0)})),t.unsyncedButtonReplies.delete())}}}_syncQuickReplyButtonClickState(e){for(let t=0;t<e.length;t++){const r=e[t];if(r)if(r.type===u.MSG_TYPE.BUTTONS_RESPONSE&&null!=r.selectedButtonId&&r.sender.equals((0,E.getMaybeMeUser)())){const e=r.quotedMsgObj();if(!e)continue;const t=this.get(e.id);if(null==t?void 0:t.replyButtons){const e=t.replyButtons.get(r.selectedButtonId);e&&(e.selected=!0)}}else if(r.isDynamicReplyButtonsMsg&&r.replyButtons&&r.replyButtons.every((e=>!e.selected))&&r.chat){const e=Math.max(0,r.chat.msgs.models.length-1e3);r.chat.msgs.getModelsArray().slice(e).filter((e=>{var t;return e.type===u.MSG_TYPE.BUTTONS_RESPONSE&&null!=e.selectedButtonId&&e.sender.equals((0,E.getMaybeMeUser)())&&(null===(t=e.quotedMsgObj())||void 0===t?void 0:t.id.toString())===r.id.toString()})).map((e=>{let{selectedButtonId:t}=e;return t})).forEach((e=>{var t;const n=null===(t=r.replyButtons)||void 0===t?void 0:t.get(e);null!=n&&(n.selected=!0)}))}}}getStarred(e,t,r,n){var i=this;return(0,a.default)((function*(){const a={count:"number"!=typeof t||isNaN(t)?c.PAGE_SIZE:t,chat:e||void 0,remote:null==r?void 0:r.remote,id:null==r?void 0:r.id,fromMe:null==r?void 0:r.fromMe,participant:null==r?void 0:r.participant,media:n?"gif":void 0},o=yield(0,m.msgFindQuery)("star",a),s=o.status;return o.status>=400?(499===s?__LOG__(2)`model:Msg:getStarred error 499 (unimplemented)`:__LOG__(3)`model:Msg:getStarred error ${s}`,Promise.reject(s)):i.processMultipleMessages(void 0,o,{add:"search"})}))()}getMessagesById(e){var t=this;return(0,a.default)((function*(){const r=yield(0,m.msgFindByIds)(e);return(0,l.promiseProps)({messages:t.processMultipleMessages(void 0,r,{add:"search"}),eof:!0,canceled:!1})}))()}queryVcard(e){var t=this;return(0,a.default)((function*(){const r=yield(0,m.queryVcard)(e);return 499===r.status?(__LOG__(2)`model:Msg:queryVcard error 499 (unimplemented)`,Promise.reject(new w.E499)):t.processMultipleMessages(void 0,r,{add:"search"})}))()}incrementalStarredUpdate(e){return this.processMultipleMessages(void 0,e,{add:"search"})}search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=`${e}__${i.label||i.kind||""}`;if(1===t&&!n){const o=this.ftsCache[a];if(o)return o;const s=this._search(e,t,r,n,i.label,i.kind);this.ftsCache[a]=s;const l=()=>{this.ftsCache[a]=null};return setTimeout(l,y.FTS_TTL),s.catch(l),s}return this._search(e,t,r,n,i.label,i.kind)}_search(e,t,r,n,i,o){var s=this;return(0,a.default)((function*(){const a={searchTerm:e,page:(0,M.isNumber)(t)&&0!==t?t:1,count:(0,M.isNumber)(r)&&0!==r?r:c.PAGE_SIZE,remote:n,tagToCancel:n?s.pendingSearchTag:void 0,label:i,kind:o},d=yield(0,m.msgFindQuery)("search",a,void 0,s.onSearchTag);if(a.tagToCancel===s.pendingSearchTag&&(s.pendingSearchTag=void 0),499===d.status)return(0,l.promiseProps)({messages:Promise.resolve([]),eof:!1,canceled:!0});if(404===d.status)return Promise.reject(new w.E404);if(d.status>=400)return __LOG__(3)`model:Msg:search error ${d.status}`,Promise.reject(new w.ServerStatusCodeError(d.status,"failed to find a msg during fts"));const u=Array.isArray(d)?d:d.messages,p=!!Array.isArray(d)||d.eof;return(0,l.promiseProps)({messages:s.processMultipleMessages(void 0,u,{add:"search"}),eof:p,canceled:!1})}))()}queryMedia(e,t,r,n,i){var o=this;return(0,a.default)((function*(){const a={remote:e,count:(0,M.isNumber)(t)&&0!==t?t:c.PAGE_SIZE,id:null==n?void 0:n.id,fromMe:null==n?void 0:n.fromMe,participant:null==n?void 0:n.participant,direction:r||"before",media:i},s=yield(0,m.msgFindQuery)("media",a);return s.status>=400?(__LOG__(3)`model:Msg:media error ${s.status}`,404===s.status?Promise.reject(new w.E404):Promise.reject(new w.ServerStatusCodeError(s.status,"failed to find a msg during media query"))):i?o.processMultipleMessages(void 0,s,{add:"search"}):(0,l.promiseProps)({docCount:s.docCount,linkCount:s.linkCount,mediaCount:s.mediaCount,messages:o.processMultipleMessages(void 0,s.messages,{add:"search"})})}))()}getContext(e,t,r){const n=this.get(e);if(n)return Promise.all([(0,m.msgFindQuery)("before",e,r),(0,m.msgFindQuery)("after",e,r)]).then((r=>{let[i,a]=r;if(!Array.isArray(i)||!Array.isArray(a))throw __LOG__(3)`model:msg:getContext fetch error`,i.status||a.status;return n.search=!1,Promise.all([this.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),this.processMultipleMessages(e.remote,a,{add:"after",isHistory:!0},t)])}));const i={add:"after",isHistory:!0};return(0,m.msgFindQuery)("after",e,r).then((r=>{if(!Array.isArray(r))throw __LOG__(3)`model:msg:getContext:after fetch error`,r.status;if(p.default.isStatusV3(r[0].id.remote))throw new Error("statusV3, stop querying before the msg");return this.processMultipleMessages(e.remote,r,i,t)})).then((t=>{const n=(0,s.default)(t[0],"after[0]"),i=n.id.clone();i.count=e.count+1;const a={add:"before",isHistory:!0};return Promise.all([(0,m.msgFindQuery)("before",i,r).then((t=>{if(!Array.isArray(t))throw __LOG__(3)`model:msg:getContext:before fetch error`,t.status;if(!t[t.length-1].id.equals(e))throw __LOG__(3)`model:msg:getContext:before ctx message mismatch`,405;return this.processMultipleMessages(e.remote,t,a,(function(){return n.msgChunk}))})),Promise.resolve(t)])}))}hasSynced(){return(0,O.default)(this,c.COLLECTION_HAS_SYNCED)}delete(){super.delete(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}getKeysForResyncReceipts(){const e=[],t=(0,i.default)((0,i.default)({},this.lastReceivedReceipt),this.lastReceivedPaymentTransaction);for(const n in t){const t=(0,f.createWid)(n),i=r(69951).ChatCollection.get(t);let a;if(i&&(a=i.getFirstMsgWithStatus()),a){const r=a.id;r.t=this.lastReceivedReceipt[t]||a.t||0,r.payT=this.lastReceivedPaymentTransaction[t],e.push(r)}else __LOG__(3)`Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: ${t.toString()}`}return e}resyncReceipts(){__LOG__(2)`Msg:resyncReceipts`;const e=this.getKeysForResyncReceipts();return 0===e.length?Promise.resolve():S.GK.supportsFeature(S.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):I.default.resyncReceipts(e).then((e=>{Array.isArray(e)?(__LOG__(2)`Msg:resyncReceipts success`,e.forEach((e=>{this.updateLastReceipt(e.id,e.t),this.updateLastTransactionTime(e.id,e.payT),e.acks.forEach((t=>{const{id:r,fromMe:n,participant:i,status:a,t:o}=t;if(null!=r&&null!=n&&null!=a){const t=new d.default({fromMe:n,remote:e.id,id:r,participant:i}),s=this.get(t);s&&(s.isEphemeral&&o?s.updateEphemeralStartTimestamp(o):s.updateAck(a))}else __LOG__(3)`Msg:resyncReceipts invalid response: ${JSON.stringify(t)}`})),e.msgs.length>0&&this.processMultipleMessages(e.id,e.msgs,{update:!0,isHistory:!1}).catch((0,o.filteredCatch)(w.LogoutDrop,(()=>{})))}))):__LOG__(3)`Msg:resyncReceipts error`})).catch((0,o.filteredCatch)([w.LogoutDrop,w.EphemeralDrop,w.BrowserReplacedDrop],(()=>{}))).catch((e=>{throw __LOG__(3)`Msg:resyncReceipts dropped ${String(e)} ${e?e.stack:"no stack"}`,new Error("Msg:resyncReceipts dropped")}))}updateLastReceipt(e,t){const r=this.lastReceivedReceipt[e];(0,_.isNonZeroNumber)(t)&&(!r||t>r)&&(this.lastReceivedReceipt[e]=t)}updateLastTransactionTime(e,t){const r=this.lastReceivedPaymentTransaction[e];t&&(!r||t>r)&&(this.lastReceivedPaymentTransaction[e]=t)}processMultipleMessages(e,t,r,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=()=>(0,C._processMultipleMessages)(e,t,r,n);if(e){let t;const r=this.pendingAdd[e];return t=r&&i?r.then(a):a(),t.finally((()=>{e&&this.pendingAdd[e]===t&&(this.pendingAdd[e]=null)})).catch((()=>{})),this.pendingAdd[e]=t}return a()}markAllAsStale(){this.forEach((e=>e.unset("recvFresh")))}}t.MsgCollectionImpl=D,D.model=v.Msg;const N=new D;t.MsgCollection=N},54311:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=t.MsgInfo=void 0;var i=n(r(65212)),a=n(r(89867)),o=r(11290),s=n(r(31727)),l=r(19380),c=r(47969);class d extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.t=(0,o.prop)(),this.contact=(0,o.session)()}initialize(){super.initialize(),this.addChild("contact",l.ContactCollection.gadd(this.id))}}d.Proxy="msgInfoParticipant",d.idClass=a.default;const u=(0,o.defineModel)(d);t.MsgInfoParticipant=u;class p extends s.default{}t.ParticipantCollection=p,p.model=u,p.comparator=(e,t)=>(0,c.ContactComparator)(e.contact,t.contact);class f extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.usePlayReceipt=(0,o.prop)(),this.playedRemaining=(0,o.prop)(0),this.readRemaining=(0,o.prop)(0),this.deliveryRemaining=(0,o.prop)(0),this.deliveryPrivacyMode=(0,o.prop)(),this.played=(0,o.collection)(p),this.read=(0,o.collection)(p),this.delivery=(0,o.collection)(p),this.settled=(0,o.derived)(this._settled,["usePlayReceipt","playedRemaining","readRemaining"])}_settled(){return this.usePlayReceipt?!this.playedRemaining:!this.readRemaining}getCollection(){return r(17972).MsgInfoCollection}}f.Proxy="msgInfo",f.idClass=i.default;const _=(0,o.defineModel)(f);t.MsgInfo=_},17972:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoCollectionImpl=t.MsgInfoCollection=void 0;var i=n(r(65212)),a=r(1255),o=r(54311),s=r(28259),l=r(52821),c=r(62583),d=r(65044);class u extends a.BaseCollection{_initializeStaleCollection(){this.listenTo(d.Socket,"change:stream",(()=>{d.Socket.stream===c.SOCKET_STREAM.DISCONNECTED&&this.forEach((e=>{e.settled||e.set("stale",!0)}))}))}_find(e){const t=r(59871).MsgCollection.get(e);return t?t.isSentByMe?(0,s.sendQueryMsgInfo)(t):Promise.reject(new a.CollectionSilentQueryError("message not sent by me")):Promise.reject(new a.CollectionSilentQueryError(`No message found for id: ${e}`))}updateInfo(e,t,r,n,a,o){const s=new i.default({from:t,to:r,id:e,participant:a}),c=new i.default({from:t,to:r,id:e}),d=this.get(s)||this.get(c);if(d)return(0,l.updateMsgInfo)(d,n,a,o)}}t.MsgInfoCollectionImpl=u,u.model=o.MsgInfo,u.staleCollection=!0;const p=new u;t.MsgInfoCollection=p},54676:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addRecordsToChat=C,t.broadcastFanout=function(e){let t;if(!e.invis){const n=T(e);n&&(t=n.map((e=>e.remote)),n.forEach((t=>{const n=r(59871).MsgCollection;if(!n.some((0,o.default)({id:t}))){const i=M(e);i.to=t.remote,i.id=t,i.broadcast=!0;const a=n.add(i,{merge:!0});(0,r(50101).findChat)(t.remote).then((function(e){a.forEach((t=>{if(t.type!==d.MSG_TYPE.PROTOCOL){e.isEphemeralSettingOn()&&(t.ephemeralDuration=e.getEphemeralSetting());const r=e.getEphemeralSettingTimestamp();null!=r&&(t.ephemeralSettingTimestamp=r);const n=e.getDisappearingModeInitiator();null!=n&&(t.disappearingModeInitiator=n)}})),C(a,e,!0)}))}})))}return t},t.createQuotedMsg=function(e){if(!e)return null;const t=new c.default({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});e.id=t;return new(0,r(17304).Msg)(e).safe()},t.eventTypeFromMsgType=function(e){const t=e.type,r=e.subtype,n=(0,f.getMaybeMeUser)();let i;i=t===d.MSG_TYPE.GP2||t===d.MSG_TYPE.GROUP_NOTIFICATION?"subject"===r?"n":"add"===r||"invite"===r?e.recipients&&u.default.equals(e.recipients[0],n)?"s":"i":"remove"===r?e.recipients&&u.default.equals(e.recipients[0],n)?"n":"i":"create"===r?"n":"i":t===d.MSG_TYPE.BROADCAST_NOTIFICATION||t===d.MSG_TYPE.NOTIFICATION||t===d.MSG_TYPE.E2E_NOTIFICATION?"create"===r?"n":"i":t===d.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals(n)?"i":t===d.MSG_TYPE.CALL_LOG?"n":e.broadcast?u.default.isBroadcast(e.id.remote)?"n":"i":t===d.MSG_TYPE.REVOKED?"i":u.default.isPSA(e.id.remote)?e.ack===l.ACK.RECEIVED?"d":"a":t===d.MSG_TYPE.CIPHERTEXT||t===d.MSG_TYPE.OVERSIZED?"a":t===d.MSG_TYPE.NOTIFICATION_TEMPLATE||t===d.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===r||t===d.MSG_TYPE.UNKNOWN&&"reaction"===r||t===d.MSG_TYPE.REACTION?"i":"d";return i},t.getBroadcastFanoutKeys=T,t.getOriginalQuotedMsgIfPossible=function(e,t){var r;if(!e)return e;const n=null===(r=t.get(e.id))||void 0===r?void 0:r.safe();return n&&!n.asRevoked?n:e},t.hasMentionOfMe=S,t.isImportantMessage=function(e){return S(e)||v(e)},t.isNotification=function(e,t){switch(e){case d.MSG_TYPE.GROUP_NOTIFICATION:case d.MSG_TYPE.GP2:case d.MSG_TYPE.BROADCAST_NOTIFICATION:case d.MSG_TYPE.NOTIFICATION:case d.MSG_TYPE.NOTIFICATION_TEMPLATE:case d.MSG_TYPE.E2E_NOTIFICATION:case d.MSG_TYPE.CALL_LOG:return!0;case d.MSG_TYPE.PROTOCOL:return"ephemeral_setting"===t;default:return!1}},t.listMsgCanRender=function(e){var t;return(null===(t=e.list)||void 0===t?void 0:t.listType)!==p.Message$ListMessageListType.PRODUCT_LIST||(0,_.productListMessagesEnabled)()&&!y.ServerProps.webProductListMessageRenderKillSwitch},t.msgMatchesType=function(e,t){switch(t){case"text":return e.type===d.MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===d.MSG_TYPE.IMAGE;case"video":return e.type===d.MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===d.MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===d.MSG_TYPE.AUDIO;case"ptt":return e.type===d.MSG_TYPE.PTT;case"document":return e.type===d.MSG_TYPE.DOCUMENT;case"location":return e.type===d.MSG_TYPE.LOCATION;case"vcard":return e.type===d.MSG_TYPE.VCARD||e.type===d.MSG_TYPE.MULTI_VCARD;case"url":return e.type===d.MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===d.MSG_TYPE.STICKER;case void 0:default:return!1}},t.repliedToMyMessage=v,t.typeIsMms=function(e){var t;switch(e.type){case"image":case"video":case"audio":case"ptt":case"sticker":case"document":case"product":return!0;case"protocol":return"history_sync_notification"===e.subtype;case d.MSG_TYPE.NATIVE_FLOW:return e.headerType===p.Message$ButtonsMessageHeaderType.IMAGE;case d.MSG_TYPE.INTERACTIVE:return Boolean((null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType)&&h.IM_MEDIA_HEADER_TYPES.has(e.interactiveHeader.mediaType));default:return!1}},t.typeIsUrl=function(e){return e.type===d.MSG_TYPE.CHAT&&"url"===e.subtype},t.viewOnceMessageOpened=function(e){return e.isViewOnce&&!e.isSentByMe&&e.ack>=l.ACK.PLAYED};var i=n(r(48926)),a=n(r(30988)),o=n(r(6410)),s=n(r(35161)),l=r(35470),c=n(r(65212)),d=r(15461),u=n(r(89867)),p=r(24808),f=r(99234),_=r(57701),h=r(34535),g=n(r(78144)),m=r(11902),y=r(64551),E=r(77591);function S(e){const t=(0,f.getMaybeMeUser)();return!!(null==e?void 0:e.mentionedJidList)&&e.mentionedJidList.some((e=>t.user===e.user&&t.server===e.server))}function v(e){const t=(0,f.getMaybeMeUser)();return!(!t||!e)&&(!(!e.quotedMsg||!e.quotedParticipant)&&t.equals(e.quotedParticipant))}function T(e){var t;let n,i,a;if(e instanceof r(17304).Msg)i=e,a=e.id;else{if(!(e instanceof c.default))return void __LOG__(3)`model:msgs:broadcastFanout: unknown msgOrKey: ${String(e)}`;a=e}if(!u.default.isStatusV3(a.remote)){if((null===(t=i)||void 0===t?void 0:t.recipients)&&0!==i.recipients.length)n=i.recipients;else{const e=r(63928).default.get(a.remote);e?n=(0,s.default)(M(e.participants),"id"):__LOG__(2)`model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: ${a.remote.toString()}`}return n?n.map((e=>new c.default({fromMe:a.fromMe,remote:e,id:a.id}))):void 0}}function C(e,t,n,i,a,o){const s=i||t.msgs;if(0===e.length)return;let l=s===t.msgs;if(o)if(l)__LOG__(2)`models:msg:store:resetMostRecentMsgs .msgs === cmc !`,A(t,s,e);else{l=!0;A(t,s,e).then((()=>{const e=new(0,r(51612).ChatMsgsCollection);e.replace(t.msgs),t.msgChunks.push(e),t.replaceMsgsCollection(s),t.msgs.trigger("change:last",t.msgs.last())}))}else n?l?A(t,s,e):P(s,e):P(s,e,{at:0,silent:e.every(O)});const c=r(59871).MsgCollection;if(n&&l||!c.lastReceivedReceipt[t.id]){for(let t=e.length-1;t>=0;t--){const r=e[t],n=r.id;if(n.fromMe&&!r.isNotification){c.updateLastReceipt(n.remote,r.t);break}}}if(n&&l||!c.lastReceivedPaymentTransaction[t.id]){for(let t=e.length-1;t>=0;t--){const r=e[t],n=r.id;r.paymentTransactionTimestamp&&c.updateLastTransactionTime(n.remote,r.paymentTransactionTimestamp)}}const d=a;d&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=e.find((function(e){return e.id.toString()===d.toString()})))}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r){const n=(0,a.default)(r,(e=>!!e));if(!n)return Promise.resolve();P(t,r),yield(0,m.setLastReceivedKey)(e.id,n.id),e.lastReceivedKey=n.id}))).apply(this,arguments)}function P(e,t,r){try{e.add(t,r)}catch(e){if(!(e instanceof E.LogoutDrop))throw e;__LOG__(3)`setRecords LogoutDrop: ${e.toString()}`}}function M(e){return null!=e&&"object"==typeof e?JSON.parse(JSON.stringify(e),g.default):e}function O(e){return"i"===e.eventType}},40214:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Mute=t.GLOBAL_REACTIONS_MUTE=t.GLOBAL_MUTE=void 0;var i=n(r(89867)),a=n(r(30381)),o=r(46331),s=n(r(15421)),l=r(11290),c=r(88102),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=n(r(43725)),p=r(45197),f=r(31515),_=r(85893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}const g="global_mute";t.GLOBAL_MUTE=g;const m="global_reactions_mute";t.GLOBAL_REACTIONS_MUTE=m;class y extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.expiration=(0,l.prop)(0),this.callExpiration=(0,l.prop)(0),this._unmuteTimer=(0,l.session)(),this._unmuteCallTimer=(0,l.session)(),this.promises=(0,l.session)((function(){return{}})),this.isMuted=(0,l.derived)(this._isMuted,["expiration"]),this.isCallMuted=(0,l.derived)(this._isCallMuted,["callExpiration"])}_isMuted(){return!!this.expiration}_isCallMuted(){return!!this.callExpiration}initialize(){super.initialize(),null!=this.expiration&&0!==this.expiration&&this.mute(this.expiration),null!=this.callExpiration&&0!==this.callExpiration&&this.muteCall(this.callExpiration)}setMute(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}mute(e,t,r){let n=e;if(!(0,f.isNumber)(n))return __LOG__(2)`models:Mute:mute called with invalid expiration ${n}`,Promise.reject(new d.ActionError);n=Math.round(n),n>2e9&&__LOG__(2)`models:Mute:mute called with wrong units?${this.id.toString()} exp:${n}`;const l=()=>{if(this.isMuted&&(s.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer")),-1===n)__LOG__(2)`models:Mute:mute ${this.id.toString()} muted, no expiration`;else{const e=n-(0,a.default)().unix();__LOG__(2)`models:Mute:mute ${this.id.toString()} duration:${e}`,this._unmuteTimer=s.default.setGlobalTimeout(this.unmute.bind(this),1e3*n)}this.set({expiration:n})},h=i.default.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;const e=this.promises.mute=(0,p.sendConversationMute)(this.id,n,this.expiration),i=h?new o.ActionType(u.default.t(66)):new o.ActionType(u.default.t(31)),a=r||(0,o.genId)(),s=this.promises.mute.catch((()=>{__LOG__(3)`models:Mute:mute dropped`;const e=h?u.default.t(64):u.default.t(29);throw new o.ActionType(e,{actionText:u.default.t(129),actionHandler:this.mute.bind(this,n,t,a)})})).then((e=>{if(200===e.status){const e=h?u.default.t(65):u.default.t(30);return new o.ActionType(e,{actionText:u.default.t(133),actionHandler:this.unmute.bind(this,t,a)})}if(e.status>=400)throw h?new o.ActionType(u.default.t(64)):new o.ActionType(u.default.t(29))}));return c.Cmd.openToast((0,_.jsx)(o.ActionToast,{id:a,initialAction:i,pendingAction:s})),e.then((function(e){200!==e.status||e._duplicate||l()})).finally((()=>{this.promises.mute=null}))}return l(),Promise.resolve()}muteCall(e){let t=e;if(!(0,f.isNumber)(t))return __LOG__(2)`models:Mute:muteCall called with invalid expiration ${t}`,Promise.reject(new d.ActionError);if(t=Math.round(t),t>2e9&&__LOG__(2)`models:Mute:muteCall called with wrong units?${this.id.toString()} exp:${t}`,this.isCallMuted&&(s.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer")),-1===t)__LOG__(2)`models:Mute:muteCall ${this.id.toString()} muted, no expiration`;else{const e=t-(0,a.default)().unix();__LOG__(2)`models:Mute:muteCall ${this.id.toString()} duration:${e}`,this._unmuteCallTimer=s.default.setGlobalTimeout(this.unmuteCall.bind(this),1e3*t)}return this.set({callExpiration:t}),Promise.resolve()}canMute(){let e=!1;if(i.default.isGroup(this.id)){const t=r(63928).default.get(this.id);t&&(e=t.participants.iAmMember())}return e||i.default.isUser(this.id)}_clearUnmuteTimer(){s.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}_clearUnmuteCallTimer(){s.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer"),this.callExpiration=0}unmute(e,t){const r=()=>{__LOG__(2)`models:Mute:unmute ${this.id.toString()}`,this._clearUnmuteTimer()},n=i.default.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;const i=this.promises.unmute=(0,p.sendConversationMute)(this.id,0,this.expiration),a=n?new o.ActionType(u.default.t(73)):new o.ActionType(u.default.t(42)),s=t||(0,o.genId)(),l=this.promises.unmute.catch((()=>{__LOG__(3)`models:Mute:unmute dropped`;const t=n?u.default.t(71):u.default.t(40);throw new o.ActionType(t,{actionText:u.default.t(129),actionHandler:this.unmute.bind(this,e,s)})})).then((e=>{if(200===e.status)return n?new o.ActionType(u.default.t(72)):new o.ActionType(u.default.t(41));if(e.status>=400)throw n?new o.ActionType(u.default.t(71)):new o.ActionType(u.default.t(40))}));return c.Cmd.openToast((0,_.jsx)(o.ActionToast,{id:s,initialAction:a,pendingAction:l})),i.then((function(e){200!==e.status||e._duplicate||r()})).finally((()=>{this.promises.unmute=null}))}return r(),Promise.resolve()}unmuteCall(){return __LOG__(2)`models:Mute:unmuteCall ${this.id.toString()}`,this._clearUnmuteCallTimer(),Promise.resolve()}delete(){super.delete(),this.getCollection().remove(this.id),this._clearUnmuteTimer()}getCollection(){return r(72472).MuteCollection}}y.Proxy="mute",y.idClass=i.default,y.allowedIds=[g,m];const E=(0,l.defineModel)(y);t.Mute=E},72472:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MuteCollectionImpl=t.MuteCollection=void 0;var n=r(1255),i=r(17239),a=r(99234),o=r(57701),s=r(40214);let l=!0,c=!0,d=!0,u=!0,p=!1,f=!1;class _ extends n.BaseCollection{initializeFromCache(e){Array.isArray(e)?e.forEach((e=>{[s.GLOBAL_MUTE,s.GLOBAL_REACTIONS_MUTE].includes(e.id)&&this.add(e,{remove:!1})})):null!=e&&e.id===s.GLOBAL_MUTE&&this.add(e,{remove:!1}),this.setGlobalNotifications((0,a.getGlobalNotifications)()),this.setGlobalSounds((0,a.getGlobalSounds)()),this.setGlobalCallRingtone((0,a.getGlobalCallRingtone)()),this.setGlobalPreviews((0,a.getGlobalPreviews)()),this.setCollapseMuted((0,a.getCollapseMuted)()),this.setOutgoingMessageSound((0,a.getOutgoingMessageSound)())}saveToCache(){if(!i.Conn.shouldSaveToCache())return;const{id:e}=this.constructor.cachePolicy,t=[];__LOG__(2)`models:mute:cache-save: ${String(e)}`;const r=this.get(s.GLOBAL_MUTE),n=this.get(s.GLOBAL_REACTIONS_MUTE);r&&t.push(r.toJSON()),(0,o.receiveReactionsEnabled)()&&n&&t.push(n.toJSON()),t.length?(0,a.setCollection)(e,t):__LOG__(3)`models:mute:cache-save: globalMuteModel or globalReactionsMuteModel does not exist`}globalMute(){const e=this.get(s.GLOBAL_MUTE);return e||this.add({id:s.GLOBAL_MUTE})[0]}globalReactionsMute(){const e=this.get(s.GLOBAL_REACTIONS_MUTE);return e||this.add({id:s.GLOBAL_REACTIONS_MUTE})[0]}getGlobalSounds(){return l}setGlobalSounds(e){l=e,(0,a.setGlobalSounds)(e)}getGlobalCallRingtone(){return c}setGlobalCallRingtone(e){c=e,(0,a.setGlobalCallRingtone)(e)}getGlobalNotifications(){return d}setGlobalNotifications(e){d=e,(0,a.setGlobalNotifications)(e)}getGlobalPreviews(){return u}setGlobalPreviews(e){u=e,(0,a.setGlobalPreviews)(e)}getCollapseMuted(){return p}setCollapseMuted(e){p=e,(0,a.setCollapseMuted)(e),this.trigger("change:collapseMuted",p)}getOutgoingMessageSound(){return f}setOutgoingMessageSound(e){f=e,(0,a.setOutgoingMessageSound)(e)}handle(e){e.forEach((e=>{const t=r(69951).ChatCollection.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)}))}}t.MuteCollectionImpl=_,_.model=s.Mute,_.cachePolicy={id:"mute",policy:n.CACHE_POLICY.LOAD,delay:1e3};const h=new _;t.MuteCollection=h},51783:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(81109)),o=i(r(48926)),s=r(89385),l=i(r(42341)),c=r(40265),d=r(50796),u=i(r(45095)),p=r(40277),f=r(37178),_=r(49347),h=r(29984),g=r(77712),m=r(11290),y=r(17239),E=i(r(18561)),S=r(99234),v=r(7293),T=i(r(43725)),C=i(r(11339)),A=r(64551),b=r(2541),P=r(77591);class M extends((0,c.customError)("NoticeJsonParseError")){}const O=["logout","refresh"],I=(0,f.createTimer)({algo:{type:"constant",delay:432e5}}),w=(0,f.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:18e6});class R extends m.BaseModel{constructor(){super(...arguments),this.id=(0,m.prop)(),this.noticeId=(0,m.prop)(),this.blocking=(0,m.prop)(),this.policyVersion=(0,m.prop)(),this.banner=(0,m.prop)(),this.blockingModal=(0,m.prop)(),this.shouldShowButterBar=(0,m.session)(!0),this.backgroundFetches=(0,m.session)()}initialize(){super.initialize(),this.fetchNoticeData=this.fetchNoticeData.bind(this),this.listenTo(T.default,"locale_change",this.fetchNoticeData)}dismissButterBarNotice(){0!==A.ServerProps.greenAlertBannerDuration&&(new C.default.UserNotice({userNoticeId:this.noticeId,userNoticeContentVersion:this.policyVersion,userNoticeEvent:C.default.USER_NOTICE_EVENT.BANNER_DISMISS}).commit(),this._dismissAndStartButterBarTimer(A.ServerProps.greenAlertBannerDuration),(0,S.setNoticeBannerClosedAt)(Date.now()))}_dismissAndStartButterBarTimer(e){this.shouldShowButterBar=!1,this._clearButterBarTimer(),this._butterBarTimeoutHandler=window.setTimeout((()=>{this.shouldShowButterBar=!0,(0,S.setNoticeBannerClosedAt)(null)}),e)}delete(){this.resetNotice(),super.delete()}sanitizeBlockingModal(e){if(!e)return null;const t=e=>{if(!e)return null;const t=e.action;if(t){const r=O.find((e=>`whatsapp:user-notice?action=${e}`===t));if(r)return e.action=r,e;__LOG__(3)`Notice: Unknown action type ${t}`}return null};return e.primaryButton=t(e.primaryButton),e.secondaryButton=t(e.secondaryButton),e}_isoFromCallingCode(e){const t=parseInt(e,10),r=l.default[t];return(0,u.default)(r,"isoFromCC")}validateResponseFields(e,t){e.forEach((e=>{if(!(e in t))throw new Error(`Missing field ${e} in notice content.`)}))}extractBlockingModal(e){if(e)return this.validateResponseFields(["icon","iconDescription","title","body","primaryButton"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconSvg:{light:"",dark:""},iconDescription:e.iconDescription,title:e.title,body:e.body,primaryButton:e.primaryButton,secondaryButton:e.secondaryButton}}extractBanner(e){if(e)return this.validateResponseFields(["icon","iconDescription","text"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconDescription:e.iconDescription,text:e.text,iconSvg:{light:"",dark:""}}}extractUserNoticeContent(e){const{policyVersion:t}=e;if(!t)throw new Error("Missing field policyVersion in notice content.");__LOG__(2)`Notice:fetchNoticeData successful for policyVersion ${t}`;const r=e.banner&&this.extractBanner(e.banner),n=e["blocking-modal"]&&this.extractBlockingModal(e["blocking-modal"]),i=n&&this.sanitizeBlockingModal(n);this.set({policyVersion:t,blockingModal:i,banner:r}),this.makeIconFetch(r,i)}resetBackgroundFetches(){var e;null===(e=this.backgroundFetches)||void 0===e||e.forEach((e=>{__LOG__(2)`Notice: aborting fetches`,e.abort()}))}resetNotice(){this.resetBackgroundFetches(),this.unset(["banner","blocking","blockingModal","noticeId","policyVersion"]),(0,S.setNoticeId)(null),(0,S.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0}_clearButterBarTimer(){const e=this._butterBarTimeoutHandler;null!=e&&window.clearTimeout(e)}fetchNoticeData(){if((0,h.isNonZeroNumber)(this.noticeId)&&v.GK.supportsFeature(v.GK.F.USER_NOTICE)){var e,t;this.resetBackgroundFetches(),this.set({blockingModal:void 0,banner:void 0});const r=(0,S.getMeUser)(),n=(0,p.findCC)(r.user),i=this._isoFromCallingCode(n),a=b.URL.build("https://www.whatsapp.com/user-notice/v1/",{id:this.noticeId,lg:null!==(e=y.Conn.lg)&&void 0!==e?e:"zz",lc:null!==(t=y.Conn.lc)&&void 0!==t?t:"ZZ",cc:i,platform:y.Conn.isSMB?"smbweb":"web"});this.makeContentFetch(a)}}_shouldUpdateVersion(e,t){return null==e||null!=t&&t>e}handleResponse(e){if(v.GK.supportsFeature(v.GK.F.USER_NOTICE))if(e.length){const{blocking:t,id:r,version:n}=e[0],i=this.noticeId,a=this._shouldUpdateVersion(this.policyVersion,n);__LOG__(2)`Notice: received notice id: ${r}, blocking: ${t}, version: ${n}`,this.set({blocking:t,noticeId:r,policyVersion:a?n:this.policyVersion}),(r!==i||a)&&this.fetchNoticeData();r!==(0,S.getNoticeId)()&&((0,S.setNoticeId)(r),(0,S.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0),e.length>1&&(__LOG__(4,void 0,new Error,!0)`Notice: more than one notice from phone response`,SEND_LOGS("notice-unallowed-length"))}else __LOG__(2)`Notice: received empty notice`,this.resetNotice()}sync(e){!0!==e&&this._initializeShouldShowButterBar();const t="Notice:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,r(56891).default.queryNoticeState)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.notices)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,d.filteredCatch)(P.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("notice-query-failed")}))}_initializeShouldShowButterBar(){const e=(0,S.getNoticeBannerClosedAt)();if(null!=e&&0!==A.ServerProps.greenAlertBannerDuration){const t=e+A.ServerProps.greenAlertBannerDuration-Date.now();if(t>0)return void this._dismissAndStartButterBarTimer(t)}this.shouldShowButterBar=!0}makeContentFetch(e){var t=this;return(0,o.default)((function*(){try{const r=yield t.attemptFirstFetchAndRetriesAfter(e);try{const e=r&&JSON.parse(r);e&&t.extractUserNoticeContent(e)}catch(e){throw new C.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.JSON_PARSE}).commit(),new M(`Received invalid User Notice content for id ${t.noticeId}`)}}catch(e){if(e.name===s.ABORT_ERROR)return;if("NoticeJsonParseError"!==e.name){new C.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.JSON_FETCH}).commit()}t.resetNotice(),__LOG__(4,void 0,new Error,!0)`Notice: Error Message : ${e.message}`,SEND_LOGS("notice-content-error")}}))()}makeIconFetch(e,t){var r=this;return(0,o.default)((function*(){const n=[null==e?void 0:e.icon.light,null==e?void 0:e.icon.dark,null==t?void 0:t.icon.light,null==t?void 0:t.icon.dark].map((e=>e?r.attemptFirstFetchAndRetriesAfter(e):Promise.resolve(null)));try{const[e,t,i,o]=yield Promise.all(n);let s=r.banner,l=r.blockingModal;r.banner&&e&&t&&(s=(0,a.default)((0,a.default)({},r.banner),{iconSvg:{light:e,dark:t}})),r.blockingModal&&i&&o&&(l=(0,a.default)((0,a.default)({},r.blockingModal),{iconSvg:{light:i,dark:o}})),r.set({banner:s,blockingModal:l})}catch(e){if(e.name===s.ABORT_ERROR)return;new C.default.UserNoticeError({userNoticeId:r.noticeId,userNoticeContentVersion:r.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.IMAGE_FETCH}).commit(),__LOG__(4,void 0,new Error,!0)`Notice: Icon fetch error : ${e.message}`,SEND_LOGS("notice-icon-fetch-error")}}))()}shouldRetry(e){return 404===e||429===e||e>=500}attemptFirstFetchAndRetriesAfter(e){var t=this;return(0,o.default)((function*(){var r;const i=new n,a=i.signal,o=null!==(r=t.backgroundFetches)&&void 0!==r?r:[];t.backgroundFetches=[...o,i];try{const r=yield(0,E.default)(e,{signal:a});if(!r.ok){const e=r.status;throw t.shouldRetry(e)?new _.HttpStatusCodeError(e,"noticeFetchErr"):new Error("contentResponseUnhandledError")}return r.text()}catch(r){if("HttpStatusCodeError"===r.name)return t.retryFetch(e,r.status);throw r}}))()}retryFetch(e,t){var r,i=this;const a=new n,s=a.signal,l=null!==(r=this.backgroundFetches)&&void 0!==r?r:[];this.backgroundFetches=[...l,a];const c=function(){var t=(0,o.default)((function*(t){__LOG__(2)`Notice: Fetch Retry attempt`;const r=yield(0,E.default)(e,{signal:s});if(!r.ok){if(__LOG__(3)`Notice: Could Not download`,i.shouldRetry(r.status))return t(new Error("retryFailed"));throw new Error("contentResponseUnhandledError")}return r.text()}));return function(){return t.apply(this,arguments)}}();let d,u;return 404===t?(u=2,d=e=>{let{taskDuration:t}=e;const r=I();return Math.max(r-t,0)}):(u=8,d=e=>{let{taskDuration:t}=e;const r=36e5*w();return Math.max(r-t,0)}),(0,g.backoff)({delay:d,retries:u,signal:s},c)}}R.Proxy="notice";var D=new((0,m.defineModel)(R))({id:"default_notice_id"});t.default=D},3e4:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.ChatstateCollection=t.Chatstate=void 0,t.processStagesRecursively=m;var i=n(r(23279)),a=n(r(89867)),o=r(48360),s=r(1255),l=r(11290),c=r(22683),d=r(19380),u=n(r(43725)),p=r(42931);class f extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.type=(0,l.prop)(),this.t=(0,l.prop)(),this.deny=(0,l.prop)(),this.updateTime=(0,l.session)(),this.expireTimerId=(0,l.session)()}}f.Proxy="chatstate",f.idClass=a.default;const _=(0,l.defineModel)(f);t.Chatstate=_;class h extends s.BaseCollection{}t.ChatstateCollection=h,h.model=_;class g extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.isOnline=(0,l.session)(!1),this.stale=(0,l.session)(!0),this.hasData=(0,l.session)(!1),this.isSubscribed=(0,l.session)(!1),this.withholdDisplayStage=(0,l.session)(p.WithholdDisplayStage.None),this.forceDisplay=(0,l.session)(!1),this.chatActive=(0,l.session)(!1),this.withholdDisplayTimer=(0,l.session)(),this.forceDisplayTimer=(0,l.session)(),this.chatstate=(0,l.session)(),this.chatstates=(0,l.collection)(h),this.isGroup=(0,l.derived)(this._isGroup),this.isUser=(0,l.derived)(this._isUser)}_isGroup(){return a.default.isGroup(this.id)}_isUser(){return a.default.isUser(this.id)}initialize(){super.initialize();const e=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new _(e)),this.isGroup?this.listenTo(this.chatstates,"add change",(0,i.default)((()=>{let e,t=!1;this.chatstates.forEach((r=>{"composing"!==r.type&&"recording"!==r.type||e&&!(e.updateTime<r.updateTime)||(e=r),t=t||"unavailable"!==r.type})),this.set({isOnline:t}),this.chatstate.set({id:e?e.id:"",type:e?e.type:"unavailable"})}))):this.listenTo(this.chatstate,"change:type",(()=>{this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)}delete(){super.delete(),this.getCollection().remove(this.id),this.chatstate.delete(),this.chatstates.forEach((e=>e.delete()))}reset(){this.hasData=!1,this.isGroup?this.chatstates.forEach((e=>{e.type="unavailable"})):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}isActive(){const e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}getGroupSubtitleText(){if(!this.hasData)return null;if(!this.isGroup)return __LOG__(4,void 0,new Error,!0)`getGroupSubtitleText is used when presence is not for a group`,SEND_LOGS("getGroupSubtitleText-not-group"),null;const e=this._getActiveContact();if(null==e)return null;const t=e.formattedShortName;return"composing"===this.chatstate.type?u.default.t(869,{participant:t}):u.default.t(870,{participant:t})}_getActiveContact(){const e=this.chatstate.id;return e?d.ContactCollection.get(e):null}getUserSubtitleText(){if(!this.hasData)return null;if(!this.isUser)return __LOG__(4,void 0,new Error,!0)`getUserSubtitleText is used when presence is not for a user`,SEND_LOGS("getUserSubtitleText-not-user"),null;const e=this.chatstate;switch(e.type){case"available":return u.default.t(864);case"composing":return o.fbt._("typing",null,{hk:"49dYir"});case"recording":return o.fbt._("recording audio",null,{hk:"21blv0"});case"unavailable":return e.deny||null==e.t?null:c.Clock.lastSeenStr(e.t)}}getFormattedString(){return this.hasData?this.isGroup?this.getGroupSubtitleText():this.isUser?this.getUserSubtitleText():null:null}onChatActiveChange(){if(this.chatActive){if(this.hasData)this.withholdDisplayStage=p.WithholdDisplayStage.None;else{const e=this._getActiveContact();!0===(null==e?void 0:e.isBusiness)?m(this,[p.WithholdDisplayStage.Business,p.WithholdDisplayStage.Info,p.WithholdDisplayStage.None]):m(this,[p.WithholdDisplayStage.Info,p.WithholdDisplayStage.None])}this.forceDisplayTimer=setTimeout((()=>{this.set({forceDisplay:!0,forceDisplayTimer:void 0})}),2e3)}else this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0)}subscribe(){return this.getCollection().find(this.id)}getCollection(){return r(68315).PresenceCollection}}function m(e,t){if(0===t.length)return;const[r,...n]=t;e.set({withholdDisplayStage:r,withholdDisplayTimer:r===p.WithholdDisplayStage.None?null:setTimeout((()=>{m(e,n)}),r===p.WithholdDisplayStage.Business?5e3:1500)})}g.Proxy="presence",g.idClass=a.default;const y=(0,l.defineModel)(g);t.Presence=y},68315:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceCollectionImpl=t.PresenceCollection=void 0;var i=n(r(48926)),a=n(r(89867)),o=r(1255),s=r(3e4),l=r(1985);class c extends o.BaseCollection{_subscribe(e){return(0,i.default)((function*(){const t=r(69951).ChatCollection.get(e);yield(0,l.subscribePresence)(e,null==t?void 0:t.getTcToken())}))()}_find(e){var t=this;return(0,i.default)((function*(){return!t.gadd(e).isUser||a.default.isServer(e)||a.default.isPSA(e)||(yield t._subscribe(e)),{id:e}}))()}reSubscribeWhenActive(e){var t=this;return(0,i.default)((function*(){const r=t.get(e);null!=r&&!1!==r.isSubscribed&&(yield t._subscribe(e))}))()}clearAllPresence(){this.forEach((e=>{e.reset(),e.set({stale:!0,isSubscribed:!1})}))}}t.PresenceCollectionImpl=c,c.model=s.Presence,c.staleCollection=!0;const d=new c;t.PresenceCollection=d},42931:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WithholdDisplayStage=void 0;const n=r(76672).Mirrored(["Info","Business","None"]);t.WithholdDisplayStage=n},34771:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryFeaturesClass=t.PrimaryFeatures=void 0;var n=r(11290),i=r(99234);class a extends n.BaseModel{constructor(){super(...arguments),this.features=(0,n.prop)(),this.contactExcept=(0,n.prop)(!1),this.reactionsSend=(0,n.prop)(!1),this.ddmSettings=(0,n.prop)(!1)}initializeFromLocalStorage(){this._setPrimaryFeatures((0,i.getPrimaryFeatures)())}setPrimaryFeatures(e){(0,i.setPrimaryFeatures)(e),this._setPrimaryFeatures(e)}_setPrimaryFeatures(e){this.features=e;const t=new Set(e);this.contactExcept=t.has("contact_except"),this.reactionsSend=t.has("reactions_send"),this.ddmSettings=t.has("ddm_settings")}}t.PrimaryFeaturesClass=a,a.Proxy="primaryFeatures";const o=new((0,n.defineModel)(a))({id:"1"});t.PrimaryFeatures=o},48694:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryForceUpgradeClass=t.PrimaryForceUpgrade=void 0;var i=r(86945),a=r(11290),o=r(88102),s=n(r(11339)),l=r(34771),c=r(47221);class d extends a.BaseModel{constructor(){super(...arguments),this.forceUpgradeReason=(0,a.prop)(),this.shouldForceUpgrade=(0,a.derived)(this._shouldForceUpgrade,["forceUpgradeReason"])}_shouldForceUpgrade(){return null!=this.forceUpgradeReason}setup(){(0,i.getABPropConfigValue)("comparion_force_upgrade")&&(this._update(),this.listenTo(o.Cmd,"ab_props_update",(()=>{this._update()})),this.listenTo(l.PrimaryFeatures,"change:features",(()=>{this._update()})))}_update(){try{var e;const r=function(){const e=(0,i.getABPropConfigValue)("companion_min_versions");return JSON.parse(e.substr(5)).map((e=>{let{feature:t,min_version:r}=e;return{feature:t,minVersion:r}}))}(),n=new Set(null!==(e=l.PrimaryFeatures.features)&&void 0!==e?e:[]),a=new c.Version(c.SANITIZED_VERSION_STR),o=r.find((e=>{let{feature:t,minVersion:r}=e;return n.has(t)&&a.lt(r)})),d=this.shouldForceUpgrade;var t;if(this.forceUpgradeReason=null==o?void 0:o.feature,!d&&this.shouldForceUpgrade)new s.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:s.default.FORCE_UPGRADE_USER_ACTION_TYPE.SHOW,forceUpgradeReason:null!==(t=this.forceUpgradeReason)&&void 0!==t?t:""}).commit();__LOG__(2)`PrimaryForceUpgradeClass: shouldForceUpgrade ${this.shouldForceUpgrade}`}catch(e){__LOG__(4,void 0,new Error,!0)`PrimaryForceUpgradeClass: ${e}`,SEND_LOGS("primary-force-upgrade-error")}}}t.PrimaryForceUpgradeClass=d,d.Proxy="primaryForceUpgrade";const u=new((0,a.defineModel)(d))({id:"1"});t.PrimaryForceUpgrade=u},41601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_PIC_COMMAND=t.PP_URL=t.PP_TOK=t.PP_REF=void 0;t.PP_URL="https://web.whatsapp.com/pp";t.PP_REF="/pp";t.PP_TOK="/pp";const r=Object.freeze({REMOVE:"remove",SET:"set"});t.PROFILE_PIC_COMMAND=r},93836:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumb=t.FALLBACK=void 0;var i=n(r(81109)),a=n(r(89867)),o=r(11290),s=r(99234),l=r(7293),c=r(41601),d=r(2541),u=n(r(92658));const p={SINGLE:"SINGLE",GROUP:"GROUP"};t.FALLBACK=p;class f extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.token=(0,o.prop)(),this.tag=(0,o.prop)(),this.raw=(0,o.prop)(),this.eurl=(0,o.prop)(),this.previewEurl=(0,o.prop)(),this.stale=(0,o.session)(!0),this.eurlStale=(0,o.session)(!1),this.pendingPic=(0,o.session)(),this.img=(0,o.derived)(this._img,["tag","raw","stale","eurl","eurlStale","previewEurl"]),this.imgFull=(0,o.derived)(this._imgFull,["tag","raw","stale","eurl","eurlStale"]),this.fallbackType=(0,o.derived)(this._fallbackType,["id"])}_img(){return this.raw?"data:image/jpeg;base64,"+this.raw:!this.tag&&this.stale?null:this.tag?l.GK.supportsFeature(l.GK.F.MD_BACKEND)?this.previewEurl:this.generateUrl("s"):void 0}_imgFull(){return!this.raw&&this.tag||!this.stale?!this.raw&&this.tag?l.GK.supportsFeature(l.GK.F.MD_BACKEND)?this.eurl:this.generateUrl("l"):void 0:null}_fallbackType(){return a.default.isUser(this.id)?p.SINGLE:(a.default.isGroup(this.id),p.GROUP)}markStale(e){this.stale=!0,(null==e?void 0:e.eurl)&&(this.eurlStale=!0)}validate(){if(this.stale||this.eurlStale)return this.getCollection().update(this.id)}generateUrl(e){let t={t:e,u:this.id.toString(),i:this.tag||"",n:this.token||""};return this.token||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("profilePicThumb::generateUrl: empty token for profile pic")),u.default.alive&&this.eurl&&!this.eurlStale&&(t=(0,i.default)({e:this.eurl},t)),d.URL.build(c.PP_URL,t)}canSet(){if(a.default.isGroup(this.id)){var e;const t=r(69951).ChatCollection.get(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!!this.id.equals((0,s.getMaybeMeUser)())}canDelete(){if(a.default.isGroup(this.id)&&this.tag){var e;const t=r(69951).ChatCollection.assertGet(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!(!this.id.equals((0,s.getMaybeMeUser)())||!this.tag)}getCollection(){return r(82039).ProfilePicThumbCollection}}f.Proxy="profilePicThumb",f.idClass=a.default;const _=(0,o.defineModel)(f);t.ProfilePicThumb=_},82039:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbCollectionImpl=t.ProfilePicThumbCollection=void 0;var i=n(r(41609)),a=r(50796),o=n(r(89867)),s=r(45454),l=r(1255),c=r(17239),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(99234),p=r(7293),f=n(r(64084)),_=r(41601),h=r(5018),g=r(93836),m=r(78521),y=r(77591);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}class S extends l.BaseCollection{get(e){const t=super.get(e);if(!this.modelClass.prototype.isIdType(e))return t;const r=super.get((0,f.default)(e.toString()));if(r){if(this.remove(r,{silent:!0}),t&&t.tag)return t;const n=r.toJSON();return n.id=e,this.add(n,{silent:!0,merge:!0})[0]}return t||void 0}saveToCache(){if(!c.Conn.shouldSaveToCache())return;const e=S.cachePolicy.id;let t=this.filter((e=>o.default.isWid(e.id)&&!!e.eurl&&!!e.token));t=t.map((function(e){const t=e.toJSON();return t.id=(0,f.default)(t.id.toString()),t})),__LOG__(2)`models:profilePic:cache-save: ${String(e)}`,(0,u.setCollection)(e,t)}initializeFromCache(e){if(!this.length||!e)return;const t=this.reduce(((e,t)=>(e[(0,f.default)(t.id.toString())]=t.id.toString(),e)),new Object);if((0,i.default)(t))return;const r=e.reduce(((e,r)=>(t[r.id]&&(r.id=(0,s.createWid)(t[r.id]),r.stale=!0,r.token&&e.push(r)),e)),[]);this.add(r,{merge:!0})}onResume(){const e=this.filter((e=>{const t=r(69951).ChatCollection.get(e.id);return e.hasObservers()&&e.stale&&(o.default.isUser(e.id)||o.default.isGroup(e.id))&&!(null==t?void 0:t.isReadOnly)})).map((e=>(e.tag||e.unset("tag",{silent:!0}),e)));this.resyncPictures(e)}_find(e){const t=r(69951).ChatCollection.get(e);if(null==t?void 0:t.isReadOnly)return p.GK.supportsFeature(p.GK.F.MD_BACKEND)?Promise.resolve({id:e,stale:!0}):(0,h.profilePicFindThumbFromPhone)(e,this.get(e)).then((e=>(e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e))).catch((0,a.filteredCatch)(d.ProtoVersionUndefined,(()=>({id:e,stale:!0}))));if(o.default.isUser(e)||o.default.isGroup(e)){const t={id:e};return(0,h.profilePicFind)(e).then((e=>(t.tag=e.tag,t.raw=null,t.eurl=e.eurl,t.eurlStale=!1,t.token=e.token,p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&(t.previewEurl=e.previewEurl),t))).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(e=>{switch(e.status){case 401:t.tag="",t.raw=void 0;break;case 423:case 429:t.stale=!0;break;default:t.tag=null,t.eurl=null,t.eurlStale=!1}return Promise.resolve(t)}))).catch((0,a.filteredCatch)(y.WebdDrop,(function(){return{id:e,stale:!0}})))}return Promise.resolve({id:e,tag:null})}imageChanged(e,t){const r=this.get(e);r&&(t===_.PROFILE_PIC_COMMAND.REMOVE?r.set({tag:void 0,eurl:void 0}):t!==_.PROFILE_PIC_COMMAND.SET&&r.tag===t||this.update(r.id).catch((0,a.filteredCatch)(y.WebdDrop,(()=>{}))))}resyncPictures(e){return 0===e.length?Promise.resolve():(0,h.profilePicResync)(e.map((function(e){return{id:e.id,tag:e.tag}}))).then((t=>{__LOG__(2)`ProfilePicThumbStore:resyncPictures success`,t.forEach((t=>{const r=this.get(t.id);r&&r.set({tag:t.tag,token:t.token,raw:void 0,stale:!1,eurl:t.eurl,eurlStale:!1,previewEurl:t.previewEurl}),e.forEach((e=>{e.eurlStale&&this.update(e.id)})),e.forEach((e=>{e.stale=!1}))}))})).catch((0,a.filteredCatch)(y.WebdDrop,(()=>{}))).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(e=>{423===e.status||429===e.status?__LOG__(3)`ProfilePicThumbStore:resyncPictures blocked ${e.status}`:e.status>=400&&__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))).catch((function(e){__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))}findThumbnailWid(e){return e.find((e=>{var t;return null===(t=this.get(e))||void 0===t?void 0:t.img}))}getThumbnailWidFromVcard(e){if(!e)return null;const t=(0,m.vcardWids)(e);if(!t)return;const r=this.findThumbnailWid(t);return r||(t.length?t[0]:null)}}t.ProfilePicThumbCollectionImpl=S,S.model=g.ProfilePicThumb,S.staleCollection=!0,S.resumeOnAvailable=!0,S.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:l.CACHE_POLICY.LOAD,delay:5e3};const v=new S;t.ProfilePicThumbCollection=v},31592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSendersCollection=t.ReactionsSenders=t.Reactions=t.AggReactionsCollection=t.AggReactions=void 0;var i=n(r(94654)),a=n(r(65212)),o=r(67811),s=r(45454),l=r(11290),c=n(r(31727)),d=r(19380);class u extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.msgKey=(0,l.prop)(),this.parentMsgKey=(0,l.prop)(),this.reactionText=(0,l.prop)(),this.timestamp=(0,l.prop)(),this.senderUserJid=(0,l.prop)(),this.read=(0,l.prop)(),this.orphan=(0,l.prop)(),this.senderObj=(0,l.session)(),this.parentMsg=(0,l.derived)(this._getParentMsg)}_getParentMsg(){return this._getMsgCollection().get(this.parentMsgKey)}initialize(){super.initialize(),this.addChild("senderObj",d.ContactCollection.gadd((0,s.createUserWid)(this.senderUserJid)))}_getMsgCollection(){return r(59871).MsgCollection}isEqual(e){return this.id.equals(e.id)}}u.Proxy="reactionsSenders",u.idClass=a.default;const p=(0,l.defineModel)(u);t.ReactionsSenders=p;class f extends c.default{}t.ReactionsSendersCollection=f,f.model=p,f.comparator=(e,t)=>(0,o.isReactionByMe)(e.senderUserJid)?-1:(0,o.isReactionByMe)(t.senderUserJid)?1:t.timestamp-e.timestamp;class _ extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.aggregateEmoji=(0,l.prop)(),this.hasReactionByMe=(0,l.prop)(),this.senders=(0,l.collection)(f)}}_.Proxy="aggReactions";const h=(0,l.defineModel)(_);t.AggReactions=h;class g extends c.default{}t.AggReactionsCollection=g,g.model=h,g.comparator=(e,t)=>{const r=t.senders.length-e.senders.length;if(e.hasReactionByMe)return-1;if(t.hasReactionByMe)return 1;if(0===r){const r=t.senders.at(0),n=e.senders.at(0);if(r&&n)return r.timestamp-n.timestamp}return r};class m extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.reactionByMe=(0,l.prop)(),this.reactions=(0,l.collection)(g)}unreadSenders(){return(0,i.default)(this.reactions.toArray(),(e=>e.senders.filter((e=>!e.read&&!(0,o.isReactionByMe)(e.senderUserJid))))).map((e=>{let{id:t,parentMsgKey:r,reactionText:n,senderUserJid:i}=e;return{msgKey:t,parentMsgKey:a.default.fromString(r),reactionText:n,senderUserJid:i}}))}getCollection(){return r(31464).ReactionsCollection}}m.Proxy="reactions",m.idClass=a.default;const y=(0,l.defineModel)(m);t.Reactions=y},31464:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsCollectionImpl=t.ReactionsCollection=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(67811),l=r(1255),c=r(70449),d=r(31592),u=r(75250);class p extends l.BaseCollection{_find(e){return(0,a.default)((function*(){const t=r(59871).MsgCollection,n=t.get(e);if(!n){const{messages:r}=yield t.getMessagesById([e]),n=r[0];return n?(0,u.sendQueryReactions)(n):Promise.reject(new l.CollectionSilentQueryError(`No message found for id: ${e}`))}return(0,u.sendQueryReactions)(n)}))()}addOrUpdateReaction(e){if(e.reactionText===s.REVOKED_REACTION_TEXT)return this.removeReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionSenderModel:r,reactionAggregateWithSender:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);if(n&&r){if(!(e.timestamp>r.timestamp))return;(0,s.isReactionByMe)(e.senderUserJid)&&this._removeSelfReaction(e),this._removeAggregateEmojiAndSender(t,r,n)}this._addNewReactionToAggregate(e,t)}}removeReaction(e){if((0,s.isReactionByMe)(e.senderUserJid))return this._removeSelfReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionAggregateWithSender:r,reactionSenderModel:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);r&&n&&(this._removeAggregateEmojiAndSender(t,n,r),n.trigger("revoked"))}else __LOG__(3)`reactions_collection:removeReaction no reactions model found`}_addNewReactionToAggregate(e,t){const r=c.EmojiUtil.getEmojiAggregate(e.reactionText),n=t.reactions.get(r),a=o.default.fromString(e.msgKey),l=(0,i.default)((0,i.default)({},e),{},{id:a}),d=(0,s.isReactionByMe)(e.senderUserJid);n?(d&&(n.set({hasReactionByMe:!0}),t.set({reactionByMe:e})),n.senders.add(l),t.reactions.sort(),n.trigger("change:senders")):(d&&t.set({reactionByMe:e}),t.reactions.add({aggregateEmoji:r,hasReactionByMe:d,id:r,senders:[l]}))}_removeAggregateEmojiAndSender(e,t,r){r.senders.remove(t.id),0===r.senders.length?e.reactions.remove(r.id):e.reactions.sort(),r.trigger("change:senders")}getAggregateEmojiAndSender(e,t){let r=null,n=null;for(let i=0;i<e.reactions.length;i++){const a=e.reactions.at(i),o=null==a?void 0:a.senders.findFirst((e=>e.senderUserJid===t));if(o){r=o,n=a;break}}return{reactionSenderModel:r,reactionAggregateWithSender:n}}_removeSelfReaction(e){const t=this.get(e.parentMsgKey);if(null==t||t.set({reactionByMe:null}),t){const{reactionAggregateWithSender:r,reactionSenderModel:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);null==r||r.set({hasReactionByMe:!1}),r&&n&&(this._removeAggregateEmojiAndSender(t,n,r),n.trigger("revoked"))}}markReactionsAsRead(e){e.forEach((e=>{const{parentMsgKey:t,msgKey:r,reactionText:n}=e,a=c.EmojiUtil.getEmojiAggregate(n),o=this.get(t);if(o){const e=o.reactions.get(a),t=null==e?void 0:e.senders.get(r);t?t.set((0,i.default)((0,i.default)({},t),{},{read:!0})):__LOG__(3)`reactions_collection:markReactionsAsRead Reaction sender model not found`}}))}deleteReactionsByParentMessageKey(e){this.remove(e)}}t.ReactionsCollectionImpl=p,p.model=d.Reactions;const f=new p;t.ReactionsCollection=f},53988:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return a.default.MEDIA_TYPE.NONE;switch(e){case i.default.SHOPS_STOREFRONT:return a.default.MEDIA_TYPE.SHOP_STOREFRONT;case i.default.NATIVE_FLOW:return a.default.MEDIA_TYPE.INTERACTIVE_NFM}};var i=n(r(84064)),a=n(r(11339))},26287:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getNativeFlowNameByButtonName=function(e){switch(e){case"review_and_pay":return i.default.ORDER_DETAILS;case"review_order":return i.default.ORDER_STATUS}},t.isValidNativeFlowMessage=void 0;var i=n(r(5165)),a=r(34841),o=r(88998);t.isValidNativeFlowMessage=e=>{if(null==e.nativeFlowName)return!1;switch(e.nativeFlowName){case i.default.ORDER_DETAILS:return null!=(0,a.getOrderInfo)(e);case i.default.ORDER_STATUS:return null!=(0,o.getOrderStatusInfo)(e)}}},34841:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderInfo=t.getOrderInfo=void 0;var i=r(15461),a=n(r(84064)),o=n(r(5165)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(69340));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function c(e){var t;const r=null==e?void 0:e.value;if(null==r)return;const n=null!==(t=null==e?void 0:e.offset)&&void 0!==t?t:1;return parseFloat(null!=r?r:0)/parseInt(n,10)}const d=(e,t)=>{var r,n;if("review_and_pay"!==e||null==t)return null;const i=s.parse(t),{order:a,currency:o,reference_id:l}=i,d=c(i.total_amount),u=null!==(r=null==a?void 0:a.items)&&void 0!==r?r:[],p=u.map((e=>{var t,r,n,i;return{id:null!==(t=null!==(r=null==e?void 0:e.product_id)&&void 0!==r?r:null==e?void 0:e.retailer_id)&&void 0!==t?t:"",name:null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"",amount:c(null==e?void 0:e.amount),quantity:parseInt(null!==(i=null==e?void 0:e.quantity)&&void 0!==i?i:0,10)}})),f=p.reduce(((e,t)=>e+t.quantity),0),_=null===(n=u[0])||void 0===n?void 0:n.name;if(null==_||null==l||null==o||null==d)return null;return{title:_,referenceId:l,currency:o,quantity:f,shipping:c(null==a?void 0:a.shipping),tax:c(null==a?void 0:a.tax),discount:c(null==a?void 0:a.discount),subtotal:c(null==a?void 0:a.subtotal),totalAmount:d,items:p}};t.paramsJsonToOrderInfo=d;t.getOrderInfo=e=>{var t;if(e.nativeFlowName!==o.default.ORDER_DETAILS)return null;if(e.type===i.MSG_TYPE.INTERACTIVE&&e.interactiveType===a.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:r}=e.interactivePayload.buttons[0];return d(t,r)}if(e.type===i.MSG_TYPE.NATIVE_FLOW){var r;const{nativeFlowInfo:t}=(null!==(r=e.nativeFlowButtons)&&void 0!==r?r:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}}},88998:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderStatusInfo=t.getOrderStatusInfo=t.getOrderMessage=t.getDefaultOrderStatus=t.findOrderStatusMessage=t.findOrderStatus=t.findOrderDetailsMessage=t.OrderStatus=void 0;var i=n(r(30988)),a=r(15461),o=n(r(84064)),s=n(r(5165)),l=r(34841);const c=r(76672)({Pending:"pending",Processing:"processing",PartiallyShipped:"partially_shipped",Shipped:"shipped",Complete:"completed",Canceled:"canceled"});t.OrderStatus=c;const d=(e,t)=>{if("review_order"!==e||null==t)return null;const{order:r,reference_id:n}=JSON.parse(t),i=c.cast(null==r?void 0:r.status);return null==i||null==n?null:{refId:n,status:i}};t.paramsJsonToOrderStatusInfo=d;const u=e=>{var t;if(e.nativeFlowName!==s.default.ORDER_STATUS)return null;if(e.type===a.MSG_TYPE.INTERACTIVE&&e.interactiveType===o.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:r}=e.interactivePayload.buttons[0];return d(t,r)}if(e.type===a.MSG_TYPE.NATIVE_FLOW){var r;const{nativeFlowInfo:t}=(null!==(r=e.nativeFlowButtons)&&void 0!==r?r:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}};t.getOrderStatusInfo=u;const p=(e,t)=>{var r;const n=e.msgs.getModelsArray().slice(-1e3);return null===(r=(0,i.default)(n,(e=>{var r;return e.nativeFlowName===s.default.ORDER_DETAILS&&(null===(r=(0,l.getOrderInfo)(e))||void 0===r?void 0:r.referenceId)===t})))||void 0===r?void 0:r.safe()};t.findOrderDetailsMessage=p;t.getOrderMessage=e=>{var t;const r=null===(t=u(e))||void 0===t?void 0:t.refId;return null==r?null:p(e.chat,r)};const f=(e,t)=>{var r;const n=e.msgs.getModelsArray().slice(-1e3);return null===(r=(0,i.default)(n,(e=>{var r;return e.nativeFlowName===s.default.ORDER_STATUS&&(null===(r=u(e))||void 0===r?void 0:r.refId)===t})))||void 0===r?void 0:r.safe()};t.findOrderStatusMessage=f;const _=()=>c.Processing;t.getDefaultOrderStatus=_;t.findOrderStatus=(e,t)=>{var r;const n=f(e,t),i=null!=n?u(n):null;return null!==(r=null==i?void 0:i.status)&&void 0!==r?r:_()}},90837:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateOrderAndSendReceipt=void 0;var n=r(69951),i=r(88998),a=r(99326);const o=new Set([i.OrderStatus.Complete,i.OrderStatus.Canceled]);t.validateOrderAndSendReceipt=(e,t)=>{if(!e)return!0;const r=n.ChatCollection.get(e.toString());if(!r)return!0;const s=(0,i.getOrderStatusInfo)(t);if(!s)return!0;const l=(0,i.findOrderStatusMessage)(r,s.refId);if(!l)return!0;const c=(0,i.getOrderStatusInfo)(l);if(!c)return!0;if(c.status===s.status)return!1;const d=s.status!==i.OrderStatus.Pending&&!o.has(c.status);return d||(0,a.sendOrderStatusUpdateFailureReceipt)(t,a.BizErrorReason.InvalidTransition),d}},99326:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BizErrorReason=void 0,t.sendOrderStatusUpdateFailureReceipt=function(e,t){(0,i.castStanza)((0,n.wap)("receipt",{type:"error",to:(0,n.CUSTOM_STRING)(e.from.toJid()),id:(0,n.CUSTOM_STRING)(e.id.id)},(0,n.wap)("biz",{reason:(0,n.CUSTOM_STRING)(String(t))}),(0,n.wap)("error",{type:"order-status-update-failed"})))};var n=r(31914),i=r(24747);const a=r(76672)({InvalidTransition:"invalid-transition",CancellationFailed:"cancellation-failed"});t.BizErrorReason=a},84728:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIEW_ONCE_EXPIRE_AFTER=void 0,t.isExpired=c,t.isUnviewed=function(e){return!l(e)&&!c(e)},t.isViewed=l,t.setViewOnceTestExpire_INTERNAL=function(){};var n=r(35470),i=r(22683),a=r(31019);let o=1209600;function s(e){const t=(0,a.unproxy)(e);return null!=t?t.asViewOnce:null}function l(e){var t;return(null===(t=s(e))||void 0===t?void 0:t.ack)===n.ACK.PLAYED}function c(e){const t=s(e);if(null==t)return!1;const r=i.Clock.globalUnixTime()-(0,a.unproxy)(t).t;return!l(t)&&r>=o}t.VIEW_ONCE_EXPIRE_AFTER=o},64551:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ServerPropsImpl=t.ServerProps=t.DEFAULT_MAX_FILE_SIZE_BYTES=void 0,t.getMaxFilesSizeServerProp=function(){return y.maxFileSize};var i=r(11290),a=r(7293),o=n(r(11339)),s=r(40264),l=n(r(23082));const c={imageMaxKBytes:function(e){if("number"==typeof e&&e>0)return 1024*e},pttConversationWaveform:function(e){return Boolean(e)},pttOotPlayback:function(e){return Boolean(e)},pttRememberPlayPosition:function(e){return Boolean(e)},pttWaveformSend:function(e){return!!a.GK.supportsFeature(a.GK.F.PTT_WAVEFORM_SEND)&&Boolean(e)},pttPausableEnabled:function(e){return Boolean(e)},pttForwardedFeaturesEnabled:function(e){return Boolean(e)},maxParticipants:function(e){if("number"==typeof e&&e>0)return e-1},media:_,maxElectronFileSize:f,maxFileSize:f,streamingUploadChunkSize:_,groupDescLength:h,statusVideoMaxDuration:h,muteAlways:g,viewOnceRead:g,viewOnceWrite:g,ctwaContextRender:g,serverPropsVersion:h,wallpapersV2:g,hfmStringChanges:g,webServerStickerPanel:g,shopsProductGrid:g,stickerMaker:function(e){return Boolean(e)},downloadHostSwitchingEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_MEDIA_CACHE)&&(!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_HOST_SWITCHING_ENABLED)&&Boolean(e))},uploadHostSwitchingEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.UPLOAD_HOST_SWITCHING_ENABLED)&&Boolean(e)},webUploadDocumentThumbMmsEnabled:m,webDownloadDocumentThumbMmsEnabled:m,webDownloadStatusThumbMmsEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&Boolean(e)}},d=104857600;t.DEFAULT_MAX_FILE_SIZE_BYTES=d;const u=604800;class p extends i.BaseModel{constructor(){super(...arguments),this.serverPropsVersion=(0,i.prop)(),this.gifSearch=(0,i.prop)(!1),this.imageMaxEdge=(0,i.prop)(1600),this.imageMaxKBytes=(0,i.prop)(1048576),this.maxParticipants=(0,i.prop)(101),this.maxSubject=(0,i.prop)(25),this.media=(0,i.prop)(16777216),this.maxElectronFileSize=(0,i.prop)(d),this.maxFileSize=(0,i.prop)(d),this.streamingUploadChunkSize=(0,i.prop)(0),this.groupDescLength=(0,i.prop)(0),this.multicastLimitGlobal=(0,i.prop)(5),this.frequentlyForwardedThreshold=(0,i.prop)(5),this.frequentlyForwardedMax=(0,i.prop)(1),this.ephemeralMessagesAllowedValues=(0,i.prop)("604800"),this.productMediaAttachments=(0,i.prop)(!1),this.muteAlways=(0,i.prop)(!1),this.viewOnceRead=(0,i.prop)(!1),this.viewOnceWrite=(0,i.prop)(!1),this.wallpapersV2=(0,i.prop)(!1),this.hfmStringChanges=(0,i.prop)(!1),this.mmsVCacheAggregationEnabled=(0,i.prop)(!1),this.mmsHotContentTimespan=(0,i.prop)(0),this.mmsCatV1ForwardHotOverrideEnabled=(0,i.prop)(!1),this.pttConversationWaveform=(0,i.prop)(!1),this.pttOotPlayback=(0,i.prop)(!1),this.pttPausableEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedHideDelay=(0,i.prop)(1500),this.pttWaveformSend=(0,i.prop)(!1),this.pttRememberPlayPosition=(0,i.prop)(!1),this.pttForwardedFeaturesEnabled=(0,i.prop)(!1),this.templateDocMimeTypes=(0,i.prop)(1),this.mmsMediaKeyTTL=(0,i.prop)(1/0),this.vcardAsDocumentSizeKb=(0,i.prop)(0),this.vcardMaxSizeKb=(0,i.prop)(1e3),this.mmsVcardAutodownloadSizeKb=(0,i.prop)(1024),this.webUploadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webDownloadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webSendDocumentThumbInMessageDisabled=(0,i.prop)(!1),this.webDownloadStatusThumbMmsEnabled=(0,i.prop)(!1),this.statusVideoMaxDuration=(0,i.prop)(30),this.groupCallMaxParticipants=(0,i.prop)(0),this.webVoipMacOsMinVersion=(0,i.prop)(""),this.webVoipWindowsOsMinVersion=(0,i.prop)(""),this.ctwaContextRender=(0,i.prop)(!1),this.ctwaContextCompose=(0,i.prop)(!1),this.syncdInlineMutationsMaxCount=(0,i.prop)(1e3),this.syncdPatchProtobufMaxSize=(0,i.prop)(100),this.syncdKeyMaxUseDays=(0,i.prop)(30),this.syncdWaitForKeyTimeoutDays=(0,i.prop)(2),this.syncdAdditionalMutations=(0,i.prop)(1),this.syncdSentinelTimeoutSeconds=(0,i.prop)(3),this.syncdPatchDeviceIndexIncluded=(0,i.prop)(!1),this.syncdClearChatDeleteChatEnabled=(0,i.prop)(!1),this.syncdPinChatEnabled=(0,i.prop)(!1),this.webPaymentBackgroundEnabled=(0,i.prop)(!1),this.webBizProfileOptions=(0,i.prop)(3),this.webBizProfileEdit=(0,i.prop)(!1),this.webBizProfileV3Enabled=(0,i.prop)(!1),this.webBizProfileV3M2=(0,i.prop)(!1),this.mdBlocklistV2=(0,i.prop)(!1),this.webShopsChatHeaderButtonEnabled=(0,i.prop)(!1),this.shopsHideCatalogAttachmentEntrypoint=(0,i.prop)(!1),this.shopsHeaderDropdownMenuItem=(0,i.prop)(!1),this.shopsProductGrid=(0,i.prop)(!1),this.webListMessage=(0,i.prop)(!1),this.webCart=(0,i.prop)(!1),this.webCartV11OrderMessageChanges=(0,i.prop)(!1),this.webButtonsMessage=(0,i.prop)(!1),this.greenAlertBannerDuration=(0,i.prop)(0),this.webSMBUpsellInBizProfile=(0,i.prop)(!1),this.webProductListMessageFallback=(0,i.prop)(!1),this.webProductListMessage=(0,i.prop)(!1),this.webProductListMessageRenderKillSwitch=(0,i.prop)(!1),this.webProductListMessagePageSize=(0,i.prop)(s.PRODUCT_PAGE_SIZE),this.webMediaAutoDownloadEnabled=(0,i.prop)(!1),this.webYouTubePlayerEnhancements=(0,i.prop)(!1),this.webServerStickerPanel=(0,i.prop)(!1),this.webCollectionsDisplay=(0,i.prop)(!1),this.webCollectionsManagement=(0,i.prop)(!1),this.webCollectionsAppealEnabled=(0,i.prop)(!1),this.webCartOnOffToggle=(0,i.prop)(!1),this.downloadHostSwitchingEnabled=(0,i.prop)(!1),this.uploadHostSwitchingEnabled=(0,i.prop)(!1),this.isDirectConnectionForPLMTransparent=(0,i.prop)(!0),this.webPipRedesign=(0,i.prop)(!1),this.blockCatalogCreationEcommerceComplianceIndia=(0,i.prop)(!1),this.ecommerceComplianceIndia=(0,i.prop)(!1),this.editEcommerceComplianceIndia=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4_5=(0,i.prop)(!1),this.webMdMigrationExperience=(0,i.prop)(!1),this.stickerMaker=(0,i.prop)(!1),this.webLogUploadDownloadCrashes=(0,i.prop)(!1),this.webLargeFilesUi=(0,i.prop)(!1),this.webMdMmsSyncDeletionRequest=(0,i.prop)(!0),this.webForwardingLimitToGroups=(0,i.prop)(!1)}delete(){super.delete(),this.updateProps({})}initialize(){super.initialize()}updateProps(e){let t=e;o.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let r=t[e];void 0===r?r="serverPropsVersion"===e?this.serverPropsVersion:this.getDefault(e):c[e]&&(r=c[e](r),void 0===r&&(r=this.getDefault(e))),this.set(e,r)}));for(const e in a.GK.F)void 0!==t[e]&&a.GK.setFeature(e,t[e])}updateSelectiveProps(e){let t=e;o.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let r=t[e];void 0!==r&&(c[e]&&(r=c[e](r),void 0===r&&(r=this.getDefault(e))),this.set(e,r))}));for(const r in a.GK.F)void 0!==t[r]&&a.GK.setFeature(r,e[r])}extendAndOverrideFromURLParams(e){const t=new l.default(window.location.search),r=e;return this.__props.forEach((e=>{if(!0===t.has(e)){const n=t.get(e);if(null==n)return;"true"===n||"false"===n?r[e]="true"===n:isNaN(n)||isNaN(parseFloat(n))?r[e]=n:r[e]=parseFloat(n)}})),r}handlePayload(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}handle(e){const t=e.shift();this.handlePayload(t)}getGroupCallMaxParticipants(){return this.groupCallMaxParticipants}getEphemeralMessagesAllowedValues(){try{return this.ephemeralMessagesAllowedValues.split(",").map((e=>parseInt(e,10)))}catch(e){return __LOG__(4,void 0,new Error,!0)`[ephemeral] incorrect type for ephemeralMessagesAllowedValues`,SEND_LOGS("ephemeral"),[u]}}}function f(e){return _(e)}function _(e){if("number"==typeof e&&e>0)return 1024*e*1024}function h(e){if("number"==typeof e&&e>0)return e}function g(e){if("number"==typeof e)return!!e}function m(e){return Boolean(e)}t.ServerPropsImpl=p,p.Proxy="serverProps";const y=new((0,i.defineModel)(p))({id:"1"});t.ServerProps=y},68132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50796),i=r(11290),a=r(57701),o=r(80208),s=r(77591);const l={classic:!1,enabled:!1},c={timestamp:0};class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.archive=(0,i.prop)(),this.disappearingMode=(0,i.prop)(),this.mdOptInDeadline=(0,i.prop)(),this.showArchiveV2=(0,i.derived)(this._showArchiveV2,["archive","enabled"])}delete(){this.set({archive:l,disappearingMode:l,mdOptInDeadline:c}),super.delete()}_showArchiveV2(){return!!this.archive.enabled&&!this.archive.classic}handleResponse(e){e.length?e.forEach((e=>{switch(__LOG__(2)`Settings: received setting type: ${e.type}`,e.type){case o.ARCHIVE_SETTINGS_KEY:var t;if(!(0,a.archiveV2Supported)()){__LOG__(4,void 0,new Error,!0)`Settings:handleResponse archive settings response is unsupported`,SEND_LOGS("archive-setting-unsupported");break}this.set({archive:{classic:e.value.classic,enabled:null!==(t=e.value.enabled)&&void 0!==t?t:this.archive.enabled}});break;case o.DISAPPEARING_MODE_SETTINGS_KEY:this.set({disappearingMode:{duration:e.value.duration,settingTimestamp:e.value.settingTimestamp}});break;case o.MD_OPT_IN_DEADLINE_SETTINGS_KEY:this.set({mdOptInDeadline:{timestamp:e.value.timestamp}})}})):__LOG__(2)`Settings: received empty settings`,r(96876).default.processMdOptInDeadline()}sync(e){const t="Settings:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,r(56891).default.querySettings)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.settings)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,n.filteredCatch)(s.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("settings-query-failed")}))}}d.Proxy="settings";var u=new((0,i.defineModel)(d))({id:"default_settings_id",archive:l,disappearingMode:{duration:0,settingTimestamp:0},mdOptInDeadline:c});t.default=u},11810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(33856)),a=n(r(29521)),o=n(r(63105)),s=r(1255),l=r(7293),c=r(17304),d=r(59871),u=r(62583),p=r(65044);class f extends s.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(p.Socket,"change:stream",(()=>{p.Socket.stream===u.SOCKET_STREAM.DISCONNECTED&&(this.isSynced=!1)}))}onResume(){this.isSynced=!1,this.sync()}maySync(){return l.GK.supportsFeature(l.GK.F.STARRED_GIFS)}sync(){return this.isSynced?Promise.resolve():this.syncPromise?this.syncPromise:this.maySync()?(this.syncPromise=d.MsgCollection.getStarred(void 0,void 0,void 0,!0).then((e=>{let t=[];(null==e?void 0:e.length)&&(t=(0,o.default)(e,(e=>(null==e?void 0:e.isGif)&&!e.isUnsentMedia))),this.set(t)})).catch((e=>{499!==e&&__LOG__(3)`starred gif msgs sync error: `})).finally((()=>{this.syncPromise=null,this.isSynced=!0})),this.syncPromise):Promise.resolve()}add(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let r=this.isModel(e)?[e]:e;return r=(0,a.default)((0,o.default)(r,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.add(r,t)}remove(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let r=this.isModel(e)?[e]:e;return r=(0,i.default)((0,o.default)(r,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.remove(r,t)}}f.model=c.Msg,f.comparator=function(e,t){return t.t-e.t};var _=new f;t.default=_},19011:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=t.AllStarredMsgsCollection=void 0,t.addStarredMsgs=function(e){f.add(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),d.default.add(e)},t.removeStarredMsgs=_;var i=n(r(45095)),a=r(13042),o=r(1255),s=r(17304),l=r(59871),c=r(62583),d=n(r(11810)),u=r(65044);class p extends o.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(u.Socket,"change:stream",(()=>{u.Socket.stream===c.SOCKET_STREAM.DISCONNECTED?this.isSynced=!1:u.Socket.stream===c.SOCKET_STREAM.CONNECTED&&this.delete()}))}process(e,t,r,n){n?this.delete():this.updateMsgs(e,t,r)}sync(e){if(this.isSynced)return Promise.resolve();if(null!=this.syncPromise)return this.syncPromise;const t=this;let r;const n=this.last();return n&&(r=n.id),this.syncPromise=l.MsgCollection.getStarred(e,a.PAGE_SIZE,r).then((function(e){e.length&&t.add(e,{silent:!0}),e.length<a.PAGE_SIZE&&(t.isSynced=!0)})).catch((function(){__LOG__(3)`starred msg sync error: `})).finally((()=>{t.syncPromise=null,t.trigger("sync")})),this.trigger("sync"),(0,i.default)(this.syncPromise,"syncPromise can not be null")}updateMsgs(e,t,r){const n=this.syncPromise||Promise.resolve();this.syncPromise=n.then((()=>{if(e){return(t.length>0?l.MsgCollection.incrementalStarredUpdate(t):Promise.resolve([])).then((e=>{const t=e.concat(r);this.isSynced&&(this.add(t,{silent:!0}),d.default.add(e)),t.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),this.trigger("sync")})).catch((()=>{__LOG__(3)`models:starred:update:error: `}))}_(t.concat(r).filter((e=>!e.star)))})).finally((()=>{this.syncPromise=null}))}delete(){this.isSynced=!1,super.delete()}}let f;function _(e){f.remove(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}))}t.StarredMsgCollection=p,p.model=s.Msg,p.comparator=(e,t)=>t.t-e.t,t.AllStarredMsgsCollection=f,t.AllStarredMsgsCollection=f=new p},67234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89867)),a=r(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.status=(0,a.prop)(),this.stale=(0,a.session)(!0)}getCollection(){return r(46133).StatusCollection}}o.Proxy="status",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},46133:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCollectionImpl=t.StatusCollection=void 0;var i=r(50796),a=n(r(89867)),o=r(45454),s=r(1255),l=n(r(67234)),c=r(82350),d=r(77591);class u extends s.BaseCollection{onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,i.filteredCatch)(d.WebdDrop,(()=>{})))}))}_find(e){const t=e instanceof a.default?e:(0,o.createWid)(e);return(0,c.getStatus)(t)}handle(e){let[t]=e;const r=this.get(t.id);r&&(r.status=t.status,r.stale=!1)}}t.StatusCollectionImpl=u,u.model=l.default,u.idClass=a.default,u.staleCollection=!0,u.resumeOnAvailable=!0;const p=new u;t.StatusCollection=p},47896:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(13042),o=n(r(89867)),s=n(r(15421)),l=r(11290),c=r(22683),d=r(19380),u=r(51316),p=r(30631),f=n(r(58492));const _=86400;class h extends f.default{constructor(){super(...arguments),this.id=(0,l.prop)(),this.t=(0,l.prop)(),this.unreadCount=(0,l.prop)(0),this.totalCount=(0,l.prop)(0),this.pic=(0,l.prop)(),this._msgs=(0,l.prop)((()=>[])),this.readKeys=(0,l.session)((()=>({}))),this.contact=(0,l.session)(),this.expireTimer=(0,l.session)(),this.expireTs=(0,l.session)(),this.hasUnread=(0,l.derived)(this._hasUnread,["unreadCount"]),this.readCount=(0,l.derived)(this._readCount,["unreadCount","totalCount"]),this.lastStatus=(0,l.derived)(this._lastStatus,["msgsChanged","totalCount"])}_hasUnread(){return this.unreadCount>0}_readCount(){const e=this.totalCount-this.unreadCount;return Number.isFinite(e)?e:(__LOG__(3)`Bad status v3 read count, ${this.totalCount}, ${this.unreadCount}`,0)}_lastStatus(){return this.msgs.last()}initialize(){super.initialize(),this.addChild("contact",d.ContactCollection.gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",(()=>{window.setTimeout((()=>{this.setupStatusExpiration()}))})),this.listenTo(this,"change:lastStatus",(()=>{this.lastStatus&&(this.t=this.lastStatus.t)}))}isExpired(){return this.id.isPSA()?(0,p.isExpiredStatusPSA)(this.msgs.toArray(),_):c.Clock.globalUnixTime()-this.t>_}setupStatusExpiration(){const e=this.msgs.at(0);if(!e)return;if("number"==typeof this.expireTs&&this.expireTs<=e.t)return;const t=e.t+_+1;t<c.Clock.globalUnixTime()?window.setTimeout((()=>{this.expireMsg()})):(this.expireTimer=s.default.setGlobalTimeout(this.expireMsg.bind(this),1e3*t,this.expireTimer),this.expireTs=e.t)}_removeSingleMsg(e){const t=this.msgs;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,t.remove(e),e.delete()}expireMsg(){if(this.id.isPSA())return void this.expirePSAMsg();const e=this.msgs;for(;e.length>0;){const t=e.at(0);if(!t)break;if(t.t+_>c.Clock.globalUnixTime())break;this._removeSingleMsg(t)}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}expirePSAMsg(){const e=(0,p.getPSACampaigns)(this.msgs.toArray());this.msgs.forEach((t=>{const{campaignId:r}=t;if(null==r)return;(0,p.isCampaignExpired)(e[r],_)&&this._removeSingleMsg(t)})),this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}revokeMsgs(e){this.msgs.forEach((t=>{e.includes(t.id)&&this._removeSingleMsg(t)})),0===this.totalCount&&(this.expireTs=void 0,this.expireTimer=void 0)}delete(){__LOG__(2)`Status v3 deleted with total count: ${this.totalCount}`,super.delete(),this.expireTimer&&s.default.clearTimeout(this.expireTimer),null!=this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}onEmptyMRM(){__LOG__(2)`Status V3 onEmptyMRM with total count: ${this.totalCount}, noEarlierMsgs: ${this.msgs.msgLoadState.noEarlierMsgs?"true":"false"}`,this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?this.delete():this.totalCount>0&&this.loadMore().catch((()=>{})).finally((()=>{this.msgs.length||this.delete()}))}loadMore(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.PAGE_SIZE;return(0,i.default)((function*(){if(e.msgs.msgLoadState.noEarlierMsgs)return Promise.resolve();if(e.msgs.msgLoadState.isLoadingEarlierMsgs)return e.msgs.loadEarlierPromise;const r=0!==t?t:a.PAGE_SIZE,n=e.getCollection();try{const t=yield n.loadMore(e.id,r,e.msgs.last());return Array.isArray(t)&&t.length<r&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t}catch(t){return 404===t&&e.delete(),Promise.reject(t)}}))()}handleReadStatus(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}sendReadStatus(e,t,r){var n=this;return(0,i.default)((function*(){(yield(0,u.sendReadStatus)(e,t,r))&&n.handleReadStatus(e)}))()}getCollection(){return r(59387).StatusV3Collection}}h.Proxy="statusV3",h.idClass=o.default;var g=(0,l.defineModel)(h);t.default=g},59387:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3CollectionImpl=t.StatusV3Collection=void 0;var i=n(r(48926)),a=n(r(41609)),o=n(r(63105)),s=n(r(35161)),l=n(r(12297)),c=r(50796),d=r(52230),u=r(45454),p=r(86945),f=r(1255),_=r(22683),h=r(99234),g=r(7293),m=n(r(11339)),y=r(59871),E=n(r(34949)),S=r(51316),v=n(r(47896)),T=r(77591);class C extends f.BaseCollection{delete(){super.delete(),delete this.checksum}_find(e){return Promise.resolve({id:e})}findQuery(e,t){var r=()=>super.findQuery,n=this;return(0,i.default)((function*(){const i=(yield r().call(n,e,t))||[];return yield Promise.all(i.map((e=>{if(!e)return;let t=0;return e.msgs.forEach((r=>{t<e._msgs.length&&e._msgs[t].id.toString()===r.id.toString()?++t:r.delete()})),e._msgs.length>0?n.addStatusMessages(e.id,e._msgs):Promise.resolve()}))),i}))()}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield(0,S.queryStatusAll)();return e.checksum=t.checksum,Promise.all(t.statuses.map((e=>{e.totalCount!==e._msgs.length&&e.totalCount<=20&&__LOG__(3)`Received ${e._msgs.length} status V3 messages when total count is ${e.totalCount} for ${e.id}`;const t=e.pic;return t?E.default.createFromData(t,"image/jpeg").then((t=>(e.pic=t,e))):e})))}))()}loadMore(e,t,r){return(0,i.default)((function*(){const n=yield(0,S.queryStatusUpdate)(e,t,null==r?void 0:r.id);return n.status>=400?(__LOG__(3)`model:statusv3:findQuery error ${n.status}`,Promise.reject(n.status)):(n.forEach((function(e){e.invis=!0})),__LOG__(2)`model:statusv3:loadMore:${n.length}`,y.MsgCollection.processMultipleMessages((0,u.createWid)(d.STATUS_JID),n,{add:"after",isHistory:!0}))}))()}sync(e){const t=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()}).catch((0,c.filteredCatch)(T.WebdDrop,(()=>{}))).finally((()=>{this.trigger("sync")})).then((e=>{const r=window.performance.now(),n=Math.round(r-t);return this.logMetrics({type:"sync",syncTime:n}),this.forEach((e=>{e.msgs.length>e.totalCount&&__LOG__(2)`Total count: ${e.totalCount}, msgs length: ${e.msgs.length}`})),e})):Promise.resolve(void 0)}logMetrics(e){let t;t="sync"===e.type?new m.default.WebcStatusSync({webcStatusSyncT:e.syncTime}):new m.default.WebcStatusSession({webcStatusSessionId:e.sessionId});const r=this.filter((e=>!e.contact.isMe)),n=r.filter((e=>!e.contact.statusMute)),i=n.filter((e=>e.hasUnread)),a=n.filter((e=>!e.hasUnread)),o=r.filter((e=>e.contact.statusMute)),s=(0,l.default)(n.map((e=>e.unreadCount))),c=(0,l.default)(n.map((e=>e.readCount))),d=(0,l.default)(o.map((e=>e.totalCount)));t.webcStatusRecentItemCount=s,t.webcStatusRecentRowCount=i.length,t.webcStatusViewedItemCount=c,t.webcStatusViewedRowCount=a.length,t.webcStatusMutedItemCount=d,t.webcStatusMutedRowCount=o.length,t.commit()}hasSynced(){return!!g.GK.supportsFeature(g.GK.F.MD_BACKEND)||!!this.checksum}handleUpdate(e,t,r){const n=e.id.fromMe?(0,h.getMaybeMeUser)():e.author;if(this.updateChecksum(t),this.hasSynced()){if(r)return!0;const t=this.get(n);if(t){const r=g.GK.supportsFeature(g.GK.F.MD_BACKEND)||t.totalCount===t.msgs.length;if("sender_revoke"===e.subtype){const r=t.msgs.toArray().slice(0,t.totalCount-t.unreadCount),n=(0,s.default)(r,(e=>e.id.toString())),i={totalCount:t.totalCount-1};n.find((t=>t===e.protocolMessageKey.toString()))||t.readKeys[e.protocolMessageKey.toString()]||(i.unreadCount=t.unreadCount-1),t.set(i)}else{const r={totalCount:t.totalCount+1};e.invis||(r.unreadCount=t.unreadCount+1),r.t=e.t,t.set(r)}return!r&&e.body&&E.default.createFromBase64Jpeg(e.body).then((e=>{t.pic=e})),r}return this.add({id:n,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}updateChecksum(e){e?this.hasSynced()&&(this.checksum=e):__LOG__(2)`models:statusV3:no_checksum`}handle(e){const t=e.shift();if(Array.isArray(t))__LOG__(3)`models:statusV3:unexpected update`;else switch(t.type){case"read":this.updateChecksum(t.checksum);const e=this.get(t.chat);e?e.handleReadStatus(t.key):__LOG__(2)`models:statusV3:read:no_status:${[t.chat,t.key].join()}`;break;default:__LOG__(3)`models:statusV3:unknown:${t.type}`}}addStatusMessages(e,t){return y.MsgCollection.processMultipleMessages((0,u.createWid)(d.STATUS_JID),t,{add:"after",isHistory:!0})}getUnexpired(e){let t=!1;g.GK.supportsFeature(g.GK.F.MD_BACKEND)&&(t=(0,p.getABPropConfigValue)("web_status_psa"));const r=this.filter((e=>!(e.totalCount<=0)&&(!e.isExpired()&&(!e.contact.isMe&&(!!e.contact.isMyContact||!!e.contact.isPSA&&t)))));if(t&&r.sort(((e,t)=>e.contact.isPSA===t.contact.isPSA?0:e.contact.isPSA?-1:1)),e){return(0,o.default)(r,(e=>e.unreadCount>0))}return(0,o.default)(r,(e=>0===e.unreadCount))}getMyStatus(){const e=this.filter((e=>e.contact.isMe));if(!((0,a.default)(e)||_.Clock.globalUnixTime()-e[0].t>86400))return e[0]}getPSAStatus(){const e=this.filter((e=>e.contact.isPSA));if(0!==e.length)return e[0]}}t.StatusV3CollectionImpl=C,C.model=v.default,C.comparator=(e,t)=>t.t-e.t;const A=new C;t.StatusV3Collection=A},77040:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.sticker=(0,n.prop)(),this.timestamp=(0,n.prop)(),this.stickerHashWithoutMeta=(0,n.prop)()}}i.Proxy="favoriteSticker";var a=(0,n.defineModel)(i);t.default=a},70723:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(1255),o=n(r(57905)),s=r(22683),l=n(r(77040)),c=r(50338),d=r(55975),u=r(76214),p=r(99718);class f extends a.BaseCollection{_addSaveTask(){this._idleTaskId&&c.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=c.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=[];e.toArray().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,sticker:e.sticker.toDbData(),stickerHashWithoutMeta:e.stickerHashWithoutMeta};t.push(r)}));try{const e=(0,u.getFavoriteStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`FavoriteStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}_dbDataToModel(e){return new l.default({id:e.id,timestamp:e.timestamp,stickerHashWithoutMeta:e.stickerHashWithoutMeta,sticker:new p.StickerModel(e.sticker)})}_getStickerHashWithoutMeta(e){return(0,i.default)((function*(){const t=yield d.LruMediaStore.get(e);return null==t?e:(0,o.default)(t)}))()}addNewSticker(e){var t=this;return(0,i.default)((function*(){if(t.get(e.filehash))return;const r=new l.default({id:e.filehash,sticker:e,stickerHashWithoutMeta:yield t._getStickerHashWithoutMeta(e.filehash),timestamp:s.Clock.globalUnixTime()});t.add(r),t._addSaveTask()}))()}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.remove(e,t);return r.length&&this._addSaveTask(),r}initializeFromCache(e){const t=e.map((e=>this._dbDataToModel(e)));this.add(t),this._addSaveTask()}}f.model=l.default;var _=new f;t.default=_},14048:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,n.getABPropConfigValue)("web_sticker_store")};var n=r(86945)},20238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.sticker=(0,n.prop)(),this.timestamp=(0,n.prop)(),this.msgId=(0,n.prop)()}}i.Proxy="recentSticker";var a=(0,n.defineModel)(i);t.default=a},91692:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionImpl=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=n(r(48926)),a=n(r(81109)),o=n(r(6479)),s=n(r(78403)),l=n(r(45095)),c=r(1255),d=r(17239),u=r(7293),p=r(99718),f=n(r(56891));const _=["weight"],h=32;t.RECENT_STICKERS_LIMIT=h;class g extends c.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._weightMap=new Map,this._sortTrimScale=()=>{const e=this.length;if(!e)return;if(this.sort(),e>h){for(let t=h;t<e;t++)this._weightMap.delete((0,l.default)(this.at(t),"this.at(i)").id);this.remove(this.models.slice(h))}const t=this.head(),r=this.last();t&&r&&this._getWeight(t)<10&&this._getWeight(r)>.01||this.forEach(((t,r)=>{this._weightMap.set(t.id,1+(e-r)/e*3)}))}}_comparator(e,t){return d.Conn.platform===d.PLATFORMS.ANDROID?this._getWeight(t)-this._getWeight(e):e.index>t.index?1:-1}_getWeight(e){return(0,l.default)(this._weightMap.get(e.id),"this._weightMap.get(sticker.id)")}_findQuery(){return u.GK.isRecentStickersEnabled()?u.GK.supportsFeature(u.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):f.default.queryRecentStickers().then((e=>{let{checksum:t,stickers:r}=e;return this.setChecksum(t),d.Conn.platform===d.PLATFORMS.ANDROID&&(this._weightMap.clear(),r.forEach((e=>{let{id:t,weight:r}=e;this._weightMap.set(t,r)}))),r.map(((e,t)=>{let{weight:r}=e,n=(0,o.default)(e,_);return(0,a.default)((0,a.default)({},n),{},{mediaKey:(0,s.default)(n.mediaKey),index:t})}))})):Promise.reject(new Error("gk recent sticker sync unsupported"))}enqueue(e){u.GK.isRecentStickersEnabled()&&0!==e.length&&(d.Conn.platform===d.PLATFORMS.ANDROID?this._enqueueAndroid(e):this._enqueueiOS(e))}addStickerWithMediaData(e){const t=new p.StickerModel(e);t.id||(t.id=t.filehash),this.enqueue([t])}_enqueueAndroid(e){e.forEach((e=>{this.get(e.id)||(this._weightMap.set(e.id,0),this.add(e)),this.forEach((t=>{let r=this._getWeight(t);t.id===e.id?r+=1:r*=.9,this._weightMap.set(t.id,Math.round(1e3*r)/1e3)}))})),this._sortTrimScale()}_enqueueiOS(e){this.forEach(((e,t)=>{e.index=h+t}));const t=new Set(e.map((e=>e.id)));e.reduce(((e,r)=>t.has(r.id)?(t.delete(r.id),[r].concat(e)):e),[]).slice(0,h).forEach(((e,t)=>{const r=this.get(e.id);r?r.index=t:this.add({id:e.id,deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,filehash:e.filehash,encFilehash:e.encFilehash,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:t})})),this.sort(),this.remove(this.slice(h))}setChecksum(e){this._checksum=e}sync(e){var t=this;return(0,i.default)((function*(){u.GK.isRecentStickersEnabled()&&(null!=e&&e===t._checksum||(yield t._sync()))}))()}_sync(){var e=this;return(0,i.default)((function*(){if("INPROGRESS"!==e._syncStatus){e._syncStatus="INPROGRESS";try{yield e.findQuery({},{set:!0}),e.sort(),e._syncStatus="SUCCESS"}catch(t){__LOG__(3)`collection:recent_sticker:_sync error `,e._syncStatus="FAILURE"}}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}reset(){return this._syncStatus="NONE",this._weightMap.clear(),super.reset()}}t.RecentStickerCollectionImpl=g,g.model=p.StickerModel;const m=new g;t.RecentStickerCollection=m},49264:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionMd=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=n(r(48926)),a=r(1255),o=r(22683),s=r(50338),l=r(88297),c=r(76214),d=r(59871),u=n(r(20238)),p=r(99718);t.RECENT_STICKERS_LIMIT=32;class f extends a.BaseCollection{constructor(){super(...arguments),this._hasInitializedFromCache=!1}_comparator(e,t){return e.timestamp<t.timestamp?1:-1}_dbDataToModel(e){return new u.default({id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:new p.StickerModel(e.sticker)})}_addSaveTask(){this._idleTaskId&&s.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=s.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=[];e.toArray().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,sticker:e.sticker.toDbData(),msgId:e.msgId};t.push(r)}));try{const e=(0,c.getRecentStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`RecentStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}addStickerWithMediaData(e,t){this.addNewSticker(new p.StickerModel(e),t)}addNewSticker(e,t){e.id||(e.id=e.filehash),this.enqueue([[e,o.Clock.globalUnixTime(),t]])}enqueue(e){if(0===e.length)return;const t=new Set(e.map((e=>e[0].id))),r=e.reduce(((e,r)=>{let[n,i,a]=r;return t.has(n.id)?(t.delete(n.id),[[n,i,a]].concat(e)):e}),[]),n=[];let i=!1;r.forEach((e=>{let[t,r,a]=e;const o=this.get(t.id);if(o)o.timestamp<=r&&(o.timestamp=r,i=!0);else{const e=this._dbDataToModel({id:t.id,timestamp:r,sticker:t,msgId:a});n.push(e),i=!0}})),i&&(this.addAndSort(n),this._hasInitializedFromCache&&this._addSaveTask())}updateDirectPath(e,t){const r=this.get(e);(null==r?void 0:r.sticker)?(r.sticker.directPath=t,this.set([r],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask()):__LOG__(4,void 0,new Error)`updateDirectPaths called with a stickerId that doesn't match any in the collection`}updateStickerMediaData(e,t){const r=this.get(e);null!=t&&null!=r&&(t.directPath&&(r.sticker.directPath=t.directPath),t.encFilehash&&(r.sticker.encFilehash=t.encFilehash),t.mediaKey&&(r.sticker.mediaKey=t.mediaKey),t.mediaKeyTimestamp&&(r.sticker.mediaKeyTimestamp=t.mediaKeyTimestamp),this.set([r],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask())}stickersMissingDirerctPath(e){return e.filter((e=>null==e.sticker.directPath))}associateStickerWithMsg(e,t){return(0,i.default)((function*(){var r;const{messages:n}=yield d.MsgCollection.getMessagesById([t]),i=(null===(r=e.mediaObject)||void 0===r?void 0:r.associatedMsgs())||[];!e.mediaObject||0!==i.length&&n.some((e=>i.includes(e)))||(0,l.associateMediaWithMsg)(e.mediaObject,n[n.length-1])}))()}initializeFromCache(e){const t=e.map((e=>{const t=this._dbDataToModel(e);return this.associateStickerWithMsg(t.sticker,t.msgId),t})),r=this.toArray();if(this.addAndSort(t),r.length){const e=new Set(t.map((e=>e.id)));r.some((t=>e.has(t)))&&this._addSaveTask()}this._hasInitializedFromCache=!0}addAndSort(e){this.add(e),this.sort(),this.length>32&&this.set(this.toArray().slice(0,32))}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.remove(e,t);return r.length&&this._addSaveTask(),r}delete(){super.delete()}}t.RecentStickerCollection=f,f.model=u.default;const _=new f;t.RecentStickerCollectionMd=_},16774:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStickerCollectionImpl=t.StarredStickerCollection=t.STARRED_STICKERS_PAGE_SIZE=void 0;var i=n(r(48926)),a=n(r(81109)),o=n(r(78403)),s=r(1255),l=r(7293),c=r(99718),d=n(r(56891));t.STARRED_STICKERS_PAGE_SIZE=24;class u extends s.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._currentPage=0,this._total=0}_findQuery(){return l.GK.isStarredStickersEnabled()?l.GK.supportsFeature(l.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):d.default.queryStarredStickers(this._currentPage+1,24).then((e=>{let{checksum:t,total:r,stickers:n}=e;return this._checksum=t,this._currentPage+=1,this._total=r,n.map(((e,t)=>(0,a.default)((0,a.default)({},e),{},{mediaKey:(0,o.default)(e.mediaKey),index:this.length+t})))})):Promise.reject(new Error("gk starred sticker sync unsupported"))}add(e,t,r){return r&&(this._total+=1),super.add(e,t)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._total-=1,super.remove(e,t)}syncNextPage(){return this.canLoadMore()?this._sync(!1).then((()=>{this.trigger("next_page_sync")})):Promise.resolve()}sync(e){return l.GK.isStarredStickersEnabled()&&(null==e||e!==this._checksum)?(this.reset(),this._sync(!0).then((()=>{this.trigger("sync")}))):Promise.resolve()}_sync(e){var t=this;return(0,i.default)((function*(){if("INPROGRESS"===t._syncStatus)return Promise.resolve();t._syncStatus="INPROGRESS";try{yield t.findQuery({},{set:e}),t._syncStatus="SUCCESS"}catch(e){__LOG__(3)`collection:starred_sticker:_sync error `,t._syncStatus="FAILURE"}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}canLoadMore(){return 0!==this._total&&this.length<this._total}getRemaining(){return this._total-this.length}reset(){return this._syncStatus="NONE",this._currentPage=0,this._checksum="",this._total=0,super.reset()}}t.StarredStickerCollectionImpl=u,u.model=c.StickerModel,u.comparator=(e,t)=>e.index>=t.index?1:-1;const p=new u;t.StarredStickerCollection=p},99718:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerModel=t.Sticker=void 0;var i=n(r(51463)),a=r(11290),o=r(22683),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(78986)),l=n(r(2320)),c=r(58668);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}const u=(0,i.default)((()=>new _({id:"placeholder",isPlaceholder:!0}))),p=(0,i.default)((()=>new _({id:"createButton",isCreateButton:!0})));class f extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.mediaData=(0,a.session)(),this.mediaObject=(0,a.prop)(),this.deprecatedMms3Url=(0,a.prop)(),this.directPath=(0,a.prop)(),this.filehash=(0,a.prop)(),this.height=(0,a.prop)(),this.index=(0,a.prop)(),this.mediaKey=(0,a.prop)(),this.mediaKeyTimestamp=(0,a.prop)(),this.mimetype=(0,a.prop)(),this.size=(0,a.prop)(),this.type=(0,a.prop)(c.OUTWARD_TYPES.STICKER),this.encFilehash=(0,a.prop)(),this.width=(0,a.prop)(),this.stickerPackId=(0,a.prop)(),this.stickerPackName=(0,a.prop)(),this.stickerPackPublisher=(0,a.prop)(),this.isPlaceholder=(0,a.prop)(),this.isCreateButton=(0,a.prop)()}initialize(){super.initialize(),this.addChild("mediaData",new l.default),this.isPlaceholder||this.isCreateButton||s.registerSticker(this)}downloadMedia(){return s.downloadStickerOrStickerPackIcon(this,"STICKER").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker download failed")}))}toDbData(){return{id:this.id||this.filehash,index:this.index||0,width:this.width,height:this.height,size:this.size,mimetype:this.mimetype,filehash:this.filehash,directPath:this.directPath,mediaKey:this.mediaKey,mediaKeyTimestamp:null!=this.mediaKeyTimestamp?this.mediaKeyTimestamp:o.Clock.globalUnixTime(),encFilehash:this.encFilehash,deprecatedMms3Url:this.deprecatedMms3Url,type:c.OUTWARD_TYPES.STICKER}}delete(){super.delete(),s.deregisterSticker(this)}}t.Sticker=f,f.Proxy="sticker",f.getPlaceholder=u,f.getCreateButton=p;const _=(0,a.defineModel)(f);t.StickerModel=_,_.getPlaceholder=u},67963:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollectionImpl=t.StickerCollection=t.FETCH_STATE=void 0;var n=r(1255),i=r(99718);t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};class a extends n.BaseCollection{fetch(){throw new Error(`${this.constructor.name}.fetch is not implemented`)}}t.StickerCollectionImpl=a,a.model=i.StickerModel;const o=new a;t.StickerCollection=o},74470:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackModel=t.StickerPack=t.PRE_PLACEHOLDER_ID=void 0;var i=r(11290),a=n(r(2320)),o=r(58668),s=r(63488);const l="placeholder:";t.PRE_PLACEHOLDER_ID=l;const c=e=>{let{index:t,page:r}=e;return new u({id:`placeholder:${t}`,index:t,page:r})};class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.index=(0,i.prop)(),this.name=(0,i.prop)(),this.page=(0,i.prop)(),this.url=(0,i.prop)(),this.mimetype=(0,i.prop)("image/png"),this.mediaData=(0,i.session)(),this.mediaObject=(0,i.prop)(),this.directPath=(0,i.prop)(),this.filehash=(0,i.prop)(),this.mediaKey=(0,i.prop)(),this.mediaKeyTimestamp=(0,i.prop)(),this.size=(0,i.prop)(),this.type=(0,i.prop)(o.OUTWARD_TYPES.IMAGE),this.encFilehash=(0,i.prop)(),this.deprecatedMms3Url=(0,i.derived)(this._deprecatedMms3Url,["url","isFirstParty"]),this.stickers=(0,i.derived)(this._getStickersCollection,["id"]),this.isPlaceholder=(0,i.derived)(this._isPlaceholder,["id"]),this.isFirstParty=(0,i.derived)(this._isFirstParty,["url","mediaKey"])}_deprecatedMms3Url(){return this.isFirstParty?"":this.url}_isPlaceholder(){return d.isPlaceholderId(this.id)}_isFirstParty(){return Boolean(this.url)&&!this.mediaKey}_getStickersCollection(){return this._stickers=this._stickers||new s.StickerPackStickerCollection(this.id.split("#")[0],this.isFirstParty),this._stickers}initialize(){super.initialize(),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new a.default({renderableUrl:""})),r(78986).registerStickerPackIcon(this))}downloadMedia(){return this.isPlaceholder||this.isFirstParty?Promise.resolve():r(78986).downloadStickerOrStickerPackIcon(this,"STICKER_PACK").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker-pack download failed")}))}delete(){super.delete(),r(78986).deregisterStickerPackIcon(this)}}t.StickerPack=d,d.Proxy="stickerPack",d.createPlaceholder=c,d.isPlaceholderId=e=>new RegExp("^placeholder:").test(e);const u=(0,i.defineModel)(d);t.StickerPackModel=u,u.createPlaceholder=c,u.isPlaceholderId=d.isPlaceholderId},66299:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackCollectionImpl=t.StickerPackCollection=t.PAGE_SIZE_POPUP=t.PAGE_SIZE_COMPOSE_BOX=t.PAGE_FETCH_STATE=void 0;var a=i(r(81109)),o=i(r(48926)),s=i(r(98913)),l=i(r(78718)),c=r(89385),d=r(1255),u=i(r(84644)),p=r(74470),f=i(r(56891));t.PAGE_SIZE_COMPOSE_BOX=9;t.PAGE_SIZE_POPUP=6;const _={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};t.PAGE_FETCH_STATE=_;class h extends d.BaseCollection{constructor(){super(),this.checksum=null,this._pageFetchRequests={},this.pageFetchStates={},this._handleChecksumChange=()=>{Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),this._resetRangeWithPlaceholders(0,this.length),this.fetchAt(0,!1,!0)},this.listenTo(this,"change:checksum",this._handleChecksumChange)}createPlaceholder(e){return h.createPlaceholder(e)}preFetch(){var e=this;return(0,o.default)((function*(){yield e.fetchAt(0).then((()=>Promise.all(e.filter((e=>e.isFirstParty)).map((e=>e.stickers.fetch())))))}))()}fetchAt(e,t,r){return this._fetchPageWithIndex(e,Boolean(t),Boolean(r))}hasFetchedData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===_.SUCCESS))}isFetchingData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===_.PENDING))}pageWithIndex(e){return h.pageWithIndex(e)}reset(){return this.setChecksum(null,{silent:!0}),Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),super.reset()}sync(e){this.setChecksum(e)}setChecksum(e,t){if(this.checksum!==e){this.checksum=e;return(null==t?void 0:t.silent)||this.trigger("change:checksum",e),!0}return!1}_fetchPageWithIndex(e,t,r){const n=this.pageWithIndex(e);return this._fetchPage(n,t,r)}_fetchPage(e,t,r){const i=this.pageFetchStates[e];if(t&&i!==_.PENDING){const t=this._pageFetchRequests[e];t&&(t.controller.abort(),delete this._pageFetchRequests[e])}if(this._pageFetchRequests[e])return this._pageFetchRequests[e].promise;const a=this.length;this._insertPagePlaceholders(e),this._setFetchPageState(e,_.PENDING);const o=new n,s=o.signal,l=(0,u.default)(f.default.queryStickerPacks(e,9),s).then((t=>{if(s.aborted)throw new c.AbortError;const n=this._parseStickerPacksRes(e,t),i=r||this.setChecksum(t.checksum,{silent:!0}),o=9*(e-1),l=9*(e+0);this._resetRange(o,l,n),i&&(this._resetRangeWithPlaceholders(0,o),this._resetRangeWithPlaceholders(Math.min(o+n.length,l),t.count));const d=this.length;a!==d&&this.trigger("change:length",d),this._setFetchPageState(e,_.SUCCESS)})).catch((t=>{if(t.name===c.ABORT_ERROR)return __LOG__(2)`StickerPack page fetch promise cancelled: ${e}`,void this._unsetFetchPageStateAndPromise(e);this._setFetchPageState(e,_.ERROR)}));return this._pageFetchRequests[e]={promise:l,controller:o},l}_insertPagePlaceholders(e){const t=e-1;this._resetRangeWithPlaceholders(9*t,9*(t+1))}_parseStickerPacksRes(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(((t,r)=>(0,a.default)((0,a.default)({},(0,l.default)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"])),{},{encFilehash:t.encFilehash,page:e,index:9*(e-1)+r})))}_resetRangeWithPlaceholders(e,t){this._resetRange(e,t,(0,s.default)(t-e,(t=>h.createPlaceholder(e+t))))}_resetRange(e,t,r){this._forEachInRange(e,t,((t,n)=>{const i=r[n-e];if(t)if(i)t.id===i.id?(this.remove(t,{silent:!0}),this.add(i)):(this.remove(t),this.add(i));else{let e=t;for(;e;)this.remove(e),e=this.at(n)}else i&&this.add(i)}))}_forEachInRange(e,t,r){for(let n=e;n<t;n++){r(this.at(n),n)}}_resetFetchPageStateAndPromise(e){if(e in this.pageFetchStates){var t;if(this.pageFetchStates[e]===_.PENDING)null===(t=this._pageFetchRequests[e])||void 0===t||t.controller.abort();else this._unsetFetchPageStateAndPromise(e)}}_setFetchPageState(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}_unsetFetchPageState(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}_unsetFetchPageStateAndPromise(e){delete this._pageFetchRequests[e],this._unsetFetchPageState(e)}}t.StickerPackCollectionImpl=h,h.model=p.StickerPackModel,h.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},h.createPlaceholder=function(e){return p.StickerPackModel.createPlaceholder({index:e,page:this.pageWithIndex(e)})},h.pageWithIndex=function(e){return Math.floor(e/9)+1};const g=new h;t.StickerPackCollection=g},63488:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"FETCH_STATE",{enumerable:!0,get:function(){return f.FETCH_STATE}}),t.StickerPackStickerCollection=void 0;var i=n(r(81109)),a=n(r(78718)),o=r(22683),s=r(77905),l=r(7293),c=n(r(14048)),d=r(67963),u=r(90669),p=n(r(56891)),f=r(67963);class _ extends d.StickerCollectionImpl{constructor(e,t){super(),this._parseStickersRes=e=>{if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(((e,t)=>(0,i.default)((0,i.default)({},(0,a.default)(e,["directPath","mimetype","mediaKey","filehash","width","height"])),{},{index:t,id:e.filehash,deprecatedMms3Url:e.url,encFilehash:e.encFilehash,mediaKeyTimestamp:0})))},this.stickerPackId=e,this.isFirstParty=t,this._firstPartyFetchTimestamp=null;const r=_._cache[this.stickerPackId];if(r)return r;let n;const o=this;Object.defineProperty(this,"fetchState",{get:()=>n,set(e){n!==e&&(n=e,o.trigger("change:fetchState",e))}})}fetch(e){var t;const n=l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&(0,c.default)()&&this.isFirstParty&&o.Clock.globalUnixTime()-(null!==(t=this._firstPartyFetchTimestamp)&&void 0!==t?t:0)>=u.STICKER_PACK_FETCH_TIMEOUT;if((e||n)&&this.fetchState!==d.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise)return this._fetchPromise;this.fetchState=d.FETCH_STATE.PENDING;if(r(74470).StickerPackModel.isPlaceholderId(this.stickerPackId))return this._fetchPromise=new Promise((()=>{})),this._fetchPromise;let i;return this.isFirstParty?(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&(0,c.default)()&&(this._firstPartyFetchTimestamp=o.Clock.globalUnixTime()),i=(0,s.fetchFirstPartyStickers)(this.stickerPackId)):i=p.default.queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes),this._fetchPromise=i.then((e=>{const t=Math.max(this.length||e.length);this._resetRange(0,t,e),this.fetchState=d.FETCH_STATE.SUCCESS})).catch((()=>{this.fetchState=d.FETCH_STATE.ERROR})),this._fetchPromise}_resetRange(e,t,r){this._forEachInRange(e,t,((t,n)=>{const i=r[n-e];t?i?t.id===i.id?t.set(i):(this.remove(t),this.add(i)):this.remove(t):i&&this.add(i)}))}_forEachInRange(e,t,r){for(let n=e;n<t;n++){r(this.at(n),n)}}}t.StickerPackStickerCollection=_,_._cache={},_.comparator=(e,t)=>e.index<t.index?-1:e.index>t.index?1:0},8080:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=t.Stream=t.Obscurity=void 0;var i=n(r(23279)),a=r(57319),o=r(11290),s=r(88102),l=r(99234),c=r(7293),d=n(r(11339)),u=r(58052),p=n(r(57220)),f=r(71119),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=S(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(6604)),h=r(371),g=r(62583),m=r(29898),y=r(12099),E=r(65044);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(S=function(e){return e?r:t})(e)}const v=r(76672).Mirrored(["OFFLINE","OPENING","PAIRING","SYNCING","RESUMING","CONNECTING","NORMAL","TIMEOUT"]);t.StreamInfo=v;const T=r(76672).Mirrored(["QR","MAIN","SYNCING","OFFLINE","CONFLICT","PROXYBLOCK","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION"]);t.StreamMode=T;const C=r(76672).Mirrored(["SHOW","OBSCURE","HIDE"]);t.Obscurity=C;class A extends o.BaseModel{constructor(){super(...arguments),this.info=(0,o.session)(v.NORMAL),this.mode=(0,o.session)(T.SYNCING),this.obscurity=(0,o.session)(C.HIDE),this.needsUpdate=(0,o.session)(),this.clientExpired=(0,o.session)(!1),this.hardExpired=(0,o.session)(!1),this.lastSyncStart=(0,o.session)(M()),this.needsManualDownload=(0,o.session)(),this.couldForce=(0,o.session)(),this.uiActive=(0,o.session)(),this.available=(0,o.session)(!0),this.unavailableShiftTimer=(0,o.session)(),this.unavailableLogoutTimer=(0,o.session)(),this.unobscureShiftTimer=(0,o.session)(),this.timeoutEvent=(0,o.session)(),this.resumeCount=(0,o.session)(0),this.phoneAuthed=(0,o.session)(!1),this._activeModeMeasure=(0,o.session)(),this.displayInfo=(0,o.derived)(this._displayInfo,["info","obscurity"])}_displayInfo(){return function(e,t){switch(t){case C.SHOW:return e;case C.HIDE:return E.Socket.hasSynced?v.NORMAL:v.CONNECTING;case C.OBSCURE:switch(e){case v.OPENING:case v.PAIRING:case v.SYNCING:case v.RESUMING:return v.CONNECTING;default:return e}}return __LOG__(3)`Stream:unknown obscure level:`,e}(this.info,this.obscurity)}initialize(){super.initialize(),c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&!(0,u.isRegistered)()&&(this.mode=T.QR),this._activeModeMeasure=_.startMeasure(`Stream.mode: ${this.mode}`),__LOG__(2)`Stream:rememberMe: ${String((0,l.getRememberMe)())}`,this.unavailableShiftTimer=new a.ShiftTimer((()=>this.markUnavailable())),this.unobscureShiftTimer=new a.ShiftTimer((()=>this.unobscure())),this.unavailableLogoutTimer=new a.ShiftTimer((function(){(0,l.getRememberMe)()||(__LOG__(2)`Stream:unavailableLogoutTimer logout due to inactivity`,E.Socket.logout())})),this.listenTo(E.Socket,"change:state change:stream change:hasSynced",this.onSocketUpdate),this.listenTo(p.default,"change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",(0,i.default)(this.onSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(s.Cmd,"midnight",this.updateHardExpire.bind(this)),c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&this.listenTo(s.Cmd,"socket_stream_disconnected",(()=>{r(68315).PresenceCollection.clearAllPresence()})),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}delete(){}markAvailable(){this.unavailableShiftTimer.cancel(),this.available=!0}markUnavailable(e){null!=e&&0!==e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1)}onSelfUpdate(){__LOG__(2)`Stream:onSelfUpdate mode:${this.mode} info:${this.info} view:${this.displayInfo}`;let e=this.timeoutEvent;if(this.info===v.TIMEOUT)e||(this.timeoutEvent=e=new d.default.WebcPhoneDisconnected),this.displayInfo===v.TIMEOUT&&null==this._bbarTime&&(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();const t=this._bbarTime;null!=t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null,this._bbarTime=null}this.mode===T.MAIN&&s.Cmd.readyForMainStreamModeLegacy()}onSocketUpdate(){const e={},t=function(){switch(E.Socket.state){case g.SOCKET_STATE.TIMEOUT:return v.TIMEOUT;case g.SOCKET_STATE.OPENING:return p.default.online?v.OPENING:v.OFFLINE;case g.SOCKET_STATE.PAIRING:return E.Socket.hasSynced?v.RESUMING:v.PAIRING;case g.SOCKET_STATE.CONNECTED:return E.Socket.stream!==g.SOCKET_STREAM.CONNECTED?E.Socket.hasSynced?v.NORMAL:v.SYNCING:v.NORMAL;case g.SOCKET_STATE.UNLAUNCHED:case g.SOCKET_STATE.PROXYBLOCK:default:return v.NORMAL}}();if(e.info=t,e.mode=function(){let e=!1;e=c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(0,u.isRegistered)():(0,l.knowsPhone)();if(!e&&E.Socket.state!==g.SOCKET_STATE.PROXYBLOCK)return T.QR;const t=E.Socket.hasSynced;switch(E.Socket.state){case g.SOCKET_STATE.PROXYBLOCK:return T.PROXYBLOCK;case g.SOCKET_STATE.CONFLICT:return T.CONFLICT;case g.SOCKET_STATE.TOS_BLOCK:return T.TOS_BLOCK;case g.SOCKET_STATE.SMB_TOS_BLOCK:return T.SMB_TOS_BLOCK;case g.SOCKET_STATE.DEPRECATED_VERSION:return T.DEPRECATED_VERSION;case g.SOCKET_STATE.UNLAUNCHED:return T.SYNCING;case g.SOCKET_STATE.UNPAIRED_IDLE:case g.SOCKET_STATE.UNPAIRED:return T.QR;case g.SOCKET_STATE.OPENING:if(!p.default.online&&!E.Socket.hasSynced)return T.OFFLINE;default:return t||E.Socket.stream===g.SOCKET_STREAM.CONNECTED?T.MAIN:T.SYNCING}}(),e.phoneAuthed=E.Socket.stream!==g.SOCKET_STREAM.DISCONNECTED,t===v.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=C.HIDE;else if(t===v.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=C.OBSCURE;else switch(this.obscurity){case C.HIDE:this.unobscureShiftTimer.onOrBefore(18e3);break;case C.OBSCURE:this.unobscureShiftTimer.onOrBefore(3e3);break;case C.SHOW:}this.set(e)}unobscure(){this.obscurity=C.SHOW}onPhoneAuthedUpdate(){if(this.phoneAuthed){this.sendAvailability(!0);r(92671).RecentEmojiCollection.sync()}}onAvailableUpdate(){const e=this.available;if(__LOG__(2)`Stream:onAvailableUpdate user ${e?"available":"unavailable"}`,e||(0,l.getRememberMe)()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(78e4),this.sendAvailability(!1),c.GK.supportsFeature(c.GK.F.MD_BACKEND))if(e){const{sendDeliveryReceiptsAfterPresence:e}=r(7992);e()}else{r(68315).PresenceCollection.clearAllPresence()}}sendAvailability(e){(e||this.uiActive)&&(this.available?(0,h.sendPresenceAvailable)():(0,h.sendPresenceUnavailable)())}updateCouldForce(){this.couldForce=!this.uiActive||!this.available&&document.hidden}updateHardExpire(){m.Updater.isExpired()&&(this.hardExpired=!0,m.Updater.restart(!0))}logPageResume(){this.info===v.RESUMING&&(this.resumeCount++,new d.default.WebcPageResume({webcResumeCount:this.resumeCount}).commit())}updateWamLog(){const e=this.info===v.NORMAL;(0,f.streamInfoChange)(this.info,y.WatchedSocketModel.numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}logModeChange(){this._activeModeMeasure&&this._activeModeMeasure.end(),this.mode===T.SYNCING&&(this.lastSyncStart=M()),this._activeModeMeasure=_.startMeasure(`Stream.mode: ${this.mode}`),new d.default.WebcStreamModeChange({webcStreamMode:b(this.mode)}).commit()}}function b(e){switch(e){case T.QR:return d.default.WEBC_STREAM_MODE_CODE.QR;case T.MAIN:return d.default.WEBC_STREAM_MODE_CODE.MAIN;case T.SYNCING:return d.default.WEBC_STREAM_MODE_CODE.SYNCING;case T.OFFLINE:return d.default.WEBC_STREAM_MODE_CODE.OFFLINE;case T.CONFLICT:return d.default.WEBC_STREAM_MODE_CODE.CONFLICT;case T.PROXYBLOCK:return d.default.WEBC_STREAM_MODE_CODE.PROXYBLOCK;case T.DEPRECATED_VERSION:return d.default.WEBC_STREAM_MODE_CODE.DEPRECATED_VERSION;case T.TOS_BLOCK:case T.SMB_TOS_BLOCK:return d.default.WEBC_STREAM_MODE_CODE.TOS_BLOCK}}A.Proxy="stream";const P=new((0,o.defineModel)(A));function M(){return Math.floor(window.performance.now())}t.Stream=P},58492:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(82569)),a=n(r(85564)),o=r(11290),s=r(51612);class l extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.pendingMsgs=(0,o.prop)(),this.labels=(0,o.prop)(),this.msgChunks=(0,o.session)((()=>[])),this.lastReceivedKey=(0,o.session)(),this.unreadMsgAnchor=(0,o.session)(),this.disableUnreadAnchor=(0,o.session)(),this.msgsLength=(0,o.session)(),this.msgsChanged=(0,o.session)(0),this.msgs=(0,o.collection)(s.ChatMsgsCollection)}initialize(){super.initialize(),this.listenTo(this.msgs,"change:last",(()=>{this.msgsChanged++})),this.listenTo(this.msgs,"add remove bulk_add",(()=>{this.msgsChanged++,this.msgsLength=this.msgs.length}))}onEmptyMRM(){throw new Error("onEmptyMRM not implemented")}delete(){super.delete(),this.getAllCMCs().forEach((e=>{e.forEach((e=>{e.delete()})),e.delete()}))}removeMsg(e){const t=e.msgChunk;if(!t)return;t.indexOf(e)<0||(__LOG__(2)`models:Chat:removeMsg ${e.get("id")}`,t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}getAllCMCs(){return this.msgChunks.concat([this.msgs])}getAllMsgs(){return(0,a.default)(this.getAllCMCs().map((e=>e.getModelsArray())))}replaceMsgsCollection(e){__LOG__(2)`model:Chat:replaceMsgsCollection:${this.id.toString()}`;const t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}removeMsgsCollection(e){this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}notifyMsgCollectionMerge(e,t,r,n){this.trigger("change:cmc:merge",e,t,r,n)}}t.default=l},11897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.displayText=(0,n.prop)(),this.subtype=(0,n.prop)(),this.url=(0,n.prop)(),this.phoneNumber=(0,n.prop)(),this.selectionId=(0,n.prop)(),this.selected=(0,n.session)(!1)}}i.Proxy="templateButton";var a=(0,n.defineModel)(i);t.default=a},82988:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateButtonCollection=void 0;var i=r(1255),a=n(r(11897));class o extends i.BaseCollection{}t.TemplateButtonCollection=o,o.model=a.default,o.comparator=(e,t)=>e.id<t.id?-1:e.id>t.id?1:0},86500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(17304);class a extends n.BaseCollection{}t.default=a,a.model=i.Msg,a.comparator=function(e,t){return t.t-e.t}},41809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.timestamp=(0,n.prop)()}}i.Proxy="unreadMention";var a=(0,n.defineModel)(i);t.default=a},91036:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateDisappearingMode=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(19380),s=r(10435),l=r(27211);function c(){return(c=(0,i.default)((function*(e,t,r){if(!(0,s.isDisappearingModeEnabled)())return Promise.resolve();const n=(0,a.createUserWid)(e.user),i=o.ContactCollection.get(n);if(i){const{disappearingModeSettingTimestamp:e}=i;if(null==e&&0!==r||null!=e&&e<r){const e={disappearingModeDuration:t,disappearingModeSettingTimestamp:r};yield(0,l.updateLocal)(n,e),i.set(e),__LOG__(2)`updateDisappearingMode: Contact=${n.toString()} updated, new duration=${t} t=${r}.`}}}))).apply(this,arguments)}},91932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(49835);class a extends n.BaseModel{constructor(){super(...arguments),this.callId=(0,n.prop)(),this.peerJid=(0,n.prop)(),this.pc=(0,n.prop)(),this.answer=(0,n.prop)(),this.localStream=(0,n.prop)(),this.remoteAudioStream=(0,n.prop)(),this.remoteVideoStream=(0,n.prop)(),this._state=(0,n.prop)(i.WEB_CALL_STATES.NONE)}getState(){return this._state}setState(e){const t=e;(function(e,t){const r=e||i.WEB_CALL_STATES.NONE;return t in s[r]})(this._state,t)&&(this._state=t)}}a.Proxy="webCall";var o=(0,n.defineModel)(a);t.default=o;const s={NONE:{[i.WEB_CALL_STATES.OUTGOING_CALLING]:!0,[i.WEB_CALL_STATES.INCOMING_CALLING]:!0},OUTGOING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},INCOMING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},ACTIVE:{[i.WEB_CALL_STATES.NONE]:!0}}},19037:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={cache:{},delete(){this.cache={}}};t.default=r},65044:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var i=n(r(48926)),a=n(r(6410)),o=n(r(82569)),s=n(r(63105)),l=n(r(2525)),c=n(r(91966)),d=n(r(13218)),u=n(r(78718)),p=n(r(35161)),f=n(r(41609)),_=r(89385),h=r(15688),g=r(8584),m=r(40265),y=r(50796),E=r(13959),S=r(4352),v=r(38284),T=n(r(38469)),C=n(r(30381)),A=r(86945),b=r(67146),P=r(11290),M=n(r(87045)),O=me(r(85965)),I=n(r(4550)),w=n(r(69048)),R=r(22683),D=r(88102),N=r(24747),L=r(17239),k=n(r(66405)),G=r(10786),U=me(r(64103)),F=r(27086),x=r(99234),B=r(7293),K=r(57701),j=r(77303),Y=r(16703),W=n(r(92417)),H=r(83578),V=r(46582),$=r(76214),z=r(58052),q=n(r(51783)),J=r(85417),Q=r(72407),X=me(r(49603)),Z=n(r(7353)),ee=me(r(17117)),te=r(64551),re=n(r(68132)),ne=n(r(26445)),ie=r(318),ae=r(62583),oe=n(r(94030)),se=r(24439),le=n(r(59402)),ce=me(r(22906)),de=r(14892),ue=r(29898),pe=r(47221),fe=n(r(15078)),_e=r(24465),he=r(77591);function ge(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ge=function(e){return e?r:t})(e)}function me(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=ge(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class ye extends((0,m.customError)("ExternalPoke")){}class Ee extends((0,m.customError)("MustExitLoop")){}class Se extends((0,m.customError)("Denied401Failed")){}class ve extends((0,m.customError)("Denied409Conflict")){}class Te extends((0,m.customError)("DeniedTOS")){}class Ce extends((0,m.customError)("DeniedTOSGDPR",!0,Te)){}class Ae extends((0,m.customError)("DeniedTOSSMB",!0,Te)){}class be extends((0,m.customError)("DeniedUnknown")){}class Pe extends((0,m.customError)("ForcedRefresh")){}class Me extends((0,m.customError)("TooManyRefRequest")){}class Oe extends((0,m.customError)("UILogout")){}class Ie extends((0,m.customError)("WindowOffline")){}class we extends((0,m.customError)("PhoneFailedPing")){}class Re extends((0,m.customError)("AssertionFailed")){}class De extends((0,m.customError)("TakeoverRequested")){}class Ne extends((0,m.customError)("PhoneReplacedClient")){}class Le extends((0,m.customError)("NoSecretBundle")){}class ke extends((0,m.customError)("PhoneKickedClient")){}class Ge extends((0,m.customError)("TempServerError")){}const Ue={SYNC_INFO:["Conn",ne.default.OBJECT],CHALLENGE:["Cmd",{type:"challenge",challenge:ne.default.STRING}],DISCONNECT:["Cmd",{type:"disconnect",kind:void 0}],HARD_REFRESH:["Cmd",{type:"update"}],UPGRADE_MD_FOR_INTERNAL_USER:["Cmd",{type:"upgrade_md"}],UPGRADE_MD_FOR_PROD:["Cmd",{type:"upgrade_md_prod",version:void 0}],PONG:["Pong",ne.default.BOOLEAN]},Fe={TAG:e=>new ne.default({tag:e,data:ne.default.ANY,binarySize:ne.default.ANY}),SYNC_INFO:new ne.default({tag:ne.default.ANY,data:Ue.SYNC_INFO,binarySize:ne.default.ANY}),CHALLENGE:new ne.default({tag:ne.default.ANY,data:Ue.CHALLENGE,binarySize:ne.default.ANY}),DISCONNECT:new ne.default({tag:ne.default.ANY,data:Ue.DISCONNECT,binarySize:ne.default.ANY}),HARD_REFRESH:new ne.default({tag:ne.default.ANY,data:Ue.HARD_REFRESH,binarySize:ne.default.ANY}),UPGRADE_MD_FOR_INTERNAL_USER:new ne.default({tag:ne.default.ANY,data:Ue.UPGRADE_MD_FOR_INTERNAL_USER,binarySize:ne.default.ANY}),UPGRADE_MD_FOR_PROD:new ne.default({tag:ne.default.ANY,data:Ue.UPGRADE_MD_FOR_PROD,binarySize:ne.default.ANY}),PONG:new ne.default({tag:ne.default.ANY,data:Ue.PONG,binarySize:ne.default.ANY})},xe=new ne.default({status:e=>"number"==typeof e&&e>=500,_:void 0}),Be=new ne.default({status:e=>"number"==typeof e&&499===e,_:void 0}),Ke=new ne.default({status:e=>"number"==typeof e,_:void 0});class je extends P.BaseModel{constructor(){super(...arguments),this.socketPreload=(0,P.session)(),this.socket=(0,P.session)(),this.launchGeneration=(0,P.session)(0),this.backoffGeneration=(0,P.session)(0),this.hasSynced=(0,P.session)(),this.state=(0,P.session)(ae.SOCKET_STATE.UNLAUNCHED),this.stream=(0,P.session)(ae.SOCKET_STREAM.DISCONNECTED),this.canSend=(0,P.session)(),this.sendQueue=(0,P.session)(),this.sendHash=(0,P.session)(),this.cancelHash=(0,P.session)(),this.doubleAckHash=(0,P.session)(),this.sequence=(0,P.session)(0),this.shortTagBase=(0,P.session)(),this.socketWatcher=(0,P.session)(),this.refWatcher=(0,P.session)(),this.phoneWatchdog=(0,P.session)(),this.pendingPhoneReqs=(0,P.session)(0),this.isIncognito=(0,P.session)(),this.runPromise=(0,P.session)(),this.streamPromise=(0,P.session)(),this.conflictPromise=(0,P.session)(),this.resumePromise=(0,P.session)(),this.logoutMutex=(0,P.session)(0),this.retryTimestamp=(0,P.session)(),this.pokeable=(0,P.session)(),this.launched=(0,P.session)(),this.mustExitLoop=(0,P.session)(),this.syncTag=(0,P.session)(),this.lastPhoneMessage=(0,P.session)(),this.shouldForceReconnect=(0,P.session)(!1),this.shouldUpgradeToMDIntern=(0,P.session)(!1),this.shouldUpgradeToMDPord=(0,P.session)(!1)}initialize(){B.GK.supportsFeature(B.GK.F.MD_BACKEND)||(this.sendQueue=[],this.sendHash={},this.cancelHash={},this.doubleAckHash={},this.phoneWatchdog=new _e.Watchdog({waitAlgorithm:(0,_e.fibonacci)(3e3,3e3,36e5),onTimeout:this.phoneTimedOut.bind(this),onActivated:this.onPhoneWatchdogActivated.bind(this),onFed:this.onPhoneWatchdogFed.bind(this),onDeactivated:this.onPhoneWatchdogDeactivated.bind(this)})),this.listenTo(this,"change:state",this.onStateChange.bind(this)),this.listenTo(this,"change:stream",this.onStreamChange.bind(this)),(0,E.delayMs)(0).then(X.determineIncognito).then((e=>{this.isIncognito=e})),this.listenTo(D.Cmd,"log_socket_summary",this.summary),this.listenTo(D.Cmd,"set_socket_state",(e=>{this.state=e})),this.listenTo(D.Cmd,"open_socket_stream",(()=>{this.openStream(),this.hasSynced&&this.set({stream:ae.SOCKET_STREAM.CONNECTED})})),this.listenTo(D.Cmd,"socket_stream_disconnected",(()=>{this.set({stream:ae.SOCKET_STREAM.DISCONNECTED})})),this.listenTo(D.Cmd,"on_critical_sync_done",(()=>{__LOG__(2)`[ws2] observed on_critical_sync_done`,this.onCriticalSyncDone()})),this.listenTo(D.Cmd,"main_stream_mode_ready",(()=>{__LOG__(2)`[ws2] observed main_stream_mode_ready`,!B.GK.supportsFeature(B.GK.F.MD_BACKEND)||(0,z.getAllCriticalDataSynced)()||B.GK.supportsFeature(B.GK.F.MD_E2E)?(__LOG__(2)`[ws2] moving to main screen from main_stream_mode_ready`,this.set({hasSynced:!0,stream:ae.SOCKET_STREAM.CONNECTED})):__LOG__(2)`[ws2] did not meet conditions to move to main screen`})),this.listenTo(D.Cmd,"socket_stream_disconnected",(()=>{this.stream=ae.SOCKET_STREAM.DISCONNECTED}))}preload(){B.GK.supportsFeature(B.GK.F.MD_BACKEND)||(this.socketPreload=new oe.default)}send(e){const t=new Z.default(e);this.sendQueue.push(t),this.flushQueue()}send2(e){return new Promise(((t,r)=>{const n=new Z.default(e);n.onSend=t,n.onDrop=r,this.sendQueue.push(n),this.flushQueue()}))}shortTag(){return this.shortTagBase||(this.shortTagBase=((0,C.default)().unix()%1e3).toString()),`${this.shortTagBase}.--${this.sequence++}`}tag(e){return`${(0,C.default)().unix()}.--${this.sequence++}`}launch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;__LOG__(2)`ws2:Launch gen${this.launchGeneration} (backoff gen${this.backoffGeneration})`;const r=300*ce.expBackoff(this.backoffGeneration,100),n=Date.now()+r;if(this.launched)return __LOG__(4,void 0,new Error,!0)`ws2:launch redundantly called!`,void SEND_LOGS("redundant-launch");function i(){__LOG__(2)`ws2:socket loop closed`,this.socketPreload&&this.socketPreload.deactivate(),this.clearState(),this.set({state:ae.SOCKET_STATE.UNLAUNCHED,mustExitLoop:!1,launched:!1,socketPreload:null})}this.mustExitLoop?i.call(this):(this.launched=!0,this.run(t,e).then((function(e){return[e,!1]})).catch((0,y.filteredCatch)(Ee,(()=>(this.mustExitLoop=!0,[!1,!1])))).catch((0,y.filteredCatch)(De,(function(){return[!1,!0]}))).catch((e=>(__LOG__(3,!0,void 0,!0)`ws2:run error unknown!\n${e.stack}`,SEND_LOGS("unknown-error-in-ws-loop"),this.clearState(),[!0,!1]))).then((e=>{let[t,a]=e;if(this.mustExitLoop)i.call(this);else{const e=Date.now();this.launchGeneration++,this.backoffGeneration=t&&e<n+6e4?this.backoffGeneration+1:0;const i=e<n?Math.min(n-e,r):0;this.launched=!1,this.launch(a,i)}})))}poke(){this.pokeable?this.pokeable.poke():this.phoneWatchdog.forceTimeout()}takeover(){if(!this.conflictPromise)throw"Takeover called without conflict!";this.conflictPromise.cancel(new De)}exitLoop(e){this.mustExitLoop=!0,this.runPromise&&this.runPromise.cancel(e||new Ee)}_setLogoutDirtyBit(){W.default&&W.default.setItem(Q.KEYS.LOGOUT_DIRTY_BIT,"1")}_removeLogoutDirtyBit(){W.default&&W.default.removeItem(Q.KEYS.LOGOUT_DIRTY_BIT)}_hasDirtyBitSet(){W.default&&W.default.getItem(Q.KEYS.LOGOUT_DIRTY_BIT)}clearCredentialsAndStoredData(e){var t=this;return(0,i.default)((function*(){let r=!1;e===H.LogoutReason.ClientFatalError&&(r=!0),t._setLogoutDirtyBit(),r=yield t.clearCredentials(),t._hasDirtyBitSet()&&(r=!0),t._setLogoutDirtyBit();try{yield t.destroyStorage()}catch(e){r=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`destroyStorage: failed with error ${e}`}B.GK.supportsFeature(B.GK.F.MD_BACKEND)&&(0,A.clearABPropConfigs)(),r||t._removeLogoutDirtyBit(),r&&"Firefox"!==M.default.info().name?window.location.href=`${window.location.pathname}?post_logout=1`:window.location.reload()}))()}destroyStorage(){return(0,i.default)((function*(){const e=[(0,$.destroy)(),(0,se.destroyStorage)()];B.GK.supportsFeature(B.GK.F.MD_BACKEND)&&(e.push((0,F.destroy)()),e.push((0,J.destroy)()),e.push((0,Y.destroy)()),e.push(w.default.clearInitializationPromises())),yield Promise.all(e)}))()}logout(){var e=this;let t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.LogoutReason.UserInitiated;W.default&&B.GK.supportsFeature(B.GK.F.MD_BACKEND)&&(W.default.removeItem("WebEncKeySalt"),W.default.removeItem("WANoiseInfo")),(0,j.get)().setLogoutState(!0),B.GK.supportsFeature(B.GK.F.MD_BACKEND)?D.Cmd.onStartingLogout():t=this.runPromise,__LOG__(2)`ws2:user logged out`;let o=Promise.resolve();if(B.GK.supportsFeature(B.GK.F.MD_BACKEND)){const e=Math.min(20,Math.max(0,te.ServerProps.syncdSentinelTimeoutSeconds));o=(0,v.promiseTimeout)(r(37933).Z(),1e3*e).catch((()=>__LOG__(3)`ws2: multi-device logout did not manage to send sentinel patch`))}(0,v.promiseTimeout)(o.then((()=>{this.stream===ae.SOCKET_STREAM.DISCONNECTED||n?this.sendCurrentLogout(null,a):this.sendCurrentLogout(this.socket,a)})).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sendCurrentLogoutPromise errored with ${t}`,yield e.clearCredentialsAndStoredData(a),D.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()),3e3,"network request took more than 3 seconds").then((0,i.default)((function*(){B.GK.supportsFeature(B.GK.F.MD_BACKEND)||(D.Cmd.onStartingLogout(),yield new Promise((e=>setTimeout(e,100)))),yield e.clearCredentialsAndStoredData(a),t&&t.cancel(new Oe),e.state===ae.SOCKET_STATE.OPENING&&e.trigger("change:state"),D.Cmd.logout()}))).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sentinelPromise or sendCurrentLogoutPromise timed out with ${t}`,yield e.clearCredentialsAndStoredData(a),D.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()).finally((()=>{(0,j.get)().setLogoutState(!1)}))}summary(){__LOG__(2)`ws:summary --------------------------------`,__LOG__(2)`ws state           ${this.state}`,__LOG__(2)`wd online:         ${String(navigator.onLine)}`,__LOG__(2)`ws socket id:      ${this.socket?this.socket.id:"n/a"}`,__LOG__(2)`ws queue:`,(0,f.default)(this.sendQueue)||T.default.print((0,p.default)(this.sendQueue,(function(e){const t=(0,u.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`})),__LOG__(2)`ws hash:`,(0,f.default)(this.sendHash)||T.default.print((0,p.default)(this.sendHash,(function(e){const t=(0,u.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`}))}registerHandler(e){B.GK.supportsFeature(B.GK.F.MD_BACKEND)||(this.handler&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ws2: attempting to register handler multiple times")),this.handler=e)}onStateChange(){__LOG__(2)`ws2:state change: ${this.state}`}onStreamChange(){__LOG__(2)`ws2:stream change: ${this.stream}`,this.stream===ae.SOCKET_STREAM.DISCONNECTED&&(B.GK.supportsFeature(B.GK.F.MD_BACKEND)?fe.default.clear():this.onRefCycle(),this.unset("resumePromise"))}onRefCycle(){__LOG__(2)`ws2:onRefCycle`,this.sendQueue.forEach((function(e){e.state=Z.default.STATE.NEW,e.age=0})),this.clearSendHash()}onActivity(e){if(e){const t=e.data;if(Fe.UPGRADE_MD_FOR_INTERNAL_USER.test(e))__LOG__(2)`ws2: can upgrade to md! (flow for internal users)`,this.shouldUpgradeToMDIntern=!0,this.exitLoop();else if(Fe.UPGRADE_MD_FOR_PROD.test(e)){if(__LOG__(2)`ws2: upgrade to md! (flow for external users)`,Array.isArray(t)&&2===(null==t?void 0:t.length)&&t[1]&&t[1].type&&t[1].version){const e="string"==typeof t[1].version&&t[1].version,r=e&&new pe.Version(e),n=new pe.Version(pe.SANITIZED_VERSION_STR);if(r&&n.lt(r))return(0,x.setMdOptedIn)(!0),ue.Updater.restart(!0),void this.exitLoop()}this.shouldUpgradeToMDPord=!0,this.exitLoop()}else if(Fe.HARD_REFRESH.test(e))__LOG__(2)`ws2:hard refresh!`,ue.Updater.restart(!0);else if(t){const r=Array.isArray(t)?` [${String(t[0])}, ...]`:"",n=(0,d.default)(t)&&"number"==typeof t.status?t.status:null;fe.default.logRecv(e.tag,e.binarySize,n);const i=null!=n?`,{status:${n}}`:"";__LOG__(2)`    recv: ${e.tag}${r}${i}`}else fe.default.logAck(e.tag),__LOG__(2)`     ack: ${e.tag}`}else R.Clock.setSkew(this.socket.timeSkew||0);this.sendRemainingLogouts()}onPhoneWatchdogActivated(){}onPhoneWatchdogFed(){this.state=ae.SOCKET_STATE.CONNECTED}onPhoneWatchdogDeactivated(){}flushQueue(){if(!this.sendQueue.length)return;const e=this.sendQueue.filter((e=>e.state===Z.default.STATE.NEW&&this.canRequestBeSent(e))),t=R.Clock.localUnixTime(),r=[],n=[];e.forEach((e=>{!function(e,t){if(e.resendGuard&&!e.resendGuard())return!0;if(e.binaryOpts&&null!=e.binaryOpts.expires&&0!==e.binaryOpts.expires)return t-e.binaryOpts.expires>120;return!1}(e,t)?n.push(e):r.push(e)})),this.sendQueue=(0,c.default)(this.sendQueue,r),r.forEach((e=>{delete this.sendHash[e.tag],delete this.doubleAckHash[e.tag],fe.default.delete(e.tag),e.onSend({status:408})})),n.length&&n.forEach((e=>{this._send(e)}))}phoneTimedOut(){const e=this.phoneWatchdog.failGeneration;if(1===e){__LOG__(3)`ws2:Phone timed out`;const e=(0,p.default)(this.sendHash,"tag");__LOG__(3)`ws2:Outstanding Reqs: ${e.join(",")}`}D.Cmd.sentPing(e);const t=this.phoneWatchdog.waitAlgorithm(this.phoneWatchdog);return this.set({state:ae.SOCKET_STATE.TIMEOUT,retryTimestamp:Date.now()+t}),this._basicSend({tag:this.tag("ping"),data:["admin","test"]},"ping"),!0}clearSendHash(e){if(e)(0,l.default)(this.sendHash,(function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new he.LogoutDrop(e.toString()))}));else{const e=(0,s.default)(this.sendHash,"ephemeral");__LOG__(3)`Ephemeral Drop: ${(0,p.default)(e,"tag").join(",")}`,e.forEach((function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new he.EphemeralDrop(e.toString()))}))}this.sendHash={},this.doubleAckHash={},this.pendingPhoneReqs=0,this.phoneWatchdog&&this.phoneWatchdog.deactivate(),fe.default.clear()}_basicSend(e,t){__LOG__(2)`low-send: ${t} ${String(e.tag)}`,fe.default.logBasicSend(e.tag,e.data),this.socket.cast(`${String(e.tag)},${String(JSON.stringify(e.data))}`)}_send(e){e.tag=e.getTag()||this.shortTag(),e.onTag&&e.onTag(e.tag),this.sendHash[e.tag]=e,e.tagToCancel&&(this.cancelHash[e.tag]=e.tagToCancel),(e.isCallOffer||e.isWap4Bridge)&&(this.doubleAckHash[e.tag]=e),e.binaryOpts?e.binaryOpts.debugObj:e.data,fe.default.logSend(e),__LOG__(2)`    send: ${String(e.tag)}, ${e.toString()}`,this.socket.send(e.serialize()),e.isToPhone&&this.pendingPhoneReqs++,e.state=Z.default.STATE.SENT}sendBasic(e){return this.socket?(e.tag=this.tag(),this._basicSend(e,"external"),this.socket.nextMessage(Fe.TAG(e.tag))):Promise.reject("socket not open")}sendEphemeral(e){e.ephemeral=!0;const t=new Z.default(e);this.canRequestBeSent(t)?this._send(t):t.onDrop(new he.EphemeralDrop(t.toString()))}sendEphemeral2(e){return new Promise(((t,r)=>{const n=new Z.default(e);n.ephemeral=!0,this.canRequestBeSent(n)?(n.onSend=t,n.onDrop=e=>{__LOG__(4,void 0,new Error)`ws2:sendEphemeral2:request.onDrop`,r(e)},this._send(n)):r(new he.EphemeralDrop(n.toString()))}))}sendEphemeralIgnore(e){e.ephemeral=!0,e.ignore=!0,e.tag=this.tag();const t=new Z.default(e);if(this.canRequestBeSent(t)){const e=t.serialize();this.socket.send(e),__LOG__(2)`sending: ${String(t.tag)}, ${t.toString()}`}else t.onDrop(new he.EphemeralDrop(t.toString()))}on5xx(e){__LOG__(3)`ws2:onMessage 5xx error ${String(e.tag)}`,e.on5xx&&e.on5xx(),e.resends>=5?(__LOG__(3)`ws2:onMessage dropping ${String(e.tag)}`,e.onDrop(new he.Server5xxDrop),delete this.sendHash[e.tag],fe.default.delete(e.tag),this.sendQueue=(0,o.default)(this.sendQueue,e)):this.maybeResendRequestEventually(e)}onMessage(e){const t=e.tag,n=e.data,i=e.binarySize;if(Ye(n)&&(this.lastPhoneMessage=(0,C.default)().unix()),Fe.PONG.test(e)){if(n[1]){let e=0,t=!1;(0,l.default)(this.sendHash,(function(n){if(!n.isToPhone)return;const i=++n.age;40===i?(t=!0,__LOG__(4,void 0,new Error)`${n.tag+" likely dead: "+n.toString()}`,D.Cmd.cannotReachPhone("("+n.tag+") "+n.toString()),r(56891).default.cannotReachPhone()):i<40&&e++})),this.pendingPhoneReqs=e,this.phoneWatchdog.feed(),0===e&&this.phoneWatchdog.deactivate(),t&&__LOG__(3)`ws2:error-cannot-reach-phone`}else this.state!==ae.SOCKET_STATE.TIMEOUT?__LOG__(3)`ws2:Pang while not timed-out`:this.runPromise.cancel(new we);return}const a=this.sendHash[t];if(a){if(!n)return a.state=Z.default.STATE.WEBDACKED,void(a.isToPhone&&this.phoneWatchdog.activate());if(a.retryOn5xx&&xe.test(n))this.on5xx(a,n);else{let r=!0;if(this.doubleAckHash[t]&&(delete this.doubleAckHash[t],!a.isCallOffer&&!a.isWap4Bridge||200!==n.status||n.payload||(r=!1)),r){let r;try{a.logOnSend&&a.logOnSend(e),r=a.onSend(n)}catch(e){if(e instanceof he.E401)return void this.logout();__LOG__(3)`ws2:onMessage error`,a.onDrop(e)}if(xe.test(r)?this.on5xx(a,r):(delete this.sendHash[t],this.sendQueue=(0,o.default)(this.sendQueue,a)),Be.test(n)){const e=this.cancelHash[t];if(e){const r=this.sendHash[e];delete this.cancelHash[t],delete this.sendHash[e],this.sendQueue=(0,o.default)(this.sendQueue,r)}}}}a.isToPhone&&(a.age<40&&this.pendingPhoneReqs--,this.phoneWatchdog.feed(),0===this.pendingPhoneReqs&&this.phoneWatchdog.deactivate())}else if(n){if(Ke.test(n))__LOG__(3)`ws2: unexpected response status`;else if(n instanceof ArrayBuffer)r(56891).default.handle(n,this,t,i).catch((0,y.filteredCatch)(he.WebdDrop,(()=>{})));else try{this.handler?this.handler(n):__LOG__(3)`ws2: received message, but no handler is registered`}catch(e){if(e instanceof U.UpdateImmediately)this.exitLoop(e);else{if(!(e instanceof U.DeprecatedProtocolVersion))throw e;this.runPromise&&this.runPromise.cancel(e)}}Ye(n)&&this.phoneWatchdog.feed()}}run(e,t){var r=this;return this.runPromise=le.default.resolve(e).cancellable().then((e=>{if(this.state=ae.SOCKET_STATE.OPENING,D.Cmd.incrementProgress(),e>0){__LOG__(2)`ws2:Run Backoff ${e}ms`;const t=(0,E.delayMs)(e).cancellable().catch((0,y.filteredCatch)(ye,(()=>{})));return this.setPokeable(t,Date.now()+e),t}})).finally((()=>{this.unset("pokeable"),this.unset("retryTimestamp")})).then((()=>(D.Cmd.incrementProgress(),__LOG__(2)`ws2:Running`,this.openSocket()))).then((e=>{if(D.Cmd.incrementProgress(),e.onactivity=this.onActivity.bind(this),this.socket=e,this.socketWatcher=X.attachWatcher(this.runPromise,this.throwOnClose()),this.state=ae.SOCKET_STATE.PAIRING,void 0===this.isIncognito)return X.waitForBBEvent(this,"change:isIncognito")})).then((()=>{D.Cmd.incrementProgress(),this.shortTagBase=((0,C.default)().unix()%1e3).toString();const e=this.initConn();if((0,x.knowsPhone)()){const r=this.requestSync(t),n=Promise.all([e,r]).finally((function(){e.cancel(),r.cancel()})),i=(0,V.requireChatCollection)().then((e=>{this.hasSynced&&e.length<=5e3&&!B.GK.supportsFeature(B.GK.F.MD_BACKEND)&&(this.resumePromise=this.runResume(!0))}));return Promise.all([n,i])}return e.then((()=>{this.set({state:ae.SOCKET_STATE.UNPAIRED,refWatcher:X.attachWatcher(this.runPromise,this.manageRef())})}))})).then((()=>this.waitForSyncInfo())).finally((()=>{this.refWatcher&&(this.refWatcher.cancel(),this.unset("refWatcher"))})).then(function(){var e=(0,i.default)((function*(e){return D.Cmd.incrementProgress(),__LOG__(2)`ws2:completed ${r.hasSynced?"re-auth":"auth"}`,r.state=ae.SOCKET_STATE.CONNECTED,L.Conn.blockStoreAdds=!1,L.Conn.platform=e.platform,yield X.waitForMain(),e}));return function(){return e.apply(this,arguments)}}()).then((function(e){return __LOG__(2)`ws2:main loaded`,e.initial=!0,(0,k.default)([e])})).then((()=>(0,$.initialize)().catch((e=>{__LOG__(3)`Error initializing database during sync: ${e}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error initializing database during sync")})))).then((()=>{const e=this.openStream();return this.streamPromise=e,e})).then((function(){return new le.default})).catch((0,y.filteredCatch)(U.SocketClosed,(function(e){throw e.event instanceof Oe?e.event:e}))).catch((e=>{__LOG__(3)`ws2:run loop interrupt: ${e}`,this.set({canSend:!1,stream:ae.SOCKET_STREAM.DISCONNECTED,runPromise:null}),this.phoneWatchdog.deactivate(),this.streamPromise&&(this.streamPromise.cancel(),this.unset("streamPromise")),this.socketWatcher&&(this.socketWatcher.cancel(),this.unset("socketWatcher"));const t=this.socket;if(t&&t.state!==ae.WATCHED_SOCKET_STATE.CLOSED&&(t.detachCallbacks(),t.close(!0,e)),this.unset("socket"),this.shouldUpgradeToMDIntern)return D.Cmd.upgradeToMDInternal(),!1;if(this.shouldUpgradeToMDPord)return D.Cmd.upgradeToMDProd(),!1;throw e})).catch((0,y.filteredCatch)(U.UpdateImmediately,(e=>{throw this.updateImmediately(e.message),new Ee}))).catch((0,y.filteredCatch)(U.DeprecatedProtocolVersion,(()=>this.deprecatedVersion()))).catch((0,y.filteredCatch)([he.E401,we],(function(){return!1}))).catch((0,y.filteredCatch)(Pe,(()=>(this.clearState(),!1)))).catch((0,y.filteredCatch)([U.SocketClosed,U.SocketError,Ge],(()=>!0))).catch((0,y.filteredCatch)(be,function(){var e=(0,i.default)((function*(){return __LOG__(3)`ws2:sync rejected, logging out`,yield r.sendCurrentLogout(null,H.LogoutReason.UnknownCompanion),yield r.clearCredentialsAndStoredData(),D.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,y.filteredCatch)([Se,ke],function(){var e=(0,i.default)((function*(e){return __LOG__(2)`ws2:phone disassociated via ${String(e)}`,yield r.clearCredentialsAndStoredData(),D.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,y.filteredCatch)(Le,(0,i.default)((function*(){return __LOG__(3,void 0,void 0,!0)`ws2:No secret bundle!`,SEND_LOGS("no-secret-bundle"),yield r.clearCredentialsAndStoredData(),D.Cmd.logout(),!1})))).catch((0,y.filteredCatch)(Me,(()=>(this.state=ae.SOCKET_STATE.UNPAIRED_IDLE,this.setPokeable(X.waitForOfflineNaive().then((()=>{throw new Ie})).catch((0,y.filteredCatch)(ye,(()=>!1)))))))).catch((0,y.filteredCatch)(U.BlockedByProxy,(()=>(M.default.promptUnloadGuards++,this.state=ae.SOCKET_STATE.PROXYBLOCK,this.setPokeable((new le.default).catch((0,y.filteredCatch)(ye,(()=>!1))).finally((function(){M.default.promptUnloadGuards--}))))))).catch((0,y.filteredCatch)(Te,(e=>{__LOG__(2)`ws2:denied tos`;const t=this.setPokeable((new le.default).cancellable().catch((0,y.filteredCatch)(ye,(()=>!1)))).cancellable(),r=e instanceof Ce?ae.SOCKET_STATE.TOS_BLOCK:ae.SOCKET_STATE.SMB_TOS_BLOCK;return this.clearState(),this.set({state:r,runPromise:t}),t}))).catch((0,y.filteredCatch)([ve,Ne],(e=>{e instanceof ve?__LOG__(2)`ws2:phone denied (conflict)`:__LOG__(2)`ws2:phone replaced`;const t=(new le.default).cancellable();return this.set({state:ae.SOCKET_STATE.CONFLICT,conflictPromise:t,runPromise:t}),this.clearState(),t}))).finally((()=>{this.conflictPromise&&this.conflictPromise.cancel()})).catch((0,y.filteredCatch)([Oe,Ie],(function(){return!1})))}openSocket(){const e=this.socketPreload;if(this.socketPreload=null,(null==e?void 0:e.socket)&&e.socket.state===ae.WATCHED_SOCKET_STATE.OPEN)return Promise.resolve(e.socket);const t=e&&e.active?e:new oe.default,r=()=>{this.retryTimestamp=t.retryTimestamp};t.on("change:retryTimestamp",r),this.pokeable=t;const n=X.waitForBBEvent(t,"change:socket").cancellable().then((()=>t.socket)).finally((()=>{t.off("change:retryTimestamp",r),t.onerror=null,t.deactivate(),this.pokeable=null}));return t.onerror=e=>{n.cancel(e)},n}initConn(){var e=this;return(0,i.default)((function*(){const t=e.tag("init"),r=M.default.info(),n=[Number("2"),Number("2208"),Number("7")];e._basicSend({tag:t,data:["admin","init",n,[r.os||"Unknown",r.name||"Unknown",r.version||"Unknown"],M.default.id(),!e.isIncognito&&!!(0,x.getRememberMe)()]},"init");const i=yield e.socket.nextMessage(Fe.TAG(t)).get("data");R.Clock.setSkew(Date.now()-i.time),(0,k.default)([{id:"1",ref:i.ref,refTTL:i.ttl}])}))()}manageRef(){var e=this;return(0,S.promiseLoop)(function(){var t=(0,i.default)((function*(t,r,n){const i=L.Conn.refExpiry-Date.now()-500,a=(yield(0,E.delayMs)(Math.max(i,0)).cancellable().then((()=>{if(n>=5)throw new Me;__LOG__(2)`ws2:Requesting Ref Update`;const t=e.tag("qr"+n);return e._basicSend({tag:t,data:["admin","Conn","reref"]},"reref"),e.socket.nextMessage(Fe.TAG(t))}))).data;switch(a.status){case 200:return __LOG__(2)`ws2:Updating Ref`,void(0,k.default)([{ref:a.ref,refTTL:a.ttl}]);case 304:return __LOG__(2)`ws2:Keeping Ref`,void t();case 429:throw __LOG__(2)`ws2:Server denied new ref`,new Me;default:throw __LOG__(3)`ws2:Bad Ref Response!`,new Re("unrecognized ref request status ("+a.status+")")}}));return function(){return t.apply(this,arguments)}}()).cancellable()}requestSync(e){if(this.syncTag=this.tag("sync"),!ee.load())return Promise.reject(new Le);const{client:t,server:r}=(0,x.getLoginTokens)(),n=["admin","login",t,r,M.default.id()];e?n.push("takeover"):this.hasSynced&&(n.push(this.shouldForceReconnect?"force_reconnect":"reconnect"),n.push((0,x.getMaybeMeUser)()));const i=()=>(this._basicSend({tag:this.syncTag,data:n},"sync"),!0),a=new _e.Watchdog({waitAlgorithm:(0,_e.fibonacci)(0,8500,6e4),onTimeout:i});a.on("change:ts",(()=>{this.retryTimestamp=a.ts})),this.pokeable=a,a.activate(),i();const o=this.socket.nextMessage(Fe.TAG(this.syncTag)),s=this.lookForAndHandleChallenge().catch((0,_.catchAbort)((()=>{}))).catch(o.cancel.bind(o));return o.then((e=>{__LOG__(2)`ws2:login`;const t=e.data;switch(t.status){case 200:return e;case 401:throw new Se;case 403:throw t.tos>=2?new Ce:t.smbTos?new Ae:new be;case 405:throw __LOG__(3,void 0,void 0,!0)`ws2:Already authorized!`,SEND_LOGS("already-authorized"),new Pe;case 409:throw new ve;case 500:throw new Ge;default:throw __LOG__(3)`ws2:unknown error! status:${t.status}`,new be}})).finally((()=>{s.cancel(),a.deactivate(),this.unset("pokeable"),this.unset("retryTimestamp")}))}waitForSyncInfo(){var e=this;return(0,i.default)((function*(){return(yield e.socket.nextMessage(Fe.SYNC_INFO)).data[1]}))()}lookForAndHandleChallenge(){var e=this;return(0,i.default)((function*(){const t=yield e.socket.nextMessage(Fe.CHALLENGE).then((function(e){__LOG__(2)`ws2:challenged!`;const t=(0,h.decodeB64)(e.data[1].challenge);return ee.getSecurityToken(t)})).then((t=>{const r=(0,x.getLoginTokens)(),n=r?r.server:void 0;if(!n)throw __LOG__(3)`ws2:handleChallenge no server token!`,new Error("Handle challenge no server token");const i=e.tag("challenge");return e._basicSend({tag:i,data:["admin","challenge",t,n,M.default.id()]},"challenge"),e.socket.nextMessage(Fe.TAG(i))}));return t.data.status>=500?Promise.reject(new Ge):t.data.status>=400?(__LOG__(3)`ws2:handleChallenge failed challenge!`,Promise.reject(new Se)):void __LOG__(2)`ws2:handleChallenge passed challenge`}))()}throwOnClose(){return this.socket.nextMessage(Fe.DISCONNECT).then((function(e){throw"replaced"===e.data[1].kind?new Ne:new ke}))}onCriticalSyncDone(){B.GK.supportsFeature(B.GK.F.MD_BACKEND)&&(__LOG__(2)`[ws2] moving to main screen from onCriticalSyncDone`,this.set({hasSynced:!0,stream:ae.SOCKET_STREAM.CONNECTED}))}openStream(){var e=this;return(0,i.default)((function*(){if(B.GK.supportsFeature(B.GK.F.MD_BACKEND)){return(0,x.getMeUser)()&&(L.Conn.blockStoreAdds=!1,L.Conn.id="1",L.Conn.trigger("me_ready")),void(yield(0,b.addMeToContacts)())}let t;if(e.canSend=!0,e.hasSynced)e.resumePromise||(e.resumePromise=e.runResume(!1)),t=e.resumePromise.finally((()=>{e.unset("resumePromise")}));else{const n=(0,V.requireContactCollection)().then((e=>e.sync()));if(t=(0,V.requireChatCollection)().then((e=>e.sync())).cancellable().then((()=>(e.set({hasSynced:!0,stream:ae.SOCKET_STREAM.CONNECTED}),(0,V.requireStickerPackCollection)().then((e=>{e.preFetch()})).catch((e=>{__LOG__(3)`Error: prefetch StickerPacks\n${e.stack}`})),B.GK.supportsFeature(B.GK.F.USER_NOTICE)&&q.default.sync(),B.GK.supportsFeature(B.GK.F.SETTINGS_SYNC)&&re.default.sync(),n))).catch((t=>{throw e.set({hasSynced:!1,stream:ae.SOCKET_STREAM.DISCONNECTED}),t})).catch((0,_.catchAbort)((()=>{}))),(0,V.requireStatusV3Collection)().then((e=>{e.sync()})),L.Conn.isSMB){if(B.GK.supportsFeature(B.GK.F.QUICK_REPLIES_QUERY)){r(99662).QuickReplyCollection.sync()}(0,K.canDisplayLabel)()&&(0,V.requireLabelCollection)().then((e=>{e.sync()}))}}try{return yield(0,V.requireMsgCollection)().cancellable().then((e=>{e.markAllAsStale()})),e.stream=e.hasSynced?ae.SOCKET_STREAM.RESUMING:ae.SOCKET_STREAM.SYNCING,e.socket.onmessage=e.onMessage.bind(e),e.socket.releaseMessages(),t}catch(e){return(0,_.catchAbort)((function(){t.cancel()}))(e)}}))()}queryReceivedActions(){const e=this,t=(0,s.default)(this.sendQueue,"clientCacheable"),n=(0,p.default)(t,"tag").filter((function(e){return e}));return __LOG__(2)`ws2:queryReceivedActions`,0===n.length?Promise.resolve():r(56891).default.queryReceivedActions(n).then((function(r){Array.isArray(r)?r.forEach((function(t){const r=function(e,t){for(let r=t;r<e.length;r++){const t=e[r];if(t.tag)return t}}(e.sendQueue,parseInt(t.id,10)||0);if(r)if(__LOG__(2)`ws2:queryReceivedActions found dup: ${t.id},${t.code}`,delete e.sendHash[t.id],fe.default.delete(t.id),e.sendQueue=(0,o.default)(e.sendQueue,r),r.onSend){const e=r.onSend({status:t.code,_duplicate:!0});xe.test(e)&&r.onDrop(new he.Server5xxDrop)}else __LOG__(3)`ws2:queryReceivedActions onSendDup undefined; should be defined: ${t.id}`,r.onDrop(new he.ConventionViolationDrop);else __LOG__(3)`ws2:queryReceivedActions unknown tag in response: ${t.id}`})):"replaced"===r?(t.forEach((function(e){e.onDrop(new he.BrowserReplacedDrop)})),e.sendQueue=(0,c.default)(e.sendQueue,t)):__LOG__(3)`ws2:queryReceivedActions error`}))}runResume(e){return Promise.all([this.queryReceivedActions(),(0,V.requireChatCollection)().then((e=>e.resyncMessages())),(0,V.requireMsgCollection)().then((e=>e.resyncReceipts()))]).then((()=>{this.trigger("didResume"),this.flushQueue(),this.stream=ae.SOCKET_STREAM.CONNECTED})).catch((0,y.filteredCatch)(he.WebdDrop,(()=>{this.stream=ae.SOCKET_STREAM.DISCONNECTED}))).catch((0,_.catchAbort)((()=>{this.stream=ae.SOCKET_STREAM.DISCONNECTED}))).catch((t=>{if(!e)throw __LOG__(3,!0,void 0,!0)`ws2:error during resume, resyncing: ${String(t)}\n${t.stack}`,SEND_LOGS("error-on-resume"),this.stream=ae.SOCKET_STREAM.DISCONNECTED,new Pe;if(this.canSend)return this.runResume(!1);this.unset("resumePromise")}))}setPokeable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.retryTimestamp;return this.set({pokeable:{poke(){e.cancel(new ye)}},retryTimestamp:t}),e}clearCredentials(){var e=this;return(0,i.default)((function*(){(0,x.updatePreservedUserKeys)();let t=!1;try{t=yield e.clearState()}catch(e){t=!0}try{(0,x.setBrowserId)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearState error ${e}`}try{(0,x.setUnknownId)()}catch(e){__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setUnknownId error ${e}`}try{(0,x.setMe)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setMe error ${e}`}if(B.GK.supportsFeature(B.GK.F.MD_BACKEND)){try{(0,z.clearRegistrationInfo)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearRegistrationInfo error ${e}`}try{yield(0,ie.destroy)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:destroySignal error ${e}`}try{yield(0,G.deleteEncKeysAndCache)();(0,r(73368).cn)()}catch(e){t=!0}}else{try{(0,x.clearTokens)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearTokens error ${e}`}try{ee.clear()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:SecretBundle clear error ${e}`}}try{yield(0,x.clearAllLocalState)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearAllLocalState error ${e}`}return t}))()}clearState(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ws2:clearState`;let t=!1;e.sendQueue=[],e.clearSendHash(!0),e.unset("hasSynced");try{(yield(0,V.requireClearAppStates)())()}catch(e){t=!0,e instanceof U.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_session_app_state"))}try{yield(0,I.default)()}catch(e){t=!0,e instanceof U.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_persistent_app_state"))}return t}))()}maybeResendRequestEventually(e){const t=300*ce.expBackoff(e.resends,100);__LOG__(2)`ws2:Resending ${e.toString()} in ${t}ms`,e.state=Z.default.STATE.WILL_RETRY,e.resendTimer=setTimeout((()=>{e.resends++,e.resendTimer=void 0,this.sendHash[e.tag]===e&&(!e.resendGuard||e.resendGuard()?this._send(e):e.onSend({status:408}))}),t)}sendCurrentLogout(e,t){let n;if(B.GK.supportsFeature(B.GK.F.MD_BACKEND))n=(0,de.unpairDevice)(t).then((e=>{200!==e.status&&__LOG__(3)`ws2:multi-device logout failed with error code ${e.status}`,(0,N.stopComms)()})).catch((e=>{__LOG__(4,!0,new Error)`[CRITICAL] unpairDevice failed with error, preoceed with local logout \n${e.stack}`})),n||(n=Promise.reject(new Error("sendCurrentLogout: should not reach")));else{let t;t=ee.load()?r(56891).default.logoutToken().then((e=>{const t={t:(0,x.getLogoutToken)(),m:e},r=(0,x.getOldLogoutCreds)();return r.push(t),(0,x.setOldLogoutCreds)(r),t})):Promise.resolve({}),n=t.then((t=>{if(e&&e.state===ae.WATCHED_SOCKET_STATE.OPEN){let r=this.logoutMutex;this.logoutMutex=r<=0?r=1:++r,__LOG__(2)`ws2:logout through socket`,e.partingSend(new Oe,'goodbye,,["admin","Conn","disconnect"]',(e=>0===e.indexOf("goodbye,"))).then((function(e){e?(__LOG__(2)`ws2:logout through socket success`,We(t)):__LOG__(3)`ws2:logout through socket failure, will POST`})).finally((()=>{this.logoutMutex===r&&(this.logoutMutex=0)}))}else this.logoutMutex<0&&(this.logoutMutex=0),this.sendRemainingLogouts()}))}return n}sendRemainingLogouts(){let e=this.logoutMutex;if(0!==e)return;const t=r(11854).default,n=(0,x.getOldLogoutCreds)();0!==n.length?(this.logoutMutex=e=1,Promise.all((0,p.default)(n,function(){var e=(0,i.default)((function*(e){__LOG__(2)`ws2:POST logout`;try{yield t.post("https://web.whatsapp.com/logout",e),We(e)}catch(e){__LOG__(3)`ws2:POST logout failure`}}));return function(){return e.apply(this,arguments)}}())).finally((()=>{e===this.logoutMutex&&(this.logoutMutex=0)}))):this.logoutMutex=-1}updateImmediately(e){O.upload({reason:e,immediate:!0}).finally((()=>{ue.Updater.restart(!0)}))}deprecatedVersion(){__LOG__(2)`ws2:deprecated version`,O.upload({reason:"ws2:deprecated version",immediate:!0});const e=this.setPokeable((new le.default).cancellable().catch((0,y.filteredCatch)(ye,(()=>!1)))).cancellable();return this.clearState(),this.set({state:ae.SOCKET_STATE.DEPRECATED_VERSION,runPromise:e}),e}canRequestBeSent(e){return!!this.canSend||Boolean(this.socket)&&(0,x.knowsPhone)()&&e.serverCacheable}}function Ye(e){return e instanceof g.Binary}function We(e){const t=(0,x.getOldLogoutCreds)(),r=(0,a.default)(e);(0,x.setOldLogoutCreds)((0,s.default)(t,(e=>!r(e))))}const He=new((0,P.defineModel)(je));t.Socket=He},27086:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){f=null},t.destroy=function(){return(0,s.destroyStorage)().catch((()=>p.resolve(new i.default(s.DATABASE_NAME).delete()))).finally((()=>(f=null,p.resolve(new i.default("fts-storage-dogfooding").delete()))))},Object.defineProperty(t,"getIndexV1Table",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getIndexV2Table",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getIndexV3Table",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getManifestTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getPurgeRangeQueueTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getV2TokenToPrefixMappingTable",{enumerable:!0,get:function(){return d.getTable}}),t.initialize=function(){null==f&&((0,s.createStorage)(),(0,a.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,o.addTable)(),(0,u.addTable)(),f=(0,s.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize fts storage"),e})));return f};var i=n(r(86128)),a=r(66991),o=r(69508),s=r(36376),l=r(94831),c=r(57810),d=r(80277),u=r(22812);const p=r(74121).Z;let f},66991:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=t.ManifestKeys=void 0,t.addTable=function(){(0,a.getStorage)().add(l).version((0,s.manifestCreateTable)(),[new o.default("key"),new i.default("tokenizerVersion"),new i.default("schemaVersion"),new i.default("isCurrent"),new i.default("lastMsgKeyViaFullIndexer"),new i.default("isFullIndexingComplete")]).view((e=>e||null))},t.getTable=function(){return(0,a.getStorage)().table(l)};var i=n(r(79051)),a=r(36376),o=n(r(89362)),s=r(43809);const l="manifest";t.TABLE_NAME=l;const c=Object.freeze({PREV_VERSION:"prev.version",CURR_VERSION:"curr.version",NEXT_VERSION:"next.version"});t.ManifestKeys=c},69508:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(l).version((0,s.purgeRangeQueueCreateTable)(),[new a.default(["chatId","tsOfLastMessage","startRowId","endRowId"]),new i.default("offset")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table(l)};var i=n(r(79051)),a=n(r(54180)),o=r(36376),s=r(43809);const l="fts-purge-range-queue";t.TABLE_NAME=l},94831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,s.getStorage)().add(d).version((0,c.ftsV1IndexCreateTable)(),[new l.default("token"),new o.default("ids"),new a.default("ids"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildEntry)(e.prefixes,e.ids):null))},t.getTable=function(){return(0,s.getStorage)().table(d)};var i=r(96573),a=n(r(92061)),o=n(r(79051)),s=r(36376),l=n(r(89362)),c=r(43809);const d="fts-v1-index";t.TABLE_NAME=d},57810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV2IndexCreateTable)(),[new l.default(["id","chatId","token"]),new s.default("id"),new s.default("chatId"),new s.default("token"),new o.default(["chatId","token"]),new a.default("timestamp"),new o.default(["id","token"])]).view((e=>e?(0,i.buildEntry)(e.id,e.chatId,e.token,e.timestamp):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=r(44152),a=n(r(79051)),o=n(r(34654)),s=n(r(19570)),l=n(r(54180)),c=r(36376),d=r(43809);const u="fts-v2-index";t.TABLE_NAME=u},80277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(c).version((0,l.ftsV2TokenToPrefixesCreateTable)(),[new s.default("token"),new a.default("prefixes"),new i.default("prefixes")]).view((e=>e||null))},t.getTable=function(){return(0,o.getStorage)().table(c)};var i=n(r(92061)),a=n(r(79051)),o=r(36376),s=n(r(89362)),l=r(43809);const c="fts-v2-token-prefixes";t.TABLE_NAME=c},22812:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV3IndexCreateTable)(),[new l.default("ftsRowId"),new o.default("id"),new s.default("id"),new o.default("chatId"),new s.default("chatId"),new o.default("timestamp"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildDBEntry)(e.ftsRowId,e.id,e.chatId,e.timestamp,e.prefixes):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=r(14056),a=n(r(92061)),o=n(r(79051)),s=n(r(19570)),l=n(r(81674)),c=r(36376),d=r(43809);const u="fts-v3-index";t.TABLE_NAME=u},36376:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[fts-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[fts-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="fts-storage";t.DATABASE_NAME=c;let d=null},43809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ftsV1IndexCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.ftsV2IndexCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.ftsV2TokenToPrefixesCreateTable=function(){return(0,n.getStorage)().versions.version(4)},t.ftsV3IndexCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.manifestCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.purgeRangeQueueCreateTable=function(){return(0,n.getStorage)().versions.version(2)};var n=r(36376)},16703:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>s.resolve(new i.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getJobsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize jobs storage"),e})));return l};var i=n(r(86128)),a=r(57267),o=r(87758);const s=r(74121).Z;let l},57267:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("jobs-store").version((0,c.jobsCreateV1Table)(),[new o.default("jobId"),new i.default("type"),new i.default("uniqKey"),new a.default("uniqKey"),new i.default("original"),new i.default("current"),new i.default("step"),new i.default("startTime"),new i.default("endTime"),new i.default("stepHardStartCountAfterTimeout"),new i.default("stepFirstStartTime"),new i.default("waitUntil"),new i.default("backedOffCount"),new i.default("version")]).version((0,c.jobsCreateV2Table)(),[new i.default("stepUnexpectedErrorCount"),new s.default("endTime")]).view((e=>({jobId:e.jobId,type:e.type,uniqKey:e.uniqKey,original:e.original,current:e.current,step:e.step,startTime:e.startTime,stepHardStartCountAfterTimeout:e.stepHardStartCountAfterTimeout,stepFirstStartTime:e.stepFirstStartTime,waitUntil:e.waitUntil,backedOffCount:e.backedOffCount,version:e.version,stepUnexpectedErrorCount:e.stepUnexpectedErrorCount})))},t.getTable=function(){return(0,l.getStorage)().table("jobs-store")};var i=n(r(79051)),a=n(r(19570)),o=n(r(81674)),s=n(r(23263)),l=r(87758),c=r(93695)},87758:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[jobs-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[jobs-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="jobs-storage";t.DATABASE_NAME=c;let d=null},93695:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobsCreateV1Table=function(){return(0,n.getStorage)().versions.version(0)},t.jobsCreateV2Table=function(){return(0,n.getStorage)().versions.version(1)};var n=r(87758)},98883:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(66751),s=n(r(86128)),l=n(r(41143)),c=r(86445),d=r(15998),u=r(78585);s.default.Promise.PSD.onunhandled=()=>{};const p=r(74121).Z;function f(){return(f=(0,i.default)((function*(e,t,r,n){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const i=n?d.DbEncKeyStore.dbMsgEncKeys[d.DbEncKeyStore.dbMsgEncKeys.length-1]:d.DbEncKeyStore.encKeys[d.DbEncKeyStore.encKeys.length-1],a=new Uint8Array(16);self.crypto.getRandomValues(a);const o=r===c.ENCRYPTED_VALUE_TYPE.STRING?(new TextEncoder).encode(e):e;try{const e=self.crypto.subtle.encrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},i.key,o),t=null==s.default.currentTransaction?e:s.default.waitFor(e);return{_data:yield p.resolve(t),iv:a,_keyId:i.id}}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r,n){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const{_data:i,iv:a,_keyId:o}=e,u=n?d.DbEncKeyStore.dbMsgEncKeys.filter((e=>e.id===o))[0]:d.DbEncKeyStore.encKeys.filter((e=>e.id===o))[0];if((0,l.default)(null!=u,"Encryption key id not found"),null==i)return i;try{const e=self.crypto.subtle.decrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},u.key,i),t=null==s.default.currentTransaction?e:s.default.waitFor(e),n=yield p.resolve(t);return r===c.ENCRYPTED_VALUE_TYPE.STRING?new TextDecoder("utf-8").decode(n):n}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}class h{constructor(e,t,r,n,i,a){this.table=e,this.view=r,this.db=t,this.propFilter=n,this.tableEncryptedColumns=new Map(Object.keys(i).map((e=>[e,i[e]]))),this.shouldUseDbMsgEncKeyForEncryptedCol=a}asyncView(e){var t=this;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.default)((function*(){if(!t._hasEncryptedColumn()||!r)return t.view(e);const n=yield t._decryptColumns(e);return t.view(n)}))()}_decryptColumns(e){var t=this;return(0,i.default)((function*(){(0,l.default)("object"==typeof e,"Called `_decryptColumns` with primitive value");const r=Array.from(t.tableEncryptedColumns.entries()).map((r=>{let[n,i]=r;const a=e[n];return(null==a?void 0:a._data)&&(null==a?void 0:a.iv)?function(){return _.apply(this,arguments)}(a,n,i,t.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[n]=t})):a}));return yield Promise.all(r),e}))()}_encryptColumns(e){const t=Array.from(this.tableEncryptedColumns.entries()).map((t=>{let[r,n]=t;const i=e[r];return null==i?i:function(){return f.apply(this,arguments)}(i,r,n,this.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[r]=t}))}));return Promise.all(t).then((()=>e))}_addAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.add(e);const r=yield t._encryptSingleUpdate(e);return t.table.add(r)}))()}_putAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.put(e);const r=yield t._encryptColumns(e);return t.table.put(r)}))()}_bulkAddAndEncrypt(e){return this._hasEncryptedColumn()?this._encryptBulkUpdates(e).then((e=>this.table.bulkAdd(e))):this.table.bulkAdd(e)}_bulkPutAndEncrypt(e){return this._hasEncryptedColumn()?s.default.waitFor(this._encryptBulkUpdates(e)).then((e=>this.table.bulkPut(e))):this.table.bulkPut(e)}_encryptBulkUpdates(e){if(!this._hasEncryptedColumn())return p.resolve(e);const t=[],r=e.map(((e,r)=>this._encryptColumns(e).then((e=>{t[r]=e}))));return Promise.all(r).then((()=>t))}_encryptSingleUpdate(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return e;return yield t._encryptColumns(e)}))()}asyncViewMap(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._hasEncryptedColumn()||!t)return Promise.resolve(e.map((e=>e?this.view(e):null)));const r=e.map((e=>null!=e?this.asyncView(e):p.resolve(null)));return p.resolve(null==s.default.currentTransaction?Promise.all(r):s.default.waitFor(Promise.all(r)))}preflightEncryptSingleRecord(e){return this.tableEncryptedColumns,Object.keys(e).forEach((t=>{this.tableEncryptedColumns.has(t)||delete e[t]})),this._encryptColumns(e)}postflightDecryptSingleRecord(e){var t=this;return(0,i.default)((function*(){const r=yield t._decryptColumns(e);return t.view(r)}))()}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkAdd(e)).catch((e=>{throw v(e,"bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY",this.table.name),e}))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkPut(e)).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e}))}create(e){const t=this.propFilter(e);return p.resolve(this._addAndEncrypt(t)).catch((e=>{throw v(e,"create",this.table.name),e}))}createOrReplace(e){const t=this.propFilter(e);return p.resolve(this._putAndEncrypt(t)).catch((e=>{throw v(e,"createOrReplace",this.table.name),e}))}createOrMerge(e,t){var r=this;return(0,i.default)((function*(){const n=r.propFilter(t),i=yield r._encryptColumns(n);return p.resolve(r.db.transaction("rw",r.table,(()=>r.table.where(":id").equals(e).modify((e=>{Object.assign(e,i)})).then((e=>{if(1!==e)return r.table.add(i)})))).then((()=>{}))).catch((e=>{throw v(e,"createOrMerge",r.table.name),e}))}))()}get(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return p.resolve(this.table.get(e)).then((e=>e?this.asyncView(e,t):null)).catch((e=>{throw v(e,"get",this.table.name),e}))}merge(e,t){var r=this;return(0,i.default)((function*(){const n=r.propFilter(t),i=yield r._encryptSingleUpdate(n);return p.resolve(r.table.update(e,i)).catch((e=>{throw v(e,"merge",r.table.name),e}))}))()}remove(e){return p.resolve(this.table.delete(e)).catch((e=>{throw v(e,"remove",this.table.name),e}))}bulkCreate(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkAddAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreate",this.table.name),e})):p.resolve(this.table.bulkAdd(t))}bulkCreateOrReplace(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkPutAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e})):p.resolve(this.table.bulkPut(t))}bulkCreateOrMerge(e){var t=this;return(0,i.default)((function*(){const r=new Map,n=t._primaryKey();function a(){return(a=(0,i.default)((function*(e){const r=t.table.where(":id").anyOf(Array.from(e.keys()));yield r.modify((t=>{Object.assign(t,e.get(t[n])),e.delete(t[n])}));return Array.from(e.values())}))).apply(this,arguments)}return(yield t._encryptBulkUpdates(e)).forEach((e=>{const i=t.propFilter(e);(0,l.default)(n in i,"Called `bulkCreateOrMerge` with item(s) not including the primary key"),r.set(i[n],i)})),p.resolve(t.db.transaction("rw",t.table,(()=>function(){return a.apply(this,arguments)}(r).then((e=>0===e.length?p.resolve():t.table.bulkPut(e)))))).catch((e=>{throw v(e,"bulkCreateOrMerge",t.table.name),e}))}))()}bulkGet(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return 0===e.length?p.resolve([]):p.resolve(this.db.transaction("r",this.table,(()=>{const t=e.map((e=>this.table.get(e)));return s.default.Promise.all(t)}))).then((e=>this.asyncViewMap(e,t))).catch((e=>{throw v(e,"bulkGet",this.table.name),e}))}bulkRemove(e){return 0===e.length?p.resolve():p.resolve(this.db.transaction("rw",this.table,(()=>this.table.bulkDelete(e)))).catch((e=>{throw v(e,"bulkRemove",this.table.name),e}))}bulkRemoveByIndex(e,t){return 0===t.length?p.resolve():p.resolve(E(this.table.where(y(e)).anyOf(t)).delete()).catch((e=>{throw v(e,"bulkRemoveByIndex",this.table.name),e}))}all(e,t){let r=E(this.table.orderBy((null==e?void 0:e.index)?y(e.index):":id"),e);t&&(r=r.until(t));let n=null;switch(null==e?void 0:e.returnKeyType){case"keys":n=p.resolve(r.keys());break;case"primary_key":n=p.resolve(r.primaryKeys());break;default:n=p.resolve(r.toArray()).then((t=>this.asyncViewMap(t,null==e?void 0:e.shouldDecrypt)))}return n.catch((e=>{throw v(e,"all",this.table.name),e}))}count(){return p.resolve(this.table.count()).catch((e=>{throw v(e,"count",this.table.name),e}))}bulkDeleteRange(e,t,r,n){return E(this.table.where(y(e)).between(t,r,!!(null==n?void 0:n.lowerInclusive),!!(null==n?void 0:n.upperInclusive)),n).delete().catch((e=>{throw v(e,"bulkDeleteRange",this.table.name),e}))}equals(e,t,r){return p.resolve(E(this.table.where(y(e)).equals(t),r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"equals",this.table.name),e}))}anyOf(e,t,r){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).anyOf(t),r).distinct().toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"anyOf",this.table.name),e}))}startsWithAnyOf(e,t,r){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).startsWithAnyOf(t),r).distinct().toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"startsWithAnyOf",this.table.name),e}))}greaterThan(e,t,r){const n=(null==r?void 0:r.inclusive)?this.table.where(y(e)).aboveOrEqual(t):this.table.where(y(e)).above(t);return p.resolve(E(n,r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"greaterThan",this.table.name),e}))}lessThan(e,t,r){const n=(null==r?void 0:r.inclusive)?this.table.where(y(e)).belowOrEqual(t):this.table.where(y(e)).below(t);return p.resolve(E(n,r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"lessThan",this.table.name),e}))}between(e,t,r,n,i){const a=E(this.table.where(y(e)).between(t,r,!!(null==n?void 0:n.lowerInclusive),!!(null==n?void 0:n.upperInclusive)),n);let o=null;switch(null==n?void 0:n.returnKeyType){case"keys":o=p.resolve(a.keys());break;case"primary_key":o=p.resolve(a.primaryKeys());break;default:o=i?p.resolve(a.until(i).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))):p.resolve(a.toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt)))}return o.catch((e=>{throw v(e,"between",this.table.name),e}))}forEachSortedBy(e,t){var r=this;return this.table.orderBy(e).each(function(){var e=(0,i.default)((function*(e){const n=yield r._decryptColumns(e);return t(n)}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEachSortedBy",this.table.name),e}))}forEach(e){var t=this;return this.table.each(function(){var r=(0,i.default)((function*(r){const n=yield t._decryptColumns(r);return e(n)}));return function(){return r.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEach",this.table.name),e}))}clear(){return p.resolve(this.table.clear()).catch((e=>{throw v(e,"clear",this.table.name),e}))}_primaryKey(){return this.table.schema.primKey.name}_hasEncryptedColumn(){return this.tableEncryptedColumns.size>0}}function g(e){if(e.length>1)return e.forEach((e=>{(0,l.default)(e.primaryKey&&e.primaryKey===u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`")})),`[${e.map((e=>e.name)).join("+")}]`;const t=e[0];return(0,l.default)(t.primaryKey&&t.primaryKey!==u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`"),t.primaryKey===u.PRIMARY_KEY_TYPE.AUTO_INCREMENT?`${t.name}++`:t.name}function m(e){switch(e.type){case u.INDEX_TYPE.SIMPLE:return e.column;case u.INDEX_TYPE.COMPOSITE:return`[${e.columns.join("+")}]`;case u.INDEX_TYPE.ARRAY:return`*${e.column}`;case u.INDEX_TYPE.UNIQUE:return`&${e.column}`}throw new Error(`Cannot format index of type "${e.type}"`)}function y(e){return 1===e.length?e[0]:`[${e.join("+")}]`}function E(e,t){let r=e;return(null==t?void 0:t.reverse)&&(r=r.reverse()),t&&null!=t.offset&&(r=r.offset(t.offset)),t&&null!=t.limit&&0!==t.limit&&(r=r.limit(t.limit)),r}function S(e){return p.resolve(e)}function v(e,t,r){__LOG__(3,!0)`idb faild to do Operation: ${t} on Table: ${r}. Failed with error ${e}`}function T(e,t){const r=Array.from(t.entries());e.forEach((()=>{r.forEach((t=>{let[r,n]=t;if(e[r]&&!(e[r]._keyId&&e[r]._data&&e[r].iv))throw new Error("[CRITICAL] Records contain unencrypted field")}))}))}t.default=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;this.tableNames=new Map,this.tableColumns=new Map,this.tableEncryptedColumns=new Map,this.errorHandlers=new Map,this.name=e,this.db=new s.default(this.name),this.transformSchema=t}initialize(e,t,r,n){return n&&(this.errorHandlers=n),function(e,t,r,n,i){return(0,o.promiseReduce)(e,((e,a)=>i((0,u.cloneSchema)(a)).then((i=>{if((0,l.default)(!(i.name in e),"Multiple tables resulted in the same transformed name"),i.deleted)return e[i.name]=null,e;t.set(a.name,i.name),r.set(a.name,i.columns.map((e=>e.name))),n.set(a.name,i.encryptedColumns||{});const o=i.columns.filter((e=>e.primaryKey));(0,l.default)(o.length>=1,`No primary key was defined for "${a.name}"`);const s=[g(o)].concat(i.indexes.map(m)).join(", ");return e[i.name]=s,e}))),{})}(t,this.tableNames,this.tableColumns,this.tableEncryptedColumns,this.transformSchema).then((t=>{this.db.version(e+1).stores(t).upgrade((e=>{var t;if(r)return null===(t=e[r.name])||void 0===t?void 0:t.toCollection().modify(r.callback)}))}))}open(){return p.resolve(this.db.open())}transact(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rw";return p.resolve(this.db.transaction(r,e,(()=>t()))).catch((e=>{const t=this.errorHandlers.get(e.name);if(!t)throw e;t(e)}))}close(){return this.db.close(),p.resolve()}view(e,t,r,n){(0,l.default)(this.tableNames.has(e),`Attemped to get view for uninitialized table "${e}"`),(0,l.default)(this.tableColumns.has(e),`Attemped to get columns for uninitialized table "${e}"`);const i=r?function(e){if(!e)return e=>e;return t=>{const r={};return e.forEach((e=>{t.hasOwnProperty(e)&&(r[e]=t[e])})),r}}(this.tableColumns.get(e)):e=>e;return new h(this.db.table(this.tableNames.get(e)),this.db,t,i,(0,a.default)(this.tableEncryptedColumns.get(e),"this.tableEncryptedColumns.get(table)"),n)}available(){return p.resolve(!0)}reset(){return this.tableNames=new Map,p.resolve(this.db.delete())}}},76140:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(64103),a=n(r(52991));t.default=class{constructor(e,t){this.errorHandlers=new Map,this._view=e,t&&(this.errorHandlers=t)}_maybeHandleError(e){const t=this.errorHandlers.get(e.name);t&&t(e)}_read(e){if(a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db read operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}_write(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db write operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}create(e){return this._write((t=>t.create(e)))}preflightEncryptSingleRecord(e){return this._write((t=>t.preflightEncryptSingleRecord(e)))}postflightDecryptSingleRecord(e){return this._write((t=>t.postflightDecryptSingleRecord(e)))}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}createOrReplace(e){return this._write((t=>t.createOrReplace(e)))}createOrMerge(e,t){return this._write((r=>r.createOrMerge(e,t)))}get(e){return this._read((t=>t.get(e)))}merge(e,t){return this._write((r=>r.merge(e,t)))}remove(e){return this._write((t=>t.remove(e)))}bulkCreate(e){return this._write((t=>t.bulkCreate(e)))}bulkCreateOrReplace(e){return this._write((t=>t.bulkCreateOrReplace(e)))}bulkCreateOrMerge(e){return this._write((t=>t.bulkCreateOrMerge(e)))}bulkGet(e,t){return this._read((r=>r.bulkGet(e,t)))}bulkRemoveByIndex(e,t){return this._write((r=>r.bulkRemoveByIndex(e,t)))}bulkRemove(e){return this._write((t=>t.bulkRemove(e)))}bulkDeleteRange(e,t,r){return this._write((n=>n.bulkDeleteRange(e,t,r)))}all(e,t){return this._read((r=>r.all(e,t)))}count(){return this._read((e=>e.count()))}equals(e,t,r){return this._read((n=>n.equals(e,t,r)))}anyOf(e,t,r){return this._read((n=>n.anyOf(e,t,r)))}startsWithAnyOf(e,t,r){return this._read((n=>n.startsWithAnyOf(e,t,r)))}greaterThan(e,t,r){return this._read((n=>n.greaterThan(e,t,r)))}lessThan(e,t,r){return this._read((n=>n.lessThan(e,t,r)))}between(e,t,r,n,i){return this._read((a=>a.between(e,t,r,n,i)))}forEachSortedBy(e,t){return this._read((r=>r.forEachSortedBy(e,t)))}forEach(e){return this._read((t=>t.forEach(e)))}clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._write((e=>e.clear()),e)}}},67204:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212));class o extends a.default{constructor(e){super(),(0,i.default)("AbstractPrimaryKey"!==this.constructor.name,"Cannot instantiate abstract class AbstractPrimaryKey"),Array.isArray(e)?this.columns=[...e]:this.columns=[e]}validate(e){(0,i.default)(0===e.columns.length,"Attempted to add primary key after other columns")}apply(){throw new Error("Subclass of `AbstractPrimaryKey` must implement `apply` method")}}t.default=o},92061:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},79051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.name=e}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t}}t.default=s},34654:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.columns=[...e]}validate(e){this.columns.forEach((t=>{(0,i.default)(e.columns.find((e=>e.name===t)),`Attempted to add index on non-existent column "${t}" in "${e.name}"`)})),(0,i.default)(this.columns.length>1,"Attempted to add composite index for only 1 column"),(0,i.default)(-1===(0,o.findIndex)(e,this._getIndex()),`Attempted to add index [${String(this.columns)}], which already exists in "${e.name}"`);const t=e.columns.filter((e=>e.primaryKey&&e.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE)).map((e=>e.name));(0,i.default)(t.length!==this.columns.length||t.some((e=>!this.columns.includes(e))),`Attempted to add index [${String(this.columns)}], which already is the primary key in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},86445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_VALUE_TYPE=t.AddEncryptedColumn=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);const s=Object.freeze({STRING:"String",ARRAY_BUFFER:"ArrayBuffer"});t.ENCRYPTED_VALUE_TYPE=s;class l extends a.default{constructor(e,t){super(),this.name=e,this.dataType=t}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add encrypted column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t.encryptedColumns[this.name]=this.dataType,t}}t.AddEncryptedColumn=l},19570:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.keyPath=e,this.column=e.split(".")[0]}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.keyPath}}}t.default=s},39043:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.UNIQUE,column:this.column}}}t.default=s},81674:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),o=r(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.AUTO_INCREMENT}),t}}t.default=s},54180:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),o=r(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&this.columns.length>1,"Attempted to add composite primary key for only 1 column")}apply(e){const t=(0,o.cloneSchema)(e);return this.columns.forEach((e=>{t.columns.push({name:e,primaryKey:o.PRIMARY_KEY_TYPE.COMPOSITE})})),t}}t.default=s},73212:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143));t.default=class{constructor(){(0,i.default)("Mutation"!==this.constructor.name,"Cannot instantiate abstract class Mutation")}validate(){throw new Error("Subclasses of Mutaton must implement `validate`")}apply(){throw new Error("Subclasses of Mutaton must implement `apply`")}}},45441:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),r=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},23263:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.name=e}validate(e){const t=e.columns.find((e=>e.name===this.name));(0,i.default)(t,`Attempted to remove column "${this.name}" from "${e.name}" but it doesn't exist`),(0,i.default)(!t.primaryKey,`Attempted to remove primary key column "${this.name}". Removing primary keys is not supported.`),(0,i.default)(!e.indexes.some((e=>(0,o.indexContainsColumn)(e,this.name))),`Attempted to remove column "${this.name}" from "${e.name}" but an index exists with the column`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.splice(t.columns.findIndex((e=>e.name===this.name)),1),t}}t.default=s},79913:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.columns=[...e].sort()}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index [${String(this.columns)}] on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),r=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},42062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),o=r(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),r=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.column}}}t.default=s},89362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),o=r(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.USER_DEFINED}),t}}t.default=s},5183:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sortMutations=function(e){return[...e].sort(E)};var i=n(r(41143)),a=n(r(92061)),o=n(r(79051)),s=n(r(34654)),l=r(86445),c=n(r(19570)),d=n(r(39043)),u=n(r(81674)),p=n(r(54180)),f=n(r(45441)),_=n(r(23263)),h=n(r(79913)),g=n(r(42062)),m=n(r(89362));const y=[h.default,f.default,g.default,_.default,u.default,m.default,p.default,o.default,c.default,a.default,s.default,d.default,l.AddEncryptedColumn];function E(e,t){const r=y.indexOf(e.constructor),n=y.indexOf(t.constructor);return(0,i.default)(-1!==r,`Mutation ${e.constructor.name} is not a known mutation type`),(0,i.default)(-1!==n,`Mutation ${e.constructor.name} is not a known mutation type`),r-n}},78585:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PRIMARY_KEY_TYPE=t.INDEX_TYPE=void 0,t.cloneSchema=function(e){return{name:e.name,columns:e.columns.map((e=>(0,i.default)({},e))),indexes:e.indexes.map(c),encryptedColumns:(0,i.default)({},e.encryptedColumns||{}),deleted:e.deleted}},t.emptySchema=function(e){return{name:e,columns:[],indexes:[],encryptedColumns:{}}},t.findIndex=function(e,t){return e.indexes.findIndex((e=>function(e,t){if(e.type!==t.type)return!1;switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.column===t.column;case s.COMPOSITE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.columns.length===t.columns.length&&!e.columns.some((e=>!t.columns.includes(e)))}throw new Error(`cannot compare unknown indexes of types: ${e.type}, ${t.type}`)}(t,e)))},t.freezeSchema=function(e){return Object.freeze({name:e.name,columns:Object.freeze(e.columns.map(Object.freeze)),indexes:Object.freeze(e.indexes.map(l)),encryptedColumns:Object.freeze((0,i.default)({},e.encryptedColumns||{})),deleted:e.deleted})},t.indexContainsColumn=function(e,t){switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return e.column===t;case s.COMPOSITE:return!!e.columns.find((e=>e===t))}throw new Error(`cannot check indexes of unknown index type: ${e.type}`)};var i=n(r(81109)),a=n(r(41143));const o=Object.freeze({AUTO_INCREMENT:"auto-increment",USER_DEFINED:"user-defined",COMPOSITE:"composite"});t.PRIMARY_KEY_TYPE=o;const s=Object.freeze({SIMPLE:"simple",COMPOSITE:"composite",ARRAY:"array",UNIQUE:"unique"});function l(e){switch(e.type){case s.SIMPLE:return Object.freeze({type:s.SIMPLE,column:e.column});case s.ARRAY:return Object.freeze({type:s.ARRAY,column:e.column});case s.COMPOSITE:return Object.freeze({type:s.COMPOSITE,columns:Object.freeze(e.columns.map(Object.freeze))});case s.UNIQUE:return Object.freeze({type:s.UNIQUE,column:e.column})}throw new Error(`cannot freeze index of unknown type: ${e.type}`)}function c(e){switch(e.type){case s.SIMPLE:return{type:s.SIMPLE,column:e.column};case s.UNIQUE:return{type:s.UNIQUE,column:e.column};case s.COMPOSITE:return{type:s.COMPOSITE,columns:e.columns.map((e=>e))};case s.ARRAY:return{type:s.ARRAY,column:e.column}}throw new Error(`cannot clone unknown index type: ${e.type}`)}t.INDEX_TYPE=s},90288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageVersionManager=t.MissingVersionError=t.InvalidVersionError=t.DuplicateVersionError=void 0;class r extends Error{constructor(){super(...arguments),this.name="DuplicateVersionError"}}t.DuplicateVersionError=r;class n extends Error{constructor(){super(...arguments),this.name="InvalidVersionError"}}t.InvalidVersionError=n;class i extends Error{constructor(){super(...arguments),this.name="MissingVersionError"}}t.MissingVersionError=i;t.StorageVersionManager=class{constructor(){this.versions=new Set,this._max=-1}claim(e){if(e<0)throw new n("Versions must by greater than or equal to zero!");if(this.versions.has(e))throw new r(`Version #${e} has already been claimed!`);this.versions.add(e),this._max=Math.max(this.getMax(),e)}version(e){if(e<0)throw new n("Versions must by greater than or equal to zero!");return e}validate(){for(let e=0;e<=this.getMax();++e)if(!this.versions.has(e))throw new i(`Schema version #${e} is missing!`)}getMax(){return this._max}}},37521:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.NotInitializedError=t.NoSuchTableError=t.NoSuchDatabaseError=t.NoFallbackError=t.DuplicateTableError=t.DuplicateDatabaseError=t.AlreadyInitializedError=void 0;var i=n(r(48926)),a=n(r(76140)),o=r(90288),s=n(r(26196));class l extends Error{constructor(){super(...arguments),this.name="AlreadyInitializedError"}}t.AlreadyInitializedError=l;class c extends Error{constructor(){super(...arguments),this.name="DuplicateDatabaseError"}}t.DuplicateDatabaseError=c;class d extends Error{constructor(){super(...arguments),this.name="DuplicateTableError"}}t.DuplicateTableError=d;class u extends Error{constructor(){super(...arguments),this.name="NoFallbackError"}}t.NoFallbackError=u;class p extends Error{constructor(){super(...arguments),this.name="NoSuchDatabaseError"}}t.NoSuchDatabaseError=p;class f extends Error{constructor(){super(...arguments),this.name="NoSuchTableError"}}t.NoSuchTableError=f;class _ extends Error{constructor(){super(...arguments),this.name="NotInitializedError"}}t.NotInitializedError=_;t.Storage=class{constructor(e){this.tables=new Map,this.views=new Map,this.state=1,this.versions=new o.StorageVersionManager,this.errorHandlers=new Map,this._database=e}addErrorHandler(e,t){const r=(new e).name;this.errorHandlers.set(r,t)}add(e){if(this.tables.has(e))throw new d(`Table "${e}" already added. Reuse the definition.`);const t=new s.default(e,this.versions);return this.tables.set(e,t),t}_getBackingDB(){return this._database}_unsafeGetOrCreateView(e){if(this.views.has(e))return this.views.get(e);const t=this._database.view(e.name,e.rowview,e.shouldEnablePropFilter,e.shouldUseDbMsgEncKeyForEncryptedCol);return this.views.set(e,t),t}_guardInitializedThunk(e){return()=>{if(3&this.state)throw new _("Storage must be initialized before accessing a table!");return e()}}table(e){const t=this.tables.get(e);if(!t)throw new f(`Unknown table ${e} requested, ensure table is defined!`);if(!this._getBackingDB())throw new p(`Unable to find associated database with table "${e}"`);return new a.default(this._guardInitializedThunk((()=>this._unsafeGetOrCreateView(t))),this.errorHandlers)}lock(e,t){if(3&this.state)return Promise.reject(new _("Initialize storage before attempting to lock tables!"));for(let t=0;t<e.length;++t)if(!this.tables.has(e[t]))return Promise.reject(new f(`Requested lock of unknown table "${e[t]}"`));const r=e.map((e=>{const t=this.tables.get(e);if(t)return t;throw new f(`Requested lock of unknown table "${e}"`)})).map((e=>this._unsafeGetOrCreateView(e)));return this._getBackingDB().transact(e,(0,i.default)((function*(){return t(r)}))).finally((()=>{}))}_getUpgraderForCurrentVersion(e,t){for(let r=0;r<e.length;r++)if(e[r].maxVersion===t){const n=e[r].upgraders.get(t);if(n)return{name:e[r].name,callback:n}}}_applyDatabaseVersion(e,t,r){const n=t,i=r.map((e=>e.schema(n))).filter(Boolean);return e.initialize(t,i,this._getUpgraderForCurrentVersion(r,n),this.errorHandlers)}initialize(){var e=this;return(0,i.default)((function*(){if(4&e.state)throw new l("Storage instance has already been initialized");if(e.versions.validate(),!e._database)throw new p(`"${e._database.constructor.name}" failed availability check!`);yield e._database.available();const t=Array.from(e.tables.values()),r=e._getBackingDB();if(t&&r){for(let n=0;n<=e.versions.getMax();n++)yield e._applyDatabaseVersion(r,n,t);yield r.open(),e.state=4}}))()}purge(){return this.state=2,this.views=new Map,this._getBackingDB().reset().then((()=>{}))}}},26196:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(41143)),o=r(78585),s=r(5183);function l(e){return e}t.default=class{constructor(e,t){this.maxVersion=-1,this.versions=new Map,this.upgraders=new Map,this.shouldEnablePropFilter=!0,this.shouldUseDbMsgEncKeyForEncryptedCol=!1,this.name=e,this.versionManager=t}version(e,t,r){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const n=this.schema(e)||(0,o.emptySchema)(this.name),i=(0,s.sortMutations)(t).reduce(((e,t)=>(t.validate(e),t.apply(e))),(0,o.cloneSchema)(n));return this.versions.set(e,(0,o.freezeSchema)(i)),this.upgraders.set(e,r),this}delete(e){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const t=this.schema(e)||(0,o.emptySchema)(this.name),r=(0,i.default)((0,i.default)({},t),{},{deleted:!0});return this.versions.set(e,(0,o.freezeSchema)(r)),this}view(e){return this.rowview=e,this}enablePropFilter(e){return this.shouldEnablePropFilter=e,this}useDbMsgEncKeyForEncryptedCol(e){return this.shouldUseDbMsgEncKeyForEncryptedCol=e,this}schema(e){const t=this.versions.get(e);if(t)return t;const r=Array.from(this.versions.keys()).map(l).sort(((e,t)=>e-t)).filter((t=>t<e)).pop();return r||0===r?this.versions.get(r)||(0,o.emptySchema)(this.name):null}}},29830:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"IdbArrayBufferTable",{enumerable:!0,get:function(){return s.IdbArrayBufferTable}}),Object.defineProperty(t,"IdbMetaInfoTable",{enumerable:!0,get:function(){return o.IdbMetaInfoTable}}),t.initialize=void 0,Object.defineProperty(t,"metaInfoDateIndex",{enumerable:!0,get:function(){return o.metaInfoDateIndex}}),Object.defineProperty(t,"metaInfoPrimaryIndex",{enumerable:!0,get:function(){return o.metaInfoPrimaryIndex}}),Object.defineProperty(t,"metaInfoSizeIndex",{enumerable:!0,get:function(){return o.metaInfoSizeIndex}}),Object.defineProperty(t,"storeDataIndex",{enumerable:!0,get:function(){return s.storeDataIndex}}),Object.defineProperty(t,"storePrimaryIndex",{enumerable:!0,get:function(){return s.storePrimaryIndex}});var i=n(r(51463)),a=r(24439),o=r(9362),s=r(3971);const l=(0,i.default)((()=>(0,a.getStorage)().initialize()));t.initialize=l},3971:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePrimaryIndex=t.storeDataIndex=t.IdbArrayBufferTable=void 0;var i=n(r(79051)),a=r(24439),o=n(r(89362));const s="id";t.storePrimaryIndex=s;const l="data";t.storeDataIndex=l;const c="lru-media-array-buffer";(0,a.getStorage)().add(c).version((0,a.getStorage)().versions.version(0),[new o.default(s),new i.default(l)]).view((e=>({id:e.id,data:e.data})));const d=(0,a.getStorage)().table(c);t.IdbArrayBufferTable=d},9362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.metaInfoSizeIndex=t.metaInfoPrimaryIndex=t.metaInfoDateIndex=t.IdbMetaInfoTable=void 0;var i=n(r(79051)),a=n(r(19570)),o=r(24439),s=n(r(89362));t.metaInfoPrimaryIndex="id";const l="timestamp";t.metaInfoDateIndex=l;const c="size";t.metaInfoSizeIndex=c;const d="lru-media-meta-info";(0,o.getStorage)().add(d).version((0,o.getStorage)().versions.version(1),[new s.default("id"),new i.default(l),new a.default(l)]).version((0,o.getStorage)().versions.version(2),[new i.default(c)]).view((e=>({id:e.id,timestamp:e.timestamp,size:e.size||0})));const u=(0,o.getStorage)().table(d);t.IdbMetaInfoTable=u},24439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=p,t.destroyStorage=function(){return f.apply(this,arguments)},t.getStorage=function(){return(0,o.default)(null!=u,"[lru-media-storage-idb] Storage should be created first before being accessed"),u};var i=n(r(48926)),a=n(r(86128)),o=n(r(41143)),s=n(r(98883)),l=r(37521),c=r(23283);const d="lru-media-storage-idb";t.DATABASE_NAME=d;let u=null;function p(){const e=new s.default(d);u=new l.Storage(e),u.addErrorHandler(a.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&c.StorageCmd.trigger("storage_not_enough_space")}))}function f(){return(f=(0,i.default)((function*(){if(null==u)throw new Error("[lru-media-storage-idb] Storage should be created first before being destroyed");try{yield u.purge()}finally{u=null}}))).apply(this,arguments)}p()},34541:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABPropConfigs=function(){return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().all().then((e=>e))))},t.getConfigValue=function(e){const t=o.ABPropConfigs[e];if(null==t)return __LOG__(4,!0,new Error,!0)`invalid ABProps config name`,SEND_LOGS("invalid ABProps config name: "+e),Promise.reject(new Error("invalid ABProps config name"));const[r,n,i]=t;return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().get(String(r)).then((e=>e?d(e.configValue,n,i):i))))},t.parseConfigValue=d,t.setConfigAccessed=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.get(String(e));null!=n&&!0!==(null==n?void 0:n.hasAccessed)&&(yield r.merge(String(e),{hasAccessed:!0}))}));return function(){return t.apply(this,arguments)}}())},t.updateABPropConfigs=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.all(),i=new Map;n.forEach((e=>{null!=e.configExpoKey&&i.set(e.configCode,{configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})}));let a=!1;const o=[];e.forEach(((e,t)=>{let r=!1;const n=i.get(String(t));if(n){const i=n.configExpoKey;null!=i&&e.configExpoKey!==i?(s.exposureKeys.delete(i),a=!0,s.accessedConfigs.delete(t)):null!=i&&(r=n.hasAccessed)}o.push({configCode:String(t),configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:r})})),a&&(0,s.updateGlobalExpoKey)(),yield r.clear(),yield r.bulkCreate(o)}));return function(){return t.apply(this,arguments)}}())};var i=n(r(48926)),a=r(32446),o=r(56042),s=r(80024),l=r(23356),c=r(99069);function d(e,t,r){return null==e||null==t?r:"bool"===t?"1"===e||"True"===e||"true"===e:"int"===t?parseInt(e,10):"float"===t?parseFloat(e):e}},38342:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._cache=void 0,t.addActiveMessageRange=function(){return h.apply(this,arguments)},t.bulkUpdateActiveMessageRanges=function(e){return f.bulkCreateOrReplaceRanges(e)},t.getActiveMessageRanges=function(e){return f.getRangesForChat(e)},t.getActiveRangeAction=function(e,t){switch(e){case"archive":return c.ActiveRangeAction.Archive;case"markChatAsRead":return c.ActiveRangeAction.MarkChatAsRead;case"clearChat":return(null==t?void 0:t.deleteStarred)&&t.deleteMedia?c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:(null==t?void 0:t.deleteStarred)&&!t.deleteMedia?c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:(null==t?void 0:t.deleteMedia)&&!t.deleteStarred?c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:c.ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return(null==t?void 0:t.deleteMedia)?c.ActiveRangeAction.DeleteChatDeleteMedia:c.ActiveRangeAction.DeleteChatKeepMedia;default:throw new Error("unsupported active message range action")}},t.removeActiveMessageRange=function(e,t){return f.removeRange(e,t)},t.updateActiveMessageRange=function(e){return f.createOrReplaceRange(e)};var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(381),l=r(84902),c=r(69702),d=r(23356),u=r(30986);let p=new Map;const f={reset:()=>{p=new Map},removeRange(e,t){var r;return null===(r=p.get(e))||void 0===r||r.delete(t),(0,d.getActiveMessageRangesTable)().remove([e,t])},createOrReplaceRange(e){let t=p.get(e.chatId);return null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e),(0,d.getActiveMessageRangesTable)().createOrReplace(e)},bulkCreateOrReplaceRanges:e=>(e.forEach((e=>{let t=p.get(e.chatId);null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e)})),(0,d.getActiveMessageRangesTable)().bulkCreateOrReplace(e)),getRangesForChat:e=>(0,a.default)((function*(){let t=p.get(e);if(null==t){const r=yield(0,d.getActiveMessageRangesTable)().anyOf(["chatId"],[e]);t=new Map(r.map((e=>[e.action,e]))),p.set(e,t)}return Array.from(t.values())}))()};function _(e,t){switch(e){case c.ActiveRangeAction.Archive:return{action:c.ActiveRangeAction.Archive,actionValue:(0,o.default)(t.archiveChatAction,"syncActionValue.archiveChatAction")};case c.ActiveRangeAction.MarkChatAsRead:return{action:c.ActiveRangeAction.MarkChatAsRead,actionValue:(0,o.default)(t.markChatAsReadAction,"syncActionValue.markChatAsReadAction")};case c.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return{action:c.ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:return{action:c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return{action:c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:return{action:c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.DeleteChatDeleteMedia:return{action:c.ActiveRangeAction.DeleteChatDeleteMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};case c.ActiveRangeAction.DeleteChatKeepMedia:return{action:c.ActiveRangeAction.DeleteChatKeepMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};default:throw new Error(`unsupported action for message ranges: ${String(e)}`)}}function h(){return(h=(0,a.default)((function*(e,t,r){var n;const a=(0,l.decodeProtobuf)(s.SyncActionValueSpec,r),{actionValue:o}=_(t,a),c=(null===(n=o.messageRange)||void 0===n?void 0:n.messages)||[],d=yield(0,u.filterReceivedMessagesInRange)(e,c),p=Math.max(0,c.length-d.length);return f.createOrReplaceRange((0,i.default)((0,i.default)({chatId:e},_(t,a)),{},{remainingMessages:p}))}))).apply(this,arguments)}t._cache=f},73382:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return Promise.resolve([]);return(0,i.getTable)().all().then((e=>e.map((e=>(0,n.createUserWid)(e.id)))))},t.updateBlocklist=function(e){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND)||!e)return Promise.resolve(!1);const t=e.map((e=>({id:e.toString()})));return(0,o.getStorage)().lock(["blocklist"],(e=>{let[r]=e;return r.clear().then((()=>r.bulkCreate(t).then((()=>!0))))}))};var n=r(45454),i=r(89426),a=r(7293),o=r(99069)},60112:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateChatEvents=function(e){return d.enqueue((0,i.default)((function*(){const t=(yield(0,l.getTable)().bulkGet(e.map((e=>{let{chatId:t,startTs:r}=e;return[t,r]})))).map(((t,r)=>{const n=e[r],i=function(e,t,r){if(null==r)return(0,a.default)({chatId:e,startTs:t},c);return Object.keys(c).reduce(((e,t)=>(null==e[t]&&(e[t]=c[t]),e)),r)}(n.chatId,n.startTs,t);return s.COUNT_FIELD_NAMES.forEach((e=>{i[e]+=n[e]})),i.msgsSent+=n.addMsgsSent,i.msgsReceived+=n.addMsgsReceived,i.viewOnceMsgsSent+=n.addViewOnceMsgsSent,i.viewOnceMsgsReceived+=n.addViewOnceMsgsReceived,i.viewOnceMessagesOpened+=n.addViewOnceMsgsOpened,i.callOffersSent+=n.addCallOffersSent,i.callOffersReceived+=n.addCallOffersReceived,i.totalCallDuration+=n.addTotalCallDuration,i}));return(0,l.getTable)().bulkCreateOrReplace(t)})))},t.deleteBeforeInclusive=function(){return u.apply(this,arguments)},t.getBeforeInclusive=function(e){return(0,l.getTable)().lessThan(["startTs"],e,{inclusive:!0})},t.getChatEvent=function(e,t){return(0,l.getTable)().get([e,t])};var i=n(r(48926)),a=n(r(81109)),o=r(27870),s=r(61840),l=r(91314);const c=Object.freeze((0,a.default)({msgsSent:0,msgsReceived:0,viewOnceMsgsSent:0,viewOnceMsgsReceived:0,viewOnceMessagesOpened:0,callOffersSent:0,callOffersReceived:0,totalCallDuration:0},s.COUNT_FIELDS)),d=new o.PromiseQueue;function u(){return(u=(0,i.default)((function*(e){return yield(0,l.getTable)().bulkDeleteRange(["startTs"],0,e+1)}))).apply(this,arguments)}},48285:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnreadMentionChat=function(e,t){return(0,h.getStorage)().lock(["chat"],function(){var r=(0,i.default)((function*(r){let[n]=r;const i=Array.from(e.keys());if(0===i.length)return;const a=yield(0,c.getTable)().bulkGet(i);if(!a||0===a.length)return void __LOG__(4,void 0,new Error)`addUnreadMentionChat: could not find chats`;const o=[];return a.forEach((r=>{if(r){var n;const a=r.id.toString();let s=null!==(n=r.unreadMentionsOfMe)&&void 0!==n?n:[];const l=e.get(a);l&&(s=s.concat(l));let c={id:a,unreadMentionsOfMe:s};if(t){var i;c={id:a,unreadMentionsOfMe:s,unreadMentionCount:null!==(i=t.get(a))&&void 0!==i?i:0}}o.push(c)}})),(0,c.getTable)().bulkCreateOrMerge(o)}));return function(){return r.apply(this,arguments)}}())},t.createChat=function(e,t){return(0,c.getTable)().create((0,a.default)({id:e.toString()},t)).catch((e=>{if(e instanceof d.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when create local"),new Error("update chat table failed")}))},t.getChatMeta=function(){return g.apply(this,arguments)},t.markMessageAndChatAsRead=function(e,t,r){return(0,h.getStorage)().lock(["message","chat"],function(){var n=(0,i.default)((function*(n){let[i,a]=n;const s=yield(0,f.getTable)().equals(["from","pendingReadReceipt"],[t,1],{shouldDecrypt:!1}),l=[];let c=0;const d=[];s.forEach((t=>{if(null==e||null!=t.rowId&&t.rowId>e){if(c++,(0,p.isGroupCatchUpEnabled)()&&(0,_.isImportantMessage)(t)){const e={id:t.id,timestamp:t.t};d.push(e)}}else l.push({id:t.id,ack:Math.max(t.ack,o.ACK.READ),pendingReadReceipt:null})}));const u=0===c&&r?-1:c,h=[a.createOrMerge(t,{id:t,unreadCount:u,unreadMentionsOfMe:d,unreadMentionCount:0})];l.length>0&&h.push((0,f.getTable)().bulkCreateOrMerge(l)),yield Promise.all(h)}));return function(){return n.apply(this,arguments)}}())},t.pruneExpiredTcTokens=function(){return m.apply(this,arguments)},t.reduceChatUnreadCount=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,h.getStorage)().lock(["chat"],function(){var r=(0,i.default)((function*(r){let[n]=r;const i=yield n.get(e);if(null==i)return void __LOG__(4,void 0,new Error)`reduceChatUnreadCount: could not find chat with id ${e}`;const a=Math.max(i.unreadCount-t,0);return n.merge(e,{unreadCount:a})}));return function(){return r.apply(this,arguments)}}())},t.removeUnreadMentionChat=function(e){return(0,h.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=Array.from(e.keys());if(0===n.length)return;const i=yield(0,c.getTable)().bulkGet(n);if(!i||0===i.length)return void __LOG__(4,void 0,new Error)`removeUnreadMentionChat: could not find chats`;const a=[];return i.forEach((t=>{if(t){var r;let n=null!==(r=t.unreadMentionsOfMe)&&void 0!==r?r:[];const i=e.get(t.id.toString());i&&(n=n.filter((e=>!i.includes(e.id)))),a.push({id:t.id.toString(),unreadMentionsOfMe:n})}})),(0,c.getTable)().bulkCreateOrMerge(a)}));return function(){return t.apply(this,arguments)}}())},t.updateChatArchiveDrawer=function(e){return(0,h.getStorage)().lock(["chat"],(t=>{let[r]=t;const n=Array.from(e.keys());if(0===n.length)return Promise.resolve();const i=n.map((t=>{var r;return{id:t,archiveAtMentionViewedInDrawer:null!==(r=e.get(t))&&void 0!==r&&r}}));return r.bulkCreateOrMerge(i)}))},t.updateChatForMarkAsReadSync=function(e){return(0,h.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.get(e);if(null!=n)return-1===n.unreadCount?r.createOrMerge(e,{id:e,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0}):void 0;__LOG__(4,void 0,new Error)`updateMarkChatAsReadSync: could not find chat with id ${e}`}));return function(){return t.apply(this,arguments)}}())};var i=n(r(48926)),a=n(r(81109)),o=r(35470),s=r(64603),l=r(86945),c=r(68638),d=r(64103),u=r(7293),p=r(10435),f=r(90981),_=r(54676),h=r(99069);function g(){return(g=(0,i.default)((function*(e){const t=yield(0,c.getTable)().get(e.toString());return t?{unreadCount:t.unreadCount,timestamp:t.t}:Promise.reject(new Error("Failed to find row in chat table with id:"+e.toString()))}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND)||!(0,l.getABPropConfigValue)("trusted_contacts"))return;const e=(0,s.tokenExpirationCutoff)(s.TcTokenMode.Receiver),t=yield(0,c.getTable)().lessThan(["tcTokenTimestamp"],e);if(!t||0===t.length)return;const r=t.map((e=>({id:e.id,tcToken:null,tcTokenTimestamp:null})));yield(0,c.getTable)().bulkCreateOrMerge(r)}))).apply(this,arguments)}},35673:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isAddressBookContact=function(){return l.apply(this,arguments)},t.setNotAddressBookContacts=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,s.getStorage)().lock(["contact"],(()=>{const t=e.map((e=>({id:e,isAddressBookContact:0,name:void 0})));return(0,o.getContactTable)().bulkCreateOrMerge(t)}));return Promise.resolve()};var i=n(r(48926)),a=r(7293),o=r(76214),s=r(99069);function l(){return(l=(0,i.default)((function*(e){const t=yield(0,o.getContactTable)().get(e);return null!=t&&0!==t.isAddressBookContact}))).apply(this,arguments)}},9108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkCreateOrReplaceDeviceRecord=function(){return E.apply(this,arguments)},t.bulkGetDeviceRecord=g,t.createOrReplaceDeviceRecord=function(){return y.apply(this,arguments)},t.doesDeviceHashMatch=function(){return A.apply(this,arguments)},t.getAllDeviceLists=function(){return(0,c.getTable)().all()},t.getDeviceIds=S,t.getDeviceInfoForSync=function(){return C.apply(this,arguments)},t.getDeviceRecord=_,t.getMyDeviceList=function(){return b.apply(this,arguments)},t.hasDevice=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(94654)),o=r(52230),s=r(42430),l=r(45454),c=r(60996),d=r(99234),u=r(7293),p=r(53686);const f=new s.LruCache({sizeLimit:2e3,getSize:()=>1});function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){if(!f.has(e)){const t=yield(0,c.getTable)().get(e);f.put(e,t)}return f.get(e)}return Promise.reject(new Error("getDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const t=[];e.forEach((e=>{f.has(e)||t.push(e)}));return(yield(0,c.getTable)().bulkGet(t)).forEach(((e,r)=>{f.put(t[r],e)})),e.map((e=>f.get(e)))}return Promise.reject(new Error("bulkGetDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){return u.GK.supportsFeature(u.GK.F.MD_BACKEND)?(yield(0,c.getTable)().createOrReplace(e),void f.put(e.id,e)):Promise.reject(new Error("createOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){return u.GK.supportsFeature(u.GK.F.MD_BACKEND)?(yield(0,c.getTable)().bulkCreateOrReplace(e),void e.forEach((e=>{f.put(e.id,e)}))):Promise.reject(new Error("bulkCreateOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){return(yield g(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND))return!1;if(t===o.DEFAULT_DEVICE_ID)return!0;const[r]=yield S([e.user]);return!!r&&!!r.devices.includes(t)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){return(yield g(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t,timestamp:e.timestamp,expectedTs:e.expectedTs}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){if(null==t)return!0;const r=(yield S([e.user])).map((e=>e?e.devices.map((t=>(0,l.createDeviceWidFromUserAndDevice)(e.id,t))):[])),n=(0,a.default)(r,(e=>e));return(yield(0,p.phashV2)(n))!==t}return!1}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(){const e=(0,d.assertGetMe)(),t=yield _(e.user);if(!t||t.deleted)throw new Error("syncd: cannot find my device list");return t}))).apply(this,arguments)}},36993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateDirectConnectionKeys=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getTable)().createOrMerge(e.id,e);return Promise.resolve()},t.fetchDirectConnectionKeys=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getTable)().get(e);return Promise.resolve()};var n=r(68259),i=r(7293)},62415:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistGroupInviteV4Msg=function(e,t){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,d.getTable)().createOrMerge(e,t);return Promise.resolve()},t.revokeGroupInvites=function(){return u.apply(this,arguments)},t.updatePendingParticipants=function(){return p.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(45454),s=r(22683),l=r(99234),c=r(7293),d=r(35884);function u(){return(u=(0,a.default)((function*(e,t,r,n){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const a=yield(0,d.getTable)().equals(["from","to","groupId"],[e,t,r]).then((e=>e.filter((e=>!e.expired&&e.expiration<=n))));return(0,d.getTable)().bulkCreateOrReplace(a.map((e=>(0,i.default)((0,i.default)({},e),{},{expired:!0})))),a}return Promise.resolve(null)}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){var t;const n=null===(t=(0,l.getMaybeMeUser)())||void 0===t?void 0:t.toString(),i=r(63928).default.gadd(e);yield(0,d.getTable)().equals(["from","groupId"],[n,e.toString()]).then((e=>e.filter((e=>!e.expired&&s.Clock.globalUnixTime()<=e.expiration)))).then((e=>{e.forEach((e=>{i.pendingParticipants.add({id:(0,o.createUserWid)(e.to)})}))}))}return Promise.resolve()}))).apply(this,arguments)}},90101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetadataFromStorage=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,c.getStorage)().lock(["group-metadata","participant"],function(){var t=(0,i.default)((function*(t){let[r,n]=t;const i=yield r.get(e.toString());if(i){const t=yield n.get(e.toString());if(null==t?void 0:t.deviceSyncComplete){var a;__LOG__(2,void 0,void 0,void 0,["groups"])`found groupMetadata in storage for group id ${e.toString()}`;const r=new Set(t.admins);return{id:e,owner:i.owner&&(0,o.createWid)(i.owner),creation:i.creation,desc:i.desc,descId:i.descId,descOwner:i.descOwner&&(0,o.createWid)(i.descOwner),descTime:i.descTime,restrict:i.restrict||!1,announce:i.announce||!1,noFrequentlyForwarded:i.noFrequentlyForwarded||!1,ephemeralDuration:i.ephemeralDuration||0,participants:null===(a=t.participants)||void 0===a?void 0:a.map((e=>({id:(0,o.createWid)(e),isAdmin:r.has(e),isSuperAdmin:!1}))),subject:i.subject,support:!0===i.support,notAddedByContact:i.notAddedByContact||!1,addedBy:i.addedBy&&(0,o.createWid)(i.addedBy)}}}return __LOG__(2,void 0,void 0,void 0,["groups"])`did not find groupMetadata in storage for group id ${e.toString()}`,null}));return function(){return t.apply(this,arguments)}}());return Promise.resolve(null)},t.persistGroupMetadata=function(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,l.getTable)().createOrMerge(e.toString(),(0,a.default)({id:e.toString()},t));return Promise.resolve()};var i=n(r(48926)),a=n(r(81109)),o=r(45454),s=r(7293),l=r(64632),c=r(99069)},41037:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addNotification=f,t.enqueueNotification=function(){return _.apply(this,arguments)},t.fetchNextHitorySyncChunkForProcessing=function(){return h.apply(this,arguments)},t.getByChunkOrderNumber=function(e,t){let r;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(r=(0,s.getTable)().equals(["chunkOrder","syncType"],[e,t]),!r)return Promise.reject(new Error("getNotificationForChunk history sync notification: not supported for non MD"))}else r=Promise.reject(new Error("getNotificationForChunk for history sync notification: not supported without md backend"));return r},t.getNextUnProcessedNotification=u,t.markChunkForReuploadPending=function(e){return c.delete(e),(0,s.getTable)().merge(e,{reuploadPending:!0})},t.removeLocalFailureFromInFlightChunk=function(e){c.delete(e)},t.updateCurrentlyProcessed=p;var i=n(r(81109)),a=n(r(48926)),o=r(7293),s=r(15118),l=r(58052);const c=new Set;function d(){return(d=(0,a.default)((function*(e,t,r){const n=(0,l.getLastHistorySycnedChunk)();if(4===e)return!0;if([2,3].includes(e)&&1===t){if(3===e){return!!(0,l.getInitialHistorySyncComplete)()}const t=(0,l.getHistorySyncStatus)();return!!(null==t?void 0:t.recentCompleted)}if(null==n)return!1;const[i,a]=n.split("_");return i===`${e}`&&a===""+(t-1)||(i===`${e}`&&a===`${t}`?(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed: next chunk already processed ${e}_${t}, last processed: ${n} `,yield p(r),!1):(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed returned false for ${e}_${t}, last processed: ${n} `,!1))}))).apply(this,arguments)}function u(){let e;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(e=(0,s.getTable)().equals(["processed"],0,{shouldDecrypt:!1}).then(function(){var e=(0,a.default)((function*(e){var t;const r=e.filter((e=>!c.has(e.msgKey)&&!e.reuploadPending)).sort(((e,t)=>e.syncType<t.syncType?1:e.syncType>t.syncType?-1:e.syncType===t.syncType&&null!=e.chunkOrder&&null!=t.chunkOrder?e.chunkOrder-t.chunkOrder:0));let n=r.length>0?r[0]:void 0;if(null!=(null===(t=n)||void 0===t?void 0:t.chunkOrder)){if(n){if(!(yield function(){return d.apply(this,arguments)}(n.syncType,n.chunkOrder,n.msgKey)))return;n=yield(0,s.getTable)().postflightDecryptSingleRecord(n)}return n}var i;__LOG__(2,void 0,void 0,void 0,["History sync"])`getNextUnProcessedNotification chunkOrder is null, ${null===(i=n)||void 0===i?void 0:i.msgKey}`}));return function(){return e.apply(this,arguments)}}()),!e)return Promise.reject(new Error("getNextUnProcessed history sync notification: not supported for non MD"))}else e=Promise.reject(new Error("getNextUnProcessed for history sync notification: not supported without md backend"));return e}function p(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(c.delete(e),t=(0,s.getTable)().remove(e),!t)return Promise.reject(new Error("updateCurrentProcessed history sync notification: not supported for non MD"))}else t=Promise.reject(new Error("updateCurrentProcessed for history sync notification: not supported without md backend"));return t.catch((e=>{__LOG__(2,void 0,void 0,void 0,["History sync"])`updateCurrentlyProcessed failed with error ${e}`}))}function f(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const r=e.downloadOptions.mediaKey,n=e.downloadOptions.directPath,a=e.downloadOptions.filehash,o=e.downloadOptions.encFilehash;e.downloadOptions.mediaKey="",e.downloadOptions.directPath="",e.downloadOptions.filehash="",e.downloadOptions.encFilehash="";const l=(0,i.default)((0,i.default)({},e),{},{chunkEncryptionKey:r,directPath:n,filehash:a,encFilehash:o});if(e.processed=0,t=(0,s.getTable)().createOrMerge(e.msgKey,l),!t)return Promise.reject(new Error("add history sync notification: not supported for non MD"))}else t=Promise.reject(new Error("add history sync notification: not supported without md backend"));return t}function _(){return(_=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];yield f(e),t&&c.add(e.msgKey)}))).apply(this,arguments)}function h(){return(h=(0,a.default)((function*(){if(c.size>0)return null;const e=yield u();return e&&(e.downloadOptions.mediaKey=e.chunkEncryptionKey,delete e.chunkEncryptionKey,e.downloadOptions.directPath=e.directPath||e.downloadOptions.directPath,delete e.directPath,e.downloadOptions.filehash=""===e.downloadOptions.filehash?e.filehash:e.downloadOptions.filehash,delete e.filehash,e.downloadOptions.encFilehash=e.encFilehash,delete e.encFilehash,c.add(e.msgKey)),e}))).apply(this,arguments)}},54598:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndRemoveLocalLabelAssociation=function(){return s.apply(this,arguments)},t.queryLocalLabelAssociation=o;var i=n(r(48926)),a=r(82663);function o(e){return(0,a.getTable)().anyOf(["associationId","type"],e.map((e=>{let{associationId:t,type:r}=e;return[t,r]})))}function s(){return(s=(0,i.default)((function*(e){const t=yield o(e);yield(0,a.getTable)().bulkRemove(t.map((e=>{let{labelId:t,associationId:r,type:n}=e;return[t,r,n]})))}))).apply(this,arguments)}},14748:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceUpdateLock=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n.GK.supportsFeature(n.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in MD mode"));let a=["participant","device-list"];t&&(a=[...a,"message"]);r&&(a=[...a,"missing-keys"]);return(0,i.getStorage)().lock(a,(t=>e(t)))};var n=r(7293),i=r(99069)},47124:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RetryEligibilityResult=void 0,t.createOrMergeReceiptRecords=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){const t=new Map;return e.forEach((e=>{var r;const{msgKey:n,receiverId:i}=e,a=(0,l.toUserWid)(i).toString(),s=n.toString(),c=`${s},${a}`,d=null!==(r=i.device)&&void 0!==r?r:o.DEFAULT_DEVICE_ID,u=t.get(c);u?u.deviceNotDelivered.push(d):t.set(c,{msgKey:s,receiverUserJid:a,deviceDelivered:[],deviceNotDelivered:[d]})})),(0,f.getStorage)().lock(["message-info"],function(){var e=(0,a.default)((function*(e){let[r]=e;const n=Array.from(t.values()).map((e=>[e.msgKey,e.receiverUserJid]));return(yield r.anyOf(["msgKey","receiverUserJid"],n)).forEach((e=>{const r=`${e.msgKey},${e.receiverUserJid}`,n=t.get(r);n&&t.set(r,(0,i.default)((0,i.default)({},e),{},{deviceNotDelivered:[...e.deviceNotDelivered,...n.deviceNotDelivered]}))})),(0,p.getTable)().bulkCreateOrReplace(Array.from(t.values()))}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrMergeReceiptRecords: not supported for non MD"))},t.isRetryEligible=function(e,t,r,n){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){const i=(0,l.toUserWid)(t).toString(),a=t.device||0;return(0,p.getTable)().get([e.toString(),i]).then((s=>s?s.deviceNotDelivered.includes(a)?null!=r&&n>=r?g.ELIGIBLE:null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID||null!=s.delivery?g.INELIGIBLE_CHANGED_IDENTITY:g.ELIGIBLE:(__LOG__(2)`MessageInfoStore: ${e.toString()},${i}:${a} has been delivered`,g.INELIGIBLE_ALREADY_DELIVERED):(__LOG__(2)`MessageInfoStore: missing record for ${e.toString()},${i}`,g.INELIGIBLE_RECORD_MISSING)))}return Promise.resolve(g.INELIGIBLE_NOT_MD)},t.queryMsgInfo=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){const t=String(e);return(0,u.getTable)().get(t).then((t=>{const r=t?t.count:null;return(0,p.getTable)().equals(["msgKey"],e.toString()).then((t=>{const n={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0};let i=0;t.forEach((e=>{const t=(0,l.createWid)(e.receiverUserJid);if(!(0,c.getMeUser)().equals(t)){!function(e){const t=e.read;null!=t&&(null==e.delivery||e.delivery>t)&&(e.delivery=t)}(e);for(let r=0;r<h.length;r++){const i=h[r],a=e[i];if(null!=a){n[i].push({id:t,t:a});break}}null!=e.delivery&&null!=e.deliveryPrivacyMode&&(n.deliveryPrivacyMode=e.deliveryPrivacyMode),i+=1}}));const a=null!=r&&0!==r?r:i;return __LOG__(2)`queryMsgInfo: ${e}, ack count: ${r}, receiver: ${a},
played: ${n.played.length}, read: ${n.read.length}, delivery: ${n.delivery.length}`,n.playedRemaining=a-n.played.length,n.readRemaining=n.playedRemaining-n.read.length,n.deliveryRemaining=n.readRemaining-n.delivery.length,n}))}))}return Promise.reject(new Error("queryMsgInfo: not supported without model storage"))},t.updateReceiptRecords=function(e,t,r,n,i){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){const a=_[e],o=(0,l.toUserWid)(r).toString(),c=r.device||0;return a?function(e,t,r,n,i,a){if(0===i.length)return Promise.resolve();return(0,f.getStorage)().lock(["message-info"],(o=>{let[l]=o;const c=i.map((e=>[e,r]));return l.bulkGet(c).then((o=>{const c=[];return i.forEach(((i,l)=>{const d=o[l];if(!d){__LOG__(2)`updateReceiptRecords: got receipt for peer msg ${i},${r}`;const n={msgKey:i,receiverUserJid:r,[e]:t,deviceDelivered:[],deviceNotDelivered:[]};return e===s.ACK_STRING.DELIVERY&&null!=a&&(n.deliveryPrivacyMode=a),void c.push(n)}if(e!==_[s.ACK.INACTIVE]){const r=d[e];(null==d[e]||r>t)&&(d[e]=t),e===s.ACK_STRING.DELIVERY&&null!=a&&(d.deliveryPrivacyMode=a)}d.deviceNotDelivered.length>0&&(d.deviceDelivered.push(n),d.deviceDelivered=d.deviceDelivered.filter(((e,t,r)=>r.indexOf(e)===t)),d.deviceNotDelivered=d.deviceNotDelivered.filter((e=>e!==n))),c.push(d)})),l.bulkCreateOrReplace(c)}))}))}(a,t,o,c,n,i):Promise.reject(new Error(`updateReceiptRecords: not supported ack type ${e}`))}return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(35470),l=(n(r(89867)),r(45454)),c=r(99234),d=r(7293),u=r(90981),p=r(52489),f=r(99069);const _={[s.ACK.RECEIVED]:s.ACK_STRING.DELIVERY,[s.ACK.READ]:s.ACK_STRING.READ,[s.ACK.PLAYED]:s.ACK_STRING.PLAYED,[s.ACK.INACTIVE]:s.ACK_STRING.INACTIVE},h=[s.ACK_STRING.PLAYED,s.ACK_STRING.READ,s.ACK_STRING.DELIVERY],g=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});t.RetryEligibilityResult=g},86868:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.removeMessagesFromHistory=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)){const t=[];return(0,o.initializeWithoutGKs)().then((()=>{if(e.length>0)return(0,l.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{null!=(null==e?void 0:e.rowId)&&t.push(String(e.rowId))}))}))})).then((()=>(0,d.getStorage)().lock(["message","label-association"],(()=>{const t=(0,c.queryAndRemoveLocalLabelAssociation)(e.map((e=>({associationId:e,type:s.LabelAssociationType.Message}))));return Promise.all([(0,l.getTable)().bulkRemove(e),t])})))).then((()=>{t.length>0&&i.default.purge(t)})).then((()=>{})).catch((e=>{throw __LOG__(4,void 0,new Error)`removeMessagesFromHistory: error ${e}`,e}))}return Promise.resolve()};var i=n(r(69048)),a=r(7293),o=r(23356),s=r(82663),l=r(90981),c=r(54598),d=r(99069);r(79038)},60324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pruneExpiredMessages=function(){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return __LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages started`,(0,o.getTable)().lessThan(["expiredTimestamp"],n.Clock.globalUnixTime(),{shouldDecrypt:!1}).then((e=>(0,i.removeMessagesFromHistory)(e.map((e=>e.id.toString()))).then((()=>(__LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages completed`,e)))));return Promise.resolve([])},t.removeExpiredMessagesFromHistory=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,i.removeMessagesFromHistory)(e.map((e=>e.id.toString())));return Promise.resolve()};var n=r(22683),i=r(86868),a=r(7293),o=r(90981)},35588:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgByMsgKey=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){let t;return t=e instanceof o.default?e.toString():e,(0,c.getTable)().get(t).then((e=>e?(0,d.hydrateMessage)(e):null))}return Promise.resolve(null)},t.getMsgsByMsgKey=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,c.getTable)().bulkGet(e).then((e=>e.filter(Boolean).map(d.hydrateMessage)));return Promise.resolve([])},t.msgFindQuery=function(e,t){if(null!=t.label)return Promise.resolve([]);if("before"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e instanceof o.default){const r=e.remote.toString();return(0,c.getTable)().equals(["id"],e.toString()).then((n=>{if(0===n.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const a=n[0],o=(0,d.getInChatMsgId)(a.internalId||""),s=Math.max(0,o-t),c=(0,d.craftInternalId)(r,o);let u=(0,d.craftInternalId)(r,s);const f={lowerInclusive:!0,upperInclusive:!1};return(0,l.receiveReactionsEnabled)()?(u=(0,d.beginningOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(u,c,(0,i.default)((0,i.default)({},f),{},{reverse:!0}),t).then((e=>e.reverse().map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(u,c,f).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count);if("after"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e instanceof o.default){const r=e.remote.toString();return(0,c.getTable)().equals(["id"],e.toString()).then((n=>{if(0===n.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const i=n[0],a=(0,d.getInChatMsgId)(i.internalId||""),o=(0,d.craftInternalId)(r,a);let s=(0,d.craftInternalId)(r,a+t);const c={lowerInclusive:!1,upperInclusive:!0};return(0,l.receiveReactionsEnabled)()?(s=(0,d.endOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(o,s,c,t).then((e=>e.map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(o,s,c).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count).catch((0,a.filteredCatch)(p,(()=>({status:404}))));if("star"===e){const e=null==t.id?void 0:new o.default(t);return null!=t.chat?function(e,t,r){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.resolve().then((()=>{if(null!=r)return(0,c.getTable)().get(r.toString())})).then((r=>{const n=null==r?[(0,d.endOfChat)(e),1/0]:[r.internalId,r.isStarred],i=[(0,d.beginningOfChat)(e),0];return(0,c.getTable)().between(["internalId","isStarred"],i,n,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:t}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.chat,t.count,e):function(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.resolve().then((()=>{if(null!=t)return(0,c.getTable)().get(t.toString())})).then((t=>{const r=null==t?1/0:t.isStarred;return(0,c.getTable)().between(["isStarred"],0,r,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:e}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.count,e)}if("search"===e){const e={};t.remote&&(e.remote=t.remote.toString()),t.count&&t.page>=0&&(e.limit=t.count,e.page=t.page);const{default:n}=r(69048);return n.search(t.searchTerm,e)}if("media"===e){const e=t.remote,r=null==t.id?void 0:new o.default(t);return"document"===t.media?f(e,t.count,t.direction,"isDocMsg",r).then((e=>e.map(d.hydrateMessage))):"url"===t.media?f(e,t.count,t.direction,"hasLink",r).then((e=>e.map(d.hydrateMessage))):Promise.all(["isMediaMsg","isDocMsg","hasLink"].map((n=>f(e,t.count,t.direction,n,r).then((e=>e.map(d.hydrateMessage)))))).then((e=>{let[t,r,n]=e;const i=[t,n,r].flat();return{docCount:r.length,linkCount:n.length,mediaCount:t.length,messages:i}}))}return __LOG__(3)`Message query type ${e} not implemented.`,Promise.reject(new Error(`Message query type ${e} not implemented.`))},t.queryMessageType=f,t.queryVcard=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,c.getTable)().equals(["vcardWAids"],e.toString()).then((e=>e.map(d.hydrateMessage)));return Promise.resolve()};var i=n(r(81109)),a=r(50796),o=n(r(65212)),s=r(7293),l=r(57701),c=r(90981),d=r(12896);const u=20;class p extends Error{constructor(){super(...arguments),this.name="NoAnchorMessageError"}}function f(e,t,r,n,i){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){return(null==i?Promise.resolve(void 0):(0,c.getTable)().equals(["id"],i.toString())).then((a=>{if(i&&null!=a&&0===a.length)throw __LOG__(3)`Anchor message ${i&&i.toString()} does not exist in message table`,new p;const o=null==a?void 0:a[0];let s,l,u=!1;return"before"===r?(s=(0,d.beginningOfChat)(e),l=null==o?(0,d.endOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(o.internalId||"")),u=!0):(s=null==o?(0,d.beginningOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(o.internalId||"")),l=(0,d.endOfChat)(e)),(0,c.getTable)().between(["internalId",n],[s,0],[l,1/0],{lowerInclusive:!1,upperInclusive:!1,limit:t,reverse:u})}))}return Promise.resolve([])}},84886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DuplicateMessageError",{enumerable:!0,get:function(){return n.DuplicateMessageError}}),Object.defineProperty(t,"getMsgByMsgKey",{enumerable:!0,get:function(){return i.getMsgByMsgKey}}),Object.defineProperty(t,"getMsgsByMsgKey",{enumerable:!0,get:function(){return i.getMsgsByMsgKey}}),Object.defineProperty(t,"msgFindQuery",{enumerable:!0,get:function(){return i.msgFindQuery}}),Object.defineProperty(t,"processPaymentMessages",{enumerable:!0,get:function(){return n.processPaymentMessages}}),Object.defineProperty(t,"processRevokeMsgs",{enumerable:!0,get:function(){return n.processRevokeMsgs}}),Object.defineProperty(t,"queryVcard",{enumerable:!0,get:function(){return i.queryVcard}}),Object.defineProperty(t,"removeMessagesFromHistory",{enumerable:!0,get:function(){return a.removeMessagesFromHistory}}),Object.defineProperty(t,"starMessages",{enumerable:!0,get:function(){return n.starMessages}}),Object.defineProperty(t,"storeInitialSyncMessages",{enumerable:!0,get:function(){return n.storeInitialSyncMessages}}),Object.defineProperty(t,"storeMessages",{enumerable:!0,get:function(){return n.storeMessages}}),Object.defineProperty(t,"storeRecentAndFullHistSyncMessages",{enumerable:!0,get:function(){return n.storeRecentAndFullHistSyncMessages}}),Object.defineProperty(t,"unstarMessages",{enumerable:!0,get:function(){return n.unstarMessages}}),Object.defineProperty(t,"updateExistingMessages",{enumerable:!0,get:function(){return n.updateExistingMessages}}),Object.defineProperty(t,"updateMessage",{enumerable:!0,get:function(){return n.updateMessage}});var n=r(90641),i=r(35588),a=r(86868)},30986:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._test=void 0,t.deleteMessagesInMessageRange=function(e,t,r){const{lastMessageTimestamp:n,lastSystemMessageTimestamp:a,messages:o}=t;return(0,p.getStorage)().lock(["message"],function(){var t=(0,i.default)((function*(t){let[i]=t,s=[];const l=[];null!=n&&(l.push(S(e,n,_.MessagePropertyType.IncomingChatMessage,r)),l.push(S(e,n,_.MessagePropertyType.Outgoing,r)));const c=null!=a?a:n;null!=c&&l.push(S(e,c,_.MessagePropertyType.SystemMessage,r)),l.push(function(){return T.apply(this,arguments)}(o,r));const d=yield Promise.all(l);s=s.concat(...d);const u=null==r?void 0:r.skipMessages;return u&&(s=s.filter((e=>!u.has(e)))),yield i.bulkRemove(s),s}));return function(){return t.apply(this,arguments)}}())},t.filterReceivedMessagesInRange=function(){return m.apply(this,arguments)},t.fixMessageRange=function(e){var t,r;const n=e.messages,i={messages:n,lastMessageTimestamp:e.lastMessageTimestamp};if(n.length>h){const{messages:e,newLastMessageTimestamp:t}=y(n,h);null!=t&&(i.lastMessageTimestamp=t),i.messages=e}(0,a.numberOrThrowIfTooLarge)(null!==(t=e.lastSystemMessageTimestamp)&&void 0!==t?t:0)>(0,a.numberOrThrowIfTooLarge)(null!==(r=i.lastMessageTimestamp)&&void 0!==r?r:0)&&(i.lastSystemMessageTimestamp=e.lastSystemMessageTimestamp);return i},t.getAdditionalMessages=function(){return g.apply(this,arguments)},t.getFirstSystemMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.SystemMessage),(0,_.endOfMessageRange)(e,_.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!1,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,_.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.IncomingChatMessage),(0,_.endOfMessageRange)(e,_.MessagePropertyType.IncomingChatMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,_.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastSystemMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.SystemMessage),(0,_.endOfMessageRange)(e,_.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,_.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.timestampComparison=E;var i=n(r(48926)),a=r(8243),o=n(r(45095)),s=r(92844),l=n(r(65212)),c=r(15461),d=r(22683),u=r(90981),p=r(99069),f=r(93650),_=r(12896);const h=1e3;function g(){return(g=(0,i.default)((function*(e,t,r){const n=(0,u.getTable)().between(["messageRangeIndex"],(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.Outgoing,t),(0,_.endOfMessageRange)(e,_.MessagePropertyType.Outgoing),{reverse:!0,shouldDecrypt:!1}),i=(0,u.getTable)().anyOf(["messageRangeIndex"],[(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.IncomingChatMessage,t),(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.Outgoing,t),(0,_.beginningOfMessageRange)(e,_.MessagePropertyType.Outgoing)],{reverse:!0,shouldDecrypt:!1}),a=yield Promise.all([n,i]).then((e=>{let[t,n]=e;return t.concat(n).filter((e=>-1!==e.ack&&!e.isSendFailure&&!e.mdDowngrade)).filter((e=>!((null==r?void 0:r.excludeStarred)&&e.isStarred))).map((e=>{var t;const r=l.default.fromString(e.id),n=null!==(t=(0,_.extractC2STimestampFromMessageRangeIndex)(e.messageRangeIndex))&&void 0!==t?t:void 0;return{key:(0,f.msgKeyToProtobuf)(r),timestamp:n}}))})),{messages:o,newLastMessageTimestamp:s}=y(a,(null==r?void 0:r.limit)||h);return{messages:o,newLastMessageTimestamp:s}}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){if(0===t.length)return t;const r=t.map((e=>(0,f.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),n=yield(0,u.getTable)().bulkGet(r,!1);return t.filter(((e,t)=>null!=n[t]))}))).apply(this,arguments)}function y(e,t){const r=[],n=[];if(e.forEach((e=>{null!=e.timestamp?r.push(e):n.push(e)})),r.length<t)return{messages:e};const i=r.sort(E).slice(0,t),s=i[i.length-1];return{messages:i.concat(n),newLastMessageTimestamp:(0,a.numberOrThrowIfTooLarge)((0,o.default)(s.timestamp,"smallestTimestampMessage.timestamp"))}}function E(e,t){const[r,n]=[e,t].map((e=>(0,a.numberOrThrowIfTooLarge)((0,o.default)(e.timestamp,"syncActionMessage.timestamp"))));return n-r}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,r,n){let i=yield(0,u.getTable)().between(["messageRangeIndex"],(0,_.beginningOfMessageRange)(e,r),(0,_.beginningOfMessageRange)(e,r,(0,a.numberOrThrowIfTooLarge)(t)),{lowerInclusive:!0,upperInclusive:!0,shouldDecrypt:!1});return r===_.MessagePropertyType.SystemMessage&&!1!==(null==n?void 0:n.skipRecentSystemMessages)&&(i=i.filter((e=>!((0,_.isSecuritySensitiveMessage)(e)&&e.t>d.Clock.globalUnixTime()-s.DAY_SECONDS)))),(null==n?void 0:n.skipStarred)&&(i=i.filter((e=>void 0===e.isStarred))),r===_.MessagePropertyType.SystemMessage&&(i=i.filter((e=>!(e.type===c.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===e.subtype)))),i.map((e=>e.id))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const r=e.map((e=>(0,f.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),n=yield(0,u.getTable)().bulkGet(r),i=[];return n.forEach((e=>{null!=e&&((null==t?void 0:t.skipStarred)&&null!=e.isStarred||i.push(e.id))})),i}))).apply(this,arguments)}const C={limitAdditionalMessages:y};t._test=C},90641:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PreviousMsgNotPlaceholderError=t.DuplicateMessageError=void 0,t.encryptMultipleMsgs=Q,t.processPaymentMessages=function(){return z.apply(this,arguments)},t.processRevokeMsgs=function(){return $.apply(this,arguments)},t.starMessages=function(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND))return(0,O.getTable)().bulkGet(e).then((e=>{const t=e.filter(Boolean).map((e=>({id:e.id,isStarred:e.rowId})));return(0,O.getTable)().bulkCreateOrMerge(t)}));return Promise.resolve()},t.storeEncryptedMessage=Z,t.storeInitialSyncMessages=function(){return W.apply(this,arguments)},t.storeMessageInTransaction=ee,t.storeMessages=function(){return V.apply(this,arguments)},t.storeRecentAndFullHistSyncMessages=function(){return H.apply(this,arguments)},t.unstarMessages=function(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND))return(0,O.getTable)().bulkCreateOrMerge(e.map((e=>({id:e,isStarred:void 0}))));return Promise.resolve()},t.updateExistingMessages=function(e,t){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND)){var r;const n=null==t?null===(r=e[0])||void 0===r?void 0:r.id.remote:t;if(n){const t=e.map((e=>ae((0,G.convertToMessageRowType)(e),n.toString(),!!(0,M.findLink)(e.body,!0))));return Promise.resolve((0,O.getTable)().bulkCreateOrMerge(t)).then((()=>{h.default.index()})).catch((e=>{throw __LOG__(3)`Error storing messages`,e}))}}return Promise.resolve()},t.updateMessage=function(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND))return(0,N.getStorage)().lock(["message"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=yield r.get(e.id.toString());if(!n)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, Failed to find previous message row in message table`);if(!function(e){if(null==e?void 0:e.type){if(e.type===d.MSG_TYPE.CIPHERTEXT)return!0;if(e.type===d.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype)return!0}return!1}(n))throw __LOG__(2,void 0,void 0,void 0,["messaging"])`updateMessage: msgId::${e.id.toString()}, Previous row in message table is not a placeholder`,new j;null!=n.t&&(e.t=n.t),n.ack>e.ack&&(e.ack=n.ack);const i=ae((0,G.convertToMessageRowType)(e),e.from.toString(),!!(0,M.findLink)(e.body,!0),void 0,void 0,n.pendingReadReceipt);if(i.rowId=n.rowId,i.internalId=n.internalId,null==i.rowId||null==i.internalId)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, missing rowId or internalId`);yield r.createOrReplace(i),(0,I.populatePlaceHolderAction)(n),h.default.index()}));return function(){return t.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(81109)),a=n(r(48926)),o=n(r(2525)),s=r(52613),l=r(52230),c=n(r(65212)),d=r(15461),u=n(r(89867)),p=r(45454),f=n(r(86128)),_=r(48285),h=n(r(69048)),g=r(22683),m=r(15998),y=r(35588),E=r(44936),S=r(99234),v=r(6901),T=r(7293),C=r(57701),A=n(r(52991)),b=r(62415),P=r(10435),M=r(86688),O=r(90981),I=r(63728),w=r(76214),R=r(54676),D=r(49831),N=r(99069),L=n(r(41809)),k=r(43323),G=r(12896),U=r(78521),F=r(21224),x=r(65044);const B=1e9;class K extends Error{constructor(){super(...arguments),this.name="DuplicateMessageError"}}t.DuplicateMessageError=K;class j extends Error{constructor(){super(...arguments),this.name="PreviousMsgNotPlaceholderError"}}t.PreviousMsgNotPlaceholderError=j;class Y extends Error{constructor(){super(...arguments),this.name="DroppingMsgRowDueToLogout"}}function W(){return(W=(0,a.default)((function*(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND)){yield m.DbEncKeyStore.waitForFinalDbMsgEncKey();let t=0;(0,o.default)(e,(e=>{let{msgs:r}=e;return t+=r.length}));const n=new Map,i=new Map,a=Object.keys(e).reduce(((t,r)=>{let i=t.nextRowId,a=B-e[r].msgs.length;const{pendingUnreadIds:o,unreadMentions:s}=re(e[r].chatInfo.unreadCount||0,e[r].msgs);(0,P.isGroupCatchUpEnabled)()&&s.length&&n.set(r,s);const l=[];return e[r].msgs.forEach((e=>{try{i++,a++,e.isMdHistoryMsg=!0;const t=ae((0,G.convertToMessageRowType)(e),(0,p.createWid)(r).toString(),!!(0,M.findLink)(e.body,!0),i,a,o.has(String(e.id)));l.push(t)}catch(e){if(e instanceof Y)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`storeInitialSyncMessages failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}})),{nextRowId:i,messages:t.messages.concat(l)}}),{nextRowId:B-t,messages:[]});return a.messages.forEach((e=>{e.type===d.MSG_TYPE.GROUPS_V4_INVITE&&(0,b.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:g.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)})})),(0,P.isGroupCatchUpEnabled)()&&n.size&&(n.forEach(((e,t)=>{var n,a;const o=r(69951).ChatCollection.get((0,p.createWid)(t)),s=e.map((e=>{let{id:t,timestamp:r}=e;return new L.default({id:t,timestamp:r})})),l=null==o||null===(n=o.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata,c=null!==(a=null==l?void 0:l.pendingUnreadMentionCount)&&void 0!==a?a:0;(null==l?void 0:l.pendingUnreadMentionCount)&&(l.pendingUnreadMentionCount=Math.max(c-s.length,0),i.set(t,l.pendingUnreadMentionCount)),null==l||l.addUnreadMentions(s,k.UnreadMessageType.HISTORYC_SYNC_CHUNK)})),(0,_.addUnreadMentionChat)(n,i)),(0,N.getStorage)().lock(["message"],(e=>{let[t]=e;return t.bulkCreate(a.messages).catch((e=>{if(__LOG__(3)`Error storing MD initial sync messages with error ${e}`,e instanceof f.default.BulkError||e instanceof f.default.ConstraintError)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Retrying initial sync bulk add on error`,t.bulkCreateOrMerge(a.messages);throw e}))})).then((()=>{f.default.ignoreTransaction((()=>{(0,E.getTable)().bulkCreateOrReplace(a.messages.map((e=>({id:String(e.rowId)})))).then((()=>{h.default.index()}))}))})).catch((e=>{__LOG__(3)`Error storing MD initial sync messages with error ${e} after retry`}))}return Promise.resolve()}))).apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(T.GK.supportsFeature(T.GK.F.MD_BACKEND)){let a=e;const o=r(69951).ChatCollection,s=new Map,l=new Map;try{a=yield(0,D.applyOrphanRevoke)(e)}catch(e){__LOG__(4,void 0,new Error,void 0,["History Sync"])`applyOrphanRevoke failed with error ${e}`}a.forEach((e=>{if(e.type===d.MSG_TYPE.GROUPS_V4_INVITE&&(0,b.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:g.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)}),(0,P.isGroupCatchUpEnabled)()&&(0,R.isImportantMessage)(e)){const a=e.id.remote.toString();let c=0;if(l.has(a)){var t;c=null!==(t=l.get(a))&&void 0!==t?t:0}else{var r,n;const e=o.get(a);c=null!==(r=null==e||null===(n=e.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata.pendingUnreadMentionCount)&&void 0!==r?r:0,l.set(a,c)}if(c>0){l.set(a,c-1);const t={id:e.id.toString(),timestamp:e.t};var i;if(s.has(a))null===(i=s.get(a))||void 0===i||i.push(t);else s.set(a,[t])}}}));return Z(yield Q(a,n),t,i).then((()=>{(0,P.isGroupCatchUpEnabled)()&&s.size>0&&(s.forEach(((e,t)=>{var r,n;const i=o.get(t),a=null!==(r=l.get(t))&&void 0!==r?r:0,c=null==i||null===(n=i.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata;if(0===(null==c?void 0:c.pendingUnreadMentionCount)||(null==i?void 0:i.hasChatBeenOpened))s.delete(t);else if(c&&c.pendingUnreadMentionCount>0){c.pendingUnreadMentionCount=a;const t=e.map((e=>new L.default({id:e.id.toString(),timestamp:e.timestamp})));c.addUnreadMentions(t,k.UnreadMessageType.HISTORYC_SYNC_CHUNK)}})),s.size>0&&(0,_.addUnreadMentionChat)(s,l))})).catch((()=>{__LOG__(3)`Error storing MD recent or full sync messages`}))}return Promise.resolve()}))).apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return T.GK.supportsFeature(T.GK.F.MD_BACKEND)?(yield m.DbEncKeyStore.waitForFinalDbMsgEncKey(),Promise.resolve(ee(e,t,r)).then((()=>{h.default.index()})).catch((e=>{throw e instanceof f.default.BulkError||e instanceof f.default.ConstraintError?new K:(__LOG__(3)`Error storing messages`,e)}))):Promise.resolve()}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND)){const t=[],r=[],n=[],i=new Map,o=e.filter((e=>{const{revokeMsgKey:t,newMsgKey:r,subtype:n}=e;let i=!0;return"admin_revoke"===n?(0,C.adminRevokeReceiverEnabled)()?u.default.isGroup(t.remote)?u.default.equals(t.remote,r.remote)||(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke came for the different group than the original message was in`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke was sent to a non-group chat`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: admin revoke feature is disabled, ${String(t)} has not been revoked`):(i=u.default.equals(t.remote,r.remote)&&u.default.equals(t.participant,r.participant)&&t.fromMe===r.fromMe,i||__LOG__(2)`processRevokeMsgs: invalid revoke request ${String(t)}, ${String(r)}`),i}));o.forEach((e=>{r.push(e.revokeMsgKey.toString()),n.push(e.newMsgKey.toString())}));const s=o.length;yield(0,N.getStorage)().lock(["message","orphan-revoke"],function(){var e=(0,a.default)((function*(e){let[a,l]=e;const u=yield(0,w.getMessageTable)().bulkGet(r.concat(n),!1),p=u.slice(0,s),f=u.slice(s),_=[],h=[];p.forEach(((e,a)=>{var s,l;if(null==e)return __LOG__(2)`processRevokeMsg: orphan revoke message key ${p[a]}`,void h.push({msgKey:r[a],sender:o[a].sender,timestamp:o[a].timestamp,subtype:null!==(l=o[a].subtype)&&void 0!==l?l:"sender_revoke"});if(_.push({id:n[a],to:e.to,author:e.author,type:d.MSG_TYPE.REVOKED,subtype:"admin_revoke"===o[a].subtype?"admin":"sender",revokeSender:o[a].sender,protocolMessageKey:r[a],protocolMessageRowId:null===(s=f[a])||void 0===s?void 0:s.rowId,from:e.from,t:e.t,rowId:e.rowId,internalId:e.internalId,messageRangeIndex:e.messageRangeIndex}),t.push(String(e.rowId)),(0,P.isGroupCatchUpEnabled)()&&(0,R.isImportantMessage)(e)){const t=c.default.fromString(e.id).remote.toString();if(i.has(t)){var u;const r=null!==(u=i.get(t))&&void 0!==u?u:[];i.set(t,[...r,e.id])}else i.set(t,[e.id])}}));const g=[(0,w.getMessageTable)().bulkRemove(r),(0,w.getMessageTable)().bulkCreateOrReplace(_)];h.length>0&&g.push((0,w.getOrphanRevokeTable)().bulkCreateOrReplace(h)),yield Promise.all(g)}));return function(){return e.apply(this,arguments)}}()),h.default.purge(t),(0,P.isGroupCatchUpEnabled)()&&(0,_.removeUnreadMentionChat)(i)}return Promise.resolve()}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e){if(T.GK.supportsFeature(T.GK.F.MD_BACKEND)){const t=[],r=[],n=e.map((e=>e.paymentRequestMessageKey?e.paymentRequestMessageKey.toString():"")).filter((e=>""!==e)),i=e.filter((e=>"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype)).map((e=>e.id.toString()));return(0,N.getStorage)().lock(["message"],function(){var o=(0,a.default)((function*(a){let[o]=a;const s=yield(0,y.getMsgsByMsgKey)(n.concat(i)),l=new Map;return s.forEach((e=>{null!=e&&l.set(e.id.toString(),e)})),e.forEach((e=>{var n;const i=null===(n=e.paymentRequestMessageKey)||void 0===n?void 0:n.toString(),a=l.get(i||"");if(a)if("send"===e.subtype&&null!=e.paymentTxnStatus)t.push({id:i,paymentTxnStatus:e.paymentTxnStatus});else{const r=a.from.isGroup()?a.author:a.from,n=a.paymentMessageReceiverJid.equals((0,S.getMeUser)())?r:a.paymentMessageReceiverJid;"payment_action_request_declined"===e.subtype?t.push({id:i,paymentStatus:F.PaymentInfoStatus.REJECTED,paymentTxnStatus:F.PaymentInfoTxnStatus.COLLECT_REJECTED}):"payment_transaction_request_cancelled"===e.subtype&&t.push({id:i,paymentStatus:F.PaymentInfoStatus.CANCELLED,paymentTxnStatus:F.PaymentInfoTxnStatus.COLLECT_CANCELED}),t.push({id:e.id.toString(),type:d.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[n,a.paymentCurrency,String(a.paymentAmount1000)]})}else l.get(e.id.toString())&&!e.isMdHistoryMsg&&r.push(e.id.toString())})),yield(0,w.getMessageTable)().bulkRemove(r),yield(0,w.getMessageTable)().bulkCreateOrMerge(t),t}));return function(){return o.apply(this,arguments)}}())}return null}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(A.default.isLogoutInProgress)return Promise.reject(new Y);null!=t&&(yield(0,s.asyncSleepAfterGivenLoopIteration)(t,35,100));const r=(0,w.getMessageTable)(),n=oe(e),a=(0,G.convertToMessageRowType)(e),o=yield r.preflightEncryptSingleRecord((0,i.default)({},a));return[(0,i.default)((0,i.default)((0,i.default)({},a),o),{},{vcardWAids:n}),!!(0,M.findLink)(e.body,!0)]}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(yield m.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield new Promise((e=>setTimeout(e,0))),r){t=[];for(let r=0;r<e.length;r++)try{const n=e[r],i=yield q(n,r);t.push(i)}catch(e){if(e instanceof Y)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow with throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}}else t=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return yield q(e).catch((e=>{if(e instanceof Y)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow without throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`})).finally((()=>{}))}));return function(){return e.apply(this,arguments)}}())),t=t.filter(Boolean);return t}))).apply(this,arguments)}function Z(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,N.getStorage)().lock(["message"],function(){var n=(0,a.default)((function*(n){let[i]=n;const a=yield i.all({reverse:!r,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?B:e[0])),o={};yield Promise.all(t.map((e=>{const t=(0,p.createWid)(e),n=(0,G.beginningOfChat)(t),a=(0,G.endOfChat)(t);return i.between(["internalId"],n,a,{limit:1,reverse:!r,returnKeyType:"keys"}).then((e=>o[t.toString()]=0===e.length?B:(0,G.getInChatMsgId)(e[0])))})));const s=r?-1:1,l=e.map(((e,t)=>{let[n,i]=e;r&&(n.isMdHistoryMsg=!0);const l=c.default.fromString(n.id),d=l.remote.toString(),u=o[d]+1*s;o[d]=u;const p=!r&&te(l,n);return ae(n,d,i,a+s*(t+1),u,p)}));return i.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(l).catch((e=>{if(r&&e instanceof f.default.BulkError)return __LOG__(4,void 0,new Error)`[storeEncryptedMessage] BulkError in bulkCreate, retrying with bulk create or replace`,i.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(l);throw e})).then((()=>l))}));return function(){return n.apply(this,arguments)}}()).then((e=>{f.default.ignoreTransaction((()=>{(0,E.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)})))).then((()=>{h.default.index()}))}))}))}function ee(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=null==t?e[0].id.remote:t,i=(0,G.beginningOfChat)(n),o=(0,G.endOfChat)(n);return(0,N.getStorage)().lock(["chat","message"],function(){var t=(0,a.default)((function*(t){let[a,s]=t;const l=yield a.get(n.toString());if(!n.isStatusV3()&&(null!=l||(0,G.shouldCreateChatWithMsgs)(e))){const t=yield ne(l,e,n);yield a.createOrMerge(n.toString(),t)}const c=s.all({reverse:!r,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?B:e[0])),d=s.between(["internalId"],i,o,{limit:1,reverse:!r,returnKeyType:"keys"}).then((e=>0===e.length?B:(0,G.getInChatMsgId)(e[0]))),[u,p]=yield Promise.all([c,d]),f=r?u-e.length:u+1,_=r?p-e.length:p+1,h=e.map(((e,t)=>{const i=(0,G.convertToMessageRowType)(e),a=!r&&te(e.id,e);return ae(i,n.toString(),!!(0,M.findLink)(e.body,!0),f+t,_+t,a)}));return s.bulkCreate(h).then((()=>h))}));return function(){return t.apply(this,arguments)}}()).then((e=>{f.default.ignoreTransaction((()=>{(0,E.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)}))))}))}))}function te(e,t){if(e.fromMe||e.remote.isStatusV3())return!1;const r=(0,R.eventTypeFromMsgType)(t);return"a"===r||"d"===r}function re(e,t){let r=e;const n=new Set,i=[];for(let e=t.length-1;e>=0&&!(r<=0);e--){const a=t[e];if(te(a.id,a)&&(r--,n.add(String(a.id)),(0,P.isGroupCatchUpEnabled)()&&(0,R.isImportantMessage)(a))){const e={id:String(a.id),timestamp:a.t};i.push(e)}}return{pendingUnreadIds:n,unreadMentions:i}}function ne(){return ie.apply(this,arguments)}function ie(){return(ie=(0,a.default)((function*(e,t,r){var n;let i,a=Math.max(0,e?e.unreadCount:0);const o=null!==(n=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==n?n:[];return t.forEach((e=>{const t=(0,R.eventTypeFromMsgType)(e);if("i"!==t&&(e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),"a"!==t&&"d"!==t||e.id.fromMe||(a+=1),(0,P.isGroupCatchUpEnabled)())){if(te(e.id,e)&&(0,R.isImportantMessage)(e)){const t={id:e.id.toString(),timestamp:e.t};o.push(t)}}})),e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),{id:r.toString(),unreadCount:a,t:i,unreadMentionsOfMe:o}}))).apply(this,arguments)}function ae(e,t,r,n,a,o){const s=[d.MSG_TYPE.IMAGE,d.MSG_TYPE.VIDEO,d.MSG_TYPE.AUDIO].includes(e.type),u=(0,i.default)((0,i.default)({},e),{},{vcardWAids:e.vcardWAids||oe(e),id:e.id.toString(),isStarred:e.star?n:void 0,hasLink:"chat"===e.type&&r?n:void 0,isMediaMsg:s?n:void 0,isDocMsg:e.type===d.MSG_TYPE.DOCUMENT?n:void 0,expiredTimestamp:se(e)});null!=n&&(u.rowId=n),null!=a&&(u.internalId=(0,G.craftInternalId)(t,a)),o&&t!==l.STATUS_JID&&(u.pendingReadReceipt=1);let p=e.c2sTimestamp;var f;e.id.fromMe&&!x.Socket.hasSynced?p=null!==(f=e.c2sTimestamp)&&void 0!==f?f:e.t:p=e.t;try{u.messageRangeIndex=(0,G.craftMessageRangeIndex)(t,!c.default.fromString(e.id).fromMe,d.SYSTEM_MESSAGE_TYPES.includes(e.type),p)}catch(e){__LOG__(4,void 0,new Error)`[process-msg] craftMessageRangeIndex failed with error ${e}`}return u}function oe(e){let t=[];if("vcard"===e.type)t=[e.body];else{if("multi_vcard"!==e.type)return;t=e.vcardList.map((e=>e.vcard))}return t.filter(Boolean).reduce(((e,t)=>{const r=(0,U.vcardWids)((0,U.parseVcard)(t));return e.concat(r.map((e=>e.toString())))}),[])}function se(e){const{ephemeralDuration:t,ephemeralStartTimestamp:r,t:n,subtype:i,id:{fromMe:a}}=e,o=(0,v.getEphemeralExpirationTimestamp)(t,r,n,i,a);return null!=o?o:void 0}},13946:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundsForChat=function(){return c.apply(this,arguments)},t.queryAndRemoveMessageHistory=function(){return u.apply(this,arguments)},t.queryAndRemoveMessagesInMessageRange=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(69048)),o=r(90981),s=r(30986),l=r(12896);function c(){return(c=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),r=(0,l.endOfChat)(e),n=yield(0,o.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,limit:1});if(0===n.length)return null;const i=n[0].rowId,a=yield(0,o.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,limit:1,reverse:!0});if(0===a.length)return null;const s=a[0].rowId,c=a[0].t;return null==i||null==s?null:{startRowId:i,endRowId:s,tsOfLastMessage:c}}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t,r){const n=yield(0,s.deleteMessagesInMessageRange)(e,t,r);return a.default.purge(n),n}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),r=(0,l.endOfChat)(e),n=yield(0,o.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,returnKeyType:"primary_key"});return yield(0,o.getTable)().bulkRemove(n),n}))).apply(this,arguments)}},12896:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePropertyType=t.MSG_OPAQUE_DATA_KEYS=void 0,t.beginningOfChat=function(e){return`${e.toString()}_/`},t.beginningOfMessageRange=function(e,t,r){const n=null!=r?P(r):"";return`${e.toString()}_${t}_${n}`},t.convertToMessageRowType=function(e){var t;let r=(0,o.default)({},e);e.quotedMsg&&(r.quotedMsg=(0,o.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(r.quotedMsg.paymentNoteMsg=(0,o.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(r.paymentNoteMsg=(0,o.default)({},e.paymentNoteMsg));r.id=e.id.toString(),e.from&&(r.from=e.from.toString());e.protocolMessageKey&&(r.protocolMessageKey=e.protocolMessageKey.toString());e.paymentRequestMessageKey&&(r.paymentRequestMessageKey=e.paymentRequestMessageKey.toString());return delete r.notifyName,delete r.local,delete r.isNewMsg,delete r.clearMedia,delete r.multicast,delete r.urlNumber,delete r.urlText,delete r.linkPreview,delete r.star,delete r.forwardedFromWeb,r=function(e){var t,r,n;const i={currentMsg:{},quotedMsg:{}};if(null===(t=e.paymentNoteMsg)||void 0===t?void 0:t.body){var a;i.currentMsg.paymentNoteMsgBody=e.paymentNoteMsg.body,null===(a=e.paymentNoteMsg)||void 0===a||delete a.body}(null===(r=e.quotedMsg)||void 0===r||null===(n=r.paymentNoteMsg)||void 0===n?void 0:n.body)&&(i.quotedMsg.paymentNoteMsgBody=e.quotedMsg.paymentNoteMsg.body,delete e.quotedMsg.paymentNoteMsg.body);A.forEach((t=>{i.currentMsg[t]=e[t],delete e[t]})),e.quotedMsg&&A.forEach((t=>{i.quotedMsg[t]=e.quotedMsg[t],delete e.quotedMsg[t]}));const o=(0,p.encodeProtobuf)(y.MsgRowOpaqueDataSpec,i);return e.msgRowOpaqueData=o.readBuffer(),e}(r),r},t.craftInternalId=function(e,t){const r=P(t);return`${e}_${r}_m`},t.craftMessageRangeIndex=function(e,t,r,n){let i;i=r?b.SystemMessage:t?b.IncomingChatMessage:b.Outgoing;return`${e}_${i}_${null!=n?P(n):""}`},t.endOfChat=function(e){return`${e.toString()}_g`},t.endOfMessageRange=function(e,t){return`${e.toString()}_${t}_g`},t.extractC2STimestampFromMessageRangeIndex=function(e){if(e){const t=e.split("_")[2];return t?M(t):null}return null},t.getInChatMsgId=function(e){return M(e.split("_")[1])},t.getKeyMsgsFromChatHistory=function(e,t){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND)){performance.now();const n=(0,f.getABPropConfigValue)("web_init_chat_max_unread_message_count");let i,a,o,s,l=e.unreadCount,d=0;const u=[];let p=0;const _=r=>(d++,r.type!==c.MSG_TYPE.PROTOCOL&&(r.type!==c.MSG_TYPE.REACTION&&((0,g.receiveReactionsEnabled)()&&R(r)?0!==n&&p>=n?(s||(s=r.id),o||(__LOG__(3)`[init-from-storage] getKeyMsgsFromChatHistory: Exceeded limit ${n} to find a non futureproof reaction message`,o=r),!0):(t||u.push(r),p++,!1):(s||(s=r.id),o||(o=r),a||[c.MSG_TYPE.E2E_NOTIFICATION,c.MSG_TYPE.PROTOCOL,c.MSG_TYPE.REACTION].includes(r.type)||(a=r),!t&&(null!=a||d>10)||(!(!(0===l||0!==n&&e.unreadCount>=n)||!a)||!!(l>0&&w(r)&&(l-=1,0===l))&&(i=r.id.toString(),!0))))));return(0,E.getTable)().between(["internalId"],`${e.id}_/`,`${e.id}_g`,{reverse:!0},_).then((()=>{if(u.length){(0,r(8765).o0)(u)}return{anchor:i,previewMsg:a||o,lastReceivedKey:s}}))}return Promise.resolve({anchor:void 0,previewMsg:void 0,lastReceivedKey:void 0})},t.hydrateMessage=function(e){var t;let r=(0,o.default)({},e);e.quotedMsg&&(r.quotedMsg=(0,o.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(r.quotedMsg.paymentNoteMsg=(0,o.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(r.paymentNoteMsg=(0,o.default)({},e.paymentNoteMsg));e.paymentBackground&&(r.paymentBackground=(0,o.default)({},e.paymentBackground));const n=l.default.fromString(r.id),i=r.protocolMessageKey?l.default.fromString(r.protocolMessageKey):void 0,a=r.paymentRequestMessageKey?l.default.fromString(r.paymentRequestMessageKey):void 0,c=(0,v.hydrateWids)(r);c.id=n,i&&(c.protocolMessageKey=i);a&&(c.paymentRequestMessageKey=a);return r.star=void 0!==r.isStarred,r.isMdHistoryMsg=r.rowId<C,delete r.internalId,delete r.isStarred,delete r.count,delete r.hasLink,delete r.isMediaMsg,delete r.isDocMsg,delete r.expiredTimestamp,delete r.pendingReadReceipt,r=function(e){const t=(0,u.decodeProtobuf)(y.MsgRowOpaqueDataSpec,e.msgRowOpaqueData);if(t.currentMsg){var r;if(t.currentMsg.paymentNoteMsgBody&&e.paymentNoteMsg)e.paymentNoteMsg.body=null===(r=t.currentMsg)||void 0===r?void 0:r.paymentNoteMsgBody;A.forEach((r=>{var n;e[r]=null===(n=t.currentMsg)||void 0===n?void 0:n[r]}))}e.quotedMsg&&t.quotedMsg&&(t.quotedMsg.paymentNoteMsgBody&&(e.quotedMsg.paymentNoteMsg.body=t.quotedMsg.paymentNoteMsgBody),A.forEach((r=>{var n;e.quotedMsg[r]=null===(n=t.quotedMsg)||void 0===n?void 0:n[r]})));return e}(r),r=function(e){w(e)&&e.id.fromMe&&null!=e.ack&&e.ack===s.ACK.CLOCK&&(e.isSendFailure=!0);return e}(r),r},t.isReactionFutureproof=R,t.isSecuritySensitiveMessage=function(e){var t;const r=new Map([[c.MSG_TYPE.GP2,["remove","add","ephemeral","invite","leave"]],[c.MSG_TYPE.E2E_NOTIFICATION,["encrypt","encrypt_now","e2e_identity_unavailable","identity","device"]],[c.MSG_TYPE.NOTIFICATION_TEMPLATE,["change_number","verified_initial_unknown","verified_initial_low","verified_initial_high","verified_transition_any_to_none","verified_transition_any_to_high","verified_transition_high_to_low","verified_transition_high_to_unknown","verified_transition_unknown_to_low","verified_transition_low_to_unknown","verified_transition_none_to_low","verified_transition_none_to_unknown","payment_transaction_status_update_failed","payment_transaction_status_update_refunded","payment_transaction_status_update_refund_failed","payment_transaction_status_receiver_pending_setup","payment_transaction_status_receiver_success_after_hiccup","payment_transaction_request_cancelled","payment_action_account_setup_reminder","payment_action_send_payment_reminder","payment_action_send_payment_invitation","payment_action_request_declined","payment_action_request_expired"]]]);return(null===(t=r.get(e.type))||void 0===t?void 0:t.includes(e.subtype))||!1},t.isUnreadTypeMsg=w,t.queryChatMessageHelper=function(){return O.apply(this,arguments)},t.queryChatVisibleMessageHelper=function(){return I.apply(this,arguments)},t.shouldCreateChatWithMsgs=function(e){return e.some((e=>e.type!==c.MSG_TYPE.NOTIFICATION_TEMPLATE))},t.shouldRenderInUI=D;var i=n(r(6479)),a=n(r(48926)),o=n(r(81109)),s=r(35470),l=n(r(65212)),c=r(15461),d=r(45454),u=r(84902),p=r(60980),f=r(86945),_=r(99234),h=r(7293),g=r(57701),m=r(10435),y=r(82348),E=r(90981),S=r(52489),v=r(64448);const T=["limit"],C=1e9,A=["body","caption","clientUrl","loc","lng","isLive","lat","paymentAmount1000","canonicalUrl","matchedText","title","description","futureproofBuffer"];t.MSG_OPAQUE_DATA_KEYS=A;const b=r(76672)({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"});function P(e){const t=e.toString(16);return(t.length-1).toString(16)+t}function M(e){return parseInt(e.substring(1),16)}function O(){return(O=(0,a.default)((function*(e,t,r){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND)){const n=(yield(0,E.getTable)().between(["internalId"],e,t,r)).filter((e=>D(e)));return yield N(n),n}return Promise.resolve([])}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];const{limit:s}=n,l=(0,i.default)(n,T),c=(0,f.getABPropConfigValue)("web_init_chat_max_unread_message_count");if(h.GK.supportsFeature(h.GK.F.MD_BACKEND)){const n=[];let i=0;const s=e=>null!=a&&i===a||!!D(e,o)&&(i++,i>c&&__LOG__(3)`queryChatVisibleMessageHelper: visibleMsgsCount exceeds the threshold`,!1),d=(yield(0,E.getTable)().between(["internalId"],e,t,l,s)).filter((e=>(0,g.receiveReactionsEnabled)()&&R(e)&&!o.includes(e.id.toString())?(n.push(e),!1):!!D(e,o)));if(n.length){(0,r(8765).o0)(n)}return yield N(d),d}return Promise.resolve([])}))).apply(this,arguments)}function w(e){if(e.type===c.MSG_TYPE.UNKNOWN&&"reaction"===e.subtype)return!1;const t=[c.MSG_TYPE.CHAT,c.MSG_TYPE.IMAGE,c.MSG_TYPE.VIDEO,c.MSG_TYPE.AUDIO,c.MSG_TYPE.PTT,c.MSG_TYPE.DOCUMENT,c.MSG_TYPE.VCARD,c.MSG_TYPE.LOCATION,c.MSG_TYPE.CIPHERTEXT,c.MSG_TYPE.OVERSIZED,c.MSG_TYPE.MULTI_VCARD,c.MSG_TYPE.STICKER,c.MSG_TYPE.PRODUCT,c.MSG_TYPE.GROUPS_V4_INVITE];return(0,m.isSenderRevokeUiEnabled)()||t.push(c.MSG_TYPE.REVOKED),t.includes(e.type)}function R(e){return e.type===c.MSG_TYPE.UNKNOWN&&e.subtype===c.MSG_TYPE.REACTION}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.type!==c.MSG_TYPE.REACTION&&(e.type!==c.MSG_TYPE.DEBUG&&!((0,g.receiveReactionsEnabled)()&&R(e)&&!t.includes(e.id.toString())))}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e){const t=k(e);if(0===t.length)return;const r=yield(0,S.getTable)().anyOf(["msgKey"],t.map((e=>e.id))),n=new Map,i=[];r.forEach((e=>{const t=(0,d.createWid)(e.receiverUserJid);if((0,_.getMeUser)().equals(t))return;const r=n.get(e.msgKey)||{played:0,read:0,delivery:0};null!=e.played?r.played++:null!=e.read?r.read++:null!=e.delivery&&r.delivery++,n.set(e.msgKey,r)})),t.forEach((e=>{const{ack:t,id:r}=e,a=n.get(r);if(!a)return;let o=null,l=e.count||1;0==(l-=a.played)?o=s.ACK.PLAYED:0==(l-=a.read)?o=s.ACK.READ:0==(l-=a.delivery)&&(o=s.ACK.RECEIVED),null!=o&&o>t&&(e.ack=o,i.push({id:r,ack:o})),i.length>0&&(__LOG__(2,void 0,void 0,void 0,["message-store"])`maybeUpdateMsgAck: storing ack updates ${JSON.stringify(i)}`,(0,E.getTable)().bulkCreateOrMerge(i))}))}))).apply(this,arguments)}function k(e){return e.filter((e=>{if(!w(e))return!1;if(e.type===c.MSG_TYPE.CIPHERTEXT||e.type===c.MSG_TYPE.UNKNOWN||e.ack<=s.ACK.CLOCK)return!1;const t=l.default.fromString(e.id);if(!t.fromMe)return!1;if(t.remote.isGroup()&&(null!=e.rowId&&e.rowId<C||null==e.count))return __LOG__(2,void 0,void 0,void 0,["message-store"])`getMsgMayNeedAckUpdate: skip update for history group message ${e.id}`,!1;if(e.type===c.MSG_TYPE.PTT){if(e.ack===s.ACK.PLAYED)return!1}else if(e.ack===s.ACK.READ)return!1;return!0}))}t.MessagePropertyType=b},40221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOrphanReceipt=function(e,t,r){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,a.getStorage)().lock(["orphan-receipt"],(n=>{let[i]=n;return i.bulkGet(r).then((n=>{const a=r.reduce(((r,i,a)=>{let o=n[a];o||(o={msgKey:i});const s=o[e];return(null==s||s>t)&&(o[e]=t,r.push(o)),r}),[]);return i.bulkCreateOrReplace(a)}))}));return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))},t.getOrphanReceipt=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,i.getTable)().get(e);return Promise.reject(new Error("getOrphanReceipt: not supported for non MD"))},t.removeOrphanReceipt=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,i.getTable)().remove(e);return Promise.reject(new Error("removeOrphanReceipt: not supported for non MD"))};var n=r(7293),i=r(56161),a=r(99069)},49831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyOrphanRevoke=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(15461),o=n(r(89867)),s=r(45454),l=r(7293),c=r(88851);function d(){return(d=(0,i.default)((function*(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=yield(0,c.getTable)().bulkGet(e.map((e=>String(e.id)))),r=[],n=[];return t.forEach(((t,i)=>{const l=e[i];if(null!=t){var c;if(__LOG__(2)`applyOrphanRevoke: find orphan revoke for message ${l.id.toString()}`,!o.default.isStatusV3(l.id.remote))n.push({id:l.id,to:l.to,author:l.author,revokeSender:(0,s.createWidFromWidLike)(null!==(c=t.sender)&&void 0!==c?c:l.sender),type:a.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",protocolMessageKey:l.id,from:l.from,t:l.t,broadcast:l.broadcast});r.push(t.msgKey)}else n.push(l)})),(0,c.getTable)().bulkRemove(r),n}return Promise.reject(new Error("applyOrphanRevoke: called in non-md mode"))}))).apply(this,arguments)}},43201:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.GroupUnSyncedError=void 0,t.getGroupSenderKeyList=function(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const n=e.toString();if(t=(0,l.getTable)().get(n).then((t=>{const n=[],a=[];if(!t)return{skDistribList:n,skList:a,rotateKey:!1};const{senderKey:o,rotateKey:l}=t;return Array.from(o.keys()).forEach((e=>{o.get(e)?a.push((0,i.createWid)(e)):n.push((0,i.createWid)(e))})),function(e,t){const n=r(63928).default.get(e);null!=n&&(n.cachedDeviceCount=t,n.cachedDeviceSizeBucket=(0,s.default)(t))}(e,n.length+a.length),l?{skDistribList:n.concat(a),skList:[],rotateKey:l}:{skDistribList:n,skList:a,rotateKey:l}})),!t)return Promise.reject(new Error("getGroupSenderKeyList: not supported"))}else t=Promise.reject(new Error("getGroupSenderKeyList: not supported without model storage and md backend"));return t},t.markForgetSenderKey=function(e,t){let r;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const n=e.toString();if(r=(0,c.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.get(n).then((e=>{if(e)return r.createOrReplace(u(e,t,!1));__LOG__(2)`markForgetSenderKey: group participant info missing for group ${n}`}))})),!r)return Promise.reject(new Error("markForgetSenderKey: not supported"))}else r=Promise.reject(new Error("markForgetSenderKey: not supported without model storage and md backend"));return r},t.markHasSenderKey=function(e,t){let r;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const n=e.toString();if(r=(0,c.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.get(n).then((e=>{if(e)return r.createOrReplace(u(e,t,!0));__LOG__(2)`markHasSenderKey: group participant info missing for group ${n}`}))})),!r)return Promise.reject(new Error("markHasSenderKey: not supported"))}else r=Promise.reject(new Error("markHasSenderKey: not supported without model storage and md backend"));return r};var i=r(45454),a=r(99234),o=r(7293),s=n(r(16786)),l=r(96826),c=r(99069);class d extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}function u(e,t,r){const n=new Map(e.senderKey);let i=!1;return t.forEach((e=>{if(e.equals((0,a.assertGetMe)()))return;const t=String(e);n.has(t)?n.set(t,r):i=!0})),{groupId:e.groupId,senderKey:n,participants:e.participants,admins:e.admins,rotateKey:i,deviceSyncComplete:e.deviceSyncComplete}}t.GroupUnSyncedError=d},238:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePeerMessages=function(e){const t=e.map((e=>(0,i.default)((0,i.default)({},e.toJSON()),{},{id:String(e.id),to:String(e.to)})));(0,a.getTable)().bulkCreate(t)};var i=n(r(81109)),a=r(98136)},75861:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.disallowedRowsToLists=s,t.queryDisallowedLists=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(61319);function o(){return(o=(0,i.default)((function*(){try{return s(yield(0,a.getTable)().all())}catch(e){return __LOG__(4,!0,new Error,!0)`privacy_settings_drawer: get all privacy disallowed lists failed`,SEND_LOGS("privacy_settings_drawer: get all privacy disallowed lists failed"),{status:null,groupadd:null,last:null,profile:null}}}))).apply(this,arguments)}function s(e){const t={status:null,groupadd:null,last:null,profile:null};return e.forEach((e=>{switch(e.id){case a.PrivacyDisallowedListType.About:return void(t.status=e);case a.PrivacyDisallowedListType.GroupAdd:return void(t.groupadd=e);case a.PrivacyDisallowedListType.LastSeen:return void(t.last=e);case a.PrivacyDisallowedListType.ProfilePicture:t.profile=e}})),t}},63374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.changeOrphanStateReactions=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,u.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=e.map((e=>[e,1])),i=yield(0,d.getTable)().anyOf(["parentMsgKey","orphan"],n);return i.forEach((e=>{e.orphan=0,e.orphanReason=void 0})),yield r.bulkCreateOrReplace(i),i}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("changeOrphanStateReactions: not supported for non MD"))},t.createOrUpdateReactions=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=new Map;return e.forEach((e=>{const{parentMsgKey:r,senderUserJid:n}=e;(0,o.isReactionByMe)(n)&&(e.read=!0);const i=`${r},${n}`,a=t.get(i);a?a.timestamp<=e.timestamp&&t.set(i,e):t.set(i,e)})),(0,u.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[r]=e;const n=Array.from(t.values()).map((e=>[e.parentMsgKey,e.senderUserJid]));return(yield r.anyOf(["parentMsgKey","senderUserJid"],n)).forEach((e=>{const r=`${e.parentMsgKey},${e.senderUserJid}`,n=t.get(r);n&&n.timestamp<=e.timestamp&&t.delete(r)})),yield r.bulkCreateOrReplace(Array.from(t.values())),Array.from(t.values())}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrUpdateReactions: not supported for non MD"))},t.deleteReactionsByParentMessageKey=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=[];return(0,u.getStorage)().lock(["reactions"],function(){var r=(0,a.default)((function*(r){let[n]=r;return(yield n.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),n.bulkRemove(t)}));return function(){return r.apply(this,arguments)}}())}return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.deleteReactionsByParentMessageKeys=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=[];return(0,u.getStorage)().lock(["reactions"],function(){var r=(0,a.default)((function*(r){let[n]=r;return(yield n.anyOf(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),yield n.bulkRemove(t),t.map((e=>e[0]))}));return function(){return r.apply(this,arguments)}}())}return Promise.reject(new Error("deleteReactionsByParentMessageKeys: not supported for non MD"))},t.getReactions=function(){return f.apply(this,arguments)},t.getReactionsFromParentMsg=function(){return p.apply(this,arguments)},t.markReactionRowsAsRead=function(e){return _({reactions:e,read:!0})},t.markReactionsAsReadByMessageKeysInStore=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,u.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=(yield r.anyOf(["msgKey"],e.map((e=>e.toString())))).map((e=>(0,i.default)((0,i.default)({},e),{},{read:!0})));return yield r.bulkCreateOrReplace(n),n}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.markReactionsAsReadOrOrphan=_;var i=n(r(81109)),a=n(r(48926)),o=r(67811),s=n(r(5030)),l=r(70449),c=r(7293),d=r(72821),u=r(99069);r(26704);function p(){return(p=(0,a.default)((function*(e){const t=new Map;return yield(0,u.getStorage)().lock(["reactions"],function(){var r=(0,a.default)((function*(r){let[n]=r;(yield n.anyOf(["parentMsgKey"],e)).forEach((e=>{const{reactionText:r,orphan:n}=e;if(r!==o.REVOKED_REACTION_TEXT&&1!==n){var i;const r=null!==(i=t.get(e.parentMsgKey))&&void 0!==i?i:[];r.push(e),t.set(e.parentMsgKey,r)}}))}));return function(){return r.apply(this,arguments)}}()),t}))).apply(this,arguments)}function f(){return(f=(0,a.default)((function*(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=yield(0,d.getTable)().equals(["parentMsgKey"],e),r={reactions:[],reactionByMe:null},n=new Map;t.forEach((e=>{const{reactionText:t,orphan:i}=e;if(t!==o.REVOKED_REACTION_TEXT&&1!==i){var a;const i=l.EmojiUtil.getEmojiAggregate(t),o=null!==(a=n.get(i))&&void 0!==a?a:[];n.set(i,[...o,e]);(0,s.default)(e.msgKey).fromMe&&(r.reactionByMe=e)}}));const i=r.reactionByMe?l.EmojiUtil.getEmojiAggregate(r.reactionByMe.reactionText):"";return n.forEach(((e,t)=>{let n=!1;t===i&&(n=!0),r.reactions.push({aggregateEmoji:t,senders:e,hasReactionByMe:n})})),r}return Promise.reject(new Error("getReactions: not supported for non MD"))}))).apply(this,arguments)}function _(e){let{reactions:t,read:r,orphan:n,orphanReason:o}=e;return 0===t.length?Promise.resolve():c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(0,u.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const s=t.map((e=>[e.parentMsgKey,e.senderUserJid])),l=yield a.anyOf(["parentMsgKey","senderUserJid"],s),c={};r&&(c.read=r),void 0!==n&&(c.orphan=n,void 0!==o&&(c.orphanReason=o));const d=l.map((e=>(0,i.default)((0,i.default)({},e),c)));return a.bulkCreateOrReplace(d)}));return function(){return e.apply(this,arguments)}}()):Promise.reject(new Error("markReactionsAsReadOrOrphan: not supported for non MD"))}},6331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryStatusAllMD=function(){const e=(0,c.createWid)(a.STATUS_JID);return d.DbEncKeyStore.waitForFinalDbMsgEncKey().then((()=>(0,p.queryChatMessageHelper)((0,p.beginningOfChat)(e),(0,p.endOfChat)(e),{lowerInclusive:!1,upperInclusive:!1}).then((e=>{const t=[],r=[];e.forEach((e=>{e.author?(0,o.happenedWithin)((0,o.castToUnixTime)(e.t),o.DAY_SECONDS)&&e.type!==l.MSG_TYPE.REVOKED?r.push((0,p.hydrateMessage)(e)):t.push(e.id):__LOG__(3)`Author is null for status v3 message`})),(0,u.getTable)().bulkRemove(t);const n=(0,i.default)(r,(e=>e.author.toString())),a=[];for(const e in n){const t=n[e],r=t.filter((e=>e.ack<s.ACK.READ)).length,i=t[t.length-1].t;a.push({id:(0,c.createWid)(e),unreadCount:r,totalCount:t.length,t:i,_msgs:t})}return{statuses:a}}))))};var i=n(r(7739)),a=r(52230),o=r(92844),s=r(35470),l=r(15461),c=r(45454),d=r(15998),u=r(90981),p=r(12896)},60998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTaskScheduledTime=function(e){return(0,i.getTable)().get(e).then((e=>null==e?void 0:e.time))},t.updateTaskScheduledTime=function(e,t){return(0,n.getStorage)().lock(["tasks-scheduled-time"],(r=>{let[n]=r;return n.createOrReplace({taskName:e,time:t})}))};var n=r(99069),i=r(33850)},95716:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.map((e=>e.toString()));return(0,n.getTable)().bulkGet(t)};var n=r(7528)},64448:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateWids=function e(t){if(Array.isArray(t))return t.map(((t,r)=>e((0,a.default)(r,t,i.isWidlike,i.createWidFromWidLike))));if(t&&"object"==typeof t){const r=Object.keys(t);for(let n=0;n<r.length;n++){const o=r[n];t[o]=e((0,a.default)(o,t[o],i.isWidlike,i.createWidFromWidLike))}return t}return t};var i=r(45454),a=n(r(78144))},68708:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedBusinessNameUpdateType=void 0,t.createOrUpdateVerifiedBusinessName=function(){return l.apply(this,arguments)},t.getAllVerifiedNames=function(){let e=Promise.resolve([]);e=a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(0,o.getTable)().all():Promise.reject(new Error("getAllVerifiedNames: not supported without md backend"));return e},t.hasBusinessNameVerificationChanged=function(e,t,r){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return Promise.reject(new Error("hasBusinessNameVerificationChanged: not supported without md backend"));return(0,o.getTable)().get(e.user).then((e=>!e||e.serial!==r||e.level!==t))};var i=n(r(48926)),a=r(7293),o=r(85808);const s=r(76672).Mirrored(["Replace","Merge"]);function l(){return(l=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Replace;if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))throw new Error("createOrUpdateVerifiedBusinessName: not supported without md backend");{const r=(0,o.getTable)();t===s.Replace?yield r.createOrReplace(e):yield r.createOrMerge(e.id,e)}}))).apply(this,arguments)}t.VerifiedBusinessNameUpdateType=s},76214:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={initialize:!0};t.initialize=function(){if(!i.GK.supportsFeature(i.GK.F.MD_BACKEND))return Promise.resolve();return(0,a.initializeWithoutGKs)()};var i=r(7293),a=r(23356);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},23356:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){V=null},t.destroy=function(){return(0,x.destroyStorage)().catch((()=>H.resolve(new i.default(x.DATABASE_NAME).delete()))).finally((()=>{V=null}))},Object.defineProperty(t,"getABPropConfigsTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getActiveMessageRangesTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getBlocklistTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getCartTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getChatTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getCollectionVersionTable",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getContactTable",{enumerable:!0,get:function(){return p.getTable}}),Object.defineProperty(t,"getDeviceListTable",{enumerable:!0,get:function(){return f.getTable}}),Object.defineProperty(t,"getDirectConnectionKeysTable",{enumerable:!0,get:function(){return _.getTable}}),Object.defineProperty(t,"getEncryptedMutationsTable",{enumerable:!0,get:function(){return h.getTable}}),Object.defineProperty(t,"getFavoriteStickersTable",{enumerable:!0,get:function(){return g.getTable}}),Object.defineProperty(t,"getFtsIndexingQueueTable",{enumerable:!0,get:function(){return m.getTable}}),Object.defineProperty(t,"getGroupInviteV4Table",{enumerable:!0,get:function(){return y.getTable}}),Object.defineProperty(t,"getGroupMetadataTable",{enumerable:!0,get:function(){return E.getTable}}),Object.defineProperty(t,"getHistorySyncNotificationTable",{enumerable:!0,get:function(){return S.getTable}}),Object.defineProperty(t,"getInactiveReceiptTable",{enumerable:!0,get:function(){return v.getTable}}),Object.defineProperty(t,"getLabelAssociationTable",{enumerable:!0,get:function(){return C.getTable}}),Object.defineProperty(t,"getLabelTable",{enumerable:!0,get:function(){return T.getTable}}),Object.defineProperty(t,"getMessageTable",{enumerable:!0,get:function(){return A.getTable}}),Object.defineProperty(t,"getMissingKeysTable",{enumerable:!0,get:function(){return P.getTable}}),Object.defineProperty(t,"getMsgInfoTable",{enumerable:!0,get:function(){return b.getTable}}),Object.defineProperty(t,"getOrphanPaymentNotificationTable",{enumerable:!0,get:function(){return M.getTable}}),Object.defineProperty(t,"getOrphanReceiptTable",{enumerable:!0,get:function(){return O.getTable}}),Object.defineProperty(t,"getOrphanRevokeTable",{enumerable:!0,get:function(){return I.getTable}}),Object.defineProperty(t,"getParticipantTable",{enumerable:!0,get:function(){return w.getTable}}),Object.defineProperty(t,"getPaymentBackgroundsTable",{enumerable:!0,get:function(){return R.getTable}}),Object.defineProperty(t,"getPeerMessageTable",{enumerable:!0,get:function(){return D.getTable}}),Object.defineProperty(t,"getPendingMutationsTable",{enumerable:!0,get:function(){return N.getTable}}),Object.defineProperty(t,"getPrivacyDisallowedListTable",{enumerable:!0,get:function(){return L.getTable}}),Object.defineProperty(t,"getProfilePicThumbTable",{enumerable:!0,get:function(){return k.getTable}}),Object.defineProperty(t,"getQuickReplyTable",{enumerable:!0,get:function(){return G.getTable}}),Object.defineProperty(t,"getReactionsTable",{enumerable:!0,get:function(){return U.getTable}}),Object.defineProperty(t,"getRecentStickersTable",{enumerable:!0,get:function(){return F.getTable}}),Object.defineProperty(t,"getSyncActionsTable",{enumerable:!0,get:function(){return B.getTable}}),Object.defineProperty(t,"getSyncKeysTable",{enumerable:!0,get:function(){return K.getTable}}),Object.defineProperty(t,"getTasksScheduledTimeTable",{enumerable:!0,get:function(){return j.getTable}}),Object.defineProperty(t,"getVerifiedBusinessNameTable",{enumerable:!0,get:function(){return W.getTable}}),t.initializeWithoutGKs=function(){null==V&&((0,x.createStorage)(),(0,a.addTable)(),(0,j.addTable)(),(0,p.addTable)(),(0,s.addTable)(),(0,k.addTable)(),(0,c.addTable)(),(0,A.addTable)(),(0,b.addTable)(),(0,U.addTable)(),(0,w.addTable)(),(0,O.addTable)(),(0,f.addTable)(),(0,T.addTable)(),(0,C.addTable)(),(0,v.addTable)(),(0,W.addTable)(),(0,S.addTable)(),(0,h.addTable)(),(0,G.addTable)(),(0,E.addTable)(),(0,K.addTable)(),(0,o.addTable)(),(0,m.addTable)(),(0,l.addTable)(),(0,P.addTable)(),(0,F.addTable)(),(0,g.addTable)(),(0,y.addTable)(),(0,M.addTable)(),(0,D.addTable)(),(0,I.addTable)(),(0,N.addTable)(),(0,u.addTable)(),(0,B.addTable)(),(0,L.addTable)(),(0,_.addTable)(),(0,d.addTable)(),(0,R.addTable)(),(0,Y.addTable)(),V=(0,x.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize model storage"),e})));return V};var i=n(r(86128)),a=r(32446),o=r(69702),s=r(89426),l=r(44786),c=r(68638),d=r(91314),u=r(94771),p=r(4233),f=r(60996),_=r(68259),h=r(5198),g=r(51722),m=r(44936),y=r(35884),E=r(64632),S=r(15118),v=r(71720),T=r(94337),C=r(82663),A=r(90981),b=r(52489),P=r(47274),M=r(45377),O=r(56161),I=r(88851),w=r(96826),R=r(41803),D=r(98136),N=r(87125),L=r(61319),k=r(96189),G=r(73821),U=r(72821),F=r(29953),x=r(99069),B=r(34296),K=r(63776),j=r(33850),Y=r(7528),W=r(85808);const H=r(74121).Z;let V},32446:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("abpropConfigs").version((0,s.abpropsConfigCreateTable)(),[new o.default("configCode"),new i.default("configValue"),new i.default("configExpoKey")]).version((0,s.addHasAccessedToAbpropsConfigTable)(),[new i.default("hasAccessed")]).view((e=>({configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})))},t.getTable=function(){return(0,a.getStorage)().table("abpropConfigs")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},69702:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeAction=void 0,t.addTable=function(){(0,s.getStorage)().add("active-message-ranges").version((0,l.activeMessageRangesCreateTable)(),[new o.default(["chatId","action"]),new a.default("chatId"),new i.default("actionValue"),new i.default("remainingMessages")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("active-message-ranges")};var i=n(r(79051)),a=n(r(19570)),o=n(r(54180)),s=r(99069),l=r(406);const c=Object.freeze({Unknown:"unknown",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChatKeepStarredKeepMedia:"clearChat_0_0",ClearChatKeepStarredDeleteMedia:"clearChat_0_1",ClearChatDeleteStarredKeepMedia:"clearChat_1_0",ClearChatDeleteStarredDeleteMedia:"clearChat_1_1",DeleteChatDeleteMedia:"deleteChat_1",DeleteChatKeepMedia:"deleteChat_0"});t.ActiveRangeAction=c},89426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("blocklist").version((0,o.blocklistCreateTable)(),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("blocklist")};var i=r(99069),a=n(r(89362)),o=r(406)},44786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("cart").version((0,s.cartCreateTable)(),[new o.default("id"),new i.default("products"),new i.default("message"),new i.default("total"),new i.default("currency"),new i.default("itemCount")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("cart")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},91314:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add(d).version((0,c.addChatThreadLoggingTable)(),[new s.default(["chatId","startTs"]),new o.default("chatId"),new o.default("startTs"),new a.default("msgsSent"),new a.default("msgsReceived"),new a.default("viewOnceMsgsSent"),new a.default("viewOnceMsgsReceived"),new a.default("viewOnceMessagesOpened"),new a.default("callOffersSent"),new a.default("callOffersReceived"),new a.default("totalCallDuration"),...i.COUNT_FIELD_NAMES.map((e=>new a.default(e)))]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table(d)};var i=r(61840),a=n(r(79051)),o=n(r(19570)),s=n(r(54180)),l=r(99069),c=r(406);const d="chat-thread-logging-pending-events"},68638:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("chat").version((0,c.chatCreateTable)(),[new l.default("id"),new i.default("t"),new i.default("unreadCount"),new i.default("archive"),new i.default("isReadOnly"),new i.default("isAnnounceGrpRestrict"),new i.default("modifyTag"),new i.default("muteExpiration"),new i.default("name"),new i.default("notSpam"),new i.default("pin"),new i.default("changeNumberOldJid"),new i.default("changeNumberNewJid"),new i.default("ephemeralDuration"),new i.default("ephemeralSettingTimestamp"),new i.default("unreadMsgAnchorId"),new i.default("endOfHistoryTransferType")]).version((0,c.chatAddDisappearingModeInitiator)(),[new i.default("disappearingModeInitiator")]).version((0,c.addUnreadMentionToChatTable)(),[new i.default("unreadMentionsOfMe")]).version((0,c.addUnreadMentionCountToChatTable)(),[new i.default("unreadMentionCount")]).version((0,c.addTcTokenToChatTable)(),[new a.AddEncryptedColumn("tcToken",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER)]).version((0,c.addTcTokenTimestampToChatTable)(),[new i.default("tcTokenTimestamp"),new o.default("tcTokenTimestamp")]).version((0,c.addArchiveAtMentionViewedInDrawer)(),[new i.default("archiveAtMentionViewedInDrawer")]).version((0,c.addTcTokenSenderTimestampToChatTable)(),[new i.default("tcTokenSenderTimestamp")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("chat")};var i=n(r(79051)),a=r(86445),o=n(r(19570)),s=r(99069),l=n(r(89362)),c=r(406)},94771:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("collection-version").version((0,s.collectionVersionCreateTable)(),[new o.default("collection"),new i.default("version"),new i.default("state"),new i.default("finiteFailureStartTime"),new i.default("ltHash")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("collection-version")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},4233:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("contact").version((0,l.contactCreateTable)(),[new s.default("id"),new i.default("name"),new i.default("shortName"),new i.default("pushname"),new i.default("type"),new i.default("verifiedName"),new i.default("isBusiness"),new i.default("isEnterprise"),new i.default("verifiedLevel"),new i.default("statusMute"),new i.default("sectionHeader"),new i.default("isAddressBookContact"),new a.default("isAddressBookContact")]).version((0,l.contactAddIsContactSyncCompleted)(),[new i.default("isContactSyncCompleted"),new a.default("isContactSyncCompleted")]).version((0,l.contactAddDisappearingModeProperties)(),[new i.default("disappearingModeDuration"),new i.default("disappearingModeSettingTimestamp")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("contact")};var i=n(r(79051)),a=n(r(19570)),o=r(99069),s=n(r(89362)),l=r(406)},60996:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("device-list").version((0,s.deviceListCreateTable)(),[new o.default("id"),new i.default("devices"),new i.default("nextVersion"),new i.default("rawId"),new i.default("timestamp"),new i.default("validIndexes"),new i.default("currentIndex")]).version((0,s.deviceListAddDelete)(),[new i.default("deleted")]).version((0,s.deviceListAddV2Fields)(),[new i.default("expectedTs"),new i.default("expectedTsLastDeviceJobTs"),new i.default("expectedTsUpdateTs")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("device-list")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},68259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("direct-connection-keys").version((0,s.directConnectionKeysCreateTable)(),[new o.default("id"),new i.default("certificateChain"),new i.default("cypher"),new i.default("cypherExpirationTimestamp")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("direct-connection-keys")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},5198:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("encrypted-mutations").version((0,s.encryptedMutationsCreateTable)(),[new a.default("id"),new i.default("collectionName"),new i.default("keyId"),new i.default("indexMac"),new i.default("operation"),new i.default("indexAndValueCipherText")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("encrypted-mutations")};var i=n(r(79051)),a=n(r(81674)),o=r(99069),s=r(406)},51722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("favorite-stickers").version((0,s.favoriteStickersCreateTable)(),[new o.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("stickerHashWithoutMeta")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("favorite-stickers")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},44936:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("fts-indexing-queue").version((0,o.ftsIndexingQueueCreateTable)(),[new a.default("id")]).view((e=>e))},t.getTable=function(){return(0,i.getStorage)().table("fts-indexing-queue")};var i=r(99069),a=n(r(89362)),o=r(406)},35884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("group-invite-v4").version((0,l.groupInviteV4CreateTable)(),[new s.default("id"),new i.default("from"),new i.default("to"),new i.default("groupId"),new i.default("expiration"),new i.default("expired"),new a.default(["from","to","groupId"])]).version((0,l.addGroupFromKeyToGroupInviteV4)(),[new a.default(["from","groupId"])]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("group-invite-v4")};var i=n(r(79051)),a=n(r(34654)),o=r(99069),s=n(r(89362)),l=r(406)},64632:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("group-metadata").version((0,l.groupMetadataCreateTable)(),[new s.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("creation"),new i.default("owner"),new i.default("desc"),new i.default("descId"),new i.default("descTime"),new i.default("descOwner"),new i.default("restrict"),new i.default("announce"),new i.default("a_v_id"),new i.default("noFrequentlyForwarded"),new i.default("ephemeralDuration"),new i.default("size"),new i.default("support"),new i.default("suspended"),new i.default("notAddedByContact"),new i.default("addedBy"),new i.default("parentGroup"),new i.default("subgroups"),new i.default("isParentGroup"),new i.default("defaultSubgroup"),new i.default("growthLockExpiration"),new i.default("growthLockType")]).version((0,l.migrateSubgroupsArray)(),[new a.default("subgroups"),new i.default("unjoinedSubgroups")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("group-metadata")};var i=n(r(79051)),a=n(r(23263)),o=r(99069),s=n(r(89362)),l=r(406)},15118:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("history-sync-notification").version((0,c.historySyncNotificationsCreateTable)(),[new l.default("msgKey"),new i.default("downloadOptions"),new i.default("syncType"),new a.AddEncryptedColumn("chunkEncryptionKey",a.ENCRYPTED_VALUE_TYPE.STRING),new i.default("chunkOrder"),new i.default("processed"),new o.default("syncType"),new o.default("chunkOrder"),new o.default("processed"),new i.default("isReupload"),new i.default("historySyncStepStartedTs"),new i.default("historySyncPayloadSize"),new i.default("reuploadPending")]).version((0,c.encryptHistorySyncDirectPath)(),[new a.AddEncryptedColumn("directPath",a.ENCRYPTED_VALUE_TYPE.STRING)]).version((0,c.encryptHistorySyncFilehash)(),[new a.AddEncryptedColumn("filehash",a.ENCRYPTED_VALUE_TYPE.STRING),new a.AddEncryptedColumn("encFilehash",a.ENCRYPTED_VALUE_TYPE.STRING)]).view((e=>e)).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,s.getStorage)().table("history-sync-notification")};var i=n(r(79051)),a=r(86445),o=n(r(19570)),s=r(99069),l=n(r(89362)),c=r(406)},71720:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("inactive-receipt").version((0,s.inactiveReceiptCreateTable)(),[new o.default("msgId"),new i.default("chatId"),new i.default("participantId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("inactive-receipt")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},82663:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelAssociationType=void 0,t.addTable=function(){(0,s.getStorage)().add("label-association").version((0,l.labelAssociationCreateTable)(),[new o.default(["labelId","associationId","type"]),new a.default("labelId"),new i.default(["associationId","type"])]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("label-association")};var i=n(r(34654)),a=n(r(19570)),o=n(r(54180)),s=r(99069),l=r(406);const c=r(76672)({Jid:"jid",Message:"message"});t.LabelAssociationType=c},94337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("label").version((0,s.labelCreateTable)(),[new o.default("id"),new i.default("name"),new i.default("colorIndex"),new i.default("predefinedId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("label")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},52489:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("message-info").version((0,l.messageInfoCreateTable)(),[new o.default(["msgKey","receiverUserJid"]),new i.default("delivery"),new i.default("read"),new i.default("played"),new i.default("deviceDelivered"),new i.default("deviceNotDelivered"),new a.default("msgKey")]).version((0,l.messageInfoAddDeliveryPrivacyMode)(),[new i.default("deliveryPrivacyMode")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("message-info")};var i=n(r(79051)),a=n(r(19570)),o=n(r(54180)),s=r(99069),l=r(406)},90981:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,u.getStorage)().add("message").version((0,f.messageCreateTable)(),[new p.default("id"),new a.default("internalId"),new c.default("internalId"),new a.default("rowId"),new c.default("rowId"),new a.default("type"),new a.default("subtype"),new a.default("t"),new a.default("notifyName"),new a.default("from"),new a.default("to"),new a.default("author"),new a.default("self"),new a.default("ack"),new a.default("invis"),new a.default("isStarred"),new l.default("isStarred"),new a.default("mentionedJidList"),new a.default("count"),new a.default("devicesAdded"),new a.default("devicesRemoved"),new a.default("isThisDeviceAdded"),new a.default("recipients"),new a.default("protocolMessageKey"),new a.default("protocolMessageRowId"),new a.default("templateParams"),new o.default(["internalId","isStarred"]),new a.default("vcardWAids"),new i.default("vcardWAids"),new a.default("hasLink"),new a.default("isMediaMsg"),new a.default("isDocMsg"),new o.default(["internalId","isMediaMsg"]),new o.default(["internalId","isDocMsg"]),new o.default(["internalId","hasLink"]),new a.default("ephemeralStartTimestamp"),new a.default("ephemeralDuration"),new a.default("ephemeralSettingTimestamp"),new a.default("ephemeralOutOfSync"),new a.default("expiredTimestamp"),new l.default("expiredTimestamp"),new a.default("directPath"),new a.default("mimetype"),new a.default("duration"),new a.default("filehash"),new a.default("uploadhash"),new a.default("size"),new a.default("filename"),new a.default("streamingSidecar"),new a.default("mediaKey"),new a.default("mediaKeyTimestamp"),new a.default("pageCount"),new a.default("isGif"),new a.default("gifAttribution"),new a.default("isViewOnce"),new a.default("width"),new a.default("height"),new a.default("scanLengths"),new a.default("scansSidecar"),new a.default("interactiveAnnotations"),new a.default("firstFrameLength"),new a.default("firstFrameSidecar"),new a.default("isAnimated"),new a.default("thumbnail"),new a.default("richPreviewType"),new a.default("doNotPlayInline"),new a.default("broadcast"),new a.default("broadcastParticipants"),new a.default("broadcastId"),new a.default("quotedMsg"),new a.default("quotedStanzaID"),new a.default("quotedRemoteJid"),new a.default("quotedParticipant"),new a.default("footer"),new a.default("hydratedButtons"),new a.default("selectedId"),new a.default("selectedIndex"),new a.default("vcardFormattedName"),new a.default("isVcardOverMmsDocument"),new a.default("businessOwnerJid"),new a.default("productId"),new a.default("currencyCode"),new a.default("priceAmount1000"),new a.default("retailerId"),new a.default("url"),new a.default("productImageCount"),new a.default("paymentCurrency"),new a.default("paymentMessageReceiverJid"),new a.default("paymentTransactionTimestamp"),new a.default("paymentStatus"),new a.default("paymentNoteMsg"),new a.default("paymentRequestMessageKey"),new a.default("paymentExpiryTimestamp"),new a.default("message"),new a.default("orderTitle"),new a.default("itemCount"),new a.default("orderId"),new a.default("surface"),new a.default("status"),new a.default("token"),new a.default("textColor"),new a.default("backgroundColor"),new a.default("font"),new a.default("isForwarded"),new a.default("forwardingScore"),new a.default("ctwaContext"),new a.default("mdDowngrade"),new a.default("messageRangeIndex"),new l.default("messageRangeIndex"),new a.default("vcardList"),new a.default("totalAmount1000"),new a.default("totalCurrencyCode"),new a.default("list"),new a.default("listResponse"),new a.default("isDynamicReplyButtonsMsg"),new a.default("dynamicReplyButtons"),new a.default("selectedButtonId"),new a.default("sellerJid"),new a.default("deprecatedMms3Url"),new a.default("encFilehash"),new s.AddEncryptedColumn("msgRowOpaqueData",s.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new a.default("thumbnailDirectPath"),new a.default("thumbnailSha256"),new a.default("thumbnailEncSha256"),new a.default("thumbnailHeight"),new a.default("thumbnailWidth"),new a.default("revokeSender"),new a.default("pendingReadReceipt"),new o.default(["from","pendingReadReceipt"]),new a.default("inviteGrpType"),new a.default("quotedGroupSubject"),new a.default("quotedParentGroupJid"),new a.default("reactionParentKey"),new a.default("reactionTimestamp"),new a.default("reactionText"),new a.default("lastPlaybackProgress"),new a.default("hasReaction")]).version((0,f.messageAddIsSendFailureProperties)(),[new a.default("isSendFailure")]).version((0,f.messageAddPaymentTxnStatus)(),[new a.default("paymentTxnStatus")]).version((0,f.messageAddProductListPreviewInfo)(),[new a.default("productListItemCount")]).version((0,f.messageAddPrivacyModeFields)(),[new a.default("privacyModeWhenSent"),new a.default("bizPrivacyStatus")]).version((0,f.messageAddProductListPreviewHeaderImage)(),[new a.default("productHeaderImageRejected")]).version((0,f.messageAddDisappearingModeInitiator)(),[new a.default("disappearingModeInitiator")]).version((0,f.messageAddGroupInviteV4)(),[new a.default("inviteGrp"),new a.default("inviteGrpName"),new a.default("comment"),new a.default("inviteCode"),new a.default("inviteCodeExp")]).version((0,f.addSupportForHSMButtons)(),[new a.default("isFromTemplate")]).version((0,f.messageAddPaymentRequestNFMFields)(),[new a.default("nativeFlowButtons"),new a.default("paymentRequestHeader")]).version((0,f.addWaveformToAudioMessages)(),[new a.default("waveform")]).version((0,f.messageRemovePaymentRequestHeaderField)(),[new d.default("paymentRequestHeader")]).version((0,f.messageAddNativeFlowNameField)(),[new a.default("nativeFlowName")]).version((0,f.addStaticURLToImageVideoMessages)(),[new a.default("staticUrl")]).version((0,f.addRequiresDirectConnection)(),[new a.default("requiresDirectConnection")]).version((0,f.messageAddPaymentInviteServiceType)(),[new a.default("paymentInviteServiceType")]).version((0,f.addStatusPSACampaignFields)(),[new a.default("campaignId"),new a.default("campaignDuration")]).version((0,f.messageAddPaymentBackground)(),[new a.default("paymentBackground")]).version((0,f.messageAddInteractiveMessageFields)(),[new a.default("interactiveHeader"),new a.default("interactiveType"),new a.default("interactivePayload")]).version((0,f.messageAddActionLink)(),[new a.default("actionLink")]).version((0,f.messageAddHeaderType)(),[new a.default("headerType")]).version((0,f.messageStatusPSAReadTimestamp)(),[new a.default("statusPSAReadTimestamp")]).view((e=>e)).enablePropFilter(!0).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,u.getStorage)().table("message")};var i=n(r(92061)),a=n(r(79051)),o=n(r(34654)),s=r(86445),l=n(r(19570)),c=n(r(39043)),d=n(r(23263)),u=r(99069),p=n(r(89362)),f=r(406)},47274:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("missing-keys").version((0,s.missingKeysCreateTable)(),[new o.default("keyHex"),new i.default("keyId"),new i.default("timestamp"),new i.default("deviceResponses")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("missing-keys")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},45377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-payment-notification").version((0,s.orphanPaymentNotificationCreateTable)(),[new o.default("msgKey"),new i.default("receiver"),new i.default("currency"),new i.default("amount1000"),new i.default("type"),new i.default("status"),new i.default("ts")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-payment-notification")};var i=n(r(79051)),a=(r(52586),r(99069)),o=n(r(89362)),s=r(406)},56161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-receipt").version((0,s.orphanReceiptCreateTable)(),[new o.default("msgKey"),new i.default("delivery"),new i.default("read"),new i.default("played")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-receipt")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},88851:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-revoke").version((0,s.orphanRevokeCreateTable)(),[new o.default("msgKey"),new i.default("sender"),new i.default("timestamp"),new i.default("subtype")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-revoke")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},96826:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("participant").version((0,l.participantCreateTable)(),[new s.default("groupId"),new a.default("senderKey"),new a.default("participants"),new a.default("admins"),new a.default("rotateKey"),new a.default("version"),new i.default("participants"),new a.default("deviceSyncComplete")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("participant")};var i=n(r(92061)),a=n(r(79051)),o=r(99069),s=n(r(89362)),l=r(406)},41803:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("payment-backgrounds").version((0,s.paymentBackgroundsCreateTable)(),[new o.default("id"),new i.default("imageBuffer")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("payment-backgrounds")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},98136:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("peer-message").version((0,s.peerMessageCreateTable)(),[new o.default("id"),new i.default("to"),new i.default("type"),new i.default("subtype"),new i.default("appStateSyncKeyShare"),new i.default("appStateSyncKeyRequest"),new i.default("appStateFatalExceptionNotification")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("peer-message")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},87125:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("pending-mutations").version((0,l.pendingMutationsCreateTable)(),[new o.default("id"),new i.default("collection"),new i.default("index"),new a.default("index"),new i.default("timestamp"),new a.default("collection"),new i.default("version"),new i.default("operation"),new i.default("binarySyncAction")]).version((0,l.addActionToPendingMutations)(),[new i.default("action"),new a.default("action")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("pending-mutations")};var i=n(r(79051)),a=n(r(19570)),o=n(r(81674)),s=r(99069),l=r(406)},61319:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyDisallowedListType=void 0,t.addTable=function(){(0,a.getStorage)().add("privacy-disallowed-list").version((0,s.privacyDisallowedListCreateTable)(),[new o.default("id"),new i.default("disallowedList")]).version((0,s.privacyDisallowedListAddDhashField)(),[new i.default("dhash")]).view((e=>({id:e.id,disallowedList:e.disallowedList,dhash:e.dhash})))},t.getTable=function(){return(0,a.getStorage)().table("privacy-disallowed-list")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406);const l=r(76672)({About:"status",GroupAdd:"groupadd",LastSeen:"last",ProfilePicture:"profile"});t.PrivacyDisallowedListType=l},96189:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("profile-pic-thumb").version((0,s.profilePicThumbCreateTable)(),[new o.default("id"),new i.default("tag"),new i.default("raw"),new i.default("eurl"),new i.default("previewEurl")]).view((e=>({id:e.id,tag:e.tag,raw:e.raw,eurl:e.eurl,previewEurl:e.previewEurl})))},t.getTable=function(){return(0,a.getStorage)().table("profile-pic-thumb")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},73821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("quick-reply").version((0,s.quickReplyCreateTable)(),[new o.default("id"),new i.default("shortcut"),new i.default("message"),new i.default("count"),new i.default("keywords")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("quick-reply")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},72821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("reactions").version((0,c.reactionsCreateTable)(),[new s.default(["parentMsgKey","senderUserJid"]),new i.default("msgKey"),new i.default("reactionText"),new i.default("timestamp"),new i.default("orphan"),new i.default("orphanReason"),new i.default("read"),new o.default("parentMsgKey"),new o.default("orphan")]).version((0,c.addReactionTableOrphanIndex)(),[new a.default(["parentMsgKey","orphan"])]).version((0,c.addReactionTableMsgKeyIndex)(),[new o.default("msgKey")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("reactions")};var i=n(r(79051)),a=n(r(34654)),o=n(r(19570)),s=n(r(54180)),l=r(99069),c=(r(26704),r(406))},29953:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("recent-stickers").version((0,s.recentStickersCreateTable)(),[new o.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("msgId"),new i.default("weight")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("recent-stickers")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},34296:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("sync-actions").version((0,c.syncActionsCreateTable)(),[new l.default("index"),new i.default("keyId"),new i.default("version"),new i.default("actionState"),new o.default("actionState"),new i.default("modelId"),new i.default("modelType"),new a.default(["modelId","modelType","actionState"]),new i.default("valueMac"),new i.default("indexMac"),new o.default("indexMac"),new i.default("collection"),new o.default("collection"),new i.default("timestamp"),new i.default("action"),new o.default("action"),new i.default("binarySyncAction"),new i.default("binarySyncData")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("sync-actions")};var i=n(r(79051)),a=n(r(34654)),o=n(r(19570)),s=r(99069),l=n(r(89362)),c=r(406)},63776:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("sync-keys").version((0,c.syncKeysCreateTable)(),[new l.default("keyId"),new i.default("timestamp"),new i.default("fingerprint"),new a.AddEncryptedColumn("keyData",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("keyEpoch"),new o.default("keyEpoch")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("sync-keys")};var i=n(r(79051)),a=r(86445),o=n(r(19570)),s=r(99069),l=n(r(89362)),c=r(406)},33850:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("tasks-scheduled-time").version((0,s.tasksScheduledTimeCreateTable)(),[new o.default("taskName"),new i.default("time")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("tasks-scheduled-time")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},26704:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrphanReactionsReasonType=void 0;const n=r(76672).Mirrored(["ParentMsgPlaceholder","ParentMsgMissing"]);t.OrphanReactionsReasonType=n},7528:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("unjoined-subgroup-metadata").version((0,s.unjoinedSubgroupMetadataCreateTable)(),[new o.default("id"),new i.default("subject"),new i.default("subjectTime")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("unjoined-subgroup-metadata")};var i=n(r(79051)),a=r(99069),o=n(r(89362)),s=r(406)},85808:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("verified-business-name").version((0,l.verifiedBusinessNameCreateTable)(),[new s.default("id"),new i.default("serial"),new i.default("name"),new i.default("isApi"),new i.default("level"),new i.default("actualActors"),new i.default("hostStorage"),new i.default("privacyModeTs")]).version((0,l.verifiedBusinessNameAddPrivacyMode)(),[new i.default("privacyMode"),new a.default("actualActors"),new a.default("hostStorage"),new a.default("privacyModeTs")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("verified-business-name")};var i=n(r(79051)),a=n(r(23263)),o=r(99069),s=n(r(89362)),l=r(406)},99069:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[model-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[model-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="model-storage";t.DATABASE_NAME=c;let d=null},36163:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.restoreArchiveV2Settings=function(){if((0,O.archiveV2Supported)()){const e=(0,x.getArchiveV2EnabledSetting)(),t=(0,x.getUnarchiveChatsSetting)();null!=e&&(X.default.archive=(0,a.default)((0,a.default)({},X.default.archive),{},{enabled:e})),null!=t&&(X.default.archive=(0,a.default)((0,a.default)({},X.default.archive),{},{classic:t}))}},t.restoreBlocklist=function(){return(0,u.getTable)().all().then((e=>{p.BlocklistCollection.initializeFromCache(e.map(te.hydrateWids))}))},t.restoreCarts=function(){if((0,O.cartPropEnabled)())return(0,_.getTable)().all().then((e=>{h.CartCollection.initializeFromCache(e.map(te.hydrateWids))}));return Promise.resolve()},t.restoreChatsAndMessages=function(){return ce.apply(this,arguments)},t.restoreFavoriteStickers=function(){if(M.GK.supportsFeature(M.GK.F.MD_BACKEND)&&(0,d.getABPropConfigValue)("sticker_md_favorite_stickers_enabled"))return(0,A.getTable)().all().then((e=>b.default.initializeFromCache(e)));return Promise.resolve()},t.restoreGroupParticipants=function(){const e=R.default.filter((e=>0===e.participants.length)).map((e=>e.id.toString()));if(0!==e.length)return(0,j.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{if(null==e)return Promise.resolve();const t=R.default.get(e.groupId);if(null!=t){const r=new Set(e.admins),n=e.participants.map((e=>new Y.default({id:(0,c.createUserWid)(e),isAdmin:r.has(e),isSuperAdmin:!1})));t.participants.add(n,{merge:!0})}}))}));return Promise.resolve()},t.restoreGroupsContactsAndProfilePics=function(){return(0,D.initializeWithoutGKs)().then((()=>{performance.now();const e=(0,S.getTable)().all().then((e=>{v.ContactCollection.checksum=(0,U.getContactChecksum)()||"",v.ContactCollection.add(e.map(te.hydrateWids),{silent:!0,merge:!0})})),t=(0,w.getTable)().all().then((e=>{R.default.add(e.map(te.hydrateWids)),e.forEach((e=>{(0,V.updateSubject)((0,c.createWidFromWidLike)(e.id),e.subject),(0,I.updatePendingParticipants)((0,c.createWidFromWidLike)(e.id))}))})),r=(0,W.getTable)().all().then((e=>{H.ProfilePicThumbCollection.add(e.map(te.hydrateWids),{silent:!0})}));return Promise.all([e,t,r])})).then((()=>{}))},t.restoreImportantMetaData=function(){__LOG__(2)`[InitFromStorage] will attempt to initialize metadata from storage`,E.Conn.trigger("me_ready");const e=(0,P.getPushname)(),t=(0,P.getLastMobilePlatform)();if(null==t)throw new Error("platform not found in UserPrefs.");E.Conn.pushname=e,E.Conn.platform=t,__LOG__(2)`[InitFromStorage] important metadata loaded`},t.restoreLabelAssociations=function(){if((0,O.canDisplayLabel)())return(0,L.getTable)().all().then((e=>{k.LabelCollection.initializeAssociationsFromCache(e)}));return Promise.resolve()},t.restoreLabels=function(){if((0,O.canDisplayLabel)())return(0,N.getTable)().all().then((e=>{k.LabelCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreQuickReplies=function(){if((0,O.canSendQuickReply)())return(0,$.getTable)().all().then((e=>{z.QuickReplyCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreRecentStickers=function(){if(M.GK.supportsFeature(M.GK.F.MD_BACKEND)&&Q.ServerProps.webServerStickerPanel)return(0,q.getTable)().all().then((e=>J.RecentStickerCollectionMd.initializeFromCache(e)));return Promise.resolve()},t.updateGKFeatures=function(){M.GK.supportsFeature(M.GK.F.MD_BACKEND)&&((0,U.setGKProto)(M.GK.proto),(0,U.setGKFeatures)(M.GK.features))};var i=n(r(48926)),a=n(r(81109)),o=r(27870),s=r(92844),l=n(r(65212)),c=r(45454),d=r(86945),u=r(89426),p=r(32826),f=r(93170),_=r(44786),h=r(12392),g=r(68638),m=r(69951),y=r(51612),E=r(17239),S=r(4233),v=r(19380),T=r(15998),C=r(1973),A=r(51722),b=n(r(70723)),P=r(99234),M=r(7293),O=r(57701),I=r(62415),w=r(64632),R=n(r(63928)),D=r(23356),N=r(94337),L=r(82663),k=r(16770),G=r(90981),U=r(50313),F=r(59871),x=r(58052),B=r(29731),K=r(97480),j=r(96826),Y=n(r(45077)),W=r(96189),H=r(82039),V=r(10790),$=r(73821),z=r(99662),q=r(29953),J=r(49264),Q=r(64551),X=n(r(68132)),Z=r(12896),ee=r(134),te=r(64448),re=r(85808);r(79038);function ne(e){return null!=e.t&&(0,s.happenedWithin)((0,s.castToUnixTime)(e.t),s.DAY_SECONDS)||null!=e.pin&&e.pin>0}function ie(e){return Promise.all(e.map((e=>{const t=ne(e);return(0,Z.getKeyMsgsFromChatHistory)(e,t).then((r=>{let{anchor:n,previewMsg:i,lastReceivedKey:o}=r;return{chat:(0,a.default)((0,a.default)({},e),{},{unreadMsgAnchorId:t?n:void 0}),previewMsg:i,lastReceivedKey:o}}))})))}function ae(e){const{tasks:t,lastMessageKeys:r}=function(e){const t=[],r=[];return e.forEach((e=>{let{chat:n,previewMsg:i,lastReceivedKey:o}=e;ne(n)||i&&i.id!==o?(performance.now(),t.push(function(e,t){if(ne(e)){if(e.unreadCount>=20)return oe(e,t).then((()=>function(e){if(!e.unreadMsgAnchorId)return __LOG__(3)`unreadMsgAnchorId is not defined`,Promise.resolve();return(0,G.getTable)().equals(["id"],e.unreadMsgAnchorId).then((t=>{if(0===t.length)return void __LOG__(3)`Unread anchor message does not exist in message table`;const r=(0,Z.getInChatMsgId)(t[0].internalId||""),n=Math.max(0,r-5);let i;if((0,O.receiveReactionsEnabled)()){const t=function(e,t){const r=(0,Z.beginningOfChat)((0,c.createWid)(e.id)),n=(0,Z.craftInternalId)(e.id,t);return(0,Z.queryChatVisibleMessageHelper)(r,n,(0,a.default)((0,a.default)({},{lowerInclusive:!0,upperInclusive:!1}),{},{reverse:!0}),5).then((e=>e.reverse()))}(e,r),n=function(e,t){return(0,Z.queryChatVisibleMessageHelper)((0,Z.craftInternalId)(e.id,t),(0,Z.endOfChat)((0,c.createWid)(e.id)),{lowerInclusive:!0,upperInclusive:!1},5)}(e,r);i=Promise.all([t,n]).then((e=>{let[t,r]=e;return[...t,...r]}))}else i=(0,Z.queryChatMessageHelper)((0,Z.craftInternalId)(e.id,n),(0,Z.craftInternalId)(e.id,r+5),{lowerInclusive:!0,upperInclusive:!1});return i.then((t=>{if(t.length-5<0)return;const r=t[t.length-5].id,n=t.map((e=>{const t=(0,Z.hydrateMessage)(e);return t.invis=!0,t}));return F.MsgCollection.processMultipleMessages((0,c.createWidFromWidLike)(e.id),n,{pendingMsgsDone:!0,resume:!1,add:"unread",isHistory:!0,firstUnreadKey:l.default.fromString(r)},new y.ChatMsgsCollection)})).then()}))}(e)));if(0===e.unreadCount)return oe(e,t);let r;if(__LOG__(2)`restoreMessagesForChat: restoring last ${e.unreadCount+5} messages.`,(0,O.receiveReactionsEnabled)()){const n=[];t&&(0,Z.isReactionFutureproof)(t)&&n.push(t.id.toString()),r=(0,Z.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},e.unreadCount+5,n)}else r=(0,Z.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:e.unreadCount+5});return r.then((t=>F.MsgCollection.processMultipleMessages((0,c.createWidFromWidLike)(e.id),t.map(Z.hydrateMessage).reverse(),{pendingMsgsDone:!0,resume:!1,add:"last",isHistory:!0}))).then()}return oe(e,t)}(n,i).then((()=>{if(n.unreadMsgAnchorId){const e=l.default.fromString(n.unreadMsgAnchorId),t=F.MsgCollection.get(e);if(!t)return void __LOG__(3)`Unread anchor message is not in message collection.`;const r=m.ChatCollection.get((0,c.createWidFromWidLike)(n.id));r&&(r.unreadMsgAnchor=t)}})))):r.push(String(o))})),{tasks:t,lastMessageKeys:r}}(e);return t.push(function(e){return performance.now(),(0,G.getTable)().bulkGet(e).then(function(){var e=(0,i.default)((function*(e){yield Promise.all(e.map((e=>{if(!e)return Promise.resolve();const t=(0,Z.hydrateMessage)(e);return t.invis=!0,F.MsgCollection.processMultipleMessages(t.id.remote,[t],{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})})))}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw __LOG__(4,void 0,new Error)`loadLastMessagesFromDB: failed with error: ${e}`,e}))}(r)),Promise.all(t)}function oe(){return se.apply(this,arguments)}function se(){return(se=(0,i.default)((function*(e,t){let r;const n=[];if(null!=t&&null!=t.internalId){const i=t.internalId;(0,O.receiveReactionsEnabled)()?(t&&(0,Z.isReactionFutureproof)(t)&&n.push(t.id.toString()),r=yield(0,Z.queryChatVisibleMessageHelper)(i,`${e.id}_g`,{lowerInclusive:!0},void 0,n)):r=yield(0,Z.queryChatMessageHelper)(i,`${e.id}_g`,{lowerInclusive:!0})}else{const t=1;r=(0,O.receiveReactionsEnabled)()?yield(0,Z.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},t):yield(0,Z.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:t})}__LOG__(2)`processPreviewMessageInChat: restoring ${r.length} message.`,F.MsgCollection.processMultipleMessages((0,c.createWidFromWidLike)(e.id),r.map((e=>{const t=(0,Z.hydrateMessage)(e);return t.invis=!0,t})),{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})}))).apply(this,arguments)}function le(e){switch(e){case"unknown":return f.VERIFIED_LEVEL.UNKNOWN;case"low":return f.VERIFIED_LEVEL.LOW;case"high":return f.VERIFIED_LEVEL.HIGH;default:return f.VERIFIED_LEVEL.UNKNOWN}}function ce(){return(ce=(0,i.default)((function*(){return yield T.DbEncKeyStore.waitForFinalDbMsgEncKey(),(0,D.initializeWithoutGKs)().then(ee.updatePeerReceipts).then((0,i.default)((function*(){const e=yield(0,g.getTable)().all();M.GK.supportsFeature(M.GK.F.MD_BACKEND)&&K.OfflineResumeReporter.logOfflineChatThreadCount(e.length),e.sort(((e,t)=>{var r,n;return-((null!==(r=e.t)&&void 0!==r?r:0)-(null!==(n=t.t)&&void 0!==n?n:0))})),m.ChatCollection.add(e.map((e=>(0,te.hydrateWids)((0,a.default)((0,a.default)({},e),{},{pendingInitialLoading:!0})))),{merge:!0});const t=(0,d.getABPropConfigValue)("web_init_chat_batch_size")||100;return yield de(e,t)}))).then(ue).catch((e=>{throw __LOG__(4,void 0,new Error)`restoreChatsAndMessages: failed with error: ${e}`,e}))}))).apply(this,arguments)}function de(e,t){let r=Promise.resolve();const n=new o.PromiseQueue;for(let a=0;a<e.length;a+=t){const o=e.slice(a,a+t),s=function(){var e=(0,i.default)((function*(){performance.now();const e=yield ie(o);yield ae(e),e.forEach((e=>{let{chat:t}=e;const r=m.ChatCollection.get(t.id);r&&r.set({pendingInitialLoading:!1})}))}));return function(){return e.apply(this,arguments)}}();0===a?r=n.enqueue((()=>new B.NonPersistJob("initialChatLoad",s,{priority:C.JOB_PRIORITY.SKIP}).waitUntilCompleted())):n.enqueue((()=>new B.NonPersistJob("initialChatLoad",s).waitUntilCompleted()))}return r}function ue(){return pe.apply(this,arguments)}function pe(){return(pe=(0,i.default)((function*(){(yield(0,re.getTable)().all()).forEach((e=>{let t;try{t=(0,c.createUserWid)(e.id)}catch(e){return __LOG__(4,void 0,new Error,!0)`restore-business-info: invalid wid`,void SEND_LOGS("restore-business-info: invalid wid")}const r=m.ChatCollection.get(t);if(r){const t={isBusiness:!0,isEnterprise:e.isApi,verifiedName:e.name,verifiedLevel:le(e.level||"unknown"),privacyMode:e.privacyMode};r.contact.set(t),"high"===e.level&&e.name&&!r.contact.name&&r.contact.set({name:e.name})}}))}))).apply(this,arguments)}},406:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abpropsConfigCreateTable=function(){return(0,n.getStorage)().versions.version(19)},t.activeMessageRangesCreateTable=function(){return(0,n.getStorage)().versions.version(23)},t.addActionToPendingMutations=function(){return(0,n.getStorage)().versions.version(48)},t.addArchiveAtMentionViewedInDrawer=function(){return(0,n.getStorage)().versions.version(61)},t.addChatThreadLoggingTable=function(){return(0,n.getStorage)().versions.version(78)},t.addGroupFromKeyToGroupInviteV4=function(){return(0,n.getStorage)().versions.version(55)},t.addHasAccessedToAbpropsConfigTable=function(){return(0,n.getStorage)().versions.version(77)},t.addReactionTableMsgKeyIndex=function(){return(0,n.getStorage)().versions.version(75)},t.addReactionTableOrphanIndex=function(){return(0,n.getStorage)().versions.version(71)},t.addRequiresDirectConnection=function(){return(0,n.getStorage)().versions.version(63)},t.addStaticURLToImageVideoMessages=function(){return(0,n.getStorage)().versions.version(60)},t.addStatusPSACampaignFields=function(){return(0,n.getStorage)().versions.version(65)},t.addSupportForHSMButtons=function(){return(0,n.getStorage)().versions.version(46)},t.addTcTokenSenderTimestampToChatTable=function(){return(0,n.getStorage)().versions.version(62)},t.addTcTokenTimestampToChatTable=function(){return(0,n.getStorage)().versions.version(57)},t.addTcTokenToChatTable=function(){return(0,n.getStorage)().versions.version(56)},t.addUnreadMentionCountToChatTable=function(){return(0,n.getStorage)().versions.version(51)},t.addUnreadMentionToChatTable=function(){return(0,n.getStorage)().versions.version(44)},t.addWaveformToAudioMessages=function(){return(0,n.getStorage)().versions.version(50)},t.blocklistCreateTable=function(){return(0,n.getStorage)().versions.version(4)},t.cartCreateTable=function(){return(0,n.getStorage)().versions.version(25)},t.chatAddDisappearingModeInitiator=function(){return(0,n.getStorage)().versions.version(36)},t.chatCreateTable=function(){return(0,n.getStorage)().versions.version(6)},t.collectionVersionCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.contactAddDisappearingModeProperties=function(){return(0,n.getStorage)().versions.version(35)},t.contactAddIsContactSyncCompleted=function(){return(0,n.getStorage)().versions.version(28)},t.contactCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.deviceListAddDelete=function(){return(0,n.getStorage)().versions.version(41)},t.deviceListAddV2Fields=function(){return(0,n.getStorage)().versions.version(59)},t.deviceListCreateTable=function(){return(0,n.getStorage)().versions.version(11)},t.directConnectionKeysCreateTable=function(){return(0,n.getStorage)().versions.version(70)},t.encryptHistorySyncDirectPath=function(){return(0,n.getStorage)().versions.version(42)},t.encryptHistorySyncFilehash=function(){return(0,n.getStorage)().versions.version(45)},t.encryptedMutationsCreateTable=function(){return(0,n.getStorage)().versions.version(15)},t.favoriteStickersCreateTable=function(){return(0,n.getStorage)().versions.version(73)},t.ftsIndexingQueueCreateTable=function(){return(0,n.getStorage)().versions.version(24)},t.groupInviteV4CreateTable=function(){return(0,n.getStorage)().versions.version(39)},t.groupMetadataCreateTable=function(){return(0,n.getStorage)().versions.version(20)},t.historySyncNotificationsCreateTable=function(){return(0,n.getStorage)().versions.version(14)},t.inactiveReceiptCreateTable=function(){return(0,n.getStorage)().versions.version(12)},t.labelAssociationCreateTable=function(){return(0,n.getStorage)().versions.version(17)},t.labelCreateTable=function(){return(0,n.getStorage)().versions.version(16)},t.messageAddActionLink=function(){return(0,n.getStorage)().versions.version(72)},t.messageAddDisappearingModeInitiator=function(){return(0,n.getStorage)().versions.version(37)},t.messageAddGroupInviteV4=function(){return(0,n.getStorage)().versions.version(38)},t.messageAddHeaderType=function(){return(0,n.getStorage)().versions.version(74)},t.messageAddInteractiveMessageFields=function(){return(0,n.getStorage)().versions.version(69)},t.messageAddIsSendFailureProperties=function(){return(0,n.getStorage)().versions.version(27)},t.messageAddNativeFlowNameField=function(){return(0,n.getStorage)().versions.version(54)},t.messageAddPaymentBackground=function(){return(0,n.getStorage)().versions.version(68)},t.messageAddPaymentInviteServiceType=function(){return(0,n.getStorage)().versions.version(64)},t.messageAddPaymentRequestNFMFields=function(){return(0,n.getStorage)().versions.version(49)},t.messageAddPaymentTxnStatus=function(){return(0,n.getStorage)().versions.version(29)},t.messageAddPrivacyModeFields=function(){return(0,n.getStorage)().versions.version(32)},t.messageAddProductListPreviewHeaderImage=function(){return(0,n.getStorage)().versions.version(34)},t.messageAddProductListPreviewInfo=function(){return(0,n.getStorage)().versions.version(30)},t.messageCreateTable=function(){return(0,n.getStorage)().versions.version(7)},t.messageInfoAddDeliveryPrivacyMode=function(){return(0,n.getStorage)().versions.version(33)},t.messageInfoCreateTable=function(){return(0,n.getStorage)().versions.version(8)},t.messageRemovePaymentRequestHeaderField=function(){return(0,n.getStorage)().versions.version(52)},t.messageStatusPSAReadTimestamp=function(){return(0,n.getStorage)().versions.version(76)},t.migrateSubgroupsArray=function(){return(0,n.getStorage)().versions.version(80)},t.missingKeysCreateTable=function(){return(0,n.getStorage)().versions.version(26)},t.orphanPaymentNotificationCreateTable=function(){return(0,n.getStorage)().versions.version(40)},t.orphanReceiptCreateTable=function(){return(0,n.getStorage)().versions.version(10)},t.orphanRevokeCreateTable=function(){return(0,n.getStorage)().versions.version(47)},t.participantCreateTable=function(){return(0,n.getStorage)().versions.version(9)},t.paymentBackgroundsCreateTable=function(){return(0,n.getStorage)().versions.version(79)},t.peerMessageCreateTable=function(){return(0,n.getStorage)().versions.version(43)},t.pendingMutationsCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.privacyDisallowedListAddDhashField=function(){return(0,n.getStorage)().versions.version(67)},t.privacyDisallowedListCreateTable=function(){return(0,n.getStorage)().versions.version(58)},t.profilePicThumbCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.quickReplyCreateTable=function(){return(0,n.getStorage)().versions.version(18)},t.reactionsCreateTable=function(){return(0,n.getStorage)().versions.version(66)},t.recentStickersCreateTable=function(){return(0,n.getStorage)().versions.version(53)},t.syncActionsCreateTable=function(){return(0,n.getStorage)().versions.version(2)},t.syncKeysCreateTable=function(){return(0,n.getStorage)().versions.version(21)},t.tasksScheduledTimeCreateTable=function(){return(0,n.getStorage)().versions.version(22)},t.unjoinedSubgroupMetadataCreateTable=function(){return(0,n.getStorage)().versions.version(81)},t.verifiedBusinessNameAddPrivacyMode=function(){return(0,n.getStorage)().versions.version(31)},t.verifiedBusinessNameCreateTable=function(){return(0,n.getStorage)().versions.version(13)};var n=r(99069)},97153:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUserToPendingDeviceSync=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return(0,s.getTable)().bulkCreateOrMerge(e.map((e=>({id:e}))));return Promise.resolve()},t.doPendingDeviceSync=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(7293),s=r(12071);function l(){return(l=(0,i.default)((function*(){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))try{const e=yield(0,s.getTable)().all(),t=r(10823).syncDeviceListJob;yield t(e.map((e=>(0,a.createWid)(e.id))),null,null),yield(0,s.getTable)().bulkRemove(e.map((e=>e.id)))}catch(e){__LOG__(4,!0,new Error)`doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB`}yield Promise.resolve()}))).apply(this,arguments)}},85417:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,c.destroyStorage)().catch((()=>d.resolve(new i.default(c.DATABASE_NAME).delete()))).finally((()=>{u=null}))},t.initialize=function(){null==u&&((0,c.createStorage)(),(0,l.addTable)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),u=(0,c.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize offd storage"),e})));return u};var i=n(r(86128)),a=r(93771),o=r(78956),s=r(12071),l=r(33235),c=r(43950);const d=r(74121).Z;let u},93771:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("dangling-receipt").version((0,o.getStorage)().versions.version(1),[new a.default("id"),new i.default("receipts")]).view((e=>({id:e.id,receipts:e.receipts})))},t.getTable=function(){return(0,o.getStorage)().table("dangling-receipt")};var i=n(r(79051)),a=n(r(81674)),o=r(43950)},78956:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("peer-read-receipt").version((0,o.getStorage)().versions.version(2),[new a.default("id"),new i.default("msgKeys"),new i.default("ts"),new i.default("ack")]).view((e=>({id:e.id,ts:e.ts,msgKeys:e.msgKeys,ack:e.ack})))},t.getTable=function(){return(0,o.getStorage)().table("peer-read-receipt")};var i=n(r(79051)),a=n(r(81674)),o=r(43950)},12071:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("pending-device-sync").version((0,i.getStorage)().versions.version(4),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("pending-device-sync")};var i=r(43950),a=n(r(89362))},33235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("read-receipt").version((0,a.getStorage)().versions.version(0),[new o.default("id"),new i.default("externalIds")]).delete((0,a.getStorage)().versions.version(3)).view((e=>({id:e.id,externalIds:e.externalIds})))},t.getTable=function(){return(0,a.getStorage)().table("read-receipt")};var i=n(r(79051)),a=r(43950),o=n(r(89362))},43950:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[offd-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[offd-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="offd-storage";t.DATABASE_NAME=c;let d=null},134:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePeerReceipts=function(){return h.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(35470),l=n(r(65212)),c=r(7293),d=r(10435),u=r(90981),p=r(54676),f=r(78956),_=r(99069);function h(){return(h=(0,a.default)((function*(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const e=yield(0,f.getTable)().all(),t=[],r=[];e.forEach((e=>{e.ack===s.ACK.READ?t.push(e):e.ack===s.ACK.PLAYED?r.push(e):__LOG__(3)`updatePeerReceipts: unknown ack type: ${e.ack}`}));const{chatUpdates:n,ackUpdates:a}=yield g(t),o=new Map(a.map((e=>[e.id,e])));y(r).forEach((e=>{const t=o.get(e.id);null==t?o.set(e.id,e):o.set(e.id,(0,i.default)((0,i.default)({},t),{},{ack:e.ack}))}));const l=Array.from(o.values());return yield(0,_.getStorage)().lock(["message","chat"],(e=>{let[t,r]=e;return Promise.all([t.bulkCreateOrMerge(l),r.bulkCreateOrMerge(n)])})),(0,f.getTable)().clear()}return Promise.resolve()}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e){const t=[],r=[],n=new Map,i=new Set;e.forEach((e=>{e.msgKeys.forEach((e=>{const t=l.default.fromString(e).remote.toString();t!==o.STATUS_JID&&(n.set(t,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}),i.add(e))}))}));const a=Array.from(n.keys()),c=yield(0,u.getTable)().anyOf(["from","pendingReadReceipt"],a.map((e=>[e,1])),{shouldDecrypt:!1});return c.forEach((e=>{const t=n.get(e.from),{rowId:r,id:a}=e;null!=t&&null!=r&&i.has(a)&&(null==t.lastUnreadMsgRowId||r>t.lastUnreadMsgRowId)&&(t.lastUnreadMsgRowId=r)})),c.forEach((e=>{const r=n.get(e.from),{rowId:i}=e;if(null!=r&&null!=i&&null!=r.lastUnreadMsgRowId)if(i<=r.lastUnreadMsgRowId)t.push({id:e.id,ack:s.ACK.READ,pendingReadReceipt:null});else if(r.unreadCount+=1,(0,d.isGroupCatchUpEnabled)()&&(0,p.isImportantMessage)(e)){const t={id:e.id,timestamp:e.t};r.unreadMentionsOfMe.push(t)}})),a.forEach((e=>{const t=n.get(e);null!=t&&null!=t.lastUnreadMsgRowId&&r.push({id:e,unreadCount:t.unreadCount,unreadMentionsOfMe:t.unreadMentionsOfMe})})),{chatUpdates:r,ackUpdates:t}}))).apply(this,arguments)}function y(e){const t=new Set;return e.forEach((e=>{e.ack===s.ACK.PLAYED&&e.msgKeys.forEach((e=>t.add(e)))})),Array.from(t).map((e=>({id:e,ack:s.ACK.PLAYED,pendingReadReceipt:null})))}},63719:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.add=function(e){d=d.concat(e.map(p)),u()},t.deleteRange=E,t.getFromBottom=h,t.rowCount=m;var i=n(r(48926)),a=n(r(23493)),o=r(94398),s=r(30433),l=r(94398);const c=1e5;let d=[];const u=(0,a.default)((()=>T()),200);function p(e){return{marker_id:e.marker_id,method:e.method,action_id:e.action_id,duration_ns:e.duration_ns,marker_type:e.marker_type,sample_rate:e.sample_rate,points:e.points,instance_id:e.instance_id,metadata:e.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:e.flags,annotations_bool_array:e.annotations_bool_array,annotations_bool:e.annotations_bool,annotations_double_array:e.annotations_double_array,annotations_double:e.annotations_double,annotations_int_array:e.annotations_int_array,annotations_int:e.annotations_int,annotations_string_array:e.annotations_string_array,annotations:e.annotations}}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){try{yield(0,o.initialize)()}catch(e){throw __LOG__(4,!0,new Error,!0)`QPL Storage, error calling initializeQplStorage, error ${e}`,SEND_LOGS("QPL Storage init error"),e}}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){return yield f(),(0,l.getQplEventsTable)().all({limit:e,offset:0})}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return yield f(),(0,l.getQplEventsTable)().count()}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield f(),(0,l.getQplEventsTable)().bulkDeleteRange(["id"],e-1,t+1).then((()=>{}))}))).apply(this,arguments)}let v=null;function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){if(yield f(),v)v.then(T);else if(d.length>0){const e=d;d=[];try{const t=yield m();if(t+e.length>c){(0,s.maxStorageEventCountReached)();const r=t+e.length-c;yield A(r)}}catch(e){return __LOG__(4,!0,new Error,!0)`QPL Storage, error during checking for excessive events ${e}`,void SEND_LOGS("QPL Storage, error saving events")}v=(0,l.getQplEventsTable)().bulkCreate(e).then((()=>{v=null})).catch((e=>{__LOG__(4,!0,new Error,!0)`QPL Storage, error saving events ${e}`,SEND_LOGS("QPL Storage, error saving events"),v=null}))}}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=yield h(e),r=t[0].id||0,n=t[t.length-1].id||0;yield E(r,n)}))).apply(this,arguments)}},94398:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>s.resolve(new i.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getQplEventsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize qpl storage"),e})));return l};var i=n(r(86128)),a=r(4882),o=r(96367);const s=r(74121).Z;let l},4882:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("qpl-events").version((0,s.qplEventsCreateTable)(),[new a.default("id"),new i.default("marker_id"),new i.default("instance_id"),new i.default("action_id"),new i.default("sample_rate"),new i.default("method"),new i.default("duration_ns"),new i.default("points"),new i.default("metadata"),new i.default("marker_type"),new i.default("flags"),new i.default("annotations"),new i.default("annotations_double"),new i.default("annotations_int"),new i.default("annotations_bool"),new i.default("annotations_string_array"),new i.default("annotations_double_array"),new i.default("annotations_int_array"),new i.default("annotations_bool_array")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("qpl-events")};var i=n(r(79051)),a=n(r(81674)),o=r(96367),s=r(51542)},96367:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[qpl-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[qpl-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="qpl-storage";t.DATABASE_NAME=c;let d=null},51542:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplEventsCreateTable=function(){return(0,n.getStorage)().versions.version(0)};var n=r(96367)},318:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,p.destroyStorage)().catch((()=>f.resolve(new i.default(p.DATABASE_NAME).delete()))).finally((()=>{_=null}))},Object.defineProperty(t,"getBaseKeyTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getIdentityTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getMetaTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getPreKeyTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getSenderKeyTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getSessionTable",{enumerable:!0,get:function(){return d.getTable}}),Object.defineProperty(t,"getSignedPreKeyTable",{enumerable:!0,get:function(){return u.getTable}}),t.initialize=function(){null==_&&((0,p.createStorage)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,u.addTable)(),_=(0,p.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize signal storage"),e})));return _};var i=n(r(86128)),a=r(50930),o=r(35523),s=r(80919),l=r(64415),c=r(6259),d=r(1777),u=r(45726),p=r(77246);const f=r(74121).Z;let _},50930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("baseKey-store").version((0,l.baseKeyCreateTable)(),[new o.default("id"),new i.default("address"),new i.default("originalMsgId"),new i.default("baseKey"),new a.default(["address","originalMsgId"])]).view((e=>({id:e.id,address:e.address,originalMsgId:e.originalMsgId,baseKey:e.baseKey})))},t.getTable=function(){return(0,s.getStorage)().table("baseKey-store")};var i=n(r(79051)),a=n(r(34654)),o=n(r(81674)),s=r(77246),l=r(12126)},35523:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("identity-store").version((0,s.identityCreateTable)(),[new o.default("identifier"),new i.default("identityKey"),new i.default("rowId")]).view((e=>({identifier:e.identifier,identityKey:e.identityKey,rowId:e.rowId})))},t.getTable=function(){return(0,a.getStorage)().table("identity-store")};var i=n(r(79051)),a=r(77246),o=n(r(89362)),s=r(12126)},80919:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("signal-meta-store").version((0,s.metaCreateTable)(),[new o.default("key"),new i.default("value")]).view((e=>({key:e.key,value:e.value})))},t.getTable=function(){return(0,a.getStorage)().table("signal-meta-store")};var i=n(r(79051)),a=r(77246),o=n(r(89362)),s=r(12126)},64415:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("prekey-store").version((0,s.preKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("isDirectDistribution")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,isDirectDistribution:e.isDirectDistribution})))},t.getTable=function(){return(0,o.getStorage)().table("prekey-store")};var i=n(r(79051)),a=n(r(81674)),o=r(77246),s=r(12126)},6259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("senderkey-store").version((0,l.senderKeyCreateTable)(),[new s.default("senderKeyName"),new i.default("senderKey"),new i.default("senderId"),new a.default("senderId")]).view((e=>({senderKeyName:e.senderKeyName,senderKey:e.senderKey,senderId:e.senderId})))},t.getTable=function(){return(0,o.getStorage)().table("senderkey-store")};var i=n(r(79051)),a=n(r(19570)),o=r(77246),s=n(r(89362)),l=r(12126)},1777:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("session-store").version((0,s.sessionCreateTable)(),[new o.default("address"),new i.default("session")]).view((e=>({address:e.address,session:e.session})))},t.getTable=function(){return(0,a.getStorage)().table("session-store")};var i=n(r(79051)),a=r(77246),o=n(r(89362)),s=r(12126)},45726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("signed-prekey-store").version((0,s.signedPreKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("signature")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,signature:e.signature})))},t.getTable=function(){return(0,o.getStorage)().table("signed-prekey-store")};var i=n(r(79051)),a=n(r(81674)),o=r(77246),s=r(12126)},77246:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[signal-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[signal-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),o=n(r(98883)),s=r(37521),l=r(23283);const c="signal-storage";t.DATABASE_NAME=c;let d=null},12126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseKeyCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.identityCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.metaCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.preKeyCreateTable=function(){return(0,n.getStorage)().versions.version(2)},t.senderKeyCreateTable=function(){return(0,n.getStorage)().versions.version(6)},t.sessionCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.signedPreKeyCreateTable=function(){return(0,n.getStorage)().versions.version(4)};var n=r(77246)},44558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=n(r(48926));function a(){return(a=(0,i.default)((function*(){const e=window.caches;if(null==e)return;const t=yield e.keys();yield Promise.all(t.map((t=>e.delete(t))))}))).apply(this,arguments)}},23283:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StorageCmdImpl=t.StorageCmd=void 0;var i=n(r(34342));class a extends i.default{}t.StorageCmdImpl=a;const o=new a;t.StorageCmd=o},56042:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigs=void 0;t.ABPropConfigs={in_app_support_v2_enabled:[233,"bool",!1],in_app_support_v2_locale_langs:[379,"string",""],in_app_support_v2_numbers:[390,"string",""],in_app_support_v2_number_prefixes:[1031,"string","15517868"],in_app_support_v2_jump_to_group:[819,"bool",!1],in_app_support_v2_jump_to_group_wait_time_in_ms:[974,"int",5e3],groups_dogfooding_ui:[308,"bool",!1],md_icdc_enabled:[309,"bool",!1],md_icdc_hash_length:[310,"int",10],played_self_enabled:[361,"bool",!1],ephemeral_24h_duration:[407,"bool",!1],disappearing_mode:[536,"bool",!1],payments_expressive_backgrounds_enabled:[605,"bool",!1],ephemeral_allow_group_members:[432,"bool",!1],business_profile_refresh_m1_enabled:[470,"bool",!1],num_days_key_index_list_expiration:[730,"int",35],num_days_before_device_expiry_check:[731,"int",7],media_reupload_limit_mb:[1098,"int",100],native_shop_preview_enabled:[636,"bool",!1],sync_archive_v2_setting:[736,"bool",!1],ptt_conversation_waveform:[637,"bool",!1],ptt_waveform_send:[746,"bool",!1],adv_v2_m4_m5:[753,"bool",!1],adv_v2_m6:[903,"bool",!1],ptt_draft_enabled:[777,"bool",!1],ptt_pausable_enabled:[871,"bool",!1],tos_3_client_gating_biz_initiated_enabled:[953,"bool",!1],tos_3_client_gating_enabled:[791,"bool",!1],tos_3_client_force_fetch_enabled:[792,"bool",!1],tos_client_state_fetch_enabled:[877,"bool",!1],tos_client_state_force_fetch_enabled:[878,"bool",!1],tos_client_state_fetch_iteration:[908,"int",0],country_client_gating_enabled:[1105,"bool",!1],system_msg_numbers_fb_branded:[1035,"string","16505434800,16503130062,16507885324,16508620604,16504228206,447710173736,16315551023,16505361212,16508129150,16315555102,16315558723,16505212669,16507885280,19032707825,0"],system_msg_numbers_fb_inc:[1036,"string",""],log_clock_skew:[1190,"bool",!1],trusted_contacts:[794,"bool",!1],trusted_contacts_sender:[995,"bool",!1],trusted_contacts_ti:[922,"bool",!1],tctoken_duration:[865,"int",604800],tctoken_num_buckets:[909,"int",4],tctoken_duration_sender:[996,"int",604800],tctoken_num_buckets_sender:[997,"int",4],reactions_receive:[827,"bool",!1],reactions_send:[828,"bool",!1],reactions_announcement_only:[1150,"bool",!1],reaction_cleanup_days:[987,"int",31],md_migration_experience:[861,"int",0],web_abprop_direct_connection_md:[869,"bool",!1],media_upload_prekeys_fetch_enabled:[907,"bool",!1],ptt_remember_play_position:[952,"bool",!1],banned_shops_ux_enabled:[957,"bool",!1],group_suspend_v0_enabled:[973,"bool",!1],parent_group_view_enabled:[982,"bool",!1],parent_group_create_enabled:[1173,"bool",!1],parent_group_query_ts:[1228,"int",0],parent_group_link_limit:[1238,"int",0],cadmin_self_demote:[1286,"bool",!1],forwarded_ptt_ui_enabled:[1040,"bool",!1],shops_storefront_url_format:[1054,"string","https://www.facebook.com/%s/shop/"],message_count_logging_md_enabled:[1135,"bool",!1],dev_prop_string:[1064,"string",""],dev_prop_boolean:[1065,"bool",!1],dev_prop_int:[1066,"int",0],dev_prop_float:[1067,"float",0],order_details_from_cart_enabled:[1107,"bool",!1],order_details_custom_item_enabled:[1176,"bool",!1],order_details_from_catalog_enabled:[1212,"bool",!1],md_app_state_critical_data_processing_logging:[1187,"bool",!1],md_app_state_report_md_sync_mutation_stats:[1221,"bool",!1],order_management_enabled:[1188,"bool",!1],growth_lock_v0_enabled:[1204,"bool",!1],smart_filters_enabled_consumer:[1287,"bool",!1],smb_collections_enabled:[451,"bool",!1],consumer_collections_enabled:[582,"bool",!1],smb_collections_appeal_flow_enabled:[724,"bool",!1],smb_multi_device_awareness:[1074,"bool",!1],smb_quick_replies_v2_enabled:[875,"bool",!1],smb_ecommerce_compliance_india_m4:[1003,"bool",!1],smb_ecommerce_compliance_india_m4_5:[1192,"bool",!1],smart_filters_enabled:[1015,"bool",!1],btm_threads_logging_enabled:[1022,"bool",!1],native_commerce_threads_logging_enabled:[1034,"bool",!1],threads_logging_observe_list_enabled:[1168,"bool",!1],smb_hide_unsupported_currency_price:[1203,"bool",!1],hyperlinked_phone_numbers_enabled:[1215,"bool",!1],smb_catkit_query_version:[1229,"int",1],smb_phase_out_not_a_business:[1263,"bool",!1],smb_threads_logging_enabled:[1251,"bool",!1],smb_click_to_chat_logging_enabled:[1252,"bool",!1],smb_broadcast_logging_enabled:[1253,"bool",!1],smb_status_logging_enabled:[1254,"bool",!1],smb_biz_profile_logging_enabled:[1255,"bool",!1],smb_registration_flow_logging_enabled:[1256,"bool",!1],btm_qpl_enabled:[1272,"bool",!1],qpl_enabled:[212,"bool",!1],qpl_upload_delay:[215,"int",1440],qpl_sampling_as_string:[466,"string",'json:{"sampling":[]}'],qpl_initial_upload_delay:[1223,"int",5],should_deregister_on_syncd_fatal:[383,"bool",!0],group_catch_up:[559,"bool",!1],web_abprop_ctwa_context_compose_enabled:[591,"bool",!1],web_abprop_group_description_length:[592,"int",0],web_abprop_ephemeral_messages_allowed_values:[593,"string","604800"],web_abprop_collections_display:[584,"bool",!1],web_abprop_collections_management:[585,"bool",!1],web_abprop_drop_full_history_sync:[600,"bool",!1],web_abprop_business_profile_incomplete_nux_banner:[710,"bool",!1],web_abprop_product_catalog_nux_banner:[711,"bool",!1],web_abprop_click_nux_banner_migration:[712,"bool",!1],web_abprop_ecommerce_compliance_india:[717,"bool",!1],web_abprop_edit_ecommerce_compliance_india:[826,"bool",!1],drop_last_name:[726,"bool",!1],web_abprop_catalog_icon_on_top_bar:[734,"bool",!1],web_abprop_collections_nux_banner:[741,"bool",!1],nfm_rendering_enabled:[760,"bool",!1],web_abprop_nux_cart_interstitial:[761,"bool",!1],web_abprop_business_profile_refresh_status_enabled:[763,"bool",!1],web_abprop_business_profile_refresh_linked_account_enabled:[764,"bool",!1],web_abprop_business_profile_refresh_edit_cover_photo_enabled:[765,"bool",!1],web_abprop_business_profile_refresh_cover_photo_view_enabled:[766,"bool",!1],elevated_important_msg:[809,"bool",!1],web_privacy_settings:[837,"bool",!1],web_privacy_settings_v2:[1226,"bool",!1],web_status_psa:[873,"bool",!1],web_status_psa_history_sync:[1095,"bool",!1],web_2fa:[1195,"bool",!1],web_abprop_stateful_enumeration_enabled:[887,"bool",!0],web_abprop_block_catalog_creation_ecommerce_compliance_india:[894,"bool",!1],web_sticker_store:[930,"bool",!1],web_proactive_prekeys_fetch_group_size_limit:[937,"int",0],web_favorite_stickers:[962,"bool",!1],web_orchestrator_enabled_version:[984,"string","default"],web_wam_v5_enabled:[1033,"bool",!1],web_ps_v3_enabled:[1114,"bool",!1],web_shop_storefront_message:[1053,"bool",!1],web_identity_store_cache:[1078,"bool",!1],web_abprop_large_files_encryption_optimization:[1086,"bool",!1],web_send_invisible_msg_to_new_groups:[1099,"bool",!1],web_send_invisible_msg_min_group_size:[1100,"int",128],web_init_chat_batch_size:[1171,"int",100],web_init_chat_max_unread_message_count:[1172,"int",0],web_abprop_skip_file_copy_on_attach:[1174,"bool",!1],reaction_history_sync:[1179,"bool",!1],web_abprop_screen_sharing_enabled:[1189,"bool",!1],web_graphql_for_catalog_m1:[1205,"bool",!1],web_abprop_config_experiment_test:[1217,"bool",!1],web_adaptive_offline_resume_enabled:[1224,"bool",!1],web_wa_signal_enabled:[1225,"bool",!1],web_gdpr_request_account_info_enabled:[1232,"bool",!1],web_new_compose_box_input:[1243,"bool",!1],web_abprop_document_resume_upload:[1247,"bool",!1],more_reactions_option:[1322,"bool",!1],web_rotate_sender_key_if_sent:[1329,"bool",!1],web_lru_cache_optimization:[1339,"bool",!1],web_lru_cache_purge_logic_refactor:[1383,"bool",!1],companion_min_versions:[1367,"string","json:[]"],comparion_force_upgrade:[1368,"bool",!1],web_abprop_business_profile_refresh_linked_accounts_killswitch:[1351,"bool",!1],web_default_pull_mode_enabled:[1355,"bool",!1],web_abprop_chatd_login_cookie_enabled:[1371,"bool",!1],web_prekeys_fetch_first_batch_size:[1373,"float",0],md_app_state_gate_D34336913:[1379,"bool",!1],web_address_capture_message_enabled:[1385,"bool",!1],syncd_periodic_sync_days:[1400,"int",0],stop_abprops_traffic_in_serverprops_response:[315,"bool",!1],enable_biz_activity_report_request:[455,"bool",!1],plm_products_max_batch_fetch_size:[464,"int",18],enable_granular_reject_reasons:[550,"bool",!1],elevating_profile_names_enabled:[604,"bool",!1],enable_group_profile_editor:[689,"bool",!1],csat_message_rating:[690,"bool",!1],facebook_link_preview_use_thumbnail:[810,"bool",!1],tam_attachment_cache_compaction_enabled:[838,"bool",!1],business_threads_logging_enabled:[853,"bool",!1],private_stats_biz_view_logging_enabled:[904,"bool",!1],no_delete_message_time_limit:[1011,"bool",!1],sender_revoke_window_sender:[1333,"bool",!1],sender_revoke_window_receiver:[1334,"bool",!1],sender_revoke_ui:[1335,"bool",!1],admin_revoke_receiver:[1177,"bool",!1],admin_revoke_sender:[1292,"bool",!1],admin_revoke_history_sync_consumer:[1245,"bool",!1],admin_hfm_toggle:[1021,"bool",!1],csat_message_trigger:[1082,"bool",!1],graphql_privacy_imp_m1:[1096,"bool",!1],lthash_check_hours:[1104,"int",0],interactive_message_native_flow_killswitch:[1133,"bool",!1],sender_key_expired_logging_enabled:[1185,"bool",!1],group_size_limit:[1304,"int",257],address_capture_native_flow_killswitch:[1306,"bool",!1],commerce_sanctioned:[1319,"bool",!1],commerce_bloks_apps_mapping:[1320,"string","{}"],graphql_privacy_imp_m2:[1327,"bool",!1],nux_sync:[1343,"bool",!1],reactions_animations:[1361,"bool",!1],in_app_survey_enabled:[1377,"bool",!1],poll_creation_enabled:[1394,"bool",!1],poll_receiving_enabled:[1395,"bool",!1],client_group_participants_limit:[618,"int",257],payment_stickers_render_enabled:[812,"bool",!1],privacy_allow_contacts_except:[808,"bool",!1],primary_feature_sync:[1063,"bool",!1],privacy_narrative_v1:[1071,"bool",!1],add_dm_to_chat_overflow_menu:[1309,"bool",!1],keep_in_chat_receiver:[1352,"bool",!1],keep_in_chat_sender:[1353,"bool",!1],ddm_reversed_options:[1397,"bool",!1],sticker_md_favorite_stickers_enabled:[864,"bool",!1]}},18018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compareServerPropsAndABProps=function(){new Map([["web_abprop_ctwa_context_compose_enabled",["ctwaContextCompose",o.ServerProps.ctwaContextCompose]],["web_abprop_group_description_length",["groupDescLength",o.ServerProps.groupDescLength]],["web_abprop_ephemeral_messages_allowed_values",["ephemeralMessagesAllowedValues",o.ServerProps.ephemeralMessagesAllowedValues]]]).forEach(((e,t)=>{const r=(0,i.getABPropConfigValue)(t);new a.default.WebcAbpropsValidation({abpropName:t,abpropValue:String(r),serverPropName:String(e[0]),serverPropValue:String(e[1])}).commit()}))};var i=r(86945),a=n(r(11339)),o=r(64551)},64971:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABKey=function(){const e=l();return null==e?void 0:e.abKey},t.getHash=function(){const e=l();return null==e?void 0:e.hash},t.getLastSyncTime=function(){const e=l(),t=null==e?void 0:e.lastSyncTime;if(null==t)return null;return parseInt(t,10)},t.getRefresh=function(){var e;const t=l();return parseInt(null!==(e=null==t?void 0:t.refresh)&&void 0!==e?e:86400,10)},t.isABPropsAfterFirstSync=function(){return null!=l()},t.updateAttributesLocalStorage=function(e,t,r,n){var c,d;let u=null;null!=r&&(u=r,u<600?u=600:u>s&&(u=s));const p=l()||{},f={abKey:null!=e?e:p.abKey,hash:null!=t?t:p.hash,refresh:null!==(c=null===(d=u)||void 0===d?void 0:d.toString())&&void 0!==c?c:p.refresh,lastSyncTime:n};(0,i.default)(a.default,"localStorage").setItem(o.KEYS.ABPROPS,JSON.stringify(f))};var i=n(r(45095)),a=n(r(92417)),o=r(72407);const s=604800;function l(){const e=(0,i.default)(a.default,"localStorage").getItem(o.KEYS.ABPROPS);return null==e?null:JSON.parse(e)}},80024:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exposureKeys=t.accessedConfigs=void 0,t.updateGlobalABKey=function(e){i.default.Global.set({abKey2:e})},t.updateGlobalExpoKey=function(){i.default.Global.set({expoKey:Array.from(o).join(",")})};var i=n(r(11339));const a=new Set;t.accessedConfigs=a;const o=new Set;t.exposureKeys=o},86945:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigCodeToName=void 0,t.clearABPropConfigs=function(){return p.reset()},t.getABPropConfigValue=f,t.getAllABPropConfigs=function(){return p.getAllConfigs()},t.updateABPropsFromStorage=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(34541),o=r(56042),s=r(7293),l=r(80024);const c=new Map;let d=!1;const u={};t.ABPropConfigCodeToName=u,Object.keys(o.ABPropConfigs).forEach((e=>{const[t]=o.ABPropConfigs[e];u[t]=e})),Object.freeze(u);const p={reset:()=>{c.clear(),l.accessedConfigs.clear(),l.exposureKeys.clear(),d=!1},bulkCreateOrReplace(e){let t=!1;e.forEach((e=>{c.set(e.configCode,e),!0===e.hasAccessed&&(l.accessedConfigs.add(e.configCode),null!=e.configExpoKey&&(l.exposureKeys.add(e.configExpoKey),t=!0))})),t&&(0,l.updateGlobalExpoKey)(),d=!0,f("web_abprop_config_experiment_test")},getConfigValue(e){var t;if(!d)return __LOG__(3)`[ABProps] configs need to be initialized before its first access, config code: ${e}`,null;if(c.get(e)&&!l.accessedConfigs.has(e)){var r;const t=null===(r=c.get(e))||void 0===r?void 0:r.configExpoKey;null==t||l.exposureKeys.has(t)||(l.exposureKeys.add(t),(0,l.updateGlobalExpoKey)()),l.accessedConfigs.add(e),(0,a.setConfigAccessed)(e)}return null===(t=c.get(e))||void 0===t?void 0:t.configValue},getAllConfigs:()=>Array.from(c.values())};function f(e){var t;s.GK.supportsFeature(s.GK.F.MD_BACKEND)||(__LOG__(4,!0,new Error,!0)`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`,SEND_LOGS(`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`));const r=o.ABPropConfigs[e],[n,i,a]=r;return null!==(t=p.getConfigValue(n))&&void 0!==t?t:a}function _(){return(_=(0,i.default)((function*(){try{const e=(yield(0,a.getABPropConfigs)()).map((e=>{const t=u[Number(e.configCode)];if(null!=t){const r=o.ABPropConfigs[t],[n,i,s]=r;return{configCode:n,configValue:(0,a.parseConfigValue)(e.configValue,i,s),configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed}}__LOG__(3)`[ABProps] ABProp (code: ${e.configCode}) exists in storage but no longer available for this client version`})).filter((e=>!!e));p.bulkCreateOrReplace(e)}catch(e){__LOG__(4,!0,new Error,!0)`[ABProps] Failed to update ABProps configs cache from storage`,SEND_LOGS("[ABProps] Failed to update ABProps configs cache from storage: "+e)}__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps Start ---`,c.forEach(((e,t)=>{__LOG__(2,void 0,void 0,void 0,["abprops"])`code: ${t}, name: ${u[e.configCode]}, value: ${e.configValue}, type: ${typeof e.configValue}`})),__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps End ---`}))).apply(this,arguments)}},10435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdminHfmToggleEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("admin_hfm_toggle"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.FREQUENTLY_FORWARDED_SETTING)},t.isDefaultDisappearingMessagesEnabled=function(){return o.PrimaryFeatures.ddmSettings&&i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&(0,a.getABPropConfigValue)("web_privacy_settings_v2")},t.isDisappearingModeEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("disappearing_mode"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.DISAPPEARING_MODE)},t.isDropLastNameEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("drop_last_name"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.DROP_LAST_NAME_MENTIONS)},t.isElevatedImportantMessageEnabled=function(){var e;return!(!i.GK.supportsFeature(i.GK.F.MD_BACKEND)||!s())&&(null!==(e=(0,a.getABPropConfigValue)("elevated_important_msg"))&&void 0!==e&&e)},t.isEphemeral24HDurationEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("ephemeral_24h_duration"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.EPHEMERAL_24_H_DURATION)},t.isGroupCatchUpEnabled=s,t.isInAppSupportEnabled=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){if(!(0,a.getABPropConfigValue)("in_app_support_v2_enabled"))return!1;const e=(0,a.getABPropConfigValue)("in_app_support_v2_locale_langs");if(""===e)return!0;const t=new Set(e.split(",")),n=r(43725).default;return t.has(n.getLocale())}return i.GK.supportsFeature(i.GK.F.SUPPORT)},t.isPrivacyNarrativeV1Enabled=function(){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&(0,a.getABPropConfigValue)("privacy_narrative_v1")},t.isSenderRevokeUiEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("sender_revoke_ui"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowReceiverEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("sender_revoke_window_receiver"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowSenderEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("sender_revoke_window_sender"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)};var n=r(99234),i=r(7293),a=r(86945),o=r(34771);function s(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){var e,t;const r=null!==(e=(0,n.getUnreadMentionCountEnabled)())&&void 0!==e&&e;return null!==(t=(0,a.getABPropConfigValue)("group_catch_up"))&&void 0!==t&&t&&r}return!1}},87845:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeContain=void 0,t.checkAndRemoveActiveMessageRanges=function(e,t){(0,i.getActiveMessageRanges)(e.remote.toString()).then((r=>{r.forEach((r=>{if([a.ActiveRangeAction.Archive,a.ActiveRangeAction.MarkChatAsRead].includes(r.action)&&s(r.actionValue.messageRange,{id:e,t})===o.DOES_NOT_CONTAIN)return(0,i.removeActiveMessageRange)(e.remote.toString(),r.action)}))}))},t.rangeContainsMessage=s;var n=r(8243),i=r(38342),a=r(69702);const o=r(76672).Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);function s(e,t){if(null==e)return __LOG__(3)`syncd: missing message range from row.`,o.DOES_NOT_CONTAIN;const{messages:r,lastMessageTimestamp:i}=e;if(null!=t.t&&null!=i&&t.t<(0,n.numberOrThrowIfTooLarge)(i))return o.CONTAINS_BY_TIMESTAMP;const a=t.id;for(const{key:e}of r)if(null!=e&&null!=a&&e.id===a.id)return o.CONTAINS_BY_ADDITIONAL;return o.DOES_NOT_CONTAIN}t.RangeContain=o},15421:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(73955)),a=r(85553),o=r(22683);var s=new class{constructor(){this._alarms=new Map;const e=()=>{this._alarms.size>0&&this._validateTimeouts()};a.jsHaltDetector.on(a.JS_HALT_EVENT,e),a.jsHaltDetector.on(a.CLOCK_CHANGE_BACKWARDS_EVENT,e),o.Clock.on(o.SKEW_CHANGE_EVENT,this._resetGlobalTimeouts.bind(this))}setLocalTimeout(e,t,r){return this._setTimeout(!1,e,t,r)}setGlobalTimeout(e,t,r){return this._setTimeout(!0,e,t,r)}clearTimeout(e){if(!e)return;const t=this._alarms.get(e);t&&(window.clearTimeout(t.timeoutId),this._alarms.delete(e))}_setTimeout(e,t,r,n){n&&this.clearTimeout(n);const o=n||(0,i.default)("alarm_timer_"),s=r-this._getTimeInMS(e),l=Math.min(s,2147483647);if(s<0)return __LOG__(2)`Alarm:setTimeout:Cannot set alarm in the past.`,t(),o;const c=window.setTimeout((()=>{r-this._getTimeInMS(e)<a.DEFAULT_THRESHOLD?(this._alarms.delete(o),t()):this._setTimeout(e,t,r,o)}),l);return this._alarms.set(o,{isGlobal:e,fn:t,expiration:r,timeoutId:c}),o}_validateTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:r,fn:n,expiration:i}=e;i<this._getTimeInMS(r)?(this.clearTimeout(t),n()):this._setTimeout(r,n,i,t)}))}_resetGlobalTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:r,fn:n,expiration:i}=e;r&&this._setTimeout(r,n,i,t)}))}_getTimeInMS(){return 1e3*(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?o.Clock.globalUnixTime():o.Clock.localUnixTime())}};t.default=s},65351:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=void 0;t.URL="https://web.whatsapp.com/"},88711:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APICmd=void 0,t.isWAURL=function(e){return r.test(e)};t.APICmd={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT"};const r=/^whatsapp:\/\/.*/i},7111:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.matchProductUrl=t.matchCatalogUrl=void 0,t.parseAPICmd=function(e){if("string"!=typeof e)return{resultType:s.APICmd.INVALID,data:void 0};const t=(e=>{let t=e.match(u);if(t)return{code:t[2],url:t[1]||"/"};if(t=e.match(p),t)return{code:t[1]};if(t=e.match(f),t)return{code:t[1]};if(t=e.match(_),t)return{code:t[1]}})(e);if(t)return{resultType:s.APICmd.GROUP_INVITE,data:t};const r=function(e){let t=e.match(O)||e.match(I);if(t)return R(t);if(t=e.match(w),t)return(0,i.default)((0,i.default)({},R(t)),{},{url:"/"})}(e);if(r)return{resultType:s.APICmd.CATALOG,data:r};const n=function(e){let t=M(e,A);if(t)return D(t);if(t=M(e,b),t)return(0,i.default)((0,i.default)({},D(t)),{},{url:"/"})}(e);if(n)return{resultType:s.APICmd.PRODUCT,data:n};const a=(e=>{let t=e.match(y);if(t){const e=m(t[2]);if(e)return e.url=t[1]||"/",e}if(t=e.match(E),t)return m(t[1]);if(t=e.match(S),t)return m(t[1]);if(t=e.match(v),t){let e;if(t[1]&&(e={phone:`${t[1]}@c.us`}),t[2]){const r=m(t[2]);r&&(e=(0,i.default)((0,i.default)({},e),r))}return e}})(e);if(a)return{resultType:s.APICmd.MSG_SEND,data:a};return{resultType:s.APICmd.INVALID,data:void 0}},t.parseConversionData=g;var i=n(r(81109)),a=r(8584),o=r(65351),s=r(88711),l=n(r(23082));const c=(d=o.URL,d.replace(/\/+$/,"")).replace(/[\/\.]/g,"\\$&");var d;const u=new RegExp(`^${c}((?:/\\w+)*)/accept/?\\?code=(\\w+)$`,"i"),p=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)$/i,f=/^https?:\/\/chat\.whatsapp\.com\/(\w+)$/i,_=/^whatsapp:\/\/chat\/?\?code=(\w+)$/i,h={text:"text",phone:"phone",data:"data",source:"source",context:"context",icebreaker:"icebreaker",source_url:"source_url"};function g(e){if(!e||"string"!=typeof e)return;const t=a.Binary.build(e);return t.size()>512?void 0:t.readBuffer()}function m(e){const t={};if(new l.default(e).forEach(((e,r)=>{const n=r.toLowerCase();if(n===h.data){const r=g(e);if(!r)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionData=r}else if(n===h.source){const r=e;if((0,a.numUtf8Bytes)(r)>32)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionSource=r}else n===h.source_url?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.sourceUrl=e):n===h.context?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.context=e):n===h.icebreaker?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.icebreaker=e):h[n]&&(t[n]=e)})),t.phone&&(t.phone=t.phone.replace(/\D/g,"")+"@c.us",t.ctwaContextLinkData&&(t.ctwaContextLinkData.phone=t.phone)),t.phone||t.text)return t}const y=new RegExp(`^${c}((?:/\\w+)*)/send/?\\?(.+)$`,"i"),E=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,S=/^whatsapp:\/\/send\/?\?(.*)$/i,v=/^https?:\/\/wa\.me\/?([0-9]{0,20})?\/?\??(.+)?$/i,T=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([0-9]{0,20})/([0-9]{0,20})$`,"i"),C=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([^/]{0,200})/([0-9]{0,20})$`,"i"),A=[/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i],b=[T,C],P=[...A,...b];function M(e,t){for(let r=0;r<t.length;r++){const n=e.match(t[r]);if(n)return n}}t.matchProductUrl=e=>null!=M(e,P);const O=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})$/i,I=/^whatsapp:\/\/catalog\/([0-9]{0,20})$/i,w=new RegExp(`^${c}(?:(?:/\\w+)*)/catalog/([0-9]{0,20})$`,"i");t.matchCatalogUrl=e=>[O,I,w].some((t=>e.match(t)));function R(e){return{catalogOwnerJid:`${e[1]}@s.whatsapp.net`}}function D(e){return{productId:e[1],businessOwnerJid:`${e[2]}@s.whatsapp.net`}}},63064:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=n(r(48926)),a=r(40265),o=r(50796),s=r(38284),l=n(r(15421)),c=r(99234),d=n(r(10151)),u=r(65044);const p=r(49036).default,f=6e5,_="init",h="ping",g="pong",m="local-takeover";var y=new class{init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,i.default)((function*(){const r=t+1;if(r>3)return!0;const n=(0,c.getNoTakeover)();(0,c.setNoTakeover)(),u.Socket.preload();if(yield e._pingForOtherLocalSession())return e._updateMutex(),yield(0,d.default)(!n),!1;if(n)return!0;throw r}))()}takeoverLocal(e){return(0,c.getMutex)()?((0,c.setMutex)(m),(0,s.promiseTimeout)(p(window,"storage",c.takeoverFilter),3e4,"takeoverLocalTimeout").then((t=>{const r=(0,c.parseTakeover)(t.newValue);return(0,c.getRememberMe)()||(0,c._setAllKeyValues)(r),u.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)})).catch((0,o.filteredCatch)(a.TimeoutError,(()=>(__LOG__(3)`app:takeoverLocal timeout`,u.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)))))):this.init(e)}unloadMutex(){const e=(0,c.getMutex)();e&&this._ourMutex&&e.includes(this._ourMutex)&&(0,c.removeMutex)()}storagePong(e){if(!(0,c.mutexFilter)(e))return;const t=(0,c.parseMutex)(e.newValue);return t?t===m?(this._clearMutexTimer(),u.Socket.exitLoop(),(0,c.localTakeoverSuccess)(),!0):void(0===t.indexOf(h)&&(0,c.setMutex)(g+Math.random())):void 0}_clearMutexTimer(){this._updateMutexTimerID&&l.default.clearTimeout(this._updateMutexTimerID)}_updateMutex(){this._clearMutexTimer();const e=Date.now();(0,c.setMutex)(this._ourMutex=_+"_"+e),this._updateMutexTimerID=l.default.setLocalTimeout(this._updateMutex.bind(this),e+f)}_pingForOtherLocalSession(){let e=(0,c.getMutex)();if(e){e+="";let t=1e4;if(e.indexOf("_")>0){const r=e.split("."),n=parseInt(r[r.length-1],10);if(Number.isFinite(n)){n<Date.now()-9e5&&(__LOG__(2)`app:_pingForOtherLocalSession stale mutex`,t=1e3)}}const r=(0,s.promiseTimeout)(p(window,"storage",c.mutexFilter),t,"waitForOtherLocalSessionTimeout").then((()=>!1)).catch((0,o.filteredCatch)(a.TimeoutError,(function(){return __LOG__(3)`app:_pingForOtherLocalSession mutex timeout`,!0})));return(0,c.setMutex)(h+Math.random()),r}return Promise.resolve(!0)}};t.Z=y},54958:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldEnableArchiveV2=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return!1;const e=r(69951).ChatCollection.filter((e=>e.archive));return(0,a.archiveV2Supported)()&&!s.default.archive.enabled&&1===e.length},t.shouldUnarchiveChat=function(e){if((0,a.archiveV2Supported)()){if(s.default.showArchiveV2)return!1;if(!i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&!s.default.archive.enabled&&!e)return(0,o.setArchiveEnabledSetting)(!0),!1}return!0},t.shouldUnarchiveChatOnReaction=function(e,t,r){if(e&&!t&&""!==r)return!(0,a.archiveV2Supported)()||!s.default.showArchiveV2;return!1};var i=r(7293),a=r(57701),o=r(92052),s=n(r(68132))},71386:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OUTPUT_DEVICES=t.AudioSessionManager=t.AudioSession=t.AUDIO_EVENTS=void 0;var i=n(r(34342));t.AUDIO_EVENTS={OUTPUT_ROUTES_CHANGED:"OUTPUT_ROUTES_CHANGED"};t.OUTPUT_DEVICES={UNKNOWN:0,LINE_OUT:1,HEADPHONES:2,BLUETOOTH:3,INTERNAL_RECEIVER:4,INTERAL_SPEAKER:5,HDMI:6,REMOTE:7,BLUETOOTH_LE:8,BLUETOOTH_HANDS_FREE:9,USB:10,CAR:11};t.AudioSession=class{startUse(){}endUse(){}};class a extends i.default{startAudioSession(){}isRoutingToOutput(){return!1}get isRoutingToSpeaker(){return null}get outputRoutes(){return[]}get isBluetoothInputAvailable(){return null}overrideOutputRoute(){return Promise.resolve()}}const o=new a;t.AudioSessionManager=o},92115:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_INQUIRY_TYPE=t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=t.BIZ_SYSTEM_MSG_SUBTYPES_V2=t.BIZ_SYSTEM_MSG_SUBTYPES=void 0;t.BIZ_SYSTEM_MSG_SUBTYPES=["blue_msg_bsp_fb_to_bsp_premise","blue_msg_bsp_fb_to_self_fb","blue_msg_bsp_fb_to_self_premise","blue_msg_bsp_fb_unverified","blue_msg_bsp_fb_unverified_to_bsp_premise_verified","blue_msg_bsp_fb_unverified_to_self_fb_verified","blue_msg_bsp_fb_unverified_to_self_premise_verified","blue_msg_bsp_fb_verified","blue_msg_bsp_fb_verified_to_bsp_premise_unverified","blue_msg_bsp_fb_verified_to_self_fb_unverified","blue_msg_bsp_fb_verified_to_self_premise_unverified","blue_msg_bsp_premise_to_self_premise","blue_msg_bsp_premise_unverified","blue_msg_bsp_premise_unverified_to_self_premise_verified","blue_msg_bsp_premise_verified","blue_msg_bsp_premise_verified_to_self_premise_unverified","blue_msg_consumer_to_bsp_fb_unverified","blue_msg_consumer_to_bsp_premise_unverified","blue_msg_consumer_to_self_fb_unverified","blue_msg_consumer_to_self_premise_unverified","blue_msg_self_fb_to_bsp_premise","blue_msg_self_fb_to_self_premise","blue_msg_self_fb_unverified","blue_msg_self_fb_unverified_to_bsp_premise_verified","blue_msg_self_fb_unverified_to_self_premise_verified","blue_msg_self_fb_verified","blue_msg_self_fb_verified_to_bsp_premise_unverified","blue_msg_self_fb_verified_to_self_premise_unverified","blue_msg_self_premise_to_bsp_premise","blue_msg_self_premise_unverified","blue_msg_self_premise_verified","blue_msg_to_bsp_fb","blue_msg_to_consumer","blue_msg_to_self_fb","blue_msg_unverified_to_bsp_fb_verified","blue_msg_unverified_to_bsp_premise_verified","blue_msg_unverified_to_self_fb_verified","blue_msg_unverified_to_verified","blue_msg_verified_to_bsp_fb_unverified","blue_msg_verified_to_bsp_premise_unverified","blue_msg_verified_to_self_fb_unverified","blue_msg_verified_to_unverified"];const r=["biz_privacy_mode_init_fb","biz_privacy_mode_init_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=r;const n=[...r,"biz_privacy_mode_to_fb","biz_privacy_mode_to_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2=n;t.PRODUCT_INQUIRY_TYPE="product_inquiry"},30066:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMPLIANCE_INFO_LENGTH=t.COMPLIANCE_INFO_CODES=void 0;t.COMPLIANCE_INFO_CODES={INDIA:"IN"};t.COMPLIANCE_INFO_LENGTH={ENTITY_NAME:1024,ENTITY_TYPE_CUSTOM:1024,EMAIL:256,GRIEVANCE_OFFICER_NAME:256,LANDLINE_NUMBER:20,MOBILE_NUMBER:20,IMPORTER_NAME:1024,STREET1:1024,STREET2:1024,CITY:1024,REGION:1024,POSTAL_CODE:12}},72549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scanComplianceInfoForMissingData=t.isBusinessCompliant=t.getGrievanceOfficerDetailsError=t.getEntityTypeText=t.getCustomerCareDetailsError=t.existsGrievanceOfficerDetailsContact=t.existsFieldIgnoreHardEnforcement=t.existsField=t.existsCustomerCareDetailsContact=void 0;var n=r(48360),i=r(93170),a=r(9978),o=r(57701);t.getEntityTypeText=e=>{const{entityType:t,entityTypeCustom:r,isRegistered:a}=e||{},o={[i.businessTypeOptions.limitedLiabilityPartnership]:n.fbt._("Limited liability partnership",null,{hk:"2dwmwU"}),[i.businessTypeOptions.soleProprietorship]:n.fbt._("Sole proprietorship",null,{hk:"2N7jks"}),[i.businessTypeOptions.partnership]:n.fbt._("Partnership",null,{hk:"ZeckL"}),[i.businessTypeOptions.publicCompany]:n.fbt._("Public Company",null,{hk:"1YuMvC"}),[i.businessTypeOptions.privateCompany]:n.fbt._("Private Company",null,{hk:"WL0uU"}),[i.businessTypeOptions.other]:n.fbt._("Other",null,{hk:"3zua5D"})},s=r||o[t]||"";if(!s)return"";let l="";return[i.businessTypeOptions.partnership,i.businessTypeOptions.other].includes(t)&&(l=a?n.fbt._("Registered Business",null,{hk:"3N1x9I"}):n.fbt._("Not Registered Business",null,{hk:"2zDsuK"})),`${s.toString()}${l?` (${l.toString()})`:""}`};const s=(e,t)=>!(!e&&!t),l=e=>!!(null==e?void 0:e.trim());t.existsFieldIgnoreHardEnforcement=l;const c=(e,t)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||l(e);t.existsField=c;const d=(e,t,r,n,i)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||r.some((t=>l(t===n?i:null==e?void 0:e[t]))),u=(e,t,r,n)=>d(e,t,["mobileNumber","landlineNumber"],r,n);t.existsCustomerCareDetailsContact=u;const p=(e,t,r,n)=>d(e,t,["mobileNumber","landlineNumber","email"],r,n);t.existsGrievanceOfficerDetailsContact=p;t.isBusinessCompliant=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(r.user))return!0;if(!t)return!1;const{entityName:n,entityType:i,entityTypeCustom:a,customerCareDetails:l,grievanceOfficerDetails:d}=t;return[e,n,null==l?void 0:l.email,null==d?void 0:d.name].every((e=>c(e,r)))&&s(i,a)&&u(l,r)&&p(d,r)};t.getCustomerCareDetailsError=(e,t,r,n,i)=>u(e,i,t,r)?n:"";t.getGrievanceOfficerDetailsError=(e,t,r,n,i)=>p(e,i,t,r)?n:"";t.scanComplianceInfoForMissingData=e=>{const t=(null==e?void 0:e.countryCodeOrigin)===String(a.SyntheticCountryCode.NotApplicable),r=!t&&void 0!==(null==e?void 0:e.countryCodeOrigin),n=!t&&void 0!==(null==e?void 0:e.importerName);return{isExempt:t,hasImporterAddress:!t&&void 0!==(null==e?void 0:e.importerAddress)&&[e.importerAddress.street1,e.importerAddress.street2,e.importerAddress.city,e.importerAddress.region,e.importerAddress.postalCode,e.importerAddress.countryCode].some((e=>e)),hasImporterName:n,hasCountryCodeOrigin:r}}},52804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cypherStringToString=function(e){return e},t.genCypher=function(){return o.apply(this,arguments)},t.stringToCypherString=function(e){return e};var i=n(r(48926)),a=r(48808);function o(){return(o=(0,i.default)((function*(e,t,r){try{const{subtle:n}=yield(0,a.getEngine)(),i=yield n.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),o=(0,a.arrayBufferToBase64)(yield n.encrypt({name:"AES-GCM",iv:new Uint8Array((0,a.base64ToArrayBuffer)(t)),tagLength:128},i,(0,a.stringToArrayBuffer)(JSON.stringify(r)))),s=yield n.exportKey("raw",i);return`AesKey=${yield(0,a.encryptWithPublicKey)(e,s)};IV=${t};Data=${o}`}catch(e){return __LOG__(3)`[direct-connection] cypher creation failed with ${e.toString()}`,null}}))).apply(this,arguments)}},7003:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enablePostcodeInCatalog=function(){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return(0,s.getABPropConfigValue)("web_abprop_direct_connection_md");return!1},t.genDirectConnectionMessageModifiers=function(){return y.apply(this,arguments)},t.supportsDirectConnection=h;var i=n(r(48926)),a=r(15461),o=r(45454),s=r(86945),l=r(56149),c=r(24808),d=r(7293),u=r(64551);function p(){return((0,l.getBusinessProfileQueryVersion)()&l.DIRECT_CONNECTION_FLAG)>0}function f(){return u.ServerProps.isDirectConnectionForPLMTransparent&&(!d.GK.supportsFeature(d.GK.F.MD_BACKEND)||!(0,s.getABPropConfigValue)("web_abprop_direct_connection_md"))}function _(e,t){return e===a.MSG_TYPE.LIST&&t===c.Message$ListMessageListType.PRODUCT_LIST}function h(){return d.GK.supportsFeature(d.GK.F.MD_BACKEND)?(0,s.getABPropConfigValue)("web_abprop_direct_connection_md"):f()}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,n){var i;if(f()||!_(e,t)||!n)return!1;if(!p())return __LOG__(3)`[direct-connection] This web client cannot detect if the product list message recevied is coming from a direct connection business`,"unknown";const a=(0,o.createWid)(n),{BusinessProfileCollection:s}=r(93581);let l=s.get(a);return l&&l.profileOptions||(l=yield s.find(a)),(null===(i=l.profileOptions)||void 0===i?void 0:i.directConnection)||!1}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r){const n=yield g(e,t,r);return!0!==n||h()?{requiresDirectConnection:n}:{requiresDirectConnection:n,type:a.MSG_TYPE.UNKNOWN,subtype:"phone_only_feature"}}))).apply(this,arguments)}},48808:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToBase64=f,t.arrayBufferToString=h,t.base64ToArrayBuffer=p,t.certificateStringToString=function(e){return e},t.encodeToString=function(e){return e.map((e=>{const t=f(e.toSchema(!0).toBER(!1)).split(/(.{0,64})/g).filter((e=>""!==e)).join("\n");return`${s}\n${t}\n${l}`})).join("\n")},t.encryptWithPublicKey=function(){return O.apply(this,arguments)},t.extractCertificates=S,t.fetchFromCABundle=function(){return E.apply(this,arguments)},t.genRootIssuers=function(){return C.apply(this,arguments)},t.getCommonName=A,t.getEngine=b,t.getRandomValues=function(){return M.apply(this,arguments)},t.stringToArrayBuffer=_,t.stringToCertificateString=function(e){return e},t.validateCertificates=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(57291)),o=r(29595);const s="-----BEGIN CERTIFICATE-----",l="-----END CERTIFICATE-----",c=`(?:${s})((?:.|\n)*?)(?:${l})`;function d(){return r.e(6352).then(r.bind(r,63008))}function u(){return r.e(6352).then(r.bind(r,65267))}function p(e){let t="";try{t=atob(e)}catch(e){__LOG__(3)`[direct-connection] base64 decoding failed with ${e.toString()}`}return _(t)}function f(e){return btoa(h(e))}function _(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}function h(e){return String.fromCharCode(...Array.from(new Uint8Array(e)))}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{CertificateChainValidationEngine:r}=yield d();return new r({trustedCerts:t,certs:e})}))).apply(this,arguments)}function y(e,t){return e.flat().reduce(((e,r)=>e.every((e=>!(0,o.isEqualBuffer)(e.tbs,r.tbs)))&&t.includes(r)?[...e,r]:e),[])}function E(){return(E=(0,i.default)((function*(){const{CA_BUNDLE:e}=yield r.e(239).then(r.bind(r,20544));return S(e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{Certificate:t}=yield d(),{fromBER:r}=yield u();return(0,a.default)(Array.from(e.matchAll(new RegExp(c,"gm"))).map((e=>{let[n,i]=e;const{result:a}=r(p(i));let o;try{o=a.error?null:new t({schema:a})}catch(e){__LOG__(3)`[direct-connection] certificate chain parsing from Get Public Key IQ failed with ${e.toString()}`}return o})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){return(yield g(e,t)).verify()}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){const r=yield g(e,t),n=y(yield Promise.all(e.map((e=>r.findIssuer(e,r)))),t);return 0===n.length?(__LOG__(3)`[direct-connection] no trusted root certificates could be found for ${A(e[0])}`,null):n}))).apply(this,arguments)}function A(e){var t;return null===(t=e.issuer.typesAndValues.find((e=>{let{type:t}=e;return"2.5.4.3"===t})))||void 0===t?void 0:t.value.valueBlock.value}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){const{getEngine:e}=yield d();return e()}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){const{getRandomValues:t}=yield d();return t(e)}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const r=yield e.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]}}),n=yield b();return f(yield n.subtle.encrypt({name:"RSA-OAEP"},r,t))}))).apply(this,arguments)}},31912:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemParentType=void 0;const n=r(76672).Mirrored(["Chat","Contact","Msg"]);t.LabelItemParentType=n},905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToLabelCollection=a,t.createLabelItemId=s,t.getParentCollection=function(e){switch(e){case i.LabelItemParentType.Chat:return r(69951).ChatCollection;case i.LabelItemParentType.Contact:return r(19380).ContactCollection;case i.LabelItemParentType.Msg:return r(59871).MsgCollection}},t.getParentTypeFromModel=o,t.initializeLabels=function(e){const t=o(e);if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))e.labels=r(16770).LabelCollection.getLabelsForModel(e.id.toString(),t);else{const r=()=>{a(e.id.toString(),e.labels,t)};r(),e.listenTo(e,"change:labels",r)}},t.removeLabelFromCollection=function(e,t,a){const o=r(16770).LabelCollection.get(t),l=null==o?void 0:o.labelItemCollection;if(!l)return void __LOG__(3)`labelItemCollection does not exist for lableId ${t}`;l.remove(s(e,t,a)),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&a===i.LabelItemParentType.Chat&&l.remove(s(e,t,i.LabelItemParentType.Contact))};var n=r(7293),i=r(31912);function a(e,t,a){if(t&&t.length>0){const o=r(16770).LabelCollection;t.forEach((t=>{const r=o.gadd({id:t});r.labelItemCollection.gadd({id:s(e,t,a),labelId:t,parentId:e,parentType:a}),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&a===i.LabelItemParentType.Chat&&r.labelItemCollection.gadd({id:s(e,t,i.LabelItemParentType.Contact),labelId:t,parentId:e,parentType:i.LabelItemParentType.Contact})}))}}function o(e){if(e instanceof r(63183).Chat)return i.LabelItemParentType.Chat;if(e instanceof r(121).default)return i.LabelItemParentType.Contact;if(e instanceof r(17304).Msg)return i.LabelItemParentType.Msg;throw new Error("getParentTypeFromModel: model is invalid")}function s(e,t,r){return`${e}_${t}_${r}`}},69340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return JSON.parse(e)},t.stringify=function(e){return JSON.stringify(e)}},43390:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.businessHoursFromConfig=d,t.dayToWeekday=c,t.getBusinessHours=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{config:r}=e,n=(new Date).getDay(),i=o.DAYS_OF_WEEK.map(((e,i)=>{const a=(n+i)%o.DAYS_OF_WEEK.length,s=o.DAYS_OF_WEEK[a];return{day:c(a),hours:d(r[s],t).toString(),first:0===i}}));return i},t.getBusinessHoursForEdit=function(e){const t=null==e?{}:e.config,{note:r,timezone:n}=e||{};let i;const s=o.DAYS_OF_WEEK.map(((e,r)=>{const n=t[e],o=a.default.weekdays(r);let s;return n&&(i=n.mode,n.hours&&(s=n.hours.map((e=>{let[t,r]=e;return[(0,l.minutesToTime)(t),(0,l.minutesToTime)(r)]})))),{dayName:o,dayKey:e,closed:!n,hours:s}})),c=a.default.weekdays(!0,0),d=a.default.weekdays().indexOf(c),u=s.splice(d);return{mode:i,days:[...u,...s],timezone:n,note:r}},t.getWebsiteLink=function(e){return`https://l.wl.co/l?u=${encodeURIComponent(e)}`},Object.defineProperty(t,"minutesToTime",{enumerable:!0,get:function(){return l.minutesToTime}}),Object.defineProperty(t,"timeStringToMinutes",{enumerable:!0,get:function(){return l.timeStringToMinutes}});var i=r(48360),a=n(r(30381)),o=r(93170),s=n(r(43725)),l=r(84918);function c(e){return a.default.weekdays(e)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(null==e?void 0:e.mode){case o.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:return t?p(null==e?void 0:e.hours):u(null==e?void 0:e.hours);case o.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:return i.fbt._("By appointment only",null,{hk:"e1vew"});case o.BUSINESS_HOUR_MODES.OPEN_24H:return i.fbt._("Open 24 hours",null,{hk:"1AlfF5"});default:return i.fbt._("Closed",null,{hk:"3IRgct"})}}function u(e){return e?e.map((e=>e.map(l.minutesToTime).join(" - "))).join("\n"):""}function p(e){if(1===(null==e?void 0:e.length))return e[0].map(l.minutesToTime).join(" - ");if(2===(null==e?void 0:e.length)){const t=(0,l.minutesToTime)(e[0][0]),r=(0,l.minutesToTime)(e[0][1]),n=(0,l.minutesToTime)(e[1][0]),i=(0,l.minutesToTime)(e[1][1]);return s.default.t(240,{openTime:t,closeTime:r,additionalOpenTime:n,additionalCloseTime:i})}return""}},84918:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.minutesToTime=function(e){return i.default.utc().startOf("day").add(e,"minutes").format(a.Clock.timestampStrFormat())},t.timeStringToMinutes=void 0;var i=n(r(30381)),a=r(22683);const o=["h:mm A","h:mmA","HH:mm","HH.mm","H:mm","H.mm"];t.timeStringToMinutes=e=>{let t;const r=e.trim();if(!r)return;for(const e of o){const n=(0,i.default)(r,e,!0);if(n.isValid()){t=n;break}}if(!t)return;const n=t,a=(0,i.default)().startOf("day"),s=n.diff(a);return i.default.duration(s).asMinutes()}},29126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case n.VERIFIED_LEVEL.HIGH:return"high";case n.VERIFIED_LEVEL.LOW:return"low";case n.VERIFIED_LEVEL.UNKNOWN:default:return"unknown"}};var n=r(93170)},48277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(81109)),o=r(13959),s=r(92844),l=r(41075),c=r(10823),d=n(r(87045)),u=r(88102),p=r(17186),f=r(45606),_=r(10058),h=n(r(73407)),g=r(15998),m=n(r(52991)),y=r(40126),E=r(41037),S=r(83578),v=r(49801),T=n(r(11339)),C=r(58052),A=r(24872),b=r(74028),P=r(38804),M=r(89751),O=r(15772),I=r(65044);const w=r(76672).Mirrored(["NotStarted","InProcess","Completed"]),R={initialChatHistory:!1,readReceipts:!1,syncdCritical:!1},D={initialChatHistoryTotalMsg:-1,initialChatHistoryTotalChats:-1};const N=new class{constructor(){this._criticalState={},this._debugOnlyState={},this._progressiveHistorySyncRemainingIteration=25,this._progressiveHistorySyncInFlight=!1,this._allCriticalDataSynced=!1,this._syncDCriticalDataTimeout=null,this.initState()}initState(){this._criticalState=(0,a.default)({},R),this._debugOnlyState=(0,a.default)({},D),this._syncDCritcalDataState=w.NotStarted}_isCriticalSyncDoneThisSession(){for(const e in this._criticalState)if(!this._criticalState[e])return!1;return!0}_setSynced(e){__LOG__(2)`[bootstrap] completed sync for ${e}`,this._criticalState[e]=!0,this._isCriticalSyncDoneThisSession()&&(__LOG__(2)`[bootstrap] critical sync done`,(0,C.setAllCriticalDataSynced)(),u.Cmd.criticalSyncDone(),m.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),this.syncNonCriticalData())}_syncContactsInChunks(e,t){return(0,i.default)((function*(){__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${e?t.length+1:0} chunks of contacts during the inital sync`,null!=e&&(yield(0,_.syncContactListJob)(Array.from(e),!1));for(let e=0;e<t.length;e++){const r=Array.from(t[e]);yield(0,o.delayMs)(2e4),yield(0,_.syncContactListJob)(r)}__LOG__(2,void 0,void 0,void 0,["contact-sync"])`inital contact sync completes`}))()}_syncDeviceList(e){if(null==e)return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`syncMostRecentDevices has no contact to sync during bootstrap`,Promise.resolve();__LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync ${e.size} contacts for device info during the initial sync`;const t=Array.from(e);return(0,c.syncDeviceListJob)(t,null,null).catch((e=>{__LOG__(4,!0,new Error,!0)`Sync device failed`,SEND_LOGS("Sync device failed: "+e)}))}setReadReceiptsSynced(){this._setSynced("readReceipts")}setInitialChatHistorySynced(){this._setSynced("initialChatHistory")}setSyncDCriticalSynced(){this._syncDCritcalDataState=w.Completed,this._criticalState.syncdCritical||this._setSynced("syncdCritical")}syncNonCriticalData(){let e=[];(0,b.queryAndUpdateAllGroupMetadata)().then((()=>{e=(0,A.getAllContactsFromChatCollectionIntoChunks)(),this._syncDeviceList(e[0]),(0,A.getAndUpdateNonAddressBookContacts)()})).then((()=>{setTimeout(function(){this._syncContactsInChunks(e[0],e.slice(1,e.length))}.bind(this),4e4)})),(0,y.getAndUpdateStatus)(),(0,l.getAndUpdateProfilePicture)(),(0,l.updateBlocklist)(),(0,P.markCollectionsForSync)([f.CollectionName.Regular,f.CollectionName.RegularLow,f.CollectionName.RegularHigh])}markInitialHistorySyncCountDebugStats(e,t){this._debugOnlyState={initialChatHistoryTotalMsg:e,initialChatHistoryTotalChats:t}}isSyncDCriticalDataSyncInProcess(){return this._syncDCritcalDataState===w.InProcess}_initCriticalDataTimeoutIfNeeded(){var e=this;null==this._syncDCriticalDataTimeout&&(__LOG__(2)`[bootstrap] setting critical data syncd timeout (${180})`,this._syncDCriticalDataTimeout=setTimeout((0,i.default)((function*(){(yield e._isSyncDCriticalDataComplete())||(__LOG__(2)`[bootstrap] syncd critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,p.triggerCriticalSyncLogout)()),(0,C.getInitialHistorySyncComplete)()||(__LOG__(2)`[bootstrap] history sync critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,p.triggerCriticalSyncLogout)()),__LOG__(2)`[bootstrap] all critical data synced within timeout period`})),18e4))}_isSyncDCriticalDataComplete(){return(0,i.default)((function*(){const e=yield h.default.getSyncActionsRows(["action"],[f.Actions.SettingPushName]);return e.length>0&&null!=e.find((e=>e.actionState===f.SyncActionState.Success))}))()}setSyncDCriticalDataSyncCompleted(){var e=this;return(0,i.default)((function*(){null!=e._syncDCriticalDataTimeout&&(yield new T.default.MdBootstrapDataApplied({mdBootstrapPayloadType:T.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL,mdBootstrapSource:T.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield v.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,s.unixTimeMs)()}).commit(!0))}))()}getCriticialSyncDebugSummary(){return this.isCriticalDataSynced()?"-------\nAll critical data synced\n-------\n\n":`-------\n Initial history sync complete: ${(0,C.getHistorySyncStatus)()?"true":this._criticalState.initialChatHistory.toString()}\n Initial msgs: ${this._debugOnlyState.initialChatHistoryTotalMsg}, initial chats: ${this._debugOnlyState.initialChatHistoryTotalChats}\n Receipt sync complete: ${this._criticalState.readReceipts.toString()} \n Critical collection sync complete: ${this._criticalState.syncdCritical.toString()} \n-------\n`}isCriticalDataSynced(){return this._allCriticalDataSynced=this._allCriticalDataSynced||(0,C.getAllCriticalDataSynced)(),this._allCriticalDataSynced}syncCriticalData(){var e=this;return(0,i.default)((function*(){m.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),__LOG__(2)`[bootstrap] need to sync critical data: true`,__LOG__(2)`[bootstrap] ${e.getCriticialSyncDebugSummary()}`,__LOG__(2)`[bootstrap] syncing my device list`;const t=(0,c.syncMyDeviceListJob)(),r=(0,l.updatePrivacySettings)().then((()=>{e.setReadReceiptsSynced()})).catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync privacy settings ${e.stack}`,SEND_LOGS("failed to update privacy settings from privacy request to webd"),I.Socket.logout(!1,S.LogoutReason.AccountSyncError)}));(0,M.updateSyncdDisabledDueToFatalFlag)(!1),e._initCriticalDataTimeoutIfNeeded(),e._syncDCritcalDataState=w.InProcess;const n=t.then((()=>(0,P.markCollectionsForSync)([f.CollectionName.CriticalBlock,f.CollectionName.CriticalUnblockLow]))).then((0,i.default)((function*(){e._criticalState.syncdCritical||(yield e._isSyncDCriticalDataComplete())&&(e.setSyncDCriticalSynced(),yield e.setSyncDCriticalDataSyncCompleted())})));(0,C.getInitialHistorySyncComplete)()&&e.setInitialChatHistorySynced();const a=(0,l.updateDefaultDisappearingMode)().catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync default disappearing mode ${e.stack}`,SEND_LOGS("failed initial sync of default disappearing mode")}));yield Promise.all([r,n,a])}))()}continueProgressiveHistorySyncProcessing(){__LOG__(2)`[history sync] continueProgressiveHistorySyncProcessing`;const e="Safari"!==d.default.info().name;this._initNextProgressiveHistorySyncRunLoop(e)}_progressiveHistorySyncRun(){var e=this;return(0,i.default)((function*(){if(!e._allCriticalDataSynced&&!0!==e._criticalState.initialChatHistory)return __LOG__(2)`[history sync] Skip processLoop, until initial sync is complete`,void e._progressiveHistorySyncRemainingIteration++;if(!u.Cmd.isMainStreamReadyMd)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Skip processLoop, until main is loaded`,void e._progressiveHistorySyncRemainingIteration++;const t=yield(0,E.fetchNextHitorySyncChunkForProcessing)();if(!t)return;__LOG__(2)`[history sync] processLoop picked up chunk`,e._progressiveHistorySyncRemainingIteration++;const n=r(19655).handleHistorySyncChunk;yield n(t)}))()}_initNextProgressiveHistorySyncRunLoop(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,i.default)((function*(){if(t&&e._progressiveHistorySyncRemainingIteration++,!e._progressiveHistorySyncInFlight&&e._progressiveHistorySyncRemainingIteration>0){e._progressiveHistorySyncRemainingIteration--,e._progressiveHistorySyncInFlight=!0;try{yield g.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield e._progressiveHistorySyncRun()}catch(e){__LOG__(4,void 0,new Error)`[History sync] _progressiveHistorySyncRun failed with ${null==e?void 0:e.message}, stack: ${null==e?void 0:e.stack}`}e._progressiveHistorySyncInFlight=!1,yield new Promise((e=>setTimeout(e,2e4))),e._initNextProgressiveHistorySyncRunLoop()}}))()}};u.Cmd.on("on_initial_chat_synced",(()=>{N.setInitialChatHistorySynced()})),u.Cmd.on("logout",(()=>{N.initState()}));var L=N;t.default=L},87045:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(15688),o=r(65127);let s=!1;const l=(0,i.default)((()=>s=!1),500);var c={id(){const e=r(99234);let t=e.getBrowserId();if(t)return t;const n=new Uint8Array(16);return self.crypto.getRandomValues(n),t=(0,a.encodeB64)(n),e.setBrowserId(t),t},info(){const e=o.UA.parser.getResult();return{os:e.os.name,version:e.os.version,name:e.browser.name,ua:e.browser.name+" "+e.browser.version}},hardRefresh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.promptUnloadGuards++,e){r(99234).setNoTakeover(!0)}location.reload(t)},startDownloading(){s=!0,l()},clearDownloading(){s=!1},isDownloading:()=>s,promptUnloadGuards:0,open(e){window.open(e,"_blank","noopener,noreferrer")}};t.default=c},11365:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intToBytes=function(e,t){let r=t;const n=new Uint8Array(e);for(let t=e-1;t>=0;t--)n[t]=255&r,r>>>=8;return n},t.uint8ArrayToBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}},92589:()=>{!function(e){var t;const r=null===(t=e.HTMLCanvasElement)||void 0===t?void 0:t.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){let t,r,o,s,l,c,d,u,p;if(t=e.match(/^data:((.*?)(;charset=.*?)?)(;base64)?,/),!t)throw new Error("invalid data URI");for(r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),o=!!t[4],s=e.slice(t[0].length),l=o?atob(s):decodeURIComponent(s),c=new ArrayBuffer(l.length),d=new Uint8Array(c),u=0;u<l.length;u+=1)d[u]=l.charCodeAt(u);return n?new Blob([i?d:c],{type:r}):(p=new a,p.append(c),p.getBlob(r))};e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){n&&r.toDataURL&&o?e(o(this.toDataURL(t,n))):e(this.mozGetAsFile("blob",t))}:r.toDataURL&&o&&(r.toBlob=function(e,t,r){e(o(this.toDataURL(t,r)))})),e.dataURLtoBlob=o}(window)},35718:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addBorder=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";const n=document.createElement("canvas"),i=n.getContext("2d"),a=document.createElement("canvas"),o=a.getContext("2d"),s=2*t;n.width=a.width=e.width+2*s,n.height=a.height=e.height+2*s,i.drawImage(e,s,s),o.shadowColor=r,o.shadowBlur=1;for(let e=0;e<s;e++)o.drawImage(n,0,0),i.drawImage(a,0,0);return o.shadowColor="rgba(0,0,0,0)",o.drawImage(e,s,s),a},t.canvasToBlob=l,t.canvasToWebp=function(e){{const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return(0,s.default)(t.data,e.width,e.height,{ensureExtendedFormat:!0})}},t.contain=function(e,t){const{width:r,height:n}=(0,a.boundHeightWidth)(e.height,e.width,t);if(r>e.width&&n>e.height)return e;const i=document.createElement("canvas"),o=i.getContext("2d");return i.width=r,i.height=n,o.drawImage(e,0,0,r,n),i},t.copy=u,t.createCanvas=d,t.fillBackgroundWithGray=function(e){const t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)},t.generateMicroThumb=function(){return c.apply(this,arguments)},t.getResizedDataUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",r=arguments.length>2?arguments[2]:void 0;const n=e.toDataURL(t),i=window.dataURLtoBlob(n);if(i.size<=r)return e.toDataURL(t);for(let n=.9;n>=.1;n-=.1){const i=e.toDataURL(t,n);if(window.dataURLtoBlob(i).size<=r)return i}return null},t.resize=function(e,t,r){const n=e.getContext("2d"),i=n.getImageData(0,0,t,r);e.width=t,e.height=r,n.putImageData(i,0,0)},t.rotate=function(e,t){const r=t.x||0,n=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180));e.translate(r,n),e.rotate(t.radians),e.translate(-r,-n)},t.scale=function(e,t){const r=e.getContext("2d"),n=u(e),{width:i,height:o}=(0,a.aspectRatioScaled)(e.width/e.height,t);e.width=i,e.height=o,r.drawImage(n,0,0,i,o)},t.square=function(e){const t=e.getContext("2d"),r=e.width,n=e.height,i=t.getImageData(0,0,r,n),a=Math.max(r,n);e.width=a,e.height=a,t.clearRect(0,0,r,n),t.putImageData(i,(a-r)/2,(a-n)/2,0,0,r,n)},t.trim=function(e){if(function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.data.length/4;let n;for(n=0;n<r;n++){if(0!==t.data[4*n+3])return!1}return!0}(e))return;const{left:t,top:r,right:n,bottom:i}=function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.data.length/4;let n,i=1/0,a=1/0,o=0,s=0;for(n=0;n<r;n++){if(0===t.data[4*n+3])continue;const r=n%e.width,l=Math.floor(n/e.width);r<i&&(i=r),r>o&&(o=r),l<a&&(a=l),l>s&&(s=l)}return{left:i,top:a,right:o,bottom:s}}(e),a=i-r,o=n-t,s=e.getContext("2d").getImageData(t,r,o,a),l=d(o,a);return l.getContext("2d").putImageData(s,0,0),l};var i=n(r(48926)),a=r(38034),o=n(r(34949)),s=n(r(7030));function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";return e.toBlob?new Promise((function(r){e.toBlob(r,t)})):Promise.resolve(window.dataURLtoBlob(e.toDataURL(t)))}function c(){return(c=(0,i.default)((function*(e,t,r){var n,i;const a=r||{},s=null!==(n=a.mimetype)&&void 0!==n?n:"image/jpeg",c=null!==(i=a.maxAttempts)&&void 0!==i?i:10;let u=.5,p=e,f=yield l(p,s);for(let r=0;r<c&&!(f.size<=t);r++){const t=Math.floor(e.width*u),r=Math.floor(e.height*u);p=d(t,r);p.getContext("2d").drawImage(e,0,0,t,r),f=yield l(p,s),u*=.5}return{opaqueData:yield o.default.createFromData(f,s),width:p.width,height:p.height,dataUrl:p.toDataURL("image/jpeg")}}))).apply(this,arguments)}function d(e,t){const r=document.createElement("canvas");return r.width=e,r.height=t,r}function u(e){const t=d(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t}},85965:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_REQUESTED=void 0,t.sendLogs=function(){return U.apply(this,arguments)},t.upload=I,t.uploadUserReport=function(){return L.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=n(r(23493)),s=n(r(11854)),l=r(86469),c=r(88102),d=r(17239),u=r(99234),p=r(2383),f=r(82867),_=r(7293),h=n(r(52991)),g=r(70818),m=r(82449),y=r(89618),E=r(2541);const S=e=>new Promise((t=>setTimeout(t,e))),v=r(76672)({CRASHLOG:"crashlog",SUPPORT:"support"}),T=r(76672)({ONLY_EXCEPTION:"only_exception"}),C={shouldHitCheckEndpoint:()=>!1,expectedCodes:[],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},A={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},b={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:e=>{e.append("support_exception_only_upload","true")},appendToFormDataForUpload:(e,t)=>{t&&t.upload===T.ONLY_EXCEPTION&&e.append("exception_only_upload","true")},shouldUseLightWeightLogs:e=>!!e&&e.upload===T.ONLY_EXCEPTION};function P(e,t,r){return r?C:t?b:A}const M="server-requested";t.SERVER_REQUESTED=M;const O=(0,o.default)(R,36e5);function I(){return w.apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){let{reason:t,immediate:r=!1,force:n=!1,persist:i=!1,isHighPri:a=!1,nativeCrash:o,voipLog:s,skipSampling:u=!1,hasTaggedMessage:p=!1,ticketId:g}=e;if(h.default.isLogoutInProgress)return Promise.resolve();let E=i?v.SUPPORT:v.CRASHLOG;c.Cmd.logSocketSummary(),__LOG__(2)`Focus at time of upload:`;try{y.UIM.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}__LOG__(2)`==================================================`,__LOG__(2)`wa:uploadLogs ref: ${d.Conn.ref||"no conn"}`,__LOG__(2)`wa:uploadLogs hash: ${"19eab8dab4bc390c285bbc801c5e1aa967b80e7b"}`,__LOG__(2)`wa:uploadLogs version: ${"2.2208.7"}`,__LOG__(2)`wa:uploadLogs userAgent: ${navigator.userAgent}`,__LOG__(2)`wa:uploadLogs platform: ${d.Conn.platform||"no platform"}`,__LOG__(2)`wa:uploadLogs webPlatform: ${"web"}`,__LOG__(2)`wa:uploadLogs appId: ${""}`,__LOG__(2)`wa:uploadLogs url: ${location.href}`,__LOG__(2)`wa:uploadLogs distribution: ${(0,f.getDistribution)()}`,__LOG__(2)`wa:uploadLogs buildId: ${"354741050"}`,__LOG__(2)`wa:uploadLogs mdOptIn: ${_.GK.supportsFeature(_.GK.F.MD_BACKEND)}`,p&&__LOG__(2)`wa:uploadLogs hasTaggedMessage`;let S=null;if(void 0===t)E=v.SUPPORT,__LOG__(2)`reason for logs: manual-upload`,S=!0;else if(t){let e=t;_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&(e=`[MD] ${t}`),__LOG__(2)`reason for logs: ${e}`}__LOG__(2)`${m.END_OF_UPLOAD}`;let T=R;if(!S&&!n){if(!(Math.random()<l.UPLOAD_TO_CLB))return void __LOG__(2)`wa:uploadLogs squelched logs`;T=O}const C=P(0,p,t===M);try{return yield T({isHighPri:a,immediate:r,logType:E,nativeCrash:o,voipLog:s,skipSampling:u,ticketId:g,getFullLogs:t===M,uploadStrategy:C})}catch(e){__LOG__(2)`wa:uploadLogs error uploading: ${e}`}}))).apply(this,arguments)}function R(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e){let t,{isHighPri:r,immediate:n,logType:i,nativeCrash:a,voipLog:o,skipSampling:c=!1,ticketId:d,getFullLogs:u=!1,uploadStrategy:p}=e;if(yield S(n?0:500),p.shouldHitCheckEndpoint()){const e=N({isHighPri:r});if(p.appendToFormDataForCheck(e),t=yield s.default.post(k(i),e),!p.expectedCodes.includes(t.status))throw new Error(`Status code of ${t.status} from ${l.CLB_CHECK_URL} was unexpected, expected values are: ${p.expectedCodes.toString()}`);if(403===t.status)throw new Error("Aborting CLB upload due to 403 response")}else __LOG__(2)`CLB:doUpload skipping sampling check`;let f=null;if(t)try{f=JSON.parse(t.responseText)}catch(e){__LOG__(2)`CLB:failed to parse response from upload check ${String(e)}, will perform default upload`}const _=N({isHighPri:r});p.appendToFormDataForUpload(_,f);const h=(yield g.Logger.getLogs(u,p.shouldUseLightWeightLogs(f))).join("\n"),m=new Blob([h],{type:"text/plain"});_.append("file",m,"logs.txt"),d&&_.append("ticket_id",d),a&&(_.append("attachment",new Blob([a.contents],{type:"application/octet-stream"}),a.filename),_.set("agent",a.agent),_.append("tags","electron_native"),o&&_.append("voip_log",new Blob([o.contents],{type:"text/plain"}),o.filename));const y=G(i),E=yield s.default.post(y,_);if(200!==E.status)throw new Error(`Status code of ${E.status} from ${y} was unexpected, expected 200`);return E.getResponseHeader("X-Uploaded-File-Id")}))).apply(this,arguments)}function N(e){let{isHighPri:t}=e;const n=new FormData;t&&n.append("forced","true");const i=(0,u.getMe)();i&&n.append("from_jid",i.toString());const a=r(87045).default.info(),o=(0,f.getLogUserAgent)({device:a.os,browser:a.ua,appVersion:"2.2208.7"});return n.append("agent",o),n.append("app_id",""),n.append("build_id","354741050"),_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&n.append("md_opt_in","true"),n}function L(){return(L=(0,a.default)((function*(e,t,r,n,a){try{__LOG__(2)`CLB:uploadUserReport uploading`,__LOG__(2,!0)`CLB:uploadUserReport description: ${n}`;const o=yield I({reason:"user-report",immediate:!0,force:!0,persist:!0}),c=(0,u.getLoginTokens)().server,d=new FormData;c&&d.append("tok",c),null!=e&&d.append("user",String(e)),d.append("email",t),o&&d.append("crashlog",o),d.append("desc",n),a.map(((e,t)=>{d.append(`screenshot-${t}`,e)}));const f=(0,p.getDebugInfo)(),_=(0,i.default)((0,i.default)({},f),{},{subject:r});d.append("info",JSON.stringify(_)),__LOG__(2)`CLB:uploadUserReport submitting`,yield s.default.post(l.TICKET_URL,d),__LOG__(2)`CLB:uploadUserReport succeeded`}catch(e){__LOG__(2)`CLB:uploadUserReport failed ${String(e)}`}}))).apply(this,arguments)}function k(e){return E.URL.build(l.CLB_CHECK_URL,{type:String(e),access_token:l.CLB_TOKEN})}function G(e){return E.URL.build(l.CLB_URL,{type:String(e),access_token:l.CLB_TOKEN})}function U(){return(U=(0,a.default)((function*(e){yield I({reason:e,hasTaggedMessage:!0})}))).apply(this,arguments)}},86469:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_TO_CLB=t.TICKET_URL=t.LOG_SIZE=t.CLB_URL=t.CLB_TOKEN=t.CLB_CHECK_URL=void 0;t.CLB_CHECK_URL="https://crashlogs.whatsapp.net/wa_fls_upload_check";t.CLB_TOKEN="1063127757113399|745146ffa34413f9dbb5469f5370b7af";t.CLB_URL="https://crashlogs.whatsapp.net/wa_clb_data";t.TICKET_URL="https://web.whatsapp.com/web-contact-us";let r=0;r=1;t.UPLOAD_TO_CLB=1;t.LOG_SIZE=4999},22683:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SKEW_CHANGE_EVENT=t.HOUR24_FORMAT_CHANGE_EVENT=t.Clock=void 0;var i=n(r(81109)),a=r(92844),o=r(48360),s=n(r(30381)),l=n(r(34342)),c=n(r(43725)),d=r(53558),u=r(59779);const p=["fi","id","ms","ms-my"],f="skew_change";t.SKEW_CHANGE_EVENT=f;const _="hour24_format_change";t.HOUR24_FORMAT_CHANGE_EVENT=_;class h extends l.default{constructor(){if(super(),this.is24h=!1,this.skewMS=0,this.skew=0,Intl.DateTimeFormat&&Intl.DateTimeFormat().resolvedOptions){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;switch(e?__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone is ${e}`:__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone does not exist`,e){case"America/Sao_Paulo":this.timeZoneHardCode="America/Belem";break;case"America/Campo_Grande":case"America/Cuiaba":this.timeZoneHardCode="America/Porto_Velho"}}}getIs24Hour(){return this.is24h}setIs24Hour(e){e!==this.is24h&&(this.is24h=e,this.trigger(_))}setIs24HourBasedOnLocale(){this.setIs24Hour(d.LOCALES_THAT_PREFER_24HOUR_TIME.has(c.default.getLocale()))}setSkew(e){Math.abs(e)>6e4&&__LOG__(2)`Setting large clockskew: ${e}ms`;const t=this.skewMS;this.skewMS=e,this.skew=Math.round(e/1e3),Math.abs(t-this.skewMS)>1e3&&this.trigger(f)}getSkew(){return this.skew}localUnixTime(e){return void 0!==e?e+this.skew:Math.floor(Date.now()/1e3)}globalUnixTime(e){return void 0!==e?e-this.skew:Math.floor((Date.now()-this.skewMS)/1e3)}globalUnixTimeMilliseconds(){return Math.floor(Date.now()-this.skewMS)}relativeStr(e){const t=e+this.skew;return t>=(0,s.default)().startOf("day").unix()?this._timestampStr(t):this._dateRelativeStr(t,!1)}relativeDateStr(e){return this._dateRelativeStr(e+this.skew,!1)}relativeDateAndTimeStr(e){return this._dateRelativeStr(e+this.skew,!0)}monthStr(e){const t=e+this.skew,r=1e3*t;return t>=(0,s.default)().startOf("month").unix()&&t<=(0,s.default)().endOf("month").unix()?o.fbt._("This Month",null,{hk:"3BBgGL"}):t>=(0,s.default)().startOf("year").unix()&&t<=(0,s.default)().endOf("year").unix()?Intl.DateTimeFormat(s.default.locale(),{month:"long"}).format(r):Intl.DateTimeFormat(s.default.locale(),{month:"long",year:"numeric"}).format(r)}timeStr(e){if(this.shouldUseIntlDateTimeFormat()){const t=1e3*(e+this.skew);let r={hour12:!this.is24h,hour:"numeric",minute:"numeric"},n={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(r=(0,i.default)((0,i.default)({},r),{},{timeZone:this.timeZoneHardCode}),n=(0,i.default)((0,i.default)({},n),{},{timeZone:this.timeZoneHardCode}));return`${Intl.DateTimeFormat(s.default.locale(),r).format(t)}, ${Intl.DateTimeFormat(s.default.locale(),n).format(t)}`}return s.default.unix(e+this.skew).format(this.is24h?`HH${this._hmsSeparator()}mm, l`:"LT, l")}timestampStr(e){return this._timestampStr(e+this.skew)}timestampStrFormat(){return this.is24h?`HH${this._hmsSeparator()}mm`:"LT"}timestampHour(e){const t=e+this.skew,r=s.default.unix(t).hour();return this.is24h?r:r%12}createdStr(e,t){const r=this.daysDelta(e),n=e+this.skew,i=this._timestampStr(n);if(0===r)return t?c.default.t(896,{time:i}):c.default.t(895,{time:i});if(1===r)return t?c.default.t(902,{time:i}):c.default.t(901,{time:i});if(r<7){const e=this._dateRelativeStr(n,!1);return t?c.default.t(900,{day:e,time:i}):c.default.t(899,{day:e,time:i})}const a=this._dateRelativeStr(n,!1);return t?c.default.t(892,{date:a,time:i}):c.default.t(891,{date:a,time:i})}createdByStr(e,t,r){const n=this.daysDelta(e),i=e+this.skew,a=this._timestampStr(i);if(0===n)return r?c.default.t(898,{time:a}):c.default.t(897,{name:t,time:a});if(1===n)return r?c.default.t(904,{time:a}):c.default.t(903,{name:t,time:a});if(n<7){const n=this._dayNameStr(e);return r?o.fbt._("Group created by you, {on_day} at {time}",[o.fbt._param("on_day",n),o.fbt._param("time",a)],{hk:"2dwUQV"}):o.fbt._("Group created by {name}, {on_day} at {time}",[o.fbt._param("name",t),o.fbt._param("on_day",n),o.fbt._param("time",a)],{hk:"34crrC"})}const s=this._dateRelativeStr(i,!1);return r?c.default.t(894,{date:s,time:a}):c.default.t(893,{name:t,date:s,time:a})}_dayNameStr(e){const t=e+this.skew;switch(s.default.unix(t).day()){case 0:return o.fbt._("on Sunday",null,{hk:"3hQdLv"});case 1:return o.fbt._("on Monday",null,{hk:"4uZn7B"});case 2:return o.fbt._("on Tuesday",null,{hk:"4llPGV"});case 3:return o.fbt._("on Wednesday",null,{hk:"4afKlR"});case 4:return o.fbt._("on Thursday",null,{hk:"49dOXK"});case 5:return o.fbt._("on Friday",null,{hk:"3P0f1f"});case 6:return o.fbt._("on Saturday",null,{hk:"1I5myq"});default:throw new Error("Unexpected day number")}}untilStr(e){if(e===u.MUTE_ALWAYS_EXPIRATION_SENTINEL)return o.fbt._("Always",null,{hk:"26Zr18"});const t=this.daysDelta(e),r=e+this.skew,n=this._timestampStr(r);if(0===t)return c.default.t(798,{time:n});if(1===t)return c.default.t(799,{time:n});if(t<7){const e=this._dateRelativeStr(r,!1);return c.default.t(800,{day:e,time:n})}const i=this._dateRelativeStr(r,!1);return c.default.t(797,{date:i,time:n})}lastSeenStr(e){const t=this.daysDelta(e),r=e+this.skew,n=this._timestampStr(r);if(0===t)return c.default.t(866,{time:n});if(1===t)return c.default.t(868,{time:n});if(t<7){const e=this._dateRelativeStr(r,!1);return c.default.t(867,{date:e,time:n})}const i=this._dateRelativeStr(r,!1);return c.default.t(865,{date:i,time:n})}daysDelta(e,t){const r=s.default.unix(e).startOf("day"),n=(void 0===t?(0,s.default)().startOf("day"):s.default.unix(t).startOf("day")).diff(r,"days");return Math.abs(n)}durationStr(e){const t="string"==typeof e?parseInt(e,10):e,r=s.default.utc(1e3*t);if(r.isValid()){const e=t<a.HOUR_SECONDS?"m:ss":"H:mm:ss";return r.format(e)}return""}_getShortTimeLeftStr(e){const t=Math.floor(e/86400);if(t>0)return{time:c.default.t(767,{days:t,_plural:t}),_plural:t};const r=Math.floor(e/3600);if(r>0)return{time:c.default.t(768,{hours:r,_plural:r}),_plural:r};const n=Math.floor(e/60);return n>0?{time:c.default.t(769,{minutes:n,_plural:n}),_plural:n}:{time:c.default.t(770,{seconds:e,_plural:e}),_plural:e}}timeLeftStr(e){return c.default.t(783,this._getShortTimeLeftStr(e))}paymentTimestampStr(e){const t=e+this.skew,r=s.default.unix(t),n=r.startOf("day"),i=(0,s.default)().startOf("day").diff(n,"days");if(0===i)return o.fbt._("today",null,{hk:"445Hu3"});if(1===i)return o.fbt._("yesterday",null,{hk:"qICUM"});if(!(i<7)){const e=r.format("MMMM d");return c.default.t(981,{date:e})}switch(r.day()){case 0:default:return o.fbt._("on Sunday",null,{hk:"2gwfdl"});case 1:return o.fbt._("on Monday",null,{hk:"4ww1V1"});case 2:return o.fbt._("on Tuesday",null,{hk:"3Bz1cZ"});case 3:return o.fbt._("on Wednesday",null,{hk:"493Z1"});case 4:return o.fbt._("on Thursday",null,{hk:"2pNhJx"});case 5:return o.fbt._("on Friday",null,{hk:"Tf9gq"});case 6:return o.fbt._("on Saturday",null,{hk:"1SPYjP"})}}liveLocationLastUpdatedStr(e){const t=e+this.skew,r=this._timestampStr(t),n=s.default.unix(t).startOf("day"),i=(0,s.default)().startOf("day").diff(n,"days");if(0===i)return c.default.t(560,{time:r});if(1===i)return c.default.t(562,{time:r});if(i<6){const e=this._dateRelativeStr(t,!1);return c.default.t(561,{date:e,time:r})}const a=this._dateRelativeStr(t,!1);return c.default.t(559,{date:a,time:r})}_timestampStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={hour12:!this.is24h,hour:"numeric",minute:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));const r=Intl.DateTimeFormat(s.default.locale(),t).format(1e3*e);return this.is24h?r.replace(/^24/,"00"):r.replace(/^0/,"12")}return s.default.unix(e).format(this.timestampStrFormat())}_dateStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));return Intl.DateTimeFormat(s.default.locale(),t).format(1e3*e)}return s.default.unix(e).format("l")}_dateRelativeStr(e,t){const r=(0,s.default)().startOf("day"),n=s.default.unix(e).startOf("day"),i=r.diff(n,"days"),a=this._timestampStr(e);if(0===i)return t?c.default.t(1012,{time:a}):o.fbt._("today",null,{hk:"445Hu3"});if(1===i)return t?c.default.t(1019,{time:a}):o.fbt._("yesterday",null,{hk:"qICUM"});if(!t&&Math.abs(i)<7)return s.default.unix(e).format("dddd");const l=this._dateStr(e);return t?c.default.t(1011,{date:l,time:a}):l}_hmsSeparator(){const e=s.default.locale();return p.includes(e)?".":":"}shouldUseIntlDateTimeFormat(){return Intl.DateTimeFormat&&!d.LOCALE_DATE_TIME_CUSTOMIZATIONS[s.default.locale()]&&!d.SHOULD_USE_MOMENT_LOCALE_FORMAT.has(s.default.locale())}}const g=new h;t.Clock=g},17186:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logoutAfterValidationFail=function(){new a.ShiftTimer((()=>{g()})).onOrAfter(1e3)},t.resetCompanionReg=function(){f=!1,_=!1},t.startInitialHistorySyncTimeout=function(){if(null==y){y=setTimeout(h,18e4);(new c.default).listenTo(s.Cmd,"on_initial_chat_synced",(()=>{clearTimeout(y)}))}},t.startLogin=function(){if(f||_)return;(0,l.setDeviceLinkPairStage)(u.default.MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT),f=!0,(0,o.clearADVSecretKey)(),s.Cmd.restartBackend()},t.startLogout=g,t.triggerCriticalSyncLogout=h;var i=n(r(48926)),a=r(57319),o=r(46308),s=r(88102),l=r(91214),c=n(r(34342)),d=r(83578),u=n(r(11339)),p=r(65044);let f=!1,_=!1;function h(){__LOG__(4,void 0,new Error)`logout due to no critical data`,p.Socket.logout(!1,d.LogoutReason.CriticalSyncTimeout)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){f||_||(_=!0,yield p.Socket.clearCredentialsAndStoredData(),(0,o.clearADVSecretKey)(),s.Cmd.restartBackend())}))).apply(this,arguments)}let y},89520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("ContactBlocked")){constructor(e,t){super(e),this.contact=t}}t.default=i},69830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndMac=function(e,t,r){return(0,o.aesCbcEncrypt)(e,new Uint8Array(r)).then((e=>(0,s.hmacSha256)(t,e).then((t=>a.Binary.build(t,e).readBuffer()))))},t.macAndDecrypt=function(e,t,r){return Promise.resolve(new Uint8Array(r)).then((r=>{const n=(0,i.encodeB64)(r.subarray(0,32)),a=r.subarray(32);return(0,s.hmacSha256)(t,a).then((t=>{const r=(0,i.encodeB64)(t);if(n!==r)throw __LOG__(3)`crypto:macAndDecrypt HMAC don't match ${n} vs. ${r}`,new Error("macAndDecrypt HMAC mismatch");return(0,o.aesCbcDecryptSplit)(e,a)}))}))},t.removeEncryptedPadding=function(e,t){const r=e.slice(-t.byteLength);if((0,n.arrayBuffersDeepEqual)(r,t))return e.slice(0,e.byteLength-t.byteLength);return e};var n=r(95024),i=r(15688),a=r(8584),o=r(81484),s=r(11141)},94e3:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r="whatsapp is da best",n=new Uint8Array(r.split("").map((e=>e.charCodeAt(0))));const i={name:"HMAC",hash:"SHA-256"},a={name:"AES-CBC",length:256},o={name:"ECDH",namedCurve:"P-256"};function s(){return Promise.resolve().then((()=>self.crypto.subtle||self.crypto.webkitSubtle))}var l={supportsHmacSha256:()=>s().then((e=>e.generateKey(i,!1,["sign","verify"]).then((t=>e.sign(i,t,n).then((r=>e.verify(i,t,r,n.buffer))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 signing failed: ${e}`,!1))).then((e=>e?(__LOG__(2)`CryptoSupport:HMAC-SHA256 is verified`,!0):(__LOG__(2)`CryptoSupport:HMAC-SHA256 is not verified`,!1))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 verification failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256: ${e}`,!1))),supportsAesCbc:()=>s().then((e=>e.generateKey(a,!1,["encrypt","decrypt"]).then((t=>Promise.resolve(self.crypto).then((e=>({name:"AES-CBC",iv:e.getRandomValues(new Uint8Array(16))}))).then((i=>e.encrypt(i,t,n).then((r=>e.decrypt(i,t,r))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC encryption failed: ${e}`,!1))).then((e=>{const t=new Uint8Array(e);return n=t,Array.prototype.slice.call(n).map((e=>String.fromCharCode(e))).join("")===r?(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is correct`,!0):(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is incorrect`,!1);var n})).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC decryption failed: ${e}`,!1))))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC: ${e}`,!1))),supportsEcdh:()=>s().then((e=>e.generateKey(o,!1,["deriveKey"]).then((t=>e.generateKey(o,!1,["deriveKey"]).then((r=>{const n={name:"ECDH",namedCurve:"P-256",public:r.publicKey};return e.deriveKey(n,t.privateKey,a,!1,["encrypt","decrypt"]).then((()=>(__LOG__(2)`CryptoSupport:ECDH key derivation succeeded`,!0))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key derivation failed: ${e}`,!1)))})).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key generation #2 failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key generation #1 failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH: ${e}`,!1)))};t.default=l},5087:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.keyPair=function(e){let t;void 0===e?(t=new Uint8Array(32),self.crypto.getRandomValues(t)):t=new Uint8Array(e);return t[0]&=248,t[31]&=127,t[31]|=64,l({pubKey:32,privKey:t,basepoint:i},(function(e){const r=n._curve25519_donna(e.pubKey,e.privKey,e.basepoint);if(r)throw new Error(`Curve25519:keyPair Error Code ${r}`);return{pubKey:s(e.pubKey,32),privKey:t.buffer}}))},t.sharedSecret=function(e,t){return Promise.resolve().then((()=>l({sharedKey:32,pubKey:e,privKey:t},(function(e){const t=n._curve25519_donna(e.sharedKey,e.privKey,e.pubKey);if(t)throw new Error(`Curve25519:sharedSecret Error Code ${t}`);return s(e.sharedKey,32)}))))},t.toCurveKeyPair=function(e){if(33!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=new Uint8Array(32),r=new Uint8Array(32);return t.set(new Uint8Array(e.pubKey).subarray(1)),r.set(new Uint8Array(e.privKey)),{pubKey:t.buffer,privKey:r.buffer}},t.toCurveKeyPubKey=function(e){if(33!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(32);return t.set(new Uint8Array(e).subarray(1)),t.buffer},t.toSignalCurveKeyPair=function(e){if(32!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=a(e.pubKey),r=new Uint8Array(32);return r.set(new Uint8Array(e.privKey)),{pubKey:t,privKey:r.buffer}},t.toSignalCurvePubKey=a,t.verifySignature=function(e,t,r){if(32!==e.byteLength)throw new Error(`Invalid public key length: ${e.byteLength}`);const n=new Uint8Array(33);n[0]=5,n.set(e,1);return!1===window.libsignal.Curve.verifySignature(n,t,r)};const i=new Uint8Array(32);i[0]=9;function a(e){if(32!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(33);return t[0]=5,t.set(new Uint8Array(e),1),t.buffer}function o(e){if("number"==typeof e)return n._malloc(e);const t=new Uint8Array(e.buffer||e),r=n._malloc(t.length);return n.HEAPU8.set(t,r),r}function s(e,t){const r=new Uint8Array(t);return r.set(n.HEAPU8.subarray(e,e+t)),r.buffer}function l(e,t){n||(n=r(23098));const i={};try{for(const t in e)i[t]=o(e[t]);return t(i)}finally{for(const e in i)n._free(i[e])}}},19197:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(40265),a=r(50796),o=r(38284),s=n(r(86128)),l=n(r(30381)),c=n(r(11339)),d=r(35217),u=r(65127);const p={ERROR:"error",OPENING:"opening",BLOCKED:"blocked",OPEN:"open",CLOSED:"closed",FAILED:"failed"};let f=!1,_=null;function h(){this._dbName=d.WEB_IDB_DB_NAMES.wawc,this._db=new s.default(this._dbName),this._db.on("versionchange",(e=>{this._db.close(),__LOG__(2)`db: close db due to versionchange`,e&&null!=e.newVersion&&e.newVersion!==e.oldVersion&&(f=!0,_&&_())})),this._db.version(1).stores({logs:"line,log"}),this._db.version(2).stores({logs:"line,log",assets:"key,hash,data"}),this._db.version(3).stores({logs:"line,log",assets:"key,hash,data",wam:",buffer,prevValues,lastSend"}),this._db.version(4).stores({logs:"line,log",assets:"key,hash,data",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((function(e){e.wam.toCollection().modify((function(e){e.key=e.lastSend,delete e.prevValues,delete e.lastSend}))})),this._db.version(5).stores({logs:"line,log",assets:null,wam:",key,buffer",l10n:"key,hash,t"}),this._db.version(6).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((e=>{e.logs.toCollection().count().then((()=>{e.logs.toCollection().modify((e=>{const{log:t}=e;e.timestamp=1e3*(0,l.default)(t.slice(5,28),"YYYY-MM-DD HH:mm:ss.SSS").unix()}))}))})),this._db.version(7).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t",user:"key"}),this._db.version(8).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",l10n:"key,hash,t",user:"key"}).upgrade((e=>{e.wam.toCollection().modify((e=>{e.channel="regular"}))})),this._db.version(9).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",l10n:"key,hash,t",user:"key"}),this._db.version(10).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",ps_meta:"key, value, rotateInDays, lastRotationTimeUtc",ps_tokens:"key",l10n:"key,hash,t",user:"key"}),this.openAttempt=0,this.openDB().catch((e=>{__LOG__(3)`openDB failed: ${e}`})),this._dbState=p.OPENING}h.prototype.loadUserIdb=function(){return this.idb().then((e=>e.transaction("rw",e.user,(()=>e.user.toArray().then((e=>e.forEach((e=>{this.permanentStorage.dataStore[e.key]=e.value})))))))).catch((e=>{__LOG__(3)`db:loadUserIdb:Error ${e}`}))},h.prototype.openDB=function(){this._db.isOpen()&&(this._db.close(),__LOG__(2)`db: close db due to duplicate openDB`);const e=(0,o.promiseTimeout)(Promise.resolve(this._db.open()),1e4).then((()=>{__LOG__(2)`db: Successfully opened db`;return new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!0,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.OPEN,p.OPEN})).catch((0,a.filteredCatch)(i.TimeoutError,(()=>{__LOG__(2)`db:openDB blocked`;return new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.BLOCKED,p.BLOCKED}))).catch((e=>{if(__LOG__(3)`db:openDB:Error ${e}`,this.openAttempt>1||u.UA.isSafari){this.opening=void 0,this._dbState=p.ERROR;throw new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),p.ERROR}return this.openAttempt+=1,this._db.delete().catch((e=>{throw __LOG__(3)`db:deleteDB:Error ${e}`,this.opening=void 0,this._dbState=p.ERROR,p.ERROR})).then((()=>this.openDB()))})).then((e=>{if(this.opening=void 0,e===p.BLOCKED)throw p.BLOCKED;return this._db}));return this.opening||(this.opening=e),e},h.prototype.idb=function(){return this._db.isOpen()?Promise.resolve(this._db):this._db.hasFailed()?(__LOG__(3)`Dexie: database failed to open, hasClosed ${this._db.hasBeenClosed()}`,Promise.reject(new Error(p.FAILED))):this._dbState===p.BLOCKED?(__LOG__(3)`Dexie: database is blocked`,Promise.reject(new Error(p.BLOCKED))):this.opening?this.opening:(__LOG__(3)`Dexie: database is closed`,Promise.reject(new Error(p.CLOSED)))},h.prototype.onVersionChange=function(e){_=e,f&&_()},h.prototype.State=p;var g=new h;t.default=g},15998:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_KEY_TTL=t.ENC_KEY_TABLE_NAME=t.ENC_KEY_DB_NAME=t.DbEncKeyStore=t.DB_ENCRYPTION_CIPHER=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(15688),s=r(88156),l=r(92844),c=n(r(86128)),d=n(r(41143)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}const f=r(74121).Z,_="wawc_db_enc";t.ENC_KEY_DB_NAME=_;const h="keys";t.ENC_KEY_TABLE_NAME=h;const g={name:"HKDF"},m={hash:"SHA-256"},y=4*l.WEEK_MILLISECONDS*24;t.ENC_KEY_TTL=y;const E="fts_hmac_keys",S="AES-CBC";t.DB_ENCRYPTION_CIPHER=S;function v(){const e=new Uint8Array(128);return self.crypto.getRandomValues(e),self.crypto.subtle.importKey("raw",e,g,!1,["deriveKey"])}const T=new class{constructor(){var e=this;this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._getOrUpdateEncKeys=e=>this._getDbOrThrow().keys.orderBy("id").toArray().then((t=>{if(!t||0===t.length)return this._addNewEncKey(e);const r=t[t.length-1]._expiration;if(null!=r&&r<=(new Date).getTime())return this._addNewEncKey(e);this._ephemeralLocalEncSalt=e;const n=t.map(function(){var t=(0,a.default)((function*(t){const r=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:e,info:new Uint8Array(1)}),t.key,{name:S,length:128},!1,["encrypt","decrypt"]);return(0,i.default)((0,i.default)({},t),{},{key:r})}));return function(){return t.apply(this,arguments)}}());return Promise.all(n).then((e=>{this._keys=e,this._waitUntilEncKeyReady.resolve()}))})),this._getOrUpdateFtsKey=()=>this._getDbOrThrow().fts_hmac_keys.orderBy("id").toArray().then((e=>{if(!e||0===e.length)return this._addNewFtsHMACKey();if(e.length>1)throw new u.DBInvalidFtsHMACKey;this._ftsHMACKey=e[e.length-1]})),this._addNewEncKey=e=>v().then((t=>this._getDbOrThrow().keys.add({key:t,_expiration:(new Date).getTime()+y}).then((()=>this._getOrUpdateEncKeys(e))))),this._addNewFtsHMACKey=()=>v().then((e=>this._getDbOrThrow().fts_hmac_keys.add({key:e}).then((()=>this._getOrUpdateFtsKey())))),this.generateFinalDbEncryptionAndFtsKey=e=>{if(null!=this._finalDbMsgEncKeys||null==this._ephemeralLocalEncSalt)return Promise.resolve();const t=(0,o.decodeB64)(e);return this._generateFinalFtsHmacKey(t),this._generateFinalDbMsgEncryptionKey(t),Promise.resolve()},this._generateFinalDbMsgEncryptionKey=t=>this._getDbOrThrow().keys.orderBy("id").toArray().then((r=>{const n=r.map(function(){var r=(0,a.default)((function*(r){let n;(0,d.default)(null!=e._ephemeralLocalEncSalt,"local salt is undefined");try{n=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(e._ephemeralLocalEncSalt||0)}),r.key,{name:S,length:128},!1,["encrypt","decrypt"])}catch(t){throw e._ephemeralLocalEncSalt=null,t}return(0,i.default)((0,i.default)({},r),{},{key:n})}));return function(){return r.apply(this,arguments)}}());return Promise.all(n).then((e=>{this._ephemeralLocalEncSalt=null,this._finalDbMsgEncKeys=e,this._waitUntilFinalDbEncKeyReady.resolve()}))})).finally((()=>{this._ephemeralLocalEncSalt=null})),this._generateFinalFtsHmacKey=function(){var t=(0,a.default)((function*(t){if(!e._ftsHMACKey||null==e._ftsHMACKey.key||null==e._ftsHMACKey.id)throw __LOG__(2)`Base ftsHMACKey is null in _generateFinalFtsHmacKey`,new u.DBInvalidFtsHMACKey;const[r,n]=[e._ftsHMACKey.id,e._ftsHMACKey.key],a=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(0)}),n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);e._finalFtsHmacKey={id:r,key:a},e._waitUntilFinalFtsHmacKeyReady.resolve()}));return function(){return t.apply(this,arguments)}}()}init(e){if(this._db)return f.resolve();this._db=new c.default(_),this._getDbOrThrow().version(1).stores({[h]:"++id, _expirtation",[E]:"++id"}),this._getDbOrThrow().version(2).stores({[h]:"++id",[E]:"++id"});const t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);return f.resolve(this._getDbOrThrow().open()).then((()=>Promise.all([this._getOrUpdateEncKeys(t),this._getOrUpdateFtsKey()])))}_getDbOrThrow(){if(null==this._db)throw new Error("[db_encryption_key] db is not initialized");return this._db}deleteKeys(){return Promise.all([this._getDbOrThrow().table(h).clear(),this._getDbOrThrow().table(E).clear()]).then((()=>{})).finally((()=>(this._db=null,f.resolve(c.default.delete(_)).catch((()=>c.default.delete(_))))))}deleteKeyCache(){this._keys=null,this._ftsHMACKey=null,this._finalDbMsgEncKeys=null,this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._finalFtsHmacKey=null,this._ephemeralLocalEncSalt=null}waitForEncKey(){return this._waitUntilEncKeyReady.promise}waitForFinalDbMsgEncKey(){return this._waitUntilFinalDbEncKeyReady.promise}waitForFinalFtsHmacKey(){return this._waitUntilFinalFtsHmacKeyReady.promise}get encKeys(){if(!this._keys)throw new u.DbEncKeyNotLoaded(h);return this._keys}get dbMsgEncKeys(){if(!this._finalDbMsgEncKeys)throw new u.DbMsgEncKeyNotLoaded(h);return this._finalDbMsgEncKeys}get ftsHMACKey(){if(!this._finalFtsHmacKey)throw new u.DbEncKeyNotLoaded(E);return this._finalFtsHmacKey}};t.DbEncKeyStore=T},92200:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.documentFlushed=function(e){var t;const r=null!==(t=null==e?void 0:e.signal)&&void 0!==t?t:l();return new Promise(((e,t)=>{if(r.aborted)return void t(new o.AbortError);let n;function i(){r.removeEventListener("abort",l);const e=s.indexOf(a);-1!==e&&s.splice(e,1),0===s.length&&null!=n&&(n(),n=null)}function a(){i(),e()}function l(){i(),t(new o.AbortError)}s.push(a),r.addEventListener("abort",l),1===s.length&&(n=function(){let e;const t=requestAnimationFrame((()=>{e=setTimeout((()=>{c()}),0)}));return()=>{cancelAnimationFrame(t),clearTimeout(e)}}())}))},t.resolveAllForTestingOnly=void 0;var a=i(r(51463)),o=r(89385);const s=[],l=(0,a.default)((()=>(new n).signal));function c(){for(;s.length>0;){s.shift()()}}t.resolveAllForTestingOnly=()=>(c(),Promise.resolve())},55216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enrich=function(e,t){let r;switch((0,o.previewType)(t)){case"pdf":r=l(e);break;case"msoffice":r=function(){return c.apply(this,arguments)}(e);break;default:r=Promise.resolve()}return(0,a.promiseTimeout)(r,3e3,"Document enrichment timeout").catch((()=>null))},t.enrichPdf=l;var i=n(r(48926)),a=r(38284),o=r(43257),s=n(r(38906));function l(e){let t;return s.default.fileToPdf(e).then((e=>(t=e,s.default.pdfToImg(e,1)))).catch((()=>(__LOG__(2)`pdf preview generation failed`,null))).finally((()=>{t&&s.default.releasePdf(t)}))}function c(){return(c=(0,i.default)((function*(e){if("win32"===process.platform)try{yield DocUtils.genPreview(e)}catch(e){__LOG__(2)`document preview generation failed`}}))).apply(this,arguments)}},3309:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r={LOW:"low",HIGH:"high"},n=window.matchMedia("\n    only screen and (-webkit-min-device-pixel-ratio: 2),\n    only screen and (min-device-pixel-ratio: 2),\n    only screen and (min-resolution: 2dppx)\n"),i={RES:r,currentRes:n.matches?r.HIGH:r.LOW};n.addListener((function(e){const t=e.matches?r.HIGH:r.LOW;if(t===i.currentRes)return;i.currentRes=t;const n=document.createEvent("Event");n.initEvent("dpichange",!0,!0),window.dispatchEvent(n)}));var a=i;t.default=a},75538:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(68929)),a=n(r(2525)),o=n(r(35161)),s=n(r(73955));t.default=class{constructor(e){this.rules={},this.styleSheet=this.createStyleSheet(e)}createStyleSheet(e){const t=e||(0,s.default)("dynamic-style-");let r=document.createElement("style");return r.id=t,r.type="text/css",document.head&&document.head.appendChild(r),r=r.sheet,r}addRule(e,t){const r=this.styleSheet.cssRules.length,n=(0,o.default)(t,((e,t)=>`${t}: ${e};`)).join(" ");return this.styleSheet.insertRule(`${e} { ${n} }`,r),this.rules[e]=this.styleSheet.cssRules[r],this.rules[e]}updateRule(e,t){const r=this.rules[e];return(0,a.default)(t,((e,t)=>{r.style[(0,i.default)(t)]=e})),r}setRule(e,t){return this.rules[e]?this.updateRule(e,t):this.addRule(e,t)}}},30600:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o(null,a.default.fromForwardsStrings(e.sort(((e,t)=>t.length-e.length)).map((e=>`${e}${s}`))),null,0)};var i=n(r(3522)),a=n(r(55205));function o(e,t,r,n,a){const c=[];let d=!1,u=a;if(null==u)if(e&&1===n){l.has(e)&&(u=!0)}else e&&r&&2===n&&(u=l.has(r+e));t.getChildren().forEach((t=>{t.prefix!==s?c.push(o(t.prefix,t.node,e,n+1,u)):d=!0}));const p=""!==e||null==r||u?(0,i.default)(e||""):"?";let f=0===c.length?"":`(?:${c.join("|")})`;return f&&d&&(f+="?"),`${p}${f}`}const s="\n",l=new Set(["","","","","",""])},25647:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VARIATION_CATEGORY=t.ORDERED_CATEGORY_IDS=t.LARGE_EMOJI_SIZE=t.HEART_EMOJIS=t.EMOJI_WIDTH=t.EMOJI_TYPE=t.CATEGORY_ORDERING=t.CATEGORY_MAPPING=t.CATEGORIES=t.BUCKET_SIZE=void 0;t.BUCKET_SIZE=25;t.CATEGORIES={SMILEYS_PEOPLE:"SMILEYS_PEOPLE",ANIMALS_NATURE:"ANIMALS_NATURE",FOOD_DRINK:"FOOD_DRINK",ACTIVITY:"ACTIVITY",TRAVEL_PLACES:"TRAVEL_PLACES",OBJECTS:"OBJECTS",SYMBOLS:"SYMBOLS",FLAGS:"FLAGS"};t.CATEGORY_MAPPING={"Smileys & People":"SMILEYS_PEOPLE","Animals & Nature":"ANIMALS_NATURE","Food & Drink":"FOOD_DRINK",Activity:"ACTIVITY","Travel & Places":"TRAVEL_PLACES",Objects:"OBJECTS",Symbols:"SYMBOLS",Flags:"FLAGS"};const n=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS"];t.ORDERED_CATEGORY_IDS=n;t.EMOJI_TYPE={APPLE:"APPLE",WHATSAPP:"WHATSAPP"};t.EMOJI_WIDTH={small:20,large:32};const i=r(76672).Mirrored(["MEDIUM","LARGE","XLARGE"]);t.LARGE_EMOJI_SIZE=i;const a=[...n,"VARIATION"];t.CATEGORY_ORDERING=a;const o=a.indexOf("VARIATION");t.VARIATION_CATEGORY=o;t.HEART_EMOJIS=["","","","","","","","","","","","","","",""]},46063:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={APPLE:["1d5e731","ba8bdec","2face08","a545008","8874004","c042b58","c3dc945","819bb22","f919b04","f142326","6342703","db8af96","254c6ee","9459d66","b757de6","c5531c6","eee0808","f44302b","0997ed3","5ab9f55","b7a4ec9","9fe8c9b","7934132","c5bfe3a","d9fe696","180bdeb","c65b738","1687c2a","2364fb1","2dac913","0e7766c","ca7e73b","7692c5e","7c4d80d","8cd6ca7","5ad1ddc","9f877c8","27c5d08","3099209","efd3a70","cf951db","2dcac8b","f61ea23","d1aa9c1","a220a6a","af6a7cf","69c3949","52aae5d","fa896fa","e057afe","f610f34","0a28f77","c8c4335","5b8e2f7","8431d9f","bc2093e","41cd719","7ad8d55","56d4834","c12380b","2d91dc3","334914c","3d9393f","4d871e0","24f0539","d55fc7d","38b3000","62ab315","531b804","3ed3a1e","7e1babf","d9c9192","3076c3a","ddf36af","da748cb","3ebbc9f","a33f9a6","bd66159","6df0912","1d628c1","724ef42","08d827e","05a67b6","7816bb1","42974a4","6525db2","aeb25f3","3bed38e","87ef56d","88fbe9c","a843e57","d042204","748969e","c624bfc","f99b5a3","a15a462","6db790b","8f595b1","ed170c1","28caf36","1ec6250","1f54af3","7f43cd3","979a532","9b0ac77","13b8ceb","6639e79","d0b8ff7","e6296a8","42437ce","d59625c","620ec44","5130c11","3745318","1b38856","937b1d8","098fd51","b67d38a","ccea594","80472df","f45a839","c267e9b","6134a43","e3ddadf","217cb2e","27794e6","ce1bca0","2ec6308","dca927a","5099652","8606b5c","ff70a07","99acb30","d0ad76f","10378f5","d69be1f","cd9e3d0","a5ba00a","dc7c828","55c6310","c8df73e"],WHATSAPP:["275ab2d","2daeeb8","2224eba","0b9fe45","17c7395","a55d276","72434c2","1dd3846","270a5f3","7a609af","4bc31db","a662a91","1a6e349","5d916f5","893eec6","6bd244c","d41b50c","1390219","1e2bb45","6fda0bc","5da7428","2a928c7","d0de61a","951eaf0","abf067b","7d8ffef","c3f1765","63c4caa","57db7e9","a5c7aae","3f057f6","3e451ea","8e8748b","9674031","6a75fe0","c5081c9","1b3d484","87ac96a","8af6206","3e4cd80","dea012c","0bfd00d","ac92df9","5988695","7fc1fef","f064985","ffefa9d","35d35a9","c4e922a","7a7637f","bec2fdf","5543365","b434947","59fdfea","3dbba43","9a04fc9","c8efe85","858b6bb","bc37e7d","0df49c7","7e953c6","a99489e","620104d","4775444","838a358","36f0702","73011a9","8830247","4b471be","e607bf5","e4f5f3f","d7e8913","f80d26f","efbc9b8","e8a7519","ec05a92","ad38c5f","33a2551","5e1660c","1395194","c585594","37ebc47","c1eba8a","78e2b60","929560c","fae06f3","4e858e5","428370e","21fa232","8189c09","c7cdfc4","52d7641","10d01ec","251748f","e15b9d8","76c46c9","05bd55e","d321ca5","6fb5d64","6b996dd","1d332e2","d5334af","e41e707","bef85df","87d3d34","db6d4e3","98dee68","03e68f5","338835d","a6b0372","968722c","1d7689c","d50117f","dba5f1b","e030c5c","d4ba921","f4a2a06","1cd377e","21622a3","13dd7ff","fb69465","16c51db","67a21f5","b8dc46e","f501f99","21b8cd1","18851e7","77c853f","0276720","9573645","a609d4f"]}},80439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiSpritesPath=function(e,t,r,n){const o=(0,i.default)(a.default[e][t],"emojiSpriteHashes[emojiType][bucketId]");return`${s}/emoji-${t}-${r}_${o}.${n}`},t.getGlyphPath=function(e,t,r){return{low:l(`${t}-${"large"===r?"40":"64"}.png`,e.toLowerCase()),high:l(`${t}-64.png`,e.toLowerCase())}};var i=n(r(45095)),a=n(r(46063)),o=r(62129);const s="/img";function l(e,t){let r=null;return r="/img",`/img/${o.prefixHash}_${t.slice(0,1)}_${e}`}},70449:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPermutations=t.OPEN_BOX_CHAR=t.EmojiUtil=void 0,t.isBaseCoupleEmoji=function(e){return m.includes(e)};var i=n(r(42905)),a=n(r(88306)),o=n(r(48447)),s=n(r(45095)),l=n(r(5298)),c=n(r(94184)),d=n(r(41143)),u=n(r(30600)),p=r(25647),f=r(80439),_=n(r(35613));t.OPEN_BOX_CHAR="";const h=["","","","",""],g=new RegExp(h.join("|"),"g"),m=["","","","","","","","","","","",""],y=p.HEART_EMOJIS.map((e=>e)),E=new Set(["","","","","","","","","","","","","","","",""]),S=e=>e.replace(/\uFE0F/g,""),v=(0,a.default)(((e,t)=>function r(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(n.length===t)return[n];let i=[];for(let t=0;t<e.length;t++){const a=[...n];a.push(e[t]),i=i.concat(r(a))}return i}()),((e,t)=>e.toString()+t));t.getPermutations=v;function T(e){return e.every((t=>t===e[0]))?e[0]:e.join("")}const C=new class{constructor(){var e=this;this.skinToneVariations=h,this._specialEmojiRegex=null,this.emojiRegex=()=>{const e=this._createEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("("+e+")","g")})),this.onlyEmojiRegex=()=>{const e=this._createOnlyEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createOnlyEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("^("+e+")+$","g")})),this.convertToTextWithoutSpecialEmojis=e=>{if(!this._specialEmojiRegex){const e=(0,u.default)(Object.keys(_.default));this._specialEmojiRegex=new RegExp(`(${e})`,"g")}return this._specialEmojiRegex.lastIndex=0,e.replace(this._specialEmojiRegex,(e=>_.default[e]))},this.splitEmojis=e=>!1===this.containsOnlyEmoji(e)?null:e.split(this.emojiRegex()).filter(Boolean),this.containsEmoji=e=>this.emojiRegex().test(e),this.containsOnlyEmoji=e=>this.onlyEmojiRegex().test(e),this.matchLargeEmojiPattern=e=>{if(e.length>50||e.includes(" "))return null;const t=this._getLargeEmojisRegex().exec(e);return t?t.filter(Boolean).slice(1):null},this.normalizeEmojiFromString=e=>this.normalizeEmoji(e),this.normalizeEmoji=e=>{const t=S(e),{unqualifiedToNormalizedEmoji:r}=this._getDerivedMaps();return r.get(t)},this.normalizeAllEmojis=(0,a.default)((e=>e?e.replace(this.emojiRegex(),((e,t)=>{var r;return E.has(t)?"":null!==(r=this.normalizeEmoji(t))&&void 0!==r?r:""})):"")),this.getSkinToneVariant=(e,t)=>{const r=this._getBaseToSkinToneEmojis().get(e);if(null==r)return null;const n=T(t);return r.get(n)},this._getDerivedMaps=(0,l.default)((()=>{const{orderedEmojis:e,legacyToEmoji:t}=this._getConfig(),r=new Map,n=new Map,a=new Map;let o=0;return e.forEach(((e,t)=>{if(""===e||null==e)return;(Array.isArray(e)?e:[e]).forEach((e=>{n.set(e,t);const r=S(e);a.set(r,e)})),r.set(t,o),o++})),(0,i.default)(t).forEach((e=>{let[t,r]=e;n.set(t,r);const i=S(t);a.set(i,t)})),{emojiToGlyphId:n,glyphIdToIndex:r,unqualifiedToNormalizedEmoji:a}})),this._getBaseToSkinToneEmojis=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps(),t=new Map;for(const r of e.keys()){let e;const n=r.replace(g,(t=>(null==e&&(e=[]),e.push(t),"")));if(null==e)continue;const i=e;let a;a=""===n?"":""===n?"":""===n?"":""===n?"":""===n?"":n;const o=this.normalizeEmoji(a);if(null==o)continue;let s=t.get(o);null==s&&(s=new Map,s.set("",o),t.set(o,s));const l=T(i);s.set(l,r)}return t})),this._getSkinToneEmojisToBase=(0,l.default)((()=>{const e=new Map;for(const[t,r]of this._getBaseToSkinToneEmojis().entries())for(const n of r.values())e.set(n,t);return e})),this._getEmojiRegexSource=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps();return(0,u.default)([...Array.from(e.keys()),...Array.from(E)].filter(Boolean))})),this._createLargeEmojisRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp(`^(${e})(${e})?(${e})?$`)})),this.getEmojisInCategory=e=>{var t;return null!==(t=this._getConfig().categorizedEmojis[e])&&void 0!==t?t:[]},this._getEmojiToCategory=(0,l.default)((()=>{const{categorizedEmojis:e}=this._getConfig(),t=new Map;return Object.keys(e).forEach((r=>{const n=p.CATEGORY_ORDERING.indexOf(r);e[r].forEach((e=>{const r=this.normalizeEmoji(e);null!=r&&t.set(r,n)}))})),t})),this.getGlyphId=e=>{const t=this.normalizeEmoji(e);if(null==t)return null;const{emojiToGlyphId:r}=this._getDerivedMaps();return r.get(t)},this.getGlyphPath=(e,t)=>(0,f.getGlyphPath)(this._getConfig().emojiType,e,t),this.isGlyphCached=e=>{const t=this._getGlyphIndex(e);return this._getCachedGlyphs().get(t)},this.markGlyphCached=e=>{const t=this._getGlyphIndex(e);this._getCachedGlyphs().set(t)},this._getCachedGlyphs=(0,l.default)((()=>new o.default(this._getGlyphCount()))),this.getCssClasses=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return(0,c.default)(`b${e.getBucket(t)}`,"small"===r?"emoji":"emojik",e._getConfig().emojiType===p.EMOJI_TYPE.APPLE?"apple":"wa")},this.getStyle=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";const{xpos:n,ypos:i}=e._getCoordinates(t,r);return{backgroundPosition:`-${n}px -${i}px`}},this.getBucket=e=>{const t=this._getGlyphIndex(e);return`${Math.floor(t/p.BUCKET_SIZE)}`},this.getHeartEmojis=(0,l.default)((()=>y.map(this.normalizeEmoji).filter(Boolean))),this._getLastBucketId=(0,l.default)((()=>{const e=this._getGlyphCount();return e-e%p.BUCKET_SIZE})),this._getLastBucketCols=(0,l.default)((()=>Math.floor(Math.sqrt(this._getGlyphCount()-this._getLastBucketId()))))}configure(e){e!==this._config&&(this._config=e,this.getHeartEmojis.reset(),this._specialEmojiRegex=null,this._createEmojiRegexIfNeeded.reset(),this._createLargeEmojisRegexIfNeeded.reset(),this._createOnlyEmojiRegexIfNeeded.reset(),this._getEmojiRegexSource.reset(),this._getCachedGlyphs.reset(),this._getSkinToneEmojisToBase.reset(),this._getBaseToSkinToneEmojis.reset(),this._getEmojiToCategory.reset(),this._getLastBucketId.reset(),this._getLastBucketCols.reset(),this._getDerivedMaps.reset())}_getConfig(){return(0,d.default)(null!=this._config,"Attempt to use EmojiUtil before it's been configured"),this._config}isEmoji(e){return null!=this.normalizeEmoji(e)}getSkinToneBase(e){var t;const r=this.normalizeEmoji(e);return null==r?null:null!==(t=this._getSkinToneEmojisToBase().get(r))&&void 0!==t?t:null}_getLargeEmojisRegex(){const e=this._createLargeEmojisRegexIfNeeded();return e.lastIndex=0,e}_getGlyphCount(){const{glyphIdToIndex:e}=this._getDerivedMaps();return e.size}_getCoordinates(e,t){const r=this._getGlyphIndex(e),n=r%p.BUCKET_SIZE,i=r>=this._getLastBucketId()?this._getLastBucketCols():Math.floor(Math.sqrt(p.BUCKET_SIZE)),a=p.EMOJI_WIDTH[t],o=Math.floor(n/i);return{xpos:Math.floor(n%i)*a,ypos:o*a,width:a}}_getGlyphIndex(e){const{glyphIdToIndex:t}=this._getDerivedMaps();return(0,s.default)(t.get(e),"glyphIdToIndex.get(glyphId)")}getEmojiAggregate(e){return this.removeSkinTone(this.getNormalizedOrTofu(e))}removeSkinTone(e){return e}getNormalizedOrTofu(e){return this.normalizeEmojiFromString(e)?e:""}};t.EmojiUtil=C},10786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEncKeysAndCache=function(){return u.apply(this,arguments)},t.generateFinalDbEncryptionAndFtsKeyForInvoker=function(e){return(0,o.get)().generateFinalDbEncryptionAndFtsKey(e)},t.initEncSalt=function(){return c.apply(this,arguments)},t.initEncSaltForInvoker=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(88102),o=r(77303);let s=null;s=r(15998).DbEncKeyStore;let l=null;function c(){return(c=(0,i.default)((function*(){var e;if(null==l){const e=r(73368).nx;l=e()}const t=yield l;if(t&&t.constructor===Uint8Array)return null===(e=s)||void 0===e?void 0:e.init(t)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){if(null==l){const e=r(73368).nx;l=e()}const e=yield l;e&&e.constructor===Uint8Array&&(0,o.get)().initDatabaseEncnKey(e)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){var e;yield Promise.all([null===(e=s)||void 0===e?void 0:e.deleteKeys(),(0,o.get)().deleteDbEncKeyCache()])}))).apply(this,arguments)}a.Cmd.on("logout",(()=>{l=Promise.resolve(null)}))},73368:(e,t,r)=>{"use strict";t.cn=function(){(0,a.setWebEncSalt)(null)},t.nx=function(){const e=!!(0,n.getMaybeMeUser)();let t=null;e||(t=new Uint8Array(128),self.crypto.getRandomValues(t),t=btoa(String.fromCharCode(...Array.from(new Uint8Array(t)))),(0,a.setWebEncSalt)(t));t=(0,a.getWebEncSalt)(),null==t&&(__LOG__(4,void 0,new Error)`[DB ENC CRITICAL ERROR] null returned for local enc salt`,o.Socket.logout(!1,i.LogoutReason.ClientFatalError));return t=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),Promise.resolve(t)};var n=r(99234),i=r(83578),a=r(58052),o=r(65044)},96222:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=n(r(48926));function a(){return(a=(0,i.default)((function*(){const e=navigator.storage;if(null==(null==e?void 0:e.estimate))return null;const t=yield e.estimate();let{usage:r,quota:n,usageDetails:i}=t;Number.isFinite(r)||(r=0),Number.isFinite(n)||(n=0);return{usage:r,quota:n,available:n-r,caches:null==i?void 0:i.caches}}))).apply(this,arguments)}},34342:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(73955)),a=n(r(41609)),o=n(r(51463));const s=/\s+/;t.default=class{on(e,t,r){if(!t)return this;if("function"!=typeof t)throw new Error("Callback parameter passed is not a function");return this._multiEvent(this.on,...arguments)||this._getOrCreateEvents(e).push({callback:t,context:r,ctx:r||this}),this}once(e,t,r){if(!t)return this;if(this._multiEvent(this.once,...arguments))return this;const n=this,i=(0,o.default)((function(){n.off(e,i),t.apply(this,arguments)}));return i._callback=t,this.on(e,i,r)}off(e,t,r){const n=this._events;if(!n)return this;if(this._multiEvent(this.off,...arguments))return this;if(!e&&!t&&!r)return this._events=void 0,this;const i=e?[e]:Object.keys(n);for(let e=0;e<i.length;e++){const a=i[e],o=n[a];if(o){if(n[a]=[],t||r)for(let e=0;e<o.length;e++){const i=o[e];(t&&t!==i.callback&&t!==i.callback._callback||r&&i.context!==r)&&n[a].push(i)}n[a].length||delete n[a]}}return this}trigger(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(!this._events)return this;if(this._multiEvent(this.trigger,...arguments))return this;const i=this._getEvents(e),a=this._getEvents("all");return i&&this._triggerEvents(i,r),a&&this._triggerEvents(a,arguments),this}stopListening(e,t,r){const n=this._listeningTo;if(!n)return this;const i=null==e?void 0:e._listenId,o=i?{[i]:e}:n;for(const e in o){const i=o[e];i.off(t,r,this),(!t&&!r||(0,a.default)(i._events))&&delete n[e]}return(0,a.default)(this._listeningTo)&&delete this._listeningTo,this}listenTo(e,t,r){return r?(this._addListeningTo(e),e.on(t,r,this),this):this}listenToOnce(e,t,r){return this._addListeningTo(e),e.once(t,r,this),this}listenToAndRun(e,t,r){return this.listenTo.apply(this,arguments),r.apply(this),this}isListening(e){const t=this._events;return!!t&&("string"==typeof e?!!t[e]:(0,a.default)(t))}_addListeningTo(e){(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=(0,i.default)("l"))]=e}_getOrCreateEvents(e){const t=this._events||(this._events={});return t[e]||(t[e]=[])}_getEvents(e){if(!e)return;const t=this._events;return t?t[e]:void 0}_multiEvent(e,t){if(s.test(t)){const a=t.split(s);for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];for(let t=0;t<a.length;t++)e.call(this,a[t],...n);return!0}return!1}_triggerEvents(e,t){let r,n=-1;const i=e.length,a=t[0],o=t[1],s=t[2];switch(t.length){case 0:for(;++n<i;)(r=e[n]).callback.call(r.ctx);return;case 1:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a);return;case 2:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a,o);return;case 3:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a,o,s);return;default:for(;++n<i;)(r=e[n]).callback.apply(r.ctx,t)}}bind(){return this.on(...arguments)}unbind(){return this.off(...arguments)}removeListener(){return this.off(...arguments)}removeAllListeners(){return this.off()}emit(){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return this.trigger(arguments)}}},64103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateImmediately=t.Unmount=t.UnableToPlayVideoError=t.UnableToGetContentLengthError=t.TranscodeBlobTooLargeError=t.SourceUnavailableError=t.SocketNotOpen=t.SocketError=t.SocketClosed=t.ShouldLoop=t.ServerStatusError=t.QueryDrop=t.ProtoVersionUndefined=t.OverconstrainedError=t.Offline=t.NotSupportedError=t.NotFoundError=t.NotAllowedError=t.ModelError=t.ModelCreateError=t.MediaUnsupportedError=t.MediaNeedsReupload=t.MediaMissing=t.MediaLoadError=t.MediaFileFailedLoad=t.MediaFileError=t.MediaFileEmpty=t.MediaEncryptionError=t.MediaDragDropError=t.MediaDecryptionError=t.InvalidServerResponseError=t.InvalidMediaFileType=t.InvalidImageFileType=t.ImageError=t.GaveUpRetry=t.GUMError=t.GUM=t.FileNotReadableError=t.EncodeWebpError=t.Disconnected=t.DeprecatedProtocolVersion=t.DecodeWebpResultsError=t.DbOnLogoutAbort=t.DbMsgEncKeyNotLoaded=t.DbEncKeyNotLoaded=t.DBInvalidFtsHMACKey=t.ConstraintNotSatisfiedError=t.CatalogImageDownloadError=t.CapabilityUnknown=t.CapabilityInvalid=t.CapabilityError=t.CanNotSendUnencrypted=t.BlockedByProxy=t.BingServerError=t.ActiveChatChanged=t.ActionError=t.AbortError=void 0;var n=r(40265);class i extends((0,n.customError)("QueryDrop")){}t.QueryDrop=i;class a extends((0,n.customError)("Disconnected")){}t.Disconnected=a;class o extends((0,n.customError)("Offline")){}t.Offline=o;class s extends((0,n.customError)("ShouldLoop")){}t.ShouldLoop=s;class l extends((0,n.customError)("GaveUpRetry")){}t.GaveUpRetry=l;class c extends((0,n.customError)("CatalogImageDownloadError")){}t.CatalogImageDownloadError=c;class d extends((0,n.customError)("MediaFileError")){}t.MediaFileError=d;class u extends((0,n.customError)("InvalidImageFileType",!0,d)){}t.InvalidImageFileType=u;class p extends((0,n.customError)("InvalidMediaFileType",!0,d)){}t.InvalidMediaFileType=p;class f extends((0,n.customError)("MediaEncryptionError",!0,d)){}t.MediaEncryptionError=f;class _ extends((0,n.customError)("MediaDecryptionError",!0,d)){}t.MediaDecryptionError=_;class h extends((0,n.customError)("MediaFileFailedLoad",!0,d)){}t.MediaFileFailedLoad=h;class g extends((0,n.customError)("MediaFileEmpty",!0,d)){}function m(e){try{return JSON.stringify(e)}catch(t){return e.toString()}}t.MediaFileEmpty=g;class y extends((0,n.customError)("SocketError")){constructor(e){super("string"==typeof e?e:m(e)),this.event=e}}t.SocketError=y;class E extends((0,n.customError)("SocketClosed")){constructor(e){super("string"==typeof e?e:m(e)),this.event=e}}t.SocketClosed=E;class S extends((0,n.customError)("SocketNotOpen")){constructor(e){super(`socket not open, is ${e}`)}}t.SocketNotOpen=S;class v extends((0,n.customError)("BlockedByProxy")){}t.BlockedByProxy=v;class T extends((0,n.customError)("ImageError")){constructor(e,t){super("Image failed to load."),this.src=e,this.status=t,this.target={src:e,status:t}}}t.ImageError=T;class C extends((0,n.customError)("DecodeWebpResultsError")){constructor(e,t){super(e),this.event=t}}t.DecodeWebpResultsError=C;class A extends((0,n.customError)("DecodeWebpError")){constructor(e,t){super(e),this.event=t}}t.EncodeWebpError=A;class b extends((0,n.customError)("ServerStatusError")){constructor(e,t,r){super(`${e||"Server replied with a failed status code"}: ${r}`),this.url=t,this.status=r}}t.ServerStatusError=b;class P extends((0,n.customError)("InvalidServerResponseError")){constructor(e,t,r){let n=`Invalid response for ${e}, with status ${t}`;r&&(n=`${n}: ${r}`),super(n)}}t.InvalidServerResponseError=P;class M extends((0,n.customError)("BingServerError",!0,b)){constructor(e,t,r){super(`Error ${t} for ${e}: ${JSON.stringify(r)}`,e,t)}}t.BingServerError=M;class O extends((0,n.customError)("MediaNeedsReupload")){}t.MediaNeedsReupload=O;class I extends((0,n.customError)("MediaMissing")){}t.MediaMissing=I,I.message="Media is no longer available on your phone";class w extends((0,n.customError)("FileNotReadableError",!0,Error)){}t.FileNotReadableError=w;class R extends((0,n.customError)("MediaLoadError")){constructor(e){super(e),this.src=e}}t.MediaLoadError=R;class D extends((0,n.customError)("TranscodeBlobTooLargeError")){constructor(){super("Transcode blob too large")}}t.TranscodeBlobTooLargeError=D;class N extends((0,n.customError)("UnableToPlayVideoError")){constructor(e){super(`Unable to play video. Reason: ${String(e)}`)}}t.UnableToPlayVideoError=N;class L extends((0,n.customError)("MediaDragDropError",!0,R)){}t.MediaDragDropError=L;class k extends((0,n.customError)("MediaUnsupportedError")){}t.MediaUnsupportedError=k,k.message="Media format is unsupported";class G extends((0,n.customError)("ModelError")){}t.ModelError=G;class U extends((0,n.customError)("ModelCreateError")){constructor(e,t){super(e),this.model=t}}t.ModelCreateError=U;class F extends((0,n.customError)("DbEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseEncryptionKey.${e} was accessed before init`)}}t.DbEncKeyNotLoaded=F;class x extends((0,n.customError)("DbMsgEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseMessageEncryptionKey.${e} was accessed before init`)}}t.DbMsgEncKeyNotLoaded=x;class B extends((0,n.customError)("DbOnLogoutAbortError")){}t.DbOnLogoutAbort=B,B.message="DB operation was dropped due to logout activity";class K extends((0,n.customError)("DBExpiredFtsHMACKey")){}t.DBInvalidFtsHMACKey=K,K.message="MasterDatabaseEncryptionKey.fts_hmac_keys is in an invalid state";class j extends((0,n.customError)("ProtoVersionUndefined")){}t.ProtoVersionUndefined=j;class Y extends((0,n.customError)("UpdateImmediately")){}t.UpdateImmediately=Y;class W extends((0,n.customError)("DeprecatedProtocolVersion")){}t.DeprecatedProtocolVersion=W;class H extends((0,n.customError)("CapabilityError")){}t.CapabilityError=H;class V extends((0,n.customError)("CapabilityInvalid",!0,H)){}t.CapabilityInvalid=V;class $ extends((0,n.customError)("CapabilityUnknown",!0,H)){}t.CapabilityUnknown=$;class z extends((0,n.customError)("CanNotSendUnencrypted")){}t.CanNotSendUnencrypted=z;class q extends((0,n.customError)("ActionError")){}t.ActionError=q,q.message="Could not perform action.";class J extends((0,n.customError)("Unmount")){}t.Unmount=J;class Q extends((0,n.customError)("ActiveChatChanged")){}t.ActiveChatChanged=Q;class X extends((0,n.customError)("GUMError")){}t.GUMError=X;class Z extends((0,n.customError)("NotSupportedError",!0,X)){}t.NotSupportedError=Z,Z.message="The operation is not supported.";class ee extends((0,n.customError)("NotAllowedError",!0,X)){}t.NotAllowedError=ee,ee.message="The user did not grant permission for the operation";class te extends((0,n.customError)("ConstraintNotSatisfiedError",!0,X)){}t.ConstraintNotSatisfiedError=te,te.message="One of the mandatory Constraints could not be satisfied.";class re extends((0,n.customError)("OverconstrainedError",!0,X)){}t.OverconstrainedError=re,re.message="Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.";class ne extends((0,n.customError)("NotFoundError",!0,X)){}t.NotFoundError=ne,ne.message="The object can not be found here.";class ie extends((0,n.customError)("AbortError",!0,X)){}t.AbortError=ie,ie.message="The operation was aborted.";class ae extends((0,n.customError)("SourceUnavailableError",!0,X)){}t.SourceUnavailableError=ae,ae.message="The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process).";class oe extends((0,n.customError)("UnableToGetContentLengthError")){}t.UnableToGetContentLengthError=oe,oe.message="Failed to get media contentLength from mms";const se={GUMError:X,NotSupportedError:Z,NotAllowedError:ee,ConstraintNotSatisfiedError:te,OverconstrainedError:re,NotFoundError:ne,AbortError:ie,SourceUnavailableError:ae};t.GUM=se},96384:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORM=t.FAQ_BASE_URL=void 0,t.getBusinessFaqUrl=function(){return s("general/chats/about-chatting-with-businesses")},t.getCannotConnectFaqUrl=function(){return s("web/troubleshooting/cant-connect-to-whatsapp-web-or-desktop")},t.getCatalogCartOnOffFaqUrl=function(){return s("general/account-and-profile/about-cart")},t.getCiphertextFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-this-may-take-a-while")},t.getCodeChangeFaqUrl=function(){return s("general/security-and-privacy/security-code-change-notification")},t.getE2EEnterpriseFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption-for-business-messages")},t.getE2EFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption")},t.getEphemeralFaqUrl=function(){return s("general/chats/about-disappearing-messages")},t.getFanoutPlaceholderFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-check-your-phone")},t.getFaqUrl=function(){return`${a}/web?lang=${i.default.getLocale()}`},t.getFrequentlyForwardedFaqUrl=function(){return s("general/chats/about-forwarding-limits")},t.getGroupInviteGrowthLockedFaqUrl=function(){return s("cxt/?entrypointid=invite-via-link-unavailable",!0)},t.getLoginFaqUrl=function(){return s("web/download-and-installation/how-to-log-in-or-out")},t.getMDCodeChangeFaqUrl=function(){return`${a}/${i.default.getLocale()}/web/26000361`},t.getMdOptInFaqUrl=function(){return s("general/download-and-installation/about-linked-devices")},t.getNonVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-a-standard-account")},t.getNotificationChromeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-chrome")},t.getNotificationEdgeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-microsoft-edge")},t.getNotificationFirefoxFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-firefox")},t.getNotificationOperaFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-opera")},t.getNotificationSafariFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-safari")},t.getRevokeFaqUrl=function(){return s("web/chats/how-to-delete-messages")},t.getSupportChatFaqUrl=function(){return s("general/what-information-does-whatsapp-collect-when-you-contact-support")},t.getSupportChatSafetyFaqUrl=function(){return s("general/about-safely-communicating-with-whatsapp-support")},t.getSuspiciousLinkFaqUrl=function(){return s("web/chats/suspicious-links")},t.getUnverifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-unverified")},t.getVerifiedHighFaqUrl=function(){return s("general/verified-business-account")},t.getVerifiedLowUnknownFaqUrl=function(){return s("general/unverified-business-account")},t.getVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-verified")},t.getViewOnceFaqUrl=function(){return s("general/chats/about-view-once")};var i=n(r(43725));const a="https://faq.whatsapp.com";t.FAQ_BASE_URL=a;const o="web";function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?`${a}/${e}&platform=web&lang=${i.default.getLocale()}`:`${a}/${e}?lang=${i.default.getLocale()}`}t.PLATFORM=o},1063:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FILETYPE=void 0,t.blobToArrayBuffer=c,t.blobToText=function(){return p.apply(this,arguments)},t.createFile=function(e,t,r){const n=new Blob(e,r||{});return n.name=t,n},t.getAudioDuration=function(e){let t,r;return new Promise(((n,i)=>{t=document.createElement("audio"),t.addEventListener("loadeddata",n),t.addEventListener("error",(()=>{i(new Error("getAudioDuration: error loading audio"))})),t.src=r=URL.createObjectURL(e)})).then((()=>~~t.seekable.end(0))).finally((()=>{r&&URL.revokeObjectURL(r)}))},t.getFileExtension=u,t.getMimeTypeForFilepath=function(e){const t=u(e),r=(0,o.isAllowedDocumentMimetype)(o.EXT_TO_MIME&&t&&o.EXT_TO_MIME[t],e,!1);if(r)return r},t.removeTrailingDots=d,t.typeFromMimetype=function(e){const t=e.split("/")[0];switch(t){case s.IMAGE:case s.VIDEO:case s.AUDIO:return t;default:return s.DOCUMENT}},t.validateBlob=function(e){return c(e.webkitSlice?e.webkitSlice(0,1):e.slice(0,1)).then((e=>1===e.byteLength)).catch((()=>!1))};var i=n(r(48926)),a=r(60363),o=r(43257);const s=Object.freeze({IMAGE:"image",VIDEO:"video",AUDIO:"audio",DOCUMENT:"document",STICKER:"sticker"});t.FILETYPE=s;const l=e=>{var t;return null!==(t=null==e?void 0:e.message)&&void 0!==t?t:""};function c(e){let t;return new Promise(((r,n)=>{t=new FileReader,t.onload=r,t.onerror=()=>{var e;n("NotReadableError"===(null===(e=t.error)||void 0===e?void 0:e.name)?new a.FileNotReadableError(`blobToArrayBuffer error: ${l(t.error)}`):new Error(`blobToArrayBuffer error: ${l(t.error)}`))},t.onabort=()=>{n(new Error(`blobToArrayBuffer abort: ${l(t.error)}`))},t.readAsArrayBuffer(e)})).then((()=>t.result))}function d(e){return e.replace(/\.+$/,"")}function u(e){const t=d(e.trimRight()).split(".");return t.length>1?t[t.length-1].toLowerCase():null}function p(){return(p=(0,i.default)((function*(e){if("function"==typeof e.text)return e.text();const t=new FileReader;if(yield new Promise(((r,n)=>{t.onload=r,t.onerror=e=>{n(new Error(`blobToText error: ${String(e)}`))},t.onabort=e=>{n(new Error(`blobToText abort: ${String(e)}`))},t.readAsText(e)})),t.result instanceof ArrayBuffer)throw new TypeError("blobToText error: Invalid result type: ArrayBuffer");if(null==t.result)throw new TypeError("blobToText: Invalid result type: null");return t.result}))).apply(this,arguments)}},29498:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forbiddenAssertDOMNode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const r=i(e,t);if(r)return r;throw new Error(`[ForbiddenAssertDOMNode] findDOMNode returned ${String(r)} with component ${String(e)}`)},t.forbiddenFindDOMNode=i;var n=r(73935);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const r=(0,n.findDOMNode)(e);if(r){if(r instanceof t)return r;throw new Error(`[forbiddenFindDOMNode] returned node not instance of ${String(t)}`)}return r}},45494:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=null,r=0;try{var n;const i=e.length;for(;r<i;){const n=e.codePointAt(r),i=n>65535?2:1;if(m(t)&&(n<48||n>57))if(45===n)0===t.phoneNumberParenthesesDepth?45===t.phoneNumberLastSignificantCodePoint?E(t,r):0===t.phoneNumber.length?_(t):d(t):_(t);else if(46===n)0===t.phoneNumberParenthesesDepth?46===t.phoneNumberLastSignificantCodePoint?E(t,r):0===t.phoneNumber.length?_(t):c(t):_(t);else if(40===n);else if(41===n)S(t,r);else if(32===n)if(32===t.phoneNumberLastSignificantCodePoint)_(t);else{y(t,r)||u(t)}else E(t,r);switch(n){case 42:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:m(t)||(t||(t=s(e)),f(t,r)),p(t,n);break;case 43:t||(t=s(e)),f(t,r),l(t);break;case 40:m(t)||(t||(t=s(e)),f(t,r)),h(t,r)}r+=i}return t&&null!=t.openings&&E(t,e.length),(null===(n=t)||void 0===n?void 0:n.parsedPhoneNumbers)&&t.parsedPhoneNumbers.length>0?t.parsedPhoneNumbers.reduce(((e,t)=>(e.push({phone:t.matchedText,index:t.start}),e)),[]):[]}catch(e){return __LOG__(4,void 0,new Error,!0)`findPhoneNumbers parse error: ${String(e)}`,SEND_LOGS("findPhoneNumbers-error"),[]}};var i=n(r(88306)),a=r(40277),o=r(99234);function s(e){return{uniqueId:0,text:e,openings:null,phoneNumber:"",phoneNumberStartsWithPlus:!1,phoneNumberLastSignificantCodePoint:-1,phoneNumberParenthesesDepth:0,phoneNumberLeadingZeroes:0,phoneNumberCurrentlyMatchingLeadingZeroes:!0,parsedPhoneNumbers:null}}function l(e){e.phoneNumberStartsWithPlus=!0}function c(e){e.phoneNumberLastSignificantCodePoint=46}function d(e){e.phoneNumberLastSignificantCodePoint=45}function u(e){e.phoneNumberLastSignificantCodePoint=32}function p(e,t){e.phoneNumber=e.phoneNumber+String.fromCodePoint(t),e.phoneNumberLastSignificantCodePoint=t,e.phoneNumberCurrentlyMatchingLeadingZeroes&&(48===t?e.phoneNumberLeadingZeroes++:e.phoneNumberCurrentlyMatchingLeadingZeroes=!1)}function f(e,t){null==e.openings?(e.openings=t,e.phoneNumber="",e.phoneNumberStartsWithPlus=!1,e.phoneNumberLastSignificantCodePoint=-1,e.phoneNumberParenthesesDepth=0,e.phoneNumberLeadingZeroes=0,e.phoneNumberCurrentlyMatchingLeadingZeroes=!0):__LOG__(4,void 0,new Error)`Msg formatting: cannot open a style before closing it`}function _(e){null!=e.openings?e.openings=null:__LOG__(4,void 0,new Error)`Msg formatting: cannot close a style before opening it`}function h(e,t){1!==e.phoneNumberParenthesesDepth?(e.phoneNumberParenthesesDepth++,e.phoneNumberLastSignificantCodePoint=-1):_(e)}const g=(0,i.default)((e=>(0,a.phoneCC)(e)));function m(e){return null!=e&&null!=e.openings}function y(e,t){const r=function(e,t){if(null==e.openings)return;if(1===e.phoneNumberParenthesesDepth)return null;const r=e.phoneNumber.slice(Math.min(2,e.phoneNumberLeadingZeroes));if(0===r.length)return null;let n=!1,i=r;if(e.phoneNumberStartsWithPlus||e.phoneNumberLeadingZeroes>=2){const e=(0,a.findCC)(r),t=r.slice(e.length);n=(0,a.isPotentiallyValid)(e,t)}else{var s;const e=(null===(s=(0,o.getMaybeMeUser)())||void 0===s?void 0:s.toString())||"",t=g(e);if(n=(0,a.isPotentiallyValid)(t,r),n)i=`${t}${r}`;else{const e=(0,a.findCC)(r);if(e===t){const t=r.slice(e.length);n=(0,a.isPotentiallyValid)(e,t)}}}if(n){const r=e.openings;if(null==r)return null;const n=45===e.phoneNumberLastSignificantCodePoint||46===e.phoneNumberLastSignificantCodePoint?t-1:t,a=e.text.slice(r,n);return{start:r,end:n,id:"phone"+ ++e.uniqueId,phoneNumber:i,matchedText:a}}return null}(e,t);return null!=r&&(_(e),e.parsedPhoneNumbers?e.parsedPhoneNumbers.push(r):e.parsedPhoneNumbers=[r],!0)}function E(e,t){y(e,t)||_(e)}function S(e,t){0===e.phoneNumberParenthesesDepth||e.phoneNumberLastSignificantCodePoint<48||e.phoneNumberLastSignificantCodePoint>57?_(e):(e.phoneNumberParenthesesDepth--,e.phoneNumberLastSignificantCodePoint=-1)}},74036:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{chat:t,undelivered:r,canForward:n,cannotForward:s}=e;const l=n.length-r.length,c=s.length+r.length,d=t.isUser?{contact:t.formattedTitle}:{};if(l>0)return r.length?s.length?o.default.t(257,(0,i.default)({count:c,_plural:c},d)):o.default.t(256,{count:c,_plural:c}):o.default.t(254,{count:c,_plural:c,contact:t.formattedTitle});if(r.length)return s.length?o.default.t(258,d):a.fbt._("No messages could be forwarded because the file is missing.",null,{hk:"1dn9Vk"});return o.default.t(255,d)};var i=n(r(81109)),a=r(48360),o=n(r(43725))},76589:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:String,a=(0,i.default)(e,t.map(n)).join("");const o=r?4e3:Number.POSITIVE_INFINITY;a.length>o&&(a=a.slice(0,o).replace(/\s+$/," [truncated]"));return a};var i=n(r(30138))},70014:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatNFMText=function(e){return e.caption||""}},45126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("ForwardError")){constructor(e){super(),this.reasons=e}}t.default=i},38034:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aspectRatioScaled=function(e,t){if("number"!=typeof e||e<0||e!=e)return{width:t,height:t};if(e>1)return{width:t,height:Math.max(t/e,1)};return{width:Math.max(t*e,1),height:t}},t.boundHeightWidth=function(e,t,r){let n=null!=t?t:r,i=null!=e?e:r;n>i?n>r&&(i*=r/n,n=r):i>r&&(n*=r/i,i=r);return{width:Math.max(n,1),height:Math.max(i,1)}},t.rotatePoint=function(e,t,r){const n=r*Math.PI/180;return{x:Math.cos(n)*e+Math.sin(n)*t,y:-Math.sin(n)*e+Math.cos(n)*t}}},2383:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDebugInfo=function(e){l.Wam.initialize();const t=(0,i.default)((0,i.default)({},s.default.Global.all),{},{webcWebPlatform:"web",webcPhonePlatform:a.Conn.platform,webcProtoVersion:String(a.Conn.protoVersion)}),r=(0,o.getMe)();r&&(t.deviceID=r.toString());e&&(t.context=e);const n={};for(const e in t){const r=t[e];null!=r&&(n[e]=r)}return n};var i=n(r(81109)),a=r(17239),o=r(99234),s=n(r(11339)),l=r(77959)},32990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFbBrandedNumber=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){return(0,n.getABPropConfigValue)("system_msg_numbers_fb_branded").split(",").includes(e)}return!1},t.getIsInternalNumber=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const t=(0,n.getABPropConfigValue)("system_msg_numbers_fb_branded").split(","),r=(0,n.getABPropConfigValue)("system_msg_numbers_fb_inc").split(",");return t.includes(e)||r.includes(e)}return a.has(e)};var n=r(86945),i=r(7293);const a=new Set(["16505434800","16503130062","16507885324","16508620604","16504228206","16505212669","447710173736","16507885280","19032707825","16505361212","16508129150","16315555102","0"])},24238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const t=(0,i.getABPropConfigValue)("in_app_support_v2_numbers");return null!=t&&""!==t&&t.split(",").includes(e)}return!1};var n=r(7293),i=r(86945)},50338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIBusyTasks=t.IdleEnum=t.IdleCallbackTasks=void 0;var n=r(57319),i=r(53485);const a=r(76672).Mirrored(["IDLE_CALLBACK","UI_BUSY"]);t.IdleEnum=a;class o{constructor(e){this.busyMap=new Map,this.busyId=0,this._clearBusyMap=()=>{this.busyMap.clear()},this._taskMap=new Map,this.taskId=0,this.runIdleLoop=()=>{this.idleType===a.IDLE_CALLBACK?this.idleCallbackId=(0,i.requestIdleCallback)(this._ricOnIdle):this.isIdle()&&this._uiBusyOnIdle()},this._ricOnIdle=e=>{let t;const r=this._taskMap.entries();for(;(t=r.next())&&!t.done;){const[r,n]=t.value;if(n(),this._taskMap.delete(r),e.timeRemaining()<=0)break}this._taskMap.size>0&&this.runIdleLoop()},this.idleType=e}setBusy(e){let t=e;return null!=t&&this.busyMap.has(t)?this.busyMap.set(t,this.busyMap.get(t)+1):(t=++this.busyId,this.busyMap.set(t,1)),this.busyTimer||(this.busyTimer=new n.ShiftTimer(this._clearBusyMap)),this.busyTimer.debounce(1e3),t}decBusy(e){if(null==e)return;const t=this.busyMap.get(e);null!=t&&0!==t&&(1===t?this.clearBusy(e):this.busyMap.set(e,t-1))}clearBusy(e){null!=this.busyMap.get(e)&&this.busyMap.delete(e),this.isIdle()&&(this.busyTimer.cancel(),this._taskMap.size>0&&window.setTimeout(this.runIdleLoop,0))}isIdle(){return 0===this.busyMap.size}isBusy(){return this.busyMap.size>0}cancelIdleLoop(){this.idleType===a.IDLE_CALLBACK&&null!=this.idleCallbackId&&(0,i.cancelIdleCallback)(this.idleCallbackId)}_uiBusyOnIdle(){let e;const t=this._taskMap.entries();for(;(e=t.next())&&!e.done;){const[t,r]=e.value;if(r(),this._taskMap.delete(t),this.isBusy())break}}enqueue(e){return this._taskMap.set(++this.taskId,e),1===this._taskMap.size&&this.runIdleLoop(),this.taskId}dequeue(e){const t=this._taskMap.delete(e);return t&&0===this._taskMap.size&&this.cancelIdleLoop(),t}isInQueue(e){return this._taskMap.has(e)}}const s=new o(a.UI_BUSY);t.UIBusyTasks=s;const l=new o(a.IDLE_CALLBACK);t.IdleCallbackTasks=l},36638:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_URL=t.CANVAS=t.BlackVideoThumbnailError=t.BLOB=void 0,t.base64ImageToCanvas=function(){return F.apply(this,arguments)},t.crop=function(){return I.apply(this,arguments)},t.generateLinkPreview=function(){return R.apply(this,arguments)},t.generateVideoThumbsAndDuration=function(){return O.apply(this,arguments)},t.isCached=function(e){if(!e)return!1;const t=new Image;return t.src=e,!!t.complete},t.rotateAndResize=function(e,t,r,n){const{transparency:i=!1,fitToSquare:a=!1,minDimension:o=0}=null!=n?n:{},c=new ArrayBuffer(0);let u,p,m;e instanceof HTMLCanvasElement?(p=Promise.resolve(e),m=Promise.resolve(c)):(u=window.URL.createObjectURL(e),p=g.loadImage(u),m=(0,f.blobToArrayBuffer)(e).catch((e=>(__LOG__(3)`ImageUtils::rotateAndResize error: ${e}`,c))));return(0,s.promiseProps)({buffer:m,image:p}).then((e=>{var n;let{buffer:c,image:u}=e,p={};try{p=(0,l.default)(c)}catch(e){}let f=0;if(!(null===(n=Modernizr)||void 0===n?void 0:n.exiforientation))switch(p.orientation||"UNKNOWN"){case"right-top":f=1;break;case"left-bottom":f=-1;break;case"bottom-right":f=2}const g=document.createElement("canvas"),m=u.naturalWidth||u.width,y=u.naturalHeight||u.height,E=Math.max(m,y),S=g.getContext("2d"),v={};if(!f){const e=(0,_.boundHeightWidth)(y,m,t);let n,l,p=r&A;if(c&&p&&m===e.width&&y===e.height)try{const e=(0,h.cleanJPEG)(c);v.blob=e,p=!1,n=m,l=y}catch(e){__LOG__(2)`Could not parse JPEG: ${e.message}`}return(p||r&~A)&&(g.width=e.width,g.height=e.height,i||(0,d.fillBackgroundWithGray)(g),S.drawImage(u,0,0,g.width,g.height),a&&((0,d.square)(g),v.blob=void 0),E<o&&((0,d.scale)(g,o),v.blob=void 0),n=g.width,l=g.height,U(v,g,r,i)),(0,s.promiseProps)(v).then((e=>({width:n,height:l,images:e})))}switch(f){case 1:case-1:const e=Math.max(m,y),n=e/2;g.width=g.height=e,i||(0,d.fillBackgroundWithGray)(g),(0,d.rotate)(S,{x:n,y:n,degrees:90*f}),1===f?S.drawImage(u,0,e-y):S.drawImage(u,e-m,0),(0,d.rotate)(S,{x:n,y:n,degrees:-90*f}),(0,d.resize)(g,y,m),a&&(0,d.square)(g),E<o&&(0,d.scale)(g,o);const l=(0,d.contain)(g,t);return U(v,l,r,i),(0,s.promiseProps)(v).then((e=>({width:l.width,height:l.height,images:e})));case 2:const c=(0,_.boundHeightWidth)(y,m,t),p=g.width=c.width,h=g.height=c.height;return i||(0,d.fillBackgroundWithGray)(g),(0,d.rotate)(S,{x:p/2,y:h/2,degrees:90*f}),S.drawImage(u,0,0,p,h),(0,d.rotate)(S,{x:p/2,y:h/2,degrees:-90*f}),a&&(0,d.square)(g),E<o&&(0,d.scale)(g,o),U(v,g,r,i),(0,s.promiseProps)(v).then((e=>({width:g.width,height:g.height,images:e})))}})).finally((()=>{}))},t.toDataUrl=function(){return D.apply(this,arguments)},t.toDataUrlWithRoundedCorners=function(){return w.apply(this,arguments)},t.toWebpSticker=function(){return k.apply(this,arguments)},t.urlToFile=function(){return G.apply(this,arguments)};var a=i(r(48926)),o=r(40265),s=r(67602),l=i(r(26642)),c=r(45044),d=r(35718),u=S(r(64103)),p=r(91903),f=r(1063),_=r(38034),h=r(45987),g=S(r(97692)),m=r(90669),y=r(65127);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function S(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const v=2,T=4,C=1;t.DATA_URL=C;const A=v;t.BLOB=A;const b=T;t.CANVAS=b;class P extends((0,o.customError)("BlackVideoThumbnailError")){}t.BlackVideoThumbnailError=P,P.message="Generated video thumbnail is black";const M=e=>{let{video:t,fullWidth:r,fullHeight:n,maxDimension:i}=e;const a=document.createElement("canvas"),{width:o,height:s}=(0,_.boundHeightWidth)(n,r,i);a.width=o,a.height=s;const l=a.getContext("2d");l.drawImage(t,0,0,o,s);const c=l.getImageData(0,0,o,s);return{thumb:{url:a.toDataURL("image/jpeg"),width:o,height:s,fullWidth:r,fullHeight:n},imageData:c}};function O(){return(O=(0,a.default)((function*(e){const{file:t,maxDimensions:r,debugHint:i,throwOnBlack:a=!1}=e,{video:o,fullWidth:s,fullHeight:l}=yield g.loadVideo(t),c=e=>{const t=e.width*e.height/4;for(let r=0;r<=1;r+=.25){const n=4*Math.round(t*r);if(0!==e.data[n])return!1;if(0!==e.data[n+1])return!1;if(0!==e.data[n+2])return!1;const i=e.data[n+3];if(0!==i&&255!==i)return!1}return!0};if(y.UA.isBuggyVideoLoad){const e=50,t=5e3/e;return(0,p.exponentialBackoff)({minTimeout:e,maxTimeout:e,retries:t,signal:(new n).signal,factor:1},((e,n)=>{const d=[];let u;for(u of r){const{thumb:r,imageData:p}=M({video:o,fullHeight:l,fullWidth:s,maxDimension:u});if(c(p)){if(n<t)return 0===n&&__LOG__(2)`generateVideoThumbsAndDuration: Setting video.currentTime to 0 to attempt to unblock the video`,o.currentTime=0,e(new Error("retry"));if(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a)throw new P}d.push(r)}const p={duration:~~o.seekable.end(0),thumbs:d};return g.disposeVideo(o),Promise.resolve(p)}))}try{const e=r.map((e=>{const{thumb:t,imageData:r}=M({video:o,fullHeight:l,fullWidth:s,maxDimension:e});if(c(r)&&(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a))throw new P;return t}));return{duration:~~o.seekable.end(0),thumbs:e}}finally{g.disposeVideo(o)}}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,n,i,a,o){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:C;const c=e instanceof HTMLCanvasElement?e:yield g.loadImage(e),d=document.createElement("canvas"),u=d.getContext("2d");null==a||null==o?(d.height=i,d.width=n,u.drawImage(c,t,r,n,i)):(d.height=o,d.width=a,u.drawImage(c,t,r,n,i,0,0,a,o));const p={};U(p,d,l);const f=yield(0,s.promiseProps)(p);return{images:f,width:n,height:i}}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){const t=e instanceof HTMLCanvasElement?e:yield g.loadImage(e),r=document.createElement("canvas"),n=r.getContext("2d");r.height=t.height,r.width=t.width;const i=Math.min(t.width,t.height);return n.beginPath(),n.arc(t.width/2,t.height/2,i/2,0,2*Math.PI,!0),n.clip(),n.closePath(),n.drawImage(t,0,0),r.toDataURL("image/png")}))).apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),r=100,n=140;if(t.width<r||t.height<r)return __LOG__(2)`Image size too small for link preview`,null;const i=document.createElement("canvas"),a=i.getContext("2d");i.height=n,i.width=n;const o=Math.min(t.width,t.height),s=(t.width-o)/2,l=(t.height-o)/2;return a.drawImage(t,s,l,o,o,0,0,n,n),i.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`link preview image generation failed: `,null}}))).apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),r=document.createElement("canvas"),n=r.getContext("2d");return r.height=t.height,r.width=t.width,n.drawImage(t,0,0),r.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`data URL conversion failed: `,null}}))).apply(this,arguments)}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t){try{const r=yield e.arrayBuffer(),n=(0,c.addWebpMetadata)(r,t),i=new Uint8Array(n);return new Blob([i],{type:"image/webp"})}catch(t){return __LOG__(4,void 0,new Error,!0)`addMetadataToSticker: Unable to add metadata to Sticker`,SEND_LOGS("unable-to-add-sticker-metadata"),e}}))).apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){try{const t=window.URL.createObjectURL(e),r=yield g.loadImage(t);window.URL.revokeObjectURL(t);const n=m.STICKER_DIMENSION,i=(0,d.createCanvas)(n,n),a=i.getContext("2d"),{width:o,height:s}=(0,_.aspectRatioScaled)(r.width/r.height,n);a.drawImage(r,(n-o)/2,(n-s)/2,o,s);const l=yield(0,d.canvasToWebp)(i);return yield N(l,{isFirstParty:!1,isFromStickerMaker:!0,emojis:[],stickerPackPublisher:"WhatsApp Sticker Maker"})}catch(e){throw __LOG__(2)`Webp sticker file generation failed: `,e}}))).apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),r=document.createElement("canvas");r.width=t.naturalWidth,r.height=t.naturalHeight;const n=r.getContext("2d");return(0,d.fillBackgroundWithGray)(r),n.drawImage(t,0,0),(0,d.canvasToBlob)(r)}catch(t){throw new u.MediaDragDropError("unable to render image",e)}}))).apply(this,arguments)}function U(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n?"image/png":"image/jpeg";!e.blob&&r&A&&(e.blob=(0,d.canvasToBlob)(t,i)),!e.dataUrl&&r&C&&(e.dataUrl=Promise.resolve(t.toDataURL(i))),!e.canvas&&r&b&&(e.canvas=Promise.resolve(t))}function F(){return(F=(0,a.default)((function*(e){const t=yield g.loadImage(e),r=(0,d.createCanvas)(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),r}))).apply(this,arguments)}},89748:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=i(r(84644));t.default=class{constructor(){this._lastPromise=Promise.resolve(),this._controller=new n,this._pending=[]}enqueue(e){e.catch((()=>{}));const t=()=>e,r=this._controller.signal;this._lastPromise=this._lastPromise.then(t,t);const n=(0,o.default)(this._lastPromise,r).catch((0,a.catchAbort)((e=>{var t;throw null!==(t=this._cancellationError)&&void 0!==t?t:e})));return this._pending.push(n),n.finally((()=>{this._pending.length>0&&this._pending[0]===n&&this._pending.shift()}))}cancelAll(e){this._cancellationError=e,this._pending=[],this._controller.abort(),this._controller=new n}}},2680:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=self.indexedDB}catch(e){}var n=r;t.default=n},14111:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waNoiseInfo=t.deviceInfo=void 0;var i=n(r(48926)),a=r(15688),o=r(8584),s=n(r(43725)),l=r(58052);const{DbEncKeyStore:c}=r(15998);const d=new class{get(){return{osVersion:"0.1",osBuild:"0.1",hardware:"desktop",manufacturer:"",device:"Desktop",lg:s.default.getLanguage(),lc:s.default.getRegion()||"",mcc:"000",mnc:"000",sim_mnc:"000",sim_mcc:"000"}}};t.deviceInfo=d;const u=new class{get(){var e=this;return(0,i.default)((function*(){const t=(0,l.getNoiseInfo)(),r=e._getIv();return t&&r?(t.recoveryToken=yield e._decryptNoiseData(t.recoveryToken,r[0]),t.staticKeyPair.pubKey=yield e._decryptNoiseData(t.staticKeyPair.pubKey,r[1]),t.staticKeyPair.privKey=yield e._decryptNoiseData(t.staticKeyPair.privKey,r[2]),t):null}))()}set(e){var t=this;return(0,i.default)((function*(){const r=new Uint8Array(48);self.crypto.getRandomValues(r);const n=t._processIv(r);return t._setIv(n),e.recoveryToken=yield t._encryptNoiseData(e.recoveryToken,n[0]),e.staticKeyPair.pubKey=yield t._encryptNoiseData(e.staticKeyPair.pubKey,n[1]),e.staticKeyPair.privKey=yield t._encryptNoiseData(e.staticKeyPair.privKey,n[2]),(0,l.setNoiseInfo)(e)}))()}_setIv(e){return(0,l.setNoiseInfoIv)(e.map(a.encodeB64))}_getIv(){const e=(0,l.getNoiseInfoIv)();return e?e.map((e=>new Uint8Array((0,a.decodeB64)(e)))):null}_processIv(e){const t=new o.Binary(e);return[t.readByteArray(16),t.readByteArray(16),t.readByteArray(16)]}_encryptNoiseData(e,t){return(0,i.default)((function*(){const r=c.encKeys[0];return yield self.crypto.subtle.encrypt({iv:t,name:"AES-CBC"},r.key,e)}))()}_decryptNoiseData(e,t){return(0,i.default)((function*(){const r=c.encKeys[0];return yield self.crypto.subtle.decrypt({iv:t,name:"AES-CBC"},r.key,e)}))()}};t.waNoiseInfo=u},7056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return!!e&&e.includes("audio/ogg")}},63824:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,r(67294).createContext)(!1);t.default=n},29522:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.L10n=void 0;var i=n(r(42317)),a=n(r(97331)),o=n(r(30381)),s=n(r(34342)),l=r(30031),c=r(53558),d=n(r(70210)),u=n(r(45180)),p=n(r(17588));const f=new Set(["",""]),_=new Set(["ar","ar-XB","fa","ur","he","dv","ku"]),h=new Set(["ar","ar-XB","fa"]),g="".split("");function m(e){return g[parseInt(e,10)]}const y=new Error("Unimplemented method");class E extends s.default{constructor(e,t,r){if(super(),!e||!t)throw y;this._locale=e,this.localeStrings={},this.localeStrings[c.DEFAULT_LOCALE]=t,this.fbtStrings={},this.fbtStrings[c.DEFAULT_LOCALE]={en:{}},this.markTranslations=r,this.customizeMoment()}getLocale(){throw y}getFbtTranslations(){throw y}setLocale(){throw y}normalizeLocale(e){const t=e.replace(/-/g,"_").toLowerCase(),r=this._getTranslationFilename(t);if(r)return r;let n=t;for(;n;){n=n.split("_").slice(0,-1).join("_");const e=n&&this._getTranslationFilename(n);if(e)return e}}isLocaleSupported(e){return!!e&&!!this.normalizeLocale(e)}_getTranslationFilename(e){const t=d.default[e]||e;return p.default[t]}isRTL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLocale();return _.has(e)}LR(e,t){return this.isRTL()?t:e}embedDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.embedRTL(e):this.embedLTR(e)}forceDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.forceRTL(e):this.forceLTR(e)}embedLTR(e){return""+e+""}embedRTL(e){return""+e+""}isolateLTR(e){return""+e+""}isolateRTL(e){return""+e+""}forceLTR(e){return""+e}forceRTL(e){return""+e}t(e,t,r){"number"!=typeof e&&__LOG__(3)`l10n.t was called with an unprocessed id (${e}). If you just added a string on local, restarting your build may address the issue.`;const n=e,i=null!=t?t._plural:null;let a=r||this.getLocale();this.localeStrings[a]||(a=c.DEFAULT_LOCALE);let o=this._getString(n,a,i);this.markTranslations&&(o?a===c.DEFAULT_LOCALE&&(o="["+o+"]"):(o="!!"+n+"!!",__LOG__(2)`l10n:t string key "${n}" not found`)),o||(o=this._getString(n,c.DEFAULT_LOCALE,i)),o||__LOG__(2)`l10n:t string key "${n}" fallback failed`;for(const e in t){if(!t.hasOwnProperty(e)||"_plural"===e)continue;const r=new RegExp("__"+e+"__","g");let n;n="string"==typeof t[e]&&f.has(t[e].slice(0,1))?t[e]:this.n(t[e],a),o=o.replace(r,n)}return o}_getString(e,t,r){const n=this.localeStrings[t]||this.localeStrings[c.DEFAULT_LOCALE];if(null==n)throw new Error(`Couldn't find translations for locale ${t} or default (${c.DEFAULT_LOCALE})`);if(!Array.isArray(n))throw new Error("Unexpected locale format.");const[i,a]=n,o=i[e]||"";if(null==r)return o;const s=u.default[t];if(null==s)return o;const l=s.numbers[s.plurals(r)];if(1===l)return o;return a[2===s.numbers.length&&2===l?e.toString():`${e}_${l}`]||o}useArabicScriptDigits(e){return h.has(e||this.getLocale())}isLatinAlphabetLanguage(e){return a.default.isLatin(this.removeAccents(e))}n(e,t){let r=e;return isNaN(r)||(r=r.toString()),this.useArabicScriptDigits(t)?r.toString().replace(/[0-9]/g,m):r}filesize(e){const t=this;return this.n((0,i.default)(e,{base:2,round:0,suffixes:{B:t.t(461),kB:t.t(463),MB:t.t(464),GB:t.t(462)}}))}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,l.normalizeForm)(e)}removeAccents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,l.removeAccents)(e)}accentFold(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.removeAccents(e).toLowerCase()}customizeMoment(){o.default.relativeTimeRounding(Math.floor),o.default.relativeTimeThreshold("s",60),o.default.relativeTimeThreshold("m",60),o.default.relativeTimeThreshold("h",24)}}t.L10n=E},79502:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryShortcodeByPhone=function(e){if(null==e||0===e.length)return"";const t=function(e,t){if(null!=e&&e.length>0&&null!=t){let r=t[e[0]],n=e;for(;n.length>0&&r;){if(r.c)return r.c;n=n.substr(1,n.length-1),r=r[n[0]]}}return""}(e,r);return""===t&&"1"===e[0]?"US":"RU"===t&&["6","7"].includes(e[1])?"KZ":t};const r={1:{2:{0:{4:{c:"CA"}},2:{6:{c:"CA"}},3:{6:{c:"CA"}},4:{2:{c:"BS"},9:{c:"CA"}},5:{0:{c:"CA"}},6:{4:{c:"AI"},8:{c:"AG"}},8:{4:{c:"VG"},9:{c:"CA"}}},3:{0:{6:{c:"CA"}},4:{0:{c:"VI"},3:{c:"CA"},5:{c:"KY"}},6:{5:{c:"CA"},7:{c:"CA"}}},4:{0:{3:{c:"CA"}},1:{6:{c:"CA"},8:{c:"CA"}},3:{1:{c:"CA"},7:{c:"CA"},8:{c:"CA"}},4:{1:{c:"BM"}},5:{0:{c:"CA"}},7:{3:{c:"GD"}}},5:{0:{6:{c:"CA"}},1:{4:{c:"CA"},9:{c:"CA"}},4:{8:{c:"CA"}},7:{9:{c:"CA"}},8:{1:{c:"CA"},7:{c:"CA"}}},6:{0:{4:{c:"CA"}},1:{3:{c:"CA"}},3:{9:{c:"CA"}},4:{7:{c:"CA"},9:{c:"TC"}},5:{8:{c:"JM"}},6:{4:{c:"MS"}},7:{0:{c:"MP"},1:{c:"GU"},2:{c:"CA"}},8:{4:{c:"AS"}}},7:{0:{5:{c:"CA"},9:{c:"CA"}},2:{1:{c:"MF"}},5:{8:{c:"LC"}},6:{7:{c:"DM"}},7:{8:{c:"CA"}},8:{0:{c:"CA"},2:{c:"CA"},4:{c:"VC"},7:{c:"PR"}}},8:{0:{7:{c:"CA"},9:{c:"DO"}},1:{9:{c:"CA"}},2:{5:{c:"CA"},9:{c:"DO"}},4:{9:{c:"DO"}},6:{7:{c:"CA"},8:{c:"TT"},9:{c:"KN"}},7:{3:{c:"CA"},6:{c:"JM"}}},9:{0:{2:{c:"CA"},5:{c:"CA"}},3:{9:{c:"PR"}}}},2:{0:{c:"EG"},1:{1:{c:"SS"},2:{c:"MA"},3:{c:"DZ"},6:{c:"TN"},8:{c:"LY"}},2:{0:{c:"GM"},1:{c:"SN"},2:{c:"MR"},3:{c:"ML"},4:{c:"GN"},5:{c:"CI"},6:{c:"BF"},7:{c:"NE"},8:{c:"TG"},9:{c:"BJ"}},3:{0:{c:"MU"},1:{c:"LR"},2:{c:"SL"},3:{c:"GH"},4:{c:"NG"},5:{c:"TD"},6:{c:"CF"},7:{c:"CM"},8:{c:"CV"},9:{c:"ST"}},4:{0:{c:"GQ"},1:{c:"GA"},2:{c:"CG"},3:{c:"CD"},4:{c:"AO"},5:{c:"GW"},6:{c:"IO"},7:{c:"AC"},8:{c:"SC"},9:{c:"SD"}},5:{0:{c:"RW"},1:{c:"ET"},2:{c:"SO"},3:{c:"DJ"},4:{c:"KE"},5:{c:"TZ"},6:{c:"UG"},7:{c:"BI"},8:{c:"MZ"}},6:{0:{c:"ZM"},1:{c:"MG"},2:{c:"RE"},3:{c:"ZW"},4:{c:"NA"},5:{c:"MW"},6:{c:"LS"},7:{c:"BW"},8:{c:"SZ"},9:{c:"KM"}},7:{c:"ZA"},9:{0:{c:"SH"},1:{c:"ER"},7:{c:"AW"},8:{c:"FO"},9:{c:"GL"}}},3:{0:{c:"GR"},1:{c:"NL"},2:{c:"BE"},3:{c:"FR"},4:{c:"ES"},5:{0:{c:"GI"},1:{c:"PT"},2:{c:"LU"},3:{c:"IE"},4:{c:"IS"},5:{c:"AL"},6:{c:"MT"},7:{c:"CY"},8:{c:"FI"},9:{c:"BG"}},6:{c:"HU"},7:{0:{c:"LT"},1:{c:"LV"},2:{c:"EE"},3:{c:"MD"},4:{c:"AM"},5:{c:"BY"},6:{c:"AD"},7:{c:"MC"},8:{c:"SM"}},8:{0:{c:"UA"},1:{c:"RS"},2:{c:"ME"},3:{c:"XK"},5:{c:"HR"},6:{c:"SI"},7:{c:"BA"},9:{c:"MK"}},9:{c:"IT"}},4:{0:{c:"RO"},1:{c:"CH"},2:{0:{c:"CZ"},1:{c:"SK"},3:{c:"LI"}},3:{c:"AT"},4:{c:"GB"},5:{c:"DK"},6:{c:"SE"},7:{c:"NO"},8:{c:"PL"},9:{c:"DE"}},5:{0:{0:{c:"FK"},1:{c:"BZ"},2:{c:"GT"},3:{c:"SV"},4:{c:"HN"},5:{c:"NI"},6:{c:"CR"},7:{c:"PA"},8:{c:"PM"},9:{c:"HT"}},1:{c:"PE"},2:{c:"MX"},3:{c:"CU"},4:{c:"AR"},5:{c:"BR"},6:{c:"CL"},7:{c:"CO"},8:{c:"VE"},9:{0:{c:"GP"},1:{c:"BO"},2:{c:"GY"},3:{c:"EC"},4:{c:"GF"},5:{c:"PY"},6:{c:"MQ"},7:{c:"SR"},8:{c:"UY"},9:{c:"CW"}}},6:{0:{c:"MY"},1:{c:"AU"},2:{c:"ID"},3:{c:"PH"},4:{c:"NZ"},5:{c:"SG"},6:{c:"TH"},7:{0:{c:"TL"},2:{c:"NF"},3:{c:"BN"},4:{c:"NR"},5:{c:"PG"},6:{c:"TO"},7:{c:"SB"},8:{c:"VU"},9:{c:"FJ"}},8:{0:{c:"PW"},1:{c:"WF"},2:{c:"CK"},3:{c:"NU"},5:{c:"WS"},6:{c:"KI"},7:{c:"NC"},8:{c:"TV"},9:{c:"PF"}},9:{0:{c:"TK"},1:{c:"FM"},2:{c:"MH"}}},7:{c:"RU"},8:{1:{c:"JP"},2:{c:"KR"},4:{c:"VN"},5:{0:{c:"KP"},2:{c:"HK"},3:{c:"MO"},5:{c:"KH"},6:{c:"LA"}},6:{c:"CN"},8:{0:{c:"BD"},6:{c:"TW"}}},9:{0:{c:"TR"},1:{c:"IN"},2:{c:"PK"},3:{c:"AF"},4:{c:"LK"},5:{c:"MM"},6:{0:{c:"MV"},1:{c:"LB"},2:{c:"JO"},3:{c:"SY"},4:{c:"IQ"},5:{c:"KW"},6:{c:"SA"},7:{c:"YE"},8:{c:"OM"}},7:{0:{c:"PS"},1:{c:"AE"},2:{c:"IL"},3:{c:"BH"},4:{c:"QA"},5:{c:"BT"},6:{c:"MN"},7:{c:"NP"}},8:{c:"IR"},9:{2:{c:"TJ"},3:{c:"TM"},4:{c:"AZ"},5:{c:"GE"},6:{c:"KG"},8:{c:"UZ"}}}}},30031:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getLanguageCodeFromLocale=function(e){return e.replace(/_/g,"-").split("-")[0].toLowerCase()},t.getRegionCodeFromLocale=function(e){const t=e.replace(/_/g,"-").split("-");if(t.length<=1)return null;return t[t.length-1].toUpperCase()},t.normalizeForm=a,t.removeAccents=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,i.default)(a(e).replace(/(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])/g,""))};var i=n(r(97331));function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.normalize("NFKD")}},43725:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(13959),o=r(4352),s=r(48360),l=n(r(30381)),c=r(29522),d=r(41796),u=r(30031),p=r(53558),f=n(r(68609)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),h=r(65127);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}const m=self.location.href;m&&m.includes("/%F0%9F%8C%90/")&&Promise.resolve().then(r.bind(r,2541)).then((e=>{let{URL:t}=e;t.canMuckHistory()&&window.history.replaceState({},"","/")}));const y="en-GB",E={LTR:"LTR",RTL:"RTL"},S={LTR:"style",RTL:"style_rtl"},v=p.L10N_PRIORITY;class T extends c.L10n{constructor(){super({l:p.DEFAULT_LOCALE,priority:v.DEFAULT,loc:p.DEFAULT_LOCALE},r(43756).default,p.MARK_TRANSLATIONS);{const e=function(){if((0,d.isConnectedToPage)())return document.querySelector("html").getAttribute("loc")}(),t={};this._considerLocale(t,e,v.PREVIOUS)&&this.downloadAndSetTranslation(t)}}getLocale(){return this._locale.l}getFbtTranslations(){return this.fbtStrings[this._locale.l]}getFullLocale(){return this._locale.loc.replace("_","-")}getLanguage(){return(0,u.getLanguageCodeFromLocale)(this.getFullLocale())}getRegion(){return(0,u.getRegionCodeFromLocale)(this.getFullLocale())}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!h.UA.isTrident)return e.normalize("NFKD");try{return e.normalize("NFKD")}catch(t){return e}}setLocale(e,t){var r=this;return(0,i.default)((function*(){const n={l:r._locale.l,priority:r._locale.priority,loc:r._locale.l};return r._considerLocale(n,e,t)?r.downloadAndSetTranslation(n):Promise.resolve()}))()}isLocaleSupported(e){try{return super.isLocaleSupported(e)&&(!self.Intl||Array.isArray(self.Intl.Collator.supportedLocalesOf(e)))}catch(e){return!1}}init(e){var t;this._initFbt();const r={l:p.DEFAULT_LOCALE,priority:v.DEFAULT,loc:p.DEFAULT_LOCALE};if(this._considerLocale(r,e,v.PREVIOUS),this._considerLocale(r,function(){let e=(m||self.location.href||"").split("/%F0%9F%8C%90/");return e.length>1?e[1].split("/")[0]:void 0}(),v.URL),this._considerLocale(r,navigator.language,v.BROWSER),null===(t=navigator.languages)||void 0===t?void 0:t.length)for(let e=0;e<navigator.languages.length&&!this._considerLocale(r,navigator.languages[e],v.BROWSER);e++);return this.downloadAndSetTranslation(r)}_initFbt(){const e=p.MARK_TRANSLATIONS?e=>this.getLocale()===p.DEFAULT_LOCALE?new s.FbtResult(["{",...e.contents,"}"]):new s.FbtResult(e.contents):void 0;(0,s.init)({translations:this.getFbtTranslations(),hooks:{getViewerContext:()=>({locale:this.getLocale()}),getFbtResult:e}})}_considerLocale(e,t,r){if(null!=e.priority&&r<e.priority)return;if(null==t||t===this.getLocale())return;const n=this.normalizeLocale(t);return n?(e.l=n,e.priority=r,e.loc=t,e):void 0}downloadAppLocale(e){return this.localeStrings[e]?Promise.resolve(this.localeStrings[e]):(0,o.promiseLoop)(function(){var t=(0,i.default)((function*(t,n,i){const o=(0,a.delayMs)(_.expBackoff(i,12e4,1e3,.1)),s=yield r(26299)(`./${e}`);try{const[e]=yield s.default();return t(e)}catch(t){return 10===i&&(__LOG__(4,void 0,new Error,!0)`${i} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),o}}));return function(){return t.apply(this,arguments)}}())}downloadFbtLocaleAndSetCache(e){var t=this;return this.fbtStrings[e]?Promise.resolve(this.fbtStrings[e]):(0,o.promiseLoop)(function(){var n=(0,i.default)((function*(n,i,o){const s=(0,a.delayMs)(_.expBackoff(o,12e4,1e3,.1)),l=yield r(26299)(`./${e}`);try{const[,r]=yield l.default();return t.fbtStrings[e]=r,n(r)}catch(t){return 10===o&&(__LOG__(4,void 0,new Error,!0)`${o} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),s}}));return function(){return n.apply(this,arguments)}}())}_downloadMomentResourceFile(e){return(0,i.default)((function*(){try{return(yield r(19922)(`./${e}`)).default}catch(t){__LOG__(2)`l10n:_downloadMomentResourceFile failed to download resource ${e}`}}))()}downloadMomentLocale(e){var t=this;const{l:r,loc:n}=e;return l.default.locale()===n?Promise.resolve():(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e,i,o){const s=(0,a.delayMs)(_.expBackoff(o,12e4,1e3,.1)),l=n.replace(/_/g,"-");let c,d;if(l===p.DEFAULT_MOMENT_LOCALE)c=()=>Promise.resolve(),d=p.DEFAULT_MOMENT_LOCALE;else{const e=[];if(e.push(l),r===p.DEFAULT_LOCALE)e.push(y);else{const t=r.replace(/_/g,"-");e.push(t),null!=f.default[t]&&e.push(f.default[t])}e.push(y);for(let r=0;r<e.length;++r)if(c=yield t._downloadMomentResourceFile(e[r]),null!=c){d=e[r];break}null==c&&(__LOG__(3)`Could not fetch moment locales, using default en-US`,c=()=>Promise.resolve(),d=p.DEFAULT_MOMENT_LOCALE)}try{return yield c(),e(d)}catch(e){return 10===o&&(__LOG__(4,void 0,new Error,!0)`${o} times, locale is (${r}, ${n})`,SEND_LOGS("downloadMomentLocale failure")),s}}));return function(){return e.apply(this,arguments)}}())}updateFbtContext(e,t){s.FbtTranslations.registerTranslations(t)}downloadAndSetTranslation(e){const{l:t,loc:n}=this._locale,{l:i,loc:a}=e,o=this.isRTL(i),s=o?E.RTL:E.LTR;if((0,d.isConnectedToPage)()&&document.getElementById(S[s])&&a===n)return Promise.resolve();const c=self.performance.now();let u,f;return this._fetchPromise=Promise.all([this.downloadAppLocale(i),this.downloadFbtLocaleAndSetCache(i),this.downloadMomentLocale(e)]).then((t=>{let[r,n,o]=t;u=self.performance.now(),this.localeStrings[i]=r,this._locale=e,this.trigger("set_collator",i),o&&(l.default.locale(o),__LOG__(2)`l10n:moment locale updated to: ${o}`),this.customizeMomentLocale(l.default.locale()),(0,d.isConnectedToPage)()&&(document.documentElement&&document.documentElement.setAttribute("lang",e.l),document.documentElement&&document.documentElement.setAttribute("dir",s)),this.updateFbtContext(i,n),this.trigger("locale_change",{l:i,loc:a})})).then((()=>{f=self.performance.now(),__LOG__(2)`l10n:locale updated: (${t}, ${n}) > (${i}, ${a}), Fetch: ${u-c}ms, Apply: ${f-u}ms`;if(r(92658).default.supported){var e;const t=r(25613).default,n=r(64237).default;(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)&&t.request(navigator.serviceWorker.controller,n.SET_L10N,{isRTL:o,locale:i}).catch((()=>{}))}})).catch((()=>(__LOG__(2)`l10n:locale update error: (${t}, ${n}) > (${i}, ${a})`,this.downloadAndSetTranslation({l:p.DEFAULT_LOCALE,priority:v.DEFAULT,loc:p.DEFAULT_LOCALE}))))}_updateSpellChecker(){}_updateElectronMain(){}customizeMomentLocale(e){const t=p.LOCALE_CUSTOMIZATIONS[e];t&&l.default.locale(e,t)}}T.Dir=E;var C=new T;t.default=C},53558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOULD_USE_MOMENT_LOCALE_FORMAT=t.MARK_TRANSLATIONS=t.LOCALE_DATE_TIME_CUSTOMIZATIONS=t.LOCALE_CUSTOMIZATIONS=t.LOCALES_THAT_PREFER_24HOUR_TIME=t.L10N_PRIORITY=t.DEFAULT_MOMENT_LOCALE=t.DEFAULT_LOCALE=void 0;var i=n(r(81109));t.L10N_PRIORITY={SAVED:6,PHONE:5,PREVIOUS:4,URL:3,BROWSER:2,DEFAULT:1};t.DEFAULT_LOCALE="en";t.DEFAULT_MOMENT_LOCALE="en-US";const a=new Set(["ur"]);t.SHOULD_USE_MOMENT_LOCALE_FORMAT=a;const o=new Set(["af","az","ca","cs","da","de","el","et","fi","fr","he","hr","hu","id","it","kk","lt","mk","nb","pl","pt","pt-BR","ro","ru","sk","sl","sr","sv","tr","uk"]);t.LOCALES_THAT_PREFER_24HOUR_TIME=o;const s={"zh-tw":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"}},"zh-cn":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY-MM-DD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"}},ar:{longDateFormat:{LT:"h:mm A",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"}},ta:{longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY, h:mm A"},preparse:null,postformat:null,meridiem:null,meridiemHour:null},nl:{longDateFormat:{l:"DD-MM-YYYY",L:"DD-MM-YYYY"}},"en-ie":{longDateFormat:{l:"DD/MM/YYYY",L:"DD/MM/YYYY"}},hi:{preparse:null,postformat:null,longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",LLL:"D MMMM YYYY A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},meridiem:(e,t)=>0===e&&0===t?"":e>=20||e<4?"":e>=4&&e<12?"":e>=12&&e<16?"":""}};t.LOCALE_DATE_TIME_CUSTOMIZATIONS=s;const l=(0,i.default)((0,i.default)({},s),{"pt-pt":{weekdays:["Domingo","Segunda-feira","Tera-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sbado"]}});t.LOCALE_CUSTOMIZATIONS=l;t.MARK_TRANSLATIONS=!1},45180:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={ach:{name:"Acholi",numbers:[1,2],plurals:e=>Number(e>1)},af:{name:"Afrikaans",numbers:[1,2],plurals:e=>Number(1!=e)},ak:{name:"Akan",numbers:[1,2],plurals:e=>Number(e>1)},am:{name:"Amharic",numbers:[1,2],plurals:e=>Number(e>1)},an:{name:"Aragonese",numbers:[1,2],plurals:e=>Number(1!=e)},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:e=>Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},arn:{name:"Mapudungun",numbers:[1,2],plurals:e=>Number(e>1)},ast:{name:"Asturian",numbers:[1,2],plurals:e=>Number(1!=e)},ay:{name:"Aymar",numbers:[1],plurals:()=>0},az:{name:"Azerbaijani",numbers:[1,2],plurals:e=>Number(1!=e)},be:{name:"Belarusian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},bg:{name:"Bulgarian",numbers:[1,2],plurals:e=>Number(1!=e)},bn:{name:"Bengali",numbers:[1,2],plurals:e=>Number(1!=e)},bo:{name:"Tibetan",numbers:[1],plurals:()=>0},br:{name:"Breton",numbers:[1,2],plurals:e=>Number(e>1)},bs:{name:"Bosnian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ca:{name:"Catalan",numbers:[1,2],plurals:e=>Number(1!=e)},cgg:{name:"Chiga",numbers:[1],plurals:()=>0},cs:{name:"Czech",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},csb:{name:"Kashubian",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},da:{name:"Danish",numbers:[1,2],plurals:e=>Number(1!=e)},de:{name:"German",numbers:[1,2],plurals:e=>Number(1!=e)},dz:{name:"Dzongkha",numbers:[1],plurals:()=>0},el:{name:"Greek",numbers:[1,2],plurals:e=>Number(1!=e)},en:{name:"English",numbers:[1,2],plurals:e=>Number(1!=e)},eo:{name:"Esperanto",numbers:[1,2],plurals:e=>Number(1!=e)},es:{name:"Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},et:{name:"Estonian",numbers:[1,2],plurals:e=>Number(1!=e)},eu:{name:"Basque",numbers:[1,2],plurals:e=>Number(1!=e)},fa:{name:"Persian",numbers:[1],plurals:()=>0},fi:{name:"Finnish",numbers:[1,2],plurals:e=>Number(1!=e)},fil:{name:"Filipino",numbers:[1,2],plurals:e=>Number(e>1)},fo:{name:"Faroese",numbers:[1,2],plurals:e=>Number(1!=e)},fr:{name:"French",numbers:[1,2],plurals:e=>Number(e>1)},fur:{name:"Friulian",numbers:[1,2],plurals:e=>Number(1!=e)},fy:{name:"Frisian",numbers:[1,2],plurals:e=>Number(1!=e)},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},gl:{name:"Galician",numbers:[1,2],plurals:e=>Number(1!=e)},gu:{name:"Gujarati",numbers:[1,2],plurals:e=>Number(1!=e)},gun:{name:"Gun",numbers:[1,2],plurals:e=>Number(e>1)},ha:{name:"Hausa",numbers:[1,2],plurals:e=>Number(1!=e)},he:{name:"Hebrew",numbers:[1,2],plurals:e=>Number(1!=e)},hi:{name:"Hindi",numbers:[1,2],plurals:e=>Number(1!=e)},hr:{name:"Croatian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},hu:{name:"Hungarian",numbers:[1,2],plurals:e=>Number(1!=e)},hy:{name:"Armenian",numbers:[1,2],plurals:e=>Number(1!=e)},ia:{name:"Interlingua",numbers:[1,2],plurals:e=>Number(1!=e)},id:{name:"Indonesian",numbers:[1],plurals:()=>0},is:{name:"Icelandic",numbers:[1,2],plurals:e=>Number(e%10!=1||e%100==11)},it:{name:"Italian",numbers:[1,2],plurals:e=>Number(1!=e)},ja:{name:"Japanese",numbers:[1],plurals:()=>0},jbo:{name:"Lojban",numbers:[1],plurals:()=>0},jv:{name:"Javanese",numbers:[0,1],plurals:e=>Number(0!==e)},ka:{name:"Georgian",numbers:[1],plurals:()=>0},kk:{name:"Kazakh",numbers:[1],plurals:()=>0},km:{name:"Khmer",numbers:[1],plurals:()=>0},kn:{name:"Kannada",numbers:[1,2],plurals:e=>Number(1!=e)},ko:{name:"Korean",numbers:[1],plurals:()=>0},ku:{name:"Kurdish",numbers:[1,2],plurals:e=>Number(1!=e)},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:e=>Number(1==e?0:2==e?1:3==e?2:3)},ky:{name:"Kyrgyz",numbers:[1],plurals:()=>0},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:e=>Number(1!=e)},ln:{name:"Lingala",numbers:[1,2],plurals:e=>Number(e>1)},lo:{name:"Lao",numbers:[1],plurals:()=>0},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},lv:{name:"Latvian",numbers:[0,1,2],plurals:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2)},mai:{name:"Maithili",numbers:[1,2],plurals:e=>Number(1!=e)},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:e=>Number(e>1)},mg:{name:"Malagasy",numbers:[1,2],plurals:e=>Number(e>1)},mi:{name:"Maori",numbers:[1,2],plurals:e=>Number(e>1)},mk:{name:"Macedonian",numbers:[1,2],plurals:e=>Number(1==e||e%10==1?0:1)},ml:{name:"Malayalam",numbers:[1,2],plurals:e=>Number(1!=e)},mn:{name:"Mongolian",numbers:[1,2],plurals:e=>Number(1!=e)},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:e=>Number(0===e?0:1==e?1:2)},mr:{name:"Marathi",numbers:[1,2],plurals:e=>Number(1!=e)},ms:{name:"Malay",numbers:[1],plurals:()=>0},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:e=>Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},nah:{name:"Nahuatl",numbers:[1,2],plurals:e=>Number(1!=e)},nap:{name:"Neapolitan",numbers:[1,2],plurals:e=>Number(1!=e)},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:e=>Number(1!=e)},ne:{name:"Nepali",numbers:[1,2],plurals:e=>Number(1!=e)},nl:{name:"Dutch",numbers:[1,2],plurals:e=>Number(1!=e)},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:e=>Number(1!=e)},no:{name:"Norwegian",numbers:[1,2],plurals:e=>Number(1!=e)},nso:{name:"Northern Sotho",numbers:[1,2],plurals:e=>Number(1!=e)},oc:{name:"Occitan",numbers:[1,2],plurals:e=>Number(e>1)},or:{name:"Oriya",numbers:[2,1],plurals:e=>Number(1!=e)},pa:{name:"Punjabi",numbers:[1,2],plurals:e=>Number(1!=e)},pap:{name:"Papiamento",numbers:[1,2],plurals:e=>Number(1!=e)},pl:{name:"Polish",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},pms:{name:"Piemontese",numbers:[1,2],plurals:e=>Number(1!=e)},ps:{name:"Pashto",numbers:[1,2],plurals:e=>Number(1!=e)},pt:{name:"Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},"pt-BR":{name:"Brazilian Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},rm:{name:"Romansh",numbers:[1,2],plurals:e=>Number(1!=e)},ro:{name:"Romanian",numbers:[1,2,20],plurals:e=>Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},ru:{name:"Russian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},sah:{name:"Yakut",numbers:[1],plurals:()=>0},sco:{name:"Scots",numbers:[1,2],plurals:e=>Number(1!=e)},se:{name:"Northern Sami",numbers:[1,2],plurals:e=>Number(1!=e)},si:{name:"Sinhala",numbers:[1,2],plurals:e=>Number(1!=e)},sk:{name:"Slovak",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},so:{name:"Somali",numbers:[1,2],plurals:e=>Number(1!=e)},son:{name:"Songhay",numbers:[1,2],plurals:e=>Number(1!=e)},sq:{name:"Albanian",numbers:[1,2],plurals:e=>Number(1!=e)},sr:{name:"Serbian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},su:{name:"Sundanese",numbers:[1],plurals:()=>0},sv:{name:"Swedish",numbers:[1,2],plurals:e=>Number(1!=e)},sw:{name:"Swahili",numbers:[1,2],plurals:e=>Number(1!=e)},ta:{name:"Tamil",numbers:[1,2],plurals:e=>Number(1!=e)},te:{name:"Telugu",numbers:[1,2],plurals:e=>Number(1!=e)},tg:{name:"Tajik",numbers:[1,2],plurals:e=>Number(e>1)},th:{name:"Thai",numbers:[1],plurals:()=>0},ti:{name:"Tigrinya",numbers:[1,2],plurals:e=>Number(e>1)},tk:{name:"Turkmen",numbers:[1,2],plurals:e=>Number(1!=e)},tr:{name:"Turkish",numbers:[1,2],plurals:e=>Number(e>1)},tt:{name:"Tatar",numbers:[1],plurals:()=>0},ug:{name:"Uyghur",numbers:[1],plurals:()=>0},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ur:{name:"Urdu",numbers:[1,2],plurals:e=>Number(1!=e)},uz:{name:"Uzbek",numbers:[1,2],plurals:e=>Number(e>1)},vi:{name:"Vietnamese",numbers:[1],plurals:()=>0},wa:{name:"Walloon",numbers:[1,2],plurals:e=>Number(e>1)},wo:{name:"Wolof",numbers:[1],plurals:()=>0},yo:{name:"Yoruba",numbers:[1,2],plurals:e=>Number(1!=e)},zh:{name:"Chinese",numbers:[1],plurals:()=>0}};t.default=r},86688:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findLink=M,t.findLinks=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!b.test(e))return[];A.lastIndex=0;const n=[];let i;for(;i=P(e);){const e=O(i,t,r);e&&n.push(e)}return n},t.validateEmail=function(e){const t=M(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null};var i=r(53659),a=r(72441),o=n(r(3689)),s=r(17239),l=r(99234),c=r(16238);const d=Array.from(c.TLD).join("|"),u=/^https?:\/\/$/gi,p="\\w|[^\\s\0-]|%[0-9a-f][0-9a-f]",f=`${d}|xn--(?:${p})+`,_=`(?:${p})|(?:${p})(?:${p}|-)*(?:${p})`,h=`(?:${p}|[^\\s%])`,g=`[@!.?,(\\[{<:]*(?!${h}|#)`,m="0-9a-z!#$%&'*+/=?^_`{|}~\\-",y=`(^|\\W\\.|[^/\\w.]|_)((?:http|https)://|mailto:)?(${`\\b\\w[${m}]*(?:\\.[${m}]+)*`}@)?(${`(?!_)(?:(?:${_})\\.)+(${f})(?!\\.${_})`})(?:(?!${_})|(?=_))(?:(?=[^:/?#])|(:\\d{1,5})?(${`/${h}*?`})?(${`\\?(?!${g})${h}*?`})?(${`#${h}*?`})?(?=${g}))`,E=7,S=8,v=9,T=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),C=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),A=new RegExp(`${y}`,"ig"),b=new RegExp(`\\.(?:${f})`,"i");function P(e){try{return A.exec(e)}catch(t){return __LOG__(4,void 0,new Error,!0)`text size: ${e.length}, error: ${String(t)}`,SEND_LOGS("linkify-regex-error"),null}}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return A.lastIndex=0,O(P(e),t,r)}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!e)return null;const n=e[1].length;let d=e[0];const p=e.index+n,{index:f}=e,_="_"===e[1];if(_&&f-1&&/\S/.test(e.input[f-1]))return null;const h=e[5];if(h&&h.startsWith("xn--")&&!c.TLD.has(o.default.toUnicode(h)))return null;if(e[6]){const t=parseInt(e[6].slice(1),10);if("0"===e[6][1]||!(0<t&&t<65536))return null}const g=[v,S,E].find((t=>null==e?void 0:e[t]))||0;if(g){const t=[];let r=e[g];"_"===r.slice(-1)&&"_"===d[p-1]&&(d=d.slice(0,-1),e[g]=r=r.slice(0,-1));let i=0,a=0;for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);n===a?(a=t.pop()||0,0===a&&(i=e)):C.has(n)?(0!==a&&t.push(a),a=C.get(n)):T.has(n)||0===a&&(i=e)}if(i!==r.length-1){const t=e.slice(2,g);t.splice(3,1),d=t.filter((e=>e)).join("")+r.slice(0,i+1),A.lastIndex=p+d.length}else d=d.slice(n)}else d=d.slice(n);let m=d,y=e[2];const b=Boolean(y&&y.match(u));if(t&&!b)return null;y?y=y.toLowerCase():(y=0===m.toLowerCase().indexOf("irc.")?"irc://":0===m.toLowerCase().indexOf("ftp.")?"ftp://":e[3]?"mailto:":"http://",m=y+m);const P=e[4],M=(0,l.getMaybeMeUser)();return{href:m,url:d,index:p,input:e.input,scheme:y,username:e[3],domain:P,port:e[6],path:e[E],params:e[S],anchor:e[v],isHttp:b,suspiciousCharacters:r&&M?(0,i.findSuspiciousCharacters)(P,(0,a.toPhoneUserJid)(r.user),(0,a.toPhoneUserJid)(M.user),s.Conn.allLanguages):void 0}}},92417:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=window.localStorage}catch(e){}var n=r;t.default=n},70818:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.cycleThroughLogLines=v,t.log=void 0;var i=n(r(48926)),a=n(r(35161)),o=r(57319),s=n(r(30381)),l=r(86469),c=n(r(76589)),d=r(82449),u=n(r(98387)),p=r(97237),f=n(r(99304)),_=r(72407);const h=Date.now(),g="LTSXOo+_*-=.<^!#?".split("");function m(){return g[Math.round(Math.random()*(g.length-1))]}const y=m()+m()+m()+m(),E={};E[E.ALL=0]="all",E[E.INFO=1]="info",E[E.LOG=2]="log",E[E.WARN=3]="warn",E[E.ERROR=4]="error",E[E.OFF=5]="off";function S(e){switch(e){case E.INFO:case E.LOG:case E.WARN:case E.ERROR:return E[e];default:throw new Error(`Unexpected numeric log level: ${e}`)}}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n){yield C(e,t+1,r,n),yield C(0,e,r,n)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n){for(let i=e;i<t;i+=r){const e=Math.min(i+r,t);yield n(i,e)}}))).apply(this,arguments)}const b=new class{constructor(){var e=this;this.logs=[],this.localCursor=0,this.pending=void 0,this.timer=new o.ShiftTimer((()=>this._persistIdb())),this.isTakeOver=!1,this.log=(0,u.default)((function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return function(o){for(var s=arguments.length,l=new Array(s>1?s-1:0),d=1;d<s;d++)l[d-1]=arguments[d];const u=(0,c.default)(o,l,!r);return e.logImpl(t,u,n,i,a),u}}),((e,t,r,n,i)=>r||i?null:String(e)+String(Boolean(t))+String(Boolean(n))))}logImpl(e,t,r,n,i){const a=(0,s.default)().locale("en").format("YYYY-MM-DD HH:mm:ss.SSS:"),o=r?`\n${(0,p.normalizeStack)(r,!0)}`:"",c=[S(e),n?"sendlogs":null,...null!=i?i:[]].filter(Boolean).map((e=>`[${e}]`)).join(""),d=`${y} ${a}`+(c?`${c} `:"")+t+o;this.logs.push(d),this.isTakeOver||(this.logs.length>l.LOG_SIZE&&(this.logs.shift(),this.localCursor--),this.timer.debounceAndCap(250,1e3))}logUncaughtError(e,t){const r=e instanceof Error&&e.stack?e:void 0;let n;if(n=r?String(e):t?`Promise rejected: ${String(e)}`:`Error: ${String(e)}`,this.logImpl(E.ERROR,n,r,!0,["uncaught"]),null!=t){const e=String(t);this.logImpl(E.WARN,e)}}onTakeOver(){this.isTakeOver=!0}getLogs(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=r(19197).default,s=[];return this.pending&&s.push(this.pending),this.timer.isScheduled()&&(this.timer.forceRunNow(),this.pending&&s.push(this.pending)),Promise.all(s).then((()=>o.idb())).then(function(){var r=(0,i.default)((function*(r){return(0,d.getTimeboxedAndTrimmedLogs)(r,t?0:e._createTimeStamp()-6048e5,n)}));return function(){return r.apply(this,arguments)}}()).then((e=>(0,a.default)(e,"log"))).catch((()=>this.logs))}_clearLogsInBatches(){var e=this;return(0,i.default)((function*(){const t=r(19197).default,{asyncSleep:n}=r(52613),a=yield t.idb(),o=yield a.logs.toCollection().last();if(null==o)return;const s=o.line,l=e._getCursor(),c=function(){var e=(0,i.default)((function*(e,t){try{yield a.transaction("rw",a.logs,(0,i.default)((function*(){const r=yield a.logs.where("line").between(e,t).primaryKeys();yield a.logs.bulkDelete(r)})))}catch(e){__LOG__(2)`_clearLogsInBatches: error while deleting, ${e.stack}`}yield n(0)}));return function(){return e.apply(this,arguments)}}();yield v(l,s,1e3,c)}))()}_clearLogsInDB(){return(0,i.default)((function*(){const e=r(19197).default;yield e.idb().then((e=>e.logs.clear())).catch((()=>{}))}))()}clearLogs(){var e=this;return(0,i.default)((function*(){yield e._clearLogsInDB(),e._setCursor(0),e.localCursor=0,e.logs=[]}))()}clearLogsPreemptive(){var e=this;return(0,i.default)((function*(){{const{getShouldPreemptivelyCleanupLogs:t,setShouldPreemptivelyCleanupLogs:n}=r(99234);t()&&(yield e._clearLogsInDB(),n(!1))}}))()}_optimisticallyAdvanceCursor(e,t){this.localCursor+=t,this._setCursor((e+t)%l.LOG_SIZE)}_persistIdb(){const e=r(19197).default,t=this.logs.slice(Math.max(this.localCursor,0),this.logs.length);t.length&&(this.pending=e.idb().then((e=>e.transaction("rw",e.logs,e.user,(()=>{let r=this._getCursor();this._optimisticallyAdvanceCursor(r,t.length),t.forEach((t=>{r=(r+1)%l.LOG_SIZE,e.logs.put({line:r,log:t,timestamp:this._createTimeStamp()})}))})))).catch((()=>{})).finally((()=>{this.pending=void 0})))}_createTimeStamp(){return performance&&performance.now()+h||Date.now()}_getCursor(){try{return JSON.parse(f.default.getItem(_.KEYS.LOG_CURSOR))||Math.max(this.localCursor,0)}catch(e){return Math.max(this.localCursor,0)}}_setCursor(e){return f.default.setItem(_.KEYS.LOG_CURSOR,String(e))}};t.Logger=b;const P=b.log;t.log=P},82449:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TRIM_LENGTH=t.END_OF_UPLOAD=void 0,t.getTimeboxedAndTrimmedLogs=function(){return o.apply(this,arguments)};var i=n(r(48926));const a="==================================================EOU";t.END_OF_UPLOAD=a;function o(){return(o=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[];if(r){const r=yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).reverse().until((e=>e.log.includes("[sendlogs]")),!0).toArray();for(let e=r.length-1;e>=0&&(s(r[e],n),!r[e].log.includes(a));e--);}else yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).each((e=>{s(e,n)}));return n}))).apply(this,arguments)}function s(e,t){e.log=e.log.slice(0,2500),t.push(e)}t.TRIM_LENGTH=2500},64084:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(88306)),a=r(15688);function o(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,n,i,a){return o((s=o(o(t,e),o(n,a)))<<(l=i)|s>>>32-l,r);var s,l}function l(e,t,r,n,i,a,o){return s(t&r|~t&n,e,t,i,a,o)}function c(e,t,r,n,i,a,o){return s(t&n|r&~n,e,t,i,a,o)}function d(e,t,r,n,i,a,o){return s(t^r^n,e,t,i,a,o)}function u(e,t,r,n,i,a,o){return s(r^(t|~n),e,t,i,a,o)}function p(e){return function(e,t){let r,n,i,a;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let s=1732584193,p=-271733879,f=-1732584194,_=271733878;for(let t=0;t<e.length;t+=16)r=s,n=p,i=f,a=_,s=l(s,p,f,_,e[t],7,-680876936),_=l(_,s,p,f,e[t+1],12,-389564586),f=l(f,_,s,p,e[t+2],17,606105819),p=l(p,f,_,s,e[t+3],22,-1044525330),s=l(s,p,f,_,e[t+4],7,-176418897),_=l(_,s,p,f,e[t+5],12,1200080426),f=l(f,_,s,p,e[t+6],17,-1473231341),p=l(p,f,_,s,e[t+7],22,-45705983),s=l(s,p,f,_,e[t+8],7,1770035416),_=l(_,s,p,f,e[t+9],12,-1958414417),f=l(f,_,s,p,e[t+10],17,-42063),p=l(p,f,_,s,e[t+11],22,-1990404162),s=l(s,p,f,_,e[t+12],7,1804603682),_=l(_,s,p,f,e[t+13],12,-40341101),f=l(f,_,s,p,e[t+14],17,-1502002290),p=l(p,f,_,s,e[t+15],22,1236535329),s=c(s,p,f,_,e[t+1],5,-165796510),_=c(_,s,p,f,e[t+6],9,-1069501632),f=c(f,_,s,p,e[t+11],14,643717713),p=c(p,f,_,s,e[t],20,-373897302),s=c(s,p,f,_,e[t+5],5,-701558691),_=c(_,s,p,f,e[t+10],9,38016083),f=c(f,_,s,p,e[t+15],14,-660478335),p=c(p,f,_,s,e[t+4],20,-405537848),s=c(s,p,f,_,e[t+9],5,568446438),_=c(_,s,p,f,e[t+14],9,-1019803690),f=c(f,_,s,p,e[t+3],14,-187363961),p=c(p,f,_,s,e[t+8],20,1163531501),s=c(s,p,f,_,e[t+13],5,-1444681467),_=c(_,s,p,f,e[t+2],9,-51403784),f=c(f,_,s,p,e[t+7],14,1735328473),p=c(p,f,_,s,e[t+12],20,-1926607734),s=d(s,p,f,_,e[t+5],4,-378558),_=d(_,s,p,f,e[t+8],11,-2022574463),f=d(f,_,s,p,e[t+11],16,1839030562),p=d(p,f,_,s,e[t+14],23,-35309556),s=d(s,p,f,_,e[t+1],4,-1530992060),_=d(_,s,p,f,e[t+4],11,1272893353),f=d(f,_,s,p,e[t+7],16,-155497632),p=d(p,f,_,s,e[t+10],23,-1094730640),s=d(s,p,f,_,e[t+13],4,681279174),_=d(_,s,p,f,e[t],11,-358537222),f=d(f,_,s,p,e[t+3],16,-722521979),p=d(p,f,_,s,e[t+6],23,76029189),s=d(s,p,f,_,e[t+9],4,-640364487),_=d(_,s,p,f,e[t+12],11,-421815835),f=d(f,_,s,p,e[t+15],16,530742520),p=d(p,f,_,s,e[t+2],23,-995338651),s=u(s,p,f,_,e[t],6,-198630844),_=u(_,s,p,f,e[t+7],10,1126891415),f=u(f,_,s,p,e[t+14],15,-1416354905),p=u(p,f,_,s,e[t+5],21,-57434055),s=u(s,p,f,_,e[t+12],6,1700485571),_=u(_,s,p,f,e[t+3],10,-1894986606),f=u(f,_,s,p,e[t+10],15,-1051523),p=u(p,f,_,s,e[t+1],21,-2054922799),s=u(s,p,f,_,e[t+8],6,1873313359),_=u(_,s,p,f,e[t+15],10,-30611744),f=u(f,_,s,p,e[t+6],15,-1560198380),p=u(p,f,_,s,e[t+13],21,1309151649),s=u(s,p,f,_,e[t+4],6,-145523070),_=u(_,s,p,f,e[t+11],10,-1120210379),f=u(f,_,s,p,e[t+2],15,718787259),p=u(p,f,_,s,e[t+9],21,-343485551),s=o(s,r),p=o(p,n),f=o(f,i),_=o(_,a);return new Uint8Array([255&s,s>>>8&255,s>>>16&255,s>>>24&255,255&p,p>>>8&255,p>>>16&255,p>>>24&255,255&f,f>>>8&255,f>>>16&255,f>>>24&255,255&_,_>>>8&255,_>>>16&255,_>>>24&255])}(function(e){let t;const r=[];for(r[(e.length>>2)-1]=0,t=0;t<r.length;t+=1)r[t]=0;const n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}(e),8*e.length)}var f=(0,i.default)((e=>(0,a.encodeB64)(p(e))));t.default=f},35416:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genCurrentSessionId=function(){return p.apply(this,arguments)},t.genSessionId=f;var i=n(r(48926)),a=r(8584),o=r(73045),s=n(r(45095)),l=r(5087),c=r(99234),d=n(r(76128)),u=r(93832);function p(){return(p=(0,i.default)((function*(){const e=(0,u.createSignalAddress)((0,c.getMeUser)()).toString(),t=(0,s.default)(yield d.default.loadIdentityKey(e),"yield PersistSignalProtocolStore.loadIdentityKey(primaryDeviceIdentifier)"),r=(0,l.toCurveKeyPubKey)((0,u.strToBuffer)(t)),n=(0,s.default)(yield d.default.getIdentityKeyPair(),"yield SignalProtocolStore.getIdentityKeyPair()");return f(r,(0,l.toCurveKeyPubKey)(n.pubKey))}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){if(32!==e.byteLength)throw new Error(`genSessionId: primary identity public key is ${e.byteLength} bytes, should be 32!`);if(32!==t.byteLength)throw new Error(`genSessionId: companion identity public key is ${e.byteLength} bytes, should be 32!`);const r=new a.Binary;r.writeBuffer(e),r.write("_".charCodeAt(0)),r.writeBuffer(t);const n=r.readByteArray();return yield(0,o.sha256Base64)(n)}))).apply(this,arguments)}},49801:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_QUOTA_UNAVAILABLE=t.MdSyncFieldStatsMeta=void 0;var i=n(r(48926)),a=n(r(96222)),o=r(35416);t.STORAGE_QUOTA_UNAVAILABLE=-1;const s=new class{constructor(){this._storageEstimation={mdStorageQuotaBytes:-2,mdStorageQuotaUsedBytes:-2},this._mdSessionId=null}getStorageEstimation(){var e=this;return(0,i.default)((function*(){if(-2!==e._storageEstimation.mdStorageQuotaBytes)return Promise.resolve(e._storageEstimation);const t=yield(0,a.default)();return e._storageEstimation={mdStorageQuotaBytes:t?t.quota:-1,mdStorageQuotaUsedBytes:t?t.usage:-1},e._storageEstimation}))()}getMdSessionId(){var e=this;return(0,i.default)((function*(){return null!=e._mdSessionId||(e._mdSessionId=yield(0,o.genCurrentSessionId)()),e._mdSessionId}))()}};t.MdSyncFieldStatsMeta=s},97390:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265),i=r(64103);class a extends((0,n.customError)("MediaFileTooLarge",!0,i.MediaFileError)){constructor(e){super(`File (${e.type()}) size = ${e.size()}`),this.opaqueData=e}}t.default=a},97692:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=void 0,t.disposeVideo=v,t.getMediaTagErrorReason=y,t.image=function(e){return E(e).then((e=>{if(e&&e.naturalWidth>0)return{img:e,fullWidth:e.naturalWidth,fullHeight:e.naturalHeight};throw new l.MediaLoadError("image loaded with zero width")})).catch((()=>{throw new l.MediaLoadError("unable to render image")}))},t.loadImage=E,t.loadVideo=S,t.transcode=function(e,t){const r=t||e.type;if((0,c.default)(r)&&!h){if(e.size<=3e5){return new p.default(e).generateBlob()}return Promise.reject(new l.TranscodeBlobTooLargeError)}return Promise.resolve(e)},t.videoWidthHeightDuration=function(e){return S(e).then((e=>{let{video:t,fullWidth:r,fullHeight:n,duration:i}=e;return v(t),{width:r,height:n,duration:i}}))};var i=r(40265),a=r(50796),o=r(13959),s=r(38284),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=n(r(7056)),d=n(r(26402)),u=n(r(11339)),p=n(r(69283)),f=r(65127);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}const h=(new Audio).canPlayType("audio/ogg");t.canPlayOgg=h;let g=0,m=Promise.resolve();function y(e){if(!e||!e.error)return null;const t=e.error;let r=Object.keys(d.default).find((e=>d.default[e]===t.code));r=r||`UNKNOWN CODE ${t.code}`;const n=t.message&&~t.message.indexOf(":")?t.message.split(":")[0]:"";return n?`${r}: ${n}`:r}function E(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(n,i){t=new Image;const a=/^(?:data|blob):/.test(e);r&&!a&&t.setAttribute("crossOrigin","anonymous"),t.onload=n,t.onabort=()=>{i(new Error("loadImage onabort"))},t.onerror=()=>{i(new l.InvalidImageFileType("Image tag load error"))},t.src=e})).then((()=>t))}function S(e){const t=m.then((()=>function(e){const t=new u.default.WebcMediaLoad;let r,n,c=null;const d=++g;function p(){r&&c&&(document.body&&document.body.removeChild(c),c=null)}let _=!0;const h=new Promise((function(t,i){__LOG__(2)`MediaLoad:video called (#${d})`;let a=!1,o=!1;r=document.createElement("video"),r.setAttribute("crossOrigin","anonymous"),r.volume=0,r.muted=!0,r.playsinline=!0;const s=()=>{o&&a&&t()};if(r.onloadedmetadata=()=>{__LOG__(2)`MediaLoad:video.onloadedmetadata #${d}. Video ready: ${o}. Video width: ${r.videoWidth}`,r.onloadedmetadata=null,a=!0,s()},r.oncanplaythrough=()=>{__LOG__(2)`MediaLoad:video.oncanplaythrough #${d}. Metadata loaded: ${a}. Video width: ${r.videoWidth}`,r.oncanplaythrough=null,r.onseeked=()=>{o=!0,r.onseeked=null,s()},r.currentTime=0},r.onerror=()=>{const t=r.error?r.error.message:"no error message";__LOG__(3)`MediaLoad:video.onerror #${d}: ${String(t)}\n Blob info -> size:${e.size}, type: ${e.type}`;const n=y(r);i(new l.UnableToPlayVideoError(n))},r.src=n=window.URL.createObjectURL(e),f.UA.isSafari){c=document.createElement("div");const e=c;e.style="opacity: 0.004",e.appendChild(r),document.body&&document.body.appendChild(e)}r.load(),r.currentTime=1})).finally((()=>{_=!1}));setTimeout((()=>{p(),_&&(__LOG__(3)`unable to load video #${d} (${e.size} bytes)`,new u.default.WebcMediaLoad({webcMediaLoadResult:u.default.WEBC_MEDIA_LOAD_RESULT_CODE.SILENCE}).commit())}),8e3);const m=(0,s.promiseTimeout)(h,2e4).then((()=>(0,o.delayMs)(10))).then((()=>{if(t.markWebcMediaLoadT(),__LOG__(2)`MediaLoad:video #${d} successful`,r.pause(),r.videoWidth>0)return t.webcMediaLoadResult=u.default.WEBC_MEDIA_LOAD_RESULT_CODE.SUCCESS,t.commit(),{video:r,fullWidth:r.videoWidth,fullHeight:r.videoHeight,duration:r.duration};throw r.duration>0?(__LOG__(3)`MediaLoad:video #${d} dimensions are not defined. Video readyState: ${r.readyState}. Video width: ${r.videoWidth}`,new l.MediaUnsupportedError("video loaded with duration but no dims")):(t.webcMediaLoadResult=u.default.WEBC_MEDIA_LOAD_RESULT_CODE.ZEROWIDTH,t.commit(),new l.MediaLoadError("video loaded with zero width"))})).catch((0,a.filteredCatch)(i.TimeoutError,(e=>{throw __LOG__(4,void 0,new Error,!0)`MediaLoad:video load error, currentTime=${r.currentTime}. duration=${r.duration}`,SEND_LOGS("video-load-timeout"),e}))).finally((()=>{p(),r&&(r.onloadedmetadata=null,r.onloadeddata=null,r.oncanplaythrough=null,r.ontimeupdate=null,r.onerror=null),n&&window.URL.revokeObjectURL(n)}));return m.catch((()=>{v(r)})),m}(e)));return m=(0,s.promiseTimeout)(t,1e3).then((()=>{}),(()=>{})),t}function v(e){try{e.pause(),e.src="",e.load()}catch(e){__LOG__(4,void 0,new Error,!0)`Error: ${String(e)}`,SEND_LOGS("dispose-video-error")}}},70634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setupLodashMemoizeCache=function(){i.default.Cache=a.MemoizeCache};var i=n(r(88306)),a=r(14950)},98387:(e,t)=>{"use strict";function r(e,t){const n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];const o=t?t.apply(this,i):i[0];if(!o)return e.apply(this,i);const s=n.cache;if(s.has(o))return s.get(o);const l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(r.Cache||Map),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r.Cache=Map;var n=r;t.default=n},30071:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default,r=null;const n=function(n){return null!=r&&t(r.params,n)?r.params=n:r={params:n,result:e.call(this,n)},r.result};return n.clear=()=>{r=null},n};var i=n(r(96774))},59779:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MUTE_ALWAYS_EXPIRATION_SENTINEL=void 0,t.calculateMuteExpiration=function(e){if(e===Number.POSITIVE_INFINITY)return-1;return 60*e*60+(0,a.default)().unix()},t.getAllMuteDurations=s,t.getDefaultMuteDuration=function(){return s()[0].duration};var i=r(48360),a=n(r(30381)),o=r(64551);function s(e){return e?[{label:i.fbt._("1 Hour",null,{hk:"2z3e4J"}),duration:1},{label:i.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:i.fbt._("1 Day",null,{hk:"11RKz3"}),duration:24},{label:i.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168}]:[{label:i.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:i.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168},o.ServerProps.muteAlways?{label:i.fbt._("Always",null,{hk:"26Zr18"}),duration:Number.POSITIVE_INFINITY}:{label:i.fbt._("1 Year",null,{hk:"45Hta7"}),duration:8760}]}t.MUTE_ALWAYS_EXPIRATION_SENTINEL=-1},57220:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(11290),o=n(r(87045)),s=n(r(75203)),l=r(7293),c=n(r(58596));class d extends a.BaseModel{constructor(){super(...arguments),this.online=(0,a.session)(!0),this.waitIfOffline=(0,c.default)((()=>"all"),(0,i.default)((function*(){this.online||(l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&"Firefox"!==o.default.info().name&&navigator.onLine?__LOG__(2)`waitIfOffline: XHR online is false, but navigator.onLine is true, resolving promise`:(__LOG__(2)`waitIfOffline: Waiting...`,yield new Promise((e=>{this.listenToOnce(this,"change:online",(()=>{__LOG__(2)`waitIfOffline: Continuing...`,e()}))}))))}))),this.checkOnline=(0,c.default)((()=>"all"),(0,i.default)((function*(){__LOG__(2)`NetworkStatus:checkOnline checking`;try{const e=yield(0,s.default)("https://web.whatsapp.com/status.json");this.online=!!e,__LOG__(2)`NetworkStatus:checkOnline response ${String(this.online)}`}catch(e){__LOG__(3)`NetworkStatus:checkOnline errored! ${String(e)}`}})))}initialize(){this.listenTo(this,"change:online",this._logOnlineOffline),this._logOnlineOffline()}_logOnlineOffline(){const e=this.online;__LOG__(2)`NetworkStatus ${e?"online":"offline"}`}}var u=new((0,a.defineModel)(d));t.default=u},47524:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectiveNetworkType=function(){if(navigator.connection&&"string"==typeof navigator.connection.effectiveType)return navigator.connection.effectiveType;return null}},97237:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeError=s,t.normalizeStack=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{name:r,message:n,stack:i}=s(e),a=i.indexOf("\n"),l=i.slice(0,a),c=l.match(new RegExp(`(${(0,o.default)(r)}|Error)(:|$)`));if(null!=c){if(!t)return i;const e=c.index+c[0].length,r=null==n?-1:i.indexOf(n,e),o=null==n||-1===r?-1:r+n.length,s=Math.max(0,a,e,o);return i.slice(s).replace(/^\n+/,"")}if(t)return i;const d=""===i?"":`\n${i}`;return n?`${r}: ${n}${d}`:`${r}${d}`};var i=n(r(81109)),a=n(r(48403)),o=n(r(3522));function s(e){const t="object"==typeof e&&"string"==typeof(null==e?void 0:e.name)?e.name:`Thrown${(0,a.default)(typeof e)}Error`;let r,n;if(r=null!=e&&"string"==typeof e.message?e.message:void 0===e?"":String(e),null!=e&&"string"==typeof e.stack)n=e.stack;else{const e=new Error;e.name=t,e.message=r,n="string"==typeof e.stack?e.stack:""}const o="object"==typeof e?(0,i.default)({},e):null;return(0,i.default)((0,i.default)({},o),{},{name:t,message:r,stack:n})}},30010:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldNotifyReaction=function(e){const{orphan:t,read:r,senderUserJid:n,parentMsgKey:s,reactionText:l}=e;if(!(0,o.receiveReactionsEnabled)())return!1;if(1===t)return!1;if(r)return!1;if((0,a.isReactionByMe)(n))return!1;return!!i.default.fromString(s).fromMe&&""!==l};var i=n(r(65212)),a=r(67811),o=r(57701)},28826:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PERMISSION_DENIED=t.PERMISSION_DEFAULT=t.PERMISSION_ALLOWED=void 0;t.PERMISSION_ALLOWED="granted";t.PERMISSION_DEFAULT="default";t.PERMISSION_DENIED="denied"},90914:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setIcon=u,t.setTitleAndIcon=function(e){let t=s.default.t(1034);e>0&&(t="("+s.default.n(e)+") "+s.default.t(1034));clearTimeout(c),document.title=document.title+" ",c=setTimeout((()=>{document.title=t}),0),u(e)};var i=r(89385),a=r(89721),o=n(r(89748)),s=n(r(43725)),l=r(65127);let c;const d=new o.default;function u(e){if(l.UA.isSafari)return;let t,n;-1===e?(t="favicon-error2",n={low:r(72174),high:r(5079)}):0===e?(t="favicon",n={low:r(68431),high:r(49420)}):e<10?(t="f0"+e,n={low:r(63509)(`./${t}.png`),high:r(76554)(`./${t}.png`)}):e<100?(t="f"+e,n={low:r(63509)(`./${t}.png`),high:r(76554)(`./${t}.png`)}):(t="f00",n={low:r(31213),high:r(95203)});const o={id:t,low:{default:n.low},high:{default:n.high}};d.enqueue(a.AssetLoader.loadAsset(o,a.LOAD_PRIORITY.NOTIFICATION_ICON,!1)).then((e=>e)).then((e=>{const r=document.getElementById("favicon");var n;(null==(n=r)?void 0:n.parentNode)&&n.parentNode.removeChild(n);const i=document.createElement("link");i.setAttribute("id","favicon"),i.setAttribute("rel","shortcut icon"),i.setAttribute("type","image/png"),i.setAttribute("href",e),i.setAttribute("src",e);const a=document.getElementsByTagName("head");(null==a?void 0:a[0])&&a[0].appendChild(i),__LOG__(2)`Favicon updated: ${t}`})).catch((0,i.catchAbort)((()=>{})))}},17506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDoNotDisturb=function(){try{var e,t;if("darwin"===process.platform)return(null===(e=window.Native.MacOSNotificationState)||void 0===e?void 0:e.getDoNotDisturb())||(null===(t=window.Native.MacOSNotificationState)||void 0===t?void 0:t.getNotificationState())===n.SESSION_SCREEN_IS_LOCKED;if("win32"===process.platform){var r,a,o,s,l;if((null===(r=window.Native.WindowsNotificationState)||void 0===r?void 0:r.getNotificationState())!==n.QUNS_ACCEPTS_NOTIFICATIONS)return!0;const e="win32"!==process.platform||process.windowsStore?null:"com.squirrel.WhatsApp.WhatsApp",t=e&&"YES"===(null===(a=window.Native.WindowsFocusAssist)||void 0===a||null===(o=a.isPriority(e))||void 0===o?void 0:o.name),c=null===(s=window.Native.WindowsFocusAssist)||void 0===s?void 0:s.getFocusAssist().name;return!!(t&&c===i.ALARMS_ONLY||!t&&[i.PRIORITY_ONLY,i.ALARMS_ONLY].includes(c))||!!(null===(l=window.Native.WindowsQuiteHours)||void 0===l?void 0:l.getIsQuietHours())}}catch(e){__LOG__(3)`getDoNotDisturb failed with error ${e}`}return!1};const n=r(76672).Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]),i=r(76672).Mirrored(["NOT_SUPPORTED","FAILED","OFF","PRIORITY_ONLY","ALARMS_ONLY"])},69283:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(8584),a=r(1063),o=n(r(42372));let s,l=0;t.default=class{constructor(e){this.oggBlob=e}generateBlob(){return this.oggBlobToWAVBlob(this.oggBlob,1)}oggBlobToWAVBlob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Promise((r=>{const n=new o.default,i=[],c=[],d=(l++,s||new window.AudioContext),u={outputBufferSampleRate:d.sampleRate,bufferLength:4096};n.onmessage=e=>{if(null==e.data){for(let e=0;e<t;e++)i.forEach((t=>{const r=t[e]||t[0];for(let e=0;e<r.length;e++)c.push(r[e])}));const e=this.encodeWAV(c,d,t),n=new Blob([e.readByteArray()],{type:"audio/wav"});l--,0===l&&s&&(s.close&&s.close(),s=void 0),r(n)}else i.push(e.data),t=i[0].length},n.postMessage({command:"decode-init",config:u}),(0,a.blobToArrayBuffer)(e).then((e=>{n.postMessage({command:"decode",pages:new Uint8Array(e)}),n.postMessage({command:"decode-done"})})).catch((e=>{__LOG__(3)`Player::oggBlobToWAVBlob error: ${e}`}))}))}encodeWAV(e,t,r){const n=new i.Binary(void 0,!0);n.ensureCapacity(44+2*e.length),n.writeString("RIFF"),n.writeUint32(36+2*e.length),n.writeString("WAVE"),n.writeString("fmt "),n.writeUint32(16),n.writeUint16(1),n.writeUint16(r),n.writeUint32(t.sampleRate),n.writeUint32(t.sampleRate*r*2),n.writeUint16(2*r),n.writeUint16(16),n.writeString("data"),n.writeUint32(2*e.length);for(let t=0;t<e.length;t++){let r=Math.max(-1,Math.min(e[t],1));r*=r>0?32767:32768,n.writeInt16(Math.floor(r))}return n}}},38906:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(13959),o=r(4352),s=r(67602),l=n(r(64369)),c=n(r(44053)),d=r(35718),u=g(r(36638)),p=n(r(34949)),f=r(64551),_=g(r(22906));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}t.default=class{static fileToPdf(e){const t=URL.createObjectURL(e);return(0,o.promiseLoop)((function(e,t,n){const i=(0,a.delayMs)(_.expBackoff(n,12e4,0,0));return r.e(2974).then(r.t.bind(r,99299,23)).then((t=>{t.GlobalWorkerOptions.workerSrc=c.default,e(t.default)})).catch((()=>i))})).then((e=>e.getDocument(t).promise))}static releasePdf(e){return e.destroy()}static pdfToImg(e,t){const r=document.createElement("canvas");return e.getPage(t).then((e=>{const t=e.getViewport({scale:1}),n=r.getContext("2d");return r.height=t.height,r.width=t.width,e.render({canvasContext:n,viewport:t}).promise})).then((()=>(0,s.promiseProps)({blob:(0,d.canvasToBlob)(r),thumbnail:u.rotateAndResize(r,l.default.DOC_THUMB_MAX_EDGE,u.DATA_URL|u.CANVAS|u.BLOB),microThumbnail:f.ServerProps.webUploadDocumentThumbMmsEnabled?(0,d.generateMicroThumb)(r,1300,{mimetype:"image/jpeg",maxAttempts:10}):Promise.resolve(null)}))).then((e=>e)).then(function(){var t=(0,i.default)((function*(t){let{blob:r,thumbnail:n,microThumbnail:i}=t;return{url:URL.createObjectURL(r),thumbUrl:n.images.dataUrl,width:n.images.canvas.width,height:n.images.canvas.height,fullPreviewData:yield p.default.createFromData(n.images.blob,"image/jpeg"),fullPreviewSize:{width:n.images.canvas.width,height:n.images.canvas.height},pdfPages:e.numPages,microThumbnail:i}}));return function(){return t.apply(this,arguments)}}())}}},6604:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.formatMeasureLabel=function(e){return` ${e}`},t.startMeasure=function(e){return n};const n={end(){}};(null===(r=performance)||void 0===r?void 0:r.mark)&&performance.measure,new Map},99304:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(2525)),o=n(r(19197)),s=n(r(92417));var l=new class{constructor(){this.dataStore={}}setItem(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.dataStore[e]=t,null!=s.default&&s.default.setItem(e,t),r&&o.default.idb().then((r=>r.user.put({key:e,value:t}))).catch((e=>{__LOG__(3)`db:setItem:Error ${e}`}))}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.dataStore[e]||t){if(null!=s.default){const t=s.default.getItem(e);return null!=t&&this.setItem(e,t,!1),t}return null}return this.dataStore[e]}removeItem(e){delete this.dataStore[e],null!=s.default&&s.default.removeItem(e),o.default.idb().then((t=>t.user.delete(e))).catch((e=>{__LOG__(3)`db:removeItem:Error ${e}`}))}clear(e){var t=this;return(0,i.default)((function*(){t.dataStore={},null!=s.default&&(s.default.clear(),e&&(0,a.default)(e,(function(e,t){s.default.setItem(t,e)}))),yield o.default.idb().then((e=>e.user.clear())).catch((e=>{__LOG__(3)`db:clear:Error ${e}`}))}))()}};t.default=l},53686:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.phashV1=function(){return l.apply(this,arguments)},t.phashV2=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(73045),s=r(45454);function l(){return(l=(0,i.default)((function*(e){const t=e.map((e=>(0,s.toUserWid)(e).toString({legacy:!0}))).sort().join(""),r=[];for(let e=0;e<t.length;e++)r.push(t.charCodeAt(e));const n=new Uint8Array(r),i=yield self.crypto.subtle.digest({name:"SHA-1"},n);return`1:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){const t=e.map((e=>e.toString({legacy:!0,formatFull:!0}))).sort().join(""),r=[];for(let e=0;e<t.length;e++)r.push(t.charCodeAt(e));const n=new Uint8Array(r),i=yield(0,o.sha256)(n);return`2:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}},18561:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(61181);const o=()=>{};var s="fetch"in window?fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.sharedFetch)(e,(0,i.default)((0,i.default)({},t),{},{onProgress:o}))};t.default=s},72451:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(65127);["webkitGetUserMedia"].forEach((function(e){const t=Object.getPrototypeOf(navigator)[e];t&&navigator[e]!==t&&(navigator[e]=t)}));var i=function(){var e;if(n.UA.isBrokenGetUserMedia)return null;const t=null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia;if(t)return t.bind(navigator.mediaDevices);const r=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return r?function(e){return new Promise((function(t,n){r.call(navigator,e,t,n)}))}:null}();t.default=i},66335:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(85396),a=n(r(34356));let o;var s="Headers"in window&&Headers?Headers:(o=a.default.iterator,class e{constructor(t){if(this._headers={},t instanceof e)for(const e of t.entries()){const[t,r]=e;r.split(", ").forEach((e=>{this.append(t,e)}))}else if("object"==typeof t)for(const e in t){t[e].split(", ").forEach((t=>{this.append(e,t)}))}}append(e,t){const r=e.toLowerCase();r in this._headers?this._headers[r].push(t):this._headers[r]=[t]}delete(e){const t=e.toLowerCase();delete this._headers[t]}entries(){const e=Object.keys(this._headers).map((e=>[e,this.get(e)||""]));return(0,i.iteratorFromArray)(e)}get(e){const t=e.toLowerCase();return t in this._headers?this._headers[t].join(", "):null}has(e){return e.toLowerCase()in this._headers}keys(){return(0,i.mapIterator)(this.entries(),(e=>{let[t]=e;return t}))}set(e,t){const r=e.toLowerCase();this._headers[r]=[t]}values(){return(0,i.mapIterator)(this.entries(),(e=>{let[t,r]=e;return r}))}[o](){return this.entries()}toString(){return"[Object Headers]"}});t.default=s},53485:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestIdleCallback=t.cancelIdleCallback=void 0;const r=window.requestIdleCallback,n=window.cancelIdleCallback,i="requestIdleCallback"in window?r:function(e){return setTimeout((()=>{const t=Date.now();e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1)};t.requestIdleCallback=i;const a="cancelIdleCallback"in window?n:function(e){clearTimeout(e)};t.cancelIdleCallback=a},26402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=window.MediaError||{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};t.default=r},34356:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n="Symbol"in window?Symbol:((r=class{}).iterator="@@iterator",r);t.default=n},23082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(35449);var n=URLSearchParams;t.default=n},82867:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDistribution=function(){let e="unknown";return e="prod","web_prod"},t.getLogUserAgent=function(e){let t,{appVersion:r,browser:n,device:i}=e;return t="Web/"+n,`WhatsApp/${r} ${t} Device/${i}`}},67643:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return(0,o.default)(e,function(){var n=(0,i.default)((function*(n){if(n.signal.aborted)throw new a.AbortError;const i=e(n),o=yield t.get(i,n);if(n.signal.aborted)throw new a.AbortError;if(null!=o)return o;const s=yield r(n);if(n.signal.aborted)throw new a.AbortError;return yield t.set(i,s,n),s}));return function(){return n.apply(this,arguments)}}())};var i=n(r(48926)),a=r(89385),o=n(r(58596))},18876:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(e,t){const{signal:r,timeoutIterator:n,timeoutIncludesTaskDuration:l}=(0,i.default)((0,i.default)({},s),e);return(0,a.default)((e=>{let{retry:r,failCount:i}=e;return new Promise(((e,a)=>{const s=Date.now();try{t((function(e){return Promise.reject(new o.default(e))}),i).then(e).catch(c)}catch(e){return void c(e)}function c(e){if(!(e instanceof o.default))return void a(e);const t=n.next();if(t.done)return void a(e.source);const i=Date.now()-s,c=l?Math.max(t.value-i,0):t.value;r(c)}}))}),r)},t.defaults=void 0;var i=n(r(81109)),a=n(r(18586)),o=n(r(85494));const s=Object.freeze({timeoutIncludesTaskDuration:!0});t.defaults=s},77712:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(){return c.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(13959),s=n(r(85494));const l={retries:1/0};function c(){return(c=(0,a.default)((function*(e,t){const{delay:r,signal:n,retries:a}=(0,i.default)((0,i.default)({},l),e);let c=0,d=Date.now(),u=null;const p=e=>Promise.reject(new s.default(e));try{return d=Date.now(),yield t(p,c,n)}catch(f){if(c++,!(f instanceof s.default))throw f;u=f}for(;c<=a;){const e=r({iterationCount:c,taskDuration:Date.now()-d});yield(0,o.delayMs)(e,n);try{return d=Date.now(),yield t(p,c,n)}catch(f){if(c++,!(f instanceof s.default))throw f;u=f}}if(!u)throw new Error("assert: backoff completed without error or result");const f=undefined;throw u.source}))).apply(this,arguments)}},91903:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exponentialBackoff=function(e,t){const r=(0,a.default)((0,a.default)({},c),e),{signal:n,timeoutIncludesTaskDuration:d}=r,u=(0,i.default)(r,l),p=(0,o.exponentialBackoffIterator)(u);return(0,s.backoff)({signal:n,timeoutIterator:p,timeoutIncludesTaskDuration:d},t)};var i=n(r(6479)),a=n(r(81109)),o=r(62971),s=r(18876);const l=["signal","timeoutIncludesTaskDuration"],c=(0,a.default)((0,a.default)({},o.defaults),s.defaults)},58596:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=new Map;return function(i){if(i.signal.aborted)return Promise.reject(new o.AbortError);const c=e.call(this,i);let d=r.get(c);if(null==d||d.aggregator.signal.aborted){const e=new l.default,n=(0,a.default)((0,a.default)({},i),{},{signal:e.signal});d={aggregator:e,promise:t.call(this,n).finally((()=>{e.dispose(),r.delete(c)}))},r.set(c,d)}const u=i.signal||(new n).signal;return d.aggregator.add(u),(0,s.default)(d.promise,u)}};var a=i(r(81109)),o=r(89385),s=i(r(84644)),l=i(r(3889))},84644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==t)return e;let r;const i=t.aborted?Promise.reject(new n.AbortError):new Promise(((e,i)=>{const a=()=>{i(new n.AbortError)};t.addEventListener("abort",a),r=()=>{t.removeEventListener("abort",a)}}));return Promise.race([i,e]).finally((()=>{var e;null===(e=r)||void 0===e||e(),r=null}))};var n=r(89385)},86243:(e,t,r)=>{"use strict";var n=r(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;const i=new n;if(e.some((e=>e.aborted)))i.abort();else{r=()=>{for(const r of e)r.removeEventListener("abort",t);r=null};const t=()=>{var e;null===(e=r)||void 0===e||e(),i.abort()};for(const r of e)r.addEventListener("abort",t)}return t(i.signal).finally((()=>{var e;null===(e=r)||void 0===e||e()}))}},18586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(((r,i)=>{let a,o=0,s=!1;if(t){const e=()=>{t.removeEventListener("abort",e),s=!0,null!=a&&clearTimeout(a),i(new n.AbortError)};if(t.aborted)return void e();t.addEventListener("abort",e)}!function t(){let n=!1,l=!1;a=null;try{const c=e({retry:e=>{if(!s&&!l){if(n=!0,o++,null==e)return t();a=setTimeout(t,e)}},failCount:o});if(!(c instanceof Promise))throw new TypeError("task must return a promise");c.then((e=>{s||n||(l=!0,r(e))})).catch((e=>{s||n||(l=!0,i(e))}))}catch(e){if(s||n)return;i(e)}}()}))};var n=r(89385)},85494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("RetryableError")){constructor(e){super("see error at this.source"),this.source=e}}t.default=i},3889:(e,t,r)=>{"use strict";var n=r(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(){this._disposed=!1,this._controller=new n,this._signals=new Set,this.signal=this._controller.signal,this._handleAbort=e=>{this.delete(e.currentTarget),this._checkAborted()}}add(){this._throwIfDisposed();for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const e of t)e.aborted||(e.addEventListener("abort",this._handleAbort),this._signals.add(e));this._checkAborted()}_checkAborted(){if(this._disposed)return;Array.from(this._signals).every((e=>e.aborted))&&(this.dispose(),this._controller.abort())}delete(){this._throwIfDisposed(),this._delete(...arguments)}_delete(){let e=!1;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const t of r)this._signals.delete(t)&&(e=!0,t.removeEventListener("abort",this._handleAbort));e&&this._checkAborted()}_throwIfDisposed(){if(this._disposed)throw new Error("Attempt to modify disposed SignalAggregator")}dispose(){if(!this._disposed){this._disposed=!0;for(const e of this._signals)this._delete(e)}}}},88064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.catch((0,n.catchAbort)((()=>{}))).catch((function(t){e.cancel(t)})),t};var n=r(89385)},82705:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Promise((function(e){function t(){e(!1)}if(self.requestFileSystem)self.requestFileSystem(window.TEMPORARY,1,t,(function(t){e("SecurityError"===t.name)}));else if(s.default){const r=s.default.open("pb_detect");r?(r.onsuccess=t,r.onerror=function(t){t.preventDefault(),window.InvalidStateError?e(t instanceof window.InvalidStateError):e(!0)}):t()}else c.UA.isTrident?e(!0):t()})).then((function(e){if(e)return e;if(!l.default)return!1;try{return l.default.setItem("INCOG","0"),l.default.removeItem("INCOG"),!1}catch(e){if("QuotaExceededError"===e.name)return!0;throw e}}));return(0,o.promiseTimeout)(e,100,"detectIncognitoTimeout").catch((0,a.filteredCatch)(i.TimeoutError,(function(){return!1}))).catch((function(e){return __LOG__(3,void 0,void 0,!0)`promiseUtil:determineIncognito failed check: ${String(e)}`,SEND_LOGS("incog-throw"),!1}))};var i=r(40265),a=r(50796),o=r(38284),s=n(r(2680)),l=n(r(92417)),c=r(65127)},75203:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return i.default.request(e,t,r,a,n).then((e=>e.status&&e.status<12e3?e:null)).catch((()=>null))};var i=n(r(11854))},49603:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"attachWatcher",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"determineIncognito",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"getResponseIfOnline",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"waitForBBEvent",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"waitForEvent",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"waitForMain",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"waitForOfflineNaive",{enumerable:!0,get:function(){return o.default}});var i=n(r(88064)),a=n(r(75203)),o=n(r(14706)),s=n(r(49036)),l=n(r(17072)),c=n(r(82705)),d=n(r(37904))},17072:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){if(null==i?void 0:i.aborted)return Promise.reject(new n.AbortError);let a,o;const s=r;return new Promise((function(r,l){if(a=s?function(){s.apply(this,arguments)&&r(arguments)}:function(){r(arguments)},i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new n.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}e.on(t,a)})).cancellable().finally((function(){var r;e.off(t,a),null===(r=o)||void 0===r||r()}))};var n=r(89385)},49036:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){if(null==i?void 0:i.aborted)return Promise.reject(new n.AbortError);let a,o;const s=r;return new Promise((function(r,l){var c;if(a=s?function(){s.apply(this,arguments)&&r.apply(this,arguments)}:r,i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new n.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}null===(c=e.addEventListener)||void 0===c||c.call(e,t,a)})).cancellable().finally((function(){var r,n;null===(r=e.removeEventListener)||void 0===r||r.call(e,t,a),null===(n=o)||void 0===n||n()}))};var n=r(89385)},37904:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(i.Cmd.isMainLoaded)return Promise.resolve();return(0,a.default)(i.Cmd,"main_loaded")};var i=r(88102),a=n(r(17072))},14706:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)(window,"offline")};var i=n(r(49036))},35217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_IDB_DB_NAMES=void 0,t.deleteAllIdb=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(38284),o=n(r(86128));const s={__dbnames:"__dbnames",fts_storage:"fts-storage",fts_loadgen_metadata:"loadgen-storage",_hsm_storage_DEPRECATED:"hsm-storage",jobs_storage:"jobs-storage",lru_media_storage_idb:"lru-media-storage-idb",model_storage:"model-storage",offd_storage:"offd-storage",signal_storage:"signal-storage",sw:"sw",wawc:"wawc",wawc_db_enc:"wawc_db_enc",qpl_storage:"qpl-storage"};function l(){return(l=(0,i.default)((function*(){const e=Object.keys(s).map((e=>s[e]));let t=!1;const r=e.map(function(){var e=(0,i.default)((function*(e){if("__dbnames"!==e&&"sw"!==e)try{yield(0,a.promiseTimeout)(Promise.resolve(o.default.delete(e)),7e3)}catch(e){t=!0}}));return function(){return e.apply(this,arguments)}}());return yield Promise.all(r),t}))).apply(this,arguments)}t.WEB_IDB_DB_NAMES=s},87826:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){if(c(l))return!0;return(0,i.promiseProps)({cryptoSha256:a.default.supportsHmacSha256(),cryptoAesCbc:a.default.supportsAesCbc()}).then(c),!1};var i=r(67602),a=n(r(94e3)),o=n(r(92417)),s=n(r(53962));const l={getRandomValues:!!self.crypto.getRandomValues,subtleCrypto:!(!self.crypto||!self.crypto.subtle&&!self.crypto.webkitSubtle),localstorage:!!o.default,sessionstorage:!!s.default,url:!!self.URL,websocket:!!self.WebSocket,worker:!!self.Worker};function c(e){const t=[];for(const r in e)e[r]||t.push(r);if(t.length>0){const e=`https://web.whatsapp.com/browsers.html?missing=${t.join(",")}`;return window.location.replace?window.location.replace(e):window.location.href=e,!0}return!1}},84426:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(8584),i=r(57319);const a=1e4;t.default=class{constructor(e){this.performSendStep=()=>{let e=!1,t=a;if(this.remainingChunk){const r=this.remainingChunk;if(r.length>=a){const i=n.Binary.build(210,128,r),o=i.readBuffer(a);this.remainingChunk=i.readByteArray(),e=!0,t=0,this._send(o)}else{const i=n.Binary.build(211,128,r);this.remainingChunk=null,e=!0,t-=i.size(),this._send(i.readBuffer())}}const r=this.queue;for(;r.length&&t>2;){const i=r.shift();if("string"==typeof i)i.length<=t||!e?(e=!0,t-=i.length,this._send(i)):(t=0,r.unshift(i));else if(i.byteLength<t)e=!0,t-=i.byteLength,this._send(i);else{const r=n.Binary.build(208,128,i),a=r.readBuffer(t);this.remainingChunk=r.readByteArray(),e=!0,t=0,this._send(a)}}this.isQueueing()&&this.timer.onOrBefore(250)},this.watchedSocket=e,this.queue=[],this.remainingChunk=null,this.timer=new i.ShiftTimer(this.performSendStep)}isQueueing(){return this.queue.length>0||!!this.remainingChunk}cancel(){this.timer.cancel()}_send(e){this.watchedSocket.socket.send(e)}send(e){this.isQueueing()?this.queue.push(e):function(e){return"string"==typeof e?e.length:e.byteLength}(e)<=a?this._send(e):(this.queue.push(e),this.timer.forceRunNow())}}},17117:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clear=function(){c=void 0},t.get=function(){return(0,s.default)(c,"BUNDLE")},t.getBundle=function(){return c},t.getSecurityToken=function(){return u.apply(this,arguments)},t.load=function(){const e=(0,l.getSecretBundle)();if(!e)return __LOG__(2)`secret_bundle:load: attempted to load non-existent secret bundle!`,null;return d(e),e},t.save=function(){if(!c)return void __LOG__(2)`secret_bundle:save: trying to save empty secret bundle!`;delete c.keyPair,(0,l.setSecretBundle)(c)},t.set=d,t.setSecretKeys=function(e,t,r){"0.1"===e?c&&t&&r?(c.encKey=t,c.macKey=r,c.key=r):__LOG__(3)`secret_bundle:setSecretKeys v${e} ${String(t)} ${String(r)}`:__LOG__(2)`secret_bundle:setSecretKeys unknown version: v${e}`};var i=n(r(48926)),a=r(15688),o=r(11141),s=n(r(45095)),l=r(99234);let c;function d(e){c=e}function u(){return(u=(0,i.default)((function*(e){if(!c)return __LOG__(3)`secret_bundle:getSecurityToken: no secret bundle`,Promise.reject(new Error("secret_bundle:getSecurityToken: no secret bundle"));const t=yield(0,o.hmacSha256)(c.key,new Uint8Array(e));return(0,a.encodeB64)(t)}))).apply(this,arguments)}},16413:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOrGenerate=function(){const e=i.getBundle();if((null==e?void 0:e.key)&&e.keyPair)return(0,n.encodeB64)(e.key);const t=a.keyPair(),r=(0,n.encodeB64)(t.pubKey),o={key:t.pubKey,keyPair:t,encKey:void 0,macKey:void 0};return i.set(o),r};var n=r(15688),i=s(r(17117)),a=s(r(5087));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}},28245:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.normalizeError)(e),{name:r,message:n,stack:s}=t,l=(0,i.default)(t,o),c=(0,a.normalizeStack)(e,!0),d=0===Object.keys(l).length?"":" "+JSON.stringify(l,((e,t)=>e&&"object"==typeof t?String(t):t));return`${r} - ${n||""}${d}\n${c}`};var i=n(r(6479)),a=r(97237);const o=["name","message","stack"]},53962:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=window.sessionStorage}catch(e){}var n=r;t.default=n},59578:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){this.cache=new Map,this.howBig=0,this.fn=e}getKeyString(e){return"string"==typeof e?e:e.join("_")}getRefSetter(e){const t=this.getKeyString(e);let r=this.cache.get(t);return r||(r=r=>{this.fn(e,r),r||this.cache.delete(t)},this.cache.set(t,r),Math.floor(this.cache.size/500)>this.howBig&&(__LOG__(4,void 0,new Error)`[SetRefCache] Large cache detected with ${this.cache.size} entries`,this.howBig=Math.floor(this.cache.size/500))),r}}},26445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(51584)),a=n(r(13218)),o=n(r(16579)),s=n(r(2525)),l=r(31515);function c(e){switch(typeof e){case"object":return null==e?e=>null===e:function(e){const t=[];let r=!1,n=0;(0,s.default)(e,(function(e,i){if(void 0===e)return void(r=!0);n++;const a=c(e);t.push((function(e){return e.hasOwnProperty(i)&&a&&a(e[i])}))}));const i=(0,o.default)(t,(function(e,t){return e?function(r){return t(r)&&e(r)}:t}));return function(e){if("object"!=typeof e||null==e)return!1;const t=Object.keys(e).length;return!(t<n)&&!(!r&&t>n)&&i(e)}}(e);case"function":return e;case"boolean":case"undefined":case"number":case"string":return function(t){return t===e};default:throw new TypeError("Unknown Template type: "+typeof e)}}class d{constructor(e){this.predicate=c(e)}test(e){return this.predicate(e)}}t.default=d,d.ANY=()=>!0,d.OBJECT=a.default,d.STRING=l.isString,d.BOOLEAN=i.default},87481:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41609)),a=n(r(34342));class o extends a.default{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"next";super(),this.list=e,this.index=-1,this.value=void 0,this.getter=t,this.deleteDir=r}init(){let e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.list=r,null!=this.value)if((0,i.default)(r))this.unset();else{if(e=r.indexOf(this.value),e>-1){if(e===this.index)return;t=!0,n=!1}else if(!n||this.index<0)e=-1;else{const n="prev"===this.deleteDir?-1:0;e=this.index+n,e=Math.max(e,0),e=Math.min(e,r.length-1),t=e>-1}this.set(e,n,t)}}unset(){const e=this.value;this.value=void 0,this.index=-1,null!=e&&this.trigger(this.getter(e),!1)}reset(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.index<0||null!=this.value&&this.trigger(this.getter(this.value),"focus",e)}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.list.length)return;const n=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,a=n>-1?this.list[n]:void 0;null!=a?(this.value=a,this.trigger(this.getter(a),!0===t?"focus":"select")):!0===r&&(this.value=void 0),!0===r&&null!=i&&i!==a&&this.trigger(this.getter(i),!1),this.index=n}getVal(){return this.value}setVal(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=this.list.indexOf(e);r>-1?this.set(r,t):(this.unset(),this.value=e)}setFirst(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(0,e,!0)}setLast(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.list.length-1,e,!0)}setPrev(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.prev(),e,!0)}setNext(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.next(),e,!0)}prev(){return(0,i.default)(this.list)||-1===this.index?-1:this.index-1}next(){return(0,i.default)(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}var s=o;t.default=s},30631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPSACampaigns=a,t.getPsaCampaignIndex=function(e,t){if(0===t.length)return-1;let r=0,n=t[0].campaignId;for(let i=1;i<t.length;i++){const{id:a,campaignId:o}=t[i];if(n!==o?(n=o,r=0):r++,a.toString()===e.toString())return r}return-1},t.getPsaCampaignsString=function(e){const t=a(e),r=[];return Object.keys(t).forEach((e=>{const n=t[e],{numberOfStatus:i,numberOfReadStatus:a}=n;r.push(`${e}:${i-a}`)})),r.join(",")},t.isCampaignExpired=o,t.isExpiredStatusPSA=function(e,t){const r=a(e);return Object.keys(r).every((e=>o(r[e],t)))};var n=r(92844),i=r(22683);function a(e){const t={};return e.forEach((e=>{let{t:r,campaignId:n,campaignDuration:i,statusPSAReadTimestamp:a}=e;if(!n)return;t[n]||(t[n]={id:n,t:r,duration:i,firstReadTimestamp:null,numberOfStatus:0,numberOfReadStatus:0});const o=t[n];o.numberOfStatus++,null!=a&&(o.numberOfReadStatus++,(null==o.firstReadTimestamp||a<o.firstReadTimestamp)&&(o.firstReadTimestamp=a))})),t}function o(e,t){const r=e.firstReadTimestamp;if(null!=r)return(0,n.castToUnixTime)(i.Clock.globalUnixTime()-r)>t;const a=e.duration;return null!=a&&i.Clock.globalUnixTime()-e.t>a}},12209:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isWeb=t.isOSWin=t.isOSRTL=t.isOSMac=t.isOSLTR=t.isNative=t.hasSafariFix=t.hasFontFix=t.hasFirefoxFix=t.hasEdgeFix=void 0;var i=n(r(43725)),a=r(65127);null!=window.Native&&i.default.isRTL(window.Native.appGetLocale());t.isNative=!1;t.isWeb=!0;const o=a.UA.isSafari;t.hasSafariFix=o;const s=a.UA.isTrident;t.hasEdgeFix=s;const l=a.UA.isGecko;t.hasFirefoxFix=l;const c=a.UA.browser===a.BROWSER_TYPE.CHROME||a.UA.browser===a.BROWSER_TYPE.OPERA;t.hasFontFix=c;t.isOSLTR=!1;t.isOSRTL=!1;const d=a.UA.os===a.OS_TYPE.MAC;t.isOSMac=d;const u=a.UA.os===a.OS_TYPE.WINDOWS;t.isOSWin=u},28080:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=function(e,t,r,n,s,c){return Promise.resolve().then((()=>{if(!(10<=s.length&&s.length<=32))throw new l.MediaEncryptionError("Given bad expected hmac");const c=i.Binary.build(t,r).readByteArray();return(0,o.hmacSha256)(n,c).then((n=>{const i=new Uint8Array(n,0,s.length);let o=!1;for(let e=0;e<i.length;e++)i[e]!==s[e]&&(o=!0);if(o)throw new l.MediaEncryptionError("hmac check failure");return(0,a.aesCbcDecrypt)(e,t,r)}))})).then((e=>{const t="string"==typeof c?c:c(new Uint8Array(e));return u.default.createFromData(e,t)}))},t.getHash=function(e){return(e instanceof u.default?(0,d.opaqueDataToArrayBuffer)(e):(0,c.blobToArrayBuffer)(e)).then((e=>(0,s.sha256Base64)(e))).catch((t=>{const r={error:`${t}`,blobSize:e.size,isOpaqueData:e instanceof u.default};__LOG__(3,void 0,void 0,!0)`SubtleCrypto::getHash error. Debug:\n${JSON.stringify(r,null,2)}`,SEND_LOGS("subtle-crypto-get-hash-error")}))};var i=r(8584),a=r(81484),o=r(11141),s=r(73045),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=r(1063),d=r(56406),u=n(r(34949));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}},90257:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genDeviceNotificationMsg=function(e,t,r,n){const l=(0,s.assertGetMe)(),c=new a.default({fromMe:t.equals((0,o.toUserWid)(l)),remote:e,id:a.default.newId()}),d=c.fromMe&&r.includes(l.getDeviceId());return{id:c,t:(0,i.unixTime)(),type:"e2e_notification",subtype:"device",from:e,to:(0,o.toUserWid)(l),body:t.toString(),devicesAdded:r.length,devicesRemoved:n.length,isThisDeviceAdded:d}},t.genDisappearingModeSystemMsg=function(e,t,r){const n=r?(0,s.getMeUser)():e,i=[String(t),n];return l(e,"notification_template","disappearing_mode",i)},t.genEncryptNotificationMsg=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"encrypt";return l(e,"e2e_notification",t,[])},t.genErrorInDeviceListNotificationMsg=function(e,t){const r=(0,s.assertGetMe)();return{id:new a.default({fromMe:!1,remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"error_in_device_list",from:e,to:(0,o.toUserWid)(r),templateParams:[t]}},t.genNotificationMsg=l,t.genSecurityCodeNotificationMsg=function(e,t){const r=(0,s.getMeUser)();return{id:new a.default({fromMe:t.equals(r),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"identity",from:e,to:r,body:t.toString()}},t.genTealNotificationTemplateMsg=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return l(e,"notification_template",t,r)};var i=r(92844),a=n(r(65212)),o=r(45454),s=r(99234);function l(e,t,r,n){const o=(0,s.getMeUser)();return{id:new a.default({fromMe:e.equals(o),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:t,subtype:r,from:e,to:o,templateParams:n}}},25868:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){switch((0,i.getReducedPrivacyMode)(t)){case i.ReducedPrivacyMode.E2EE:return(0,n.genEncryptNotificationMsg)(e);case i.ReducedPrivacyMode.BSP:return(0,n.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_bsp");case i.ReducedPrivacyMode.FB:return(0,n.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_fb")}};var n=r(90257),i=r(30849)},43239:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&!e.isGroupMsg&&0===t.msgs.length)return(0,i.default)(t.id,t.contact.privacyMode);return null};var i=n(r(25868)),a=r(7293)},37654:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genGroupCreationMsg=function(e,t){var r,n,a;const{chatId:s}=e,l=null!==(r=null!==(n=t.owner)&&void 0!==n?n:e.author)&&void 0!==r?r:(0,o.getMaybeMeUser)(),c=t.subject;return{id:new i.default({remote:s,fromMe:!1,participant:l,id:i.default.newId()}),author:l,body:c,from:s,recipients:[],self:"in",subtype:"create",t:null!==(a=t.creation)&&void 0!==a?a:e.ts,type:"gp2"}},t.genGroupEphemeralSettingMsg=function(e,t,r,n){return{id:new i.default({remote:e,fromMe:!1,participant:r,id:i.default.newId()}),author:r,from:e,recipients:[],self:"in",subtype:"ephemeral",t,type:"gp2",templateParams:[`${n}`]}},t.genGroupNotificationMsg=function(e,t){const{chatId:r}=e,n=e.author&&(0,a.toUserWid)(e.author)||void 0;let o=null,l=[],c=n,d=t.action,u=null;switch(t.action){case s.GROUP_ACTIONS.SUBJECT:o=t.subject;break;case s.GROUP_ACTIONS.MODIFY:l=t.participants;break;case s.GROUP_ACTIONS.ADD:t.isInvite&&(d="invite");case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:case s.GROUP_ACTIONS.REMOVE:l=t.participants,1===l.length&&(c=l[0]),t.action===s.GROUP_ACTIONS.REMOVE&&1===l.length&&n===c&&(d="leave");break;case s.GROUP_ACTIONS.INVITE_CODE:d="revoke_invite";break;case s.GROUP_ACTIONS.DESC_ADD:d="description",o=t.desc;break;case s.GROUP_ACTIONS.DESC_REMOVE:d="description";break;case s.GROUP_ACTIONS.RESTRICT:case s.GROUP_ACTIONS.ANNOUNCE:case s.GROUP_ACTIONS.NO_FORWARD:u=t.value?["on"]:["off"],o=u[0];break;case s.GROUP_ACTIONS.EPHEMERAL:n&&(u=[`${t.duration}`,n]);break;case s.GROUP_ACTIONS.GROWTH_LOCKED:u=[t.type],o=u[0];break;case s.GROUP_ACTIONS.SUB_GROUP_LINK:case s.GROUP_ACTIONS.PARENT_GROUP_LINK:case s.GROUP_ACTIONS.SIBLING_GROUP_LINK:u=[...t.groups]}const p={id:new i.default({remote:r,fromMe:!1,participant:c,id:i.default.newId()}),author:n,from:r,recipients:l.map(a.toUserWid)||[],self:"in",subtype:d,t:e.ts,type:"gp2"};o&&(p.body=o);u&&(p.templateParams=u);return p},t.genGroupPicChangeNotificationMsg=function(e,t,r,n){return{type:"gp2",self:"in",subtype:"picture",t:r,author:n,body:t,recipients:[],from:e,id:new i.default({remote:e,fromMe:!1,id:i.default.newId()})}},t.genIntialPhashMismatchMsg=function(e,t){return{id:new i.default({remote:e,fromMe:!1,id:i.default.newId()}),from:e,recipients:[],self:"in",subtype:"initial_pHash_mismatch",t,type:"gp2"}};var i=n(r(65212)),a=r(45454),o=r(99234),s=r(36098)},39577:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPaymentInviteAccoutSetupMsg=function(e,t){return{id:new i.default({remote:e,fromMe:!1,id:i.default.newId()}),from:e,recipients:[],self:"in",subtype:"payment_invite_account_set_up",t,type:a.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[e]}};var i=n(r(65212)),a=r(15461)},30849:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReducedPrivacyMode=void 0,t.comparePrivacyMode=function(e,t){return null==e&&null==t?0:null==t?1:null==e?-1:e.privacyModeTs-t.privacyModeTs},t.getContactPrivacyMode=function(e){if(!i.default.isUser(e))return;const t=r(19380).ContactCollection.get(e);return null==t?void 0:t.privacyMode},t.getLatestPrivacyMode=function(e,t){return null==e?t:null==t||e.privacyModeTs>t.privacyModeTs?e:t},t.getPrivacyModeFromQueryExistResponse=function(e){var t;const r=null===(t=e.bizInfo)||void 0===t?void 0:t.verifiedName;return null==r?null:e.biz&&!0===r.isApi?r.privacyMode:null},t.getReducedPrivacyMode=function(e){if(null==e||e.actualActors===a.ActualActorsEnumType.Self&&e.hostStorage===a.HostStorageEnumType.OnPremise)return o.E2EE;if(e.hostStorage===a.HostStorageEnumType.Facebook)return o.FB;return o.BSP};var i=n(r(89867)),a=r(49714);const o=r(76672).Mirrored(["E2EE","BSP","FB"]);t.ReducedPrivacyMode=o},97920:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(2525)),a=n(r(45095)),o=r(72407),s=n(r(53962)),l=r(31515);var c=(()=>{try{const e=(0,a.default)(s.default,"sessionStorage");return e.setItem(o.KEYS.STORAGE_TEST,o.KEYS.STORAGE_TEST),(0,l.isFunction)(e.clear)}catch(e){return!1}})()?new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t,(0,a.default)(s.default,"sessionStorage").setItem(e,t)}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==this.dataStore[e]||t?(0,a.default)(s.default,"sessionStorage").getItem(e):this.dataStore[e]}removeItem(e){delete this.dataStore[e],(0,a.default)(s.default,"sessionStorage").removeItem(e)}clear(e){return this.dataStore={},(0,a.default)(s.default,"sessionStorage").clear(),e&&(0,i.default)(e,(function(e,t){(0,a.default)(s.default,"sessionStorage").setItem(t,e)})),Promise.resolve()}}:new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t}getItem(e){return void 0===this.dataStore[e]?null:this.dataStore[e]}removeItem(e){delete this.dataStore[e]}clear(){return this.dataStore={},Promise.resolve()}};t.default=c},59402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r={ROOT:1,THENABLE:2,FINALLY:3,META:4},n={PENDING:1,FULFILLED:2,REJECTED:3};function i(){let e,t;switch(this._parent=null,this._subs=[],this._catchTypes=null,this._onResolve=null,this._onReject=null,this.type=r.ROOT,this.state=n.PENDING,this.value=void 0,this._forceable=!1,this._cancellable=!1,arguments.length){case 0:break;case 1:e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("TightPromise constructor with "+arguments.length+" arguments")}if(this.context=t,arguments.length>0)try{e.call(t,o.bind(this),s.bind(this))}catch(e){s.call(this,e)}}function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const a=new i;return a.type=r.THENABLE,a._onReject=arguments[arguments.length-1],arguments.length>1&&(a._catchTypes=Array.prototype.slice.call(arguments,0,arguments.length-1),a._catchTypes.forEach((function(e){if("function"!=typeof e)throw new Error("expected type, got "+e)}))),this._addChild(a),a}function o(e){var t;this.state===n.PENDING&&("object"!=typeof(t=e)&&"function"!=typeof t||"function"!=typeof t.then?(this.value=e,this.state=n.FULFILLED,this._notifySubs()):e.then(o.bind(this),s.bind(this)))}function s(e){this.state===n.PENDING&&(this.value=e,this.state=n.REJECTED,this._notifySubs())}i.STATE=n,i.TYPE=r,i.prototype={isPending:function(){return this.state===n.PENDING},then:function(e,t){if(!e&&!t)return this;const n=new i;return n.type=r.THENABLE,n._onResolve=e||null,n._onReject=t||null,this._addChild(n),n},catch:a,catchType:a,catchTypes:a,catchTypes3:a,catchEqualTo:a,finally:function(e){const t=new i;return t.type=r.FINALLY,t._onResolve=e,this._addChild(t),t},bind:function(e){const t=new i;return t.type=r.META,this._addChild(t),t.context=e,t},spread:function(e){return this.then((function(t){e.apply(this,t)}))},get:function(e){return this.then((function(t){return t[e]}))},forceable:function(){const e=new i;return e.context=this.context,e.type=r.META,this._addChild(e),e._forceable=!0,e},cancellable:function(){const e=new i;return e.context=this.context,e.type=r.META,this._addChild(e),e._cancellable=!0,e},force:function(e){if(this._forceable){let t=this;for(;t.type===r.META;){const e=t._parent;if(!(null==e?void 0:e._forceable)||e.state!==n.PENDING)break;t=e}o.call(this,e)}},cancel:function(e){let t=e;if(this._cancellable){t=t||new Promise.CancellationError;let e=this,r=!1;do{const t=e._parent;(null==t?void 0:t._cancellable)&&t.state===n.PENDING?e=t:r=!0}while(!r);s.call(e,t)}},loosen:function(){return Promise.resolve(this)},_run:function(e,t){let r;try{r=e.call(this.context,t)}catch(e){return void s.call(this,e)}o.call(this,r)},_handle:function(){if(this.state!==n.PENDING)return;const e=this._parent;switch(this.type){case r.THENABLE:if(e.state===n.FULFILLED){const t=this._onResolve;t?this._run(t,e.value):o.call(this,e.value)}else if(this._onReject){const t=this._catchTypes,r=t?t.length:0,n=e.value;if(0===r)return void this._run(this._onReject,n);for(let e=0;e<r;e++)if(n instanceof t[e])return void this._run(this._onReject,n);s.call(this,n)}else s.call(this,e.value);return;case r.FINALLY:try{this._onResolve.call(this.context)}catch(e){!function(e){setTimeout((function(e){throw e}),0,e)}(e)}default:e.state===n.FULFILLED?o.call(this,e.value):s.call(this,e.value)}},_addChild:function(e){e._parent=this,e.context=this.context,e._cancellable=this._cancellable,e.type===r.META&&(e._forceable=this._forceable),this.state===n.PENDING?this._subs.push(e):e._handle()},_notifySubs:function(){this._subs.forEach((function(e){e._handle()}))}},i.delay=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n,a;switch(arguments.length){case 0:n=0;break;case 1:n=arguments[0];break;default:n=arguments[1],a=arguments[0]}return new i((function(e){setTimeout(e.bind(null,a),n)}))},i.resolve=function(e){const t=new i;return o.call(t,e),t},i.reject=function(e){const t=new i;return s.call(t,e),t};var l=i;t.default=l},22906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expBackoff=i,t.expDelaySec=function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return(0,n.delayMs)(Math.floor(1e3*i(e,t,r,a)))};var n=r(13959);function i(e,t,r){let n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return n=0===e?r||0:2**e,Number.isFinite(t)&&n>t&&(n=t),"number"==typeof r&&Number.isFinite(r)&&n<r&&(n=r),i&&(n*=1+i*Math.random()),n}},16238:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TLD=void 0;const r=new Set(["abb","abbott","abogado","abudhabi","ac","academy","actor","ad","ads","adult","ae","aero","af","africa","ag","agency","ai","aig","al","am","amsterdam","anz","ao","apartments","app","apple","ar","archi","army","art","as","asia","associates","at","attorney","au","auction","audi","audio","auto","aw","aws","az","azure","ba","baby","band","bank","bar","barcelona","barclays","basketball","bb","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bible","bid","bike","bingo","bio","biz","bj","black","blog","blue","bm","bn","bnpparibas","bo","bond","bot","boutique","box","br","bradesco","broker","brother","brussels","bs","bt","build","builders","business","buzz","bw","by","bz","bzh","ca","cab","cafe","cam","camera","camp","canon","capital","cards","care","career","careers","cars","casa","cash","casino","cat","cc","cd","center","ceo","cern","cf","cfd","ch","charity","chat","cheap","chrome","church","ci","city","cl","claims","click","clinic","clothing","cloud","club","cm","cn","co","coach","codes","coffee","college","com","community","company","computer","condos","construction","consulting","cool","coop","coupons","courses","cpa","cr","credit","cricket","crs","cu","cv","cw","cx","cy","cymru","cyou","cz","dance","date","dating","day","de","deals","degree","delivery","deloitte","dental","dentist","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","dj","dk","do","doctor","dog","domains","download","dz","earth","ec","eco","edu","education","ee","eg","email","energy","engineer","engineering","equipment","es","estate","et","eu","eus","events","exchange","expert","exposed","express","fail","faith","family","fan","fans","farm","fashion","fi","film","finance","financial","fish","fishing","fit","fitness","fj","flights","florist","flowers","fm","fo","football","forex","forsale","foundation","fr","fun","fund","furniture","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gg","gh","gi","gift","gifts","gives","gl","glass","gle","global","gm","gn","gold","golf","goog","google","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","guide","guru","gy","hair","haus","health","healthcare","help","hitachi","hk","hn","hockey","holdings","holiday","homes","honda","horse","host","hosting","house","how","hr","ht","hu","icu","id","ie","il","im","immo","in","inc","industries","info","ink","institute","insurance","insure","int","international","investments","io","iq","ir","is","ismaili","ist","istanbul","it","java","jcb","je","jewelry","jm","jnj","jo","jobs","joburg","jp","ke","kg","kh","ki","kim","kitchen","kiwi","kn","koeln","kp","kpmg","kr","krd","kred","kw","ky","kyoto","kz","la","land","lat","law","lawyer","lb","lc","leclerc","legal","lgbt","li","life","lighting","limited","limo","link","live","lk","llc","loan","loans","lol","london","love","lr","ls","lt","ltd","ltda","lu","luxe","lv","ly","ma","makeup","management","market","marketing","markets","mba","mc","md","me","med","media","melbourne","men","menu","mg","miami","microsoft","mil","mk","ml","mm","mn","mo","mobi","moda","moe","moi","mom","monash","money","monster","moscow","movie","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","navy","nc","ne","net","network","neustar","news","nf","ng","ngo","ni","ninja","nl","no","np","nr","ntt","nu","nyc","nz","observer","office","okinawa","om","one","ong","onl","online","ooo","orange","org","organic","osaka","ovh","pa","page","paris","partners","parts","party","pe","pet","pf","pg","ph","pharmacy","photo","photography","photos","physio","pics","pictet","pictures","pink","pizza","pk","pl","place","plus","pm","pn","poker","porn","post","pr","press","prime","pro","prod","productions","promo","properties","property","ps","pt","pub","pw","py","qa","quebec","quest","racing","radio","re","realestate","realtor","red","rehab","reise","ren","rent","rentals","repair","report","rest","restaurant","review","reviews","rio","rip","ro","rocks","rodeo","rs","ru","run","rw","sa","sale","salon","sandvik","sap","saxo","sbi","sbs","sc","school","schule","schwarz","science","scot","sd","se","seat","security","services","sex","sexy","sg","sh","sharp","shiksha","shoes","shop","shopping","show","si","site","sj","sk","ski","skin","sky","sl","sm","sn","sncf","so","social","softbank","software","solar","solutions","sony","soy","space","sport","sr","srl","ss","st","statebank","storage","store","stream","studio","study","style","su","sucks","supplies","supply","support","surf","sv","swiss","sx","sy","sydney","systems","sz","taipei","tatar","tattoo","tax","taxi","tc","team","tech","technology","tel","tennis","teva","tf","tg","th","tienda","tips","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","toshiba","tours","town","toyota","toys","tr","trade","trading","training","travel","tt","tube","tv","tw","tz","ua","ug","uk","university","uno","us","uy","uz","va","vc","ve","vegas","ventures","vet","vg","vi","video","villas","vin","vip","vision","vn","vote","voto","vu","wales","wang","watch","webcam","weber","website","wedding","wf","wien","wiki","win","wine","work","works","world","ws","wtf","xin","xyz","yandex","ye","yoga","youtube","yt","za","zip","zm","zone","zw","","","","","","","","","","","","","","","","","","",""]);t.TLD=r},25170:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(12641));const a=[.1,.82,.25,1],o=[.69,0,.79,.14],s=[.84,.07,.93,.46];i.default.RegisterEffect("attach.Up",{defaultDuration:300,calls:[[{opacity:[1,0],translateY:["0%","150%"],scaleX:[1,.3],scaleY:[1,.3]},1,{easing:[300,22]}]]}),i.default.RegisterEffect("attach.Down",{defaultDuration:200,easing:o,calls:[[{opacity:[0,1],translateY:["100%","0%"],scaleX:[.3,1],scaleY:[.3,1]},1,{easing:[.33,0,.39,.91]}]]}),i.default.RegisterEffect("dropdown.Down",{defaultDuration:200,easing:a,calls:[[{opacity:[1,0],translateY:["0%","-15px"]},1,{easing:a}]]});var l={pop:{duration:200,easing:s,enter:{props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]}},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]}}},slide:{duration:200,easing:a,enter:{props:"slideDown"},leave:{props:"slideUp"}},scaleY:{duration:200,easing:a,enter:{props:{scaleY:[1,0],transformOrigin:"center"}},leave:{props:{scaleY:[0,1],transformOrigin:"center"}}},scale:{duration:500,easing:a,enter:{props:{scaleX:[1,0],scaleY:[1,0]}},leave:{props:{scaleX:[0,1],scaleY:[0,1]}}},fade:{duration:200,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},messageComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0],translateX:[0,-100]}},leave:{props:{opacity:[0,1],translateX:[-100,0]}}},pttComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"fade-fast":{easing:"ease",enter:{props:{opacity:[1,0]},duration:150},leave:{props:{opacity:[0,1]},duration:100}},"ptt-out-of-chat":{enter:{props:{translateY:["-100%","0%"],opacity:[1,0]},duration:250,delay:150,easing:"ease"},leave:{props:{translateY:["0%","-100%"],opacity:[0,1]},duration:250,delay:150,easing:"ease"}},fade_sifo:{enter:{props:{opacity:[1,0]},duration:250},leave:{props:{opacity:[0,1]},duration:100}},capture:{enter:{props:{opacity:[1,0]},duration:350},leave:[{selector:"[data-animate-capture-snapshot]",props:"transition.bounceDownOut",duration:700},{selector:"[data-animate-capture-webcam]",props:{opacity:[0,1]},duration:100,easing:"ease"}]},butterbar:{enter:{props:"slideDown",easing:a,duration:700},leave:{props:"slideUp",easing:o,duration:350}},modal:{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,0]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"modal-flow":{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"flow-transition-modal-push":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-modal-pop":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-box-size-drawer-push":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["-100%","0%"]}}]},"flow-transition-box-size-drawer-pop":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","-100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["100%","0%"]}}]},"flow-transition-drawer-push":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"flow-transition-drawer-pop":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"drawer-left":{enter:[{props:{translateX:["0%","-100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,-50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["-100%","0%"]},duration:300,easing:o}]},"drawer-left-rtl":{enter:[{props:{translateX:["0%","100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["100%","0%"]},duration:300,easing:o}]},dropdown:{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:"dropdown.Down",delay:50,duration:375,stagger:25,drag:!0},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}},"dropdown-picker":{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},delay:50,duration:200},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0],rotateZ:["45deg"],translateY:["0%","-100%"]}},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},duration:100},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0]},duration:150},{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}]},"profile-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:[{delay:400,props:{opacity:[0,1]}},{selector:"[data-animate-profile-viewer]",props:{borderRadius:["50%","0%"]}}]},"media-viewer":{duration:300,easing:[.1,1.03,.28,.99],leave:{selector:"[data-animate-media-viewer]",props:{opacity:[0,1]}}},"status-v3-quoted-msg":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:200,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-panel":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:300,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[0,1]}}},"quoted-status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[0,1]}}},"status-v3-player":{easing:[.55,.085,.68,.53],enter:{duration:200,props:{opacity:[1,0]}},leave:{duration:200,props:{opacity:[0,1]}}},menu:{enter:{selector:"[data-animate-menu-icons-item]",props:"attach.Up",duration:700,stagger:30,drag:!1},leave:{selector:"[data-animate-menu-icons-item]",props:"attach.Down",duration:200,stagger:30}},emoji:{duration:300,easing:a,enter:{props:{height:[291,0]}},leave:{props:{height:[0,291]}}},ptt:{enter:[{selector:"[data-animate-btn-border]",easing:"easeInOut",props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]},duration:250,delay:100},{selector:"[data-animate-ptt-counter]",easing:"easeInOut",props:{scaleX:[1,.8],scaleY:[1,.8],opacity:[1,0]},duration:250,delay:100},{props:{opacity:[1,0]},duration:150,easing:a}],leave:[{selector:"[data-animate-btn-border]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{selector:"[data-animate-ptt-counter]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{props:{opacity:[0,1]},duration:300,easing:a}]},"slide-left":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["100%","0%"]}}},"slide-left-rtl":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"media-slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["-30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"media-slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","-30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"slide-down-date":{duration:300,enter:{props:{translateY:["0%","-130%"],opacity:[1,0]},easing:a},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]},easing:o}},"slide-down-test":{duration:300,easing:a,enter:{props:{height:["auto","0"],opacity:[1,0]}},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]}}},"pop-fast-reverse":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","-100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["-100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast-chat":{duration:75,easing:[.14,.62,.33,.9],enter:[{props:{width:["20px","5px"],opacity:[1,.5]}}],leave:[{props:{width:["5px","20px"],opacity:[0,1]}}]},"toast-transition":{duration:300,easing:a,cleanOnComplete:!0,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"slide-up-down":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-down-footer":{duration:200,easing:a,enter:[{props:{translateY:["0%","100%"]}},{selector:"[data-animate-btn]",props:{opacity:[1,0],scale:[1,0]},delay:200,duration:300}],leave:[{props:{translateY:["100%","0%"]},delay:200},{selector:"[data-animate-btn]",props:{opacity:[0,1],scale:[.6,1]},duration:200}]},"slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-fade-in-eta":{duration:100,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0],height:[20,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1],height:[0,20]}}},"slide-down":{duration:300,easing:a,enter:{props:{translateY:["0%","-100%"]}},leave:{props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away":{duration:300,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away-fast":{duration:80,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-panel-slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1]}}},none:{},btn:{duration:300,easing:a,enter:{props:{scale:[1,0],opacity:[1,0]}},leave:{props:{scale:[0,1],opacity:[0,1]}}},pop_delay:{duration:300,enter:[{props:{scale:[1,0],opacity:[1,0]},delay:500,easing:a}],leave:{props:"transition.expandOut",easing:o}},"delay-leave":{duration:1,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]},delay:300}},"media-caption":{enter:[{props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300}],leave:{props:{opacity:[0,1]},easing:"ease",duration:300}},"media-scale":{enter:[{selector:"[data-animate-media-caption]",props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{selector:"[data-animate-media-caption]",props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,0]},duration:200},{selector:"[data-animate-attach-media]",props:{opacity:[1,0],scale:[1,.625],display:"flex"},delay:200,duration:300,easing:a}],leave:[{selector:"[data-animate-media-caption]",props:{opacity:[0,1]},easing:"ease",duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,1],scale:[.5,1],display:"flex"},delay:0,duration:200,easing:o}]},"thumb-scale":{duration:400,easing:a,enter:{props:"transition.expandIn"},leave:{props:"transition.expandOut"}},"thumb-scale-flex":{duration:400,easing:a,enter:{props:{scale:[1,0],display:"flex"}},leave:{duration:200,props:{scale:[0,1],display:"flex"}}},default:{duration:300,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},noop:{duration:0},"noop-full-opacity":{duration:0,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]}}},pip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},voip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},"replace-fade":{enter:[{props:{opacity:[0,0]},duration:400},{props:{opacity:[1,0]},duration:400,delay:400}],leave:{props:{opacity:[0,1]},duration:400}}};t.default=l},31515:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=function(e){return"boolean"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=i,t.isStringOrFbt=function(e){return i(e)||n.fbt.isFbtInstance(e)};var n=r(48360);function i(e){return"string"==typeof e}},65127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UA=t.OS_TYPE=t.BROWSER_TYPE=void 0,t.gteVersion=o,t.ltVersion=s,t.parseUA=l;var i=n(r(42238));t.BROWSER_TYPE={CHROME:"chrome",CHROMIUM:"chromium",FIREFOX:"firefox",SAFARI:"safari",IE:"ie",OPERA:"opera",EDGE:"edge"};function a(e,t){let r,n;const i=/(\.0)+[^\.]*$/,a=(e+"").replace(i,"").split("."),o=(t+"").replace(i,"").split("."),s=Math.min(a.length,o.length);for(r=0;r<s;r++)if(n=parseInt(a[r],10)-parseInt(o[r],10),0!==n)return n;return a.length-o.length}function o(e,t){return a(e,t)>=0}function s(e,t){return a(e,t)<0}function l(e){const t=new i.default;t.setUA(e||"");const r=(t.getBrowser().name||"").toUpperCase(),n=t.getBrowser().version||"0.0.0",a=(t.getEngine().name||"").toUpperCase(),l=(t.getOS().name||"").toUpperCase(),c=t.getOS().version||"0.0.0",d="SAFARI"===r,u="CHROME"===r,p="GECKO"===a,f="BLINK"===a;let _=!1;switch(l){case"MAC OS":u?_=o(c,"10.10")&&o(n,"41.0.0"):o(c,"10.7")&&(_=!0);break;case"WINDOWS":o(c,"8.1")&&(p||u&&o(n,"41.0.0"))&&(_=!0)}const h=d||u&&s(n,"76");return{isWebkit:!a||"WEBKIT"===a,isGecko:p,isTrident:"TRIDENT"===a||"EDGEHTML"===a,isSafari:d,isElectron:!1,isBlink:f,isBuggyVideoLoad:u&&o(n,"76")||f&&!u,hasEmoji:_,troublesWithLotsOfVideos:u,supportsEmojiEllipsification:!h,isBrokenGetUserMedia:u&&s(n,"50"),isLocalStorageBroken:d&&o(n,"14.1")&&s(n,"14.1.2"),os:l.toLowerCase(),osVersion:c,browser:r.toLowerCase(),browserVersion:n,parser:t,isChrome:u}}t.OS_TYPE={WINDOWS:"windows",MAC:"mac os",CHROMEOS:"chromium os"};const c=l("undefined"!=typeof self?self.navigator.userAgent:null);t.UA=c},41629:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterBase=t.DownloadState=void 0;var i=r(40265),a=n(r(15421)),o=r(22683),s=n(r(19197)),l=n(r(34342)),c=n(r(11772)),d=r(47221);const u=r(76672).Mirrored(["UPDATE_DOWNLOADED","UPDATE_NOT_AVAILABLE","ERROR"]);t.DownloadState=u;class p extends l.default{constructor(){super(),this._forceUpdateOnTakeOver=!1,this.latestUpdateIteration=0,this.activeVersion=new d.Version("2.2208.7"),s.default.onVersionChange((()=>this.setForceUpdateOnTakeOver()))}setForceUpdateOnTakeOver(){this._forceUpdateOnTakeOver=!0}shouldForceUpdateOnTakeOver(){const e=this._forceUpdateOnTakeOver;return this._forceUpdateOnTakeOver=!1,!!e}isExpired(){return o.Clock.globalUnixTime()>Number(c.default)}clearHardExpiration(){this.hardExpirationTimer&&(a.default.clearTimeout(this.hardExpirationTimer),this.hardExpirationTimer=void 0),this.stopListening(r(8080).Stream,"change:couldForce")}update(){throw new i.UnimplementedMethod("Updater::update")}restart(){throw new i.UnimplementedMethod("Updater::restart")}manualDownload(){throw new i.UnimplementedMethod("Updater::manualDownload")}killServiceWorker(){throw new i.UnimplementedMethod("Updater::killServiceWorker")}}t.UpdaterBase=p},11772:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=document.getElementById("hard_expire_time");let i=null==n||null===(r=n.dataset)||void 0===r?void 0:r.time;i||(__LOG__(3)`hard expire time not found on dom, using fallback of 1572566400 (2019/11/1)`,i="1572566400");var a=i;t.default=a},19518:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0,t.checkForUpdates=function(){return _.apply(this,arguments)},t.updatePoll=t.hasUpdate=void 0;var i=n(r(48926)),a=n(r(28195)),o=n(r(18561)),s=r(29898),l=r(47221),c=r(42448);const d="https://web.whatsapp.com/check-update",u={WEB:"web",DARWIN:"darwin",WIN32:"win32",MACSTORE:"darwin-store",WINSTORE:"win32-store",DARWIN_BETA:"darwin-beta",WIN32_BETA:"win32-beta"};t.PLATFORMS=u;const p=e=>[e.isBroken,e.isBelowSoft,e.isBelowHard,e.beta].some(Boolean);t.hasUpdate=p;const f=new a.default({name:"updater",interval:1800,restingInterval:3600,randomIntervalExtension:180});function _(){return(_=(0,i.default)((function*(){const e=u[c.WAM_PLATFORM],t=l.SANITIZED_VERSION_STR;let n=null;if(!navigator.onLine)return __LOG__(2)`Update check skipped because user is offline.`,!1;try{const r=yield(0,o.default)(`${d}?version=${t}&platform=${e}`);if(!r.ok)throw Error(r.statusText);n=yield r.json();const i=(new Date).toISOString();__LOG__(2)`Updater: Checked at ${i} ${JSON.stringify({response:n,version:t})}`}catch(e){__LOG__(4,void 0,new Error)`Updater: Version check failed`}if(!n||!p(n))return!1;const{isBelowHard:i,isBelowSoft:a,hardUpdateTime:f,currentVersion:_,isBroken:h,beta:g}=n;__LOG__(2)`Updater: App will update. ${JSON.stringify({response:n,version:t})}`;const m=i?f:null;return"web"===e?s.Updater.update(_,a,m):h?r(8080).Stream.needsManualDownload=!0:s.Updater.update(void 0,a,m,g),!0}))).apply(this,arguments)}t.updatePoll=f},29898:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterImpl=t.Updater=void 0;var i=r(41629),a=r(47221),o=n(r(15421)),s=n(r(87045)),l=n(r(92658));class c extends i.UpdaterBase{update(e,t,n){__LOG__(2)`AppUpdate:update current: ${String(this.activeVersion)} latest: ${String(e)}`;const s=++this.latestUpdateIteration,l=null==e?void 0:new a.Version(e);this.clearHardExpiration();const c=r(8080).Stream;return"number"==typeof n&&(this.hardExpirationTimer=o.default.setLocalTimeout((()=>(c.clientExpired=!0,this._update(l).then((e=>{e===i.DownloadState.UPDATE_DOWNLOADED&&this.restart()})))),Date.now()+n)),this.updateInProgress=Promise.resolve(this.updateInProgress).then((()=>this._update(l))).then((e=>{this.updateInProgress=void 0;const r=s!==this.latestUpdateIteration,a=e===i.DownloadState.ERROR,o=e===i.DownloadState.UPDATE_NOT_AVAILABLE;return r||a||o||(!0!==t&&"number"!=typeof n||(c.needsUpdate=!0),"number"==typeof n&&this.listenToAndRun(c,"change:couldForce",(()=>{c.couldForce&&this.restart()}))),e})),this.updateInProgress}_update(e){if(!this.activeVersion.equals(e)&&l.default.alive)return this._swUpdate();const t=this.activeVersion.equals(e)?i.DownloadState.UPDATE_NOT_AVAILABLE:i.DownloadState.UPDATE_DOWNLOADED;return Promise.resolve(t)}killServiceWorker(){if(!l.default.alive)return Promise.resolve();const e=navigator.serviceWorker;return e?(__LOG__(2)`Killing service worker`,e.ready.then((e=>e.unregister())).then((e=>{__LOG__(2)`Service worker unregistration status: ${String(e)}`}))):Promise.resolve()}_swUpdate(){const e=navigator.serviceWorker;return e?e.ready.then((t=>new Promise((r=>{function n(e){o(),__LOG__(3)`Unable to update service worker to version. Error: ${String(e)}`}function a(){o(),r(i.DownloadState.UPDATE_DOWNLOADED)}function o(){e.removeEventListener("error",n),e.removeEventListener("controllerchange",a)}e.addEventListener("error",n),e.addEventListener("controllerchange",a),t.update().then((()=>{t.installing||r(i.DownloadState.UPDATE_NOT_AVAILABLE)})).catch((e=>{n(e),r(i.DownloadState.ERROR)}))})))).catch((e=>(__LOG__(3)`Unable to update serviceworker, error: ${e}`,i.DownloadState.ERROR))):Promise.resolve(i.DownloadState.ERROR)}restart(e){return!0===e?this.update(void 0,!0,0):(s.default.hardRefresh(void 0,!1),Promise.resolve(i.DownloadState.UPDATE_DOWNLOADED))}}t.UpdaterImpl=c;const d=new c;t.Updater=d},47221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version=t.SANITIZED_VERSION_STR=void 0,t.sanitizeVersionStr=o;var n=r(40265);class i extends((0,n.customError)("InvalidVersion")){}class a{constructor(e){const t=e.split(".");if(3!==t.length)throw new i("Version format does not contain 3 numbers.");if(this.primary=Number.parseInt(t[0],10),this.secondary=Number.parseInt(t[1],10),this.tertiary=Number.parseInt(t[2],10),Number.isNaN(this.primary)||Number.isNaN(this.secondary)||Number.isNaN(this.tertiary))throw new i("Version contains a non-parseable string.")}lt(e){let t=e;return"string"==typeof t&&(t=new a(t)),this.primary<t.primary||this.primary===t.primary&&this.secondary<t.secondary||this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary<t.tertiary}equals(e){let t=e;return!!t&&("string"==typeof t&&(t=new a(t)),this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary===t.tertiary)}toString(){return`${this.primary}.${this.secondary}.${this.tertiary}`}}function o(e){return e.replace(/\.[di]$/,"")}t.Version=a;const s=o("2.2208.7");t.SANITIZED_VERSION_STR=s},2541:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.URL_REGEX=t.URL=t.REDIRECT_URL=void 0;var i=n(r(88306)),a=n(r(2525)),o=r(15688),s=r(8584),l=r(11141),c=n(r(8575)),d=r(1063),u=r(41796),p=r(31515),f=n(r(23082));let _;const h=/^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/;t.URL_REGEX=h;const g="https://l.wl.co/l";t.REDIRECT_URL=g;const m={build(e,t){const r=new f.default;return(0,a.default)(t||{},((e,t)=>{r.set(t,e)})),`${e}?${r.toString()}`},canMuckHistory(){var e;return!!((0,u.isConnectedToPage)()&&(null===(e=window.history)||void 0===e?void 0:e.pushState)&&self.location)},relToAbs:e=>(_||(_=document.createElement("a")),_.href=e,_.href),hostname:(0,i.default)((function(e){return _||(_=document.createElement("a")),_.href=this.isHttp(e)?e:"http://"+e,_.hostname})),withoutWww:function(e){return e.split("www.").join("")},isHttp:e=>e&&("https://"===e.toLowerCase().substring(0,8)||"http://"===e.toLowerCase().substring(0,7)),isHttps:e=>e&&"https://"===e.toLowerCase().substring(0,8),hasValidUrlScheme(e){const t=e.trim();return["irc://","ftp://","mailto:","http://","https://"].some((e=>0===t.toLowerCase().indexOf(e)))},isBlob:e=>(0,p.isString)(e)&&"blob:"===e.substring(0,5),isData:e=>(0,p.isString)(e)&&"data:"===e.substring(0,5),isEncryptedMedia:e=>e&&(0,p.isString)(e)&&e.endsWith(".enc"),parseDataURL(e){const t=e.indexOf(":"),r=e.indexOf(";"),n=e.indexOf(",");return{mimetype:e.substring(t+1,r),data:e.substring(n+1)}},dataURLtoFile(e){const t=this.parseDataURL(e).mimetype;return(0,d.createFile)([window.dataURLtoBlob(e)],"",{type:t})},GSM_NAME:"gme-whatsappinc",GSM_NUMS:"LM4NgcjF-X_EedaZ6MwPVSH0Sac=",gsmURL(e,t){const r=t.replace(/\-/g,"+").replace(/_/g,"/"),n=(0,o.decodeB64)(r),i=c.default.parse(e).path,a=s.Binary.build(i).readByteArray();return(0,l.hmacSha1)(n,a).then((t=>`${e}&signature=${(0,o.encodeB64UrlSafe)(t)}`))},thumbToCSSURL(e){return`url("${this.isHttp(e)||e.startsWith("data:")?e:`data:image/jpeg;base64,${e}`}")`},thumbAsBackgroundImage(e){return e?{backgroundImage:this.thumbToCSSURL(e)}:{}},isValid:e=>h.test(e),toMaliciousSiteRedirect:e=>""===e||0===e.indexOf(g)?e:`${g}?u=${encodeURIComponent(e)}`};t.URL=m},84435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if((0,n.isConnectedToPage)()){return r(8080).Stream.available}return!1};var n=r(41796)},78521:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0,t.getNameString=O,t.getNameStringFromNames=I,t.mergeVcards=function(e){if(0===e.length)throw new Error("No vcards provided");return 1===e.length?e[0]:{displayName:O(e),vcard:e.map((e=>e.vcard)).join("\n"),isMultiVcard:!0}},t.parseMultiVcard=function(e){const t=e.match(/BEGIN:VCARD([\s\S]*?)END:VCARD/g);return t?t.map((e=>P(e))).filter(Boolean):[]},t.parseVcard=P,t.vcardFromContactModel=function(e){var t;const r=b((0,f.getMaybeMeUser)()?e.displayName:e.formattedName),n=["BEGIN:VCARD","VERSION:3.0",`N:${M(e)}`,`FN:${r}`,`TEL;type=CELL;waid=${String(e.userid)}:${(0,m.default)(e.userid)}`,e.isBusiness?`X-WA-BIZ-NAME:${r}`:null,(null===(t=e.businessProfile)||void 0===t?void 0:t.description)?`X-WA-BIZ-DESCRIPTION:${b(e.businessProfile.description)}`:null,"END:VCARD"].filter(Boolean);return{displayName:r,vcard:n.join("\n"),isMultiVcard:!1}},t.vcardGetDate=function(e){let t=e;return(0,s.default)([/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],(r=>{const n=e.match(r);if(n){const e=!n[1].length||"1604"===n[1],r=e?"0000":n[1];return t=(0,p.default)(`${r}-${n[2]}-${n[3]}`).format("l"),e&&(t=t.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}})),t},t.vcardGetName=M,t.vcardGetNameFromParsed=function(e){let t=null;const{FN:r,NICKNAME:n,TEL:i}=e;if(null==r?void 0:r[0])t=r[0].value;else if(null==n?void 0:n[0])t=n[0].value;else if(null==i?void 0:i[0]){var a;const e=i[0],r=null===(a=e.properties.waid)||void 0===a?void 0:a[0];t=r?(0,m.default)(r):e.value}return t},t.vcardGetOrganizationString=function(e){var t,r;const n=null===(t=e.ORG)||void 0===t?void 0:t[0],i=null===(r=e.TITLE)||void 0===r?void 0:r[0];if(n&&Array.isArray(n.value)&&n.value.length>0){var a;let e=null;(null==i?void 0:i.value)&&(e=`${i.value}`.trim());const[t,...r]=n.value;r.push(t);const o=r.map((e=>(0,h.isString)(e)?e.trim():"")).filter((e=>e.length)).join(_.default.t(407));return(e||"")+((null===(a=e)||void 0===a?void 0:a.length)&&o.length?" - ":"")+o}return""},t.vcardGetType=function(e){const t={jabber:u.fbt._("Jabber",null,{hk:"3usmYV"}),"skype-username":u.fbt._("Skype",null,{hk:"1eW8ty"}),skype:u.fbt._("Skype",null,{hk:"1eW8ty"}),msn:u.fbt._("Windows Live",null,{hk:"Cb3b1"}),aim:u.fbt._("AIM",null,{hk:"1dlOP"}),yahoo:u.fbt._("Yahoo",null,{hk:"1VtQI7"}),icq:u.fbt._("ICQ",null,{hk:"M7uX3"}),"wa-biz-description":u.fbt._("Description",null,{hk:"3NFP7B"}),[v]:u.fbt._("Business Name",null,{hk:"MfcFj"})};let r=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(null!=r&&""!==r)return function(e){if(!e)return;return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}(String(r));const n={TEL:[[["cell"],u.fbt._("Mobile",null,{hk:"1ciHPV"})],[["iphone"],u.fbt._("iPhone",null,{hk:"2MkuaG"})],[["main"],u.fbt._("Main",null,{hk:"46Vh7G"})],[["home","fax"],u.fbt._("Home Fax",null,{hk:"34IobZ"})],[["work","fax"],u.fbt._("Work Fax",null,{hk:"4FNmsW"})],[["home"],u.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],u.fbt._("Work",null,{hk:"3QfW2u"})],[["pager"],u.fbt._("Pager",null,{hk:"20r5VT"})],[[],u.fbt._("Home",null,{hk:"2zkVn1"})]],EMAIL:[[["home"],u.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],u.fbt._("Work",null,{hk:"3QfW2u"})],[["internet"],u.fbt._("Email",null,{hk:"2Vzd0N"})]],URL:[[["home"],u.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],u.fbt._("Work",null,{hk:"3QfW2u"})]],ADR:[[["home"],u.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],u.fbt._("Work",null,{hk:"3QfW2u"})]]};return r=e.type,(0,c.default)(n,(t=>{if(t){const[n,i]=t;if(0===(0,o.default)(n,(0,a.default)(e.properties.type,(e=>e.toLowerCase()))).length)return r=i,!1}})),r},t.vcardIsBiz=function(e){return(e.SERVICE||[]).some((e=>e.type.toLowerCase()===v&&e.value))},t.vcardSerialize=function(e){return e.map((function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")})).join("\n")},t.vcardThumbnail=function(e){if(!e)return;const{PHOTO:t}=e;if((null==t?void 0:t[0])&&g.URL.isData(t[0].value))return t[0].value},t.vcardWids=function(e){let t=[];(null==e?void 0:e.TEL)&&e.TEL.forEach((e=>{var r,n,i;(null!==(r=null===(n=e.properties)||void 0===n||null===(i=n.waid)||void 0===i?void 0:i.length)&&void 0!==r?r:0)>0&&(t=t.concat((0,a.default)(e.properties.waid,d.createUserWid)))}));return t};var i=n(r(63105)),a=n(r(35161)),o=n(r(91966)),s=n(r(84486)),l=n(r(89734)),c=n(r(2525)),d=r(45454),u=r(48360),p=n(r(30381)),f=r(99234),_=n(r(43725)),h=r(31515),g=r(2541),m=n(r(39938));const y=/X-([^;:]+)(?:;[^:]+)*:(.+)/,E={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},S={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},v="wa-biz-name";class T{constructor(e,t,r,n){this.type=e,this.index=t,this.properties=r||{},this.value=n}}function C(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function A(e){const t={};return e?(e.split(";").forEach((e=>{const r=e.split(/=/);if(1===r.length){const e=r[0];C(t,e.toLowerCase(),!0)}else if(2===r.length){const[e,n]=r;C(t,e.toLowerCase(),n.toLowerCase())}})),t):t}function b(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}function P(e){const t=e.replace(/\r?\n|\r/g,"\n").replace(/\n^[ \t]/gm,"").split("\n").filter((e=>0!==e.trim().length)),r={},n={};if(t.length<3)return;const i=t[0].trim().toUpperCase(),a=t[1].trim().toUpperCase(),o=t[t.length-1].trim().toUpperCase(),s="VERSION:2.1"===a||"VERSION:3.0"===a||"VERSION:4.0"===a;if("BEGIN:VCARD"!==i||!s||"END:VCARD"!==o)return __LOG__(4,void 0,new Error,!0)`vcard:parse failed because the vCard is not formatted as expected:
Header as expected? ${String("BEGIN:VCARD"===i)}
Version as expected? ${String(s)}
Footer as expected? ${String("END:VCARD"===o)}
Lines: ${t.length}`,void SEND_LOGS("vcard-fault");for(let e=2;e<t.length-1;e++){var d;const i=t[e],a=i.match(/item(\d+)\.(.*)/),o=a?a[2]:i,s=null===(d=o.match(/([^:;]*)[:;].*/))||void 0===d?void 0:d[1];if(null==s)continue;const l=a?E:S;let c,u,p=s,f=s;if(l[p]){const[e,t]=l[p],r=o.match(e);r&&(c=A(r[1]),u=1===t?u=r[2]:r.slice(2,2+t))}else{const e=o.match(y);e&&(f="SERVICE",p=e[1],u=e[2],c={})}if((Array.isArray(u)?u:[u]).some((e=>e&&(0,h.isString)(e)&&e.trim())))if(a){const t=a[1];n[t]?n[t].fields.push(new T(p,null,c,u)):n[t]={type:p,index:e,key:f,properties:c,value:u,fields:[]}}else C(r,f,new T(p,e,c,u))}return Object.keys(n).forEach((e=>{const{key:t,index:i,type:a,value:o,properties:s,fields:l}=n[e];l.forEach((e=>{s[e.type]=e.value})),C(r,t,new T(a,i,s,o))})),function(e){const t={};return(0,c.default)(e,((e,r)=>{t[r]=(0,l.default)(e,(e=>e.index))})),t}(r)}function M(e){const t=(0,i.default)(e.formattedName.split(e.formattedShortName)),r=t.length?t[0].trim():void 0,n=r?e.formattedShortName:e.formattedName;return`${b(r)};${b(n)};;;`}function O(e){return I(e.map((e=>e.displayName)))}function I(e){const t=e.find((e=>!!e));return e.length?t?1===e.length?t:_.default.t(642,{contactName:t,count:e.length-1,_plural:e.length-1}):_.default.t(643,{count:e.length,_plural:e.length}):u.fbt._("No contacts",null,{hk:"1p56oN"})}t.Field=T},75426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=n(r(2525)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(12641));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}const l="finish",c="stop",d=new Map;function u(){return(u=(0,i.default)((function*(e,t,r){if(!e)return;for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];if("string"==typeof t&&(t===l||t===c))return(0,o.default)(e,t,r,...i);p(e,(e=>{const t=d.get(e)||0;d.set(e,t+1)}));const s=t;if("object"==typeof r&&"object"==typeof s){let e;"function"==typeof r.begin&&(e=r.begin),r.begin=t=>{for(const e in s){const r=s[e];Array.isArray(r)&&(0,o.hook)(t,e,r[1])}e&&e(t)}}const u=yield(0,o.default)(e,t,r,...i);return p(u,(e=>{const t=(d.get(e)||1)-1;0===t?(d.delete(e),f(e)):d.set(e,t)})),u}))).apply(this,arguments)}function p(e,t){Array.isArray(e)?e.forEach((e=>{t(e)})):t(e)}function f(e){var t;const r=o.default.Utilities.data(e),{delayedElements:n}=o.default.State;(0,a.default)(n,((t,r)=>{"count"!==r&&(t!==e&&t||delete n[r])})),(null==r||null===(t=r.velocity)||void 0===t?void 0:t.tweensContainer)&&(r.velocity.tweensContainer.element=null),o.default.Utilities.removeData(e,["fxqueue","velocity"])}},41956:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(81109)),o=i(r(6479)),s=i(r(57557)),l=i(r(41609)),c=r(67294),d=r(53175),u=r(88102),p=(function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n)}(r(64103)),r(29498)),f=r(50338),_=i(r(25170)),h=r(31515),g=i(r(75426)),m=r(85893);const y=["selector"];function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}const S="enter",v="leave",T="appear";class C extends c.Component{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.setBusy=()=>{this.busyId=f.UIBusyTasks.setBusy(this.busyId),this.isBusy||(this.isBusy=!0,u.Cmd.setUiBusy(!0,"vtg"))},this.unsetBusy=()=>{null!=this.busyId&&(f.UIBusyTasks.clearBusy(this.busyId),delete this.busyId),this.isBusy&&(this.uiBusy=!1,u.Cmd.setUiBusy(!1,"vtg"))},this.componentWillAppear=e=>{this.animateIfEnabled(T,e)},this.componentWillEnter=e=>{this.animateIfEnabled(S,e)},this.componentWillLeave=e=>{this.animateIfEnabled(v,e)},this.getUnmountSignal=()=>(this._controller||(this._controller=new n,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort();const t=(0,p.forbiddenFindDOMNode)(this,window.Node);(0,g.default)(t,"finish")}_getTransition(){const{transitionName:e}=this.props;if(e&&!_.default[e])throw __LOG__(4,void 0,new Error,!0)` ${e} wasn't found in VelocityTransitionGroupChild transitions.`,SEND_LOGS("transition-name"),new Error("Invalid transitionName");return e?_.default[e]:_.default.default}getTransitionNodes(e,t){let r=t;Array.isArray(r)||(r=[r]);const n={};return r.map((t=>{const{selector:r}=t,i=(0,o.default)(t,y);let s;return s=r?r in n?n[r]:n[r]=e?Array.from(e.querySelectorAll(r)):void 0:e,(0,l.default)(s)?void 0:(0,a.default)({nodes:s},i)})).filter(Boolean)}blockAction(e){e.preventDefault(),e.stopPropagation()}animateTransitions(e){let t=e;const{delay:r=0,children:n,onAnimationComplete:i}=this.props,{staggerDelay:a}=c.Children.only(n);t===T&&(t=S);const o=this._getTransition(),l=o[t];if(!o||!l)return Promise.resolve();const d=(0,s.default)(o,v,S),u=(0,p.forbiddenFindDOMNode)(this,window.Node),f=this.getTransitionNodes(u,l);return t===v&&(null==u?void 0:u.setAttribute)&&u.addEventListener&&(u.setAttribute("pointerEvents","none",u),u.addEventListener("keypress",this.blockAction,!0),u.addEventListener("keydown",this.blockAction,!0)),Promise.all(f.map((e=>{const{nodes:t,props:n,easing:i,duration:o,delay:s,stagger:l,drag:c}=e;return(0,g.default)(t,n,{easing:i||d.easing||"easeInSine",duration:o||d.duration||0,delay:a||r||s||d.delay||0,queue:d.queue||!1,stagger:l||!1,drag:c||!1})}))).finally((()=>{d.cleanOnComplete&&t===S&&f.forEach((e=>{const t=e.nodes;(Array.isArray(t)?t:[t]).forEach((e=>e.removeAttribute("style")))})),t===v&&(null==u?void 0:u.removeEventListener)&&(u.removeEventListener("keypress",this.blockAction,!0),u.removeEventListener("keydown",this.blockAction,!0)),i&&i()}))}animateIfEnabled(e,t){let r=!1;switch(e){case S:r=this.props.transitionEnter;break;case v:r=this.props.transitionLeave;break;case T:r=this.props.transitionAppear}r?(this.setBusy(),this.animateTransitions(e).finally((()=>{this.unsetBusy()})).then((()=>{this.getUnmountSignal().aborted||(0,h.isFunction)(t)&&t()}))):t()}rejectOnUnmount(){return this._rejectPromise||(this._rejectPromise=new Promise(((e,t)=>{this._rejector=t})),this._rejectPromise.catch((()=>{}))),this._rejectPromise}render(){return c.Children.only(this.props.children)}}C.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},C.displayName="VelocityTransitionGroupChild";class A extends c.Component{constructor(){super(...arguments),this._wrapChild=e=>(0,m.jsx)(C,(0,a.default)((0,a.default)({},this.props),{},{children:e}))}render(){return(0,m.jsx)(d.TransitionGroup,{childFactory:this._wrapChild,className:this.props.className,transitionName:this.props.transitionName,component:this.props.component,children:this.props.children})}}t.default=A,A.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},A.displayName="VelocityTransitionGroup"},7388:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waitForOnlineNaive=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(13959),o=n(r(49036));function s(){return(s=(0,i.default)((function*(){return yield(0,o.default)(self,"online"),(0,a.delayMs)(100)}))).apply(this,arguments)}},24465:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Watchdog=void 0,t.fibonacci=function(e,t,r){if("number"==typeof r){const n=r;return function(r){switch(r.failGeneration){case 0:return Math.min(n,t);case 1:return Math.min(n,e+t);default:return Math.min(n,r.waitDuration+r.prevWaitDuration)}}}return function(r){switch(r.failGeneration){case 0:return t;case 1:return e+t;default:return r.waitDuration+r.prevWaitDuration}}};var n=r(57319),i=r(11290);class a extends i.BaseModel{constructor(){super(...arguments),this.failGeneration=(0,i.session)(0),this.ts=(0,i.session)(),this.waitDuration=(0,i.session)(0),this.prevWaitDuration=(0,i.session)(0),this.jitter=(0,i.session)(0),this.shiftTimer=(0,i.session)(),this.waitAlgorithm=(0,i.session)(),this.onActivated=(0,i.session)(),this.onDeactivated=(0,i.session)(),this.onFed=(0,i.session)(),this.onTimeout=(0,i.session)()}initialize(){this.shiftTimer=new n.ShiftTimer((()=>s.call(this)))}activate(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))}deactivate(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))}feed(){this.shiftTimer.isScheduled()&&(this._run(!0),this.onFed&&this.onFed(this))}forceTimeout(e){this.shiftTimer.isScheduled()?null!=e&&0!==e?(this.shiftTimer.onOrBefore(e),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow():__LOG__(3)`forced non-running watchdog!`}poke(){this.forceTimeout.apply(this,arguments)}resetGeneration(){this.failGeneration=0}_run(e){e&&this.resetGeneration();const t=this.waitAlgorithm(this),r=this.jitter*Math.random()*t;this.shiftTimer.debounce(t+r),this.set({ts:this.shiftTimer.ts,waitDuration:t,prevWaitDuration:this.waitDuration})}}const o=(0,i.defineModel)(a);function s(){const e=this.onTimeout;if(!e)return __LOG__(3,void 0,void 0,!0)`Watchdog timed-out without handler!`,void SEND_LOGS("watchdog-no-handler");this.failGeneration++,e(this)&&this._run(!1)}t.Watchdog=o},77591:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdDrop=t.ServerStatusCodeError=t.Server5xxDrop=t.LogoutDrop=t.EphemeralDrop=t.E507=t.E499=t.E451=t.E404=t.E401=t.ConventionViolationDrop=t.CatalogEditServerError=t.BrowserReplacedDrop=void 0,t.attachErrorLogger=function(e,t,r){return e.catch((e=>{throw __LOG__(4,!0,new Error,!0)`${r||t}, error: ${e}`,SEND_LOGS(t),e}))};var n=r(40265);class i extends((0,n.customError)("ServerStatusCodeError")){constructor(e,t){super(t),this.status=e,this.statusCode=e}}t.ServerStatusCodeError=i;class a extends((0,n.customError)("ServerStatusCodeError")){constructor(e,t,r){super(r),this.errors=t,this.status=e,this.statusCode=e}}t.CatalogEditServerError=a;class o extends((0,n.customError)("E451",!0,i)){constructor(){super(451,"commerce features disabled")}}t.E451=o;class s extends((0,n.customError)("E401",!0,i)){constructor(e){super(401,e)}}t.E401=s;class l extends((0,n.customError)("E404",!0,i)){constructor(e){super(404,e)}}t.E404=l;class c extends((0,n.customError)("E499",!0,i)){constructor(e){super(499,e)}}t.E499=c;class d extends((0,n.customError)("E507",!0,i)){constructor(e,t){super(507,e),this.backoff=Number.isNaN(t)?null:t}}t.E507=d;class u extends((0,n.customError)("WebdDrop")){}t.WebdDrop=u;class p extends((0,n.customError)("BrowserReplacedDrop",!0,u)){}t.BrowserReplacedDrop=p;class f extends((0,n.customError)("ConventionViolationDrop",!0,u)){}t.ConventionViolationDrop=f;class _ extends((0,n.customError)("Server5xxDrop",!0,u)){}t.Server5xxDrop=_;class h extends((0,n.customError)("LogoutDrop",!0,u)){}t.LogoutDrop=h;class g extends((0,n.customError)("EphemeralDrop",!0,u)){}t.EphemeralDrop=g},45044:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addWebpMetadata=function(e,t){const r=new Uint8Array(e);if(!(0,i.isExtendedFile)(r))throw new Error("Not extended");const s=function(e){const t=new TextEncoder,r=JSON.stringify(e),a=t.encode(r),s=function(e){return(0,n.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)("II"),new Uint8Array([42,0]),(0,i.numberToLittleEndian)(8),new Uint8Array([1,0]),(0,i.stringToUint8)("AW"),new Uint8Array([7,0]),(0,i.numberToLittleEndian)(e.byteLength),(0,i.numberToLittleEndian)(22),e])}(a),l=[o(i.Chunk.EXIF,s.byteLength),s];a.byteLength%2!=0&&l.push(new Uint8Array([0]));return(0,n.concatTypedArrays)(Uint8Array,l)}((0,a.toRawWebpMetadata)(t)),l=(0,n.concatTypedArrays)(Uint8Array,[r,s]);l.set((0,i.numberToLittleEndian)(l.byteLength-8),4);return l.buffer};var n=r(60977),i=r(63800),a=r(19353);function o(e,t){return(0,n.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)(e),(0,i.numberToLittleEndian)(t)])}},57905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const r=new Uint8Array(e),a=null!==(t=(0,i.findWebpChunk)(r,i.Chunk.EXIF))&&void 0!==t?t:(0,i.findWebpChunk)(r,i.Chunk.XMP);if(null==a)return(0,n.sha256Base64)(e);const o=r.slice(0,a.position),s=o.byteLength-i.CHUNK_HEADER_SIZE;return o.set((0,i.numberToLittleEndian)(s),i.FOUR),(0,n.sha256Base64)(o)};var n=r(73045),i=r(63800)},16185:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(((t,r)=>{const n=new i.default;n.onerror=function(e){n.terminate(),r(new a.DecodeWebpResultsError("worker error",e))},n.onmessageerror=function(e){n.terminate(),r(new a.DecodeWebpResultsError("worker message error",e))},n.onmessage=e=>{n.terminate();const r=e.data;t(r)},n.postMessage({webpBuffer:e},[e])}))};var i=n(r(71597)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},7030:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n){const{quality:o=90,ensureExtendedFormat:s=!1}=null!=n?n:{};return new Promise(((n,l)=>{const c=new i.default;c.onerror=function(e){c.terminate(),l(new a.EncodeWebpError("worker error",e))},c.onmessageerror=function(e){c.terminate(),l(new a.EncodeWebpError("worker message error",e))},c.onmessage=e=>{c.terminate(),n(e.data.blob)},c.postMessage({rgbaData:e,width:t,height:r,quality:o,ensureExtendedFormat:s})}))};var i=n(r(47282)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}},32433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebpMetadata=function(e){const t=function(e){const t=new Uint8Array(e),r=(0,n.findWebpMetadata)(t);if(!r)return{};const{position:i,size:a}=r,o=new TextDecoder,s=t.slice(i,i+a),l=o.decode(s);try{return JSON.parse(l)}catch(e){return __LOG__(2)`Failed to parse emojis out of sticker, returning empty object.`,{}}}(e);return(0,i.toWebpMetadata)(t)};var n=r(63800),i=r(19353)},92108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LOOPS=t.MAX_DURATION=void 0,t.getTotalAnimationDuration=l,t.parseWebp=function(e){const t=new Uint8Array(e);if(!(0,s.isExtendedFile)(t))return __LOG__(2)`Sticker file not extended format.`,c;const{emojis:r,isFirstParty:n,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:f}=(0,o.getWebpMetadata)(e),_=(0,i.default)((0,i.default)({},c),{},{emojis:r,isFirstParty:n,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:f});if(!(0,s.isAnimatedWebp)(t))return _;let h,g=0,m=44;for(;(0,a.default)(t.slice(m,m+4),(0,s.stringToUint8)(s.Chunk.ANMF));){const e=m+20,r=t.slice(e,e+3);if(3!==r.length)return _;g+=(0,s.littleEndianToNumber)(r);const n=m+4,i=t.slice(n,n+4);if(4!==i.length)return _;m+=8+(0,s.littleEndianToNumber)(i),null==h&&(h=m)}const y=l(g);return(0,i.default)((0,i.default)({},_),{},{animationDuration:y,firstFrameLength:h,singleLoopDuration:g})};var i=n(r(81109)),a=n(r(63438)),o=r(32433),s=r(63800);t.MAX_LOOPS=3;function l(e){if(0===e)return 0;const t=Math.min(Math.floor(5e3/e),3);return Math.max(t,1)*e}t.MAX_DURATION=5e3;const c={animationDuration:0,singleLoopDuration:0,emojis:[],isFirstParty:!1,isFromStickerMaker:!1,stickerPackId:null,stickerPackName:null,stickerPackPublisher:null}},63800:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEBP_HEADER_SIZE=t.FOUR=t.Chunk=t.CHUNK_HEADER_SIZE=void 0,t.findWebpChunk=s,t.findWebpMetadata=function(e){if(!l(e))return __LOG__(2)`Sticker file not extended format.`,null;if(null==TextDecoder)return null;const t=s(e,o.EXIF);if(!t)return null;const r=String.fromCharCode(0),n=new TextDecoder,i=e.slice(t.position,t.position+t.size),a=n.decode(i);let c,d;for(let e=a.length;e>0;--e)if(null==d&&"}"===a[e])d=e;else if(null!=d&&a[e]===r){c=e+1;break}if(null==c||null==d)return __LOG__(3)`JSON not found in sticker file`,null;return{position:t.position+c,size:d-c+1}},t.isAnimatedWebp=function(e){const t=new Uint8Array(e);return l(t)&&0!=(2&t[20])},t.isExtendedFile=l,t.littleEndianToNumber=c,t.numberToLittleEndian=function(e){const t=new i.Binary;return t.writeUint32(e,!0),t.readByteArray()},t.stringToUint8=d;var i=r(8584),a=n(r(63438));const o=r(76672)({VP8X:"VP8X",ANMF:"ANMF",EXIF:"EXIF",XMP:"XMP "});t.Chunk=o;t.WEBP_HEADER_SIZE=12;t.CHUNK_HEADER_SIZE=8;t.FOUR=4;function s(e,t){const r=d(t);let n=0;for(n+=12;n<e.byteLength;){const t=e.slice(n,n+8),i=t.slice(0,4);let o=c(t.slice(4,8));if(o%2!=0&&(o+=1),(0,a.default)(i,r))return{position:n,size:o+4+4};n+=8+o}return null}function l(e){const t=e.slice(12,16);return(0,a.default)(t,d(o.VP8X))}function c(e){return e.reduce(((e,t,r)=>e+(t<<8*r)),0)}function d(e){const t=new i.Binary;return t.writeString(e),t.readByteArray()}},19353:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FIELDS=t.DEFAULT_METADATA=void 0,t.toRawWebpMetadata=function(e){const t={};null!=e.isFirstParty&&(t[a.isFirstParty]=e.isFirstParty?1:0);null!=e.isFromStickerMaker&&(t[a.isFromStickerMaker]=e.isFromStickerMaker?1:0);null!=e.emojis&&(t[a.emojis]=e.emojis);null!=e.stickerPackId&&(t[a.stickerPackId]=e.stickerPackId);null!=e.stickerPackName&&(t[a.stickerPackName]=e.stickerPackName);null!=e.stickerPackPublisher&&(t[a.stickerPackPublisher]=e.stickerPackPublisher);null!=e.stickerPackPlayStoreLink&&(t[a.stickerPackPlayStoreLink]=e.stickerPackPlayStoreLink);null!=e.stickerPackAppleStoreLink&&(t[a.stickerPackAppleStoreLink]=e.stickerPackAppleStoreLink);return t},t.toWebpMetadata=function(e){const t=e[a.isFirstParty],r=e[a.isFromStickerMaker],n=e[a.emojis],s=e[a.stickerPackId],l=e[a.stickerPackName],c=e[a.stickerPackPublisher],d=e[a.stickerPackPlayStoreLink],u=e[a.stickerPackAppleStoreLink],p=(0,i.default)({},o);null!=t&&(p.isFirstParty=1===t);null!=r&&(p.isFromStickerMaker=1===r);null!=n&&Array.isArray(n)&&(p.emojis=n);null!=s&&(p.stickerPackId=s);null!=l&&(p.stickerPackName=l);null!=c&&(p.stickerPackPublisher=c);null!=d&&(p.stickerPackPlayStoreLink=d);null!=u&&(p.stickerPackAppleStoreLink=u);return p};var i=n(r(81109));const a={isFirstParty:"is-first-party-sticker",isFromStickerMaker:"is-from-sticker-maker",emojis:"emojis",stickerPackId:"sticker-pack-id",stickerPackName:"sticker-pack-name",stickerPackPublisher:"sticker-pack-publisher",stickerPackPlayStoreLink:"android-app-store-link",stickerPackAppleStoreLink:"ios-app-store-link"};t.FIELDS=a;const o={isFirstParty:!1,isFromStickerMaker:!1,emojis:[],stickerPackId:null,stickerPackName:null,stickerPackPublisher:null,stickerPackPlayStoreLink:null,stickerPackAppleStoreLink:null};t.DEFAULT_METADATA=o},39938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e){let t;if(e instanceof o.default?t=e.user:(0,l.isString)(e)&&(t=e.split("@")[0]),t){const e=t;return s.default.isRTL()?s.default.isolateLTR(c(e)):c(e)}}return""};var i=n(r(88306)),a=r(40277),o=n(r(89867)),s=n(r(43725)),l=r(31515);const c=(0,i.default)((e=>"Server"===e?e:(0,a.formatPhone)(e)))},64045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{error:t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t)return t;return new Error(e)}},57538:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=Object.freeze({BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222});t.default=r},15206:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};for(const[r,n]of(0,i.default)(e))null!=n&&(t[r]=n);return t};var i=n(r(89916))},89916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.entries(e)}},66919:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};if(!(e instanceof Object)||Array.isArray(e))throw(0,i.default)("keyMirror(...): Argument must be an object.","comet_infra");for(const r in e)e.hasOwnProperty(r)&&(t[r]=r);return t};var i=n(r(64045))},57291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(const r of e)null!=r&&t.push(r);return t}},29347:(e,t,r)=>{e.exports=r.p+"img/bg-chat-tile-dark_a4be512e7195b6b733d9110b408f075d.png"},33557:(e,t,r)=>{e.exports=r.p+"img/bg-chat-tile-light_04fcacde539c58cca6745483d4858c52.png"},31213:(e,t,r)=>{e.exports=r.p+"img/f00_50f7c47f611e65a746f1d8328172af4c.png"},8750:(e,t,r)=>{e.exports=r.p+"img/f01_3d1e81d38917ed4427168024350d8df6.png"},48738:(e,t,r)=>{e.exports=r.p+"img/f02_c83a3786caa656cdcea06396bbc6c1fc.png"},15494:(e,t,r)=>{e.exports=r.p+"img/f03_dc76f32180586199d7e1872dd004832c.png"},15885:(e,t,r)=>{e.exports=r.p+"img/f04_f13406e16c2b6a8dda89763cf005b02b.png"},5851:(e,t,r)=>{e.exports=r.p+"img/f05_566b33dfb23660bf5fa83125a9dd8218.png"},68540:(e,t,r)=>{e.exports=r.p+"img/f06_f564cba48589a560af4b6e8408ae1718.png"},30293:(e,t,r)=>{e.exports=r.p+"img/f07_ae76e3caeb9dde2ad18eab0ce141d223.png"},91131:(e,t,r)=>{e.exports=r.p+"img/f08_59c98baa006f5eac6629be0957fd73f2.png"},27879:(e,t,r)=>{e.exports=r.p+"img/f09_1a7f295d0fa98fa1d2a63f8dc4600341.png"},8610:(e,t,r)=>{e.exports=r.p+"img/f10_53c9084de35f9f003ed395e1d120d9b6.png"},32641:(e,t,r)=>{e.exports=r.p+"img/f11_c129c05bc58cad686e0934357d6194fb.png"},98479:(e,t,r)=>{e.exports=r.p+"img/f12_bf90fa5257d34005ad5b75ffebb9b74c.png"},25670:(e,t,r)=>{e.exports=r.p+"img/f13_156bc51d4150b9b257fa4e2e774ce985.png"},759:(e,t,r)=>{e.exports=r.p+"img/f14_95fa7d926a8cf1638985d3cd551fac31.png"},52264:(e,t,r)=>{e.exports=r.p+"img/f15_454f1add82fcb11fbb4086c8be3b1bd9.png"},86035:(e,t,r)=>{e.exports=r.p+"img/f16_9ca6324f98317f9d73084696719d2b9b.png"},94878:(e,t,r)=>{e.exports=r.p+"img/f17_9376c16fcd9b554de8a081973bebe9aa.png"},67514:(e,t,r)=>{e.exports=r.p+"img/f18_cc883fb28c32b1652826de5dc16feee0.png"},23533:(e,t,r)=>{e.exports=r.p+"img/f19_c448ba8ef94abcf763e25003aa15d27d.png"},86319:(e,t,r)=>{e.exports=r.p+"img/f20_4ebcff229b29e651b73640d0cd8eccb2.png"},65664:(e,t,r)=>{e.exports=r.p+"img/f21_54d02a1f6ad665760923ecfae9c9ff25.png"},10191:(e,t,r)=>{e.exports=r.p+"img/f22_ca38cbb571fbddb6900518455b8a20b9.png"},48850:(e,t,r)=>{e.exports=r.p+"img/f23_851a6d2ec552319ddaac7ff8ff37263e.png"},92553:(e,t,r)=>{e.exports=r.p+"img/f24_7806bc8ea69d9441ff27032fbaf52907.png"},53453:(e,t,r)=>{e.exports=r.p+"img/f25_68d927d9d12aef33387b683be6341340.png"},78691:(e,t,r)=>{e.exports=r.p+"img/f26_eb28a47950f61dc80827a74063d8786a.png"},17430:(e,t,r)=>{e.exports=r.p+"img/f27_d53f3b6cf583d7a41f3434d18fe4456e.png"},40610:(e,t,r)=>{e.exports=r.p+"img/f28_245f3d8d8dae33bdc04373918922c5a8.png"},78643:(e,t,r)=>{e.exports=r.p+"img/f29_31c6170329c4cf5808fe773488b5d143.png"},73434:(e,t,r)=>{e.exports=r.p+"img/f30_105e340803065abb74841ce2fff42b4b.png"},54981:(e,t,r)=>{e.exports=r.p+"img/f31_db46b1350eb553583212866aa44e2ac0.png"},86488:(e,t,r)=>{e.exports=r.p+"img/f32_4c358e4136bab81e06b7fd7171a7908c.png"},28881:(e,t,r)=>{e.exports=r.p+"img/f33_5a8f246313db052d67853a40f77a6427.png"},71199:(e,t,r)=>{e.exports=r.p+"img/f34_8588016a836bc826824d0656c8b7b0bc.png"},97836:(e,t,r)=>{e.exports=r.p+"img/f35_8aefe3b46c378109f0f780b6954e18db.png"},77985:(e,t,r)=>{e.exports=r.p+"img/f36_793fc72fadaf963507fc6802a9470970.png"},73570:(e,t,r)=>{e.exports=r.p+"img/f37_8d8f6653cbe1f6dd3783174a8af618da.png"},42949:(e,t,r)=>{e.exports=r.p+"img/f38_54b8f37e9f1251bfe9a2a2ef88a31912.png"},21404:(e,t,r)=>{e.exports=r.p+"img/f39_23a6e90aa9166a2fb981cc171abe8513.png"},21792:(e,t,r)=>{e.exports=r.p+"img/f40_923f39f07df4b8ad006e1115dcb206ec.png"},86197:(e,t,r)=>{e.exports=r.p+"img/f41_87448793e4bcea7fae3cfa7532e45033.png"},79685:(e,t,r)=>{e.exports=r.p+"img/f42_cd0e42183cff2e75bdde0c139bbb641a.png"},39346:(e,t,r)=>{e.exports=r.p+"img/f43_9f44150edcf010967cf272c80bd4ff14.png"},89128:(e,t,r)=>{e.exports=r.p+"img/f44_7f5d4a3e29f21bd5d5572a1543448949.png"},86904:(e,t,r)=>{e.exports=r.p+"img/f45_04c55805346c4afbc7f8084570a2cd48.png"},86906:(e,t,r)=>{e.exports=r.p+"img/f46_1e9f9b05193093b5d0d80d9c936bcb36.png"},63265:(e,t,r)=>{e.exports=r.p+"img/f47_152a85c5e9ff12d5f85050ecad1d4313.png"},7029:(e,t,r)=>{e.exports=r.p+"img/f48_bd6d89500662b8605997f54027b2e650.png"},39871:(e,t,r)=>{e.exports=r.p+"img/f49_42185158c0bfff92c70f417c74297ce7.png"},58360:(e,t,r)=>{e.exports=r.p+"img/f50_d825d156222c0d93428f4ecd78564c75.png"},35277:(e,t,r)=>{e.exports=r.p+"img/f51_51e116016636d309962001419e70d5f1.png"},63418:(e,t,r)=>{e.exports=r.p+"img/f52_5296e30be9bec98ccf173a9be6e711a9.png"},58235:(e,t,r)=>{e.exports=r.p+"img/f53_f81b7a3702779e190aeefb7e2183e636.png"},132:(e,t,r)=>{e.exports=r.p+"img/f54_37b3eb612da7ad6c0b20b65e4fdae582.png"},33417:(e,t,r)=>{e.exports=r.p+"img/f55_0c3d912e971e18d6fe8946550262d0e6.png"},50407:(e,t,r)=>{e.exports=r.p+"img/f56_97a65c1c44dced234e0fbb5f78cb277f.png"},29423:(e,t,r)=>{e.exports=r.p+"img/f57_88b41898da1ce86274ee318e1713f437.png"},32176:(e,t,r)=>{e.exports=r.p+"img/f58_56649fe103006ec4fc5bdea5c69f7828.png"},50874:(e,t,r)=>{e.exports=r.p+"img/f59_1dd065a271b58e1ecb9bb3b6c261107f.png"},21578:(e,t,r)=>{e.exports=r.p+"img/f60_4b277b056575663ee9dbf81fecce989e.png"},22129:(e,t,r)=>{e.exports=r.p+"img/f61_ef3fba8c7e6d895afacfb334e7a746ff.png"},33819:(e,t,r)=>{e.exports=r.p+"img/f62_edecb61bfd5cd13895dd8134898d4402.png"},97359:(e,t,r)=>{e.exports=r.p+"img/f63_245e85a3728d5fed6ff9acf1182f4797.png"},39887:(e,t,r)=>{e.exports=r.p+"img/f64_48df8c352924ef1153bb8fd56f5af198.png"},38275:(e,t,r)=>{e.exports=r.p+"img/f65_162b82a8adaf7d2815129f38f265bfb6.png"},71673:(e,t,r)=>{e.exports=r.p+"img/f66_c626c592461087351ad719fa3118959d.png"},21264:(e,t,r)=>{e.exports=r.p+"img/f67_daa263ddff773a14e3ababc4b485a7c9.png"},96007:(e,t,r)=>{e.exports=r.p+"img/f68_ec21f5c8c90ec3bbf634290d6e6025c0.png"},59163:(e,t,r)=>{e.exports=r.p+"img/f69_549a880f1517135abf8914b4cb31fa92.png"},91732:(e,t,r)=>{e.exports=r.p+"img/f70_a69c6599124e3c33d7fac368b07c0249.png"},3913:(e,t,r)=>{e.exports=r.p+"img/f71_4aceb1dc5eaeb5f9cdddf4975e45a841.png"},92293:(e,t,r)=>{e.exports=r.p+"img/f72_f4ed6835609bf3831a20437e8e47d2dc.png"},51577:(e,t,r)=>{e.exports=r.p+"img/f73_94b8b5d2760e6afd967fd74a008cfae0.png"},26347:(e,t,r)=>{e.exports=r.p+"img/f74_2cd31cfe47f05fabb12f9b9f76fc2b6b.png"},70345:(e,t,r)=>{e.exports=r.p+"img/f75_25366bc618fe77d5dfd9db90133f2766.png"},60318:(e,t,r)=>{e.exports=r.p+"img/f76_1347ad29de86f3d0ceb3bf329b06a0a7.png"},86426:(e,t,r)=>{e.exports=r.p+"img/f77_6749eab5d350640476c8ec39ebc3e4db.png"},62002:(e,t,r)=>{e.exports=r.p+"img/f78_9effc679939e4458adafae48294a5db5.png"},49889:(e,t,r)=>{e.exports=r.p+"img/f79_36df3d2cd225fa6b3a6c84c69b72bed1.png"},24324:(e,t,r)=>{e.exports=r.p+"img/f80_f94a52bb981c25a9f8643a55d023be59.png"},59354:(e,t,r)=>{e.exports=r.p+"img/f81_fb74d3d4cc5a27e62e93586c7d09e47e.png"},74992:(e,t,r)=>{e.exports=r.p+"img/f82_2741f2d09772f3e9e836f2c50fb0bf99.png"},80502:(e,t,r)=>{e.exports=r.p+"img/f83_f8586167f3fde3b1e0c7dbb479e5c0ab.png"},74260:(e,t,r)=>{e.exports=r.p+"img/f84_f5b79393aa7e2979b376c76f46d39b52.png"},64108:(e,t,r)=>{e.exports=r.p+"img/f85_7ea40f8452fb838a747fb0881ffd5980.png"},71042:(e,t,r)=>{e.exports=r.p+"img/f86_486fdf332fda50c1cd7c4b9bd8a3f993.png"},95563:(e,t,r)=>{e.exports=r.p+"img/f87_91e88bfc16e4baddaf2fc4f881c3efc5.png"},64594:(e,t,r)=>{e.exports=r.p+"img/f88_286401f05def8a122db7f4686e383691.png"},68005:(e,t,r)=>{e.exports=r.p+"img/f89_658f39d559719b5b6208346f6a7753b9.png"},16888:(e,t,r)=>{e.exports=r.p+"img/f90_d5612bad79e603d92135c3bbfbcd14d1.png"},52943:(e,t,r)=>{e.exports=r.p+"img/f91_58bb429f953c740a98bcab0c032e8e25.png"},24613:(e,t,r)=>{e.exports=r.p+"img/f92_970e0969177b051897bdd55bf12ee3ae.png"},94922:(e,t,r)=>{e.exports=r.p+"img/f93_4776ec98a5d48ae85b24621ad1eac6eb.png"},18725:(e,t,r)=>{e.exports=r.p+"img/f94_296c4ae16a836cf0903cc5ef0476333c.png"},82950:(e,t,r)=>{e.exports=r.p+"img/f95_888ec2f78b312aed756a8d7008dc979b.png"},7251:(e,t,r)=>{e.exports=r.p+"img/f96_5b97286be655dbd4f5aa79f5f008c5ce.png"},17978:(e,t,r)=>{e.exports=r.p+"img/f97_b4ff99d92592c44b5d8a5b501fc24da6.png"},86273:(e,t,r)=>{e.exports=r.p+"img/f98_0922d228059acde80cc489a2879fe864.png"},31666:(e,t,r)=>{e.exports=r.p+"img/f99_c608e2edac2f741a5a39b814ba36c287.png"},10331:(e,t,r)=>{e.exports=r.p+"img/favicon-error_ac2b4ac0b3a8a9d2256d517e69a3e272.png"},72174:(e,t,r)=>{e.exports=r.p+"img/favicon-error2_fb2afa4bfd23495c7bd2555bb080bb35.png"},68431:(e,t,r)=>{e.exports=r.p+"img/favicon_c5088e888c97ad440a61d247596f88e5.png"},95203:(e,t,r)=>{e.exports=r.p+"img/f00_81a748c30861e19178cb90ab8b31c9e4.png"},66574:(e,t,r)=>{e.exports=r.p+"img/f01_78cd893586564a736b94f919cd2851f7.png"},19833:(e,t,r)=>{e.exports=r.p+"img/f02_4bfcfe058a11109e81b7e9cbdfdeb02a.png"},39974:(e,t,r)=>{e.exports=r.p+"img/f03_577fd59324f5db48af17efcba0a23ea5.png"},86727:(e,t,r)=>{e.exports=r.p+"img/f04_841c20c722f90620ba13762ae73f6143.png"},78808:(e,t,r)=>{e.exports=r.p+"img/f05_c1bde74d642126370c5da5fb0de680c6.png"},71258:(e,t,r)=>{e.exports=r.p+"img/f06_eb85be6945aa4a51c3e05d97ecb1c290.png"},64497:(e,t,r)=>{e.exports=r.p+"img/f07_4d1031e781a9619d0579571eb2049ee6.png"},66114:(e,t,r)=>{e.exports=r.p+"img/f08_4d61c3d691066fa829ad43af1d6063ca.png"},12430:(e,t,r)=>{e.exports=r.p+"img/f09_f9d4e1b3266f81e8952251520de80711.png"},29809:(e,t,r)=>{e.exports=r.p+"img/f10_1f2eeb1340d4c4b4d423117d47d5f56e.png"},41191:(e,t,r)=>{e.exports=r.p+"img/f11_699424412fed1628d27e04957a284d2e.png"},87642:(e,t,r)=>{e.exports=r.p+"img/f12_ef4dd9b4bc88503d33fde312a57af7f9.png"},26841:(e,t,r)=>{e.exports=r.p+"img/f13_0bf1895a611a2187f9758ac305e87d2e.png"},7967:(e,t,r)=>{e.exports=r.p+"img/f14_df2ad83835b022116ce26f030de1a13d.png"},38817:(e,t,r)=>{e.exports=r.p+"img/f15_cffc8769d0c2ef7f8f8d5fc16e339cab.png"},65587:(e,t,r)=>{e.exports=r.p+"img/f16_8b958a65cb9dbf5c7716f1c865391473.png"},38297:(e,t,r)=>{e.exports=r.p+"img/f17_83147bc30e9d1cfe9ae417bf4afc2f77.png"},61665:(e,t,r)=>{e.exports=r.p+"img/f18_9595be739a769411763ad68c24cb245f.png"},16962:(e,t,r)=>{e.exports=r.p+"img/f19_2b465cf764fb53292292e003e070268a.png"},42387:(e,t,r)=>{e.exports=r.p+"img/f20_a781e4e7a5b4d97c226843b0f2d1472d.png"},74420:(e,t,r)=>{e.exports=r.p+"img/f21_b03a1e45532edd017ebbda6b8e2566bb.png"},84319:(e,t,r)=>{e.exports=r.p+"img/f22_809ee1be83cf9aba76ecde6bf3e65e58.png"},43302:(e,t,r)=>{e.exports=r.p+"img/f23_e2c0fa78795ee79b68fdbdca50a960ae.png"},34444:(e,t,r)=>{e.exports=r.p+"img/f24_3832927a08d4eec1867a7d7c4ba2fcd7.png"},14231:(e,t,r)=>{e.exports=r.p+"img/f25_0ade03b46b6e8819de9523bc8ff6a7cd.png"},15842:(e,t,r)=>{e.exports=r.p+"img/f26_e38c0e2c62dae55d9cdf26d8c22b6b9d.png"},25925:(e,t,r)=>{e.exports=r.p+"img/f27_b4871a7570313a9f599b1911f339413d.png"},10149:(e,t,r)=>{e.exports=r.p+"img/f28_1b3971aa7b75218570c3d9940aa4a73d.png"},90154:(e,t,r)=>{e.exports=r.p+"img/f29_f2c7a605126e29e8885601cdc65e6aa0.png"},701:(e,t,r)=>{e.exports=r.p+"img/f30_712d71bfb048818a771a9d144b40d9aa.png"},27707:(e,t,r)=>{e.exports=r.p+"img/f31_1d19e90516ce464192bd7016d05a2dba.png"},95169:(e,t,r)=>{e.exports=r.p+"img/f32_9a70dc1de944f622b350752076a6310d.png"},77763:(e,t,r)=>{e.exports=r.p+"img/f33_1f3382e82a8abe7cdce46f789f7c4ede.png"},98593:(e,t,r)=>{e.exports=r.p+"img/f34_29dc69ea8e91117dae46fcf7e7f58417.png"},16569:(e,t,r)=>{e.exports=r.p+"img/f35_fa478612d2487e2fead293b7005566ea.png"},35807:(e,t,r)=>{e.exports=r.p+"img/f36_bb827e69f0979553e18c0fd1cb192b02.png"},82439:(e,t,r)=>{e.exports=r.p+"img/f37_b06f5850d2c8eda0c51ad5491779af6c.png"},41360:(e,t,r)=>{e.exports=r.p+"img/f38_0b370e976457b876910c4a638ac302e2.png"},93127:(e,t,r)=>{e.exports=r.p+"img/f39_a09d7dfecc70b04ec35edc2967c60a30.png"},62369:(e,t,r)=>{e.exports=r.p+"img/f40_ed134cdcd59bb430218f2be2cdd20aa1.png"},55876:(e,t,r)=>{e.exports=r.p+"img/f41_a785dbfd120b89c2e8616357b9722163.png"},31990:(e,t,r)=>{e.exports=r.p+"img/f42_4149402ff16c6de0b1b06eff01619455.png"},36009:(e,t,r)=>{e.exports=r.p+"img/f43_d543d1bc6a09014ac24d7189b0ced761.png"},24580:(e,t,r)=>{e.exports=r.p+"img/f44_9ffa8beb4bd1c21f328fdd822cba19a7.png"},61400:(e,t,r)=>{e.exports=r.p+"img/f45_0c3cea68945b437380dacd15cbe90ded.png"},78354:(e,t,r)=>{e.exports=r.p+"img/f46_58320ab4676a6287d9dec0790f0d88fc.png"},27020:(e,t,r)=>{e.exports=r.p+"img/f47_5f2ac6f7a9fe79dc3d9a701872c0d0f8.png"},27961:(e,t,r)=>{e.exports=r.p+"img/f48_5fdbdf26d5c581f2a84ebfa50355bd2d.png"},8725:(e,t,r)=>{e.exports=r.p+"img/f49_7bd9cdf5a225ef778b0abd7c9b5310ba.png"},25129:(e,t,r)=>{e.exports=r.p+"img/f50_f4b49b8b3eb729c1fd7c991958aa67b7.png"},33690:(e,t,r)=>{e.exports=r.p+"img/f51_cccd95bad4c9b8e03d05f634e91d2cc8.png"},15722:(e,t,r)=>{e.exports=r.p+"img/f52_8cc8a9757166f53c59a5a1c5e2ebeb00.png"},94416:(e,t,r)=>{e.exports=r.p+"img/f53_623900497390a42269ea6c7ffd812ecc.png"},59965:(e,t,r)=>{e.exports=r.p+"img/f54_c114021c7945464df273df92403987cb.png"},97937:(e,t,r)=>{e.exports=r.p+"img/f55_bcfef9ad8bf26d250613af9b04c918cf.png"},91425:(e,t,r)=>{e.exports=r.p+"img/f56_76dd317a660aa4927e72484ef9d903fb.png"},40564:(e,t,r)=>{e.exports=r.p+"img/f57_72ed0f17ab92bb06761245cb5a7fd73b.png"},35705:(e,t,r)=>{e.exports=r.p+"img/f58_8b9aa917870bcfabc296989c8a810446.png"},1474:(e,t,r)=>{e.exports=r.p+"img/f59_1a64de23c9ec094314b18a18108319ce.png"},5285:(e,t,r)=>{e.exports=r.p+"img/f60_4926d3e8b53f38a3c792cb7b3e07d48d.png"},60792:(e,t,r)=>{e.exports=r.p+"img/f61_08509dff37749613925fe8b16a84ba56.png"},1219:(e,t,r)=>{e.exports=r.p+"img/f62_0869c06452d4ebecdc99f7192ebc702f.png"},66899:(e,t,r)=>{e.exports=r.p+"img/f63_6083f333c2239cba7bbde44e7607a67c.png"},14772:(e,t,r)=>{e.exports=r.p+"img/f64_5d2e1af055fb2cb08326de8e4a844eab.png"},61160:(e,t,r)=>{e.exports=r.p+"img/f65_c863d05c20e4ff179c46170a5311afaf.png"},26671:(e,t,r)=>{e.exports=r.p+"img/f66_1971ad2c6440b2fc909759d8614ef901.png"},18327:(e,t,r)=>{e.exports=r.p+"img/f67_8817a536067dadbc7dc0b1ce0c7cca51.png"},8659:(e,t,r)=>{e.exports=r.p+"img/f68_11393ba2b52ac23a884f923672858aa3.png"},80157:(e,t,r)=>{e.exports=r.p+"img/f69_6a31bf9a0987d546a53d7e8e148d9fa3.png"},14440:(e,t,r)=>{e.exports=r.p+"img/f70_6a12b8c8cf306de335b3174c92c7d63d.png"},90805:(e,t,r)=>{e.exports=r.p+"img/f71_363e1241dbcac22f3bebce9bb5e03e85.png"},39619:(e,t,r)=>{e.exports=r.p+"img/f72_ae6ac1146134ea79656c595a1a2d0e8b.png"},30472:(e,t,r)=>{e.exports=r.p+"img/f73_c9b6d05e598e5adf69ceab85f5db96ac.png"},60325:(e,t,r)=>{e.exports=r.p+"img/f74_67c9ceb4623d37c005ae86e28e4e9fbe.png"},59019:(e,t,r)=>{e.exports=r.p+"img/f75_62cbd93e646a20f624123b595584f2a2.png"},69536:(e,t,r)=>{e.exports=r.p+"img/f76_6862123772ba72af8d1f307c0d2b4895.png"},71717:(e,t,r)=>{e.exports=r.p+"img/f77_78710dcf8b6d89f3951e7887f95408bf.png"},35033:(e,t,r)=>{e.exports=r.p+"img/f78_59e408dc54ae0bd33f3617f7ee9bb2e0.png"},62003:(e,t,r)=>{e.exports=r.p+"img/f79_6682dcc8dd4b1c197e7ec7b9b3deb601.png"},65263:(e,t,r)=>{e.exports=r.p+"img/f80_0d13bdc19570b4c3577062fd0a3a1428.png"},39681:(e,t,r)=>{e.exports=r.p+"img/f81_bfb32e248b9a30d62e32a1f7ea4e7e98.png"},61422:(e,t,r)=>{e.exports=r.p+"img/f82_286f2cdea929dc7b1565aad502aaf165.png"},50966:(e,t,r)=>{e.exports=r.p+"img/f83_4984ad9c5348e8717965f575ac7ea534.png"},60408:(e,t,r)=>{e.exports=r.p+"img/f84_4d4303666006c977553c896dd850fc1b.png"},69738:(e,t,r)=>{e.exports=r.p+"img/f85_10cbc8d1444126f654a032456a74a72c.png"},87724:(e,t,r)=>{e.exports=r.p+"img/f86_03d43f57ad876d0367274524fd27b4ec.png"},93370:(e,t,r)=>{e.exports=r.p+"img/f87_610b9a8f68249032da365af5a664fc41.png"},63963:(e,t,r)=>{e.exports=r.p+"img/f88_5ad6ef9e65165c4bb4c670ce875a5fb5.png"},13976:(e,t,r)=>{e.exports=r.p+"img/f89_e049c6b076ab9212a901406939d7274e.png"},26034:(e,t,r)=>{e.exports=r.p+"img/f90_88c16bdd2fd8228ad1ec89ce3f0cb118.png"},41727:(e,t,r)=>{e.exports=r.p+"img/f91_78d445d5baae7479cac968c11f6724dc.png"},54257:(e,t,r)=>{e.exports=r.p+"img/f92_34f845f9fa2a3667d8d747453f63ad68.png"},61109:(e,t,r)=>{e.exports=r.p+"img/f93_2f324509fe48d002f5a944b003cd180d.png"},2801:(e,t,r)=>{e.exports=r.p+"img/f94_c406ffa6170c14bcbe3158ab7879ce16.png"},11318:(e,t,r)=>{e.exports=r.p+"img/f95_7ce72143c371f981d394ab9b3391f5ea.png"},25889:(e,t,r)=>{e.exports=r.p+"img/f96_bc32095dc9dab040674f58592e10451b.png"},30341:(e,t,r)=>{e.exports=r.p+"img/f97_eedf5849b413d903c4cc72cca6ce0576.png"},51222:(e,t,r)=>{e.exports=r.p+"img/f98_8d47ec83349711222b6d9346049676f1.png"},53279:(e,t,r)=>{e.exports=r.p+"img/f99_d27a48329dde7e88d3d7cd348d745f91.png"},81740:(e,t,r)=>{e.exports=r.p+"img/favicon-error_ef91873fcda4eda22679f675ebf6ed24.png"},5079:(e,t,r)=>{e.exports=r.p+"img/favicon-error2_7ce1b67dbef23e87862b3c12b9b32676.png"},49420:(e,t,r)=>{e.exports=r.p+"img/favicon_94e99ab189284094867d2e1220e42e9f.png"},35729:(e,t,r)=>{e.exports=r.p+"img/intro-connection-dark_0ee01153183b5ebd9b296399cc2104b0.jpg"},74548:(e,t,r)=>{e.exports=r.p+"img/intro-connection-hq-dark_f8cb12a6fc73afaf9d5903b7849bebd6.jpg"},12891:(e,t,r)=>{e.exports=r.p+"img/intro-connection-hq-light_9466a20e6d2921a21ac7ab82419be157.jpg"},5250:(e,t,r)=>{e.exports=r.p+"img/intro-connection-light_c98cc75f2aa905314d74375a975d2cf2.jpg"},7246:(e,t,r)=>{e.exports=r.p+"img/qr-video-hq_c001ebd6ddb0ba5fc7de491dfb556024.png"},17818:(e,t,r)=>{e.exports=r.p+"img/qr-video_0c6ec69b054fdeb31cf3e5e10290fd8e.png"},73727:(e,t,r)=>{e.exports=r.p+"whatsapp-webclient-login-hq_0e0caf2391158ebc09fe32edd1022d03.mp4"},79061:(e,t,r)=>{e.exports=r.p+"whatsapp-webclient-login_c09223f0813e7c3adc16476cba2a5d0d.mp4"},6357:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={wrapper:"_1ADa8",isQR:"nMnIl",isQr:"nMnIl",draggableHeader:"_2jOS3",isMain:"_3Nsgw"}},85954:(e,t,r)=>{"use strict";r.r(t)},44889:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={button:"_20C5O",plainWhite:"GObVX",primary:"_2Zdgs",secondary:"_1zOyO",solidWarning:"_3opZY",strongPrimary:"pNwLD",warning:"_1XvHd",itemFocused:"_2yKMT",disabled:"_3fyVm",nowrap:"_1gUOr",simplified:"_1RguK",strong:"SEZ8N"}},97922:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={noop:"tm2tP"}},8581:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={noop:"i0jNr"}},23257:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={"-emoji-picker-width":"388px",emojiPickerWidth:"388px","-reaction-details-width":"375px",reactionDetailsWidth:"375px",container:"o--vV",reactionDetails:"_3HjyJ",reactionSendTray:"B_YVs",right:"wGJyi",picker:"_3nQGi",tooltip:"_3t1CR",items:"_1HnQz",nib:"_2hkxa",inverse:"QLmve",colorPicker:"fe-ue",emoji:"_3IU7z",sticker:"_1166F",inverseVertical:"_24No0",text:"_3h2j_",icons:"_1lPfJ"}},77793:(e,t,r)=>{"use strict";r.r(t)},30769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_1N4rE"}},36037:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_209uk"}},80648:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={progress:"_35Zb2"}},71937:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={video:"_3-soo",container:"_1hsvr",player:"_1WD62",poster:"kqpxs",hidden:"_2XlyB",overlay:"_1E40b",button:"_2wAIt",play:"_11Jja"}},66937:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={qrWrapper:"_1N3oL",text:"_2WuPw",qr:"_25pwu",headline:"_3-XoE",list:"_2A31C",listItem:"QtrYx",hint:"_3aF8K",toggle:"_2lolS",tip:"_2jR6Q",rememberMeTip:"w2rV5",codeCopy:"_3YgA3",qrcode:"_2UwZ_",codeLogo:"b77wc",idle:"n4LVt",qrButton:"_2znac",qrButtonIcon:"_1pFa_",groupInviteTip:"_3Egqg",icon:"_30yMe"}},98285:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={"weight-light":"_7qtH8",weightLight:"_7qtH8","weight-normal":"_1lF7t",weightNormal:"_1lF7t","weight-medium":"_3EVTz",weightMedium:"_3EVTz","weight-semibold":"_3VDu5",weightSemibold:"_3VDu5","weight-bold":"_2I4o9",weightBold:"_2I4o9","size-8":"_2Le-W",size8:"_2Le-W","size-9":"_2lMoY",size9:"_2lMoY","size-10":"_3QN-O",size10:"_3QN-O","size-11":"_1uSon",size11:"_1uSon","size-12":"_1MfDb",size12:"_1MfDb","size-13":"_2xTZM",size13:"_2xTZM","size-14":"VWPRY",size14:"VWPRY","size-15":"_3SFxP",size15:"_3SFxP","size-16":"_1FXE6",size16:"_1FXE6","size-17":"_2LoZ-",size17:"_2LoZ-","size-18":"ioBp1",size18:"ioBp1","size-19":"oUgLo",size19:"oUgLo","size-20":"_1ioN3",size20:"_1ioN3","size-22":"Urfuj",size22:"Urfuj","size-24":"_3rp2W",size24:"_3rp2W","size-26":"_1651n",size26:"_1651n","size-28":"_1o3ni",size28:"_1o3ni","size-30":"_3jq2u",size30:"_3jq2u","size-32":"_1Zkh5",size32:"_1Zkh5","size-36":"_2gaDs",size36:"_2gaDs","size-48":"i_P7s",size48:"i_P7s","size-60":"_116zp",size60:"_116zp",title:"_3NUK1",large:"_3WYXy","section-title":"_2MNpf",sectionTitle:"_2MNpf","section-title-larger":"_24CNZ",sectionTitleLarger:"_24CNZ",small:"TWzFz",muted:"_3Bg5b","muted-small":"_2gdKz",mutedSmall:"_2gdKz",plain:"_26jM1","popup-title":"wMe6l",popupTitle:"wMe6l","color-accent":"_35orJ",colorAccent:"_35orJ","color-danger":"_2Hpjf",colorDanger:"_2Hpjf","color-dark":"PoW1D",colorDark:"PoW1D","color-primary":"_2cf_G",colorPrimary:"_2cf_G","color-secondary":"AjtLy",colorSecondary:"AjtLy","color-muted":"_2P9Q7",colorMuted:"_2P9Q7","color-success":"_3Vwf8",colorSuccess:"_3Vwf8"}},8762:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={pending:"_3zTDv"}},83322:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={mask:"_25anU"}},24326:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_1INL_",web:"_1UG2S",containerFixed:"_1iyey",graphic:"_26aja",logo:"_35GDA",dots:"_2pp-n",laptop:"_1JPfm",shimmering:"_1dEQH",shimmer:"_3vobx",initialLoad:"_2FX6G",didYouKnow:"WD35o",logout:"_3iu7m",organizing:"A_WMk",progress:"_30oB1",main:"_2dfCc",secondary:"_2e4Ei",warning:"QgIWN",showWarning:"_3dIM5",dot:"behLh",connecting:"_2VJL-",downloading:"ygjbp"}},79436:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={background:"_2c_rw",mainWrapper:"_5XBCY",logoutTitle:"_329-Z"}},17152:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={backdrop:"_2B4d4",popupContainer:"_3ev9-",popup:"_3J6wB",popupBody:"nne8e",popupTitle:"_1bpDE",backdropCover:"_1QH2G",popupContents:"_2Nr6U",popupBox:"_2DOJ8",popupFlex:"_2EOHJ",popupAuto:"_1PdSy",popupControls:"_2i3w0",popupFlexInvite:"_3cUTm",popupFlexUpgrade:"_1jalA",popupTower:"_2ctZG",popupGuide:"_1hMip",popupColumnButtons:"_1Nf9C",popupMultiline:"_37AQP",popupCustomSize:"_2fblo"}},39326:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={action:"_1WVC6",textTip:"_14jEY",divider:"_1Uvap"}},57525:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={textTip:"_2Z6v5",divider:"_2Xgjp"}},21338:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={focusAnimation:"_2BW67",focusAnimationKeyframes:"k4bcw"}},35474:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"index.377d39f92b702915f018.worker.js")}r.r(t),r.d(t,{default:()=>n})},91528:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"milan.df7e9fe0012bf2b673ef.worker.js")}r.r(t),r.d(t,{default:()=>n})},42372:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"opus.9cb880beda213e5923d5.worker.js")}r.r(t),r.d(t,{default:()=>n})},47282:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"rgba_to_webp.worker.73cf0c075ce7e96424c2.worker.js")}r.r(t),r.d(t,{default:()=>n})},71597:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"webp_to_rgba.worker.9d8a97deb706cdeba4c9.worker.js")}r.r(t),r.d(t,{default:()=>n})},42329:()=>{}},e=>{"use strict";e.O(0,[1174],(()=>{return t=29821,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=https://web.whatsapp.com/bootstrap_qr.79aba964bea38dbcc501.js.map
